var wle=Object.defineProperty;var vle=Object.getPrototypeOf;var _le=Reflect.get;var dO=Qe=>{throw TypeError(Qe)};var ble=(Qe,ct,Ut)=>ct in Qe?wle(Qe,ct,{enumerable:!0,configurable:!0,writable:!0,value:Ut}):Qe[ct]=Ut;var J=(Qe,ct,Ut)=>ble(Qe,typeof ct!="symbol"?ct+"":ct,Ut),hO=(Qe,ct,Ut)=>ct.has(Qe)||dO("Cannot "+Ut),Nn=(Qe,ct)=>Object(ct)!==ct?dO('Cannot use the "in" operator on this value'):Qe.has(ct),c=(Qe,ct,Ut)=>(hO(Qe,ct,"read from private field"),Ut?Ut.call(Qe):ct.get(Qe)),_=(Qe,ct,Ut)=>ct.has(Qe)?dO("Cannot add the same private member more than once"):ct instanceof WeakSet?ct.add(Qe):ct.set(Qe,Ut),x=(Qe,ct,Ut,sd)=>(hO(Qe,ct,"write to private field"),sd?sd.call(Qe,Ut):ct.set(Qe,Ut),Ut),A=(Qe,ct,Ut)=>(hO(Qe,ct,"access private method"),Ut);var Ap=(Qe,ct,Ut,sd)=>({set _(U_){x(Qe,ct,U_,Ut)},get _(){return c(Qe,ct,sd)}}),BH=(Qe,ct,Ut)=>_le(vle(Qe),Ut,ct);(function(){"use strict";var xH,EH,hc,eo,kH,CH,fc,to,ro,ua,PH,ew,tw,Wu,zu,pc,mc,Gu,rw,Lx,Yh,nw,sw,fO,Qh,Zu,iw,aw,AH,gc,ef,ow,Ju,tf,TH,cw,uw,lw,dw,rf,nf,Xu,pO,UH,Pi,Yu,Qu,el,fw,tl,rl,la,zH,VH,GH,ZH,sf,af,gn,of,cf,uf,lf,Bx,df,hf,aE,no,nl,so,ff,pw,yc,sl,mw,gw,il,_s,al,pf,yw,wc,ww,IH,vw,vc,_w,mf,bw,ol,Sw,cl,bs,xw,ul,Ew,io,XH,YH,_O,ao,kw,Cw,Pw,Aw,Tw,gf,yf,wf,Iw,ll,zs,Hx,Ow,Rw,dl,vf,Mw,hl,_f,oo,Ai,bf,Sf,$w,Nw,da,fl,xf,On,pl,Ef,ha,kf,Fw,bO,ml,gl,Rn,yl,wl,vl,Cf,Lw,Pf,Af,Tf,QH,eK,Ss,_l,_c,bl,If,jw,Of,tK,rK,Dw,Sl,Rf,Bw,Uw,qw,Mf,xs,Hw,xl,El,$f,Nf,Kw,RO,Ti,Ff,co,Kx,nK,Lf,rs,jf,bc,kl,Ii,Df,Ww,Cl,Wx,ns,iK,aK,oK,zw,Sc,MO,$O,fa,Oi,xc,yn,cK,uK,lK,oE,cE,Vw,Ec,Bf,kc,Pl,Gw,Cc,Zw,Jw,Xw,Yw,Qw,uo,Zt,dK,hK,fK,pK,mK,gK,uE,ed,Al,Uf,Pc,qf,Hf,ev,pa,tv,rv,nv,sv,iv,av,ov,cv,uv,lv,dv,hv,fv,pv,mv,ma,Kf,Wf,gv,yv,wv,vv,_v,bv,Sv,xv,zx,_K,Ac,Tc,Ic,Oc,Tl,Il,zf,wt,Ol,Rc,Vf,ga,lo,Mc,wn,Gf,Ev,Vx,$c,pe,bK,NO,Xc,lE,FO,dE,I_,SK,xK,EK,LO,kK,Tp,CK,PK,jO,AK,TK,hE,IK,DO,OK,BO,UO,kv,Nc,Zf,Cv,Vs,Rl,Jf,Ml,Pv,Mn,ft,qO,RK,MK,$K,HO,KO,WO,NK,FK,LK,jK,Ip,Fc,Xf,Lc,zO,VO,Es,Ri,Yf,or,Ps,$l,DK,fE,Av,Tv,ho,jc,Nl,Qf,Iv,fo,ep,Ov,ya,po,Rv,Mv,$v,Dc,bt,Mi,Bc,Fl,Uc,tp,rp,Kt,mr,np,qc,sp,ip,ap,Ll,mo,Gx,Nv,Fv,Xe,BK,UK,qK,GO,Lv,op,HK,KK,WK,zK,VK,ZO,JO,GK,ZK,XO,JK,YO,go,yo,ks,Hc,Kc,wa,cp,Wc,up,OH,jv,lp,Br,zc,Ur,jl,Dv,Vc,Dl,Bl,Gc,Bv,Ul,Uv,dp,Zx,ss,QO,eR,qv,Hv,Kv,Wv,Jx,Op,Xx,hp,zv,qr,Vv,Gv,fp,wo,vo,gr,Zv,ql,XK,Yx,Jv,Xv,Yv,Qv,tR,Hl,e_,$n,As,_o,pp,Zc,bo,t_,va,mp,r_,Wl,So,n_,s_,zl,Vl,gp,Gl,i_,a_,yp,o_,Qx,_9,c_,eE,b9,u_,tE,S9,Zl,P9,jR,l_,_a,wp,Jc,d_,vp,_p,h_,f_,ba,A9,T9,rE,I9,O9,Jl,p_,Hr,Qt,Cs,M9,DR,BR,UR,m_,nE,bp,$9,N9,g_,qR,Sp,sE,F9,xp,y_,w_,v_,xo,Sa,Xl,__,b_,S_,Yl,Ql,x_,Ep,E_,kp,Eo,ko,Cp,Pp,Co;function Qe(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function ct(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var Ut={exports:{}},sd=Ut.exports,U_;function G9(){return U_||(U_=1,function(n,e){(function(t,r){r(n)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:sd,function(t){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const r="The message port closed before a response was received.",s=i=>{const a={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(a).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(C,E=void 0){super(E),this.createItem=C}get(C){return this.has(C)||this.set(C,this.createItem(C)),super.get(C)}}const u=k=>k&&typeof k=="object"&&typeof k.then=="function",l=(k,C)=>(...E)=>{i.runtime.lastError?k.reject(new Error(i.runtime.lastError.message)):C.singleCallbackArg||E.length<=1&&C.singleCallbackArg!==!1?k.resolve(E[0]):k.resolve(E)},d=k=>k==1?"argument":"arguments",h=(k,C)=>function(M,...I){if(I.length<C.minArgs)throw new Error(`Expected at least ${C.minArgs} ${d(C.minArgs)} for ${k}(), got ${I.length}`);if(I.length>C.maxArgs)throw new Error(`Expected at most ${C.maxArgs} ${d(C.maxArgs)} for ${k}(), got ${I.length}`);return new Promise((N,O)=>{if(C.fallbackToNoCallback)try{M[k](...I,l({resolve:N,reject:O},C))}catch(T){console.warn(`${k} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,T),M[k](...I),C.fallbackToNoCallback=!1,C.noCallback=!0,N()}else C.noCallback?(M[k](...I),N()):M[k](...I,l({resolve:N,reject:O},C))})},f=(k,C,E)=>new Proxy(C,{apply(M,I,N){return E.call(I,k,...N)}});let p=Function.call.bind(Object.prototype.hasOwnProperty);const m=(k,C={},E={})=>{let M=Object.create(null),I={has(O,T){return T in k||T in M},get(O,T,L){if(T in M)return M[T];if(!(T in k))return;let U=k[T];if(typeof U=="function")if(typeof C[T]=="function")U=f(k,k[T],C[T]);else if(p(E,T)){let Z=h(T,E[T]);U=f(k,k[T],Z)}else U=U.bind(k);else if(typeof U=="object"&&U!==null&&(p(C,T)||p(E,T)))U=m(U,C[T],E[T]);else if(p(E,"*"))U=m(U,C[T],E["*"]);else return Object.defineProperty(M,T,{configurable:!0,enumerable:!0,get(){return k[T]},set(Z){k[T]=Z}}),U;return M[T]=U,U},set(O,T,L,U){return T in M?M[T]=L:k[T]=L,!0},defineProperty(O,T,L){return Reflect.defineProperty(M,T,L)},deleteProperty(O,T){return Reflect.deleteProperty(M,T)}},N=Object.create(k);return new Proxy(N,I)},g=k=>({addListener(C,E,...M){C.addListener(k.get(E),...M)},hasListener(C,E){return C.hasListener(k.get(E))},removeListener(C,E){C.removeListener(k.get(E))}}),y=new o(k=>typeof k!="function"?k:function(E){const M=m(E,{},{getContent:{minArgs:0,maxArgs:0}});k(M)}),w=new o(k=>typeof k!="function"?k:function(E,M,I){let N=!1,O,T=new Promise(j=>{O=function(F){N=!0,j(F)}}),L;try{L=k(E,M,O)}catch(j){L=Promise.reject(j)}const U=L!==!0&&u(L);if(L!==!0&&!U&&!N)return!1;const Z=j=>{j.then(F=>{I(F)},F=>{let B;F&&(F instanceof Error||typeof F.message=="string")?B=F.message:B="An unexpected error occurred",I({__mozWebExtensionPolyfillReject__:!0,message:B})}).catch(F=>{console.error("Failed to send onMessage rejected reply",F)})};return Z(U?L:T),!0}),v=({reject:k,resolve:C},E)=>{i.runtime.lastError?i.runtime.lastError.message===r?C():k(new Error(i.runtime.lastError.message)):E&&E.__mozWebExtensionPolyfillReject__?k(new Error(E.message)):C(E)},b=(k,C,E,...M)=>{if(M.length<C.minArgs)throw new Error(`Expected at least ${C.minArgs} ${d(C.minArgs)} for ${k}(), got ${M.length}`);if(M.length>C.maxArgs)throw new Error(`Expected at most ${C.maxArgs} ${d(C.maxArgs)} for ${k}(), got ${M.length}`);return new Promise((I,N)=>{const O=v.bind(null,{resolve:I,reject:N});M.push(O),E.sendMessage(...M)})},S={devtools:{network:{onRequestFinished:g(y)}},runtime:{onMessage:g(w),onMessageExternal:g(w),sendMessage:b.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:b.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},P={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return a.privacy={network:{"*":P},services:{"*":P},websites:{"*":P}},m(i,S,a)};t.exports=s(chrome)}})}(Ut)),Ut.exports}G9();var Ea=(n=>(n.Planner="planner",n.Navigator="navigator",n.Validator="validator",n))(Ea||{}),ur=(n=>(n.OpenAI="openai",n.Anthropic="anthropic",n.DeepSeek="deepseek",n.Gemini="gemini",n.Grok="grok",n.Ollama="ollama",n.CustomOpenAI="custom_openai",n))(ur||{});const Z9={openai:["gpt-4o","gpt-4o-mini","o1","o3-mini"],anthropic:["claude-3-7-sonnet-latest","claude-3-5-sonnet-latest","claude-3-5-haiku-latest"],deepseek:["deepseek-chat","deepseek-reasoner"],gemini:["gemini-2.0-flash","gemini-2.0-flash-lite","gemini-2.5-pro-exp-03-25"],grok:["grok-2","grok-2-vision"],ollama:[]},J9={openai:{planner:{temperature:.01,topP:.001},navigator:{temperature:0,topP:.001},validator:{temperature:0,topP:.001}},anthropic:{planner:{temperature:.1,topP:.1},navigator:{temperature:.1,topP:.1},validator:{temperature:.05,topP:.1}},gemini:{planner:{temperature:.01,topP:.1},navigator:{temperature:.01,topP:.1},validator:{temperature:.1,topP:.1}},grok:{planner:{temperature:.7,topP:.9},navigator:{temperature:.7,topP:.9},validator:{temperature:.7,topP:.9}},ollama:{planner:{temperature:0,topP:.001},navigator:{temperature:.01,topP:.001},validator:{temperature:0,topP:.001}}};var id=(n=>(n.Local="local",n.Sync="sync",n.Managed="managed",n.Session="session",n))(id||{}),ZR=(n=>(n.ExtensionPagesOnly="TRUSTED_CONTEXTS",n.ExtensionPagesAndContentScripts="TRUSTED_AND_UNTRUSTED_CONTEXTS",n))(ZR||{}),q_=(n,e,t)=>new Promise((r,s)=>{var i=u=>{try{o(t.next(u))}catch(l){s(l)}},a=u=>{try{o(t.throw(u))}catch(l){s(l)}},o=u=>u.done?r(u.value):Promise.resolve(u.value).then(i,a);o((t=t.apply(n,e)).next())});const Ni=globalThis.chrome;function JR(n,e){return q_(this,null,function*(){function t(s){return typeof s=="function"}function r(s){return s instanceof Promise}return t(n)?(r(n),n(e)):n})}let XR=!1;function YR(n){if(Ni&&Ni.storage[n]===void 0)throw new Error(`Check your storage permission in manifest.json: ${n} is not defined`)}function FE(n,e,t){var r,s,i,a,o,u;let l=null,d=!1,h=[];const f=(r=t==null?void 0:t.storageEnum)!=null?r:id.Local,p=(s=t==null?void 0:t.liveUpdate)!=null?s:!1,m=(a=(i=t==null?void 0:t.serialization)==null?void 0:i.serialize)!=null?a:k=>k,g=(u=(o=t==null?void 0:t.serialization)==null?void 0:o.deserialize)!=null?u:k=>k;XR===!1&&f===id.Session&&(t==null?void 0:t.sessionAccessForContentScripts)===!0&&(YR(f),Ni==null||Ni.storage[f].setAccessLevel({accessLevel:ZR.ExtensionPagesAndContentScripts}).catch(k=>{console.warn(k),console.warn("Please call setAccessLevel into different context, like a background script.")}),XR=!0);const y=()=>q_(this,null,function*(){var k;YR(f);const C=yield Ni==null?void 0:Ni.storage[f].get([n]);return C&&(k=g(C[n]))!=null?k:e}),w=()=>{h.forEach(k=>k())},v=k=>q_(this,null,function*(){d||(l=yield y()),l=yield JR(k,l),yield Ni==null?void 0:Ni.storage[f].set({[n]:m(l)}),w()}),b=k=>(h=[...h,k],()=>{h=h.filter(C=>C!==k)}),S=()=>l;y().then(k=>{l=k,d=!0,w()});function P(k){return q_(this,null,function*(){if(k[n]===void 0)return;const C=g(k[n].newValue);l!==C&&(l=yield JR(C,l),w())})}return p&&(Ni==null||Ni.storage[f].onChanged.addListener(P)),{get:y,set:v,getSnapshot:S,subscribe:b}}var X9=Object.defineProperty,Y9=Object.defineProperties,Q9=Object.getOwnPropertyDescriptors,QR=Object.getOwnPropertySymbols,eW=Object.prototype.hasOwnProperty,tW=Object.prototype.propertyIsEnumerable,eM=(n,e,t)=>e in n?X9(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ad=(n,e)=>{for(var t in e||(e={}))eW.call(e,t)&&eM(n,t,e[t]);if(QR)for(var t of QR(e))tW.call(e,t)&&eM(n,t,e[t]);return n},LE=(n,e)=>Y9(n,Q9(e)),Lp=(n,e,t)=>new Promise((r,s)=>{var i=u=>{try{o(t.next(u))}catch(l){s(l)}},a=u=>{try{o(t.throw(u))}catch(l){s(l)}},o=u=>u.done?r(u.value):Promise.resolve(u.value).then(i,a);o((t=t.apply(n,e)).next())});const To=FE("llm-api-keys",{providers:{}},{storageEnum:id.Local,liveUpdate:!0});function tM(n){switch(n){case ur.OpenAI:case ur.Anthropic:case ur.DeepSeek:case ur.Gemini:case ur.Grok:case ur.Ollama:return n;default:return ur.CustomOpenAI}}function rM(n){switch(n){case ur.OpenAI:return"OpenAI";case ur.Anthropic:return"Anthropic";case ur.DeepSeek:return"DeepSeek";case ur.Gemini:return"Gemini";case ur.Grok:return"Grok";case ur.Ollama:return"Ollama";default:return n}}function nM(n,e){const t=ad({},e);return t.name||(t.name=rM(n)),t.type||(t.type=tM(n)),t.modelNames||(t.modelNames=Z9[n]||[]),t.createdAt||(t.createdAt=new Date("03/04/2025").getTime()),t.baseUrl||(t.baseUrl="http://llm.nxtscape.ai"),t}const jE=LE(ad({},To),{setProvider(n,e){return Lp(this,null,function*(){if(!n)throw new Error("Provider id cannot be empty");if(e.apiKey===void 0)throw new Error("API key must be provided (can be empty for local models)");if(!e.modelNames)throw new Error("Model names must be provided");const t=LE(ad({},e),{name:e.name||rM(n),type:e.type||tM(n),modelNames:e.modelNames,baseUrl:"http://llm.nxtscape.ai",createdAt:e.createdAt||Date.now()}),r=(yield To.get())||{providers:{}};yield To.set({providers:LE(ad({},r.providers),{[n]:t})})})},getProvider(n){return Lp(this,null,function*(){const t=((yield To.get())||{providers:{}}).providers[n];return t?nM(n,t):void 0})},removeProvider(n){return Lp(this,null,function*(){const e=(yield To.get())||{providers:{}},t=ad({},e.providers);delete t[n],yield To.set({providers:t})})},hasProvider(n){return Lp(this,null,function*(){const e=(yield To.get())||{providers:{}};return n in e.providers})},getAllProviders(){return Lp(this,null,function*(){const n=yield To.get(),e=ad({},n.providers);for(const[t,r]of Object.entries(e))e[t]=nM(t,r);return e})}});var rW=Object.defineProperty,nW=Object.defineProperties,sW=Object.getOwnPropertyDescriptors,sM=Object.getOwnPropertySymbols,iW=Object.prototype.hasOwnProperty,aW=Object.prototype.propertyIsEnumerable,iM=(n,e,t)=>e in n?rW(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ka=(n,e)=>{for(var t in e||(e={}))iW.call(e,t)&&iM(n,t,e[t]);if(sM)for(var t of sM(e))aW.call(e,t)&&iM(n,t,e[t]);return n},H_=(n,e)=>nW(n,sW(e)),od=(n,e,t)=>new Promise((r,s)=>{var i=u=>{try{o(t.next(u))}catch(l){s(l)}},a=u=>{try{o(t.throw(u))}catch(l){s(l)}},o=u=>u.done?r(u.value):Promise.resolve(u.value).then(i,a);o((t=t.apply(n,e)).next())});const Yc=FE("agent-models",{agents:{}},{storageEnum:id.Local,liveUpdate:!0});function oW(n){if(!n.provider||!n.modelName)throw new Error("Provider and model name must be specified")}function aM(n,e){var t;const r=(t=J9[e])==null?void 0:t[n];return r??{temperature:.1,topP:.1}}const Qc=H_(ka({},Yc),{setAgentModel:(n,e)=>od(void 0,null,function*(){oW(e);const t=aM(n,e.provider),r=H_(ka({},e),{parameters:ka(ka({},t),e.parameters)});yield Yc.set(s=>({agents:H_(ka({},s.agents),{[n]:r})}))}),getAgentModel:n=>od(void 0,null,function*(){const t=(yield Yc.get()).agents[n];if(!t)return;const r=aM(n,t.provider);return H_(ka({},t),{parameters:ka(ka({},r),t.parameters)})}),resetAgentModel:n=>od(void 0,null,function*(){yield Yc.set(e=>{const t=ka({},e.agents);return delete t[n],{agents:t}})}),hasAgentModel:n=>od(void 0,null,function*(){const e=yield Yc.get();return n in e.agents}),getConfiguredAgents:()=>od(void 0,null,function*(){const n=yield Yc.get();return Object.keys(n.agents)}),getAllAgentModels:()=>od(void 0,null,function*(){return(yield Yc.get()).agents})});var cW=Object.defineProperty,uW=Object.defineProperties,lW=Object.getOwnPropertyDescriptors,oM=Object.getOwnPropertySymbols,dW=Object.prototype.hasOwnProperty,hW=Object.prototype.propertyIsEnumerable,cM=(n,e,t)=>e in n?cW(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,DE=(n,e)=>{for(var t in e||(e={}))dW.call(e,t)&&cM(n,t,e[t]);if(oM)for(var t of oM(e))hW.call(e,t)&&cM(n,t,e[t]);return n},fW=(n,e)=>uW(n,lW(e)),BE=(n,e,t)=>new Promise((r,s)=>{var i=u=>{try{o(t.next(u))}catch(l){s(l)}},a=u=>{try{o(t.throw(u))}catch(l){s(l)}},o=u=>u.done?r(u.value):Promise.resolve(u.value).then(i,a);o((t=t.apply(n,e)).next())});const K_={maxSteps:100,maxActionsPerStep:5,maxFailures:3,useVision:!0,useVisionForPlanner:!0,planningInterval:3},jp=FE("general-settings",K_,{storageEnum:id.Local,liveUpdate:!0}),UE=fW(DE({},jp),{updateSettings(n){return BE(this,null,function*(){const e=(yield jp.get())||K_;yield jp.set(DE(DE({},e),n))})},getSettings(){return BE(this,null,function*(){return(yield jp.get())||K_})},resetToDefaults(){return BE(this,null,function*(){yield jp.set(K_)})}}),uM={minimumWaitPageLoadTime:.5,waitForNetworkIdlePageLoadTime:1,maximumWaitPageLoadTime:5,waitBetweenActions:1,browserWindowSize:{width:1280,height:1100},highlightElements:!0,viewportExpansion:500,includeDynamicAttributes:!0,homePageUrl:"https://www.google.com"};var qE=function(n,e){return qE=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])},qE(n,e)};function Ca(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");qE(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function pW(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{l(r.next(d))}catch(h){a(h)}}function u(d){try{l(r.throw(d))}catch(h){a(h)}}function l(d){d.done?i(d.value):s(d.value).then(o,u)}l((r=r.apply(n,[])).next())})}function lM(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(l){return function(d){return u([l,d])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(t=0)),t;)try{if(r=1,s&&(i=l[0]&2?s.return:l[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,l[1])).done)return i;switch(s=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(d){l=[6,d],s=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function cd(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function eu(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),s,i=[],a;try{for(;(e===void 0||e-- >0)&&!(s=r.next()).done;)i.push(s.value)}catch(o){a={error:o}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i}function ud(n,e,t){if(arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}function ld(n){return this instanceof ld?(this.v=n,this):new ld(n)}function mW(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(f){r[f]&&(s[f]=function(p){return new Promise(function(m,g){i.push([f,p,m,g])>1||o(f,p)})})}function o(f,p){try{u(r[f](p))}catch(m){h(i[0][3],m)}}function u(f){f.value instanceof ld?Promise.resolve(f.value.v).then(l,d):h(i[0][2],f)}function l(f){o("next",f)}function d(f){o("throw",f)}function h(f,p){f(p),i.shift(),i.length&&o(i[0][0],i[0][1])}}function gW(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof cd=="function"?cd(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(a){return new Promise(function(o,u){a=n[i](a),s(o,u,a.done,a.value)})}}function s(i,a,o,u){Promise.resolve(u).then(function(l){i({value:l,done:o})},a)}}function Nt(n){return typeof n=="function"}function HE(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var KE=HE(function(n){return function(t){n(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,s){return s+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function W_(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var Dp=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,s,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=cd(a),u=o.next();!u.done;u=o.next()){var l=u.value;l.remove(this)}}catch(g){e={error:g}}finally{try{u&&!u.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else a.remove(this);var d=this.initialTeardown;if(Nt(d))try{d()}catch(g){i=g instanceof KE?g.errors:[g]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var f=cd(h),p=f.next();!p.done;p=f.next()){var m=p.value;try{fM(m)}catch(g){i=i??[],g instanceof KE?i=ud(ud([],eu(i)),eu(g.errors)):i.push(g)}}}catch(g){r={error:g}}finally{try{p&&!p.done&&(s=f.return)&&s.call(f)}finally{if(r)throw r.error}}}if(i)throw new KE(i)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)fM(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&W_(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&W_(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),dM=Dp.EMPTY;function hM(n){return n instanceof Dp||n&&"closed"in n&&Nt(n.remove)&&Nt(n.add)&&Nt(n.unsubscribe)}function fM(n){Nt(n)?n():n.unsubscribe()}var pM={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},yW={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return setTimeout.apply(void 0,ud([n,e],eu(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function mM(n){yW.setTimeout(function(){throw n})}function dd(){}function z_(n){n()}var WE=function(n){Ca(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,hM(t)&&t.add(r)):r.destination=bW,r}return e.create=function(t,r,s){return new V_(t,r,s)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(Dp),wW=Function.prototype.bind;function zE(n,e){return wW.call(n,e)}var vW=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){G_(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){G_(r)}else G_(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){G_(t)}},n}(),V_=function(n){Ca(e,n);function e(t,r,s){var i=n.call(this)||this,a;if(Nt(t)||!t)a={next:t??void 0,error:r??void 0,complete:s??void 0};else{var o;i&&pM.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=function(){return i.unsubscribe()},a={next:t.next&&zE(t.next,o),error:t.error&&zE(t.error,o),complete:t.complete&&zE(t.complete,o)}):a=t}return i.destination=new vW(a),i}return e}(WE);function G_(n){mM(n)}function _W(n){throw n}var bW={closed:!0,next:dd,error:_W,complete:dd},VE=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Fi(n){return n}function SW(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return gM(n)}function gM(n){return n.length===0?Fi:n.length===1?n[0]:function(t){return n.reduce(function(r,s){return s(r)},t)}}var yr=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var s=this,i=EW(e)?e:new V_(e,t,r);return z_(function(){var a=s,o=a.operator,u=a.source;i.add(o?o.call(i,u):u?s._subscribe(i):s._trySubscribe(i))}),i},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=yM(t),new t(function(s,i){var a=new V_({next:function(o){try{e(o)}catch(u){i(u),a.unsubscribe()}},error:i,complete:s});r.subscribe(a)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[VE]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return gM(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=yM(e),new e(function(r,s){var i;t.subscribe(function(a){return i=a},function(a){return s(a)},function(){return r(i)})})},n.create=function(e){return new n(e)},n}();function yM(n){var e;return(e=n??pM.Promise)!==null&&e!==void 0?e:Promise}function xW(n){return n&&Nt(n.next)&&Nt(n.error)&&Nt(n.complete)}function EW(n){return n&&n instanceof WE||xW(n)&&hM(n)}function kW(n){return Nt(n==null?void 0:n.lift)}function zr(n){return function(e){if(kW(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ir(n,e,t,r,s){return new CW(n,e,t,r,s)}var CW=function(n){Ca(e,n);function e(t,r,s,i,a,o){var u=n.call(this,t)||this;return u.onFinalize=a,u.shouldUnsubscribe=o,u._next=r?function(l){try{r(l)}catch(d){t.error(d)}}:n.prototype._next,u._error=i?function(l){try{i(l)}catch(d){t.error(d)}finally{this.unsubscribe()}}:n.prototype._error,u._complete=s?function(){try{s()}catch(l){t.error(l)}finally{this.unsubscribe()}}:n.prototype._complete,u}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(WE),PW=HE(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),wM=function(n){Ca(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new vM(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new PW},e.prototype.next=function(t){var r=this;z_(function(){var s,i;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var a=cd(r.currentObservers),o=a.next();!o.done;o=a.next()){var u=o.value;u.next(t)}}catch(l){s={error:l}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(s)throw s.error}}}})},e.prototype.error=function(t){var r=this;z_(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var s=r.observers;s.length;)s.shift().error(t)}})},e.prototype.complete=function(){var t=this;z_(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,s=this,i=s.hasError,a=s.isStopped,o=s.observers;return i||a?dM:(this.currentObservers=null,o.push(t),new Dp(function(){r.currentObservers=null,W_(o,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,s=r.hasError,i=r.thrownError,a=r.isStopped;s?t.error(i):a&&t.complete()},e.prototype.asObservable=function(){var t=new yr;return t.source=this,t},e.create=function(t,r){return new vM(t,r)},e}(yr),vM=function(n){Ca(e,n);function e(t,r){var s=n.call(this)||this;return s.destination=t,s.source=r,s}return e.prototype.next=function(t){var r,s;(s=(r=this.destination)===null||r===void 0?void 0:r.next)===null||s===void 0||s.call(r,t)},e.prototype.error=function(t){var r,s;(s=(r=this.destination)===null||r===void 0?void 0:r.error)===null||s===void 0||s.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,s;return(s=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&s!==void 0?s:dM},e}(wM),GE={now:function(){return(GE.delegate||Date).now()},delegate:void 0},AW=function(n){Ca(e,n);function e(t,r,s){t===void 0&&(t=1/0),r===void 0&&(r=1/0),s===void 0&&(s=GE);var i=n.call(this)||this;return i._bufferSize=t,i._windowTime=r,i._timestampProvider=s,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=r===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,r),i}return e.prototype.next=function(t){var r=this,s=r.isStopped,i=r._buffer,a=r._infiniteTimeWindow,o=r._timestampProvider,u=r._windowTime;s||(i.push(t),!a&&i.push(o.now()+u)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(t),s=this,i=s._infiniteTimeWindow,a=s._buffer,o=a.slice(),u=0;u<o.length&&!t.closed;u+=i?1:2)t.next(o[u]);return this._checkFinalizedStatuses(t),r},e.prototype._trimBuffer=function(){var t=this,r=t._bufferSize,s=t._timestampProvider,i=t._buffer,a=t._infiniteTimeWindow,o=(a?1:2)*r;if(r<1/0&&o<i.length&&i.splice(0,i.length-o),!a){for(var u=s.now(),l=0,d=1;d<i.length&&i[d]<=u;d+=2)l=d;l&&i.splice(0,l+1)}},e}(wM),TW=function(n){Ca(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(Dp),_M={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return setInterval.apply(void 0,ud([n,e],eu(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},IW=function(n){Ca(e,n);function e(t,r){var s=n.call(this,t,r)||this;return s.scheduler=t,s.work=r,s.pending=!1,s}return e.prototype.schedule=function(t,r){var s;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var i=this.id,a=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(a,i,r)),this.pending=!0,this.delay=r,this.id=(s=this.id)!==null&&s!==void 0?s:this.requestAsyncId(a,this.id,r),this},e.prototype.requestAsyncId=function(t,r,s){return s===void 0&&(s=0),_M.setInterval(t.flush.bind(t,this),s)},e.prototype.recycleAsyncId=function(t,r,s){if(s===void 0&&(s=0),s!=null&&this.delay===s&&this.pending===!1)return r;r!=null&&_M.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var s=this._execute(t,r);if(s)return s;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var s=!1,i;try{this.work(t)}catch(a){s=!0,i=a||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,s=t.scheduler,i=s.actions;this.work=this.state=this.scheduler=null,this.pending=!1,W_(i,this),r!=null&&(this.id=this.recycleAsyncId(s,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(TW),bM=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=GE.now,n}(),OW=function(n){Ca(e,n);function e(t,r){r===void 0&&(r=bM.now);var s=n.call(this,t,r)||this;return s.actions=[],s._active=!1,s}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var s;this._active=!0;do if(s=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,s){for(;t=r.shift();)t.unsubscribe();throw s}},e}(bM),RW=new OW(IW),MW=RW,tu=new yr(function(n){return n.complete()});function $W(n){return n&&Nt(n.schedule)}function ZE(n){return n[n.length-1]}function NW(n){return Nt(ZE(n))?n.pop():void 0}function Bp(n){return $W(ZE(n))?n.pop():void 0}function FW(n,e){return typeof ZE(n)=="number"?n.pop():e}var JE=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function SM(n){return Nt(n==null?void 0:n.then)}function xM(n){return Nt(n[VE])}function EM(n){return Symbol.asyncIterator&&Nt(n==null?void 0:n[Symbol.asyncIterator])}function kM(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function LW(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var CM=LW();function PM(n){return Nt(n==null?void 0:n[CM])}function AM(n){return mW(this,arguments,function(){var t,r,s,i;return lM(this,function(a){switch(a.label){case 0:t=n.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,ld(t.read())];case 3:return r=a.sent(),s=r.value,i=r.done,i?[4,ld(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,ld(s)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function TM(n){return Nt(n==null?void 0:n.getReader)}function vn(n){if(n instanceof yr)return n;if(n!=null){if(xM(n))return jW(n);if(JE(n))return DW(n);if(SM(n))return BW(n);if(EM(n))return IM(n);if(PM(n))return UW(n);if(TM(n))return qW(n)}throw kM(n)}function jW(n){return new yr(function(e){var t=n[VE]();if(Nt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function DW(n){return new yr(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function BW(n){return new yr(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,mM)})}function UW(n){return new yr(function(e){var t,r;try{for(var s=cd(n),i=s.next();!i.done;i=s.next()){var a=i.value;if(e.next(a),e.closed)return}}catch(o){t={error:o}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}e.complete()})}function IM(n){return new yr(function(e){HW(n,e).catch(function(t){return e.error(t)})})}function qW(n){return IM(AM(n))}function HW(n,e){var t,r,s,i;return pW(this,void 0,void 0,function(){var a,o;return lM(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),t=gW(n),u.label=1;case 1:return[4,t.next()];case 2:if(r=u.sent(),!!r.done)return[3,4];if(a=r.value,e.next(a),e.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=u.sent(),s={error:o},[3,11];case 6:return u.trys.push([6,,9,10]),r&&!r.done&&(i=t.return)?[4,i.call(t)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Io(n,e,t,r,s){r===void 0&&(r=0),s===void 0&&(s=!1);var i=e.schedule(function(){t(),s?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(i),!s)return i}function OM(n,e){return e===void 0&&(e=0),zr(function(t,r){t.subscribe(Ir(r,function(s){return Io(r,n,function(){return r.next(s)},e)},function(){return Io(r,n,function(){return r.complete()},e)},function(s){return Io(r,n,function(){return r.error(s)},e)}))})}function RM(n,e){return e===void 0&&(e=0),zr(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function KW(n,e){return vn(n).pipe(RM(e),OM(e))}function WW(n,e){return vn(n).pipe(RM(e),OM(e))}function zW(n,e){return new yr(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function VW(n,e){return new yr(function(t){var r;return Io(t,e,function(){r=n[CM](),Io(t,e,function(){var s,i,a;try{s=r.next(),i=s.value,a=s.done}catch(o){t.error(o);return}a?t.complete():t.next(i)},0,!0)}),function(){return Nt(r==null?void 0:r.return)&&r.return()}})}function MM(n,e){if(!n)throw new Error("Iterable cannot be null");return new yr(function(t){Io(t,e,function(){var r=n[Symbol.asyncIterator]();Io(t,e,function(){r.next().then(function(s){s.done?t.complete():t.next(s.value)})},0,!0)})})}function GW(n,e){return MM(AM(n),e)}function ZW(n,e){if(n!=null){if(xM(n))return KW(n,e);if(JE(n))return zW(n,e);if(SM(n))return WW(n,e);if(EM(n))return MM(n,e);if(PM(n))return VW(n,e);if(TM(n))return GW(n,e)}throw kM(n)}function pt(n,e){return e?ZW(n,e):vn(n)}function Li(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Bp(n);return pt(n,t)}var XE=HE(function(n){return function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}});function Or(n,e){return new Promise(function(t,r){var s=new V_({next:function(i){t(i),s.unsubscribe()},error:r,complete:function(){r(new XE)}});n.subscribe(s)})}function JW(n){return n instanceof Date&&!isNaN(n)}function ar(n,e){return zr(function(t,r){var s=0;t.subscribe(Ir(r,function(i){r.next(n.call(e,i,s++))}))})}var XW=Array.isArray;function YW(n,e){return XW(e)?n.apply(void 0,ud([],eu(e))):n(e)}function $M(n){return ar(function(e){return YW(n,e)})}var QW=Array.isArray,ez=Object.getPrototypeOf,tz=Object.prototype,rz=Object.keys;function nz(n){if(n.length===1){var e=n[0];if(QW(e))return{args:e,keys:null};if(sz(e)){var t=rz(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:n,keys:null}}function sz(n){return n&&typeof n=="object"&&ez(n)===tz}function iz(n,e){return n.reduce(function(t,r,s){return t[r]=e[s],t},{})}function Z_(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Bp(n),r=NW(n),s=nz(n),i=s.args,a=s.keys;if(i.length===0)return pt([],t);var o=new yr(az(i,t,a?function(u){return iz(a,u)}:Fi));return r?o.pipe($M(r)):o}function az(n,e,t){return t===void 0&&(t=Fi),function(r){NM(e,function(){for(var s=n.length,i=new Array(s),a=s,o=s,u=function(d){NM(e,function(){var h=pt(n[d],e),f=!1;h.subscribe(Ir(r,function(p){i[d]=p,f||(f=!0,o--),o||r.next(t(i.slice()))},function(){--a||r.complete()}))},r)},l=0;l<s;l++)u(l)},r)}}function NM(n,e,t){n?Io(t,n,e):e()}function FM(n,e,t,r,s,i,a,o){var u=[],l=0,d=0,h=!1,f=function(){h&&!u.length&&!l&&e.complete()},p=function(g){return l<r?m(g):u.push(g)},m=function(g){i&&e.next(g),l++;var y=!1;vn(t(g,d++)).subscribe(Ir(e,function(w){s==null||s(w),i?p(w):e.next(w)},function(){y=!0},void 0,function(){if(y)try{l--;for(var w=function(){var v=u.shift();a||m(v)};u.length&&l<r;)w();f()}catch(v){e.error(v)}}))};return n.subscribe(Ir(e,p,function(){h=!0,f()})),function(){o==null||o()}}function Rr(n,e,t){return t===void 0&&(t=1/0),Nt(e)?Rr(function(r,s){return ar(function(i,a){return e(r,i,s,a)})(vn(n(r,s)))},t):(typeof e=="number"&&(t=e),zr(function(r,s){return FM(r,s,n,t)}))}function LM(n){return n===void 0&&(n=1/0),Rr(Fi,n)}function oz(){return LM(1)}function YE(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return oz()(pt(n,Bp(n)))}function ru(n){return new yr(function(e){vn(n()).subscribe(e)})}var cz=["addListener","removeListener"],uz=["addEventListener","removeEventListener"],lz=["on","off"];function QE(n,e,t,r){if(Nt(t)&&(r=t,t=void 0),r)return QE(n,e,t).pipe($M(r));var s=eu(fz(n)?uz.map(function(o){return function(u){return n[o](e,u,t)}}):dz(n)?cz.map(jM(n,e)):hz(n)?lz.map(jM(n,e)):[],2),i=s[0],a=s[1];if(!i&&JE(n))return Rr(function(o){return QE(o,e,t)})(vn(n));if(!i)throw new TypeError("Invalid event target");return new yr(function(o){var u=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];return o.next(1<l.length?l:l[0])};return i(u),function(){return a(u)}})}function jM(n,e){return function(t){return function(r){return n[t](e,r)}}}function dz(n){return Nt(n.addListener)&&Nt(n.removeListener)}function hz(n){return Nt(n.on)&&Nt(n.off)}function fz(n){return Nt(n.addEventListener)&&Nt(n.removeEventListener)}function ek(n,e,t){return n===void 0&&(n=0),t===void 0&&(t=MW),new yr(function(r){var s=JW(n)?+n-t.now():n;s<0&&(s=0);var i=0;return t.schedule(function(){r.closed||(r.next(i++),r.complete())},s)})}function Up(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Bp(n),r=FW(n,1/0),s=n;return s.length?s.length===1?vn(s[0]):LM(r)(pt(s,t)):tu}var DM=new yr(dd),pz=Array.isArray;function mz(n){return n.length===1&&pz(n[0])?n[0]:n}function nu(n,e){return zr(function(t,r){var s=0;t.subscribe(Ir(r,function(i){return n.call(e,i,s++)&&r.next(i)}))})}function BM(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=mz(n),n.length===1?vn(n[0]):new yr(UM(n))}function UM(n){return function(e){for(var t=[],r=function(i){t.push(vn(n[i]).subscribe(Ir(e,function(a){if(t){for(var o=0;o<t.length;o++)o!==i&&t[o].unsubscribe();t=null}e.next(a)})))},s=0;t&&!e.closed&&s<n.length;s++)r(s)}}function qp(n){return zr(function(e,t){var r=null,s=!1,i;r=e.subscribe(Ir(t,void 0,void 0,function(a){i=vn(n(a,qp(n)(e))),r?(r.unsubscribe(),r=null,i.subscribe(t)):s=!0})),s&&(r.unsubscribe(),r=null,i.subscribe(t))})}function qM(n){return zr(function(e,t){var r=!1;e.subscribe(Ir(t,function(s){r=!0,t.next(s)},function(){r||t.next(n),t.complete()}))})}function tk(n){return n<=0?function(){return tu}:zr(function(e,t){var r=0;e.subscribe(Ir(t,function(s){++r<=n&&(t.next(s),n<=r&&t.complete())}))})}function J_(){return zr(function(n,e){n.subscribe(Ir(e,dd))})}function gz(n){return ar(function(){return n})}function yz(n,e){return Rr(function(t,r){return vn(n(t,r)).pipe(tk(1),gz(t))})}function X_(n){return n===void 0&&(n=wz),zr(function(e,t){var r=!1;e.subscribe(Ir(t,function(s){r=!0,t.next(s)},function(){return r?t.complete():t.error(n())}))})}function wz(){return new XE}function hd(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?nu(function(s,i){return n(s,i,r)}):Fi,tk(1),t?qM(e):X_(function(){return new XE}))}}function vz(n,e,t){return t===void 0&&(t=1/0),zr(function(r,s){var i=e;return FM(r,s,function(a,o){return n(i,a,o)},t,function(a){i=a},!1,void 0,function(){return i=null})})}function Vr(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.length?zr(function(t,r){UM(ud([t],eu(n)))(r)}):Fi}function Y_(n){n===void 0&&(n=1/0);var e;n&&typeof n=="object"?e=n:e={count:n};var t=e.count,r=t===void 0?1/0:t,s=e.delay,i=e.resetOnSuccess,a=i===void 0?!1:i;return r<=0?Fi:zr(function(o,u){var l=0,d,h=function(){var f=!1;d=o.subscribe(Ir(u,function(p){a&&(l=0),u.next(p)},void 0,function(p){if(l++<r){var m=function(){d?(d.unsubscribe(),d=null,h()):f=!0};if(s!=null){var g=typeof s=="number"?ek(s):vn(s(p,l)),y=Ir(u,function(){y.unsubscribe(),m()},function(){u.complete()});g.subscribe(y)}else m()}else u.error(p)})),f&&(d.unsubscribe(),d=null,h())};h()})}function _z(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=Bp(n);return zr(function(r,s){(t?YE(n,r,t):YE(n,r)).subscribe(s)})}function Q_(n,e){return zr(function(t,r){var s=null,i=0,a=!1,o=function(){return a&&!s&&r.complete()};t.subscribe(Ir(r,function(u){s==null||s.unsubscribe();var l=0,d=i++;vn(n(u,d)).subscribe(s=Ir(r,function(h){return r.next(e?e(u,h,d,l++):h)},function(){s=null,o()}))},function(){a=!0,o()}))})}function bz(n){return zr(function(e,t){vn(n).subscribe(Ir(t,function(){return t.complete()},dd)),!t.closed&&e.subscribe(t)})}function eb(n,e,t){var r=Nt(n)||e||t?{next:n,error:e,complete:t}:n;return r?zr(function(s,i){var a;(a=r.subscribe)===null||a===void 0||a.call(r);var o=!0;s.subscribe(Ir(i,function(u){var l;(l=r.next)===null||l===void 0||l.call(r,u),i.next(u)},function(){var u;o=!1,(u=r.complete)===null||u===void 0||u.call(r),i.complete()},function(u){var l;o=!1,(l=r.error)===null||l===void 0||l.call(r,u),i.error(u)},function(){var u,l;o&&((u=r.unsubscribe)===null||u===void 0||u.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):Fi}function Sz(n){return{all:n=n||new Map,on:function(e,t){var r=n.get(e);r?r.push(t):n.set(e,[t])},off:function(e,t){var r=n.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):n.set(e,[]))},emit:function(e,t){var r=n.get(e);r&&r.slice().map(function(s){s(t)}),(r=n.get("*"))&&r.slice().map(function(s){s(e,t)})}}}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */Symbol.dispose??(Symbol.dispose=Symbol("dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("asyncDispose"));const je=Symbol.dispose,Gs=Symbol.asyncDispose;EH=je,xH=Symbol.toStringTag;const VI=class VI{constructor(){_(this,hc,!1);_(this,eo,[]);J(this,EH,this.dispose);J(this,xH,"DisposableStack")}get disposed(){return c(this,hc)}dispose(){if(!c(this,hc)){x(this,hc,!0);for(const e of c(this,eo).reverse())e[je]()}}use(e){return e&&c(this,eo).push(e),e}adopt(e,t){return c(this,eo).push({[je](){t(e)}}),e}defer(e){c(this,eo).push({[je](){e()}})}move(){if(c(this,hc))throw new ReferenceError("a disposed stack can not use anything new");const e=new VI;return x(e,eo,c(this,eo)),x(this,hc,!0),e}};hc=new WeakMap,eo=new WeakMap;let lr=VI;CH=Gs,kH=Symbol.toStringTag;const GI=class GI{constructor(){_(this,fc,!1);_(this,to,[]);J(this,CH,this.dispose);J(this,kH,"AsyncDisposableStack")}get disposed(){return c(this,fc)}async dispose(){if(!c(this,fc)){x(this,fc,!0);for(const e of c(this,to).reverse())await e[Gs]()}}use(e){return e&&c(this,to).push(e),e}adopt(e,t){return c(this,to).push({[Gs](){return t(e)}}),e}defer(e){c(this,to).push({[Gs](){return e()}})}move(){if(c(this,fc))throw new ReferenceError("a disposed stack can not use anything new");const e=new GI;return x(e,to,c(this,to)),x(this,fc,!0),e}};fc=new WeakMap,to=new WeakMap;let tb=GI;/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */let Ae=(PH=class{constructor(e=Sz(new Map)){_(this,ro);_(this,ua,new Map);x(this,ro,e)}on(e,t){const r=c(this,ua).get(e);return r===void 0?c(this,ua).set(e,[t]):r.push(t),c(this,ro).on(e,t),this}off(e,t){const r=c(this,ua).get(e)??[];if(t===void 0){for(const i of r)c(this,ro).off(e,i);return c(this,ua).delete(e),this}const s=r.lastIndexOf(t);return s>-1&&c(this,ro).off(e,...r.splice(s,1)),this}emit(e,t){return c(this,ro).emit(e,t),this.listenerCount(e)>0}once(e,t){const r=s=>{t(s),this.off(e,r)};return this.on(e,r)}listenerCount(e){var t;return((t=c(this,ua).get(e))==null?void 0:t.length)||0}removeAllListeners(e){return e!==void 0?this.off(e):(this[je](),this)}[je](){for(const[e,t]of c(this,ua))for(const r of t)c(this,ro).off(e,r);c(this,ua).clear()}},ro=new WeakMap,ua=new WeakMap,PH);/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const HM=!!(typeof process<"u"&&process.version),Oo={value:{get fs(){throw new Error("fs is not available in this environment")},get ScreenRecorder(){throw new Error("ScreenRecorder is not available in this environment")}}},KM="24.1.1";/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const ae=(n,e)=>{if(!n)throw new Error(e)};/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */function rk(n,e=!1){if(e){const t=atob(n);return Uint8Array.from(t,r=>r.codePointAt(0))}return new TextEncoder().encode(n)}function WM(n){return zM(new TextEncoder().encode(n))}function zM(n){const t=[];for(let s=0;s<n.length;s+=65534){const i=n.subarray(s,s+65534);t.push(String.fromCodePoint.apply(null,i))}const r=t.join("");return btoa(r)}function xz(n){let e=0;for(const s of n)e+=s.length;const t=new Uint8Array(e);let r=0;for(const s of n)t.set(s,r),r+=s.length;return t}/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */let nk=null;async function Ez(){return nk||(nk=(await Promise.resolve().then(()=>mce)).default),nk}const fd=n=>HM?async(...e)=>{(await Ez())(n)(e)}:(...e)=>{const t=globalThis.__PUPPETEER_DEBUG;!t||!(t==="*"||(t.endsWith("*")?n.startsWith(t):n===t))||console.log(`${n}:`,...e)};/**
 * @license
 * Copyright 2018 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class rb extends Error{constructor(e,t){super(e,t),this.name=this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}class nb extends rb{}class sb extends rb{}class su extends rb{constructor(){super(...arguments);_(this,ew);_(this,tw,"")}set code(t){x(this,ew,t)}get code(){return c(this,ew)}set originalMessage(t){x(this,tw,t)}get originalMessage(){return c(this,tw)}}ew=new WeakMap,tw=new WeakMap;class He extends rb{}class Zs extends su{}/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const kz={letter:{cm:{width:21.59,height:27.94},in:{width:8.5,height:11}},legal:{cm:{width:21.59,height:35.56},in:{width:8.5,height:14}},tabloid:{cm:{width:27.94,height:43.18},in:{width:11,height:17}},ledger:{cm:{width:43.18,height:27.94},in:{width:17,height:11}},a0:{cm:{width:84.1,height:118.9},in:{width:33.1102,height:46.811}},a1:{cm:{width:59.4,height:84.1},in:{width:23.3858,height:33.1102}},a2:{cm:{width:42,height:59.4},in:{width:16.5354,height:23.3858}},a3:{cm:{width:29.7,height:42},in:{width:11.6929,height:16.5354}},a4:{cm:{width:21,height:29.7},in:{width:8.2677,height:11.6929}},a5:{cm:{width:14.8,height:21},in:{width:5.8268,height:8.2677}},a6:{cm:{width:10.5,height:14.8},in:{width:4.1339,height:5.8268}}};/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const Ee=fd("puppeteer:error"),VM=Object.freeze({width:800,height:600}),ib=Symbol("Source URL for Puppeteer evaluation scripts"),Vu=class Vu{constructor(){_(this,Wu);_(this,zu)}static fromCallSite(e,t){const r=new Vu;return x(r,Wu,e),x(r,zu,t.toString()),r}get functionName(){return c(this,Wu)}get siteString(){return c(this,zu)}toString(){return`pptr:${[c(this,Wu),encodeURIComponent(c(this,zu))].join(";")}`}};Wu=new WeakMap,zu=new WeakMap,J(Vu,"INTERNAL_URL","pptr:internal"),J(Vu,"parse",e=>{e=e.slice(5);const[t="",r=""]=e.split(";"),s=new Vu;return x(s,Wu,t),x(s,zu,decodeURIComponent(r)),s}),J(Vu,"isPuppeteerURL",e=>e.startsWith("pptr:"));let as=Vu;const Mr=(n,e)=>{if(Object.prototype.hasOwnProperty.call(e,ib))return e;const t=Error.prepareStackTrace;Error.prepareStackTrace=(s,i)=>i[2];const r=new Error().stack;return Error.prepareStackTrace=t,Object.assign(e,{[ib]:as.fromCallSite(n,r)})},GM=n=>{if(Object.prototype.hasOwnProperty.call(n,ib))return n[ib]},Pa=n=>typeof n=="string"||n instanceof String,Cz=n=>typeof n=="number"||n instanceof Number,Pz=n=>typeof n=="object"&&(n==null?void 0:n.constructor)===Object,Az=n=>typeof n=="object"&&(n==null?void 0:n.constructor)===RegExp,Tz=n=>typeof n=="object"&&(n==null?void 0:n.constructor)===Date;function sk(n,...e){if(Pa(n))return ae(e.length===0,"Cannot evaluate a string with arguments"),n;function t(r){return Object.is(r,void 0)?"undefined":JSON.stringify(r)}return`(${n})(${e.map(t).join(",")})`}async function ZM(n,e){const t=[],r=n.getReader();if(e){const s=await Oo.value.fs.promises.open(e,"w+");try{for(;;){const{done:i,value:a}=await r.read();if(i)break;t.push(a),await s.writeFile(a)}}finally{await s.close()}}else for(;;){const{done:s,value:i}=await r.read();if(s)break;t.push(i)}try{const s=xz(t);return s.length===0?null:s}catch(s){return Ee(s),null}}async function JM(n,e){return new ReadableStream({async pull(t){function r(o,u){return u?Uint8Array.from(atob(o),d=>d.codePointAt(0)):new TextEncoder().encode(o)}const{data:s,base64Encoded:i,eof:a}=await n.send("IO.read",{handle:e});t.enqueue(r(s,i??!1)),a&&(await n.send("IO.close",{handle:e}),t.close())}})}function Iz(n){let e=null;return new Set(["alert","confirm","prompt","beforeunload"]).has(n)&&(e=n),ae(e,`Unknown javascript dialog type: ${n}`),e}function Fn(n,e){return n===0?DM:ek(n).pipe(ar(()=>{throw new nb(`Timed out after waiting ${n}ms`,{cause:e})}))}const XM="__puppeteer_utility_world__"+KM,ab=/^[\x20\t]*\/\/[@#] sourceURL=\s{0,10}(\S*?)\s{0,10}$/m;function YM(n){return`//# sourceURL=${n}`}const Oz=500;function QM(n={},e="in"){var a,o,u,l;const t={scale:1,displayHeaderFooter:!1,headerTemplate:"",footerTemplate:"",printBackground:!1,landscape:!1,pageRanges:"",preferCSSPageSize:!1,omitBackground:!1,outline:!1,tagged:!0,waitForFonts:!0};let r=8.5,s=11;if(n.format){const d=kz[n.format.toLowerCase()][e];ae(d,"Unknown paper format: "+n.format),r=d.width,s=d.height}else r=pd(n.width,e)??r,s=pd(n.height,e)??s;const i={top:pd((a=n.margin)==null?void 0:a.top,e)||0,left:pd((o=n.margin)==null?void 0:o.left,e)||0,bottom:pd((u=n.margin)==null?void 0:u.bottom,e)||0,right:pd((l=n.margin)==null?void 0:l.right,e)||0};return n.outline&&(n.tagged=!0),{...t,...n,width:r,height:s,margin:i}}const ik={px:1,in:96,cm:37.8,mm:3.78};function pd(n,e="in"){if(typeof n>"u")return;let t;if(Cz(n))t=n;else if(Pa(n)){const r=n;let s=r.substring(r.length-2).toLowerCase(),i="";s in ik?i=r.substring(0,r.length-2):(s="px",i=r);const a=Number(i);ae(!isNaN(a),"Failed to parse parameter value: "+r),t=a*ik[s]}else throw new Error("page.pdf() Cannot handle parameter type: "+typeof n);return t/ik[e]}function It(n,e){return new yr(t=>{const r=s=>{t.next(s)};return n.on(e,r),()=>{n.off(e,r)}})}function iu(n,e){return n?QE(n,"abort").pipe(ar(()=>{throw n.reason instanceof Error?(n.reason.cause=e,n.reason):new Error(n.reason,{cause:e})})):DM}function Hp(n){return Rr(e=>pt(Promise.resolve(n(e))).pipe(nu(t=>t),ar(()=>e)))}const ak=new Map([["geolocation","geolocation"],["midi","midi"],["notifications","notifications"],["camera","videoCapture"],["microphone","audioCapture"],["background-sync","backgroundSync"],["ambient-light-sensor","sensors"],["accelerometer","sensors"],["gyroscope","sensors"],["magnetometer","sensors"],["accessibility-events","accessibilityEvents"],["clipboard-read","clipboardReadWrite"],["clipboard-write","clipboardReadWrite"],["clipboard-sanitized-write","clipboardSanitizedWrite"],["payment-handler","paymentHandler"],["persistent-storage","durableStorage"],["idle-detection","idleDetection"],["midi-sysex","midiSysex"]]);let e$=class extends Ae{constructor(){super()}async waitForTarget(e,t={}){const{timeout:r=3e4,signal:s}=t;return await Or(Up(It(this,"targetcreated"),It(this,"targetchanged"),pt(this.targets())).pipe(Hp(e),Vr(iu(s),Fn(r))))}async pages(){return(await Promise.all(this.browserContexts().map(t=>t.pages()))).reduce((t,r)=>t.concat(r),[])}async cookies(){return await this.defaultBrowserContext().cookies()}async setCookie(...e){return await this.defaultBrowserContext().setCookie(...e)}async deleteCookie(...e){return await this.defaultBrowserContext().deleteCookie(...e)}isConnected(){return this.connected}[je](){return this.process()?void this.close().catch(Ee):void this.disconnect().catch(Ee)}[Gs](){return this.process()?this.close():this.disconnect()}};/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */let qt=(Zu=class{constructor(e){_(this,sw);_(this,pc,!1);_(this,mc,!1);_(this,Gu);_(this,rw);_(this,Lx,new Promise(e=>{x(this,rw,e)}));_(this,Yh);_(this,nw);_(this,Qh);e&&e.timeout>0&&(x(this,nw,new nb(e.message)),x(this,Yh,setTimeout(()=>{this.reject(c(this,nw))},e.timeout)))}static create(e){return new Zu(e)}static async race(e){const t=new Set;try{const r=e.map(s=>s instanceof Zu?(c(s,Yh)&&t.add(s),s.valueOrThrow()):s);return await Promise.race(r)}finally{for(const r of t)r.reject(new Error("Timeout cleared"))}}resolve(e){c(this,mc)||c(this,pc)||(x(this,pc,!0),A(this,sw,fO).call(this,e))}reject(e){c(this,mc)||c(this,pc)||(x(this,mc,!0),A(this,sw,fO).call(this,e))}resolved(){return c(this,pc)}finished(){return c(this,pc)||c(this,mc)}value(){return c(this,Gu)}valueOrThrow(){return c(this,Qh)||x(this,Qh,(async()=>{if(await c(this,Lx),c(this,mc))throw c(this,Gu);return c(this,Gu)})()),c(this,Qh)}},pc=new WeakMap,mc=new WeakMap,Gu=new WeakMap,rw=new WeakMap,Lx=new WeakMap,Yh=new WeakMap,nw=new WeakMap,sw=new WeakSet,fO=function(e){clearTimeout(c(this,Yh)),x(this,Gu,e),c(this,rw).call(this)},Qh=new WeakMap,Zu);/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */let ok=(gc=class{constructor(){_(this,ef,!1);_(this,ow,[])}async acquire(e){if(!c(this,ef))return x(this,ef,!0),new gc.Guard(this);const t=qt.create();return c(this,ow).push(t.resolve.bind(t)),await t.valueOrThrow(),new gc.Guard(this,e)}release(){const e=c(this,ow).shift();if(!e){x(this,ef,!1);return}e()}},ef=new WeakMap,ow=new WeakMap,J(gc,"Guard",(AH=class{constructor(t,r){_(this,iw);_(this,aw);x(this,iw,t),x(this,aw,r)}[je](){var t;return(t=c(this,aw))==null||t.call(this),c(this,iw).release()}},iw=new WeakMap,aw=new WeakMap,AH)),gc);/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */let t$=(TH=class extends Ae{constructor(){super();_(this,Ju);_(this,tf,0)}startScreenshot(){const t=c(this,Ju)||new ok;return x(this,Ju,t),Ap(this,tf)._++,t.acquire(()=>{Ap(this,tf)._--,c(this,tf)===0&&x(this,Ju,void 0)})}waitForScreenshotOperations(){var t;return(t=c(this,Ju))==null?void 0:t.acquire()}async waitForTarget(t,r={}){const{timeout:s=3e4}=r;return await Or(Up(It(this,"targetcreated"),It(this,"targetchanged"),pt(this.targets())).pipe(Hp(t),Vr(Fn(s))))}async deleteCookie(...t){return await this.setCookie(...t.map(r=>({...r,expires:1})))}get closed(){return!this.browser().browserContexts().includes(this)}get id(){}[je](){return void this.close().catch(Ee)}[Gs](){return this.close()}},Ju=new WeakMap,tf=new WeakMap,TH);var Wt;(function(n){n.Disconnected=Symbol("CDPSession.Disconnected"),n.Swapped=Symbol("CDPSession.Swapped"),n.Ready=Symbol("CDPSession.Ready"),n.SessionAttached="sessionattached",n.SessionDetached="sessiondetached"})(Wt||(Wt={}));class Kp extends Ae{constructor(){super()}parentSession(){}}/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class r${constructor(e,t,r=""){_(this,cw);_(this,uw);_(this,lw);J(this,"handled",!1);x(this,cw,e),x(this,uw,t),x(this,lw,r)}type(){return c(this,cw)}message(){return c(this,uw)}defaultValue(){return c(this,lw)}async accept(e){ae(!this.handled,"Cannot accept dialog which is already handled!"),this.handled=!0,await this.handle({accept:!0,text:e})}async dismiss(){ae(!this.handled,"Cannot dismiss dialog which is already handled!"),this.handled=!0,await this.handle({accept:!1})}}cw=new WeakMap,uw=new WeakMap,lw=new WeakMap;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const ob=Symbol("_isElementHandle");/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */function Ts(n){return typeof n=="object"&&n!==null&&"name"in n&&"message"in n}function n$(n,e,t){return n.message=e,n.originalMessage=t??n.originalMessage,n}function s$(n){let e=n.error.message;return n.error&&typeof n.error=="object"&&"data"in n.error&&(e+=` ${n.error.data}`),e}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const i$=new Map,Rz=n=>{let e=i$.get(n);return e||(e=new Function(`return ${n}`)(),i$.set(n,e),e)};function ji(n){let e=n.toString();try{new Function(`(${e})`)}catch(t){if(t.message.includes("Refused to evaluate a string as JavaScript because 'unsafe-eval' is not an allowed source of script in the following Content Security Policy directive"))return e;let r="function ";e.startsWith("async ")&&(r=`async ${r}`,e=e.substring(6)),e=`${r}${e}`;try{new Function(`(${e})`)}catch{throw new Error("Passed function cannot be serialized!")}}return e}const md=(n,e)=>{let t=ji(n);for(const[r,s]of Object.entries(e))t=t.replace(new RegExp(`PLACEHOLDER\\(\\s*(?:'${r}'|"${r}")\\s*\\)`,"g"),`(${s})`);return Rz(t)};/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var cb=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},ck=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});const Mz=20;async function*$z(n,e){const t={stack:[],error:void 0,hasError:!1};try{const s=await cb(t,await n.evaluateHandle(async(o,u)=>{const l=[];for(;l.length<u;){const d=await o.next();if(d.done)break;l.push(d.value)}return l},e),!1).getProperties(),i=s.values();return cb(t,new lr,!1).defer(()=>{for(const o of i){const u={stack:[],error:void 0,hasError:!1};try{cb(u,o,!1)[je]()}catch(l){u.error=l,u.hasError=!0}finally{ck(u)}}}),yield*i,s.size===0}catch(r){t.error=r,t.hasError=!0}finally{ck(t)}}async function*Nz(n){let e=Mz;for(;!(yield*$z(n,e));)e<<=1}async function*a$(n){const e={stack:[],error:void 0,hasError:!1};try{const t=cb(e,await n.evaluateHandle(r=>async function*(){yield*r}()),!1);yield*Nz(t)}catch(t){e.error=t,e.hasError=!0}finally{ck(e)}}/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const jx=class jx{constructor(e){_(this,dw);x(this,dw,e)}async get(e){return await c(this,dw).call(this,e)}};dw=new WeakMap,J(jx,"create",e=>new jx(e));let os=jx;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var ub=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},lb=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});class Aa{static get _querySelector(){if(this.querySelector)return this.querySelector;if(!this.querySelectorAll)throw new Error("Cannot create default `querySelector`.");return this.querySelector=md(async(e,t,r)=>{const i=PLACEHOLDER("querySelectorAll")(e,t,r);for await(const a of i)return a;return null},{querySelectorAll:ji(this.querySelectorAll)})}static get _querySelectorAll(){if(this.querySelectorAll)return this.querySelectorAll;if(!this.querySelector)throw new Error("Cannot create default `querySelectorAll`.");return this.querySelectorAll=md(async function*(e,t,r){const i=await PLACEHOLDER("querySelector")(e,t,r);i&&(yield i)},{querySelector:ji(this.querySelector)})}static async*queryAll(e,t){const r={stack:[],error:void 0,hasError:!1};try{const s=ub(r,await e.evaluateHandle(this._querySelectorAll,t,os.create(i=>i.puppeteerUtil)),!1);yield*a$(s)}catch(s){r.error=s,r.hasError=!0}finally{lb(r)}}static async queryOne(e,t){const r={stack:[],error:void 0,hasError:!1};try{const s=ub(r,await e.evaluateHandle(this._querySelector,t,os.create(i=>i.puppeteerUtil)),!1);return ob in s?s.move():null}catch(s){r.error=s,r.hasError=!0}finally{lb(r)}}static async waitFor(e,t,r){const s={stack:[],error:void 0,hasError:!1};try{let i;const a=ub(s,await(async()=>{if(!(ob in e)){i=e;return}return i=e.frame,await i.isolatedRealm().adoptHandle(e)})(),!1),{visible:o=!1,hidden:u=!1,timeout:l,signal:d}=r,h=o||u?"raf":r.polling;try{const f={stack:[],error:void 0,hasError:!1};try{d==null||d.throwIfAborted();const p=ub(f,await i.isolatedRealm().waitForFunction(async(m,g,y,w,v)=>{const S=await m.createFunction(g)(w??document,y,m);return m.checkVisibility(S,v)},{polling:h,root:a,timeout:l,signal:d},os.create(m=>m.puppeteerUtil),ji(this._querySelector),t,a,o?!0:u?!1:void 0),!1);if(d!=null&&d.aborted)throw d.reason;return ob in p?await i.mainRealm().transferHandle(p):null}catch(p){f.error=p,f.hasError=!0}finally{lb(f)}}catch(f){throw!Ts(f)||f.name==="AbortError"||(f.message=`Waiting for selector \`${t}\` failed: ${f.message}`),f}}catch(i){s.error=i,s.hasError=!0}finally{lb(s)}}}J(Aa,"querySelectorAll"),J(Aa,"querySelector");class gd{static async*map(e,t){for await(const r of e)yield await t(r)}static async*flatMap(e,t){for await(const r of e)yield*t(r)}static async collect(e){const t=[];for await(const r of e)t.push(r);return t}static async first(e){for await(const t of e)return t}}/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const Fz=n=>["name","role"].includes(n),Lz=/\[\s*(?<attribute>\w+)\s*=\s*(?<quote>"|')(?<value>\\.|.*?(?=\k<quote>))\k<quote>\s*\]/g,jz=n=>{if(n.length>1e4)throw new Error(`Selector ${n} is too long`);const e={},t=n.replace(Lz,(r,s,i,a)=>(ae(Fz(s),`Unknown aria attribute "${s}" in selector`),e[s]=a,""));return t&&!e.name&&(e.name=t),e},hw=class hw extends Aa{static async*queryAll(e,t){const{name:r,role:s}=jz(t);yield*e.queryAXTree(r,s)}};J(hw,"querySelector",async(e,t,{ariaQuerySelector:r})=>await r(e,t)),J(hw,"queryOne",async(e,t)=>await gd.first(hw.queryAll(e,t))??null);let au=hw;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class db extends Aa{}J(db,"querySelector",(e,t,{cssQuerySelector:r})=>r(e,t)),J(db,"querySelectorAll",(e,t,{cssQuerySelectorAll:r})=>r(e,t));const Dz='"use strict";var g=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var l=(t,e)=>{for(var r in e)g(t,r,{get:e[r],enumerable:!0})},J=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of B(e))!Y.call(t,n)&&n!==r&&g(t,n,{get:()=>e[n],enumerable:!(o=X(e,n))||o.enumerable});return t};var z=t=>J(g({},"__esModule",{value:!0}),t);var pe={};l(pe,{default:()=>he});module.exports=z(pe);var N=class extends Error{constructor(e,r){super(e,r),this.name=this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}},p=class extends N{};var c=class t{static create(e){return new t(e)}static async race(e){let r=new Set;try{let o=e.map(n=>n instanceof t?(n.#n&&r.add(n),n.valueOrThrow()):n);return await Promise.race(o)}finally{for(let o of r)o.reject(new Error("Timeout cleared"))}}#e=!1;#r=!1;#o;#t;#a=new Promise(e=>{this.#t=e});#n;#i;constructor(e){e&&e.timeout>0&&(this.#i=new p(e.message),this.#n=setTimeout(()=>{this.reject(this.#i)},e.timeout))}#l(e){clearTimeout(this.#n),this.#o=e,this.#t()}resolve(e){this.#r||this.#e||(this.#e=!0,this.#l(e))}reject(e){this.#r||this.#e||(this.#r=!0,this.#l(e))}resolved(){return this.#e}finished(){return this.#e||this.#r}value(){return this.#o}#s;valueOrThrow(){return this.#s||(this.#s=(async()=>{if(await this.#a,this.#r)throw this.#o;return this.#o})()),this.#s}};var L=new Map,F=t=>{let e=L.get(t);return e||(e=new Function(`return ${t}`)(),L.set(t,e),e)};var x={};l(x,{ariaQuerySelector:()=>G,ariaQuerySelectorAll:()=>b});var G=(t,e)=>globalThis.__ariaQuerySelector(t,e),b=async function*(t,e){yield*await globalThis.__ariaQuerySelectorAll(t,e)};var E={};l(E,{cssQuerySelector:()=>K,cssQuerySelectorAll:()=>Z});var K=(t,e)=>t.querySelector(e),Z=function(t,e){return t.querySelectorAll(e)};var A={};l(A,{customQuerySelectors:()=>P});var v=class{#e=new Map;register(e,r){if(!r.queryOne&&r.queryAll){let o=r.queryAll;r.queryOne=(n,i)=>{for(let s of o(n,i))return s;return null}}else if(r.queryOne&&!r.queryAll){let o=r.queryOne;r.queryAll=(n,i)=>{let s=o(n,i);return s?[s]:[]}}else if(!r.queryOne||!r.queryAll)throw new Error("At least one query method must be defined.");this.#e.set(e,{querySelector:r.queryOne,querySelectorAll:r.queryAll})}unregister(e){this.#e.delete(e)}get(e){return this.#e.get(e)}clear(){this.#e.clear()}},P=new v;var R={};l(R,{pierceQuerySelector:()=>ee,pierceQuerySelectorAll:()=>te});var ee=(t,e)=>{let r=null,o=n=>{let i=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT);do{let s=i.currentNode;s.shadowRoot&&o(s.shadowRoot),!(s instanceof ShadowRoot)&&s!==n&&!r&&s.matches(e)&&(r=s)}while(!r&&i.nextNode())};return t instanceof Document&&(t=t.documentElement),o(t),r},te=(t,e)=>{let r=[],o=n=>{let i=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT);do{let s=i.currentNode;s.shadowRoot&&o(s.shadowRoot),!(s instanceof ShadowRoot)&&s!==n&&s.matches(e)&&r.push(s)}while(i.nextNode())};return t instanceof Document&&(t=t.documentElement),o(t),r};var u=(t,e)=>{if(!t)throw new Error(e)};var y=class{#e;#r;#o;#t;constructor(e,r){this.#e=e,this.#r=r}async start(){let e=this.#t=c.create(),r=await this.#e();if(r){e.resolve(r);return}this.#o=new MutationObserver(async()=>{let o=await this.#e();o&&(e.resolve(o),await this.stop())}),this.#o.observe(this.#r,{childList:!0,subtree:!0,attributes:!0})}async stop(){u(this.#t,"Polling never started."),this.#t.finished()||this.#t.reject(new Error("Polling stopped")),this.#o&&(this.#o.disconnect(),this.#o=void 0)}result(){return u(this.#t,"Polling never started."),this.#t.valueOrThrow()}},w=class{#e;#r;constructor(e){this.#e=e}async start(){let e=this.#r=c.create(),r=await this.#e();if(r){e.resolve(r);return}let o=async()=>{if(e.finished())return;let n=await this.#e();if(!n){window.requestAnimationFrame(o);return}e.resolve(n),await this.stop()};window.requestAnimationFrame(o)}async stop(){u(this.#r,"Polling never started."),this.#r.finished()||this.#r.reject(new Error("Polling stopped"))}result(){return u(this.#r,"Polling never started."),this.#r.valueOrThrow()}},S=class{#e;#r;#o;#t;constructor(e,r){this.#e=e,this.#r=r}async start(){let e=this.#t=c.create(),r=await this.#e();if(r){e.resolve(r);return}this.#o=setInterval(async()=>{let o=await this.#e();o&&(e.resolve(o),await this.stop())},this.#r)}async stop(){u(this.#t,"Polling never started."),this.#t.finished()||this.#t.reject(new Error("Polling stopped")),this.#o&&(clearInterval(this.#o),this.#o=void 0)}result(){return u(this.#t,"Polling never started."),this.#t.valueOrThrow()}};var _={};l(_,{PCombinator:()=>H,pQuerySelector:()=>fe,pQuerySelectorAll:()=>$});var a=class{static async*map(e,r){for await(let o of e)yield await r(o)}static async*flatMap(e,r){for await(let o of e)yield*r(o)}static async collect(e){let r=[];for await(let o of e)r.push(o);return r}static async first(e){for await(let r of e)return r}};var C={};l(C,{textQuerySelectorAll:()=>m});var re=new Set(["checkbox","image","radio"]),oe=t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLInputElement&&!re.has(t.type),ne=new Set(["SCRIPT","STYLE"]),f=t=>!ne.has(t.nodeName)&&!document.head?.contains(t),I=new WeakMap,j=t=>{for(;t;)I.delete(t),t instanceof ShadowRoot?t=t.host:t=t.parentNode},W=new WeakSet,se=new MutationObserver(t=>{for(let e of t)j(e.target)}),d=t=>{let e=I.get(t);if(e||(e={full:"",immediate:[]},!f(t)))return e;let r="";if(oe(t))e.full=t.value,e.immediate.push(t.value),t.addEventListener("input",o=>{j(o.target)},{once:!0,capture:!0});else{for(let o=t.firstChild;o;o=o.nextSibling){if(o.nodeType===Node.TEXT_NODE){e.full+=o.nodeValue??"",r+=o.nodeValue??"";continue}r&&e.immediate.push(r),r="",o.nodeType===Node.ELEMENT_NODE&&(e.full+=d(o).full)}r&&e.immediate.push(r),t instanceof Element&&t.shadowRoot&&(e.full+=d(t.shadowRoot).full),W.has(t)||(se.observe(t,{childList:!0,characterData:!0,subtree:!0}),W.add(t))}return I.set(t,e),e};var m=function*(t,e){let r=!1;for(let o of t.childNodes)if(o instanceof Element&&f(o)){let n;o.shadowRoot?n=m(o.shadowRoot,e):n=m(o,e);for(let i of n)yield i,r=!0}r||t instanceof Element&&f(t)&&d(t).full.includes(e)&&(yield t)};var k={};l(k,{checkVisibility:()=>le,pierce:()=>T,pierceAll:()=>O});var ie=["hidden","collapse"],le=(t,e)=>{if(!t)return e===!1;if(e===void 0)return t;let r=t.nodeType===Node.TEXT_NODE?t.parentElement:t,o=window.getComputedStyle(r),n=o&&!ie.includes(o.visibility)&&!ae(r);return e===n?t:!1};function ae(t){let e=t.getBoundingClientRect();return e.width===0||e.height===0}var ce=t=>"shadowRoot"in t&&t.shadowRoot instanceof ShadowRoot;function*T(t){ce(t)?yield t.shadowRoot:yield t}function*O(t){t=T(t).next().value,yield t;let e=[document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT)];for(let r of e){let o;for(;o=r.nextNode();)o.shadowRoot&&(yield o.shadowRoot,e.push(document.createTreeWalker(o.shadowRoot,NodeFilter.SHOW_ELEMENT)))}}var Q={};l(Q,{xpathQuerySelectorAll:()=>q});var q=function*(t,e,r=-1){let n=(t.ownerDocument||document).evaluate(e,t,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE),i=[],s;for(;(s=n.iterateNext())&&(i.push(s),!(r&&i.length===r)););for(let h=0;h<i.length;h++)s=i[h],yield s,delete i[h]};var ue=/[-\\w\\P{ASCII}*]/u,H=(r=>(r.Descendent=">>>",r.Child=">>>>",r))(H||{}),V=t=>"querySelectorAll"in t,M=class{#e;#r=[];#o=void 0;elements;constructor(e,r){this.elements=[e],this.#e=r,this.#t()}async run(){if(typeof this.#o=="string")switch(this.#o.trimStart()){case":scope":this.#t();break}for(;this.#o!==void 0;this.#t()){let e=this.#o;typeof e=="string"?e[0]&&ue.test(e[0])?this.elements=a.flatMap(this.elements,async function*(r){V(r)&&(yield*r.querySelectorAll(e))}):this.elements=a.flatMap(this.elements,async function*(r){if(!r.parentElement){if(!V(r))return;yield*r.querySelectorAll(e);return}let o=0;for(let n of r.parentElement.children)if(++o,n===r)break;yield*r.parentElement.querySelectorAll(`:scope>:nth-child(${o})${e}`)}):this.elements=a.flatMap(this.elements,async function*(r){switch(e.name){case"text":yield*m(r,e.value);break;case"xpath":yield*q(r,e.value);break;case"aria":yield*b(r,e.value);break;default:let o=P.get(e.name);if(!o)throw new Error(`Unknown selector type: ${e.name}`);yield*o.querySelectorAll(r,e.value)}})}}#t(){if(this.#r.length!==0){this.#o=this.#r.shift();return}if(this.#e.length===0){this.#o=void 0;return}let e=this.#e.shift();switch(e){case">>>>":{this.elements=a.flatMap(this.elements,T),this.#t();break}case">>>":{this.elements=a.flatMap(this.elements,O),this.#t();break}default:this.#r=e,this.#t();break}}},D=class{#e=new WeakMap;calculate(e,r=[]){if(e===null)return r;e instanceof ShadowRoot&&(e=e.host);let o=this.#e.get(e);if(o)return[...o,...r];let n=0;for(let s=e.previousSibling;s;s=s.previousSibling)++n;let i=this.calculate(e.parentNode,[n]);return this.#e.set(e,i),[...i,...r]}},U=(t,e)=>{if(t.length+e.length===0)return 0;let[r=-1,...o]=t,[n=-1,...i]=e;return r===n?U(o,i):r<n?-1:1},de=async function*(t){let e=new Set;for await(let o of t)e.add(o);let r=new D;yield*[...e.values()].map(o=>[o,r.calculate(o)]).sort(([,o],[,n])=>U(o,n)).map(([o])=>o)},$=function(t,e){let r=JSON.parse(e);if(r.some(o=>{let n=0;return o.some(i=>(typeof i=="string"?++n:n=0,n>1))}))throw new Error("Multiple deep combinators found in sequence.");return de(a.flatMap(r,o=>{let n=new M(t,o);return n.run(),n.elements}))},fe=async function(t,e){for await(let r of $(t,e))return r;return null};var me=Object.freeze({...x,...A,...R,..._,...C,...k,...Q,...E,Deferred:c,createFunction:F,createTextContent:d,IntervalPoller:S,isSuitableNodeForTextMatching:f,MutationPoller:y,RAFPoller:w}),he=me;\n';/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class Bz{constructor(){_(this,Xu);_(this,rf,!1);_(this,nf,new Set)}append(e){A(this,Xu,pO).call(this,()=>{c(this,nf).add(e)})}pop(e){A(this,Xu,pO).call(this,()=>{c(this,nf).delete(e)})}inject(e,t=!1){(c(this,rf)||t)&&e(A(this,Xu,UH).call(this)),x(this,rf,!1)}}rf=new WeakMap,nf=new WeakMap,Xu=new WeakSet,pO=function(e){e(),x(this,rf,!0)},UH=function(){return`(() => {
      const module = {};
      ${Dz}
      ${[...c(this,nf)].map(e=>`(${e})(module.exports.default);`).join("")}
      return module.exports.default;
    })()`};const Wp=new Bz;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class Uz{constructor(){_(this,Pi,new Map)}get(e){const t=c(this,Pi).get(e);return t?t[1]:void 0}register(e,t){var i;ae(!c(this,Pi).has(e),`Cannot register over existing handler: ${e}`),ae(/^[a-zA-Z]+$/.test(e),"Custom query handler names may only contain [a-zA-Z]"),ae(t.queryAll||t.queryOne,"At least one query method must be implemented.");const r=(i=class extends Aa{},J(i,"querySelectorAll",md((a,o,u)=>u.customQuerySelectors.get(PLACEHOLDER("name")).querySelectorAll(a,o),{name:JSON.stringify(e)})),J(i,"querySelector",md((a,o,u)=>u.customQuerySelectors.get(PLACEHOLDER("name")).querySelector(a,o),{name:JSON.stringify(e)})),i),s=md(a=>{a.customQuerySelectors.register(PLACEHOLDER("name"),{queryAll:PLACEHOLDER("queryAll"),queryOne:PLACEHOLDER("queryOne")})},{name:JSON.stringify(e),queryAll:t.queryAll?ji(t.queryAll):String(void 0),queryOne:t.queryOne?ji(t.queryOne):String(void 0)}).toString();c(this,Pi).set(e,[s,r]),Wp.append(s)}unregister(e){const t=c(this,Pi).get(e);if(!t)throw new Error(`Cannot unregister unknown handler: ${e}`);Wp.pop(t[0]),c(this,Pi).delete(e)}names(){return[...c(this,Pi).keys()]}clear(){for(const[e]of c(this,Pi))Wp.pop(e);c(this,Pi).clear()}}Pi=new WeakMap;const uk=new Uz;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class lk extends Aa{}J(lk,"querySelector",(e,t,{pierceQuerySelector:r})=>r(e,t)),J(lk,"querySelectorAll",(e,t,{pierceQuerySelectorAll:r})=>r(e,t));/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class dk extends Aa{}J(dk,"querySelectorAll",(e,t,{pQuerySelectorAll:r})=>r(e,t)),J(dk,"querySelector",(e,t,{pQuerySelector:r})=>r(e,t));var yd={attribute:/\[\s*(?:(?<namespace>\*|[-\w\P{ASCII}]*)\|)?(?<name>[-\w\P{ASCII}]+)\s*(?:(?<operator>\W?=)\s*(?<value>.+?)\s*(\s(?<caseSensitive>[iIsS]))?\s*)?\]/gu,id:/#(?<name>[-\w\P{ASCII}]+)/gu,class:/\.(?<name>[-\w\P{ASCII}]+)/gu,comma:/\s*,\s*/g,combinator:/\s*[\s>+~]\s*/g,"pseudo-element":/::(?<name>[-\w\P{ASCII}]+)(?:\((?<argument>*)\))?/gu,"pseudo-class":/:(?<name>[-\w\P{ASCII}]+)(?:\((?<argument>*)\))?/gu,universal:/(?:(?<namespace>\*|[-\w\P{ASCII}]*)\|)?\*/gu,type:/(?:(?<namespace>\*|[-\w\P{ASCII}]*)\|)?(?<name>[-\w\P{ASCII}]+)/gu},qz=new Set(["combinator","comma"]),Hz=n=>{switch(n){case"pseudo-element":case"pseudo-class":return new RegExp(yd[n].source.replace("(?<argument>*)","(?<argument>.*)"),"gu");default:return yd[n]}};function Kz(n,e){let t=0,r="";for(;e<n.length;e++){const s=n[e];switch(s){case"(":++t;break;case")":--t;break}if(r+=s,t===0)return r}return r}function Wz(n,e=yd){if(!n)return[];const t=[n];for(const[s,i]of Object.entries(e))for(let a=0;a<t.length;a++){const o=t[a];if(typeof o!="string")continue;i.lastIndex=0;const u=i.exec(o);if(!u)continue;const l=u.index-1,d=[],h=u[0],f=o.slice(0,l+1);f&&d.push(f),d.push({...u.groups,type:s,content:h});const p=o.slice(l+h.length+1);p&&d.push(p),t.splice(a,1,...d)}let r=0;for(const s of t)switch(typeof s){case"string":throw new Error(`Unexpected sequence ${s} found at index ${r}`);case"object":r+=s.content.length,s.pos=[r-s.content.length,r],qz.has(s.type)&&(s.content=s.content.trim()||" ");break}return t}var zz=/(['"])([^\\\n]+?)\1/g,Vz=/\\./g;function Gz(n,e=yd){if(n=n.trim(),n==="")return[];const t=[];n=n.replace(Vz,(i,a)=>(t.push({value:i,offset:a}),"".repeat(i.length))),n=n.replace(zz,(i,a,o,u)=>(t.push({value:i,offset:u}),`${a}${"".repeat(o.length)}${a}`));{let i=0,a;for(;(a=n.indexOf("(",i))>-1;){const o=Kz(n,a);t.push({value:o,offset:a}),n=`${n.substring(0,a)}(${"".repeat(o.length-2)})${n.substring(a+o.length)}`,i=a+o.length}}const r=Wz(n,e),s=new Set;for(const i of t.reverse())for(const a of r){const{offset:o,value:u}=i;if(!(a.pos[0]<=o&&o+u.length<=a.pos[1]))continue;const{content:l}=a,d=o-a.pos[0];a.content=l.slice(0,d)+u+l.slice(d+u.length),a.content!==l&&s.add(a)}for(const i of s){const a=Hz(i.type);if(!a)throw new Error(`Unknown token type: ${i.type}`);a.lastIndex=0;const o=a.exec(i.content);if(!o)throw new Error(`Unable to parse content for ${i.type}: ${i.content}`);Object.assign(i,o.groups)}return r}function Di(n){if(Array.isArray(n))return n.map(e=>e.content).join("");switch(n.type){case"list":return n.list.map(Di).join(",");case"relative":return n.combinator+Di(n.right);case"complex":return Di(n.left)+n.combinator+Di(n.right);case"compound":return n.list.map(Di).join("");default:return n.content}}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */yd.nesting=/&/g,yd.combinator=/\s*(>>>>?|[\s>+~])\s*/g;const Zz=/\\[\s\S]/g,Jz=n=>n.length<=1?n:((n[0]==='"'||n[0]==="'")&&n.endsWith(n[0])&&(n=n.slice(1,-1)),n.replace(Zz,e=>e[1]));function Xz(n){let e=!0,t=!1,r=!1;const s=Gz(n);if(s.length===0)return[[],e,r,!1];let i=[],a=[i];const o=[a],u=[];for(const l of s){switch(l.type){case"combinator":switch(l.content){case">>>":e=!1,u.length&&(i.push(Di(u)),u.splice(0)),i=[],a.push(">>>"),a.push(i);continue;case">>>>":e=!1,u.length&&(i.push(Di(u)),u.splice(0)),i=[],a.push(">>>>"),a.push(i);continue}break;case"pseudo-element":if(!l.name.startsWith("-p-"))break;e=!1,u.length&&(i.push(Di(u)),u.splice(0));const d=l.name.slice(3);d==="aria"&&(t=!0),i.push({name:d,value:Jz(l.argument??"")});continue;case"pseudo-class":r=!0;break;case"comma":u.length&&(i.push(Di(u)),u.splice(0)),i=[],a=[i],o.push(a);continue}u.push(l)}return u.length&&i.push(Di(u)),[o,e,r,t]}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class o$ extends Aa{}J(o$,"querySelectorAll",(e,t,{textQuerySelectorAll:r})=>r(e,t));/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class hk extends Aa{}J(hk,"querySelectorAll",(e,t,{xpathQuerySelectorAll:r})=>r(e,t)),J(hk,"querySelector",(e,t,{xpathQuerySelectorAll:r})=>{for(const s of r(e,t,1))return s;return null});/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const Yz={aria:au,pierce:lk,xpath:hk,text:o$},Qz=["=","/"];function hb(n){for(const e of[uk.names().map(t=>[t,uk.get(t)]),Object.entries(Yz)])for(const[t,r]of e)for(const s of Qz){const i=`${t}${s}`;if(n.startsWith(i))return n=n.slice(i.length),{updatedSelector:n,polling:t==="aria"?"raf":"mutation",QueryHandler:r}}try{const[e,t,r,s]=Xz(n);return t?{updatedSelector:n,polling:r?"raf":"mutation",QueryHandler:db}:{updatedSelector:JSON.stringify(e),polling:s?"raf":"mutation",QueryHandler:dk}}catch{return{updatedSelector:n,polling:"mutation",QueryHandler:db}}}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var eV=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},tV=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});const zp=new WeakSet;function rV(n,e){let t=!1;if(n.prototype[je]){const r=n.prototype[je];n.prototype[je]=function(){if(zp.has(this)){zp.delete(this);return}return r.call(this)},t=!0}if(n.prototype[Gs]){const r=n.prototype[Gs];n.prototype[Gs]=function(){if(zp.has(this)){zp.delete(this);return}return r.call(this)},t=!0}return t&&(n.prototype.move=function(){return zp.add(this),this}),n}function le(n=e=>`Attempted to use disposed ${e.constructor.name}.`){return(e,t)=>function(...r){if(this.disposed)throw new Error(n(this));return e.call(this,...r)}}function Ro(n,e){return function(...t){if(!this.disposed)return n.call(this,...t)}}function Js(n,e){const t=new WeakMap;let r=-1;return function(...s){if(r===-1&&(r=s.length),r!==s.length)throw new Error("Memoized method was called with the wrong number of arguments");let i=!1,a=t;for(const o of s)a.has(o)||(i=!0,a.set(o,new WeakMap)),a=a.get(o);if(i)return n.call(this,...s)}}function nV(n=function(){return this}){return(e,t)=>{const r=new WeakMap;return async function(...s){const i={stack:[],error:void 0,hasError:!1};try{const a=n.call(this);let o=r.get(a);o||(o=new ok,r.set(a,o));const u=eV(i,await o.acquire(),!0);return await e.call(this,...s)}catch(a){i.error=a,i.hasError=!0}finally{const a=tV(i);a&&await a}}}}const fb=new WeakMap,c$=function(n){const e=fb.get(this)??new Map;if(e.has(n))return;const t=n!==void 0?(r,s)=>{n.includes(r)&&this.emit(r,s)}:(r,s)=>{this.emit(r,s)};e.set(n,t),fb.set(this,e)};function pb(n){return({set:e,get:t},r)=>(r.addInitializer(function(){return c$.apply(this,[n])}),{set(s){const i=fb.get(this).get(n),a=t.call(this);a!==void 0&&a.off("*",i),s!==void 0&&(s.on("*",i),e.call(this,s))},init(s){if(s===void 0)return s;c$.apply(this,[n]);const i=fb.get(this).get(n);return s.on("*",i),s}})}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var u$=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},fk=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},sV=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},iV=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});let ou=(()=>{var o;let n=[rV],e,t=[],r,s=[],i,a;return o=class{constructor(){u$(this,s)}async evaluate(l,...d){return l=Mr(this.evaluate.name,l),await this.realm.evaluate(l,this,...d)}async evaluateHandle(l,...d){return l=Mr(this.evaluateHandle.name,l),await this.realm.evaluateHandle(l,this,...d)}async getProperty(l){return await this.evaluateHandle((d,h)=>d[h],l)}async getProperties(){const l=await this.evaluate(f=>{var g;const p=[],m=Object.getOwnPropertyDescriptors(f);for(const y in m)(g=m[y])!=null&&g.enumerable&&p.push(y);return p}),d=new Map,h=await Promise.all(l.map(f=>this.getProperty(f)));for(const[f,p]of Object.entries(l)){const m={stack:[],error:void 0,hasError:!1};try{const g=sV(m,h[f],!1);g&&d.set(p,g.move())}catch(g){m.error=g,m.hasError=!0}finally{iV(m)}}return d}[(i=[le()],a=[le()],je)](){return void this.dispose().catch(Ee)}[Gs](){return this.dispose()}},r=o,(()=>{const l=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;fk(o,null,i,{kind:"method",name:"getProperty",static:!1,private:!1,access:{has:d=>"getProperty"in d,get:d=>d.getProperty},metadata:l},null,s),fk(o,null,a,{kind:"method",name:"getProperties",static:!1,private:!1,access:{has:d=>"getProperties"in d,get:d=>d.getProperties},metadata:l},null,s),fk(null,e={value:r},n,{kind:"class",name:r.name,metadata:l},null,t),r=e.value,l&&Object.defineProperty(r,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),u$(r,t)})(),r})();/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var aV=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},St=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},Vp=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},Gp=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r}),oV=function(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})};function mt(n,e){return async function(...t){if(this.realm===this.frame.isolatedRealm())return await n.call(this,...t);let r;this.isolatedHandle?r=this.isolatedHandle:this.isolatedHandle=r=await this.frame.isolatedRealm().adoptHandle(this);const s=await n.call(r,...t);return s===r?this:s instanceof ou?await this.realm.transferHandle(s):(Array.isArray(s)&&await Promise.all(s.map(async(i,a,o)=>{i instanceof ou&&(o[a]=await this.realm.transferHandle(i))})),s instanceof Map&&await Promise.all([...s.entries()].map(async([i,a])=>{a instanceof ou&&s.set(i,await this.realm.transferHandle(a))})),s)}}let l$=(()=>{var F,mO,gO,yO,qH,wO,vO,HH,KH,WH,he;let n=ou,e=[],t,r,s,i,a,o,u,l,d,h,f,p,m,g,y,w,v,b,S,P,k,C,E,M,I,N,O,T,L,U,Z,j;return he=class extends n{constructor(R){super();_(this,F);J(this,"isolatedHandle",aV(this,e));J(this,"handle");this.handle=R,this[ob]=!0}get id(){return this.handle.id}get disposed(){return this.handle.disposed}async getProperty(R){return await this.handle.getProperty(R)}async getProperties(){return await this.handle.getProperties()}async evaluate(R,...$){return R=Mr(this.evaluate.name,R),await this.handle.evaluate(R,...$)}async evaluateHandle(R,...$){return R=Mr(this.evaluateHandle.name,R),await this.handle.evaluateHandle(R,...$)}async jsonValue(){return await this.handle.jsonValue()}toString(){return this.handle.toString()}remoteObject(){return this.handle.remoteObject()}async dispose(){var R;await Promise.all([this.handle.dispose(),(R=this.isolatedHandle)==null?void 0:R.dispose()])}asElement(){return this}async $(R){const{updatedSelector:$,QueryHandler:H}=hb(R);return await H.queryOne(this,$)}async $$(R,$){return($==null?void 0:$.isolate)===!1?await A(this,F,gO).call(this,R):await c(this,F,mO).call(this,R)}async $eval(R,$,...H){const V={stack:[],error:void 0,hasError:!1};try{$=Mr(this.$eval.name,$);const X=Vp(V,await this.$(R),!1);if(!X)throw new Error(`Error: failed to find element matching selector "${R}"`);return await X.evaluate($,...H)}catch(X){V.error=X,V.hasError=!0}finally{Gp(V)}}async $$eval(R,$,...H){const V={stack:[],error:void 0,hasError:!1};try{$=Mr(this.$$eval.name,$);const X=await this.$$(R),ne=Vp(V,await this.evaluateHandle((Le,...de)=>de,...X),!1),[ce]=await Promise.all([ne.evaluate($,...H),...X.map(Le=>Le.dispose())]);return ce}catch(X){V.error=X,V.hasError=!0}finally{Gp(V)}}async waitForSelector(R,$={}){const{updatedSelector:H,QueryHandler:V,polling:X}=hb(R);return await V.waitFor(this,H,{polling:X,...$})}async isVisible(){return await A(this,F,yO).call(this,!0)}async isHidden(){return await A(this,F,yO).call(this,!1)}async toElement(R){if(!await this.evaluate((H,V)=>H.nodeName===V.toUpperCase(),R))throw new Error(`Element is not a(n) \`${R}\` element`);return this}async clickablePoint(R){const $=await A(this,F,qH).call(this);if(!$)throw new Error("Node is either not clickable or not an Element");return R!==void 0?{x:$.x+R.x,y:$.y+R.y}:{x:$.x+$.width/2,y:$.y+$.height/2}}async hover(){await this.scrollIntoViewIfNeeded();const{x:R,y:$}=await this.clickablePoint();await this.frame.page().mouse.move(R,$)}async click(R={}){await this.scrollIntoViewIfNeeded();const{x:$,y:H}=await this.clickablePoint(R.offset);await this.frame.page().mouse.click($,H,R)}async drag(R){await this.scrollIntoViewIfNeeded();const $=this.frame.page();if($.isDragInterceptionEnabled()){const H=await this.clickablePoint();return R instanceof he&&(R=await R.clickablePoint()),await $.mouse.drag(H,R)}try{$._isDragging||($._isDragging=!0,await this.hover(),await $.mouse.down()),R instanceof he?await R.hover():await $.mouse.move(R.x,R.y)}catch(H){throw $._isDragging=!1,H}}async dragEnter(R={items:[],dragOperationsMask:1}){const $=this.frame.page();await this.scrollIntoViewIfNeeded();const H=await this.clickablePoint();await $.mouse.dragEnter(H,R)}async dragOver(R={items:[],dragOperationsMask:1}){const $=this.frame.page();await this.scrollIntoViewIfNeeded();const H=await this.clickablePoint();await $.mouse.dragOver(H,R)}async drop(R={items:[],dragOperationsMask:1}){const $=this.frame.page();if("items"in R){await this.scrollIntoViewIfNeeded();const H=await this.clickablePoint();await $.mouse.drop(H,R)}else await R.drag(this),$._isDragging=!1,await $.mouse.up()}async dragAndDrop(R,$){const H=this.frame.page();ae(H.isDragInterceptionEnabled(),"Drag Interception is not enabled!"),await this.scrollIntoViewIfNeeded();const V=await this.clickablePoint(),X=await R.clickablePoint();await H.mouse.dragAndDrop(V,X,$)}async select(...R){for(const $ of R)ae(Pa($),'Values must be strings. Found value "'+$+'" of type "'+typeof $+'"');return await this.evaluate(($,H)=>{const V=new Set(H);if(!($ instanceof HTMLSelectElement))throw new Error("Element is not a <select> element.");const X=new Set;if($.multiple)for(const ne of $.options)ne.selected=V.has(ne.value),ne.selected&&X.add(ne.value);else{for(const ne of $.options)ne.selected=!1;for(const ne of $.options)if(V.has(ne.value)){ne.selected=!0,X.add(ne.value);break}}return $.dispatchEvent(new Event("input",{bubbles:!0})),$.dispatchEvent(new Event("change",{bubbles:!0})),[...X.values()]},R)}async tap(){await this.scrollIntoViewIfNeeded();const{x:R,y:$}=await this.clickablePoint();await this.frame.page().touchscreen.tap(R,$)}async touchStart(){await this.scrollIntoViewIfNeeded();const{x:R,y:$}=await this.clickablePoint();return await this.frame.page().touchscreen.touchStart(R,$)}async touchMove(R){await this.scrollIntoViewIfNeeded();const{x:$,y:H}=await this.clickablePoint();if(R)return await R.move($,H);await this.frame.page().touchscreen.touchMove($,H)}async touchEnd(){await this.scrollIntoViewIfNeeded(),await this.frame.page().touchscreen.touchEnd()}async focus(){await this.evaluate(R=>{if(!(R instanceof HTMLElement))throw new Error("Cannot focus non-HTMLElement");return R.focus()})}async type(R,$){await this.focus(),await this.frame.page().keyboard.type(R,$)}async press(R,$){await this.focus(),await this.frame.page().keyboard.press(R,$)}async boundingBox(){const R=await this.evaluate(H=>{if(!(H instanceof Element)||H.getClientRects().length===0)return null;const V=H.getBoundingClientRect();return{x:V.x,y:V.y,width:V.width,height:V.height}});if(!R)return null;const $=await A(this,F,vO).call(this);return $?{x:R.x+$.x,y:R.y+$.y,height:R.height,width:R.width}:null}async boxModel(){const R=await this.evaluate(H=>{if(!(H instanceof Element)||H.getClientRects().length===0)return null;const V=H.getBoundingClientRect(),X=window.getComputedStyle(H),ne={padding:{left:parseInt(X.paddingLeft,10),top:parseInt(X.paddingTop,10),right:parseInt(X.paddingRight,10),bottom:parseInt(X.paddingBottom,10)},margin:{left:-parseInt(X.marginLeft,10),top:-parseInt(X.marginTop,10),right:-parseInt(X.marginRight,10),bottom:-parseInt(X.marginBottom,10)},border:{left:parseInt(X.borderLeft,10),top:parseInt(X.borderTop,10),right:parseInt(X.borderRight,10),bottom:parseInt(X.borderBottom,10)}},ce=[{x:V.left,y:V.top},{x:V.left+V.width,y:V.top},{x:V.left+V.width,y:V.top+V.height},{x:V.left,y:V.top+V.height}],Le=Pe(ce,ne.border),de=Pe(Le,ne.padding),De=Pe(ce,ne.margin);return{content:de,padding:Le,border:ce,margin:De,width:V.width,height:V.height};function Pe(z,re){return[{x:z[0].x+re.left,y:z[0].y+re.top},{x:z[1].x-re.right,y:z[1].y+re.top},{x:z[2].x-re.right,y:z[2].y-re.bottom},{x:z[3].x+re.left,y:z[3].y-re.bottom}]}});if(!R)return null;const $=await A(this,F,vO).call(this);if(!$)return null;for(const H of["content","padding","border","margin"])for(const V of R[H])V.x+=$.x,V.y+=$.y;return R}async screenshot(R={}){const{scrollIntoView:$=!0,clip:H}=R,V=this.frame.page();$&&await this.scrollIntoViewIfNeeded();const X=await A(this,F,HH).call(this),[ne,ce]=await this.evaluate(()=>{if(!window.visualViewport)throw new Error("window.visualViewport is not supported.");return[window.visualViewport.pageLeft,window.visualViewport.pageTop]});return X.x+=ne,X.y+=ce,H&&(X.x+=H.x,X.y+=H.y,X.height=H.height,X.width=H.width),await V.screenshot({...R,clip:X})}async assertConnectedElement(){const R=await this.evaluate(async $=>{if(!$.isConnected)return"Node is detached from document";if($.nodeType!==Node.ELEMENT_NODE)return"Node is not of type HTMLElement"});if(R)throw new Error(R)}async scrollIntoViewIfNeeded(){await this.isIntersectingViewport({threshold:1})||await this.scrollIntoView()}async isIntersectingViewport(R={}){var H;const $={stack:[],error:void 0,hasError:!1};try{await this.assertConnectedElement();const V=await A(this,F,KH).call(this);return await(Vp($,V&&await A(H=V,F,WH).call(H),!1)??this).evaluate(async(ne,ce)=>{const Le=await new Promise(de=>{const De=new IntersectionObserver(Pe=>{de(Pe[0].intersectionRatio),De.disconnect()});De.observe(ne)});return ce===1?Le===1:Le>ce},R.threshold??0)}catch(V){$.error=V,$.hasError=!0}finally{Gp($)}}async scrollIntoView(){await this.assertConnectedElement(),await this.evaluate(async R=>{R.scrollIntoView({block:"center",inline:"center",behavior:"instant"})})}},F=new WeakSet,mO=function(){return u.value},gO=async function(R){const{updatedSelector:$,QueryHandler:H}=hb(R);return await gd.collect(H.queryAll(this,$))},yO=async function(R){return await this.evaluate(async($,H,V)=>!!H.checkVisibility($,V),os.create($=>$.puppeteerUtil),R)},qH=async function(){var X;const R=await this.evaluate(ne=>ne instanceof Element?[...ne.getClientRects()].map(ce=>({x:ce.x,y:ce.y,width:ce.width,height:ce.height})):null);if(!(R!=null&&R.length))return null;await A(this,F,wO).call(this,R);let $=this.frame,H;for(;H=$==null?void 0:$.parentFrame();){const ne={stack:[],error:void 0,hasError:!1};try{const ce=Vp(ne,await $.frameElement(),!1);if(!ce)throw new Error("Unsupported frame type");const Le=await ce.evaluate(de=>{if(de.getClientRects().length===0)return null;const De=de.getBoundingClientRect(),Pe=window.getComputedStyle(de);return{left:De.left+parseInt(Pe.paddingLeft,10)+parseInt(Pe.borderLeftWidth,10),top:De.top+parseInt(Pe.paddingTop,10)+parseInt(Pe.borderTopWidth,10)}});if(!Le)return null;for(const de of R)de.x+=Le.left,de.y+=Le.top;await A(X=ce,F,wO).call(X,R),$=H}catch(ce){ne.error=ce,ne.hasError=!0}finally{Gp(ne)}}const V=R.find(ne=>ne.width>=1&&ne.height>=1);return V?{x:V.x,y:V.y,height:V.height,width:V.width}:null},wO=async function(R){const{documentWidth:$,documentHeight:H}=await this.frame.isolatedRealm().evaluate(()=>({documentWidth:document.documentElement.clientWidth,documentHeight:document.documentElement.clientHeight}));for(const V of R)cV(V,$,H)},vO=async function(){const R={x:0,y:0};let $=this.frame,H;for(;H=$==null?void 0:$.parentFrame();){const V={stack:[],error:void 0,hasError:!1};try{const X=Vp(V,await $.frameElement(),!1);if(!X)throw new Error("Unsupported frame type");const ne=await X.evaluate(ce=>{if(ce.getClientRects().length===0)return null;const Le=ce.getBoundingClientRect(),de=window.getComputedStyle(ce);return{left:Le.left+parseInt(de.paddingLeft,10)+parseInt(de.borderLeftWidth,10),top:Le.top+parseInt(de.paddingTop,10)+parseInt(de.borderTopWidth,10)}});if(!ne)return null;R.x+=ne.left,R.y+=ne.top,$=H}catch(X){V.error=X,V.hasError=!0}finally{Gp(V)}}return R},HH=async function(){const R=await this.boundingBox();return ae(R,"Node is either not visible or not an HTMLElement"),ae(R.width!==0,"Node has 0 width."),ae(R.height!==0,"Node has 0 height."),R},KH=async function(){return await this.evaluate(R=>R instanceof SVGElement)?this:null},WH=async function(){return await this.evaluateHandle(R=>R instanceof SVGSVGElement?R:R.ownerSVGElement)},(()=>{const R=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[le(),mt],r=[le(),mt],s=[le(),mt],i=[le(),mt],a=[le()],o=[mt],l=[le(),mt],d=[le(),mt],h=[le(),mt],f=[le(),mt],p=[le(),mt],m=[le(),mt],g=[le(),mt],y=[le(),mt],w=[le(),mt],v=[le(),mt],b=[le(),mt],S=[le(),mt],P=[le(),mt],k=[le(),mt],C=[le(),mt],E=[le(),mt],M=[le(),mt],I=[le(),mt],N=[le(),mt],O=[le(),mt],T=[le(),mt],L=[le(),mt],U=[le(),mt],Z=[le(),mt],j=[le(),mt],St(he,null,t,{kind:"method",name:"getProperty",static:!1,private:!1,access:{has:$=>"getProperty"in $,get:$=>$.getProperty},metadata:R},null,e),St(he,null,r,{kind:"method",name:"getProperties",static:!1,private:!1,access:{has:$=>"getProperties"in $,get:$=>$.getProperties},metadata:R},null,e),St(he,null,s,{kind:"method",name:"jsonValue",static:!1,private:!1,access:{has:$=>"jsonValue"in $,get:$=>$.jsonValue},metadata:R},null,e),St(he,null,i,{kind:"method",name:"$",static:!1,private:!1,access:{has:$=>"$"in $,get:$=>$.$},metadata:R},null,e),St(he,null,a,{kind:"method",name:"$$",static:!1,private:!1,access:{has:$=>"$$"in $,get:$=>$.$$},metadata:R},null,e),St(he,u={value:oV(async function($){return await A(this,F,gO).call(this,$)},"#$$")},o,{kind:"method",name:"#$$",static:!1,private:!0,access:{has:$=>Nn(F,$),get:$=>c($,F,mO)},metadata:R},null,e),St(he,null,l,{kind:"method",name:"waitForSelector",static:!1,private:!1,access:{has:$=>"waitForSelector"in $,get:$=>$.waitForSelector},metadata:R},null,e),St(he,null,d,{kind:"method",name:"isVisible",static:!1,private:!1,access:{has:$=>"isVisible"in $,get:$=>$.isVisible},metadata:R},null,e),St(he,null,h,{kind:"method",name:"isHidden",static:!1,private:!1,access:{has:$=>"isHidden"in $,get:$=>$.isHidden},metadata:R},null,e),St(he,null,f,{kind:"method",name:"toElement",static:!1,private:!1,access:{has:$=>"toElement"in $,get:$=>$.toElement},metadata:R},null,e),St(he,null,p,{kind:"method",name:"clickablePoint",static:!1,private:!1,access:{has:$=>"clickablePoint"in $,get:$=>$.clickablePoint},metadata:R},null,e),St(he,null,m,{kind:"method",name:"hover",static:!1,private:!1,access:{has:$=>"hover"in $,get:$=>$.hover},metadata:R},null,e),St(he,null,g,{kind:"method",name:"click",static:!1,private:!1,access:{has:$=>"click"in $,get:$=>$.click},metadata:R},null,e),St(he,null,y,{kind:"method",name:"drag",static:!1,private:!1,access:{has:$=>"drag"in $,get:$=>$.drag},metadata:R},null,e),St(he,null,w,{kind:"method",name:"dragEnter",static:!1,private:!1,access:{has:$=>"dragEnter"in $,get:$=>$.dragEnter},metadata:R},null,e),St(he,null,v,{kind:"method",name:"dragOver",static:!1,private:!1,access:{has:$=>"dragOver"in $,get:$=>$.dragOver},metadata:R},null,e),St(he,null,b,{kind:"method",name:"drop",static:!1,private:!1,access:{has:$=>"drop"in $,get:$=>$.drop},metadata:R},null,e),St(he,null,S,{kind:"method",name:"dragAndDrop",static:!1,private:!1,access:{has:$=>"dragAndDrop"in $,get:$=>$.dragAndDrop},metadata:R},null,e),St(he,null,P,{kind:"method",name:"select",static:!1,private:!1,access:{has:$=>"select"in $,get:$=>$.select},metadata:R},null,e),St(he,null,k,{kind:"method",name:"tap",static:!1,private:!1,access:{has:$=>"tap"in $,get:$=>$.tap},metadata:R},null,e),St(he,null,C,{kind:"method",name:"touchStart",static:!1,private:!1,access:{has:$=>"touchStart"in $,get:$=>$.touchStart},metadata:R},null,e),St(he,null,E,{kind:"method",name:"touchMove",static:!1,private:!1,access:{has:$=>"touchMove"in $,get:$=>$.touchMove},metadata:R},null,e),St(he,null,M,{kind:"method",name:"touchEnd",static:!1,private:!1,access:{has:$=>"touchEnd"in $,get:$=>$.touchEnd},metadata:R},null,e),St(he,null,I,{kind:"method",name:"focus",static:!1,private:!1,access:{has:$=>"focus"in $,get:$=>$.focus},metadata:R},null,e),St(he,null,N,{kind:"method",name:"type",static:!1,private:!1,access:{has:$=>"type"in $,get:$=>$.type},metadata:R},null,e),St(he,null,O,{kind:"method",name:"press",static:!1,private:!1,access:{has:$=>"press"in $,get:$=>$.press},metadata:R},null,e),St(he,null,T,{kind:"method",name:"boundingBox",static:!1,private:!1,access:{has:$=>"boundingBox"in $,get:$=>$.boundingBox},metadata:R},null,e),St(he,null,L,{kind:"method",name:"boxModel",static:!1,private:!1,access:{has:$=>"boxModel"in $,get:$=>$.boxModel},metadata:R},null,e),St(he,null,U,{kind:"method",name:"screenshot",static:!1,private:!1,access:{has:$=>"screenshot"in $,get:$=>$.screenshot},metadata:R},null,e),St(he,null,Z,{kind:"method",name:"isIntersectingViewport",static:!1,private:!1,access:{has:$=>"isIntersectingViewport"in $,get:$=>$.isIntersectingViewport},metadata:R},null,e),St(he,null,j,{kind:"method",name:"scrollIntoView",static:!1,private:!1,access:{has:$=>"scrollIntoView"in $,get:$=>$.scrollIntoView},metadata:R},null,e),R&&Object.defineProperty(he,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:R})})(),he})();function cV(n,e,t){n.width=Math.max(n.x>=0?Math.min(e-n.x,n.width):Math.min(e,n.width+n.x),0),n.height=Math.max(n.y>=0?Math.min(t-n.y,n.height):Math.min(t,n.height+n.y),0)}var uV=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},lV=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r}),wd;(function(n){n.Action="action"})(wd||(wd={}));class vd extends Ae{constructor(){super(...arguments);_(this,la);J(this,"visibility",null);J(this,"_timeout",3e4);_(this,Yu,!0);_(this,Qu,!0);_(this,el,!0);J(this,"operators",{conditions:(t,r)=>Rr(s=>Up(...t.map(i=>i(s,r))).pipe(qM(s))),retryAndRaceWithSignalAndTimer:(t,r)=>{const s=[];return t&&s.push(iu(t,r)),s.push(Fn(this._timeout,r)),SW(Y_({delay:vb}),Vr(...s))}});_(this,fw,(t,r)=>c(this,Qu)?pt(t.frame.waitForFunction(s=>s instanceof HTMLElement?!["BUTTON","INPUT","SELECT","TEXTAREA","OPTION","OPTGROUP"].includes(s.nodeName)||!s.hasAttribute("disabled"):!0,{timeout:this._timeout,signal:r},t)).pipe(J_()):tu);_(this,tl,t=>c(this,el)?ru(()=>pt(t.evaluate(r=>new Promise(s=>{window.requestAnimationFrame(()=>{const i=r.getBoundingClientRect();window.requestAnimationFrame(()=>{const a=r.getBoundingClientRect();s([{x:i.x,y:i.y,width:i.width,height:i.height},{x:a.x,y:a.y,width:a.width,height:a.height}])})})})))).pipe(hd(([r,s])=>r.x===s.x&&r.y===s.y&&r.width===s.width&&r.height===s.height),Y_({delay:vb}),J_()):tu);_(this,rl,t=>c(this,Yu)?pt(t.isIntersectingViewport({threshold:0})).pipe(nu(r=>!r),Rr(()=>pt(t.scrollIntoView())),Rr(()=>ru(()=>pt(t.isIntersectingViewport({threshold:0}))).pipe(hd(Fi),Y_({delay:vb}),J_()))):tu)}static race(t){return pk.create(t)}get timeout(){return this._timeout}setTimeout(t){const r=this._clone();return r._timeout=t,r}setVisibility(t){const r=this._clone();return r.visibility=t,r}setWaitForEnabled(t){const r=this._clone();return x(r,Qu,t),r}setEnsureElementIsInTheViewport(t){const r=this._clone();return x(r,Yu,t),r}setWaitForStableBoundingBox(t){const r=this._clone();return x(r,el,t),r}copyOptions(t){return this._timeout=t._timeout,this.visibility=t.visibility,x(this,Qu,c(t,Qu)),x(this,Yu,c(t,Yu)),x(this,el,c(t,el)),this}clone(){return this._clone()}async waitHandle(t){const r=new Error("Locator.waitHandle");return await Or(this._wait(t).pipe(this.operators.retryAndRaceWithSignalAndTimer(t==null?void 0:t.signal,r)))}async wait(t){const r={stack:[],error:void 0,hasError:!1};try{return await uV(r,await this.waitHandle(t),!1).jsonValue()}catch(s){r.error=s,r.hasError=!0}finally{lV(r)}}map(t){return new yb(this._clone(),r=>r.evaluateHandle(t))}filter(t){return new gb(this._clone(),async(r,s)=>(await r.frame.waitForFunction(t,{signal:s,timeout:this._timeout},r),!0))}filterHandle(t){return new gb(this._clone(),t)}mapHandle(t){return new yb(this._clone(),t)}click(t){return Or(A(this,la,zH).call(this,t))}fill(t,r){return Or(A(this,la,VH).call(this,t,r))}hover(t){return Or(A(this,la,GH).call(this,t))}scroll(t){return Or(A(this,la,ZH).call(this,t))}}Yu=new WeakMap,Qu=new WeakMap,el=new WeakMap,fw=new WeakMap,tl=new WeakMap,rl=new WeakMap,la=new WeakSet,zH=function(t){const r=t==null?void 0:t.signal,s=new Error("Locator.click");return this._wait(t).pipe(this.operators.conditions([c(this,rl),c(this,tl),c(this,fw)],r),eb(()=>this.emit(wd.Action,void 0)),Rr(i=>pt(i.click(t)).pipe(qp(a=>{throw i.dispose().catch(Ee),a}))),this.operators.retryAndRaceWithSignalAndTimer(r,s))},VH=function(t,r){const s=r==null?void 0:r.signal,i=new Error("Locator.fill");return this._wait(r).pipe(this.operators.conditions([c(this,rl),c(this,tl),c(this,fw)],s),eb(()=>this.emit(wd.Action,void 0)),Rr(a=>pt(a.evaluate(o=>o instanceof HTMLSelectElement?"select":o instanceof HTMLTextAreaElement?"typeable-input":o instanceof HTMLInputElement?new Set(["textarea","text","url","tel","search","password","number","email"]).has(o.type)?"typeable-input":"other-input":o.isContentEditable?"contenteditable":"unknown")).pipe(Rr(o=>{switch(o){case"select":return pt(a.select(t).then(dd));case"contenteditable":case"typeable-input":return pt(a.evaluate((u,l)=>{const d=u.isContentEditable?u.innerText:u.value;if(l.length<=d.length||!l.startsWith(u.value))return u.isContentEditable?u.innerText="":u.value="",l;const h=u.isContentEditable?u.innerText:u.value;return u.isContentEditable?(u.innerText="",u.innerText=h):(u.value="",u.value=h),l.substring(h.length)},t)).pipe(Rr(u=>pt(a.type(u))));case"other-input":return pt(a.focus()).pipe(Rr(()=>pt(a.evaluate((u,l)=>{u.value=l,u.dispatchEvent(new Event("input",{bubbles:!0})),u.dispatchEvent(new Event("change",{bubbles:!0}))},t))));case"unknown":throw new Error("Element cannot be filled out.")}})).pipe(qp(o=>{throw a.dispose().catch(Ee),o}))),this.operators.retryAndRaceWithSignalAndTimer(s,i))},GH=function(t){const r=t==null?void 0:t.signal,s=new Error("Locator.hover");return this._wait(t).pipe(this.operators.conditions([c(this,rl),c(this,tl)],r),eb(()=>this.emit(wd.Action,void 0)),Rr(i=>pt(i.hover()).pipe(qp(a=>{throw i.dispose().catch(Ee),a}))),this.operators.retryAndRaceWithSignalAndTimer(r,s))},ZH=function(t){const r=t==null?void 0:t.signal,s=new Error("Locator.scroll");return this._wait(t).pipe(this.operators.conditions([c(this,rl),c(this,tl)],r),eb(()=>this.emit(wd.Action,void 0)),Rr(i=>pt(i.evaluate((a,o,u)=>{o!==void 0&&(a.scrollTop=o),u!==void 0&&(a.scrollLeft=u)},t==null?void 0:t.scrollTop,t==null?void 0:t.scrollLeft)).pipe(qp(a=>{throw i.dispose().catch(Ee),a}))),this.operators.retryAndRaceWithSignalAndTimer(r,s))};const Dx=class Dx extends vd{constructor(t,r){super();_(this,sf);_(this,af);x(this,sf,t),x(this,af,r)}static create(t,r){return new Dx(t,r).setTimeout("getDefaultTimeout"in t?t.getDefaultTimeout():t.page().getDefaultTimeout())}_clone(){return new Dx(c(this,sf),c(this,af))}_wait(t){const r=t==null?void 0:t.signal;return ru(()=>pt(c(this,sf).waitForFunction(c(this,af),{timeout:this.timeout,signal:r}))).pipe(X_())}};sf=new WeakMap,af=new WeakMap;let mb=Dx;class d$ extends vd{constructor(t){super();_(this,gn);x(this,gn,t),this.copyOptions(c(this,gn))}get delegate(){return c(this,gn)}setTimeout(t){const r=super.setTimeout(t);return x(r,gn,c(this,gn).setTimeout(t)),r}setVisibility(t){const r=super.setVisibility(t);return x(r,gn,c(r,gn).setVisibility(t)),r}setWaitForEnabled(t){const r=super.setWaitForEnabled(t);return x(r,gn,c(this,gn).setWaitForEnabled(t)),r}setEnsureElementIsInTheViewport(t){const r=super.setEnsureElementIsInTheViewport(t);return x(r,gn,c(this,gn).setEnsureElementIsInTheViewport(t)),r}setWaitForStableBoundingBox(t){const r=super.setWaitForStableBoundingBox(t);return x(r,gn,c(this,gn).setWaitForStableBoundingBox(t)),r}}gn=new WeakMap;const ZI=class ZI extends d${constructor(t,r){super(t);_(this,of);x(this,of,r)}_clone(){return new ZI(this.delegate.clone(),c(this,of)).copyOptions(this)}_wait(t){return this.delegate._wait(t).pipe(Rr(r=>pt(Promise.resolve(c(this,of).call(this,r,t==null?void 0:t.signal))).pipe(nu(s=>s),ar(()=>r))),X_())}};of=new WeakMap;let gb=ZI;const JI=class JI extends d${constructor(t,r){super(t);_(this,cf);x(this,cf,r)}_clone(){return new JI(this.delegate.clone(),c(this,cf)).copyOptions(this)}_wait(t){return this.delegate._wait(t).pipe(Rr(r=>pt(Promise.resolve(c(this,cf).call(this,r,t==null?void 0:t.signal)))))}};cf=new WeakMap;let yb=JI;const Ux=class Ux extends vd{constructor(t,r){super();_(this,uf);_(this,lf);_(this,Bx,t=>this.visibility?(()=>{switch(this.visibility){case"hidden":return ru(()=>pt(t.isHidden()));case"visible":return ru(()=>pt(t.isVisible()))}})().pipe(hd(Fi),Y_({delay:vb}),J_()):tu);x(this,uf,t),x(this,lf,r)}static create(t,r){return new Ux(t,r).setTimeout("getDefaultTimeout"in t?t.getDefaultTimeout():t.page().getDefaultTimeout())}_clone(){return new Ux(c(this,uf),c(this,lf)).copyOptions(this)}_wait(t){const r=t==null?void 0:t.signal;return ru(()=>pt(c(this,uf).waitForSelector(c(this,lf),{visible:!1,timeout:this._timeout,signal:r}))).pipe(nu(s=>s!==null),X_(),this.operators.conditions([c(this,Bx)],r))}};uf=new WeakMap,lf=new WeakMap,Bx=new WeakMap;let wb=Ux;function dV(n){for(const e of n)if(!(e instanceof vd))throw new Error("Unknown locator for race candidate");return n}const qx=class qx extends vd{constructor(t){super();_(this,df);x(this,df,t)}static create(t){const r=dV(t);return new qx(r)}_clone(){return new qx(c(this,df).map(t=>t.clone())).copyOptions(this)}_wait(t){return BM(...c(this,df).map(r=>r._wait(t)))}};df=new WeakMap;let pk=qx;const vb=100;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var hV=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},dr=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},Mo=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},$o=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r}),Gr;(function(n){n.FrameNavigated=Symbol("Frame.FrameNavigated"),n.FrameSwapped=Symbol("Frame.FrameSwapped"),n.LifecycleEvent=Symbol("Frame.LifecycleEvent"),n.FrameNavigatedWithinDocument=Symbol("Frame.FrameNavigatedWithinDocument"),n.FrameDetached=Symbol("Frame.FrameDetached"),n.FrameSwappedByActivation=Symbol("Frame.FrameSwappedByActivation")})(Gr||(Gr={}));const ut=le(n=>`Attempted to use detached Frame '${n._id}'.`);let h$=(()=>{var k,C,T_,M;let n=Ae,e=[],t,r,s,i,a,o,u,l,d,h,f,p,m,g,y,w,v,b,S,P;return M=class extends n{constructor(){super();_(this,C);J(this,"_id",hV(this,e));J(this,"_parentId");J(this,"_name");J(this,"_hasStartedLoading",!1);_(this,k)}clearDocumentHandle(){x(this,k,void 0)}async frameElement(){const O={stack:[],error:void 0,hasError:!1};try{const T=this.parentFrame();if(!T)return null;const L=Mo(O,await T.isolatedRealm().evaluateHandle(()=>document.querySelectorAll("iframe,frame")),!1);for await(const U of a$(L)){const Z={stack:[],error:void 0,hasError:!1};try{const j=Mo(Z,U,!1),F=await j.contentFrame();if((F==null?void 0:F._id)===this._id)return await T.mainRealm().adoptHandle(j)}catch(j){Z.error=j,Z.hasError=!0}finally{$o(Z)}}return null}catch(T){O.error=T,O.hasError=!0}finally{$o(O)}}async evaluateHandle(O,...T){return O=Mr(this.evaluateHandle.name,O),await this.mainRealm().evaluateHandle(O,...T)}async evaluate(O,...T){return O=Mr(this.evaluate.name,O),await this.mainRealm().evaluate(O,...T)}locator(O){return typeof O=="string"?wb.create(this,O):mb.create(this,O)}async $(O){return await(await A(this,C,T_).call(this)).$(O)}async $$(O,T){return await(await A(this,C,T_).call(this)).$$(O,T)}async $eval(O,T,...L){return T=Mr(this.$eval.name,T),await(await A(this,C,T_).call(this)).$eval(O,T,...L)}async $$eval(O,T,...L){return T=Mr(this.$$eval.name,T),await(await A(this,C,T_).call(this)).$$eval(O,T,...L)}async waitForSelector(O,T={}){const{updatedSelector:L,QueryHandler:U,polling:Z}=hb(O);return await U.waitFor(this,L,{polling:Z,...T})}async waitForFunction(O,T={},...L){return await this.mainRealm().waitForFunction(O,T,...L)}async content(){return await this.evaluate(()=>{let O="";for(const T of document.childNodes)switch(T){case document.documentElement:O+=document.documentElement.outerHTML;break;default:O+=new XMLSerializer().serializeToString(T);break}return O})}async setFrameContent(O){return await this.evaluate(T=>{document.open(),document.write(T),document.close()},O)}name(){return this._name||""}isDetached(){return this.detached}get disposed(){return this.detached}async addScriptTag(O){let{content:T="",type:L}=O;const{path:U}=O;if(+!!O.url+ +!!U+ +!!T!=1)throw new Error("Exactly one of `url`, `path`, or `content` must be specified.");return U&&(T=await Oo.value.fs.promises.readFile(U,"utf8"),T+=`//# sourceURL=${U.replace(/\n/g,"")}`),L=L??"text/javascript",await this.mainRealm().transferHandle(await this.isolatedRealm().evaluateHandle(async({url:Z,id:j,type:F,content:B})=>await new Promise((D,W)=>{const G=document.createElement("script");G.type=F,G.text=B,G.addEventListener("error",te=>{W(new Error(te.message??"Could not load script"))},{once:!0}),j&&(G.id=j),Z?(G.src=Z,G.addEventListener("load",()=>{D(G)},{once:!0}),document.head.appendChild(G)):(document.head.appendChild(G),D(G))}),{...O,type:L,content:T}))}async addStyleTag(O){let{content:T=""}=O;const{path:L}=O;if(+!!O.url+ +!!L+ +!!T!=1)throw new Error("Exactly one of `url`, `path`, or `content` must be specified.");return L&&(T=await Oo.value.fs.promises.readFile(L,"utf8"),T+="/*# sourceURL="+L.replace(/\n/g,"")+"*/",O.content=T),await this.mainRealm().transferHandle(await this.isolatedRealm().evaluateHandle(async({url:U,content:Z})=>await new Promise((j,F)=>{let B;if(!U)B=document.createElement("style"),B.appendChild(document.createTextNode(Z));else{const D=document.createElement("link");D.rel="stylesheet",D.href=U,B=D}return B.addEventListener("load",()=>{j(B)},{once:!0}),B.addEventListener("error",D=>{F(new Error(D.message??"Could not load style"))},{once:!0}),document.head.appendChild(B),B}),O))}async click(O,T={}){const L={stack:[],error:void 0,hasError:!1};try{const U=Mo(L,await this.$(O),!1);ae(U,`No element found for selector: ${O}`),await U.click(T),await U.dispose()}catch(U){L.error=U,L.hasError=!0}finally{$o(L)}}async focus(O){const T={stack:[],error:void 0,hasError:!1};try{const L=Mo(T,await this.$(O),!1);ae(L,`No element found for selector: ${O}`),await L.focus()}catch(L){T.error=L,T.hasError=!0}finally{$o(T)}}async hover(O){const T={stack:[],error:void 0,hasError:!1};try{const L=Mo(T,await this.$(O),!1);ae(L,`No element found for selector: ${O}`),await L.hover()}catch(L){T.error=L,T.hasError=!0}finally{$o(T)}}async select(O,...T){const L={stack:[],error:void 0,hasError:!1};try{const U=Mo(L,await this.$(O),!1);return ae(U,`No element found for selector: ${O}`),await U.select(...T)}catch(U){L.error=U,L.hasError=!0}finally{$o(L)}}async tap(O){const T={stack:[],error:void 0,hasError:!1};try{const L=Mo(T,await this.$(O),!1);ae(L,`No element found for selector: ${O}`),await L.tap()}catch(L){T.error=L,T.hasError=!0}finally{$o(T)}}async type(O,T,L){const U={stack:[],error:void 0,hasError:!1};try{const Z=Mo(U,await this.$(O),!1);ae(Z,`No element found for selector: ${O}`),await Z.type(T,L)}catch(Z){U.error=Z,U.hasError=!0}finally{$o(U)}}async title(){return await this.isolatedRealm().evaluate(()=>document.title)}},k=new WeakMap,C=new WeakSet,T_=function(){return c(this,k)||x(this,k,this.mainRealm().evaluateHandle(()=>document)),c(this,k)},(()=>{const O=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[ut],r=[ut],s=[ut],i=[ut],a=[ut],o=[ut],u=[ut],l=[ut],d=[ut],h=[ut],f=[ut],p=[ut],m=[ut],g=[ut],y=[ut],w=[ut],v=[ut],b=[ut],S=[ut],P=[ut],dr(M,null,t,{kind:"method",name:"frameElement",static:!1,private:!1,access:{has:T=>"frameElement"in T,get:T=>T.frameElement},metadata:O},null,e),dr(M,null,r,{kind:"method",name:"evaluateHandle",static:!1,private:!1,access:{has:T=>"evaluateHandle"in T,get:T=>T.evaluateHandle},metadata:O},null,e),dr(M,null,s,{kind:"method",name:"evaluate",static:!1,private:!1,access:{has:T=>"evaluate"in T,get:T=>T.evaluate},metadata:O},null,e),dr(M,null,i,{kind:"method",name:"locator",static:!1,private:!1,access:{has:T=>"locator"in T,get:T=>T.locator},metadata:O},null,e),dr(M,null,a,{kind:"method",name:"$",static:!1,private:!1,access:{has:T=>"$"in T,get:T=>T.$},metadata:O},null,e),dr(M,null,o,{kind:"method",name:"$$",static:!1,private:!1,access:{has:T=>"$$"in T,get:T=>T.$$},metadata:O},null,e),dr(M,null,u,{kind:"method",name:"$eval",static:!1,private:!1,access:{has:T=>"$eval"in T,get:T=>T.$eval},metadata:O},null,e),dr(M,null,l,{kind:"method",name:"$$eval",static:!1,private:!1,access:{has:T=>"$$eval"in T,get:T=>T.$$eval},metadata:O},null,e),dr(M,null,d,{kind:"method",name:"waitForSelector",static:!1,private:!1,access:{has:T=>"waitForSelector"in T,get:T=>T.waitForSelector},metadata:O},null,e),dr(M,null,h,{kind:"method",name:"waitForFunction",static:!1,private:!1,access:{has:T=>"waitForFunction"in T,get:T=>T.waitForFunction},metadata:O},null,e),dr(M,null,f,{kind:"method",name:"content",static:!1,private:!1,access:{has:T=>"content"in T,get:T=>T.content},metadata:O},null,e),dr(M,null,p,{kind:"method",name:"addScriptTag",static:!1,private:!1,access:{has:T=>"addScriptTag"in T,get:T=>T.addScriptTag},metadata:O},null,e),dr(M,null,m,{kind:"method",name:"addStyleTag",static:!1,private:!1,access:{has:T=>"addStyleTag"in T,get:T=>T.addStyleTag},metadata:O},null,e),dr(M,null,g,{kind:"method",name:"click",static:!1,private:!1,access:{has:T=>"click"in T,get:T=>T.click},metadata:O},null,e),dr(M,null,y,{kind:"method",name:"focus",static:!1,private:!1,access:{has:T=>"focus"in T,get:T=>T.focus},metadata:O},null,e),dr(M,null,w,{kind:"method",name:"hover",static:!1,private:!1,access:{has:T=>"hover"in T,get:T=>T.hover},metadata:O},null,e),dr(M,null,v,{kind:"method",name:"select",static:!1,private:!1,access:{has:T=>"select"in T,get:T=>T.select},metadata:O},null,e),dr(M,null,b,{kind:"method",name:"tap",static:!1,private:!1,access:{has:T=>"tap"in T,get:T=>T.tap},metadata:O},null,e),dr(M,null,S,{kind:"method",name:"type",static:!1,private:!1,access:{has:T=>"type"in T,get:T=>T.type},metadata:O},null,e),dr(M,null,P,{kind:"method",name:"title",static:!1,private:!1,access:{has:T=>"title"in T,get:T=>T.title},metadata:O},null,e),O&&Object.defineProperty(M,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:O})})(),M})();class _b{constructor(){_(this,hf);J(this,"_interceptionId");J(this,"_failureText",null);J(this,"_response",null);J(this,"_fromMemoryCache",!1);J(this,"_redirectChain",[]);J(this,"interception",{enabled:!1,handled:!1,handlers:[],resolutionState:{action:Bi.None},requestOverrides:{},response:null,abortReason:null})}continueRequestOverrides(){return ae(this.interception.enabled,"Request Interception is not enabled!"),this.interception.requestOverrides}responseForRequest(){return ae(this.interception.enabled,"Request Interception is not enabled!"),this.interception.response}abortErrorReason(){return ae(this.interception.enabled,"Request Interception is not enabled!"),this.interception.abortReason}interceptResolutionState(){return this.interception.enabled?this.interception.handled?{action:Bi.AlreadyHandled}:{...this.interception.resolutionState}:{action:Bi.Disabled}}isInterceptResolutionHandled(){return this.interception.handled}enqueueInterceptAction(e){this.interception.handlers.push(e)}async finalizeInterceptions(){await this.interception.handlers.reduce((t,r)=>t.then(r),Promise.resolve()),this.interception.handlers=[];const{action:e}=this.interceptResolutionState();switch(e){case"abort":return await this._abort(this.interception.abortReason);case"respond":if(this.interception.response===null)throw new Error("Response is missing for the interception");return await this._respond(this.interception.response);case"continue":return await this._continue(this.interception.requestOverrides)}}async continue(e={},t){if(A(this,hf,aE).call(this)){if(ae(this.interception.enabled,"Request Interception is not enabled!"),ae(!this.interception.handled,"Request is already handled!"),t===void 0)return await this._continue(e);if(this.interception.requestOverrides=e,this.interception.resolutionState.priority===void 0||t>this.interception.resolutionState.priority){this.interception.resolutionState={action:Bi.Continue,priority:t};return}if(t===this.interception.resolutionState.priority){if(this.interception.resolutionState.action==="abort"||this.interception.resolutionState.action==="respond")return;this.interception.resolutionState.action=Bi.Continue}}}async respond(e,t){if(A(this,hf,aE).call(this)){if(ae(this.interception.enabled,"Request Interception is not enabled!"),ae(!this.interception.handled,"Request is already handled!"),t===void 0)return await this._respond(e);if(this.interception.response=e,this.interception.resolutionState.priority===void 0||t>this.interception.resolutionState.priority){this.interception.resolutionState={action:Bi.Respond,priority:t};return}if(t===this.interception.resolutionState.priority){if(this.interception.resolutionState.action==="abort")return;this.interception.resolutionState.action=Bi.Respond}}}async abort(e="failed",t){if(!A(this,hf,aE).call(this))return;const r=fV[e];if(ae(r,"Unknown error code: "+e),ae(this.interception.enabled,"Request Interception is not enabled!"),ae(!this.interception.handled,"Request is already handled!"),t===void 0)return await this._abort(r);if(this.interception.abortReason=r,this.interception.resolutionState.priority===void 0||t>=this.interception.resolutionState.priority){this.interception.resolutionState={action:Bi.Abort,priority:t};return}}static getResponse(e){const t=Pa(e)?new TextEncoder().encode(e):e;return{contentLength:t.byteLength,base64:zM(t)}}}hf=new WeakSet,aE=function(){return!this.url().startsWith("data:")&&!this._fromMemoryCache};var Bi;(function(n){n.Abort="abort",n.Respond="respond",n.Continue="continue",n.Disabled="disabled",n.None="none",n.AlreadyHandled="already-handled"})(Bi||(Bi={}));function f$(n){const e=[];for(const t in n){const r=n[t];if(!Object.is(r,void 0)){const s=Array.isArray(r)?r:[r];e.push(...s.map(i=>({name:t,value:i+""})))}}return e}const p$={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Switch Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"},fV={aborted:"Aborted",accessdenied:"AccessDenied",addressunreachable:"AddressUnreachable",blockedbyclient:"BlockedByClient",blockedbyresponse:"BlockedByResponse",connectionaborted:"ConnectionAborted",connectionclosed:"ConnectionClosed",connectionfailed:"ConnectionFailed",connectionrefused:"ConnectionRefused",connectionreset:"ConnectionReset",internetdisconnected:"InternetDisconnected",namenotresolved:"NameNotResolved",timedout:"TimedOut",failed:"Failed"};function bb(n){if(n.originalMessage.includes("Invalid header")||n.originalMessage.includes('Expected "header"')||n.originalMessage.includes("invalid argument"))throw n;Ee(n)}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class m${constructor(){}ok(){const e=this.status();return e===0||e>=200&&e<=299}async buffer(){const e=await this.content();return Buffer.from(e)}async text(){const e=await this.content();return new TextDecoder().decode(e)}async json(){const e=await this.text();return JSON.parse(e)}}/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */function g$(){let n=0;return()=>++n}/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class y${constructor(){}}const zt=Object.freeze({Left:"left",Right:"right",Middle:"middle",Back:"back",Forward:"forward"});class w${constructor(){}}class v${constructor(){J(this,"idGenerator",g$());J(this,"touches",[])}removeHandle(e){const t=this.touches.indexOf(e);t!==-1&&this.touches.splice(t,1)}async tap(e,t){await(await this.touchStart(e,t)).end()}async touchMove(e,t){const r=this.touches[0];if(!r)throw new sb("Must start a new Touch first");return await r.move(e,t)}async touchEnd(){const e=this.touches.shift();if(!e)throw new sb("Must start a new Touch first");await e.end()}}/**
 * @license
 * Copyright 2019 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const _$=3e4;class mk{constructor(){_(this,no);_(this,nl);x(this,no,null),x(this,nl,null)}setDefaultTimeout(e){x(this,no,e)}setDefaultNavigationTimeout(e){x(this,nl,e)}navigationTimeout(){return c(this,nl)!==null?c(this,nl):c(this,no)!==null?c(this,no):_$}timeout(){return c(this,no)!==null?c(this,no):_$}}no=new WeakMap,nl=new WeakMap;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var pV=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},mV=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},gk=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},b$=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});function gV(n){n.optimizeForSpeed??(n.optimizeForSpeed=!1),n.type??(n.type="png"),n.fromSurface??(n.fromSurface=!0),n.fullPage??(n.fullPage=!1),n.omitBackground??(n.omitBackground=!1),n.encoding??(n.encoding="binary"),n.captureBeyondViewport??(n.captureBeyondViewport=!0)}let S$=(()=>{var r,s,i,a,o,JH,l;let n=Ae,e=[],t;return l=class extends n{constructor(){super();_(this,o);J(this,"_isDragging",(pV(this,e),!1));J(this,"_timeoutSettings",new mk);_(this,r,new WeakMap);_(this,s,new AW(1));_(this,i,0);_(this,a);It(this,"request").pipe(Rr(f=>YE(Li(1),Up(It(this,"requestfailed"),It(this,"requestfinished"),It(this,"response").pipe(ar(p=>p.request()))).pipe(nu(p=>p.id===f.id),tk(1),ar(()=>-1)))),vz((f,p)=>Li(f+p),0),bz(It(this,"close")),_z(0)).subscribe(c(this,s))}on(f,p){if(f!=="request")return super.on(f,p);let m=c(this,r).get(p);return m===void 0&&(m=g=>{g.enqueueInterceptAction(()=>p(g))},c(this,r).set(p,m)),super.on(f,m)}off(f,p){return f==="request"&&(p=c(this,r).get(p)||p),super.off(f,p)}get accessibility(){return this.mainFrame().accessibility}locator(f){return typeof f=="string"?wb.create(this,f):mb.create(this,f)}locatorRace(f){return vd.race(f)}async $(f){return await this.mainFrame().$(f)}async $$(f,p){return await this.mainFrame().$$(f,p)}async evaluateHandle(f,...p){return f=Mr(this.evaluateHandle.name,f),await this.mainFrame().evaluateHandle(f,...p)}async $eval(f,p,...m){return p=Mr(this.$eval.name,p),await this.mainFrame().$eval(f,p,...m)}async $$eval(f,p,...m){return p=Mr(this.$$eval.name,p),await this.mainFrame().$$eval(f,p,...m)}async addScriptTag(f){return await this.mainFrame().addScriptTag(f)}async addStyleTag(f){return await this.mainFrame().addStyleTag(f)}url(){return this.mainFrame().url()}async content(){return await this.mainFrame().content()}async setContent(f,p){await this.mainFrame().setContent(f,p)}async goto(f,p){return await this.mainFrame().goto(f,p)}async waitForNavigation(f={}){return await this.mainFrame().waitForNavigation(f)}waitForRequest(f,p={}){const{timeout:m=this._timeoutSettings.timeout(),signal:g}=p;if(typeof f=="string"){const w=f;f=v=>v.url()===w}const y=It(this,"request").pipe(Hp(f),Vr(Fn(m),iu(g),It(this,"close").pipe(ar(()=>{throw new Zs("Page closed!")}))));return Or(y)}waitForResponse(f,p={}){const{timeout:m=this._timeoutSettings.timeout(),signal:g}=p;if(typeof f=="string"){const w=f;f=v=>v.url()===w}const y=It(this,"response").pipe(Hp(f),Vr(Fn(m),iu(g),It(this,"close").pipe(ar(()=>{throw new Zs("Page closed!")}))));return Or(y)}waitForNetworkIdle(f={}){return Or(this.waitForNetworkIdle$(f))}waitForNetworkIdle$(f={}){const{timeout:p=this._timeoutSettings.timeout(),idleTime:m=Oz,concurrency:g=0,signal:y}=f;return c(this,s).pipe(Q_(w=>w>g?tu:ek(m)),ar(()=>{}),Vr(Fn(p),iu(y),It(this,"close").pipe(ar(()=>{throw new Zs("Page closed!")}))))}async waitForFrame(f,p={}){const{timeout:m=this.getDefaultTimeout(),signal:g}=p,y=Pa(f)?w=>f===w.url():f;return await Or(Up(It(this,"frameattached"),It(this,"framenavigated"),pt(this.frames())).pipe(Hp(y),hd(),Vr(Fn(m),iu(g),It(this,"close").pipe(ar(()=>{throw new Zs("Page closed.")})))))}async emulate(f){await Promise.all([this.setUserAgent(f.userAgent),this.setViewport(f.viewport)])}async evaluate(f,...p){return f=Mr(this.evaluate.name,f),await this.mainFrame().evaluate(f,...p)}async _maybeWriteTypedArrayToFile(f,p){f&&await Oo.value.fs.promises.writeFile(f,p)}async screencast(f={}){const p=Oo.value.ScreenRecorder,[m,g,y]=await A(this,o,JH).call(this);let w;if(f.crop){const{x:b,y:S,width:P,height:k}=E$(x$(f.crop));if(b<0||S<0)throw new Error("`crop.x` and `crop.y` must be greater than or equal to 0.");if(P<=0||k<=0)throw new Error("`crop.height` and `crop.width` must be greater than or equal to 0.");const C=m/y,E=g/y;if(b+P>C)throw new Error(`\`crop.width\` cannot be larger than the viewport width (${C}).`);if(S+k>E)throw new Error(`\`crop.height\` cannot be larger than the viewport height (${E}).`);w={x:b*y,y:S*y,width:P*y,height:k*y}}if(f.speed!==void 0&&f.speed<=0)throw new Error("`speed` must be greater than 0.");if(f.scale!==void 0&&f.scale<=0)throw new Error("`scale` must be greater than 0.");const v=new p(this,m,g,{...f,path:f.ffmpegPath,crop:w});try{await this._startScreencast()}catch(b){throw v.stop(),b}if(f.path){const{createWriteStream:b}=Oo.value.fs,S=b(f.path,"binary");v.pipe(S)}return v}async _startScreencast(){++Ap(this,i)._,c(this,a)||x(this,a,this.mainFrame().client.send("Page.startScreencast",{format:"png"}).then(()=>new Promise(f=>this.mainFrame().client.once("Page.screencastFrame",()=>f())))),await c(this,a)}async _stopScreencast(){--Ap(this,i)._,c(this,a)&&(x(this,a,void 0),c(this,i)===0&&await this.mainFrame().client.send("Page.stopScreencast"))}async screenshot(f={}){const p={stack:[],error:void 0,hasError:!1};try{const m=gk(p,await this.browserContext().startScreenshot(),!1),g={...f,clip:f.clip?{...f.clip}:void 0};if(g.type===void 0&&g.path!==void 0){const b=g.path;switch(b.slice(b.lastIndexOf(".")+1).toLowerCase()){case"png":g.type="png";break;case"jpeg":case"jpg":g.type="jpeg";break;case"webp":g.type="webp";break}}if(g.quality!==void 0){if(g.quality<0||g.quality>100)throw new Error(`Expected 'quality' (${g.quality}) to be between 0 and 100, inclusive.`);if(g.type===void 0||!["jpeg","webp"].includes(g.type))throw new Error(`${g.type??"png"} screenshots do not support 'quality'.`)}if(g.clip){if(g.clip.width<=0)throw new Error("'width' in 'clip' must be positive.");if(g.clip.height<=0)throw new Error("'height' in 'clip' must be positive.")}gV(g);const y=gk(p,new tb,!0);if(g.clip){if(g.fullPage)throw new Error("'clip' and 'fullPage' are mutually exclusive");g.clip=E$(x$(g.clip))}else if(g.fullPage){if(!g.captureBeyondViewport){const b=await this.mainFrame().isolatedRealm().evaluate(()=>{const P=document.documentElement;return{width:P.scrollWidth,height:P.scrollHeight}}),S=this.viewport();await this.setViewport({...S,...b}),y.defer(async()=>{await this.setViewport(S).catch(Ee)})}}else g.captureBeyondViewport=!1;const w=await this._screenshot(g);if(g.encoding==="base64")return w;const v=rk(w,!0);return await this._maybeWriteTypedArrayToFile(g.path,v),v}catch(m){p.error=m,p.hasError=!0}finally{const m=b$(p);m&&await m}}async title(){return await this.mainFrame().title()}click(f,p){return this.mainFrame().click(f,p)}focus(f){return this.mainFrame().focus(f)}hover(f){return this.mainFrame().hover(f)}select(f,...p){return this.mainFrame().select(f,...p)}tap(f){return this.mainFrame().tap(f)}type(f,p,m){return this.mainFrame().type(f,p,m)}async waitForSelector(f,p={}){return await this.mainFrame().waitForSelector(f,p)}waitForFunction(f,p,...m){return this.mainFrame().waitForFunction(f,p,...m)}[(t=[nV(function(){return this.browser()})],je)](){return void this.close().catch(Ee)}[Gs](){return this.close()}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakSet,JH=async function(){const f={stack:[],error:void 0,hasError:!1};try{const p=this.viewport(),m=gk(f,new lr,!1);return p&&p.deviceScaleFactor!==0&&(await this.setViewport({...p,deviceScaleFactor:0}),m.defer(()=>{this.setViewport(p).catch(Ee)})),await this.mainFrame().isolatedRealm().evaluate(()=>[window.visualViewport.width*window.devicePixelRatio,window.visualViewport.height*window.devicePixelRatio,window.devicePixelRatio])}catch(p){f.error=p,f.hasError=!0}finally{b$(f)}},(()=>{const f=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;mV(l,null,t,{kind:"method",name:"screenshot",static:!1,private:!1,access:{has:p=>"screenshot"in p,get:p=>p.screenshot},metadata:f},null,e),f&&Object.defineProperty(l,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f})})(),l})();function x$(n){return{...n,...n.width<0?{x:n.x+n.width,width:-n.width}:{x:n.x,width:n.width},...n.height<0?{y:n.y+n.height,height:-n.height}:{y:n.y,height:n.height}}}function E$(n){const e=Math.round(n.x),t=Math.round(n.y),r=Math.round(n.width+n.x-e),s=Math.round(n.height+n.y-t);return{...n,x:e,y:t,width:r,height:s}}/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class yV{constructor(e,t,r,...s){_(this,so);_(this,ff);_(this,pw);_(this,yc);_(this,sl);_(this,mw);_(this,gw);_(this,il,qt.create());_(this,_s);_(this,al);_(this,pf,[]);_(this,yw,()=>{var e;this.terminate((e=c(this,al))==null?void 0:e.reason)});var i;switch(x(this,so,e),x(this,ff,t.polling),x(this,pw,t.root),x(this,al,t.signal),(i=c(this,al))==null||i.addEventListener("abort",c(this,yw),{once:!0}),typeof r){case"string":x(this,yc,`() => {return (${r});}`);break;default:x(this,yc,ji(r));break}x(this,sl,s),c(this,so).taskManager.add(this),t.timeout&&(x(this,gw,new nb(`Waiting failed: ${t.timeout}ms exceeded`)),x(this,mw,setTimeout(()=>{this.terminate(c(this,gw))},t.timeout))),this.rerun()}get result(){return c(this,il).valueOrThrow()}async rerun(){for(const t of c(this,pf))t.abort();c(this,pf).length=0;const e=new AbortController;c(this,pf).push(e);try{switch(c(this,ff)){case"raf":x(this,_s,await c(this,so).evaluateHandle(({RAFPoller:r,createFunction:s},i,...a)=>{const o=s(i);return new r(()=>o(...a))},os.create(r=>r.puppeteerUtil),c(this,yc),...c(this,sl)));break;case"mutation":x(this,_s,await c(this,so).evaluateHandle(({MutationPoller:r,createFunction:s},i,a,...o)=>{const u=s(a);return new r(()=>u(...o),i||document)},os.create(r=>r.puppeteerUtil),c(this,pw),c(this,yc),...c(this,sl)));break;default:x(this,_s,await c(this,so).evaluateHandle(({IntervalPoller:r,createFunction:s},i,a,...o)=>{const u=s(a);return new r(()=>u(...o),i)},os.create(r=>r.puppeteerUtil),c(this,ff),c(this,yc),...c(this,sl)));break}await c(this,_s).evaluate(r=>{r.start()});const t=await c(this,_s).evaluateHandle(r=>r.result());c(this,il).resolve(t),await this.terminate()}catch(t){if(e.signal.aborted)return;const r=this.getBadError(t);r&&await this.terminate(r)}}async terminate(e){var t;if(c(this,so).taskManager.delete(this),(t=c(this,al))==null||t.removeEventListener("abort",c(this,yw)),clearTimeout(c(this,mw)),e&&!c(this,il).finished()&&c(this,il).reject(e),c(this,_s))try{await c(this,_s).evaluate(async r=>{await r.stop()}),c(this,_s)&&(await c(this,_s).dispose(),x(this,_s,void 0))}catch{}}getBadError(e){return Ts(e)?e.message.includes("Execution context is not available in detached frame")?new Error("Waiting failed: Frame detached"):e.message.includes("Execution context was destroyed")||e.message.includes("Cannot find context with specified id")||e.message.includes("DiscardedBrowsingContextError")?void 0:e:new Error("WaitTask failed with an error",{cause:e})}}so=new WeakMap,ff=new WeakMap,pw=new WeakMap,yc=new WeakMap,sl=new WeakMap,mw=new WeakMap,gw=new WeakMap,il=new WeakMap,_s=new WeakMap,al=new WeakMap,pf=new WeakMap,yw=new WeakMap;class wV{constructor(){_(this,wc,new Set)}add(e){c(this,wc).add(e)}delete(e){c(this,wc).delete(e)}terminateAll(e){for(const t of c(this,wc))t.terminate(e);c(this,wc).clear()}async rerunAll(){await Promise.all([...c(this,wc)].map(e=>e.rerun()))}}wc=new WeakMap;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */let k$=(IH=class{constructor(e){J(this,"timeoutSettings");J(this,"taskManager",new wV);_(this,ww,!1);this.timeoutSettings=e}async waitForFunction(e,t={},...r){const{polling:s="raf",timeout:i=this.timeoutSettings.timeout(),root:a,signal:o}=t;if(typeof s=="number"&&s<0)throw new Error("Cannot poll with non-positive interval");return await new yV(this,{polling:s,root:a,timeout:i,signal:o},e,...r).result}get disposed(){return c(this,ww)}dispose(){x(this,ww,!0),this.taskManager.terminateAll(new Error("waitForFunction failed: frame got detached."))}[je](){this.dispose()}},ww=new WeakMap,IH);/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Zr;(function(n){n.PAGE="page",n.BACKGROUND_PAGE="background_page",n.SERVICE_WORKER="service_worker",n.SHARED_WORKER="shared_worker",n.BROWSER="browser",n.WEBVIEW="webview",n.OTHER="other",n.TAB="tab"})(Zr||(Zr={}));class Zp{constructor(){}async worker(){return null}async page(){return null}}/**
 * @license
 * Copyright 2018 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class C$ extends Ae{constructor(t){super();J(this,"timeoutSettings",new mk);_(this,vw);x(this,vw,t)}url(){return c(this,vw)}async evaluate(t,...r){return t=Mr(this.evaluate.name,t),await this.mainRealm().evaluate(t,...r)}async evaluateHandle(t,...r){return t=Mr(this.evaluateHandle.name,t),await this.mainRealm().evaluateHandle(t,...r)}async close(){throw new He("WebWorker.close() is not supported")}}vw=new WeakMap;/**
 * @license
 * Copyright 2018 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var vV=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},_V=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});class P${constructor(e,t=""){_(this,vc);_(this,_w);x(this,vc,e),x(this,_w,t)}async snapshot(e={}){const{interestingOnly:t=!0,root:r=null,includeIframes:s=!1}=e,{nodes:i}=await c(this,vc).environment.client.send("Accessibility.getFullAXTree",{frameId:c(this,_w)});let a;if(r){const{node:h}=await c(this,vc).environment.client.send("DOM.describeNode",{objectId:r.id});a=h.backendNodeId}const o=yk.createTree(c(this,vc),i),u=async h=>{var f;if(((f=h.payload.role)==null?void 0:f.value)==="Iframe"){const p={stack:[],error:void 0,hasError:!1};try{if(!h.payload.backendDOMNodeId)return;const m=vV(p,await c(this,vc).adoptBackendNode(h.payload.backendDOMNodeId),!1);if(!m||!("contentFrame"in m))return;const g=await m.contentFrame();if(!g)return;const y=await g.accessibility.snapshot(e);h.iframeSnapshot=y??void 0}catch(m){p.error=m,p.hasError=!0}finally{_V(p)}}for(const p of h.children)await u(p)};let l=o;if(!o||(s&&await u(o),a&&(l=o.find(h=>h.payload.backendDOMNodeId===a)),!l))return null;if(!t)return this.serializeTree(l)[0]??null;const d=new Set;return this.collectInterestingNodes(d,o,!1),d.has(l)?this.serializeTree(l,d)[0]??null:null}serializeTree(e,t){const r=[];for(const i of e.children)r.push(...this.serializeTree(i,t));if(t&&!t.has(e))return r;const s=e.serialize();return r.length&&(s.children=r),e.iframeSnapshot&&(s.children||(s.children=[]),s.children.push(e.iframeSnapshot)),[s]}collectInterestingNodes(e,t,r){if((t.isInteresting(r)||t.iframeSnapshot)&&e.add(t),!t.isLeafNode()){r=r||t.isControl();for(const s of t.children)this.collectInterestingNodes(e,s,r)}}}vc=new WeakMap,_w=new WeakMap;const XI=class XI{constructor(e,t){_(this,io);J(this,"payload");J(this,"children",[]);J(this,"iframeSnapshot");_(this,mf,!1);_(this,bw,!1);_(this,ol,!1);_(this,Sw,!1);_(this,cl);_(this,bs);_(this,xw);_(this,ul);_(this,Ew);this.payload=t,x(this,cl,this.payload.name?this.payload.name.value:""),x(this,bs,this.payload.role?this.payload.role.value:"Unknown"),x(this,xw,this.payload.ignored),x(this,Ew,e);for(const r of this.payload.properties||[])r.name==="editable"&&(x(this,mf,r.value.value==="richtext"),x(this,bw,!0)),r.name==="focusable"&&x(this,ol,r.value.value),r.name==="hidden"&&x(this,Sw,r.value.value)}find(e){if(e(this))return this;for(const t of this.children){const r=t.find(e);if(r)return r}return null}isLeafNode(){if(!this.children.length||A(this,io,XH).call(this)||A(this,io,YH).call(this))return!0;switch(c(this,bs)){case"doc-cover":case"graphics-symbol":case"img":case"image":case"Meter":case"scrollbar":case"slider":case"separator":case"progressbar":return!0}return A(this,io,_O).call(this)?!1:!!(c(this,ol)&&c(this,cl)||c(this,bs)==="heading"&&c(this,cl))}isControl(){switch(c(this,bs)){case"button":case"checkbox":case"ColorWell":case"combobox":case"DisclosureTriangle":case"listbox":case"menu":case"menubar":case"menuitem":case"menuitemcheckbox":case"menuitemradio":case"radio":case"scrollbar":case"searchbox":case"slider":case"spinbutton":case"switch":case"tab":case"textbox":case"tree":case"treeitem":return!0;default:return!1}}isInteresting(e){return c(this,bs)==="Ignored"||c(this,Sw)||c(this,xw)?!1:c(this,ol)||c(this,mf)||this.isControl()?!0:e?!1:this.isLeafNode()&&!!c(this,cl)}serialize(){const e=new Map;for(const f of this.payload.properties||[])e.set(f.name.toLowerCase(),f.value.value);this.payload.name&&e.set("name",this.payload.name.value),this.payload.value&&e.set("value",this.payload.value.value),this.payload.description&&e.set("description",this.payload.description.value);const t={role:c(this,bs),elementHandle:async()=>this.payload.backendDOMNodeId?await c(this,Ew).adoptBackendNode(this.payload.backendDOMNodeId):null},r=["name","value","description","keyshortcuts","roledescription","valuetext"],s=f=>e.get(f);for(const f of r)e.has(f)&&(t[f]=s(f));const i=["disabled","expanded","focused","modal","multiline","multiselectable","readonly","required","selected"],a=f=>e.get(f);for(const f of i)f==="focused"&&c(this,bs)==="RootWebArea"||!a(f)||(t[f]=a(f));const o=["checked","pressed"];for(const f of o){if(!e.has(f))continue;const p=e.get(f);t[f]=p==="mixed"?"mixed":p==="true"}const u=["level","valuemax","valuemin"],l=f=>e.get(f);for(const f of u)e.has(f)&&(t[f]=l(f));const d=["autocomplete","haspopup","invalid","orientation"],h=f=>e.get(f);for(const f of d){const p=h(f);!p||p==="false"||(t[f]=h(f))}return t}static createTree(e,t){const r=new Map;for(const s of t)r.set(s.nodeId,new XI(e,s));for(const s of r.values())for(const i of s.payload.childIds||[]){const a=r.get(i);a&&s.children.push(a)}return r.values().next().value??null}};mf=new WeakMap,bw=new WeakMap,ol=new WeakMap,Sw=new WeakMap,cl=new WeakMap,bs=new WeakMap,xw=new WeakMap,ul=new WeakMap,Ew=new WeakMap,io=new WeakSet,XH=function(){return c(this,mf)?!1:c(this,bw)?!0:c(this,bs)==="textbox"||c(this,bs)==="searchbox"},YH=function(){const e=c(this,bs);return e==="LineBreak"||e==="text"||e==="InlineTextBox"||e==="StaticText"},_O=function(){var e;if(c(this,ul)===void 0){x(this,ul,!1);for(const t of this.children)if(c(t,ol)||A(e=t,io,_O).call(e)){x(this,ul,!0);break}}return c(this,ul)};let yk=XI;var bV=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},SV=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});class Sb{constructor(e,t,r){_(this,ao);_(this,kw);_(this,Cw);x(this,ao,e),x(this,kw,t),x(this,Cw,r)}get name(){return c(this,ao)}get initSource(){return c(this,Cw)}async run(e,t,r,s){const i=new lr;try{if(!s){const a={stack:[],error:void 0,hasError:!1};try{const u=await bV(a,await e.evaluateHandle((l,d)=>globalThis[l].args.get(d),c(this,ao),t),!1).getProperties();for(const[l,d]of u)if(l in r)switch(d.remoteObject().subtype){case"node":r[+l]=d;break;default:i.use(d)}else i.use(d)}catch(o){a.error=o,a.hasError=!0}finally{SV(a)}}await e.evaluate((a,o,u)=>{const l=globalThis[a].callbacks;l.get(o).resolve(u),l.delete(o)},c(this,ao),t,await c(this,kw).call(this,...r));for(const a of r)a instanceof ou&&i.use(a)}catch(a){Ts(a)?await e.evaluate((o,u,l,d)=>{const h=new Error(l);h.stack=d;const f=globalThis[o].callbacks;f.get(u).reject(h),f.delete(u)},c(this,ao),t,a.message,a.stack).catch(Ee):await e.evaluate((o,u,l)=>{const d=globalThis[o].callbacks;d.get(u).reject(l),d.delete(u)},c(this,ao),t,a).catch(Ee)}}}ao=new WeakMap,kw=new WeakMap,Cw=new WeakMap;/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class wk{constructor(e,t,r,s,i){_(this,Pw);_(this,Aw);_(this,Tw);_(this,gf);_(this,yf);x(this,Pw,e),x(this,Aw,t),x(this,Tw,r),x(this,gf,s),x(this,yf,i)}type(){return c(this,Pw)}text(){return c(this,Aw)}args(){return c(this,Tw)}location(){return c(this,gf)[0]??(c(this,yf)?{url:c(this,yf).url()}:{})}stackTrace(){return c(this,gf)}}Pw=new WeakMap,Aw=new WeakMap,Tw=new WeakMap,gf=new WeakMap,yf=new WeakMap;/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class xV{constructor(e,t){_(this,wf);_(this,Iw);_(this,ll,!1);x(this,wf,e),x(this,Iw,t.mode!=="selectSingle")}isMultiple(){return c(this,Iw)}async accept(e){ae(!c(this,ll),"Cannot accept FileChooser which is already handled!"),x(this,ll,!0),await c(this,wf).uploadFile(...e)}async cancel(){ae(!c(this,ll),"Cannot cancel FileChooser which is already handled!"),x(this,ll,!0),await c(this,wf).evaluate(e=>{e.dispatchEvent(new Event("cancel",{bubbles:!0}))})}}wf=new WeakMap,Iw=new WeakMap,ll=new WeakMap;/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var $r;(function(n){n.Request=Symbol("NetworkManager.Request"),n.RequestServedFromCache=Symbol("NetworkManager.RequestServedFromCache"),n.Response=Symbol("NetworkManager.Response"),n.RequestFailed=Symbol("NetworkManager.RequestFailed"),n.RequestFinished=Symbol("NetworkManager.RequestFinished")})($r||($r={}));/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class vk{constructor(){_(this,zs,new Map);_(this,Hx,g$())}create(e,t,r){const s=new EV(c(this,Hx).call(this),e,t);c(this,zs).set(s.id,s);try{r(s.id)}catch(i){throw s.promise.catch(Ee).finally(()=>{c(this,zs).delete(s.id)}),s.reject(i),i}return s.promise.finally(()=>{c(this,zs).delete(s.id)})}reject(e,t,r){const s=c(this,zs).get(e);s&&this._reject(s,t,r)}rejectRaw(e,t){const r=c(this,zs).get(e);r&&r.reject(t)}_reject(e,t,r){let s,i;t instanceof su?(s=t,s.cause=e.error,i=t.message):(s=e.error,i=t),e.reject(n$(s,`Protocol error (${e.label}): ${i}`,r))}resolve(e,t){const r=c(this,zs).get(e);r&&r.resolve(t)}clear(){for(const e of c(this,zs).values())this._reject(e,new Zs("Target closed"));c(this,zs).clear()}getPendingProtocolErrors(){const e=[];for(const t of c(this,zs).values())e.push(new Error(`${t.label} timed out. Trace: ${t.error.stack}`));return e}}zs=new WeakMap,Hx=new WeakMap;class EV{constructor(e,t,r){_(this,Ow);_(this,Rw,new su);_(this,dl,qt.create());_(this,vf);_(this,Mw);x(this,Ow,e),x(this,Mw,t),r&&x(this,vf,setTimeout(()=>{c(this,dl).reject(n$(c(this,Rw),`${t} timed out. Increase the 'protocolTimeout' setting in launch/connect calls for a higher timeout if needed.`))},r))}resolve(e){clearTimeout(c(this,vf)),c(this,dl).resolve(e)}reject(e){clearTimeout(c(this,vf)),c(this,dl).reject(e)}get id(){return c(this,Ow)}get promise(){return c(this,dl).valueOrThrow()}get error(){return c(this,Rw)}get label(){return c(this,Mw)}}Ow=new WeakMap,Rw=new WeakMap,dl=new WeakMap,vf=new WeakMap,Mw=new WeakMap;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class _d extends Kp{constructor(t,r,s,i,a){super();_(this,hl);_(this,_f);_(this,oo,new vk);_(this,Ai);_(this,bf);_(this,Sf);_(this,$w,!1);x(this,Ai,t),x(this,_f,r),x(this,hl,s),x(this,bf,i),x(this,$w,a)}_setTarget(t){x(this,Sf,t)}_target(){return ae(c(this,Sf),"Target must exist"),c(this,Sf)}connection(){return c(this,Ai)}parentSession(){var r;return c(this,bf)?((r=c(this,Ai))==null?void 0:r.session(c(this,bf)))??void 0:this}send(t,r,s){return c(this,Ai)?c(this,Ai)._rawSend(c(this,oo),t,r,c(this,hl),s):Promise.reject(new Zs(`Protocol error (${t}): Session closed. Most likely the ${c(this,_f)} has been closed.`))}_onMessage(t){t.id?t.error?c(this,$w)?c(this,oo).rejectRaw(t.id,t.error):c(this,oo).reject(t.id,s$(t),t.error.message):c(this,oo).resolve(t.id,t.result):(ae(!t.id),this.emit(t.method,t.params))}async detach(){if(!c(this,Ai))throw new Error(`Session already detached. Most likely the ${c(this,_f)} has been closed.`);await c(this,Ai).send("Target.detachFromTarget",{sessionId:c(this,hl)})}_onClosed(){c(this,oo).clear(),x(this,Ai,void 0),this.emit(Wt.Disconnected,void 0)}id(){return c(this,hl)}getPendingProtocolErrors(){return c(this,oo).getPendingProtocolErrors()}}hl=new WeakMap,_f=new WeakMap,oo=new WeakMap,Ai=new WeakMap,bf=new WeakMap,Sf=new WeakMap,$w=new WeakMap;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const kV=fd("puppeteer:protocol:SEND "),CV=fd("puppeteer:protocol:RECV ");class A$ extends Ae{constructor(t,r,s=0,i,a=!1){super();_(this,Fw);_(this,Nw);_(this,da);_(this,fl);_(this,xf);_(this,On,new Map);_(this,pl,!1);_(this,Ef,new Set);_(this,ha);_(this,kf,!1);x(this,kf,a),x(this,ha,new vk),x(this,Nw,t),x(this,fl,s),x(this,xf,i??18e4),x(this,da,r),c(this,da).onmessage=this.onMessage.bind(this),c(this,da).onclose=A(this,Fw,bO).bind(this)}static fromSession(t){return t.connection()}get delay(){return c(this,fl)}get timeout(){return c(this,xf)}get _closed(){return c(this,pl)}get _sessions(){return c(this,On)}session(t){return c(this,On).get(t)||null}url(){return c(this,Nw)}send(t,r,s){return this._rawSend(c(this,ha),t,r,void 0,s)}_rawSend(t,r,s,i,a){return c(this,pl)?Promise.reject(new Error("Protocol error: Connection closed.")):t.create(r,(a==null?void 0:a.timeout)??c(this,xf),o=>{const u=JSON.stringify({method:r,params:s,id:o,sessionId:i});kV(u),c(this,da).send(u)})}async closeBrowser(){await this.send("Browser.close")}async onMessage(t){c(this,fl)&&await new Promise(s=>setTimeout(s,c(this,fl))),CV(t);const r=JSON.parse(t);if(r.method==="Target.attachedToTarget"){const s=r.params.sessionId,i=new _d(this,r.params.targetInfo.type,s,r.sessionId,c(this,kf));c(this,On).set(s,i),this.emit(Wt.SessionAttached,i);const a=c(this,On).get(r.sessionId);a&&a.emit(Wt.SessionAttached,i)}else if(r.method==="Target.detachedFromTarget"){const s=c(this,On).get(r.params.sessionId);if(s){s._onClosed(),c(this,On).delete(r.params.sessionId),this.emit(Wt.SessionDetached,s);const i=c(this,On).get(r.sessionId);i&&i.emit(Wt.SessionDetached,s)}}if(r.sessionId){const s=c(this,On).get(r.sessionId);s&&s._onMessage(r)}else r.id?r.error?c(this,kf)?c(this,ha).rejectRaw(r.id,r.error):c(this,ha).reject(r.id,s$(r),r.error.message):c(this,ha).resolve(r.id,r.result):this.emit(r.method,r.params)}dispose(){A(this,Fw,bO).call(this),c(this,da).close()}isAutoAttached(t){return!c(this,Ef).has(t)}async _createSession(t,r=!0){r||c(this,Ef).add(t.targetId);const{sessionId:s}=await this.send("Target.attachToTarget",{targetId:t.targetId,flatten:!0});c(this,Ef).delete(t.targetId);const i=c(this,On).get(s);if(!i)throw new Error("CDPSession creation failed.");return i}async createSession(t){return await this._createSession(t,!1)}getPendingProtocolErrors(){const t=[];t.push(...c(this,ha).getPendingProtocolErrors());for(const r of c(this,On).values())t.push(...r.getPendingProtocolErrors());return t}}Nw=new WeakMap,da=new WeakMap,fl=new WeakMap,xf=new WeakMap,On=new WeakMap,pl=new WeakMap,Ef=new WeakMap,ha=new WeakMap,kf=new WeakMap,Fw=new WeakSet,bO=function(){if(!c(this,pl)){x(this,pl,!0),c(this,da).onmessage=void 0,c(this,da).onclose=void 0,c(this,ha).clear();for(const t of c(this,On).values())t._onClosed();c(this,On).clear(),this.emit(Wt.Disconnected,void 0)}};function _k(n){return n instanceof Zs}/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class T${constructor(e){_(this,ml);_(this,gl);x(this,ml,new PV(e)),x(this,gl,new AV(e))}updateClient(e){c(this,ml).updateClient(e),c(this,gl).updateClient(e)}async startJSCoverage(e={}){return await c(this,ml).start(e)}async stopJSCoverage(){return await c(this,ml).stop()}async startCSSCoverage(e={}){return await c(this,gl).start(e)}async stopCSSCoverage(){return await c(this,gl).stop()}}ml=new WeakMap,gl=new WeakMap;class PV{constructor(e){_(this,Tf);_(this,Rn);_(this,yl,!1);_(this,wl,new Map);_(this,vl,new Map);_(this,Cf);_(this,Lw,!1);_(this,Pf,!1);_(this,Af,!1);x(this,Rn,e)}updateClient(e){x(this,Rn,e)}async start(e={}){ae(!c(this,yl),"JSCoverage is already enabled");const{resetOnNavigation:t=!0,reportAnonymousScripts:r=!1,includeRawScriptCoverage:s=!1,useBlockCoverage:i=!0}=e;x(this,Lw,t),x(this,Pf,r),x(this,Af,s),x(this,yl,!0),c(this,wl).clear(),c(this,vl).clear(),x(this,Cf,new lr);const a=c(this,Cf).use(new Ae(c(this,Rn)));a.on("Debugger.scriptParsed",A(this,Tf,eK).bind(this)),a.on("Runtime.executionContextsCleared",A(this,Tf,QH).bind(this)),await Promise.all([c(this,Rn).send("Profiler.enable"),c(this,Rn).send("Profiler.startPreciseCoverage",{callCount:c(this,Af),detailed:i}),c(this,Rn).send("Debugger.enable"),c(this,Rn).send("Debugger.setSkipAllPauses",{skip:!0})])}async stop(){var s;ae(c(this,yl),"JSCoverage is not enabled"),x(this,yl,!1);const e=await Promise.all([c(this,Rn).send("Profiler.takePreciseCoverage"),c(this,Rn).send("Profiler.stopPreciseCoverage"),c(this,Rn).send("Profiler.disable"),c(this,Rn).send("Debugger.disable")]);(s=c(this,Cf))==null||s.dispose();const t=[],r=e[0];for(const i of r.result){let a=c(this,wl).get(i.scriptId);!a&&c(this,Pf)&&(a="debugger://VM"+i.scriptId);const o=c(this,vl).get(i.scriptId);if(o===void 0||a===void 0)continue;const u=[];for(const d of i.functions)u.push(...d.ranges);const l=I$(u);c(this,Af)?t.push({url:a,ranges:l,text:o,rawScriptCoverage:i}):t.push({url:a,ranges:l,text:o})}return t}}Rn=new WeakMap,yl=new WeakMap,wl=new WeakMap,vl=new WeakMap,Cf=new WeakMap,Lw=new WeakMap,Pf=new WeakMap,Af=new WeakMap,Tf=new WeakSet,QH=function(){c(this,Lw)&&(c(this,wl).clear(),c(this,vl).clear())},eK=async function(e){if(!as.isPuppeteerURL(e.url)&&!(!e.url&&!c(this,Pf)))try{const t=await c(this,Rn).send("Debugger.getScriptSource",{scriptId:e.scriptId});c(this,wl).set(e.scriptId,e.url),c(this,vl).set(e.scriptId,t.scriptSource)}catch(t){Ee(t)}};class AV{constructor(e){_(this,Of);_(this,Ss);_(this,_l,!1);_(this,_c,new Map);_(this,bl,new Map);_(this,If);_(this,jw,!1);x(this,Ss,e)}updateClient(e){x(this,Ss,e)}async start(e={}){ae(!c(this,_l),"CSSCoverage is already enabled");const{resetOnNavigation:t=!0}=e;x(this,jw,t),x(this,_l,!0),c(this,_c).clear(),c(this,bl).clear(),x(this,If,new lr);const r=c(this,If).use(new Ae(c(this,Ss)));r.on("CSS.styleSheetAdded",A(this,Of,rK).bind(this)),r.on("Runtime.executionContextsCleared",A(this,Of,tK).bind(this)),await Promise.all([c(this,Ss).send("DOM.enable"),c(this,Ss).send("CSS.enable"),c(this,Ss).send("CSS.startRuleUsageTracking")])}async stop(){var s;ae(c(this,_l),"CSSCoverage is not enabled"),x(this,_l,!1);const e=await c(this,Ss).send("CSS.stopRuleUsageTracking");await Promise.all([c(this,Ss).send("CSS.disable"),c(this,Ss).send("DOM.disable")]),(s=c(this,If))==null||s.dispose();const t=new Map;for(const i of e.ruleUsage){let a=t.get(i.styleSheetId);a||(a=[],t.set(i.styleSheetId,a)),a.push({startOffset:i.startOffset,endOffset:i.endOffset,count:i.used?1:0})}const r=[];for(const i of c(this,_c).keys()){const a=c(this,_c).get(i);ae(typeof a<"u",`Stylesheet URL is undefined (styleSheetId=${i})`);const o=c(this,bl).get(i);ae(typeof o<"u",`Stylesheet text is undefined (styleSheetId=${i})`);const u=I$(t.get(i)||[]);r.push({url:a,ranges:u,text:o})}return r}}Ss=new WeakMap,_l=new WeakMap,_c=new WeakMap,bl=new WeakMap,If=new WeakMap,jw=new WeakMap,Of=new WeakSet,tK=function(){c(this,jw)&&(c(this,_c).clear(),c(this,bl).clear())},rK=async function(e){const t=e.header;if(t.sourceURL)try{const r=await c(this,Ss).send("CSS.getStyleSheetText",{styleSheetId:t.styleSheetId});c(this,_c).set(t.styleSheetId,t.sourceURL),c(this,bl).set(t.styleSheetId,r.text)}catch(r){Ee(r)}};function I$(n){const e=[];for(const i of n)e.push({offset:i.startOffset,type:0,range:i}),e.push({offset:i.endOffset,type:1,range:i});e.sort((i,a)=>{if(i.offset!==a.offset)return i.offset-a.offset;if(i.type!==a.type)return a.type-i.type;const o=i.range.endOffset-i.range.startOffset,u=a.range.endOffset-a.range.startOffset;return i.type===0?u-o:o-u});const t=[],r=[];let s=0;for(const i of e){if(t.length&&s<i.offset&&t[t.length-1]>0){const a=r[r.length-1];a&&a.end===s?a.end=i.offset:r.push({start:s,end:i.offset})}s=i.offset,i.type===0?t.push(i.range.count):t.pop()}return r.filter(i=>i.end-i.start>0)}/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class TV extends r${constructor(t,r,s,i=""){super(r,s,i);_(this,Dw);x(this,Dw,t)}async handle(t){await c(this,Dw).send("Page.handleJavaScriptDialog",{accept:t.accept,promptText:t.text})}}Dw=new WeakMap;var IV=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Ui=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},qi=function(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})};class Hi{constructor(e,t,r){_(this,Sl);_(this,Rf);_(this,Bw);x(this,Sl,e),x(this,Rf,t),x(this,Bw,r),c(this,Rf).registerState(this)}async setState(e){x(this,Sl,e),await this.sync()}get state(){return c(this,Sl)}async sync(){await Promise.all(c(this,Rf).clients().map(e=>c(this,Bw).call(this,e,c(this,Sl))))}}Sl=new WeakMap,Rf=new WeakMap,Bw=new WeakMap;let O$=(()=>{var P,k,C,E,M,I,N,O,T,L,U,Z,j,F,B,D,SO,xO,EO,kO,CO,PO,AO,TO,IO,OO,R;let n=[],e,t,r,s,i,a,o,u,l,d,h,f,p,m,g,y,w,v,b,S;return R=class{constructor(H){_(this,D);_(this,P,IV(this,n));_(this,k,!1);_(this,C,!1);_(this,E,[]);_(this,M,new Hi({active:!1},this,c(this,D,SO)));_(this,I,new Hi({active:!1},this,c(this,D,xO)));_(this,N,new Hi({active:!1},this,c(this,D,EO)));_(this,O,new Hi({active:!1},this,c(this,D,kO)));_(this,T,new Hi({active:!1},this,c(this,D,CO)));_(this,L,new Hi({active:!1},this,c(this,D,PO)));_(this,U,new Hi({active:!1},this,c(this,D,AO)));_(this,Z,new Hi({active:!1},this,c(this,D,TO)));_(this,j,new Hi({active:!1},this,c(this,D,IO)));_(this,F,new Hi({javaScriptEnabled:!0,active:!1},this,c(this,D,OO)));_(this,B,new Set);x(this,P,H)}updateClient(H){x(this,P,H),c(this,B).delete(H)}registerState(H){c(this,E).push(H)}clients(){return[c(this,P),...Array.from(c(this,B))]}async registerSpeculativeSession(H){c(this,B).add(H),H.once(Wt.Disconnected,()=>{c(this,B).delete(H)}),Promise.all(c(this,E).map(V=>V.sync().catch(Ee)))}get javascriptEnabled(){return c(this,F).state.javaScriptEnabled}async emulateViewport(H){const V=c(this,M).state;if(!H&&!V.active)return!1;await c(this,M).setState(H?{viewport:H,active:!0}:{active:!1});const X=(H==null?void 0:H.isMobile)||!1,ne=(H==null?void 0:H.hasTouch)||!1,ce=c(this,k)!==X||c(this,C)!==ne;return x(this,k,X),x(this,C,ne),ce}async emulateIdleState(H){await c(this,I).setState({active:!0,overrides:H})}async emulateTimezone(H){await c(this,N).setState({timezoneId:H,active:!0})}async emulateVisionDeficiency(H){ae(!H||new Set(["none","achromatopsia","blurredVision","deuteranopia","protanopia","reducedContrast","tritanopia"]).has(H),`Unsupported vision deficiency: ${H}`),await c(this,O).setState({active:!0,visionDeficiency:H})}async emulateCPUThrottling(H){ae(H===null||H>=1,"Throttling rate should be greater or equal to 1"),await c(this,T).setState({active:!0,factor:H??void 0})}async emulateMediaFeatures(H){if(Array.isArray(H))for(const V of H){const X=V.name;ae(/^(?:prefers-(?:color-scheme|reduced-motion)|color-gamut)$/.test(X),"Unsupported media feature: "+X)}await c(this,L).setState({active:!0,mediaFeatures:H})}async emulateMediaType(H){ae(H==="screen"||H==="print"||(H??void 0)===void 0,"Unsupported media type: "+H),await c(this,U).setState({type:H,active:!0})}async setGeolocation(H){const{longitude:V,latitude:X,accuracy:ne=0}=H;if(V<-180||V>180)throw new Error(`Invalid longitude "${V}": precondition -180 <= LONGITUDE <= 180 failed.`);if(X<-90||X>90)throw new Error(`Invalid latitude "${X}": precondition -90 <= LATITUDE <= 90 failed.`);if(ne<0)throw new Error(`Invalid accuracy "${ne}": precondition 0 <= ACCURACY failed.`);await c(this,Z).setState({active:!0,geoLocation:{longitude:V,latitude:X,accuracy:ne}})}async resetDefaultBackgroundColor(){await c(this,j).setState({active:!0,color:void 0})}async setTransparentBackgroundColor(){await c(this,j).setState({active:!0,color:{r:0,g:0,b:0,a:0}})}async setJavaScriptEnabled(H){await c(this,F).setState({active:!0,javaScriptEnabled:H})}},P=new WeakMap,k=new WeakMap,C=new WeakMap,E=new WeakMap,M=new WeakMap,I=new WeakMap,N=new WeakMap,O=new WeakMap,T=new WeakMap,L=new WeakMap,U=new WeakMap,Z=new WeakMap,j=new WeakMap,F=new WeakMap,B=new WeakMap,D=new WeakSet,SO=function(){return t.value},xO=function(){return s.value},EO=function(){return a.value},kO=function(){return u.value},CO=function(){return d.value},PO=function(){return f.value},AO=function(){return m.value},TO=function(){return y.value},IO=function(){return v.value},OO=function(){return S.value},(()=>{const H=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;e=[Js],r=[Js],i=[Js],o=[Js],l=[Js],h=[Js],p=[Js],g=[Js],w=[Js],b=[Js],Ui(R,t={value:qi(async function(V,X){if(!X.viewport){await Promise.all([V.send("Emulation.clearDeviceMetricsOverride"),V.send("Emulation.setTouchEmulationEnabled",{enabled:!1})]).catch(Ee);return}const{viewport:ne}=X,ce=ne.isMobile||!1,Le=ne.width,de=ne.height,De=ne.deviceScaleFactor??1,Pe=ne.isLandscape?{angle:90,type:"landscapePrimary"}:{angle:0,type:"portraitPrimary"},z=ne.hasTouch||!1;await Promise.all([V.send("Emulation.setDeviceMetricsOverride",{mobile:ce,width:Le,height:de,deviceScaleFactor:De,screenOrientation:Pe}).catch(re=>{if(re.message.includes("Target does not support metrics override")){Ee(re);return}throw re}),V.send("Emulation.setTouchEmulationEnabled",{enabled:z})])},"#applyViewport")},e,{kind:"method",name:"#applyViewport",static:!1,private:!0,access:{has:V=>Nn(D,V),get:V=>c(V,D,SO)},metadata:H},null,n),Ui(R,s={value:qi(async function(V,X){X.active&&(X.overrides?await V.send("Emulation.setIdleOverride",{isUserActive:X.overrides.isUserActive,isScreenUnlocked:X.overrides.isScreenUnlocked}):await V.send("Emulation.clearIdleOverride"))},"#emulateIdleState")},r,{kind:"method",name:"#emulateIdleState",static:!1,private:!0,access:{has:V=>Nn(D,V),get:V=>c(V,D,xO)},metadata:H},null,n),Ui(R,a={value:qi(async function(V,X){if(X.active)try{await V.send("Emulation.setTimezoneOverride",{timezoneId:X.timezoneId||""})}catch(ne){throw Ts(ne)&&ne.message.includes("Invalid timezone")?new Error(`Invalid timezone ID: ${X.timezoneId}`):ne}},"#emulateTimezone")},i,{kind:"method",name:"#emulateTimezone",static:!1,private:!0,access:{has:V=>Nn(D,V),get:V=>c(V,D,EO)},metadata:H},null,n),Ui(R,u={value:qi(async function(V,X){X.active&&await V.send("Emulation.setEmulatedVisionDeficiency",{type:X.visionDeficiency||"none"})},"#emulateVisionDeficiency")},o,{kind:"method",name:"#emulateVisionDeficiency",static:!1,private:!0,access:{has:V=>Nn(D,V),get:V=>c(V,D,kO)},metadata:H},null,n),Ui(R,d={value:qi(async function(V,X){X.active&&await V.send("Emulation.setCPUThrottlingRate",{rate:X.factor??1})},"#emulateCpuThrottling")},l,{kind:"method",name:"#emulateCpuThrottling",static:!1,private:!0,access:{has:V=>Nn(D,V),get:V=>c(V,D,CO)},metadata:H},null,n),Ui(R,f={value:qi(async function(V,X){X.active&&await V.send("Emulation.setEmulatedMedia",{features:X.mediaFeatures})},"#emulateMediaFeatures")},h,{kind:"method",name:"#emulateMediaFeatures",static:!1,private:!0,access:{has:V=>Nn(D,V),get:V=>c(V,D,PO)},metadata:H},null,n),Ui(R,m={value:qi(async function(V,X){X.active&&await V.send("Emulation.setEmulatedMedia",{media:X.type||""})},"#emulateMediaType")},p,{kind:"method",name:"#emulateMediaType",static:!1,private:!0,access:{has:V=>Nn(D,V),get:V=>c(V,D,AO)},metadata:H},null,n),Ui(R,y={value:qi(async function(V,X){X.active&&await V.send("Emulation.setGeolocationOverride",X.geoLocation?{longitude:X.geoLocation.longitude,latitude:X.geoLocation.latitude,accuracy:X.geoLocation.accuracy}:void 0)},"#setGeolocation")},g,{kind:"method",name:"#setGeolocation",static:!1,private:!0,access:{has:V=>Nn(D,V),get:V=>c(V,D,TO)},metadata:H},null,n),Ui(R,v={value:qi(async function(V,X){X.active&&await V.send("Emulation.setDefaultBackgroundColorOverride",{color:X.color})},"#setDefaultBackgroundColor")},w,{kind:"method",name:"#setDefaultBackgroundColor",static:!1,private:!0,access:{has:V=>Nn(D,V),get:V=>c(V,D,IO)},metadata:H},null,n),Ui(R,S={value:qi(async function(V,X){X.active&&await V.send("Emulation.setScriptExecutionDisabled",{value:!X.javaScriptEnabled})},"#setJavaScriptEnabled")},b,{kind:"method",name:"#setJavaScriptEnabled",static:!1,private:!0,access:{has:V=>Nn(D,V),get:V=>c(V,D,OO)},metadata:H},null,n),H&&Object.defineProperty(R,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:H})})(),R})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class OV{constructor(e,t,r){_(this,Uw);_(this,qw);_(this,Mf,new WeakMap);x(this,Uw,t),x(this,qw,r),c(this,Mf).set(e,t)}get id(){return c(this,Uw)}get source(){return c(this,qw)}getIdForFrame(e){return c(this,Mf).get(e)}setIdForFrame(e,t){c(this,Mf).set(e,t)}}Uw=new WeakMap,qw=new WeakMap,Mf=new WeakMap;/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class RV{constructor(e,t){J(this,"id");J(this,"name");this.id=e,this.name=t}}class MV{constructor(e,t,r){_(this,Kw);_(this,xs);_(this,Hw);_(this,xl);_(this,El,!1);_(this,$f,A(this,Kw,RO).bind(this));_(this,Nf,new Set);J(this,"devices",[]);x(this,xs,e),x(this,Hw,t),x(this,xl,r.id),c(this,xs).on("DeviceAccess.deviceRequestPrompted",c(this,$f)),c(this,xs).on("Target.detachedFromTarget",()=>{x(this,xs,null)}),A(this,Kw,RO).call(this,r)}async waitForDevice(e,t={}){for(const a of this.devices)if(e(a))return a;const{timeout:r=c(this,Hw).timeout()}=t,s=qt.create({message:`Waiting for \`DeviceRequestPromptDevice\` failed: ${r}ms exceeded`,timeout:r});t.signal&&t.signal.addEventListener("abort",()=>{var a;s.reject((a=t.signal)==null?void 0:a.reason)},{once:!0});const i={filter:e,promise:s};c(this,Nf).add(i);try{return await s.valueOrThrow()}finally{c(this,Nf).delete(i)}}async select(e){return ae(c(this,xs)!==null,"Cannot select device through detached session!"),ae(this.devices.includes(e),"Cannot select unknown device!"),ae(!c(this,El),"Cannot select DeviceRequestPrompt which is already handled!"),c(this,xs).off("DeviceAccess.deviceRequestPrompted",c(this,$f)),x(this,El,!0),await c(this,xs).send("DeviceAccess.selectPrompt",{id:c(this,xl),deviceId:e.id})}async cancel(){return ae(c(this,xs)!==null,"Cannot cancel prompt through detached session!"),ae(!c(this,El),"Cannot cancel DeviceRequestPrompt which is already handled!"),c(this,xs).off("DeviceAccess.deviceRequestPrompted",c(this,$f)),x(this,El,!0),await c(this,xs).send("DeviceAccess.cancelPrompt",{id:c(this,xl)})}}xs=new WeakMap,Hw=new WeakMap,xl=new WeakMap,El=new WeakMap,$f=new WeakMap,Nf=new WeakMap,Kw=new WeakSet,RO=function(e){if(e.id===c(this,xl))for(const t of e.devices){if(this.devices.some(s=>s.id===t.id))continue;const r=new RV(t.id,t.name);this.devices.push(r);for(const s of c(this,Nf))s.filter(r)&&s.promise.resolve(r)}};class $V{constructor(e,t){_(this,Kx);_(this,Ti);_(this,Ff);_(this,co,new Set);x(this,Ti,e),x(this,Ff,t),c(this,Ti).on("DeviceAccess.deviceRequestPrompted",r=>{A(this,Kx,nK).call(this,r)}),c(this,Ti).on("Target.detachedFromTarget",()=>{x(this,Ti,null)})}async waitForDevicePrompt(e={}){ae(c(this,Ti)!==null,"Cannot wait for device prompt through detached session!");const t=c(this,co).size===0;let r;t&&(r=c(this,Ti).send("DeviceAccess.enable"));const{timeout:s=c(this,Ff).timeout()}=e,i=qt.create({message:`Waiting for \`DeviceRequestPrompt\` failed: ${s}ms exceeded`,timeout:s});e.signal&&e.signal.addEventListener("abort",()=>{var a;i.reject((a=e.signal)==null?void 0:a.reason)},{once:!0}),c(this,co).add(i);try{const[a]=await Promise.all([i.valueOrThrow(),r]);return a}finally{c(this,co).delete(i)}}}Ti=new WeakMap,Ff=new WeakMap,co=new WeakMap,Kx=new WeakSet,nK=function(e){if(!c(this,co).size)return;ae(c(this,Ti)!==null);const t=new MV(c(this,Ti),c(this,Ff),e);for(const r of c(this,co))r.resolve(t);c(this,co).clear()};/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */function R$(n){let e,t;if(!n.exception)e="Error",t=n.text;else{if((n.exception.type!=="object"||n.exception.subtype!=="error")&&!n.exception.objectId)return cu(n.exception);{const o=M$(n);e=o.name,t=o.message}}const r=t.split(`
`).length,s=new Error(t);s.name=e;const i=s.stack.split(`
`),a=i.splice(0,r);if(i.shift(),n.stackTrace&&i.length<Error.stackTraceLimit)for(const o of n.stackTrace.callFrames.reverse()){if(as.isPuppeteerURL(o.url)&&o.url!==as.INTERNAL_URL){const u=as.parse(o.url);i.unshift(`    at ${o.functionName||u.functionName} (${u.functionName} at ${u.siteString}, <anonymous>:${o.lineNumber}:${o.columnNumber})`)}else i.push(`    at ${o.functionName||"<anonymous>"} (${o.url}:${o.lineNumber}:${o.columnNumber})`);if(i.length>=Error.stackTraceLimit)break}return s.stack=[...a,...i].join(`
`),s}const M$=n=>{var i,a,o,u;let e="",t;const r=((a=(i=n.exception)==null?void 0:i.description)==null?void 0:a.split(`
    at `))??[],s=Math.min(((o=n.stackTrace)==null?void 0:o.callFrames.length)??0,r.length-1);return r.splice(-s,s),(u=n.exception)!=null&&u.className&&(e=n.exception.className),t=r.join(`
`),e&&t.startsWith(`${e}: `)&&(t=t.slice(e.length+2)),{message:t,name:e}};function NV(n){let e,t;if(!n.exception)e="Error",t=n.text;else{if((n.exception.type!=="object"||n.exception.subtype!=="error")&&!n.exception.objectId)return cu(n.exception);{const o=M$(n);e=o.name,t=o.message}}const r=new Error(t);r.name=e;const s=r.message.split(`
`).length,i=r.stack.split(`
`).splice(0,s),a=[];if(n.stackTrace){for(const o of n.stackTrace.callFrames)if(a.push(`    at ${o.functionName||"<anonymous>"} (${o.url}:${o.lineNumber+1}:${o.columnNumber+1})`),a.length>=Error.stackTraceLimit)break}return r.stack=[...i,...a].join(`
`),r}function cu(n){if(ae(!n.objectId,"Cannot extract value when objectId is given"),n.unserializableValue){if(n.type==="bigint")return BigInt(n.unserializableValue.replace("n",""));switch(n.unserializableValue){case"-0":return-0;case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:throw new Error("Unsupported unserializable value: "+n.unserializableValue)}}return n.value}function $$(n,e,t){globalThis[e]||Object.assign(globalThis,{[e](...r){const s=globalThis[e];s.args??(s.args=new Map),s.callbacks??(s.callbacks=new Map);const i=(s.lastSeq??0)+1;return s.lastSeq=i,s.args.set(i,r),globalThis[t+e](JSON.stringify({type:n,name:e,seq:i,args:r,isTrivial:!r.some(a=>a instanceof Node)})),new Promise((a,o)=>{s.callbacks.set(i,{resolve(u){s.args.delete(i),a(u)},reject(u){s.args.delete(i),o(u)}})})}})}const bd="puppeteer_";function FV(n,e){return sk($$,n,e,bd)}/**
 * @license
 * Copyright 2019 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class xb extends ou{constructor(t,r){super();_(this,Lf,!1);_(this,rs);_(this,jf);x(this,jf,t),x(this,rs,r)}get disposed(){return c(this,Lf)}get realm(){return c(this,jf)}get client(){return this.realm.environment.client}async jsonValue(){if(!c(this,rs).objectId)return cu(c(this,rs));const t=await this.evaluate(r=>r);if(t===void 0)throw new Error("Could not serialize referenced object");return t}asElement(){return null}async dispose(){c(this,Lf)||(x(this,Lf,!0),await N$(this.client,c(this,rs)))}toString(){return c(this,rs).objectId?"JSHandle@"+(c(this,rs).subtype||c(this,rs).type):"JSHandle:"+cu(c(this,rs))}get id(){return c(this,rs).objectId}remoteObject(){return c(this,rs)}async getProperties(){const t=await this.client.send("Runtime.getProperties",{objectId:c(this,rs).objectId,ownProperties:!0}),r=new Map;for(const s of t.result)!s.enumerable||!s.value||r.set(s.name,c(this,jf).createCdpHandle(s.value));return r}}Lf=new WeakMap,rs=new WeakMap,jf=new WeakMap;async function N$(n,e){e.objectId&&await n.send("Runtime.releaseObject",{objectId:e.objectId}).catch(t=>{Ee(t)})}/**
 * @license
 * Copyright 2019 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var LV=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Eb=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};const jV=new Set(["StaticText","InlineTextBox"]);let F$=(()=>{var a,o,sK,l;let n=l$,e=[],t,r,s,i;return l=class extends n{constructor(f,p){super(new xb(f,p));_(this,o);_(this,a,LV(this,e))}get realm(){return this.handle.realm}get client(){return this.handle.client}remoteObject(){return this.handle.remoteObject()}get frame(){return this.realm.environment}async contentFrame(){const f=await this.client.send("DOM.describeNode",{objectId:this.id});return typeof f.node.frameId!="string"?null:c(this,o,sK).frame(f.node.frameId)}async scrollIntoView(){await this.assertConnectedElement();try{await this.client.send("DOM.scrollIntoViewIfNeeded",{objectId:this.id})}catch(f){Ee(f),await super.scrollIntoView()}}async uploadFile(...f){const p=await this.evaluate(y=>y.multiple);ae(f.length<=1||p,"Multiple file uploads only work with <input type=file multiple>");const m=Oo.value.path;if(m&&(f=f.map(y=>m.win32.isAbsolute(y)||m.posix.isAbsolute(y)?y:m.resolve(y))),f.length===0){await this.evaluate(y=>{y.files=new DataTransfer().files,y.dispatchEvent(new Event("input",{bubbles:!0,composed:!0})),y.dispatchEvent(new Event("change",{bubbles:!0}))});return}const{node:{backendNodeId:g}}=await this.client.send("DOM.describeNode",{objectId:this.id});await this.client.send("DOM.setFileInputFiles",{objectId:this.id,files:f,backendNodeId:g})}async autofill(f){const m=(await this.client.send("DOM.describeNode",{objectId:this.handle.id})).node.backendNodeId,g=this.frame._id;await this.client.send("Autofill.trigger",{fieldId:m,frameId:g,card:f.creditCard})}async*queryAXTree(f,p){const{nodes:m}=await this.client.send("Accessibility.queryAXTree",{objectId:this.id,accessibleName:f,role:p}),g=m.filter(y=>!(y.ignored||!y.role||jV.has(y.role.value)));return yield*gd.map(g,y=>this.realm.adoptBackendNode(y.backendDOMNodeId))}async backendNodeId(){if(c(this,a))return c(this,a);const{node:f}=await this.client.send("DOM.describeNode",{objectId:this.handle.id});return x(this,a,f.backendNodeId),c(this,a)}},a=new WeakMap,o=new WeakSet,sK=function(){return this.frame._frameManager},(()=>{const f=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[le()],r=[le(),mt],s=[le(),mt],i=[le()],Eb(l,null,t,{kind:"method",name:"contentFrame",static:!1,private:!1,access:{has:p=>"contentFrame"in p,get:p=>p.contentFrame},metadata:f},null,e),Eb(l,null,r,{kind:"method",name:"scrollIntoView",static:!1,private:!1,access:{has:p=>"scrollIntoView"in p,get:p=>p.scrollIntoView},metadata:f},null,e),Eb(l,null,s,{kind:"method",name:"uploadFile",static:!1,private:!1,access:{has:p=>"uploadFile"in p,get:p=>p.uploadFile},metadata:f},null,e),Eb(l,null,i,{kind:"method",name:"autofill",static:!1,private:!1,access:{has:p=>"autofill"in p,get:p=>p.autofill},metadata:f},null,e),f&&Object.defineProperty(l,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f})})(),l})();/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var DV=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},BV=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});const UV=new Sb("__ariaQuerySelector",au.queryOne,""),qV=new Sb("__ariaQuerySelectorAll",async(n,e)=>{const t=au.queryAll(n,e);return await n.realm.evaluateHandle((...r)=>r,...await gd.collect(t))},"");class L$ extends Ae{constructor(t,r,s){super();_(this,ns);_(this,bc);_(this,kl);_(this,Ii);_(this,Df);_(this,Ww,new lr);_(this,Cl,new Map);_(this,Wx,new ok);_(this,zw,!1);_(this,Sc);x(this,bc,t),x(this,kl,s),x(this,Ii,r.id),r.name&&x(this,Df,r.name);const i=c(this,Ww).use(new Ae(c(this,bc)));i.on("Runtime.bindingCalled",A(this,ns,aK).bind(this)),i.on("Runtime.executionContextDestroyed",async a=>{a.executionContextId===c(this,Ii)&&this[je]()}),i.on("Runtime.executionContextsCleared",async()=>{this[je]()}),i.on("Runtime.consoleAPICalled",A(this,ns,oK).bind(this)),i.on(Wt.Disconnected,()=>{this[je]()})}get id(){return c(this,Ii)}get puppeteerUtil(){let t=Promise.resolve();return c(this,zw)||(t=Promise.all([A(this,ns,MO).call(this,UV),A(this,ns,MO).call(this,qV)]),x(this,zw,!0)),Wp.inject(r=>{c(this,Sc)&&c(this,Sc).then(s=>{s.dispose()}),x(this,Sc,t.then(()=>this.evaluateHandle(r)))},!c(this,Sc)),c(this,Sc)}async evaluate(t,...r){return await A(this,ns,$O).call(this,!0,t,...r)}async evaluateHandle(t,...r){return await A(this,ns,$O).call(this,!1,t,...r)}[je](){c(this,Ww).dispose(),this.emit("disposed",void 0)}}bc=new WeakMap,kl=new WeakMap,Ii=new WeakMap,Df=new WeakMap,Ww=new WeakMap,Cl=new WeakMap,Wx=new WeakMap,ns=new WeakSet,iK=async function(t){const r={stack:[],error:void 0,hasError:!1};try{if(c(this,Cl).has(t.name))return;const s=DV(r,await c(this,Wx).acquire(),!1);try{await c(this,bc).send("Runtime.addBinding",c(this,Df)?{name:bd+t.name,executionContextName:c(this,Df)}:{name:bd+t.name,executionContextId:c(this,Ii)}),await this.evaluate($$,"internal",t.name,bd),c(this,Cl).set(t.name,t)}catch(i){if(i instanceof Error&&(i.message.includes("Execution context was destroyed")||i.message.includes("Cannot find context with specified id")))return;Ee(i)}}catch(s){r.error=s,r.hasError=!0}finally{BV(r)}},aK=async function(t){if(t.executionContextId!==c(this,Ii))return;let r;try{r=JSON.parse(t.payload)}catch{return}const{type:s,name:i,seq:a,args:o,isTrivial:u}=r;if(s!=="internal"){this.emit("bindingcalled",t);return}if(!c(this,Cl).has(i)){this.emit("bindingcalled",t);return}try{const l=c(this,Cl).get(i);await(l==null?void 0:l.run(this,a,o,u))}catch(l){Ee(l)}},oK=function(t){t.executionContextId===c(this,Ii)&&this.emit("consoleapicalled",t)},zw=new WeakMap,Sc=new WeakMap,MO=async function(t){try{await A(this,ns,iK).call(this,t)}catch(r){Ee(r)}},$O=async function(t,r,...s){var p;const i=YM(((p=GM(r))==null?void 0:p.toString())??as.INTERNAL_URL);if(Pa(r)){const m=c(this,Ii),g=r,y=ab.test(g)?g:`${g}
${i}
`,{exceptionDetails:w,result:v}=await c(this,bc).send("Runtime.evaluate",{expression:y,contextId:m,returnByValue:t,awaitPromise:!0,userGesture:!0}).catch(j$);if(w)throw R$(w);return t?cu(v):c(this,kl).createCdpHandle(v)}const a=ji(r),o=ab.test(a)?a:`${a}
${i}
`;let u;try{u=c(this,bc).send("Runtime.callFunctionOn",{functionDeclaration:o,executionContextId:c(this,Ii),arguments:s.some(m=>m instanceof os)?await Promise.all(s.map(m=>h(this,m))):s.map(m=>f(this,m)),returnByValue:t,awaitPromise:!0,userGesture:!0})}catch(m){throw m instanceof TypeError&&m.message.startsWith("Converting circular structure to JSON")&&(m.message+=" Recursive objects are not allowed."),m}const{exceptionDetails:l,result:d}=await u.catch(j$);if(l)throw R$(l);return t?cu(d):c(this,kl).createCdpHandle(d);async function h(m,g){return g instanceof os&&(g=await g.get(m)),f(m,g)}function f(m,g){if(typeof g=="bigint")return{unserializableValue:`${g.toString()}n`};if(Object.is(g,-0))return{unserializableValue:"-0"};if(Object.is(g,1/0))return{unserializableValue:"Infinity"};if(Object.is(g,-1/0))return{unserializableValue:"-Infinity"};if(Object.is(g,NaN))return{unserializableValue:"NaN"};const y=g&&(g instanceof xb||g instanceof F$)?g:null;if(y){if(y.realm!==c(m,kl))throw new Error("JSHandles can be evaluated only in the context they were created!");if(y.disposed)throw new Error("JSHandle is disposed!");return y.remoteObject().unserializableValue?{unserializableValue:y.remoteObject().unserializableValue}:y.remoteObject().objectId?{objectId:y.remoteObject().objectId}:{value:y.remoteObject().value}}return{value:g}}};const j$=n=>{if(n.message.includes("Object reference chain is too long"))return{result:{type:"undefined"}};if(n.message.includes("Object couldn't be returned by value"))return{result:{type:"undefined"}};throw n.message.endsWith("Cannot find context with specified id")||n.message.endsWith("Inspected target navigated or closed")?new Error("Execution context was destroyed, most likely because of a navigation."):n};/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Nr;(function(n){n.FrameAttached=Symbol("FrameManager.FrameAttached"),n.FrameNavigated=Symbol("FrameManager.FrameNavigated"),n.FrameDetached=Symbol("FrameManager.FrameDetached"),n.FrameSwapped=Symbol("FrameManager.FrameSwapped"),n.LifecycleEvent=Symbol("FrameManager.LifecycleEvent"),n.FrameNavigatedWithinDocument=Symbol("FrameManager.FrameNavigatedWithinDocument"),n.ConsoleApiCalled=Symbol("FrameManager.ConsoleApiCalled"),n.BindingCalled=Symbol("FrameManager.BindingCalled")})(Nr||(Nr={}));/**
 * @license
 * Copyright 2019 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class bk extends k${constructor(t,r){super(r);_(this,yn);_(this,fa);_(this,Oi,new Ae);_(this,xc);x(this,xc,t)}get environment(){return c(this,xc)}get client(){return c(this,xc).client}get emitter(){return c(this,Oi)}setContext(t){var r;(r=c(this,fa))==null||r[je](),t.once("disposed",A(this,yn,cK).bind(this)),t.on("consoleapicalled",A(this,yn,uK).bind(this)),t.on("bindingcalled",A(this,yn,lK).bind(this)),x(this,fa,t),c(this,Oi).emit("context",t),this.taskManager.rerunAll()}hasContext(){return!!c(this,fa)}get context(){return c(this,fa)}async evaluateHandle(t,...r){t=Mr(this.evaluateHandle.name,t);let s=A(this,yn,oE).call(this);return s||(s=await A(this,yn,cE).call(this)),await s.evaluateHandle(t,...r)}async evaluate(t,...r){t=Mr(this.evaluate.name,t);let s=A(this,yn,oE).call(this);return s||(s=await A(this,yn,cE).call(this)),await s.evaluate(t,...r)}async adoptBackendNode(t){let r=A(this,yn,oE).call(this);r||(r=await A(this,yn,cE).call(this));const{object:s}=await this.client.send("DOM.resolveNode",{backendNodeId:t,executionContextId:r.id});return this.createCdpHandle(s)}async adoptHandle(t){if(t.realm===this)return await t.evaluateHandle(s=>s);const r=await this.client.send("DOM.describeNode",{objectId:t.id});return await this.adoptBackendNode(r.node.backendNodeId)}async transferHandle(t){if(t.realm===this||t.remoteObject().objectId===void 0)return t;const r=await this.client.send("DOM.describeNode",{objectId:t.remoteObject().objectId}),s=await this.adoptBackendNode(r.node.backendNodeId);return await t.dispose(),s}createCdpHandle(t){return t.subtype==="node"?new F$(this,t):new xb(this,t)}[je](){var t;(t=c(this,fa))==null||t[je](),c(this,Oi).emit("disposed",void 0),super[je](),c(this,Oi).removeAllListeners()}}fa=new WeakMap,Oi=new WeakMap,xc=new WeakMap,yn=new WeakSet,cK=function(){x(this,fa,void 0),"clearDocumentHandle"in c(this,xc)&&c(this,xc).clearDocumentHandle()},uK=function(t){c(this,Oi).emit("consoleapicalled",t)},lK=function(t){c(this,Oi).emit("bindingcalled",t)},oE=function(){if(this.disposed)throw new Error(`Execution context is not available in detached frame or worker "${this.environment.url()}" (are you trying to evaluate?)`);return c(this,fa)},cE=async function(){const t=new Error("Execution context was destroyed");return await Or(It(c(this,Oi),"context").pipe(Vr(It(c(this,Oi),"disposed").pipe(ar(()=>{throw t})),Fn(this.timeoutSettings.timeout()))))};/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const Ki=Symbol("mainWorld"),kb=Symbol("puppeteerWorld");/**
 * @license
 * Copyright 2019 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const HV=new Map([["load","load"],["domcontentloaded","DOMContentLoaded"],["networkidle0","networkIdle"],["networkidle2","networkAlmostIdle"]]);class Sk{constructor(e,t,r,s,i){_(this,Zt);_(this,Vw);_(this,Ec);_(this,Bf);_(this,kc,null);_(this,Pl,new lr);_(this,Gw);_(this,Cc);_(this,Zw,qt.create());_(this,Jw,qt.create());_(this,Xw,qt.create());_(this,Yw);_(this,Qw);_(this,uo);Array.isArray(r)?r=r.slice():typeof r=="string"&&(r=[r]),x(this,Gw,t._loaderId),x(this,Vw,r.map(l=>{const d=HV.get(l);return ae(d,"Unknown value for options.waitUntil: "+l),d})),i==null||i.addEventListener("abort",()=>{c(this,Cc).reject(i.reason)}),x(this,Ec,t),x(this,Bf,s),c(this,Pl).use(new Ae(t._frameManager)).on(Nr.LifecycleEvent,A(this,Zt,ed).bind(this));const o=c(this,Pl).use(new Ae(t));o.on(Gr.FrameNavigatedWithinDocument,A(this,Zt,mK).bind(this)),o.on(Gr.FrameNavigated,A(this,Zt,gK).bind(this)),o.on(Gr.FrameSwapped,A(this,Zt,uE).bind(this)),o.on(Gr.FrameSwappedByActivation,A(this,Zt,uE).bind(this)),o.on(Gr.FrameDetached,A(this,Zt,pK).bind(this));const u=c(this,Pl).use(new Ae(e));u.on($r.Request,A(this,Zt,dK).bind(this)),u.on($r.Response,A(this,Zt,fK).bind(this)),u.on($r.RequestFailed,A(this,Zt,hK).bind(this)),x(this,Cc,qt.create({timeout:c(this,Bf),message:`Navigation timeout of ${c(this,Bf)} ms exceeded`})),A(this,Zt,ed).call(this)}async navigationResponse(){var e;return await((e=c(this,uo))==null?void 0:e.valueOrThrow()),c(this,kc)?c(this,kc).response():null}sameDocumentNavigationPromise(){return c(this,Zw).valueOrThrow()}newDocumentNavigationPromise(){return c(this,Xw).valueOrThrow()}lifecyclePromise(){return c(this,Jw).valueOrThrow()}terminationPromise(){return c(this,Cc).valueOrThrow()}dispose(){c(this,Pl).dispose(),c(this,Cc).resolve(new Error("LifecycleWatcher disposed"))}}Vw=new WeakMap,Ec=new WeakMap,Bf=new WeakMap,kc=new WeakMap,Pl=new WeakMap,Gw=new WeakMap,Cc=new WeakMap,Zw=new WeakMap,Jw=new WeakMap,Xw=new WeakMap,Yw=new WeakMap,Qw=new WeakMap,uo=new WeakMap,Zt=new WeakSet,dK=function(e){var t,r;e.frame()!==c(this,Ec)||!e.isNavigationRequest()||(x(this,kc,e),(t=c(this,uo))==null||t.resolve(),x(this,uo,qt.create()),e.response()!==null&&((r=c(this,uo))==null||r.resolve()))},hK=function(e){var t,r;((t=c(this,kc))==null?void 0:t.id)===e.id&&((r=c(this,uo))==null||r.resolve())},fK=function(e){var t,r;((t=c(this,kc))==null?void 0:t.id)===e.request().id&&((r=c(this,uo))==null||r.resolve())},pK=function(e){if(c(this,Ec)===e){c(this,Cc).resolve(new Error("Navigating frame was detached"));return}A(this,Zt,ed).call(this)},mK=function(){x(this,Yw,!0),A(this,Zt,ed).call(this)},gK=function(e){if(e==="BackForwardCacheRestore")return A(this,Zt,uE).call(this);A(this,Zt,ed).call(this)},uE=function(){x(this,Qw,!0),A(this,Zt,ed).call(this)},ed=function(){if(!e(c(this,Ec),c(this,Vw)))return;c(this,Jw).resolve(),c(this,Yw)&&c(this,Zw).resolve(void 0),(c(this,Qw)||c(this,Ec)._loaderId!==c(this,Gw))&&c(this,Xw).resolve(void 0);function e(t,r){for(const s of r)if(!t._lifecycleEvents.has(s))return!1;for(const s of t.childFrames())if(s._hasStartedLoading&&!e(s,r))return!1;return!0}};/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var KV=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},uu=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let D$=(()=>{var l,d,h,f,yK,wK,vK,y;let n=h$,e=[],t,r,s,i,a,o,u;return y=class extends n{constructor(b,S,P,k){super();_(this,f);_(this,l,(KV(this,e),""));_(this,d,!1);_(this,h);J(this,"_frameManager");J(this,"_loaderId","");J(this,"_lifecycleEvents",new Set);J(this,"_id");J(this,"_parentId");J(this,"accessibility");J(this,"worlds");this._frameManager=b,x(this,l,""),this._id=S,this._parentId=P,x(this,d,!1),x(this,h,k),this._loaderId="",this.worlds={[Ki]:new bk(this,this._frameManager.timeoutSettings),[kb]:new bk(this,this._frameManager.timeoutSettings)},this.accessibility=new P$(this.worlds[Ki],S),this.on(Gr.FrameSwappedByActivation,()=>{this._onLoadingStarted(),this._onLoadingStopped()}),this.worlds[Ki].emitter.on("consoleapicalled",A(this,f,yK).bind(this)),this.worlds[Ki].emitter.on("bindingcalled",A(this,f,wK).bind(this))}_client(){return c(this,h)}updateId(b){this._id=b}updateClient(b){x(this,h,b)}page(){return this._frameManager.page()}async goto(b,S={}){const{referer:P=this._frameManager.networkManager.extraHTTPHeaders().referer,referrerPolicy:k=this._frameManager.networkManager.extraHTTPHeaders()["referer-policy"],waitUntil:C=["load"],timeout:E=this._frameManager.timeoutSettings.navigationTimeout()}=S;let M=!1;const I=new Sk(this._frameManager.networkManager,this,C,E);let N=await qt.race([O(c(this,h),b,P,k,this._id),I.terminationPromise()]);N||(N=await qt.race([I.terminationPromise(),M?I.newDocumentNavigationPromise():I.sameDocumentNavigationPromise()]));try{if(N)throw N;return await I.navigationResponse()}finally{I.dispose()}async function O(T,L,U,Z,j){try{const F=await T.send("Page.navigate",{url:L,referrer:U,frameId:j,referrerPolicy:Z});return M=!!F.loaderId,F.errorText==="net::ERR_HTTP_RESPONSE_CODE_FAILURE"?null:F.errorText?new Error(`${F.errorText} at ${L}`):null}catch(F){if(Ts(F))return F;throw F}}}async waitForNavigation(b={}){const{waitUntil:S=["load"],timeout:P=this._frameManager.timeoutSettings.navigationTimeout(),signal:k}=b,C=new Sk(this._frameManager.networkManager,this,S,P,k),E=await qt.race([C.terminationPromise(),...b.ignoreSameDocumentNavigation?[]:[C.sameDocumentNavigationPromise()],C.newDocumentNavigationPromise()]);try{if(E)throw E;const M=await qt.race([C.terminationPromise(),C.navigationResponse()]);if(M instanceof Error)throw E;return M||null}finally{C.dispose()}}get client(){return c(this,h)}mainRealm(){return this.worlds[Ki]}isolatedRealm(){return this.worlds[kb]}async setContent(b,S={}){const{waitUntil:P=["load"],timeout:k=this._frameManager.timeoutSettings.navigationTimeout()}=S;await this.setFrameContent(b);const C=new Sk(this._frameManager.networkManager,this,P,k),E=await qt.race([C.terminationPromise(),C.lifecyclePromise()]);if(C.dispose(),E)throw E}url(){return c(this,l)}parentFrame(){return this._frameManager._frameTree.parentFrame(this._id)||null}childFrames(){return this._frameManager._frameTree.childFrames(this._id)}async addPreloadScript(b){const S=this.parentFrame();if(S&&c(this,h)===S.client||b.getIdForFrame(this))return;const{identifier:P}=await c(this,h).send("Page.addScriptToEvaluateOnNewDocument",{source:b.source});b.setIdForFrame(this,P)}async addExposedFunctionBinding(b){this!==this._frameManager.mainFrame()&&!this._hasStartedLoading||await Promise.all([c(this,h).send("Runtime.addBinding",{name:bd+b.name}),this.evaluate(b.initSource).catch(Ee)])}async removeExposedFunctionBinding(b){this!==this._frameManager.mainFrame()&&!this._hasStartedLoading||await Promise.all([c(this,h).send("Runtime.removeBinding",{name:bd+b.name}),this.evaluate(S=>{globalThis[S]=void 0},b.name).catch(Ee)])}async waitForDevicePrompt(b={}){return await A(this,f,vK).call(this).waitForDevicePrompt(b)}_navigated(b){this._name=b.name,x(this,l,`${b.url}${b.urlFragment||""}`)}_navigatedWithinDocument(b){x(this,l,b)}_onLifecycleEvent(b,S){S==="init"&&(this._loaderId=b,this._lifecycleEvents.clear()),this._lifecycleEvents.add(S)}_onLoadingStopped(){this._lifecycleEvents.add("DOMContentLoaded"),this._lifecycleEvents.add("load")}_onLoadingStarted(){this._hasStartedLoading=!0}get detached(){return c(this,d)}[(t=[ut],r=[ut],s=[ut],i=[ut],a=[ut],o=[ut],u=[ut],je)](){c(this,d)||(x(this,d,!0),this.worlds[Ki][je](),this.worlds[kb][je]())}exposeFunction(){throw new He}async frameElement(){const b=this.parentFrame();if(!b)return null;const{backendNodeId:S}=await b.client.send("DOM.getFrameOwner",{frameId:this._id});return await b.mainRealm().adoptBackendNode(S)}},l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakSet,yK=function(b){this._frameManager.emit(Nr.ConsoleApiCalled,[this.worlds[Ki],b])},wK=function(b){this._frameManager.emit(Nr.BindingCalled,[this.worlds[Ki],b])},vK=function(){return this._frameManager._deviceRequestPromptManager(c(this,h))},(()=>{const b=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;uu(y,null,t,{kind:"method",name:"goto",static:!1,private:!1,access:{has:S=>"goto"in S,get:S=>S.goto},metadata:b},null,e),uu(y,null,r,{kind:"method",name:"waitForNavigation",static:!1,private:!1,access:{has:S=>"waitForNavigation"in S,get:S=>S.waitForNavigation},metadata:b},null,e),uu(y,null,s,{kind:"method",name:"setContent",static:!1,private:!1,access:{has:S=>"setContent"in S,get:S=>S.setContent},metadata:b},null,e),uu(y,null,i,{kind:"method",name:"addPreloadScript",static:!1,private:!1,access:{has:S=>"addPreloadScript"in S,get:S=>S.addPreloadScript},metadata:b},null,e),uu(y,null,a,{kind:"method",name:"addExposedFunctionBinding",static:!1,private:!1,access:{has:S=>"addExposedFunctionBinding"in S,get:S=>S.addExposedFunctionBinding},metadata:b},null,e),uu(y,null,o,{kind:"method",name:"removeExposedFunctionBinding",static:!1,private:!1,access:{has:S=>"removeExposedFunctionBinding"in S,get:S=>S.removeExposedFunctionBinding},metadata:b},null,e),uu(y,null,u,{kind:"method",name:"waitForDevicePrompt",static:!1,private:!1,access:{has:S=>"waitForDevicePrompt"in S,get:S=>S.waitForDevicePrompt},metadata:b},null,e),b&&Object.defineProperty(y,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:b})})(),y})();/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class WV{constructor(){_(this,Al,new Map);_(this,Uf,new Map);_(this,Pc,new Map);_(this,qf);_(this,Hf,!1);_(this,ev,new Map)}getMainFrame(){return c(this,qf)}getById(e){return c(this,Al).get(e)}waitForFrame(e){const t=this.getById(e);if(t)return Promise.resolve(t);const r=qt.create();return(c(this,ev).get(e)||new Set).add(r),r.valueOrThrow()}frames(){return Array.from(c(this,Al).values())}addFrame(e){var t;c(this,Al).set(e._id,e),e._parentId?(c(this,Uf).set(e._id,e._parentId),c(this,Pc).has(e._parentId)||c(this,Pc).set(e._parentId,new Set),c(this,Pc).get(e._parentId).add(e._id)):(!c(this,qf)||c(this,Hf))&&(x(this,qf,e),x(this,Hf,!1)),(t=c(this,ev).get(e._id))==null||t.forEach(r=>r.resolve(e))}removeFrame(e){var t;c(this,Al).delete(e._id),c(this,Uf).delete(e._id),e._parentId?(t=c(this,Pc).get(e._parentId))==null||t.delete(e._id):x(this,Hf,!0)}childFrames(e){const t=c(this,Pc).get(e);return t?Array.from(t).map(r=>this.getById(r)).filter(r=>r!==void 0):[]}parentFrame(e){const t=c(this,Uf).get(e);return t?this.getById(t):void 0}}Al=new WeakMap,Uf=new WeakMap,Pc=new WeakMap,qf=new WeakMap,Hf=new WeakMap,ev=new WeakMap;class xk extends _b{constructor(t,r,s,i,a,o){super();J(this,"id");_(this,pa);_(this,tv);_(this,rv);_(this,nv);_(this,sv);_(this,iv,!1);_(this,av);_(this,ov,{});_(this,cv);_(this,uv);x(this,pa,t),this.id=a.requestId,x(this,tv,a.requestId===a.loaderId&&a.type==="Document"),this._interceptionId=s,x(this,rv,a.request.url+(a.request.urlFragment??"")),x(this,nv,(a.type||"other").toLowerCase()),x(this,sv,a.request.method),x(this,av,a.request.postData),x(this,iv,a.request.hasPostData??!1),x(this,cv,r),this._redirectChain=o,x(this,uv,a.initiator),this.interception.enabled=i;for(const[u,l]of Object.entries(a.request.headers))c(this,ov)[u.toLowerCase()]=l}get client(){return c(this,pa)}set client(t){x(this,pa,t)}url(){return c(this,rv)}resourceType(){return c(this,nv)}method(){return c(this,sv)}postData(){return c(this,av)}hasPostData(){return c(this,iv)}async fetchPostData(){try{return(await c(this,pa).send("Network.getRequestPostData",{requestId:this.id})).postData}catch(t){Ee(t);return}}headers(){return c(this,ov)}response(){return this._response}frame(){return c(this,cv)}isNavigationRequest(){return c(this,tv)}initiator(){return c(this,uv)}redirectChain(){return this._redirectChain.slice()}failure(){return this._failureText?{errorText:this._failureText}:null}async _continue(t={}){const{url:r,method:s,postData:i,headers:a}=t;this.interception.handled=!0;const o=i?WM(i):void 0;if(this._interceptionId===void 0)throw new Error("HTTPRequest is missing _interceptionId needed for Fetch.continueRequest");await c(this,pa).send("Fetch.continueRequest",{requestId:this._interceptionId,url:r,method:s,postData:o,headers:a?f$(a):void 0}).catch(u=>(this.interception.handled=!1,bb(u)))}async _respond(t){this.interception.handled=!0;let r;t.body&&(r=_b.getResponse(t.body));const s={};if(t.headers)for(const a of Object.keys(t.headers)){const o=t.headers[a];s[a.toLowerCase()]=Array.isArray(o)?o.map(u=>String(u)):String(o)}t.contentType&&(s["content-type"]=t.contentType),r!=null&&r.contentLength&&!("content-length"in s)&&(s["content-length"]=String(r.contentLength));const i=t.status||200;if(this._interceptionId===void 0)throw new Error("HTTPRequest is missing _interceptionId needed for Fetch.fulfillRequest");await c(this,pa).send("Fetch.fulfillRequest",{requestId:this._interceptionId,responseCode:i,responsePhrase:p$[i],responseHeaders:f$(s),body:r==null?void 0:r.base64}).catch(a=>(this.interception.handled=!1,bb(a)))}async _abort(t){if(this.interception.handled=!0,this._interceptionId===void 0)throw new Error("HTTPRequest is missing _interceptionId needed for Fetch.failRequest");await c(this,pa).send("Fetch.failRequest",{requestId:this._interceptionId,errorReason:t||"Failed"}).catch(bb)}}pa=new WeakMap,tv=new WeakMap,rv=new WeakMap,nv=new WeakMap,sv=new WeakMap,iv=new WeakMap,av=new WeakMap,ov=new WeakMap,cv=new WeakMap,uv=new WeakMap;/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class B${constructor(e){_(this,lv);_(this,dv);_(this,hv);_(this,fv);_(this,pv);_(this,mv);x(this,lv,e.subjectName),x(this,dv,e.issuer),x(this,hv,e.validFrom),x(this,fv,e.validTo),x(this,pv,e.protocol),x(this,mv,e.sanList)}issuer(){return c(this,dv)}validFrom(){return c(this,hv)}validTo(){return c(this,fv)}protocol(){return c(this,pv)}subjectName(){return c(this,lv)}subjectAlternativeNames(){return c(this,mv)}}lv=new WeakMap,dv=new WeakMap,hv=new WeakMap,fv=new WeakMap,pv=new WeakMap,mv=new WeakMap;class U$ extends m${constructor(t,r,s){super();_(this,zx);_(this,ma);_(this,Kf,null);_(this,Wf,qt.create());_(this,gv);_(this,yv);_(this,wv);_(this,vv);_(this,_v);_(this,bv,{});_(this,Sv);_(this,xv);x(this,ma,t),x(this,gv,{ip:r.remoteIPAddress,port:r.remotePort}),x(this,wv,A(this,zx,_K).call(this,s)||r.statusText),x(this,vv,!!r.fromDiskCache),x(this,_v,!!r.fromServiceWorker),x(this,yv,s?s.statusCode:r.status);const i=s?s.headers:r.headers;for(const[a,o]of Object.entries(i))c(this,bv)[a.toLowerCase()]=o;x(this,Sv,r.securityDetails?new B$(r.securityDetails):null),x(this,xv,r.timing||null)}_resolveBody(t){return t?c(this,Wf).reject(t):c(this,Wf).resolve()}remoteAddress(){return c(this,gv)}url(){return c(this,ma).url()}status(){return c(this,yv)}statusText(){return c(this,wv)}headers(){return c(this,bv)}securityDetails(){return c(this,Sv)}timing(){return c(this,xv)}content(){return c(this,Kf)||x(this,Kf,c(this,Wf).valueOrThrow().then(async()=>{try{const t=await c(this,ma).client.send("Network.getResponseBody",{requestId:c(this,ma).id});return rk(t.body,t.base64Encoded)}catch(t){throw t instanceof su&&t.originalMessage==="No resource with given identifier found"?new su("Could not load body for this request. This might happen if the request is a preflight request."):t}})),c(this,Kf)}request(){return c(this,ma)}fromCache(){return c(this,vv)||c(this,ma)._fromMemoryCache}fromServiceWorker(){return c(this,_v)}frame(){return c(this,ma).frame()}}ma=new WeakMap,Kf=new WeakMap,Wf=new WeakMap,gv=new WeakMap,yv=new WeakMap,wv=new WeakMap,vv=new WeakMap,_v=new WeakMap,bv=new WeakMap,Sv=new WeakMap,xv=new WeakMap,zx=new WeakSet,_K=function(t){if(!t||!t.headersText)return;const r=t.headersText.split("\r",1)[0];if(!r||r.length>1e3)return;const s=r.match(/[^ ]* [^ ]* (.*)/);if(!s)return;const i=s[1];if(i)return i};/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class zV{constructor(){_(this,Ac,new Map);_(this,Tc,new Map);_(this,Ic,new Map);_(this,Oc,new Map);_(this,Tl,new Map);_(this,Il,new Map)}forget(e){c(this,Ac).delete(e),c(this,Tc).delete(e),c(this,Il).delete(e),c(this,Tl).delete(e),c(this,Oc).delete(e)}responseExtraInfo(e){return c(this,Oc).has(e)||c(this,Oc).set(e,[]),c(this,Oc).get(e)}queuedRedirectInfo(e){return c(this,Tl).has(e)||c(this,Tl).set(e,[]),c(this,Tl).get(e)}queueRedirectInfo(e,t){this.queuedRedirectInfo(e).push(t)}takeQueuedRedirectInfo(e){return this.queuedRedirectInfo(e).shift()}inFlightRequestsCount(){let e=0;for(const t of c(this,Ic).values())t.response()||e++;return e}storeRequestWillBeSent(e,t){c(this,Ac).set(e,t)}getRequestWillBeSent(e){return c(this,Ac).get(e)}forgetRequestWillBeSent(e){c(this,Ac).delete(e)}getRequestPaused(e){return c(this,Tc).get(e)}forgetRequestPaused(e){c(this,Tc).delete(e)}storeRequestPaused(e,t){c(this,Tc).set(e,t)}getRequest(e){return c(this,Ic).get(e)}storeRequest(e,t){c(this,Ic).set(e,t)}forgetRequest(e){c(this,Ic).delete(e)}getQueuedEventGroup(e){return c(this,Il).get(e)}queueEventGroup(e,t){c(this,Il).set(e,t)}forgetQueuedEventGroup(e){c(this,Il).delete(e)}printState(){function e(t,r){return r instanceof Map?{dataType:"Map",value:Array.from(r.entries())}:r instanceof xk?{dataType:"CdpHTTPRequest",value:`${r.id}: ${r.url()}`}:r}console.log("httpRequestsMap",JSON.stringify(c(this,Ic),e,2)),console.log("requestWillBeSentMap",JSON.stringify(c(this,Ac),e,2)),console.log("requestWillBeSentMap",JSON.stringify(c(this,Oc),e,2)),console.log("requestWillBeSentMap",JSON.stringify(c(this,Tc),e,2))}}Ac=new WeakMap,Tc=new WeakMap,Ic=new WeakMap,Oc=new WeakMap,Tl=new WeakMap,Il=new WeakMap;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class VV extends Ae{constructor(t){super();_(this,pe);_(this,zf);_(this,wt,new zV);_(this,Ol);_(this,Rc,null);_(this,Vf,new Set);_(this,ga,!1);_(this,lo,!1);_(this,Mc);_(this,wn);_(this,Gf);_(this,Ev);_(this,Vx,[["Fetch.requestPaused",A(this,pe,EK)],["Fetch.authRequired",A(this,pe,xK)],["Network.requestWillBeSent",A(this,pe,SK)],["Network.requestServedFromCache",A(this,pe,CK)],["Network.responseReceived",A(this,pe,AK)],["Network.loadingFinished",A(this,pe,IK)],["Network.loadingFailed",A(this,pe,OK)],["Network.responseReceivedExtraInfo",A(this,pe,TK)],[Wt.Disconnected,A(this,pe,bK)]]);_(this,$c,new Map);x(this,zf,t)}async addClient(t){if(c(this,$c).has(t))return;const r=new lr;c(this,$c).set(t,r);const s=r.use(new Ae(t));for(const[i,a]of c(this,Vx))s.on(i,o=>a.bind(this)(t,o));await Promise.all([t.send("Network.enable"),A(this,pe,NO).call(this,t),A(this,pe,lE).call(this,t),A(this,pe,I_).call(this,t),A(this,pe,dE).call(this,t),A(this,pe,FO).call(this,t)])}async authenticate(t){x(this,Rc,t);const r=c(this,ga)||!!c(this,Rc);r!==c(this,lo)&&(x(this,lo,r),await A(this,pe,Xc).call(this,A(this,pe,dE).bind(this)))}async setExtraHTTPHeaders(t){const r={};for(const[s,i]of Object.entries(t))ae(Pa(i),`Expected value of header "${s}" to be String, but "${typeof i}" is found.`),r[s.toLowerCase()]=i;x(this,Ol,r),await A(this,pe,Xc).call(this,A(this,pe,NO).bind(this))}extraHTTPHeaders(){return Object.assign({},c(this,Ol))}inFlightRequestsCount(){return c(this,wt).inFlightRequestsCount()}async setOfflineMode(t){c(this,wn)||x(this,wn,{offline:!1,upload:-1,download:-1,latency:0}),c(this,wn).offline=t,await A(this,pe,Xc).call(this,A(this,pe,lE).bind(this))}async emulateNetworkConditions(t){c(this,wn)||x(this,wn,{offline:!1,upload:-1,download:-1,latency:0}),c(this,wn).upload=t?t.upload:-1,c(this,wn).download=t?t.download:-1,c(this,wn).latency=t?t.latency:0,await A(this,pe,Xc).call(this,A(this,pe,lE).bind(this))}async setUserAgent(t,r){x(this,Gf,t),x(this,Ev,r),await A(this,pe,Xc).call(this,A(this,pe,FO).bind(this))}async setCacheEnabled(t){x(this,Mc,!t),await A(this,pe,Xc).call(this,A(this,pe,I_).bind(this))}async setRequestInterception(t){x(this,ga,t);const r=c(this,ga)||!!c(this,Rc);r!==c(this,lo)&&(x(this,lo,r),await A(this,pe,Xc).call(this,A(this,pe,dE).bind(this)))}}zf=new WeakMap,wt=new WeakMap,Ol=new WeakMap,Rc=new WeakMap,Vf=new WeakMap,ga=new WeakMap,lo=new WeakMap,Mc=new WeakMap,wn=new WeakMap,Gf=new WeakMap,Ev=new WeakMap,Vx=new WeakMap,$c=new WeakMap,pe=new WeakSet,bK=async function(t){var r;(r=c(this,$c).get(t))==null||r.dispose(),c(this,$c).delete(t)},NO=async function(t){c(this,Ol)!==void 0&&await t.send("Network.setExtraHTTPHeaders",{headers:c(this,Ol)})},Xc=async function(t){await Promise.all(Array.from(c(this,$c).keys()).map(r=>t(r)))},lE=async function(t){c(this,wn)!==void 0&&await t.send("Network.emulateNetworkConditions",{offline:c(this,wn).offline,latency:c(this,wn).latency,uploadThroughput:c(this,wn).upload,downloadThroughput:c(this,wn).download})},FO=async function(t){c(this,Gf)!==void 0&&await t.send("Network.setUserAgentOverride",{userAgent:c(this,Gf),userAgentMetadata:c(this,Ev)})},dE=async function(t){c(this,Mc)===void 0&&x(this,Mc,!1),c(this,lo)?await Promise.all([A(this,pe,I_).call(this,t),t.send("Fetch.enable",{handleAuthRequests:!0,patterns:[{urlPattern:"*"}]})]):await Promise.all([A(this,pe,I_).call(this,t),t.send("Fetch.disable")])},I_=async function(t){c(this,Mc)!==void 0&&await t.send("Network.setCacheDisabled",{cacheDisabled:c(this,Mc)})},SK=function(t,r){if(c(this,ga)&&!r.request.url.startsWith("data:")){const{requestId:s}=r;c(this,wt).storeRequestWillBeSent(s,r);const i=c(this,wt).getRequestPaused(s);if(i){const{requestId:a}=i;A(this,pe,LO).call(this,r,i),A(this,pe,Tp).call(this,t,r,a),c(this,wt).forgetRequestPaused(s)}return}A(this,pe,Tp).call(this,t,r,void 0)},xK=function(t,r){let s="Default";c(this,Vf).has(r.requestId)?s="CancelAuth":c(this,Rc)&&(s="ProvideCredentials",c(this,Vf).add(r.requestId));const{username:i,password:a}=c(this,Rc)||{username:void 0,password:void 0};t.send("Fetch.continueWithAuth",{requestId:r.requestId,authChallengeResponse:{response:s,username:i,password:a}}).catch(Ee)},EK=function(t,r){!c(this,ga)&&c(this,lo)&&t.send("Fetch.continueRequest",{requestId:r.requestId}).catch(Ee);const{networkId:s,requestId:i}=r;if(!s){A(this,pe,kK).call(this,t,r);return}const a=(()=>{const o=c(this,wt).getRequestWillBeSent(s);if(o&&(o.request.url!==r.request.url||o.request.method!==r.request.method)){c(this,wt).forgetRequestWillBeSent(s);return}return o})();a?(A(this,pe,LO).call(this,a,r),A(this,pe,Tp).call(this,t,a,i)):c(this,wt).storeRequestPaused(s,r)},LO=function(t,r){t.request.headers={...t.request.headers,...r.request.headers}},kK=function(t,r){const s=r.frameId?c(this,zf).frame(r.frameId):null,i=new xk(t,s,r.requestId,c(this,ga),r,[]);this.emit($r.Request,i),i.finalizeInterceptions()},Tp=function(t,r,s,i=!1){let a=[];if(r.redirectResponse){let l=null;if(r.redirectHasExtraInfo&&(l=c(this,wt).responseExtraInfo(r.requestId).shift(),!l)){c(this,wt).queueRedirectInfo(r.requestId,{event:r,fetchRequestId:s});return}const d=c(this,wt).getRequest(r.requestId);d&&(A(this,pe,PK).call(this,t,d,r.redirectResponse,l),a=d._redirectChain)}const o=r.frameId?c(this,zf).frame(r.frameId):null,u=new xk(t,o,s,c(this,ga),r,a);u._fromMemoryCache=i,c(this,wt).storeRequest(r.requestId,u),this.emit($r.Request,u),u.finalizeInterceptions()},CK=function(t,r){const s=c(this,wt).getRequestWillBeSent(r.requestId);let i=c(this,wt).getRequest(r.requestId);if(i&&(i._fromMemoryCache=!0),!i&&s&&(A(this,pe,Tp).call(this,t,s,void 0,!0),i=c(this,wt).getRequest(r.requestId)),!i){Ee(new Error(`Request ${r.requestId} was served from cache but we could not find the corresponding request object`));return}this.emit($r.RequestServedFromCache,i)},PK=function(t,r,s,i){const a=new U$(r,s,i);r._response=a,r._redirectChain.push(r),a._resolveBody(new Error("Response body is unavailable for redirect responses")),A(this,pe,hE).call(this,r,!1),this.emit($r.Response,a),this.emit($r.RequestFinished,r)},jO=function(t,r,s){const i=c(this,wt).getRequest(r.requestId);if(!i)return;c(this,wt).responseExtraInfo(r.requestId).length&&Ee(new Error("Unexpected extraInfo events for request "+r.requestId)),r.response.fromDiskCache&&(s=null);const o=new U$(i,r.response,s);i._response=o,this.emit($r.Response,o)},AK=function(t,r){const s=c(this,wt).getRequest(r.requestId);let i=null;if(s&&!s._fromMemoryCache&&r.hasExtraInfo&&(i=c(this,wt).responseExtraInfo(r.requestId).shift(),!i)){c(this,wt).queueEventGroup(r.requestId,{responseReceivedEvent:r});return}A(this,pe,jO).call(this,t,r,i)},TK=function(t,r){const s=c(this,wt).takeQueuedRedirectInfo(r.requestId);if(s){c(this,wt).responseExtraInfo(r.requestId).push(r),A(this,pe,Tp).call(this,t,s.event,s.fetchRequestId);return}const i=c(this,wt).getQueuedEventGroup(r.requestId);if(i){c(this,wt).forgetQueuedEventGroup(r.requestId),A(this,pe,jO).call(this,t,i.responseReceivedEvent,r),i.loadingFinishedEvent&&A(this,pe,DO).call(this,t,i.loadingFinishedEvent),i.loadingFailedEvent&&A(this,pe,BO).call(this,t,i.loadingFailedEvent);return}c(this,wt).responseExtraInfo(r.requestId).push(r)},hE=function(t,r){const s=t.id,i=t._interceptionId;c(this,wt).forgetRequest(s),i!==void 0&&c(this,Vf).delete(i),r&&c(this,wt).forget(s)},IK=function(t,r){const s=c(this,wt).getQueuedEventGroup(r.requestId);s?s.loadingFinishedEvent=r:A(this,pe,DO).call(this,t,r)},DO=function(t,r){var i;const s=c(this,wt).getRequest(r.requestId);s&&(A(this,pe,UO).call(this,t,s),s.response()&&((i=s.response())==null||i._resolveBody()),A(this,pe,hE).call(this,s,!0),this.emit($r.RequestFinished,s))},OK=function(t,r){const s=c(this,wt).getQueuedEventGroup(r.requestId);s?s.loadingFailedEvent=r:A(this,pe,BO).call(this,t,r)},BO=function(t,r){const s=c(this,wt).getRequest(r.requestId);if(!s)return;A(this,pe,UO).call(this,t,s),s._failureText=r.errorText;const i=s.response();i&&i._resolveBody(),A(this,pe,hE).call(this,s,!0),this.emit($r.RequestFailed,s)},UO=function(t,r){t!==r.client&&r.isNavigationRequest()&&(r.client=t)};/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const GV=100;class ZV extends Ae{constructor(t,r,s){super();_(this,ft);_(this,kv);_(this,Nc);_(this,Zf);_(this,Cv,new Set);_(this,Vs);_(this,Rl,new Map);_(this,Jf,new Set);J(this,"_frameTree",new WV);_(this,Ml,new Set);_(this,Pv,new WeakMap);_(this,Mn);x(this,Vs,t),x(this,kv,r),x(this,Nc,new VV(this)),x(this,Zf,s),this.setupEventListeners(c(this,Vs)),t.once(Wt.Disconnected,()=>{A(this,ft,qO).call(this).catch(Ee)})}get timeoutSettings(){return c(this,Zf)}get networkManager(){return c(this,Nc)}get client(){return c(this,Vs)}async swapFrameTree(t){x(this,Vs,t),ae(c(this,Vs)instanceof _d,"CDPSession is not an instance of CDPSessionImpl.");const r=this._frameTree.getMainFrame();r&&(c(this,Ml).add(c(this,Vs)._target()._targetId),this._frameTree.removeFrame(r),r.updateId(c(this,Vs)._target()._targetId),this._frameTree.addFrame(r),r.updateClient(t)),this.setupEventListeners(t),t.once(Wt.Disconnected,()=>{A(this,ft,qO).call(this).catch(Ee)}),await this.initialize(t,r),await c(this,Nc).addClient(t),r&&r.emit(Gr.FrameSwappedByActivation,void 0)}async registerSpeculativeSession(t){await c(this,Nc).addClient(t)}setupEventListeners(t){t.on("Page.frameAttached",async r=>{var s;await((s=c(this,Mn))==null?void 0:s.valueOrThrow()),A(this,ft,KO).call(this,t,r.frameId,r.parentFrameId)}),t.on("Page.frameNavigated",async r=>{var s;c(this,Ml).add(r.frame.id),await((s=c(this,Mn))==null?void 0:s.valueOrThrow()),A(this,ft,WO).call(this,r.frame,r.type)}),t.on("Page.navigatedWithinDocument",async r=>{var s;await((s=c(this,Mn))==null?void 0:s.valueOrThrow()),A(this,ft,FK).call(this,r.frameId,r.url)}),t.on("Page.frameDetached",async r=>{var s;await((s=c(this,Mn))==null?void 0:s.valueOrThrow()),A(this,ft,LK).call(this,r.frameId,r.reason)}),t.on("Page.frameStartedLoading",async r=>{var s;await((s=c(this,Mn))==null?void 0:s.valueOrThrow()),A(this,ft,MK).call(this,r.frameId)}),t.on("Page.frameStoppedLoading",async r=>{var s;await((s=c(this,Mn))==null?void 0:s.valueOrThrow()),A(this,ft,$K).call(this,r.frameId)}),t.on("Runtime.executionContextCreated",async r=>{var s;await((s=c(this,Mn))==null?void 0:s.valueOrThrow()),A(this,ft,jK).call(this,r.context,t)}),t.on("Page.lifecycleEvent",async r=>{var s;await((s=c(this,Mn))==null?void 0:s.valueOrThrow()),A(this,ft,RK).call(this,r)})}async initialize(t,r){var s,i;try{(s=c(this,Mn))==null||s.resolve(),x(this,Mn,qt.create()),await Promise.all([c(this,Nc).addClient(t),t.send("Page.enable"),t.send("Page.getFrameTree").then(({frameTree:a})=>{var o;A(this,ft,HO).call(this,t,a),(o=c(this,Mn))==null||o.resolve()}),t.send("Page.setLifecycleEventsEnabled",{enabled:!0}),t.send("Runtime.enable").then(()=>A(this,ft,NK).call(this,t,XM)),...(r?Array.from(c(this,Rl).values()):[]).map(a=>r==null?void 0:r.addPreloadScript(a)),...(r?Array.from(c(this,Jf).values()):[]).map(a=>r==null?void 0:r.addExposedFunctionBinding(a))])}catch(a){if((i=c(this,Mn))==null||i.resolve(),Ts(a)&&_k(a))return;throw a}}page(){return c(this,kv)}mainFrame(){const t=this._frameTree.getMainFrame();return ae(t,"Requesting main frame too early!"),t}frames(){return Array.from(this._frameTree.frames())}frame(t){return this._frameTree.getById(t)||null}async addExposedFunctionBinding(t){c(this,Jf).add(t),await Promise.all(this.frames().map(async r=>await r.addExposedFunctionBinding(t)))}async removeExposedFunctionBinding(t){c(this,Jf).delete(t),await Promise.all(this.frames().map(async r=>await r.removeExposedFunctionBinding(t)))}async evaluateOnNewDocument(t){const{identifier:r}=await this.mainFrame()._client().send("Page.addScriptToEvaluateOnNewDocument",{source:t}),s=new OV(this.mainFrame(),r,t);return c(this,Rl).set(r,s),await Promise.all(this.frames().map(async i=>await i.addPreloadScript(s))),{identifier:r}}async removeScriptToEvaluateOnNewDocument(t){const r=c(this,Rl).get(t);if(!r)throw new Error(`Script to evaluate on new document with id ${t} not found`);c(this,Rl).delete(t),await Promise.all(this.frames().map(s=>{const i=r.getIdForFrame(s);if(i)return s._client().send("Page.removeScriptToEvaluateOnNewDocument",{identifier:i}).catch(Ee)}))}onAttachedToTarget(t){if(t._getTargetInfo().type!=="iframe")return;const r=this.frame(t._getTargetInfo().targetId);r&&r.updateClient(t._session()),this.setupEventListeners(t._session()),this.initialize(t._session(),r)}_deviceRequestPromptManager(t){let r=c(this,Pv).get(t);return r===void 0&&(r=new $V(t,c(this,Zf)),c(this,Pv).set(t,r)),r}}kv=new WeakMap,Nc=new WeakMap,Zf=new WeakMap,Cv=new WeakMap,Vs=new WeakMap,Rl=new WeakMap,Jf=new WeakMap,Ml=new WeakMap,Pv=new WeakMap,Mn=new WeakMap,ft=new WeakSet,qO=async function(){const t=this._frameTree.getMainFrame();if(!t)return;for(const s of t.childFrames())A(this,ft,Ip).call(this,s);const r=qt.create({timeout:GV,message:"Frame was not swapped"});t.once(Gr.FrameSwappedByActivation,()=>{r.resolve()});try{await r.valueOrThrow()}catch{A(this,ft,Ip).call(this,t)}},RK=function(t){const r=this.frame(t.frameId);r&&(r._onLifecycleEvent(t.loaderId,t.name),this.emit(Nr.LifecycleEvent,r),r.emit(Gr.LifecycleEvent,void 0))},MK=function(t){const r=this.frame(t);r&&r._onLoadingStarted()},$K=function(t){const r=this.frame(t);r&&(r._onLoadingStopped(),this.emit(Nr.LifecycleEvent,r),r.emit(Gr.LifecycleEvent,void 0))},HO=function(t,r){if(r.frame.parentId&&A(this,ft,KO).call(this,t,r.frame.id,r.frame.parentId),c(this,Ml).has(r.frame.id)?c(this,Ml).delete(r.frame.id):A(this,ft,WO).call(this,r.frame,"Navigation"),!!r.childFrames)for(const s of r.childFrames)A(this,ft,HO).call(this,t,s)},KO=function(t,r,s){let i=this.frame(r);if(i){const a=this.frame(s);t&&a&&i.client!==(a==null?void 0:a.client)&&i.updateClient(t);return}i=new D$(this,r,s,t),this._frameTree.addFrame(i),this.emit(Nr.FrameAttached,i)},WO=async function(t,r){const s=t.id,i=!t.parentId;let a=this._frameTree.getById(s);if(a)for(const o of a.childFrames())A(this,ft,Ip).call(this,o);i&&(a?(this._frameTree.removeFrame(a),a._id=s):a=new D$(this,s,void 0,c(this,Vs)),this._frameTree.addFrame(a)),a=await this._frameTree.waitForFrame(s),a._navigated(t),this.emit(Nr.FrameNavigated,a),a.emit(Gr.FrameNavigated,r)},NK=async function(t,r){const s=`${t.id()}:${r}`;c(this,Cv).has(s)||(await t.send("Page.addScriptToEvaluateOnNewDocument",{source:`//# sourceURL=${as.INTERNAL_URL}`,worldName:r}),await Promise.all(this.frames().filter(i=>i.client===t).map(i=>t.send("Page.createIsolatedWorld",{frameId:i._id,worldName:r,grantUniveralAccess:!0}).catch(Ee))),c(this,Cv).add(s))},FK=function(t,r){const s=this.frame(t);s&&(s._navigatedWithinDocument(r),this.emit(Nr.FrameNavigatedWithinDocument,s),s.emit(Gr.FrameNavigatedWithinDocument,void 0),this.emit(Nr.FrameNavigated,s),s.emit(Gr.FrameNavigated,"Navigation"))},LK=function(t,r){const s=this.frame(t);if(s)switch(r){case"remove":A(this,ft,Ip).call(this,s);break;case"swap":this.emit(Nr.FrameSwapped,s),s.emit(Gr.FrameSwapped,void 0);break}},jK=function(t,r){const s=t.auxData,i=s&&s.frameId,a=typeof i=="string"?this.frame(i):void 0;let o;if(a){if(a.client!==r)return;t.auxData&&t.auxData.isDefault?o=a.worlds[Ki]:t.name===XM&&(o=a.worlds[kb])}if(!o)return;const u=new L$((a==null?void 0:a.client)||c(this,Vs),t,o);o.setContext(u)},Ip=function(t){for(const r of t.childFrames())A(this,ft,Ip).call(this,r);t[je](),this._frameTree.removeFrame(t),this.emit(Nr.FrameDetached,t),t.emit(Gr.FrameDetached,t)};/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const q$={0:{keyCode:48,key:"0",code:"Digit0"},1:{keyCode:49,key:"1",code:"Digit1"},2:{keyCode:50,key:"2",code:"Digit2"},3:{keyCode:51,key:"3",code:"Digit3"},4:{keyCode:52,key:"4",code:"Digit4"},5:{keyCode:53,key:"5",code:"Digit5"},6:{keyCode:54,key:"6",code:"Digit6"},7:{keyCode:55,key:"7",code:"Digit7"},8:{keyCode:56,key:"8",code:"Digit8"},9:{keyCode:57,key:"9",code:"Digit9"},Power:{key:"Power",code:"Power"},Eject:{key:"Eject",code:"Eject"},Abort:{keyCode:3,code:"Abort",key:"Cancel"},Help:{keyCode:6,code:"Help",key:"Help"},Backspace:{keyCode:8,code:"Backspace",key:"Backspace"},Tab:{keyCode:9,code:"Tab",key:"Tab"},Numpad5:{keyCode:12,shiftKeyCode:101,key:"Clear",code:"Numpad5",shiftKey:"5",location:3},NumpadEnter:{keyCode:13,code:"NumpadEnter",key:"Enter",text:"\r",location:3},Enter:{keyCode:13,code:"Enter",key:"Enter",text:"\r"},"\r":{keyCode:13,code:"Enter",key:"Enter",text:"\r"},"\n":{keyCode:13,code:"Enter",key:"Enter",text:"\r"},ShiftLeft:{keyCode:16,code:"ShiftLeft",key:"Shift",location:1},ShiftRight:{keyCode:16,code:"ShiftRight",key:"Shift",location:2},ControlLeft:{keyCode:17,code:"ControlLeft",key:"Control",location:1},ControlRight:{keyCode:17,code:"ControlRight",key:"Control",location:2},AltLeft:{keyCode:18,code:"AltLeft",key:"Alt",location:1},AltRight:{keyCode:18,code:"AltRight",key:"Alt",location:2},Pause:{keyCode:19,code:"Pause",key:"Pause"},CapsLock:{keyCode:20,code:"CapsLock",key:"CapsLock"},Escape:{keyCode:27,code:"Escape",key:"Escape"},Convert:{keyCode:28,code:"Convert",key:"Convert"},NonConvert:{keyCode:29,code:"NonConvert",key:"NonConvert"},Space:{keyCode:32,code:"Space",key:" "},Numpad9:{keyCode:33,shiftKeyCode:105,key:"PageUp",code:"Numpad9",shiftKey:"9",location:3},PageUp:{keyCode:33,code:"PageUp",key:"PageUp"},Numpad3:{keyCode:34,shiftKeyCode:99,key:"PageDown",code:"Numpad3",shiftKey:"3",location:3},PageDown:{keyCode:34,code:"PageDown",key:"PageDown"},End:{keyCode:35,code:"End",key:"End"},Numpad1:{keyCode:35,shiftKeyCode:97,key:"End",code:"Numpad1",shiftKey:"1",location:3},Home:{keyCode:36,code:"Home",key:"Home"},Numpad7:{keyCode:36,shiftKeyCode:103,key:"Home",code:"Numpad7",shiftKey:"7",location:3},ArrowLeft:{keyCode:37,code:"ArrowLeft",key:"ArrowLeft"},Numpad4:{keyCode:37,shiftKeyCode:100,key:"ArrowLeft",code:"Numpad4",shiftKey:"4",location:3},Numpad8:{keyCode:38,shiftKeyCode:104,key:"ArrowUp",code:"Numpad8",shiftKey:"8",location:3},ArrowUp:{keyCode:38,code:"ArrowUp",key:"ArrowUp"},ArrowRight:{keyCode:39,code:"ArrowRight",key:"ArrowRight"},Numpad6:{keyCode:39,shiftKeyCode:102,key:"ArrowRight",code:"Numpad6",shiftKey:"6",location:3},Numpad2:{keyCode:40,shiftKeyCode:98,key:"ArrowDown",code:"Numpad2",shiftKey:"2",location:3},ArrowDown:{keyCode:40,code:"ArrowDown",key:"ArrowDown"},Select:{keyCode:41,code:"Select",key:"Select"},Open:{keyCode:43,code:"Open",key:"Execute"},PrintScreen:{keyCode:44,code:"PrintScreen",key:"PrintScreen"},Insert:{keyCode:45,code:"Insert",key:"Insert"},Numpad0:{keyCode:45,shiftKeyCode:96,key:"Insert",code:"Numpad0",shiftKey:"0",location:3},Delete:{keyCode:46,code:"Delete",key:"Delete"},NumpadDecimal:{keyCode:46,shiftKeyCode:110,code:"NumpadDecimal",key:"\0",shiftKey:".",location:3},Digit0:{keyCode:48,code:"Digit0",shiftKey:")",key:"0"},Digit1:{keyCode:49,code:"Digit1",shiftKey:"!",key:"1"},Digit2:{keyCode:50,code:"Digit2",shiftKey:"@",key:"2"},Digit3:{keyCode:51,code:"Digit3",shiftKey:"#",key:"3"},Digit4:{keyCode:52,code:"Digit4",shiftKey:"$",key:"4"},Digit5:{keyCode:53,code:"Digit5",shiftKey:"%",key:"5"},Digit6:{keyCode:54,code:"Digit6",shiftKey:"^",key:"6"},Digit7:{keyCode:55,code:"Digit7",shiftKey:"&",key:"7"},Digit8:{keyCode:56,code:"Digit8",shiftKey:"*",key:"8"},Digit9:{keyCode:57,code:"Digit9",shiftKey:"(",key:"9"},KeyA:{keyCode:65,code:"KeyA",shiftKey:"A",key:"a"},KeyB:{keyCode:66,code:"KeyB",shiftKey:"B",key:"b"},KeyC:{keyCode:67,code:"KeyC",shiftKey:"C",key:"c"},KeyD:{keyCode:68,code:"KeyD",shiftKey:"D",key:"d"},KeyE:{keyCode:69,code:"KeyE",shiftKey:"E",key:"e"},KeyF:{keyCode:70,code:"KeyF",shiftKey:"F",key:"f"},KeyG:{keyCode:71,code:"KeyG",shiftKey:"G",key:"g"},KeyH:{keyCode:72,code:"KeyH",shiftKey:"H",key:"h"},KeyI:{keyCode:73,code:"KeyI",shiftKey:"I",key:"i"},KeyJ:{keyCode:74,code:"KeyJ",shiftKey:"J",key:"j"},KeyK:{keyCode:75,code:"KeyK",shiftKey:"K",key:"k"},KeyL:{keyCode:76,code:"KeyL",shiftKey:"L",key:"l"},KeyM:{keyCode:77,code:"KeyM",shiftKey:"M",key:"m"},KeyN:{keyCode:78,code:"KeyN",shiftKey:"N",key:"n"},KeyO:{keyCode:79,code:"KeyO",shiftKey:"O",key:"o"},KeyP:{keyCode:80,code:"KeyP",shiftKey:"P",key:"p"},KeyQ:{keyCode:81,code:"KeyQ",shiftKey:"Q",key:"q"},KeyR:{keyCode:82,code:"KeyR",shiftKey:"R",key:"r"},KeyS:{keyCode:83,code:"KeyS",shiftKey:"S",key:"s"},KeyT:{keyCode:84,code:"KeyT",shiftKey:"T",key:"t"},KeyU:{keyCode:85,code:"KeyU",shiftKey:"U",key:"u"},KeyV:{keyCode:86,code:"KeyV",shiftKey:"V",key:"v"},KeyW:{keyCode:87,code:"KeyW",shiftKey:"W",key:"w"},KeyX:{keyCode:88,code:"KeyX",shiftKey:"X",key:"x"},KeyY:{keyCode:89,code:"KeyY",shiftKey:"Y",key:"y"},KeyZ:{keyCode:90,code:"KeyZ",shiftKey:"Z",key:"z"},MetaLeft:{keyCode:91,code:"MetaLeft",key:"Meta",location:1},MetaRight:{keyCode:92,code:"MetaRight",key:"Meta",location:2},ContextMenu:{keyCode:93,code:"ContextMenu",key:"ContextMenu"},NumpadMultiply:{keyCode:106,code:"NumpadMultiply",key:"*",location:3},NumpadAdd:{keyCode:107,code:"NumpadAdd",key:"+",location:3},NumpadSubtract:{keyCode:109,code:"NumpadSubtract",key:"-",location:3},NumpadDivide:{keyCode:111,code:"NumpadDivide",key:"/",location:3},F1:{keyCode:112,code:"F1",key:"F1"},F2:{keyCode:113,code:"F2",key:"F2"},F3:{keyCode:114,code:"F3",key:"F3"},F4:{keyCode:115,code:"F4",key:"F4"},F5:{keyCode:116,code:"F5",key:"F5"},F6:{keyCode:117,code:"F6",key:"F6"},F7:{keyCode:118,code:"F7",key:"F7"},F8:{keyCode:119,code:"F8",key:"F8"},F9:{keyCode:120,code:"F9",key:"F9"},F10:{keyCode:121,code:"F10",key:"F10"},F11:{keyCode:122,code:"F11",key:"F11"},F12:{keyCode:123,code:"F12",key:"F12"},F13:{keyCode:124,code:"F13",key:"F13"},F14:{keyCode:125,code:"F14",key:"F14"},F15:{keyCode:126,code:"F15",key:"F15"},F16:{keyCode:127,code:"F16",key:"F16"},F17:{keyCode:128,code:"F17",key:"F17"},F18:{keyCode:129,code:"F18",key:"F18"},F19:{keyCode:130,code:"F19",key:"F19"},F20:{keyCode:131,code:"F20",key:"F20"},F21:{keyCode:132,code:"F21",key:"F21"},F22:{keyCode:133,code:"F22",key:"F22"},F23:{keyCode:134,code:"F23",key:"F23"},F24:{keyCode:135,code:"F24",key:"F24"},NumLock:{keyCode:144,code:"NumLock",key:"NumLock"},ScrollLock:{keyCode:145,code:"ScrollLock",key:"ScrollLock"},AudioVolumeMute:{keyCode:173,code:"AudioVolumeMute",key:"AudioVolumeMute"},AudioVolumeDown:{keyCode:174,code:"AudioVolumeDown",key:"AudioVolumeDown"},AudioVolumeUp:{keyCode:175,code:"AudioVolumeUp",key:"AudioVolumeUp"},MediaTrackNext:{keyCode:176,code:"MediaTrackNext",key:"MediaTrackNext"},MediaTrackPrevious:{keyCode:177,code:"MediaTrackPrevious",key:"MediaTrackPrevious"},MediaStop:{keyCode:178,code:"MediaStop",key:"MediaStop"},MediaPlayPause:{keyCode:179,code:"MediaPlayPause",key:"MediaPlayPause"},Semicolon:{keyCode:186,code:"Semicolon",shiftKey:":",key:";"},Equal:{keyCode:187,code:"Equal",shiftKey:"+",key:"="},NumpadEqual:{keyCode:187,code:"NumpadEqual",key:"=",location:3},Comma:{keyCode:188,code:"Comma",shiftKey:"<",key:","},Minus:{keyCode:189,code:"Minus",shiftKey:"_",key:"-"},Period:{keyCode:190,code:"Period",shiftKey:">",key:"."},Slash:{keyCode:191,code:"Slash",shiftKey:"?",key:"/"},Backquote:{keyCode:192,code:"Backquote",shiftKey:"~",key:"`"},BracketLeft:{keyCode:219,code:"BracketLeft",shiftKey:"{",key:"["},Backslash:{keyCode:220,code:"Backslash",shiftKey:"|",key:"\\"},BracketRight:{keyCode:221,code:"BracketRight",shiftKey:"}",key:"]"},Quote:{keyCode:222,code:"Quote",shiftKey:'"',key:"'"},AltGraph:{keyCode:225,code:"AltGraph",key:"AltGraph"},Props:{keyCode:247,code:"Props",key:"CrSel"},Cancel:{keyCode:3,key:"Cancel",code:"Abort"},Clear:{keyCode:12,key:"Clear",code:"Numpad5",location:3},Shift:{keyCode:16,key:"Shift",code:"ShiftLeft",location:1},Control:{keyCode:17,key:"Control",code:"ControlLeft",location:1},Alt:{keyCode:18,key:"Alt",code:"AltLeft",location:1},Accept:{keyCode:30,key:"Accept"},ModeChange:{keyCode:31,key:"ModeChange"}," ":{keyCode:32,key:" ",code:"Space"},Print:{keyCode:42,key:"Print"},Execute:{keyCode:43,key:"Execute",code:"Open"},"\0":{keyCode:46,key:"\0",code:"NumpadDecimal",location:3},a:{keyCode:65,key:"a",code:"KeyA"},b:{keyCode:66,key:"b",code:"KeyB"},c:{keyCode:67,key:"c",code:"KeyC"},d:{keyCode:68,key:"d",code:"KeyD"},e:{keyCode:69,key:"e",code:"KeyE"},f:{keyCode:70,key:"f",code:"KeyF"},g:{keyCode:71,key:"g",code:"KeyG"},h:{keyCode:72,key:"h",code:"KeyH"},i:{keyCode:73,key:"i",code:"KeyI"},j:{keyCode:74,key:"j",code:"KeyJ"},k:{keyCode:75,key:"k",code:"KeyK"},l:{keyCode:76,key:"l",code:"KeyL"},m:{keyCode:77,key:"m",code:"KeyM"},n:{keyCode:78,key:"n",code:"KeyN"},o:{keyCode:79,key:"o",code:"KeyO"},p:{keyCode:80,key:"p",code:"KeyP"},q:{keyCode:81,key:"q",code:"KeyQ"},r:{keyCode:82,key:"r",code:"KeyR"},s:{keyCode:83,key:"s",code:"KeyS"},t:{keyCode:84,key:"t",code:"KeyT"},u:{keyCode:85,key:"u",code:"KeyU"},v:{keyCode:86,key:"v",code:"KeyV"},w:{keyCode:87,key:"w",code:"KeyW"},x:{keyCode:88,key:"x",code:"KeyX"},y:{keyCode:89,key:"y",code:"KeyY"},z:{keyCode:90,key:"z",code:"KeyZ"},Meta:{keyCode:91,key:"Meta",code:"MetaLeft",location:1},"*":{keyCode:106,key:"*",code:"NumpadMultiply",location:3},"+":{keyCode:107,key:"+",code:"NumpadAdd",location:3},"-":{keyCode:109,key:"-",code:"NumpadSubtract",location:3},"/":{keyCode:111,key:"/",code:"NumpadDivide",location:3},";":{keyCode:186,key:";",code:"Semicolon"},"=":{keyCode:187,key:"=",code:"Equal"},",":{keyCode:188,key:",",code:"Comma"},".":{keyCode:190,key:".",code:"Period"},"`":{keyCode:192,key:"`",code:"Backquote"},"[":{keyCode:219,key:"[",code:"BracketLeft"},"\\":{keyCode:220,key:"\\",code:"Backslash"},"]":{keyCode:221,key:"]",code:"BracketRight"},"'":{keyCode:222,key:"'",code:"Quote"},Attn:{keyCode:246,key:"Attn"},CrSel:{keyCode:247,key:"CrSel",code:"Props"},ExSel:{keyCode:248,key:"ExSel"},EraseEof:{keyCode:249,key:"EraseEof"},Play:{keyCode:250,key:"Play"},ZoomOut:{keyCode:251,key:"ZoomOut"},")":{keyCode:48,key:")",code:"Digit0"},"!":{keyCode:49,key:"!",code:"Digit1"},"@":{keyCode:50,key:"@",code:"Digit2"},"#":{keyCode:51,key:"#",code:"Digit3"},$:{keyCode:52,key:"$",code:"Digit4"},"%":{keyCode:53,key:"%",code:"Digit5"},"^":{keyCode:54,key:"^",code:"Digit6"},"&":{keyCode:55,key:"&",code:"Digit7"},"(":{keyCode:57,key:"(",code:"Digit9"},A:{keyCode:65,key:"A",code:"KeyA"},B:{keyCode:66,key:"B",code:"KeyB"},C:{keyCode:67,key:"C",code:"KeyC"},D:{keyCode:68,key:"D",code:"KeyD"},E:{keyCode:69,key:"E",code:"KeyE"},F:{keyCode:70,key:"F",code:"KeyF"},G:{keyCode:71,key:"G",code:"KeyG"},H:{keyCode:72,key:"H",code:"KeyH"},I:{keyCode:73,key:"I",code:"KeyI"},J:{keyCode:74,key:"J",code:"KeyJ"},K:{keyCode:75,key:"K",code:"KeyK"},L:{keyCode:76,key:"L",code:"KeyL"},M:{keyCode:77,key:"M",code:"KeyM"},N:{keyCode:78,key:"N",code:"KeyN"},O:{keyCode:79,key:"O",code:"KeyO"},P:{keyCode:80,key:"P",code:"KeyP"},Q:{keyCode:81,key:"Q",code:"KeyQ"},R:{keyCode:82,key:"R",code:"KeyR"},S:{keyCode:83,key:"S",code:"KeyS"},T:{keyCode:84,key:"T",code:"KeyT"},U:{keyCode:85,key:"U",code:"KeyU"},V:{keyCode:86,key:"V",code:"KeyV"},W:{keyCode:87,key:"W",code:"KeyW"},X:{keyCode:88,key:"X",code:"KeyX"},Y:{keyCode:89,key:"Y",code:"KeyY"},Z:{keyCode:90,key:"Z",code:"KeyZ"},":":{keyCode:186,key:":",code:"Semicolon"},"<":{keyCode:188,key:"<",code:"Comma"},_:{keyCode:189,key:"_",code:"Minus"},">":{keyCode:190,key:">",code:"Period"},"?":{keyCode:191,key:"?",code:"Slash"},"~":{keyCode:192,key:"~",code:"Backquote"},"{":{keyCode:219,key:"{",code:"BracketLeft"},"|":{keyCode:220,key:"|",code:"Backslash"},"}":{keyCode:221,key:"}",code:"BracketRight"},'"':{keyCode:222,key:'"',code:"Quote"},SoftLeft:{key:"SoftLeft",code:"SoftLeft",location:4},SoftRight:{key:"SoftRight",code:"SoftRight",location:4},Camera:{keyCode:44,key:"Camera",code:"Camera",location:4},Call:{key:"Call",code:"Call",location:4},EndCall:{keyCode:95,key:"EndCall",code:"EndCall",location:4},VolumeDown:{keyCode:182,key:"VolumeDown",code:"VolumeDown",location:4},VolumeUp:{keyCode:183,key:"VolumeUp",code:"VolumeUp",location:4}};/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class JV extends y${constructor(t){super();_(this,Lc);_(this,Fc);_(this,Xf,new Set);J(this,"_modifiers",0);x(this,Fc,t)}updateClient(t){x(this,Fc,t)}async down(t,r={text:void 0,commands:[]}){const s=A(this,Lc,VO).call(this,t),i=c(this,Xf).has(s.code);c(this,Xf).add(s.code),this._modifiers|=A(this,Lc,zO).call(this,s.key);const a=r.text===void 0?s.text:r.text;await c(this,Fc).send("Input.dispatchKeyEvent",{type:a?"keyDown":"rawKeyDown",modifiers:this._modifiers,windowsVirtualKeyCode:s.keyCode,code:s.code,key:s.key,text:a,unmodifiedText:a,autoRepeat:i,location:s.location,isKeypad:s.location===3,commands:r.commands})}async up(t){const r=A(this,Lc,VO).call(this,t);this._modifiers&=~A(this,Lc,zO).call(this,r.key),c(this,Xf).delete(r.code),await c(this,Fc).send("Input.dispatchKeyEvent",{type:"keyUp",modifiers:this._modifiers,key:r.key,windowsVirtualKeyCode:r.keyCode,code:r.code,location:r.location})}async sendCharacter(t){await c(this,Fc).send("Input.insertText",{text:t})}charIsKey(t){return!!q$[t]}async type(t,r={}){const s=r.delay||void 0;for(const i of t)this.charIsKey(i)?await this.press(i,{delay:s}):(s&&await new Promise(a=>setTimeout(a,s)),await this.sendCharacter(i))}async press(t,r={}){const{delay:s=null}=r;await this.down(t,r),s&&await new Promise(i=>setTimeout(i,r.delay)),await this.up(t)}}Fc=new WeakMap,Xf=new WeakMap,Lc=new WeakSet,zO=function(t){return t==="Alt"?1:t==="Control"?2:t==="Meta"?4:t==="Shift"?8:0},VO=function(t){const r=this._modifiers&8,s={key:"",keyCode:0,code:"",text:"",location:0},i=q$[t];return ae(i,`Unknown key: "${t}"`),i.key&&(s.key=i.key),r&&i.shiftKey&&(s.key=i.shiftKey),i.keyCode&&(s.keyCode=i.keyCode),r&&i.shiftKeyCode&&(s.keyCode=i.shiftKeyCode),i.code&&(s.code=i.code),i.location&&(s.location=i.location),s.key.length===1&&(s.text=s.key),i.text&&(s.text=i.text),r&&i.shiftText&&(s.text=i.shiftText),this._modifiers&-9&&(s.text=""),s};const H$=n=>{switch(n){case zt.Left:return 1;case zt.Right:return 2;case zt.Middle:return 4;case zt.Back:return 8;case zt.Forward:return 16}},XV=n=>n&1?zt.Left:n&2?zt.Right:n&4?zt.Middle:n&8?zt.Back:n&16?zt.Forward:"none";class YV extends w${constructor(t,r){super();_(this,or);_(this,Es);_(this,Ri);_(this,Yf,{position:{x:0,y:0},buttons:0});_(this,$l,[]);x(this,Es,t),x(this,Ri,r)}updateClient(t){x(this,Es,t)}async reset(){const t=[];for(const[r,s]of[[1,zt.Left],[4,zt.Middle],[2,zt.Right],[16,zt.Forward],[8,zt.Back]])c(this,or,Ps).buttons&r&&t.push(this.up({button:s}));(c(this,or,Ps).position.x!==0||c(this,or,Ps).position.y!==0)&&t.push(this.move(0,0)),await Promise.all(t)}async move(t,r,s={}){const{steps:i=1}=s,a=c(this,or,Ps).position,o={x:t,y:r};for(let u=1;u<=i;u++)await A(this,or,fE).call(this,l=>{l({position:{x:a.x+(o.x-a.x)*(u/i),y:a.y+(o.y-a.y)*(u/i)}});const{buttons:d,position:h}=c(this,or,Ps);return c(this,Es).send("Input.dispatchMouseEvent",{type:"mouseMoved",modifiers:c(this,Ri)._modifiers,buttons:d,button:XV(d),...h})})}async down(t={}){const{button:r=zt.Left,clickCount:s=1}=t,i=H$(r);if(!i)throw new Error(`Unsupported mouse button: ${r}`);if(c(this,or,Ps).buttons&i)throw new Error(`'${r}' is already pressed.`);await A(this,or,fE).call(this,a=>{a({buttons:c(this,or,Ps).buttons|i});const{buttons:o,position:u}=c(this,or,Ps);return c(this,Es).send("Input.dispatchMouseEvent",{type:"mousePressed",modifiers:c(this,Ri)._modifiers,clickCount:s,buttons:o,button:r,...u})})}async up(t={}){const{button:r=zt.Left,clickCount:s=1}=t,i=H$(r);if(!i)throw new Error(`Unsupported mouse button: ${r}`);if(!(c(this,or,Ps).buttons&i))throw new Error(`'${r}' is not pressed.`);await A(this,or,fE).call(this,a=>{a({buttons:c(this,or,Ps).buttons&~i});const{buttons:o,position:u}=c(this,or,Ps);return c(this,Es).send("Input.dispatchMouseEvent",{type:"mouseReleased",modifiers:c(this,Ri)._modifiers,clickCount:s,buttons:o,button:r,...u})})}async click(t,r,s={}){const{delay:i,count:a=1,clickCount:o=a}=s;if(a<1)throw new Error("Click must occur a positive number of times.");const u=[this.move(t,r)];if(o===a)for(let l=1;l<a;++l)u.push(this.down({...s,clickCount:l}),this.up({...s,clickCount:l}));u.push(this.down({...s,clickCount:o})),typeof i=="number"&&(await Promise.all(u),u.length=0,await new Promise(l=>{setTimeout(l,i)})),u.push(this.up({...s,clickCount:o})),await Promise.all(u)}async wheel(t={}){const{deltaX:r=0,deltaY:s=0}=t,{position:i,buttons:a}=c(this,or,Ps);await c(this,Es).send("Input.dispatchMouseEvent",{type:"mouseWheel",pointerType:"mouse",modifiers:c(this,Ri)._modifiers,deltaY:s,deltaX:r,buttons:a,...i})}async drag(t,r){const s=new Promise(i=>{c(this,Es).once("Input.dragIntercepted",a=>i(a.data))});return await this.move(t.x,t.y),await this.down(),await this.move(r.x,r.y),await s}async dragEnter(t,r){await c(this,Es).send("Input.dispatchDragEvent",{type:"dragEnter",x:t.x,y:t.y,modifiers:c(this,Ri)._modifiers,data:r})}async dragOver(t,r){await c(this,Es).send("Input.dispatchDragEvent",{type:"dragOver",x:t.x,y:t.y,modifiers:c(this,Ri)._modifiers,data:r})}async drop(t,r){await c(this,Es).send("Input.dispatchDragEvent",{type:"drop",x:t.x,y:t.y,modifiers:c(this,Ri)._modifiers,data:r})}async dragAndDrop(t,r,s={}){const{delay:i=null}=s,a=await this.drag(t,r);await this.dragEnter(r,a),await this.dragOver(r,a),i&&await new Promise(o=>setTimeout(o,i)),await this.drop(r,a),await this.up()}}Es=new WeakMap,Ri=new WeakMap,Yf=new WeakMap,or=new WeakSet,Ps=function(){return Object.assign({...c(this,Yf)},...c(this,$l))},$l=new WeakMap,DK=function(){const t={};c(this,$l).push(t);const r=()=>{c(this,$l).splice(c(this,$l).indexOf(t),1)};return{update:s=>{Object.assign(t,s)},commit:()=>{x(this,Yf,{...c(this,Yf),...t}),r()},rollback:r}},fE=async function(t){const{update:r,commit:s,rollback:i}=A(this,or,DK).call(this);try{await t(r),s()}catch(a){throw i(),a}};class QV{constructor(e,t,r,s){_(this,Av,!1);_(this,Tv);_(this,ho);_(this,jc);_(this,Nl);x(this,jc,e),x(this,Tv,t),x(this,Nl,r),x(this,ho,s)}updateClient(e){x(this,jc,e)}async start(){if(c(this,Av))throw new sb("Touch has already started");await c(this,jc).send("Input.dispatchTouchEvent",{type:"touchStart",touchPoints:[c(this,ho)],modifiers:c(this,Nl)._modifiers}),x(this,Av,!0)}move(e,t){return c(this,ho).x=Math.round(e),c(this,ho).y=Math.round(t),c(this,jc).send("Input.dispatchTouchEvent",{type:"touchMove",touchPoints:[c(this,ho)],modifiers:c(this,Nl)._modifiers})}async end(){await c(this,jc).send("Input.dispatchTouchEvent",{type:"touchEnd",touchPoints:[c(this,ho)],modifiers:c(this,Nl)._modifiers}),c(this,Tv).removeHandle(this)}}Av=new WeakMap,Tv=new WeakMap,ho=new WeakMap,jc=new WeakMap,Nl=new WeakMap;class eG extends v${constructor(t,r){super();_(this,Qf);_(this,Iv);x(this,Qf,t),x(this,Iv,r)}updateClient(t){x(this,Qf,t),this.touches.forEach(r=>{r.updateClient(t)})}async touchStart(t,r){const s=this.idGenerator(),i={x:Math.round(t),y:Math.round(r),radiusX:.5,radiusY:.5,force:.5,id:s},a=new QV(c(this,Qf),this,c(this,Iv),i);return await a.start(),this.touches.push(a),a}}Qf=new WeakMap,Iv=new WeakMap;class K${constructor(e){_(this,fo);_(this,ep,!1);_(this,Ov);x(this,fo,e)}updateClient(e){x(this,fo,e)}async start(e={}){ae(!c(this,ep),"Cannot start recording trace while already recording trace.");const t=["-*","devtools.timeline","v8.execute","disabled-by-default-devtools.timeline","disabled-by-default-devtools.timeline.frame","toplevel","blink.console","blink.user_timing","latencyInfo","disabled-by-default-devtools.timeline.stack","disabled-by-default-v8.cpu_profiler"],{path:r,screenshots:s=!1,categories:i=t}=e;s&&i.push("disabled-by-default-devtools.screenshot");const a=i.filter(u=>u.startsWith("-")).map(u=>u.slice(1)),o=i.filter(u=>!u.startsWith("-"));x(this,Ov,r),x(this,ep,!0),await c(this,fo).send("Tracing.start",{transferMode:"ReturnAsStream",traceConfig:{excludedCategories:a,includedCategories:o}})}async stop(){const e=qt.create();return c(this,fo).once("Tracing.tracingComplete",async t=>{try{ae(t.stream,'Missing "stream"');const r=await JM(c(this,fo),t.stream),s=await ZM(r,c(this,Ov));e.resolve(s??void 0)}catch(r){Ts(r)?e.reject(r):e.reject(new Error(`Unknown error: ${r}`))}}),await c(this,fo).send("Tracing.end"),x(this,ep,!1),await e.valueOrThrow()}}fo=new WeakMap,ep=new WeakMap,Ov=new WeakMap;class W$ extends C${constructor(t,r,s,i,a,o){super(r);_(this,ya);_(this,po);_(this,Rv);_(this,Mv);x(this,Rv,s),x(this,po,t),x(this,Mv,i),x(this,ya,new bk(this,new mk)),c(this,po).once("Runtime.executionContextCreated",async u=>{c(this,ya).setContext(new L$(t,u.context,c(this,ya)))}),c(this,ya).emitter.on("consoleapicalled",async u=>{try{return a(u.type,u.args.map(l=>new xb(c(this,ya),l)),u.stackTrace)}catch(l){Ee(l)}}),c(this,po).on("Runtime.exceptionThrown",o),c(this,po).once(Wt.Disconnected,()=>{c(this,ya).dispose()}),c(this,po).send("Runtime.enable").catch(Ee)}mainRealm(){return c(this,ya)}get client(){return c(this,po)}async close(){var t,r;switch(c(this,Mv)){case Zr.SERVICE_WORKER:case Zr.SHARED_WORKER:{await((t=this.client.connection())==null?void 0:t.send("Target.closeTarget",{targetId:c(this,Rv)})),await((r=this.client.connection())==null?void 0:r.send("Target.detachFromTarget",{sessionId:this.client.id()}));break}default:await this.evaluate(()=>{self.close()})}}}ya=new WeakMap,po=new WeakMap,Rv=new WeakMap,Mv=new WeakMap;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Ek=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},kk=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});function Ck(n){switch(n){case"warning":return"warn";default:return n}}const YI=class YI extends S${constructor(t,r){super();_(this,Xe);_(this,$v,!1);_(this,Dc);_(this,bt);_(this,Mi);_(this,Bc);_(this,Fl);_(this,Uc);_(this,tp);_(this,rp);_(this,Kt);_(this,mr);_(this,np);_(this,qc,new Map);_(this,sp,new Map);_(this,ip);_(this,ap);_(this,Ll,new Map);_(this,mo,new Set);_(this,Gx,qt.create());_(this,Nv,!1);_(this,Fv,!1);_(this,Lv,t=>{var i;const r=(i=t._session())==null?void 0:i.id(),s=c(this,Ll).get(r);s&&(c(this,Ll).delete(r),this.emit("workerdestroyed",s))});_(this,op,t=>{if(ae(t instanceof _d),c(this,Kt).onAttachedToTarget(t._target()),t._target()._getTargetInfo().type==="worker"){const r=new W$(t,t._target().url(),t._target()._targetId,t._target().type(),A(this,Xe,XO).bind(this),A(this,Xe,JO).bind(this));c(this,Ll).set(t.id(),r),this.emit("workercreated",r)}t.on(Wt.Ready,c(this,op))});x(this,bt,t),x(this,Bc,t.parentSession()),ae(c(this,Bc),"Tab target session is not defined."),x(this,Fl,c(this,Bc)._target()),ae(c(this,Fl),"Tab target is not defined."),x(this,Mi,r),x(this,Dc,r._targetManager()),x(this,Uc,new JV(t)),x(this,tp,new YV(t,c(this,Uc))),x(this,rp,new eG(t,c(this,Uc))),x(this,Kt,new ZV(t,this,this._timeoutSettings)),x(this,mr,new O$(t)),x(this,np,new K$(t)),x(this,ip,new T$(t)),x(this,ap,null);const s=new Ae(c(this,Kt));s.on(Nr.FrameAttached,a=>{this.emit("frameattached",a)}),s.on(Nr.FrameDetached,a=>{this.emit("framedetached",a)}),s.on(Nr.FrameNavigated,a=>{this.emit("framenavigated",a)}),s.on(Nr.ConsoleApiCalled,([a,o])=>{A(this,Xe,GK).call(this,a,o)}),s.on(Nr.BindingCalled,([a,o])=>{A(this,Xe,ZK).call(this,a,o)});const i=new Ae(c(this,Kt).networkManager);i.on($r.Request,a=>{this.emit("request",a)}),i.on($r.RequestServedFromCache,a=>{this.emit("requestservedfromcache",a)}),i.on($r.Response,a=>{this.emit("response",a)}),i.on($r.RequestFailed,a=>{this.emit("requestfailed",a)}),i.on($r.RequestFinished,a=>{this.emit("requestfinished",a)}),c(this,Bc).on(Wt.Swapped,A(this,Xe,UK).bind(this)),c(this,Bc).on(Wt.Ready,A(this,Xe,qK).bind(this)),c(this,Dc).on("targetGone",c(this,Lv)),c(this,Fl)._isClosedDeferred.valueOrThrow().then(()=>{c(this,Dc).off("targetGone",c(this,Lv)),this.emit("close",void 0),x(this,$v,!0)}).catch(Ee),A(this,Xe,GO).call(this),A(this,Xe,BK).call(this)}static async _create(t,r,s){var a;const i=new YI(t,r);if(await A(a=i,Xe,HK).call(a),s)try{await i.setViewport(s)}catch(o){if(Ts(o)&&_k(o))Ee(o);else throw o}return i}_client(){return c(this,bt)}isServiceWorkerBypassed(){return c(this,Nv)}isDragInterceptionEnabled(){return c(this,Fv)}isJavaScriptEnabled(){return c(this,mr).javascriptEnabled}async waitForFileChooser(t={}){const r=c(this,mo).size===0,{timeout:s=this._timeoutSettings.timeout()}=t,i=qt.create({message:`Waiting for \`FileChooser\` failed: ${s}ms exceeded`,timeout:s});t.signal&&t.signal.addEventListener("abort",()=>{var o;i.reject((o=t.signal)==null?void 0:o.reason)},{once:!0}),c(this,mo).add(i);let a;r&&(a=c(this,bt).send("Page.setInterceptFileChooserDialog",{enabled:!0}));try{const[o]=await Promise.all([i.valueOrThrow(),a]);return o}catch(o){throw c(this,mo).delete(i),o}}async setGeolocation(t){return await c(this,mr).setGeolocation(t)}target(){return c(this,Mi)}browser(){return c(this,Mi).browser()}browserContext(){return c(this,Mi).browserContext()}mainFrame(){return c(this,Kt).mainFrame()}get keyboard(){return c(this,Uc)}get touchscreen(){return c(this,rp)}get coverage(){return c(this,ip)}get tracing(){return c(this,np)}frames(){return c(this,Kt).frames()}workers(){return Array.from(c(this,Ll).values())}async setRequestInterception(t){return await c(this,Kt).networkManager.setRequestInterception(t)}async setBypassServiceWorker(t){return x(this,Nv,t),await c(this,bt).send("Network.setBypassServiceWorker",{bypass:t})}async setDragInterception(t){return x(this,Fv,t),await c(this,bt).send("Input.setInterceptDrags",{enabled:t})}async setOfflineMode(t){return await c(this,Kt).networkManager.setOfflineMode(t)}async emulateNetworkConditions(t){return await c(this,Kt).networkManager.emulateNetworkConditions(t)}setDefaultNavigationTimeout(t){this._timeoutSettings.setDefaultNavigationTimeout(t)}setDefaultTimeout(t){this._timeoutSettings.setDefaultTimeout(t)}getDefaultTimeout(){return this._timeoutSettings.timeout()}getDefaultNavigationTimeout(){return this._timeoutSettings.navigationTimeout()}async queryObjects(t){ae(!t.disposed,"Prototype JSHandle is disposed!"),ae(t.id,"Prototype JSHandle must not be referencing primitive value");const r=await this.mainFrame().client.send("Runtime.queryObjects",{prototypeObjectId:t.id});return this.mainFrame().mainRealm().createCdpHandle(r.objects)}async cookies(...t){const r=(await c(this,bt).send("Network.getCookies",{urls:t.length?t:[this.url()]})).cookies,s=["sourcePort"],i=a=>{for(const o of s)delete a[o];return a};return r.map(i).map(a=>({...a,partitionKey:a.partitionKey?a.partitionKey.topLevelSite:void 0}))}async deleteCookie(...t){const r=this.url();for(const s of t){const i={...s,partitionKey:Pk(s.partitionKey)};if(!s.url&&r.startsWith("http")&&(i.url=r),await c(this,bt).send("Network.deleteCookies",i),r.startsWith("http")&&!i.partitionKey){const a=new URL(r);await c(this,bt).send("Network.deleteCookies",{...i,partitionKey:{topLevelSite:a.origin.replace(`:${a.port}`,""),hasCrossSiteAncestor:!1}})}}}async setCookie(...t){const r=this.url(),s=r.startsWith("http"),i=t.map(a=>{const o=Object.assign({},a);return!o.url&&s&&(o.url=r),ae(o.url!=="about:blank",`Blank page can not have cookie "${o.name}"`),ae(!String.prototype.startsWith.call(o.url||"","data:"),`Data URL page can not have cookie "${o.name}"`),o});await this.deleteCookie(...i),i.length&&await c(this,bt).send("Network.setCookies",{cookies:i.map(a=>({...a,partitionKey:Pk(a.partitionKey)}))})}async exposeFunction(t,r){if(c(this,qc).has(t))throw new Error(`Failed to add page binding with name ${t}: window['${t}'] already exists!`);const s=FV("exposedFun",t);let i;switch(typeof r){case"function":i=new Sb(t,r,s);break;default:i=new Sb(t,r.default,s);break}c(this,qc).set(t,i);const[{identifier:a}]=await Promise.all([c(this,Kt).evaluateOnNewDocument(s),c(this,Kt).addExposedFunctionBinding(i)]);c(this,sp).set(t,a)}async removeExposedFunction(t){const r=c(this,sp).get(t);if(!r)throw new Error(`Function with name "${t}" does not exist`);const s=c(this,qc).get(t);c(this,sp).delete(t),c(this,qc).delete(t),await Promise.all([c(this,Kt).removeScriptToEvaluateOnNewDocument(r),c(this,Kt).removeExposedFunctionBinding(s)])}async authenticate(t){return await c(this,Kt).networkManager.authenticate(t)}async setExtraHTTPHeaders(t){return await c(this,Kt).networkManager.setExtraHTTPHeaders(t)}async setUserAgent(t,r){return await c(this,Kt).networkManager.setUserAgent(t,r)}async metrics(){const t=await c(this,bt).send("Performance.getMetrics");return A(this,Xe,ZO).call(this,t.metrics)}async reload(t){const[r]=await Promise.all([this.waitForNavigation({...t,ignoreSameDocumentNavigation:!0}),c(this,bt).send("Page.reload")]);return r}async createCDPSession(){return await this.target().createCDPSession()}async goBack(t={}){return await A(this,Xe,YO).call(this,-1,t)}async goForward(t={}){return await A(this,Xe,YO).call(this,1,t)}async bringToFront(){await c(this,bt).send("Page.bringToFront")}async setJavaScriptEnabled(t){return await c(this,mr).setJavaScriptEnabled(t)}async setBypassCSP(t){await c(this,bt).send("Page.setBypassCSP",{enabled:t})}async emulateMediaType(t){return await c(this,mr).emulateMediaType(t)}async emulateCPUThrottling(t){return await c(this,mr).emulateCPUThrottling(t)}async emulateMediaFeatures(t){return await c(this,mr).emulateMediaFeatures(t)}async emulateTimezone(t){return await c(this,mr).emulateTimezone(t)}async emulateIdleState(t){return await c(this,mr).emulateIdleState(t)}async emulateVisionDeficiency(t){return await c(this,mr).emulateVisionDeficiency(t)}async setViewport(t){const r=await c(this,mr).emulateViewport(t);x(this,ap,t),r&&await this.reload()}viewport(){return c(this,ap)}async evaluateOnNewDocument(t,...r){const s=sk(t,...r);return await c(this,Kt).evaluateOnNewDocument(s)}async removeScriptToEvaluateOnNewDocument(t){return await c(this,Kt).removeScriptToEvaluateOnNewDocument(t)}async setCacheEnabled(t=!0){await c(this,Kt).networkManager.setCacheEnabled(t)}async _screenshot(t){const r={stack:[],error:void 0,hasError:!1};try{const{fromSurface:s,omitBackground:i,optimizeForSpeed:a,quality:o,clip:u,type:l,captureBeyondViewport:d}=t,h=Ek(r,new tb,!0);i&&(l==="png"||l==="webp")&&(await c(this,mr).setTransparentBackgroundColor(),h.defer(async()=>{await c(this,mr).resetDefaultBackgroundColor().catch(Ee)}));let f=u;if(f&&!d){const m=await this.mainFrame().isolatedRealm().evaluate(()=>{const{height:g,pageLeft:y,pageTop:w,width:v}=window.visualViewport;return{x:y,y:w,height:g,width:v}});f=rG(f,m)}const{data:p}=await c(this,bt).send("Page.captureScreenshot",{format:l,optimizeForSpeed:a,fromSurface:s,...o!==void 0?{quality:Math.round(o)}:{},...f?{clip:{...f,scale:f.scale??1}}:{},captureBeyondViewport:d});return p}catch(s){r.error=s,r.hasError=!0}finally{const s=kk(r);s&&await s}}async createPDFStream(t={}){const{timeout:r=this._timeoutSettings.timeout()}=t,{landscape:s,displayHeaderFooter:i,headerTemplate:a,footerTemplate:o,printBackground:u,scale:l,width:d,height:h,margin:f,pageRanges:p,preferCSSPageSize:m,omitBackground:g,tagged:y,outline:w,waitForFonts:v}=QM(t);g&&await c(this,mr).setTransparentBackgroundColor(),v&&await Or(pt(this.mainFrame().isolatedRealm().evaluate(()=>document.fonts.ready)).pipe(Vr(Fn(r))));const b=c(this,bt).send("Page.printToPDF",{transferMode:"ReturnAsStream",landscape:s,displayHeaderFooter:i,headerTemplate:a,footerTemplate:o,printBackground:u,scale:l,paperWidth:d,paperHeight:h,marginTop:f.top,marginBottom:f.bottom,marginLeft:f.left,marginRight:f.right,pageRanges:p,preferCSSPageSize:m,generateTaggedPDF:y,generateDocumentOutline:w}),S=await Or(pt(b).pipe(Vr(Fn(r))));return g&&await c(this,mr).resetDefaultBackgroundColor(),ae(S.stream,"`stream` is missing from `Page.printToPDF"),await JM(c(this,bt),S.stream)}async pdf(t={}){const{path:r=void 0}=t,s=await this.createPDFStream(t),i=await ZM(s,r);return ae(i,"Could not create typed array"),i}async close(t={runBeforeUnload:void 0}){const r={stack:[],error:void 0,hasError:!1};try{const s=Ek(r,await this.browserContext().waitForScreenshotOperations(),!1),i=c(this,bt).connection();ae(i,"Protocol error: Connection closed. Most likely the page has been closed."),!!t.runBeforeUnload?await c(this,bt).send("Page.close"):(await i.send("Target.closeTarget",{targetId:c(this,Mi)._targetId}),await c(this,Fl)._isClosedDeferred.valueOrThrow())}catch(s){r.error=s,r.hasError=!0}finally{kk(r)}}isClosed(){return c(this,$v)}get mouse(){return c(this,tp)}async waitForDevicePrompt(t={}){return await this.mainFrame().waitForDevicePrompt(t)}};$v=new WeakMap,Dc=new WeakMap,bt=new WeakMap,Mi=new WeakMap,Bc=new WeakMap,Fl=new WeakMap,Uc=new WeakMap,tp=new WeakMap,rp=new WeakMap,Kt=new WeakMap,mr=new WeakMap,np=new WeakMap,qc=new WeakMap,sp=new WeakMap,ip=new WeakMap,ap=new WeakMap,Ll=new WeakMap,mo=new WeakMap,Gx=new WeakMap,Nv=new WeakMap,Fv=new WeakMap,Xe=new WeakSet,BK=function(){const t=[];for(const s of c(this,Dc).getChildTargets(c(this,Mi)))t.push(s);let r=0;for(;r<t.length;){const s=t[r];r++;const i=s._session();i&&c(this,op).call(this,i);for(const a of c(this,Dc).getChildTargets(s))t.push(a)}},UK=async function(t){x(this,bt,t),ae(c(this,bt)instanceof _d,"CDPSession is not instance of CDPSessionImpl"),x(this,Mi,c(this,bt)._target()),ae(c(this,Mi),"Missing target on swap"),c(this,Uc).updateClient(t),c(this,tp).updateClient(t),c(this,rp).updateClient(t),c(this,mr).updateClient(t),c(this,np).updateClient(t),c(this,ip).updateClient(t),await c(this,Kt).swapFrameTree(t),A(this,Xe,GO).call(this)},qK=async function(t){ae(t instanceof _d),t._target()._subtype()==="prerender"&&(c(this,Kt).registerSpeculativeSession(t).catch(Ee),c(this,mr).registerSpeculativeSession(t).catch(Ee))},GO=function(){const t=new Ae(c(this,bt));t.on(Wt.Ready,c(this,op)),t.on(Wt.Disconnected,()=>{c(this,Gx).reject(new Zs("Target closed"))}),t.on("Page.domContentEventFired",()=>{this.emit("domcontentloaded",void 0)}),t.on("Page.loadEventFired",()=>{this.emit("load",void 0)}),t.on("Page.javascriptDialogOpening",A(this,Xe,JK).bind(this)),t.on("Runtime.exceptionThrown",A(this,Xe,JO).bind(this)),t.on("Inspector.targetCrashed",A(this,Xe,WK).bind(this)),t.on("Performance.metrics",A(this,Xe,VK).bind(this)),t.on("Log.entryAdded",A(this,Xe,zK).bind(this)),t.on("Page.fileChooserOpened",A(this,Xe,KK).bind(this))},Lv=new WeakMap,op=new WeakMap,HK=async function(){try{await Promise.all([c(this,Kt).initialize(c(this,bt)),c(this,bt).send("Performance.enable"),c(this,bt).send("Log.enable")])}catch(t){if(Ts(t)&&_k(t))Ee(t);else throw t}},KK=async function(t){const r={stack:[],error:void 0,hasError:!1};try{if(!c(this,mo).size)return;const s=c(this,Kt).frame(t.frameId);ae(s,"This should never happen.");const i=Ek(r,await s.worlds[Ki].adoptBackendNode(t.backendNodeId),!1),a=new xV(i.move(),t);for(const o of c(this,mo))o.resolve(a);c(this,mo).clear()}catch(s){r.error=s,r.hasError=!0}finally{kk(r)}},WK=function(){this.emit("error",new Error("Page crashed!"))},zK=function(t){const{level:r,text:s,args:i,source:a,url:o,lineNumber:u}=t.entry;i&&i.map(l=>{N$(c(this,bt),l)}),a!=="worker"&&this.emit("console",new wk(Ck(r),s,[],[{url:o,lineNumber:u}]))},VK=function(t){this.emit("metrics",{title:t.title,metrics:A(this,Xe,ZO).call(this,t.metrics)})},ZO=function(t){const r={};for(const s of t||[])tG.has(s.name)&&(r[s.name]=s.value);return r},JO=function(t){this.emit("pageerror",NV(t.exceptionDetails))},GK=function(t,r){const s=r.args.map(i=>t.createCdpHandle(i));A(this,Xe,XO).call(this,Ck(r.type),s,r.stackTrace)},ZK=async function(t,r){let s;try{s=JSON.parse(r.payload)}catch{return}const{type:i,name:a,seq:o,args:u,isTrivial:l}=s;if(i!=="exposedFun")return;const d=t.context;if(!d)return;const h=c(this,qc).get(a);await(h==null?void 0:h.run(d,o,u,l))},XO=function(t,r,s){if(!this.listenerCount("console")){r.forEach(u=>u.dispose());return}const i=[];for(const u of r){const l=u.remoteObject();l.objectId?i.push(u.toString()):i.push(cu(l))}const a=[];if(s)for(const u of s.callFrames)a.push({url:u.url,lineNumber:u.lineNumber,columnNumber:u.columnNumber});const o=new wk(Ck(t),i.join(" "),r,a);this.emit("console",o)},JK=function(t){const r=Iz(t.type),s=new TV(c(this,bt),r,t.message,t.defaultPrompt);this.emit("dialog",s)},YO=async function(t,r){const s=await c(this,bt).send("Page.getNavigationHistory"),i=s.entries[s.currentIndex+t];return i?(await Promise.all([this.waitForNavigation(r),c(this,bt).send("Page.navigateToHistoryEntry",{entryId:i.id})]))[0]:null};let Jp=YI;const tG=new Set(["Timestamp","Documents","Frames","JSEventListeners","Nodes","LayoutCount","RecalcStyleCount","LayoutDuration","RecalcStyleDuration","ScriptDuration","TaskDuration","JSHeapUsedSize","JSHeapTotalSize"]);function rG(n,e){const t=Math.max(n.x,e.x),r=Math.max(n.y,e.y);return{x:t,y:r,width:Math.max(Math.min(n.x+n.width,e.x+e.width)-t,0),height:Math.max(Math.min(n.y+n.height,e.y+e.height)-r,0)}}function Pk(n){if(n!==void 0)return typeof n=="string"?{topLevelSite:n,hasCrossSiteAncestor:!1}:{topLevelSite:n.sourceOrigin,hasCrossSiteAncestor:n.hasCrossSiteAncestor??!1}}/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var nG=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},sG=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});class Ak extends t${constructor(t,r,s){super();_(this,go);_(this,yo);_(this,ks);x(this,go,t),x(this,yo,r),x(this,ks,s)}get id(){return c(this,ks)}targets(){return c(this,yo).targets().filter(t=>t.browserContext()===this)}async pages(){return(await Promise.all(this.targets().filter(r=>{var s;return r.type()==="page"||r.type()==="other"&&((s=c(this,yo)._getIsPageTargetCallback())==null?void 0:s(r))}).map(r=>r.page()))).filter(r=>!!r)}async overridePermissions(t,r){const s=r.map(i=>{const a=ak.get(i);if(!a)throw new Error("Unknown permission: "+i);return a});await c(this,go).send("Browser.grantPermissions",{origin:t,browserContextId:c(this,ks)||void 0,permissions:s})}async clearPermissionOverrides(){await c(this,go).send("Browser.resetPermissions",{browserContextId:c(this,ks)||void 0})}async newPage(){const t={stack:[],error:void 0,hasError:!1};try{const r=nG(t,await this.waitForScreenshotOperations(),!1);return await c(this,yo)._createPageInContext(c(this,ks))}catch(r){t.error=r,t.hasError=!0}finally{sG(t)}}browser(){return c(this,yo)}async close(){ae(c(this,ks),"Default BrowserContext cannot be closed!"),await c(this,yo)._disposeContext(c(this,ks))}async cookies(){const{cookies:t}=await c(this,go).send("Storage.getCookies",{browserContextId:c(this,ks)});return t.map(r=>({...r,partitionKey:r.partitionKey?{sourceOrigin:r.partitionKey.topLevelSite,hasCrossSiteAncestor:r.partitionKey.hasCrossSiteAncestor}:void 0}))}async setCookie(...t){return await c(this,go).send("Storage.setCookies",{browserContextId:c(this,ks),cookies:t.map(r=>({...r,partitionKey:Pk(r.partitionKey)}))})}async setDownloadBehavior(t){await c(this,go).send("Browser.setDownloadBehavior",{behavior:t.policy,downloadPath:t.downloadPath,browserContextId:c(this,ks)})}}go=new WeakMap,yo=new WeakMap,ks=new WeakMap;/**
 * @license
 * Copyright 2019 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Is;(function(n){n.SUCCESS="success",n.ABORTED="aborted"})(Is||(Is={}));let Cb=(OH=class extends Zp{constructor(t,r,s,i,a){super();_(this,Hc);_(this,Kc);_(this,wa);_(this,cp);_(this,Wc);_(this,up,new Set);J(this,"_initializedDeferred",qt.create());J(this,"_isClosedDeferred",qt.create());J(this,"_targetId");x(this,Kc,r),x(this,cp,i),x(this,wa,t),x(this,Hc,s),this._targetId=t.targetId,x(this,Wc,a),c(this,Kc)&&c(this,Kc)instanceof _d&&c(this,Kc)._setTarget(this)}async asPage(){const t=this._session();return t?await Jp._create(t,this,null):await this.createCDPSession().then(r=>Jp._create(r,this,null))}_subtype(){return c(this,wa).subtype}_session(){return c(this,Kc)}_addChildTarget(t){c(this,up).add(t)}_removeChildTarget(t){c(this,up).delete(t)}_childTargets(){return c(this,up)}_sessionFactory(){if(!c(this,Wc))throw new Error("sessionFactory is not initialized");return c(this,Wc)}createCDPSession(){if(!c(this,Wc))throw new Error("sessionFactory is not initialized");return c(this,Wc).call(this,!1).then(t=>(t._setTarget(this),t))}url(){return c(this,wa).url}type(){switch(c(this,wa).type){case"page":return Zr.PAGE;case"background_page":return Zr.BACKGROUND_PAGE;case"service_worker":return Zr.SERVICE_WORKER;case"shared_worker":return Zr.SHARED_WORKER;case"browser":return Zr.BROWSER;case"webview":return Zr.WEBVIEW;case"tab":return Zr.TAB;default:return Zr.OTHER}}_targetManager(){if(!c(this,cp))throw new Error("targetManager is not initialized");return c(this,cp)}_getTargetInfo(){return c(this,wa)}browser(){if(!c(this,Hc))throw new Error("browserContext is not initialized");return c(this,Hc).browser()}browserContext(){if(!c(this,Hc))throw new Error("browserContext is not initialized");return c(this,Hc)}opener(){const{openerId:t}=c(this,wa);if(t)return this.browser().targets().find(r=>r._targetId===t)}_targetInfoChanged(t){x(this,wa,t),this._checkIfInitialized()}_initialize(){this._initializedDeferred.resolve(Is.SUCCESS)}_isTargetExposed(){return this.type()!==Zr.TAB&&!this._subtype()}_checkIfInitialized(){this._initializedDeferred.resolved()||this._initializedDeferred.resolve(Is.SUCCESS)}},Hc=new WeakMap,Kc=new WeakMap,wa=new WeakMap,cp=new WeakMap,Wc=new WeakMap,up=new WeakMap,OH);const QI=class QI extends Cb{constructor(t,r,s,i,a,o){super(t,r,s,i,a);_(this,jv);J(this,"pagePromise");x(this,jv,o??void 0)}_initialize(){this._initializedDeferred.valueOrThrow().then(async t=>{if(t===Is.ABORTED)return;const r=this.opener();if(!(r instanceof QI))return;if(!r||!r.pagePromise||this.type()!=="page")return!0;const s=await r.pagePromise;if(!s.listenerCount("popup"))return!0;const i=await this.page();return s.emit("popup",i),!0}).catch(Ee),this._checkIfInitialized()}async page(){if(!this.pagePromise){const t=this._session();this.pagePromise=(t?Promise.resolve(t):this._sessionFactory()(!1)).then(r=>Jp._create(r,this,c(this,jv)??null))}return await this.pagePromise??null}_checkIfInitialized(){this._initializedDeferred.resolved()||this._getTargetInfo().url!==""&&this._initializedDeferred.resolve(Is.SUCCESS)}};jv=new WeakMap;let Pb=QI;class iG extends Pb{}class aG extends Cb{constructor(){super(...arguments);_(this,lp)}async worker(){if(!c(this,lp)){const t=this._session();x(this,lp,(t?Promise.resolve(t):this._sessionFactory()(!1)).then(r=>new W$(r,this._getTargetInfo().url,this._targetId,this.type(),()=>{},()=>{})))}return await c(this,lp)}}lp=new WeakMap;class oG extends Cb{}/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */function cG(n,e){return!!n._subtype()&&!e.subtype}class uG extends Ae{constructor(t,r,s,i=!0){super();_(this,ss);_(this,Br);_(this,zc,new Map);_(this,Ur,new Map);_(this,jl,new Map);_(this,Dv,new Set);_(this,Vc);_(this,Dl);_(this,Bl,new WeakMap);_(this,Gc,new WeakMap);_(this,Bv,qt.create());_(this,Ul,new Set);_(this,Uv,!0);_(this,dp,[{}]);_(this,Zx,()=>{if(c(this,Uv))for(const[t,r]of c(this,zc).entries()){const s=new Cb(r,void 0,void 0,this,void 0),i=r.type==="page"||r.type==="iframe",a=r.url.startsWith("chrome-extension://");(!c(this,Vc)||c(this,Vc).call(this,s))&&i&&!a&&c(this,Ul).add(t)}});_(this,qv,t=>{A(this,ss,eR).call(this,t)});_(this,Hv,async t=>{if(c(this,zc).set(t.targetInfo.targetId,t.targetInfo),this.emit("targetDiscovered",t.targetInfo),t.targetInfo.type==="browser"&&t.targetInfo.attached){if(c(this,Ur).has(t.targetInfo.targetId))return;const r=c(this,Dl).call(this,t.targetInfo,void 0);r._initialize(),c(this,Ur).set(t.targetInfo.targetId,r)}});_(this,Kv,t=>{const r=c(this,zc).get(t.targetId);if(c(this,zc).delete(t.targetId),A(this,ss,Op).call(this,t.targetId),(r==null?void 0:r.type)==="service_worker"&&c(this,Ur).has(t.targetId)){const s=c(this,Ur).get(t.targetId);s&&(this.emit("targetGone",s),c(this,Ur).delete(t.targetId))}});_(this,Wv,t=>{var a;if(c(this,zc).set(t.targetInfo.targetId,t.targetInfo),c(this,Dv).has(t.targetInfo.targetId)||!c(this,Ur).has(t.targetInfo.targetId)||!t.targetInfo.attached)return;const r=c(this,Ur).get(t.targetInfo.targetId);if(!r)return;const s=r.url(),i=r._initializedDeferred.value()===Is.SUCCESS;if(cG(r,t.targetInfo)){const o=r==null?void 0:r._session();ae(o,"Target that is being activated is missing a CDPSession."),(a=o.parentSession())==null||a.emit(Wt.Swapped,o)}r._targetInfoChanged(t.targetInfo),i&&s!==r.url()&&this.emit("targetChanged",{target:r,wasInitialized:i,previousURL:s})});_(this,Jx,async(t,r)=>{const s=r.targetInfo,i=c(this,Br).session(r.sessionId);if(!i)throw new Error(`Session ${r.sessionId} was not created.`);const a=async()=>{await i.send("Runtime.runIfWaitingForDebugger").catch(Ee),await t.send("Target.detachFromTarget",{sessionId:i.id()}).catch(Ee)};if(!c(this,Br).isAutoAttached(s.targetId))return;if(s.type==="service_worker"){if(A(this,ss,Op).call(this,s.targetId),await a(),c(this,Ur).has(s.targetId))return;const d=c(this,Dl).call(this,s);d._initialize(),c(this,Ur).set(s.targetId,d),this.emit("targetAvailable",d);return}const o=c(this,Ur).has(s.targetId),u=o?c(this,Ur).get(s.targetId):c(this,Dl).call(this,s,i,t instanceof Kp?t:void 0);if(c(this,Vc)&&!c(this,Vc).call(this,u)){c(this,Dv).add(s.targetId),A(this,ss,Op).call(this,s.targetId),await a();return}A(this,ss,QO).call(this,i),o?(i._setTarget(u),c(this,jl).set(i.id(),c(this,Ur).get(s.targetId))):(u._initialize(),c(this,Ur).set(s.targetId,u),c(this,jl).set(i.id(),u));const l=t instanceof Kp?t._target():null;l==null||l._addChildTarget(u),t.emit(Wt.Ready,i),c(this,Ul).delete(u._targetId),o||this.emit("targetAvailable",u),A(this,ss,Op).call(this),await Promise.all([i.send("Target.setAutoAttach",{waitForDebuggerOnStart:!0,flatten:!0,autoAttach:!0,filter:c(this,dp)}),i.send("Runtime.runIfWaitingForDebugger")]).catch(Ee)});_(this,Xx,(t,r)=>{const s=c(this,jl).get(r.sessionId);c(this,jl).delete(r.sessionId),s&&(t instanceof Kp&&t._target()._removeChildTarget(s),c(this,Ur).delete(s._targetId),this.emit("targetGone",s))});x(this,Br,t),x(this,Vc,s),x(this,Dl,r),x(this,Uv,i),c(this,Br).on("Target.targetCreated",c(this,Hv)),c(this,Br).on("Target.targetDestroyed",c(this,Kv)),c(this,Br).on("Target.targetInfoChanged",c(this,Wv)),c(this,Br).on(Wt.SessionDetached,c(this,qv)),A(this,ss,QO).call(this,c(this,Br))}async initialize(){await c(this,Br).send("Target.setDiscoverTargets",{discover:!0,filter:c(this,dp)}),c(this,Zx).call(this),await c(this,Br).send("Target.setAutoAttach",{waitForDebuggerOnStart:!0,flatten:!0,autoAttach:!0,filter:[{type:"page",exclude:!0},...c(this,dp)]}),A(this,ss,Op).call(this),await c(this,Bv).valueOrThrow()}getChildTargets(t){return t._childTargets()}dispose(){c(this,Br).off("Target.targetCreated",c(this,Hv)),c(this,Br).off("Target.targetDestroyed",c(this,Kv)),c(this,Br).off("Target.targetInfoChanged",c(this,Wv)),c(this,Br).off(Wt.SessionDetached,c(this,qv)),A(this,ss,eR).call(this,c(this,Br))}getAvailableTargets(){return c(this,Ur)}}Br=new WeakMap,zc=new WeakMap,Ur=new WeakMap,jl=new WeakMap,Dv=new WeakMap,Vc=new WeakMap,Dl=new WeakMap,Bl=new WeakMap,Gc=new WeakMap,Bv=new WeakMap,Ul=new WeakMap,Uv=new WeakMap,dp=new WeakMap,Zx=new WeakMap,ss=new WeakSet,QO=function(t){const r=i=>{c(this,Jx).call(this,t,i)};ae(!c(this,Bl).has(t)),c(this,Bl).set(t,r),t.on("Target.attachedToTarget",r);const s=i=>c(this,Xx).call(this,t,i);ae(!c(this,Gc).has(t)),c(this,Gc).set(t,s),t.on("Target.detachedFromTarget",s)},eR=function(t){const r=c(this,Bl).get(t);r&&(t.off("Target.attachedToTarget",r),c(this,Bl).delete(t)),c(this,Gc).has(t)&&(t.off("Target.detachedFromTarget",c(this,Gc).get(t)),c(this,Gc).delete(t))},qv=new WeakMap,Hv=new WeakMap,Kv=new WeakMap,Wv=new WeakMap,Jx=new WeakMap,Op=function(t){t!==void 0&&c(this,Ul).delete(t),c(this,Ul).size===0&&c(this,Bv).resolve()},Xx=new WeakMap;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const eO=class eO extends e${constructor(t,r,s,i,a,o,u,l=!0){super();_(this,ql);J(this,"protocol","cdp");_(this,hp);_(this,zv);_(this,qr);_(this,Vv);_(this,Gv);_(this,fp);_(this,wo);_(this,vo,new Map);_(this,gr);_(this,Zv,()=>{this.emit("disconnected",void 0)});_(this,Yx,(t,r)=>{var u;const{browserContextId:s}=t,i=s&&c(this,vo).has(s)?c(this,vo).get(s):c(this,wo);if(!i)throw new Error("Missing browser context");const a=l=>c(this,qr)._createSession(t,l),o=new oG(t,r,i,c(this,gr),a);return(u=t.url)!=null&&u.startsWith("devtools://")?new iG(t,r,i,c(this,gr),a,c(this,hp)??null):c(this,fp).call(this,o)?new Pb(t,r,i,c(this,gr),a,c(this,hp)??null):t.type==="service_worker"||t.type==="shared_worker"?new aG(t,r,i,c(this,gr),a):o});_(this,Jv,async t=>{t._isTargetExposed()&&await t._initializedDeferred.valueOrThrow()===Is.SUCCESS&&(this.emit("targetcreated",t),t.browserContext().emit("targetcreated",t))});_(this,Xv,async t=>{t._initializedDeferred.resolve(Is.ABORTED),t._isClosedDeferred.resolve(),t._isTargetExposed()&&await t._initializedDeferred.valueOrThrow()===Is.SUCCESS&&(this.emit("targetdestroyed",t),t.browserContext().emit("targetdestroyed",t))});_(this,Yv,({target:t})=>{this.emit("targetchanged",t),t.browserContext().emit("targetchanged",t)});_(this,Qv,t=>{this.emit("targetdiscovered",t)});x(this,hp,s),x(this,zv,i),x(this,qr,t),x(this,Vv,a||(()=>{})),x(this,Gv,o||(()=>!0)),A(this,ql,XK).call(this,u),x(this,gr,new uG(t,c(this,Yx),c(this,Gv),l)),x(this,wo,new Ak(c(this,qr),this));for(const d of r)c(this,vo).set(d,new Ak(c(this,qr),this,d))}static async _create(t,r,s,i,a,o,u,l,d,h=!0){const f=new eO(t,r,i,o,u,l,d,h);return s&&await t.send("Security.setIgnoreCertificateErrors",{ignore:!0}),await f._attach(a),f}async _attach(t){c(this,qr).on(Wt.Disconnected,c(this,Zv)),t&&await c(this,wo).setDownloadBehavior(t),c(this,gr).on("targetAvailable",c(this,Jv)),c(this,gr).on("targetGone",c(this,Xv)),c(this,gr).on("targetChanged",c(this,Yv)),c(this,gr).on("targetDiscovered",c(this,Qv)),await c(this,gr).initialize()}_detach(){c(this,qr).off(Wt.Disconnected,c(this,Zv)),c(this,gr).off("targetAvailable",c(this,Jv)),c(this,gr).off("targetGone",c(this,Xv)),c(this,gr).off("targetChanged",c(this,Yv)),c(this,gr).off("targetDiscovered",c(this,Qv))}process(){return c(this,zv)??null}_targetManager(){return c(this,gr)}_getIsPageTargetCallback(){return c(this,fp)}async createBrowserContext(t={}){const{proxyServer:r,proxyBypassList:s,downloadBehavior:i}=t,{browserContextId:a}=await c(this,qr).send("Target.createBrowserContext",{proxyServer:r,proxyBypassList:s&&s.join(",")}),o=new Ak(c(this,qr),this,a);return i&&await o.setDownloadBehavior(i),c(this,vo).set(a,o),o}browserContexts(){return[c(this,wo),...Array.from(c(this,vo).values())]}defaultBrowserContext(){return c(this,wo)}async _disposeContext(t){t&&(await c(this,qr).send("Target.disposeBrowserContext",{browserContextId:t}),c(this,vo).delete(t))}wsEndpoint(){return c(this,qr).url()}async newPage(){return await c(this,wo).newPage()}async _createPageInContext(t){const{targetId:r}=await c(this,qr).send("Target.createTarget",{url:"about:blank",browserContextId:t||void 0}),s=await this.waitForTarget(o=>o._targetId===r);if(!s)throw new Error(`Missing target for page (id = ${r})`);if(!(await s._initializedDeferred.valueOrThrow()===Is.SUCCESS))throw new Error(`Failed to create target for page (id = ${r})`);const a=await s.page();if(!a)throw new Error(`Failed to create a page for context (id = ${t})`);return a}targets(){return Array.from(c(this,gr).getAvailableTargets().values()).filter(t=>t._isTargetExposed()&&t._initializedDeferred.value()===Is.SUCCESS)}target(){const t=this.targets().find(r=>r.type()==="browser");if(!t)throw new Error("Browser target is not found");return t}async version(){return(await A(this,ql,tR).call(this)).product}async userAgent(){return(await A(this,ql,tR).call(this)).userAgent}async close(){await c(this,Vv).call(null),await this.disconnect()}disconnect(){return c(this,gr).dispose(),c(this,qr).dispose(),this._detach(),Promise.resolve()}get connected(){return!c(this,qr)._closed}get debugInfo(){return{pendingProtocolErrors:c(this,qr).getPendingProtocolErrors()}}};hp=new WeakMap,zv=new WeakMap,qr=new WeakMap,Vv=new WeakMap,Gv=new WeakMap,fp=new WeakMap,wo=new WeakMap,vo=new WeakMap,gr=new WeakMap,Zv=new WeakMap,ql=new WeakSet,XK=function(t){x(this,fp,t||(r=>r.type()==="page"||r.type()==="background_page"||r.type()==="webview"))},Yx=new WeakMap,Jv=new WeakMap,Xv=new WeakMap,Yv=new WeakMap,Qv=new WeakMap,tR=function(){return c(this,qr).send("Browser.getVersion")};let Tk=eO;/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */async function lG(n,e,t){const{acceptInsecureCerts:r=!1,defaultViewport:s=VM,downloadBehavior:i,targetFilter:a,_isPageTarget:o,slowMo:u=0,protocolTimeout:l}=t,d=new A$(e,n,u,l),{browserContextIds:h}=await d.send("Target.getBrowserContexts");return await Tk._create(d,h,r,s,i,void 0,()=>d.send("Browser.close").catch(Ee),a,o)}const z$={targetId:"tabTargetId",type:"tab",title:"tab",url:"about:blank",attached:!1,canAccessOpener:!1},V$={targetId:"pageTargetId",type:"page",title:"page",url:"about:blank",attached:!1,canAccessOpener:!1},tO=class tO{constructor(e){_(this,$n);J(this,"onmessage");J(this,"onclose");_(this,Hl);_(this,e_,(e,t,r)=>{e.tabId===c(this,Hl)&&A(this,$n,As).call(this,{sessionId:e.sessionId??"pageTargetSessionId",method:t,params:r})});x(this,Hl,e),chrome.debugger.onEvent.addListener(c(this,e_))}static async connectTab(e){return await chrome.debugger.attach({tabId:e},"1.3"),new tO(e)}send(e){const t=JSON.parse(e);switch(t.method){case"Browser.getVersion":{A(this,$n,As).call(this,{id:t.id,sessionId:t.sessionId,method:t.method,result:{protocolVersion:"1.3",product:"chrome",revision:"unknown",userAgent:"chrome",jsVersion:"unknown"}});return}case"Target.getBrowserContexts":{A(this,$n,As).call(this,{id:t.id,sessionId:t.sessionId,method:t.method,result:{browserContextIds:[]}});return}case"Target.setDiscoverTargets":{A(this,$n,As).call(this,{method:"Target.targetCreated",params:{targetInfo:z$}}),A(this,$n,As).call(this,{method:"Target.targetCreated",params:{targetInfo:V$}}),A(this,$n,As).call(this,{id:t.id,sessionId:t.sessionId,method:t.method,result:{}});return}case"Target.setAutoAttach":if(t.sessionId==="tabTargetSessionId"){A(this,$n,As).call(this,{method:"Target.attachedToTarget",params:{targetInfo:V$,sessionId:"pageTargetSessionId"}}),A(this,$n,As).call(this,{id:t.id,sessionId:t.sessionId,method:t.method,result:{}});return}else if(!t.sessionId){A(this,$n,As).call(this,{method:"Target.attachedToTarget",params:{targetInfo:z$,sessionId:"tabTargetSessionId"}}),A(this,$n,As).call(this,{id:t.id,sessionId:t.sessionId,method:t.method,result:{}});return}}t.sessionId==="pageTargetSessionId"&&delete t.sessionId,chrome.debugger.sendCommand({tabId:c(this,Hl),sessionId:t.sessionId},t.method,t.params).then(r=>{A(this,$n,As).call(this,{id:t.id,sessionId:t.sessionId??"pageTargetSessionId",method:t.method,result:r})}).catch(r=>{A(this,$n,As).call(this,{id:t.id,sessionId:t.sessionId??"pageTargetSessionId",method:t.method,error:{code:r==null?void 0:r.code,data:r==null?void 0:r.data,message:(r==null?void 0:r.message)??"CDP error had no message"}})})}close(){chrome.debugger.onEvent.removeListener(c(this,e_)),chrome.debugger.detach({tabId:c(this,Hl)})}};Hl=new WeakMap,e_=new WeakMap,$n=new WeakSet,As=function(e){var t;(t=this.onmessage)==null||t.call(this,JSON.stringify(e))};let Ik=tO;const rO=class rO{constructor(e){_(this,_o);J(this,"onmessage");J(this,"onclose");x(this,_o,e),c(this,_o).addEventListener("message",t=>{this.onmessage&&this.onmessage.call(null,t.data)}),c(this,_o).addEventListener("close",()=>{this.onclose&&this.onclose.call(null)}),c(this,_o).addEventListener("error",()=>{})}static create(e){return new Promise((t,r)=>{const s=new WebSocket(e);s.addEventListener("open",()=>t(new rO(s))),s.addEventListener("error",r)})}send(e){c(this,_o).send(e)}close(){c(this,_o).close()}};_o=new WeakMap;let Ok=rO;const dG=Object.freeze(Object.defineProperty({__proto__:null,BrowserWebSocketTransport:Ok},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const hG=[{name:"Blackberry PlayBook",userAgent:"Mozilla/5.0 (PlayBook; U; RIM Tablet OS 2.1.0; en-US) AppleWebKit/536.2+ (KHTML like Gecko) Version/7.2.1.0 Safari/536.2+",viewport:{width:600,height:1024,deviceScaleFactor:1,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Blackberry PlayBook landscape",userAgent:"Mozilla/5.0 (PlayBook; U; RIM Tablet OS 2.1.0; en-US) AppleWebKit/536.2+ (KHTML like Gecko) Version/7.2.1.0 Safari/536.2+",viewport:{width:1024,height:600,deviceScaleFactor:1,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"BlackBerry Z30",userAgent:"Mozilla/5.0 (BB10; Touch) AppleWebKit/537.10+ (KHTML, like Gecko) Version/10.0.9.2372 Mobile Safari/537.10+",viewport:{width:360,height:640,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"BlackBerry Z30 landscape",userAgent:"Mozilla/5.0 (BB10; Touch) AppleWebKit/537.10+ (KHTML, like Gecko) Version/10.0.9.2372 Mobile Safari/537.10+",viewport:{width:640,height:360,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Galaxy Note 3",userAgent:"Mozilla/5.0 (Linux; U; Android 4.3; en-us; SM-N900T Build/JSS15J) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",viewport:{width:360,height:640,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Galaxy Note 3 landscape",userAgent:"Mozilla/5.0 (Linux; U; Android 4.3; en-us; SM-N900T Build/JSS15J) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",viewport:{width:640,height:360,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Galaxy Note II",userAgent:"Mozilla/5.0 (Linux; U; Android 4.1; en-us; GT-N7100 Build/JRO03C) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",viewport:{width:360,height:640,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Galaxy Note II landscape",userAgent:"Mozilla/5.0 (Linux; U; Android 4.1; en-us; GT-N7100 Build/JRO03C) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",viewport:{width:640,height:360,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Galaxy S III",userAgent:"Mozilla/5.0 (Linux; U; Android 4.0; en-us; GT-I9300 Build/IMM76D) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",viewport:{width:360,height:640,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Galaxy S III landscape",userAgent:"Mozilla/5.0 (Linux; U; Android 4.0; en-us; GT-I9300 Build/IMM76D) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",viewport:{width:640,height:360,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Galaxy S5",userAgent:"Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:360,height:640,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Galaxy S5 landscape",userAgent:"Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:640,height:360,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Galaxy S8",userAgent:"Mozilla/5.0 (Linux; Android 7.0; SM-G950U Build/NRD90M) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.84 Mobile Safari/537.36",viewport:{width:360,height:740,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Galaxy S8 landscape",userAgent:"Mozilla/5.0 (Linux; Android 7.0; SM-G950U Build/NRD90M) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.84 Mobile Safari/537.36",viewport:{width:740,height:360,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Galaxy S9+",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; SM-G965U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.111 Mobile Safari/537.36",viewport:{width:320,height:658,deviceScaleFactor:4.5,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Galaxy S9+ landscape",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; SM-G965U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.111 Mobile Safari/537.36",viewport:{width:658,height:320,deviceScaleFactor:4.5,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Galaxy Tab S4",userAgent:"Mozilla/5.0 (Linux; Android 8.1.0; SM-T837A) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.80 Safari/537.36",viewport:{width:712,height:1138,deviceScaleFactor:2.25,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Galaxy Tab S4 landscape",userAgent:"Mozilla/5.0 (Linux; Android 8.1.0; SM-T837A) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.80 Safari/537.36",viewport:{width:1138,height:712,deviceScaleFactor:2.25,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPad",userAgent:"Mozilla/5.0 (iPad; CPU OS 11_0 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) Version/11.0 Mobile/15A5341f Safari/604.1",viewport:{width:768,height:1024,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPad landscape",userAgent:"Mozilla/5.0 (iPad; CPU OS 11_0 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) Version/11.0 Mobile/15A5341f Safari/604.1",viewport:{width:1024,height:768,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPad (gen 6)",userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:768,height:1024,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPad (gen 6) landscape",userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:1024,height:768,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPad (gen 7)",userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:810,height:1080,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPad (gen 7) landscape",userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:1080,height:810,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPad Mini",userAgent:"Mozilla/5.0 (iPad; CPU OS 11_0 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) Version/11.0 Mobile/15A5341f Safari/604.1",viewport:{width:768,height:1024,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPad Mini landscape",userAgent:"Mozilla/5.0 (iPad; CPU OS 11_0 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) Version/11.0 Mobile/15A5341f Safari/604.1",viewport:{width:1024,height:768,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPad Pro",userAgent:"Mozilla/5.0 (iPad; CPU OS 11_0 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) Version/11.0 Mobile/15A5341f Safari/604.1",viewport:{width:1024,height:1366,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPad Pro landscape",userAgent:"Mozilla/5.0 (iPad; CPU OS 11_0 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) Version/11.0 Mobile/15A5341f Safari/604.1",viewport:{width:1366,height:1024,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPad Pro 11",userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:834,height:1194,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPad Pro 11 landscape",userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:1194,height:834,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 4",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 7_1_2 like Mac OS X) AppleWebKit/537.51.2 (KHTML, like Gecko) Version/7.0 Mobile/11D257 Safari/9537.53",viewport:{width:320,height:480,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 4 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 7_1_2 like Mac OS X) AppleWebKit/537.51.2 (KHTML, like Gecko) Version/7.0 Mobile/11D257 Safari/9537.53",viewport:{width:480,height:320,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 5",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.0 Mobile/14E304 Safari/602.1",viewport:{width:320,height:568,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 5 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.0 Mobile/14E304 Safari/602.1",viewport:{width:568,height:320,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 6",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:375,height:667,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 6 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:667,height:375,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 6 Plus",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:414,height:736,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 6 Plus landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:736,height:414,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 7",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:375,height:667,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 7 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:667,height:375,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 7 Plus",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:414,height:736,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 7 Plus landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:736,height:414,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 8",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:375,height:667,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 8 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:667,height:375,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 8 Plus",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:414,height:736,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 8 Plus landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:736,height:414,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone SE",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.0 Mobile/14E304 Safari/602.1",viewport:{width:320,height:568,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone SE landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.0 Mobile/14E304 Safari/602.1",viewport:{width:568,height:320,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone X",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:375,height:812,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone X landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:812,height:375,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone XR",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 12_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0 Mobile/15E148 Safari/604.1",viewport:{width:414,height:896,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone XR landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 12_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0 Mobile/15E148 Safari/604.1",viewport:{width:896,height:414,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 11",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1 Mobile/15E148 Safari/604.1",viewport:{width:414,height:828,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 11 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1 Mobile/15E148 Safari/604.1",viewport:{width:828,height:414,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 11 Pro",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1 Mobile/15E148 Safari/604.1",viewport:{width:375,height:812,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 11 Pro landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1 Mobile/15E148 Safari/604.1",viewport:{width:812,height:375,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 11 Pro Max",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1 Mobile/15E148 Safari/604.1",viewport:{width:414,height:896,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 11 Pro Max landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1 Mobile/15E148 Safari/604.1",viewport:{width:896,height:414,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 12",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:390,height:844,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 12 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:844,height:390,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 12 Pro",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:390,height:844,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 12 Pro landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:844,height:390,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 12 Pro Max",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:428,height:926,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 12 Pro Max landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:926,height:428,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 12 Mini",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:375,height:812,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 12 Mini landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:812,height:375,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 13",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:390,height:844,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 13 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:844,height:390,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 13 Pro",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:390,height:844,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 13 Pro landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:844,height:390,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 13 Pro Max",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:428,height:926,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 13 Pro Max landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:926,height:428,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 13 Mini",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:375,height:812,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 13 Mini landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:812,height:375,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 14",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:390,height:663,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 14 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:750,height:340,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 14 Plus",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:428,height:745,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 14 Plus landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:832,height:378,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 14 Pro",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:393,height:659,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 14 Pro landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:734,height:343,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 14 Pro Max",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:430,height:739,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 14 Pro Max landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:814,height:380,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 15",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:393,height:659,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 15 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:734,height:343,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 15 Plus",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:430,height:739,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 15 Plus landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:814,height:380,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 15 Pro",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:393,height:659,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 15 Pro landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:734,height:343,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 15 Pro Max",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:430,height:739,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 15 Pro Max landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:814,height:380,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"JioPhone 2",userAgent:"Mozilla/5.0 (Mobile; LYF/F300B/LYF-F300B-001-01-15-130718-i;Android; rv:48.0) Gecko/48.0 Firefox/48.0 KAIOS/2.5",viewport:{width:240,height:320,deviceScaleFactor:1,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"JioPhone 2 landscape",userAgent:"Mozilla/5.0 (Mobile; LYF/F300B/LYF-F300B-001-01-15-130718-i;Android; rv:48.0) Gecko/48.0 Firefox/48.0 KAIOS/2.5",viewport:{width:320,height:240,deviceScaleFactor:1,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Kindle Fire HDX",userAgent:"Mozilla/5.0 (Linux; U; en-us; KFAPWI Build/JDQ39) AppleWebKit/535.19 (KHTML, like Gecko) Silk/3.13 Safari/535.19 Silk-Accelerated=true",viewport:{width:800,height:1280,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Kindle Fire HDX landscape",userAgent:"Mozilla/5.0 (Linux; U; en-us; KFAPWI Build/JDQ39) AppleWebKit/535.19 (KHTML, like Gecko) Silk/3.13 Safari/535.19 Silk-Accelerated=true",viewport:{width:1280,height:800,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"LG Optimus L70",userAgent:"Mozilla/5.0 (Linux; U; Android 4.4.2; en-us; LGMS323 Build/KOT49I.MS32310c) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:384,height:640,deviceScaleFactor:1.25,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"LG Optimus L70 landscape",userAgent:"Mozilla/5.0 (Linux; U; Android 4.4.2; en-us; LGMS323 Build/KOT49I.MS32310c) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:640,height:384,deviceScaleFactor:1.25,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Microsoft Lumia 550",userAgent:"Mozilla/5.0 (Windows Phone 10.0; Android 4.2.1; Microsoft; Lumia 550) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Mobile Safari/537.36 Edge/14.14263",viewport:{width:640,height:360,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Microsoft Lumia 950",userAgent:"Mozilla/5.0 (Windows Phone 10.0; Android 4.2.1; Microsoft; Lumia 950) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Mobile Safari/537.36 Edge/14.14263",viewport:{width:360,height:640,deviceScaleFactor:4,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Microsoft Lumia 950 landscape",userAgent:"Mozilla/5.0 (Windows Phone 10.0; Android 4.2.1; Microsoft; Lumia 950) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Mobile Safari/537.36 Edge/14.14263",viewport:{width:640,height:360,deviceScaleFactor:4,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nexus 10",userAgent:"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 10 Build/MOB31T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Safari/537.36",viewport:{width:800,height:1280,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nexus 10 landscape",userAgent:"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 10 Build/MOB31T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Safari/537.36",viewport:{width:1280,height:800,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nexus 4",userAgent:"Mozilla/5.0 (Linux; Android 4.4.2; Nexus 4 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:384,height:640,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nexus 4 landscape",userAgent:"Mozilla/5.0 (Linux; Android 4.4.2; Nexus 4 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:640,height:384,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nexus 5",userAgent:"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:360,height:640,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nexus 5 landscape",userAgent:"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:640,height:360,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nexus 5X",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Nexus 5X Build/OPR4.170623.006) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:412,height:732,deviceScaleFactor:2.625,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nexus 5X landscape",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Nexus 5X Build/OPR4.170623.006) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:732,height:412,deviceScaleFactor:2.625,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nexus 6",userAgent:"Mozilla/5.0 (Linux; Android 7.1.1; Nexus 6 Build/N6F26U) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:412,height:732,deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nexus 6 landscape",userAgent:"Mozilla/5.0 (Linux; Android 7.1.1; Nexus 6 Build/N6F26U) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:732,height:412,deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nexus 6P",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Nexus 6P Build/OPP3.170518.006) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:412,height:732,deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nexus 6P landscape",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Nexus 6P Build/OPP3.170518.006) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:732,height:412,deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nexus 7",userAgent:"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 7 Build/MOB30X) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Safari/537.36",viewport:{width:600,height:960,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nexus 7 landscape",userAgent:"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 7 Build/MOB30X) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Safari/537.36",viewport:{width:960,height:600,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nokia Lumia 520",userAgent:"Mozilla/5.0 (compatible; MSIE 10.0; Windows Phone 8.0; Trident/6.0; IEMobile/10.0; ARM; Touch; NOKIA; Lumia 520)",viewport:{width:320,height:533,deviceScaleFactor:1.5,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nokia Lumia 520 landscape",userAgent:"Mozilla/5.0 (compatible; MSIE 10.0; Windows Phone 8.0; Trident/6.0; IEMobile/10.0; ARM; Touch; NOKIA; Lumia 520)",viewport:{width:533,height:320,deviceScaleFactor:1.5,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nokia N9",userAgent:"Mozilla/5.0 (MeeGo; NokiaN9) AppleWebKit/534.13 (KHTML, like Gecko) NokiaBrowser/8.5.0 Mobile Safari/534.13",viewport:{width:480,height:854,deviceScaleFactor:1,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nokia N9 landscape",userAgent:"Mozilla/5.0 (MeeGo; NokiaN9) AppleWebKit/534.13 (KHTML, like Gecko) NokiaBrowser/8.5.0 Mobile Safari/534.13",viewport:{width:854,height:480,deviceScaleFactor:1,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Pixel 2",userAgent:"Mozilla/5.0 (Linux; Android 8.0; Pixel 2 Build/OPD3.170816.012) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:411,height:731,deviceScaleFactor:2.625,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Pixel 2 landscape",userAgent:"Mozilla/5.0 (Linux; Android 8.0; Pixel 2 Build/OPD3.170816.012) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:731,height:411,deviceScaleFactor:2.625,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Pixel 2 XL",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Pixel 2 XL Build/OPD1.170816.004) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:411,height:823,deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Pixel 2 XL landscape",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Pixel 2 XL Build/OPD1.170816.004) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:823,height:411,deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Pixel 3",userAgent:"Mozilla/5.0 (Linux; Android 9; Pixel 3 Build/PQ1A.181105.017.A1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.158 Mobile Safari/537.36",viewport:{width:393,height:786,deviceScaleFactor:2.75,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Pixel 3 landscape",userAgent:"Mozilla/5.0 (Linux; Android 9; Pixel 3 Build/PQ1A.181105.017.A1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.158 Mobile Safari/537.36",viewport:{width:786,height:393,deviceScaleFactor:2.75,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Pixel 4",userAgent:"Mozilla/5.0 (Linux; Android 10; Pixel 4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Mobile Safari/537.36",viewport:{width:353,height:745,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Pixel 4 landscape",userAgent:"Mozilla/5.0 (Linux; Android 10; Pixel 4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Mobile Safari/537.36",viewport:{width:745,height:353,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Pixel 4a (5G)",userAgent:"Mozilla/5.0 (Linux; Android 11; Pixel 4a (5G)) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4812.0 Mobile Safari/537.36",viewport:{width:353,height:745,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Pixel 4a (5G) landscape",userAgent:"Mozilla/5.0 (Linux; Android 11; Pixel 4a (5G)) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4812.0 Mobile Safari/537.36",viewport:{width:745,height:353,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Pixel 5",userAgent:"Mozilla/5.0 (Linux; Android 11; Pixel 5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4812.0 Mobile Safari/537.36",viewport:{width:393,height:851,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Pixel 5 landscape",userAgent:"Mozilla/5.0 (Linux; Android 11; Pixel 5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4812.0 Mobile Safari/537.36",viewport:{width:851,height:393,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Moto G4",userAgent:"Mozilla/5.0 (Linux; Android 7.0; Moto G (4)) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4812.0 Mobile Safari/537.36",viewport:{width:360,height:640,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Moto G4 landscape",userAgent:"Mozilla/5.0 (Linux; Android 7.0; Moto G (4)) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4812.0 Mobile Safari/537.36",viewport:{width:640,height:360,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}}],G$={};for(const n of hG)G$[n.name]=n;Object.freeze(G$);/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */async function fG(n,e,t){const{acceptInsecureCerts:r=!1,defaultViewport:s=VM}=t,{bidiConnection:i,cdpConnection:a,closeCallback:o}=await pG(n,e,t);return await(await Promise.resolve().then(()=>bH)).BidiBrowser.create({connection:i,cdpConnection:a,closeCallback:o,process:void 0,defaultViewport:s,acceptInsecureCerts:r,capabilities:t.capabilities})}async function pG(n,e,t){const r=await Promise.resolve().then(()=>bH),{slowMo:s=0,protocolTimeout:i}=t,a=new r.BidiConnection(e,n,s,i);try{const d=await a.send("session.status",{});if("type"in d&&d.type==="success")return{bidiConnection:a,closeCallback:async()=>{await a.send("browser.close",{}).catch(Ee)}}}catch(d){if(!(d instanceof su))throw d}a.unbind();const o=new A$(e,n,s,i,!0);if((await o.send("Browser.getVersion")).product.toLowerCase().includes("firefox"))throw new He("Firefox is not supported in BiDi over CDP mode.");const l=await r.connectBidiOverCdp(o);return{cdpConnection:o,bidiConnection:l,closeCallback:async()=>{await o.send("Browser.close").catch(Ee)}}}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const Z$=async()=>HM?(await Promise.resolve().then(()=>yle)).NodeWebSocketTransport:(await Promise.resolve().then(()=>dG)).BrowserWebSocketTransport;async function mG(n){const{connectionTransport:e,endpointUrl:t}=await gG(n);return n.protocol==="webDriverBiDi"?await fG(e,t,n):await lG(e,t,n)}async function gG(n){const{browserWSEndpoint:e,browserURL:t,transport:r,headers:s={}}=n;if(ae(+!!e+ +!!t+ +!!r==1,"Exactly one of browserWSEndpoint, browserURL or transport must be passed to puppeteer.connect"),r)return{connectionTransport:r,endpointUrl:""};if(e)return{connectionTransport:await(await Z$()).create(e,s),endpointUrl:e};if(t){const i=await yG(t);return{connectionTransport:await(await Z$()).create(i),endpointUrl:i}}throw new Error("Invalid connection options")}async function yG(n){const e=new URL("/json/version",n);try{const t=await globalThis.fetch(e.toString(),{method:"GET"});if(!t.ok)throw new Error(`HTTP ${t.statusText}`);return(await t.json()).webSocketDebuggerUrl}catch(t){throw Ts(t)&&(t.message=`Failed to fetch browser webSocket URL from ${e}: `+t.message),t}}/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class J${constructor(e){J(this,"_isPuppeteerCore");J(this,"_changedBrowsers",!1);this._isPuppeteerCore=e.isPuppeteerCore,this.connect=this.connect.bind(this)}static registerCustomQueryHandler(e,t){return this.customQueryHandlers.register(e,t)}static unregisterCustomQueryHandler(e){return this.customQueryHandlers.unregister(e)}static customQueryHandlerNames(){return this.customQueryHandlers.names()}static clearCustomQueryHandlers(){return this.customQueryHandlers.clear()}connect(e){return mG(e)}}J(J$,"customQueryHandlers",uk);/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const wG=new J$({isPuppeteerCore:!0}),{connect:vG}=wG,Xs=n=>{const e=`[${n}]`;return{debug:(...t)=>{},info:(...t)=>console.info(e,...t),warning:(...t)=>console.warn(e,...t),error:(...t)=>console.error(e,...t),group:t=>console.group(`${e} ${t}`),groupEnd:()=>console.groupEnd()}};class X${constructor(e,t,r){this.branchPathHash=e,this.attributesHash=t,this.xpathHash=r}}class _G{constructor(e,t,r,s,i,a=!1,o=null,u=null,l=null,d=null){this.tagName=e,this.xpath=t,this.highlightIndex=r,this.entireParentBranchPath=s,this.attributes=i,this.shadowRoot=a,this.cssSelector=o,this.pageCoordinates=u,this.viewportCoordinates=l,this.viewportInfo=d}toDict(){return{tagName:this.tagName,xpath:this.xpath,highlightIndex:this.highlightIndex,entireParentBranchPath:this.entireParentBranchPath,attributes:this.attributes,shadowRoot:this.shadowRoot,cssSelector:this.cssSelector,pageCoordinates:this.pageCoordinates,viewportCoordinates:this.viewportCoordinates,viewportInfo:this.viewportInfo}}}var Rk;(n=>{function e(h){const f=a(h),p=h.getAdvancedCssSelector();return new _G(h.tagName??"",h.xpath??"",h.highlightIndex??null,f,h.attributes,h.shadowRoot,p,h.pageCoordinates??null,h.viewportCoordinates??null,h.viewportInfo??null)}n.convertDomElementToHistoryElement=e;async function t(h,f){const p=await s(h),m=async g=>{if(g.highlightIndex!==void 0){const y=await i(g);if(y.branchPathHash===p.branchPathHash&&y.attributesHash===p.attributesHash&&y.xpathHash===p.xpathHash)return g}for(const y of g.children)if(y instanceof Ys){const w=await m(y);if(w!==null)return w}return null};return m(f)}n.findHistoryElementInTree=t;async function r(h,f){const[p,m]=await Promise.all([s(h),i(f)]);return p.branchPathHash===m.branchPathHash&&p.attributesHash===m.attributesHash&&p.xpathHash===m.xpathHash}n.compareHistoryElementAndDomElement=r;async function s(h){const[f,p,m]=await Promise.all([o(h.entireParentBranchPath),u(h.attributes),l(h.xpath??"")]);return new X$(f,p,m)}async function i(h){const f=a(h),[p,m,g]=await Promise.all([o(f),u(h.attributes),l(h.xpath??"")]);return new X$(p,m,g)}n.hashDomElement=i;function a(h){const f=[];let p=h;for(;p.parent!==null&&p.parent!==void 0;)f.push(p),p=p.parent;return f.reverse(),f.map(m=>m.tagName??"")}n.getParentBranchPath=a;async function o(h){return h.length===0?"":d(h.join("/"))}n.parentBranchPathHash=o;async function u(h){const f=Object.entries(h).map(([p,m])=>`${p}=${m}`).join("");return d(f)}n.hashAttributes=u;async function l(h){return d(h)}n.hashXPath=l;async function d(h){const p=new TextEncoder().encode(h),m=await crypto.subtle.digest("SHA-256",p);return Array.from(new Uint8Array(m)).map(y=>y.toString(16).padStart(2,"0")).join("")}n.createSHA256Hash=d})(Rk||(Rk={}));class Y${constructor(e,t){this.isVisible=e,this.parent=t}}class Mk extends Y${constructor(e,t,r){super(t,r),this.type="TEXT_NODE",this.text=e}hasParentWithHighlightIndex(){let e=this.parent;for(;e!=null;){if(e.highlightIndex!==void 0)return!0;e=e.parent}return!1}}class Ys extends Y${constructor(e){super(e.isVisible,e.parent),this.tagName=e.tagName,this.xpath=e.xpath,this.attributes=e.attributes,this.children=e.children,this.isInteractive=e.isInteractive??!1,this.isTopElement=e.isTopElement??!1,this.shadowRoot=e.shadowRoot??!1,this.highlightIndex=e.highlightIndex,this.viewportCoordinates=e.viewportCoordinates,this.pageCoordinates=e.pageCoordinates,this.viewportInfo=e.viewportInfo}async hash(){return this._hashedValue?this._hashedValue:(this._hashPromise||(this._hashPromise=Rk.hashDomElement(this).then(e=>(this._hashedValue=e,this._hashPromise=void 0,e)).catch(e=>{this._hashPromise=void 0,console.error("Error computing DOM element hash:",e);const t=new Error(`Failed to hash DOM element (${this.tagName||"unknown"}): ${e.message}`);throw e.stack&&(t.stack=e.stack),t})),this._hashPromise)}clearHashCache(){this._hashedValue=void 0,this._hashPromise=void 0}getAllTextTillNextClickableElement(e=-1){const t=[],r=(s,i)=>{if(!(e!==-1&&i>e)&&!(s instanceof Ys&&s!==this&&s.highlightIndex!==void 0)){if(s instanceof Mk)t.push(s.text);else if(s instanceof Ys)for(const a of s.children)r(a,i+1)}};return r(this,0),t.join(`
`).trim()}clickableElementsToString(e=[]){const t=[],r=(s,i)=>{if(s instanceof Ys){if(s.highlightIndex!==void 0){let a="";e.length&&(a=` ${e.map(o=>s.attributes[o]?`${o}="${s.attributes[o]}"`:"").filter(Boolean).join(" ")}`),t.push(`[${s.highlightIndex}]<${s.tagName}${a}>${s.getAllTextTillNextClickableElement()}</${s.tagName}>`)}for(const a of s.children)r(a)}else s instanceof Mk&&(s.hasParentWithHighlightIndex()||t.push(`[]${s.text}`))};return r(this),t.join(`
`)}getFileUploadElement(e=!0){if(this.tagName==="input"&&this.attributes.type==="file")return this;for(const t of this.children)if(t instanceof Ys){const r=t.getFileUploadElement(!1);if(r)return r}if(e&&this.parent){for(const t of this.parent.children)if(t!==this&&t instanceof Ys){const r=t.getFileUploadElement(!1);if(r)return r}}return null}getAdvancedCssSelector(){return this.enhancedCssSelectorForElement()}convertSimpleXPathToCssSelector(e){if(!e)return"";const r=e.replace(/^\//,"").split("/"),s=[];for(const a of r)if(a)if(a.includes("[")){const o=a.indexOf("[");let u=a.substring(0,o);const d=a.substring(o).split("]").slice(0,-1).map(h=>h.replace("[",""));for(const h of d)if(/^\d+$/.test(h))try{const f=Number.parseInt(h,10)-1;u+=`:nth-of-type(${f+1})`}catch{}else h==="last()"?u+=":last-of-type":h.includes("position()")&&h.includes(">1")&&(u+=":nth-of-type(n+2)");s.push(u)}else s.push(a);return s.join(" > ")}enhancedCssSelectorForElement(e=!0){try{if(!this.xpath)return"";let t=this.convertSimpleXPathToCssSelector(this.xpath);if(this.attributes.class&&e){const s=/^[a-zA-Z_][a-zA-Z0-9_-]*$/,i=this.attributes.class.split(/\s+/);for(const a of i)a.trim()&&s.test(a)&&(t+=`.${a}`)}const r=new Set(["id","name","type","value","placeholder","aria-label","aria-labelledby","aria-describedby","role","for","autocomplete","required","readonly","alt","title","src","href","target"]);e&&(r.add("data-id"),r.add("data-qa"),r.add("data-cy"),r.add("data-testid"));for(const[s,i]of Object.entries(this.attributes)){if(s==="class"||!s.trim()||!r.has(s))continue;const a=s.replace(":","\\:");if(i==="")t+=`[${a}]`;else if(/["'<>`\n\r\t]/.test(i)){const u=i.replace(/\s+/g," ").trim().replace(/"/g,'\\"');t+=`[${a}*="${u}"]`}else t+=`[${a}="${i}"]`}return t}catch{return`${this.tagName||"*"}[highlight-index='${this.highlightIndex}']`}}}async function Q$(n){return new Set(await Promise.all(Array.from(n.selectorMap.values()).map(async t=>(await t.hash()).branchPathHash)))}const eN=Xs("DOMService");async function bG(n){var r;const t=(r=(await chrome.scripting.executeScript({target:{tabId:n},func:()=>{const s=window.scrollY,i=window.innerHeight,a=document.documentElement.scrollHeight;return{pixels_above:s,pixels_below:a-(s+i)}}}))[0])==null?void 0:r.result;if(!t)throw new Error("Failed to get scroll information");return[t.pixels_above,t.pixels_below]}async function SG(n,e){var s;const r=(s=(await chrome.scripting.executeScript({target:{tabId:n},func:i=>window.turn2Markdown(i),args:[e||""]}))[0])==null?void 0:s.result;if(!r)throw new Error("Failed to get markdown content");return r}async function xG(n){var r;const t=(r=(await chrome.scripting.executeScript({target:{tabId:n},func:()=>window.parserReadability()}))[0])==null?void 0:r.result;if(!t)throw new Error("Failed to get readability content");return t}async function EG(n,e=!0,t=-1,r=0){try{const s=await CG(n,e,t,r),i=kG(s);return{elementTree:s,selectorMap:i}}catch(s){return eN.error("Failed to build DOM tree:",s),null}}function kG(n){const e=new Map;function t(r){r instanceof Ys&&(r.highlightIndex!=null&&e.set(r.highlightIndex,r),r.children.forEach(t))}return t(n),e}async function CG(n,e=!0,t=-1,r=0){const i=(await chrome.scripting.executeScript({target:{tabId:n},func:a=>window.buildDomTree(a),args:[{doHighlightElements:e,focusHighlightIndex:t,viewportExpansion:r}]}))[0].result;if(i!==null){const a=tN(i);if(a!==null&&a instanceof Ys)return a}throw new Error("Failed to build DOM tree: Invalid or empty tree structure")}function tN(n,e=null){if(!n)return null;if("type"in n)return new Mk(n.text,n.isVisible,e);const t=n.tagName,r=n.viewportCoordinates,s=n.pageCoordinates,i=n.viewportInfo,a=new Ys({tagName:t,xpath:n.xpath,attributes:n.attributes??{},children:[],isVisible:n.isVisible??!1,isInteractive:n.isInteractive??!1,isTopElement:n.isTopElement??!1,highlightIndex:n.highlightIndex,viewportCoordinates:r??void 0,pageCoordinates:s??void 0,viewportInfo:i??void 0,shadowRoot:n.shadowRoot??!1,parent:e}),o=[];for(const u of n.children||[])if(u!==null){const l=tN(u,a);l!==null&&o.push(l)}return a.children=o,a}async function PG(n){try{await chrome.scripting.executeScript({target:{tabId:n},func:()=>{const e=document.getElementById("playwright-highlight-container");e&&e.remove();const t=document.querySelectorAll('[browser-user-highlight-id^="playwright-highlight-"]');for(const r of Array.from(t))r.removeAttribute("browser-user-highlight-id")}})}catch(e){eN.error("Failed to remove highlights:",e)}}const tt=Xs("Page");function Ab(n,e,t){return{elementTree:new Ys({tagName:"root",isVisible:!0,parent:null,xpath:"",attributes:{},children:[]}),selectorMap:new Map,tabId:n||0,url:e||"",title:t||"",screenshot:null,pixelsAbove:0,pixelsBelow:0}}let AG=class{constructor(e,t,r,s={}){this._browser=null,this._puppeteerPage=null,this._validWebPage=!1,this._tabId=e,this._config={...uM,...s},this._state=Ab(e,t,r),this._validWebPage=e&&t&&t.startsWith("http")||!1}get tabId(){return this._tabId}get validWebPage(){return this._validWebPage}get attached(){return this._validWebPage&&this._puppeteerPage!==null}async attachPuppeteer(){if(!this._validWebPage)return!1;if(this._puppeteerPage)return!0;tt.info("attaching puppeteer",this._tabId);const e=await vG({transport:await Ik.connectTab(this._tabId),defaultViewport:null,protocol:"cdp"});this._browser=e;const[t]=await e.pages();return this._puppeteerPage=t,await this._addAntiDetectionScripts(),!0}async _addAntiDetectionScripts(){this._puppeteerPage&&await this._puppeteerPage.evaluateOnNewDocument(`
      // Webdriver property
      Object.defineProperty(navigator, 'webdriver', {
        get: () => undefined
      });

      // Languages
      // Object.defineProperty(navigator, 'languages', {
      //   get: () => ['en-US']
      // });

      // Plugins
      // Object.defineProperty(navigator, 'plugins', {
      //   get: () => [1, 2, 3, 4, 5]
      // });

      // Chrome runtime
      window.chrome = { runtime: {} };

      // Permissions
      const originalQuery = window.navigator.permissions.query;
      window.navigator.permissions.query = (parameters) => (
        parameters.name === 'notifications' ?
          Promise.resolve({ state: Notification.permission }) :
          originalQuery(parameters)
      );

      // Shadow DOM
      (function () {
        const originalAttachShadow = Element.prototype.attachShadow;
        Element.prototype.attachShadow = function attachShadow(options) {
          return originalAttachShadow.call(this, { ...options, mode: "open" });
        };
      })();
    `)}async detachPuppeteer(){this._browser&&(await this._browser.disconnect(),this._browser=null,this._puppeteerPage=null,this._state=Ab(this._tabId))}async removeHighlight(){this._config.highlightElements&&this._validWebPage&&await PG(this._tabId)}async getClickableElements(e){return this._validWebPage?EG(this._tabId,this._config.highlightElements,e,this._config.viewportExpansion):null}async getScrollInfo(){return this._validWebPage?bG(this._tabId):[0,0]}async getContent(){if(!this._puppeteerPage)throw new Error("Puppeteer page is not connected");return await this._puppeteerPage.content()}async getMarkdownContent(e){return this._validWebPage?SG(this._tabId,e):""}async getReadabilityContent(){return this._validWebPage?xG(this._tabId):""}async getState(){return this._validWebPage?(await this.waitForPageAndFramesLoad(),await this._updateState()):Ab(this._tabId)}async _updateState(e=!0,t=-1){var r,s,i;try{await this._puppeteerPage.evaluate("1")}catch(a){if(tt.warning("Current page is no longer accessible:",a),this._browser){const o=await this._browser.pages();if(o.length>0)this._puppeteerPage=o[0];else throw new Error("Browser closed: no valid pages available")}}try{await this.removeHighlight();const a=await this.getClickableElements(t);if(!a)return tt.warning("Failed to get clickable elements"),this._state;"selectorMap"in a?tt.debug("content.selectorMap:",a.selectorMap.size):tt.debug("content.selectorMap: not found"),"elementTree"in a?tt.debug("content.elementTree:",(r=a.elementTree)==null?void 0:r.tagName):tt.debug("content.elementTree: not found");const o=e?await this.takeScreenshot():null,[u,l]=await this.getScrollInfo();return this._state.elementTree=a.elementTree,this._state.selectorMap=a.selectorMap,this._state.url=((s=this._puppeteerPage)==null?void 0:s.url())||"",this._state.title=await((i=this._puppeteerPage)==null?void 0:i.title())||"",this._state.screenshot=o,this._state.pixelsAbove=u,this._state.pixelsBelow=l,this._state}catch(a){return tt.error("Failed to update state:",a),this._state}}async takeScreenshot(e=!1){if(!this._puppeteerPage)throw new Error("Puppeteer page is not connected");try{await this._puppeteerPage.evaluate(()=>{const r="puppeteer-disable-animations";if(!document.getElementById(r)){const s=document.createElement("style");s.id=r,s.textContent=`
            *, *::before, *::after {
              animation: none !important;
              transition: none !important;
            }
          `,document.head.appendChild(s)}});const t=await this._puppeteerPage.screenshot({fullPage:e,encoding:"base64",type:"jpeg",quality:80});return await this._puppeteerPage.evaluate(()=>{const r=document.getElementById("puppeteer-disable-animations");r&&r.remove()}),t}catch(t){throw tt.error("Failed to take screenshot:",t),t}}url(){return this._puppeteerPage?this._puppeteerPage.url():this._state.url}async title(){return this._puppeteerPage?await this._puppeteerPage.title():this._state.title}async navigateTo(e){if(this._puppeteerPage){tt.info("navigateTo",e);try{await Promise.all([this.waitForPageAndFramesLoad(),this._puppeteerPage.goto(e)]),tt.info("navigateTo complete")}catch(t){if(t instanceof Error&&t.message.includes("timeout"))tt.warning("Navigation timeout, but page might still be usable:",t);else throw tt.error("Navigation failed:",t),t}}}async refreshPage(){if(this._puppeteerPage)try{await Promise.all([this.waitForPageAndFramesLoad(),this._puppeteerPage.reload()]),tt.info("Page refresh complete")}catch(e){if(e instanceof Error&&e.message.includes("timeout"))tt.warning("Refresh timeout, but page might still be usable:",e);else throw tt.error("Page refresh failed:",e),e}}async goBack(){if(this._puppeteerPage)try{await Promise.all([this.waitForPageAndFramesLoad(),this._puppeteerPage.goBack()]),tt.info("Navigation back completed")}catch(e){if(e instanceof Error&&e.message.includes("timeout"))tt.warning("Back navigation timeout, but page might still be usable:",e);else throw tt.error("Could not navigate back:",e),e}}async goForward(){if(this._puppeteerPage)try{await Promise.all([this.waitForPageAndFramesLoad(),this._puppeteerPage.goForward()]),tt.info("Navigation forward completed")}catch(e){if(e instanceof Error&&e.message.includes("timeout"))tt.warning("Forward navigation timeout, but page might still be usable:",e);else throw tt.error("Could not navigate forward:",e),e}}async scrollDown(e){var t,r;this._puppeteerPage&&(e?await((t=this._puppeteerPage)==null?void 0:t.evaluate(`window.scrollBy(0, ${e});`)):await((r=this._puppeteerPage)==null?void 0:r.evaluate("window.scrollBy(0, window.innerHeight);")))}async scrollUp(e){var t,r;this._puppeteerPage&&(e?await((t=this._puppeteerPage)==null?void 0:t.evaluate(`window.scrollBy(0, -${e});`)):await((r=this._puppeteerPage)==null?void 0:r.evaluate("window.scrollBy(0, -window.innerHeight);")))}async sendKeys(e){if(!this._puppeteerPage)throw new Error("Puppeteer page is not connected");const t=e.split("+"),r=t.slice(0,-1),s=t[t.length-1];try{for(const i of r)await this._puppeteerPage.keyboard.down(this._convertKey(i));await Promise.all([this._puppeteerPage.keyboard.press(this._convertKey(s)),this.waitForPageAndFramesLoad()]),tt.info("sendKeys complete",e)}catch(i){throw tt.error("Failed to send keys:",i),new Error(`Failed to send keys: ${i instanceof Error?i.message:String(i)}`)}finally{for(const i of[...r].reverse())try{await this._puppeteerPage.keyboard.up(this._convertKey(i))}catch(a){tt.error("Failed to release modifier:",i,a)}}}_convertKey(e){const t=e.trim().toLowerCase();if(navigator.userAgent.toLowerCase().includes("mac os x")){if(t==="control"||t==="ctrl"||t==="command"||t==="cmd")return"Meta";if(t==="option"||t==="opt")return"Alt"}const i={a:"KeyA",b:"KeyB",c:"KeyC",d:"KeyD",e:"KeyE",f:"KeyF",g:"KeyG",h:"KeyH",i:"KeyI",j:"KeyJ",k:"KeyK",l:"KeyL",m:"KeyM",n:"KeyN",o:"KeyO",p:"KeyP",q:"KeyQ",r:"KeyR",s:"KeyS",t:"KeyT",u:"KeyU",v:"KeyV",w:"KeyW",x:"KeyX",y:"KeyY",z:"KeyZ",0:"Digit0",1:"Digit1",2:"Digit2",3:"Digit3",4:"Digit4",5:"Digit5",6:"Digit6",7:"Digit7",8:"Digit8",9:"Digit9",control:"Control",shift:"Shift",alt:"Alt",meta:"Meta",enter:"Enter",backspace:"Backspace",delete:"Delete",arrowleft:"ArrowLeft",arrowright:"ArrowRight",arrowup:"ArrowUp",arrowdown:"ArrowDown",escape:"Escape",tab:"Tab",space:"Space"}[t]||e;return tt.info("convertedKey",i),i}async scrollToText(e){if(!this._puppeteerPage)throw new Error("Puppeteer is not connected");try{const t=[`::-p-text(${e})`,`::-p-xpath(//*[contains(translate(text(), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz'), '${e.toLowerCase()}')])`];for(const r of t)try{const s=await this._puppeteerPage.$(r);if(s&&await s.evaluate(a=>{const o=window.getComputedStyle(a);return o.display!=="none"&&o.visibility!=="hidden"&&o.opacity!=="0"}))return await this._scrollIntoViewIfNeeded(s),await new Promise(a=>setTimeout(a,500)),!0}catch(s){tt.debug(`Locator attempt failed: ${s}`)}return!1}catch(t){throw new Error(t instanceof Error?t.message:String(t))}}async getDropdownOptions(e){const t=this.getSelectorMap(),r=t==null?void 0:t.get(e);if(!r||!this._puppeteerPage)throw new Error("Element not found or puppeteer is not connected");try{const s=await this.locateElement(r);if(!s)throw new Error("Dropdown element not found");const i=await s.evaluate(a=>{if(!(a instanceof HTMLSelectElement))throw new Error("Element is not a select element");return Array.from(a.options).map(o=>({index:o.index,text:o.text,value:o.value}))});if(!i.length)throw new Error("No options found in dropdown");return i}catch(s){throw new Error(`Failed to get dropdown options: ${s instanceof Error?s.message:String(s)}`)}}async selectDropdownOption(e,t){var i;const r=this.getSelectorMap(),s=r==null?void 0:r.get(e);if(!s||!this._puppeteerPage)throw new Error("Element not found or puppeteer is not connected");if(tt.debug(`Element attributes: ${JSON.stringify(s.attributes)}`),tt.debug(`Element tag: ${s.tagName}`),((i=s.tagName)==null?void 0:i.toLowerCase())!=="select"){const a=`Cannot select option: Element with index ${e} is a ${s.tagName}, not a SELECT`;throw tt.error(a),new Error(a)}try{const a=await this.locateElement(s);if(!a)throw new Error(`Dropdown element with index ${e} not found`);const o=await a.evaluate((u,l,d)=>{if(!(u instanceof HTMLSelectElement))return{found:!1,message:`Element with index ${d} is not a SELECT`};const h=Array.from(u.options),f=h.find(m=>m.text.trim()===l);if(!f){const m=h.map(g=>g.text.trim()).join('", "');return{found:!1,message:`Option "${l}" not found in dropdown element with index ${d}. Available options: "${m}"`}}const p=u.value;return u.value=f.value,p!==f.value&&(u.dispatchEvent(new Event("change",{bubbles:!0})),u.dispatchEvent(new Event("input",{bubbles:!0}))),{found:!0,message:`Selected option "${l}" with value "${f.value}"`}},t,e);return tt.debug("Selection result:",o),o.message}catch(a){const o=`${a instanceof Error?a.message:String(a)}`;throw tt.error(o),new Error(o)}}async locateElement(e){if(!this._puppeteerPage)return tt.warning("Puppeteer is not connected"),null;let t=this._puppeteerPage;const r=[];let s=e;for(;s.parent;)r.push(s.parent),s=s.parent;const i=r.reverse().filter(o=>o.tagName==="iframe");for(const o of i){const u=o.enhancedCssSelectorForElement(this._config.includeDynamicAttributes),l=await t.$(u);if(!l)return tt.warning(`Could not find iframe with selector: ${u}`),null;const d=await l.contentFrame();if(!d)return tt.warning(`Could not access frame content for selector: ${u}`),null;t=d}const a=e.enhancedCssSelectorForElement(this._config.includeDynamicAttributes);try{const o=await t.$(a);if(o)return await this._scrollIntoViewIfNeeded(o),o}catch(o){tt.error("Failed to locate element:",o)}return null}async inputTextElementNode(e,t,r){if(!this._puppeteerPage)throw new Error("Puppeteer is not connected");try{t.highlightIndex!==void 0&&await this._updateState(e,t.highlightIndex);const s=await this.locateElement(t);if(!s)throw new Error(`Element: ${t} not found`);await this._scrollIntoViewIfNeeded(s),await s.evaluate(i=>{(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement)&&(i.value="",i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0})))}),await s.type(r)}catch(s){throw new Error(`Failed to input text into element: ${t}. Error: ${s instanceof Error?s.message:String(s)}`)}}async _scrollIntoViewIfNeeded(e,t=2500){const r=Date.now();for(;!await e.evaluate(i=>{const a=i.getBoundingClientRect();if(a.width===0||a.height===0)return!1;const o=window.getComputedStyle(i);return o.visibility==="hidden"||o.display==="none"||o.opacity==="0"?!1:a.top>=0&&a.left>=0&&a.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&a.right<=(window.innerWidth||document.documentElement.clientWidth)?!0:(i.scrollIntoView({behavior:"auto",block:"center",inline:"center"}),!1)});){if(Date.now()-r>t)throw new Error("Timed out while trying to scroll element into view");await new Promise(i=>setTimeout(i,100))}}async clickElementNode(e,t){if(!this._puppeteerPage)throw new Error("Puppeteer is not connected");try{t.highlightIndex!==void 0&&await this._updateState(e,t.highlightIndex);const r=await this.locateElement(t);if(!r)throw new Error(`Element: ${t} not found`);await this._scrollIntoViewIfNeeded(r);try{await Promise.race([r.click(),new Promise((s,i)=>setTimeout(()=>i(new Error("Click timeout")),2e3))])}catch(s){tt.info("Failed to click element, trying again",s);try{await r.evaluate(i=>i.click())}catch(i){throw new Error(`Failed to click element: ${i instanceof Error?i.message:String(i)}`)}}}catch(r){throw new Error(`Failed to click element: ${t}. Error: ${r instanceof Error?r.message:String(r)}`)}}getSelectorMap(){return this._state.selectorMap}async getElementByIndex(e){const r=this.getSelectorMap().get(e);return r?await this.locateElement(r):null}getDomElementByIndex(e){return this.getSelectorMap().get(e)||null}isFileUploader(e,t=3,r=0){var s;if(r>t)return!1;if(e.tagName==="input"){const i=e.attributes;if(((s=i.type)==null?void 0:s.toLowerCase())==="file"||i.accept)return!0}if(e.children&&r<t){for(const i of e.children)if("tagName"in i&&this.isFileUploader(i,t,r+1))return!0}return!1}async waitForPageLoadState(e){var r;const t=e||8e3;await((r=this._puppeteerPage)==null?void 0:r.waitForNavigation({timeout:t}))}async _waitForStableNetwork(){if(!this._puppeteerPage)throw new Error("Puppeteer page is not connected");const e=new Set(["document","stylesheet","image","font","script","iframe"]),t=new Set(["text/html","text/css","application/javascript","image/","font/","application/json"]),r=new Set(["analytics","tracking","telemetry","beacon","metrics","doubleclick","adsystem","adserver","advertising","facebook.com/plugins","platform.twitter","linkedin.com/embed","livechat","zendesk","intercom","crisp.chat","hotjar","push-notifications","onesignal","pushwoosh","heartbeat","ping","alive","webrtc","rtmp://","wss://","cloudfront.net","fastly.net"]),s=new Set;let i=Date.now();const a=u=>{const l=u.resourceType();if(!e.has(l)||["websocket","media","eventsource","manifest","other"].includes(l))return;const d=u.url().toLowerCase();if(Array.from(r).some(f=>d.includes(f))||d.startsWith("data:")||d.startsWith("blob:"))return;const h=u.headers();h.purpose==="prefetch"||h["sec-fetch-dest"]==="video"||h["sec-fetch-dest"]==="audio"||(s.add(u),i=Date.now())},o=u=>{var f;const l=u.request();if(!s.has(l))return;const d=((f=u.headers()["content-type"])==null?void 0:f.toLowerCase())||"";if(["streaming","video","audio","webm","mp4","event-stream","websocket","protobuf"].some(p=>d.includes(p))){s.delete(l);return}if(!Array.from(t).some(p=>d.includes(p))){s.delete(l);return}const h=u.headers()["content-length"];if(h&&Number.parseInt(h)>5*1024*1024){s.delete(l);return}s.delete(l),i=Date.now()};this._puppeteerPage.on("request",a),this._puppeteerPage.on("response",o);try{const u=Date.now();for(;;){await new Promise(f=>setTimeout(f,100));const l=Date.now(),d=(l-i)/1e3;if(s.size===0&&d>=this._config.waitForNetworkIdlePageLoadTime)break;if((l-u)/1e3>this._config.maximumWaitPageLoadTime){console.debug(`Network timeout after ${this._config.maximumWaitPageLoadTime}s with ${s.size} pending requests:`,Array.from(s).map(f=>f.url()));break}}}finally{this._puppeteerPage.off("request",a),this._puppeteerPage.off("response",o)}console.debug(`Network stabilized for ${this._config.waitForNetworkIdlePageLoadTime} seconds`)}async waitForPageAndFramesLoad(e){const t=Date.now();try{await this._waitForStableNetwork()}catch{console.warn("Page load failed, continuing...")}const r=(Date.now()-t)/1e3,s=e||this._config.minimumWaitPageLoadTime,i=Math.max(s-r,0);console.debug(`--Page loaded in ${r.toFixed(2)} seconds, waiting for additional ${i.toFixed(2)} seconds`),i>0&&await new Promise(a=>setTimeout(a,i*1e3))}};const Sd=Xs("BrowserContext");class TG{constructor(e){this._currentTabId=null,this._attachedPages=new Map,this._config={...uM,...e}}getConfig(){return this._config}updateCurrentTabId(e){this._currentTabId=e}async _getOrCreatePage(e,t=!1){if(!e.id)throw new Error("Tab ID is not available");const r=this._attachedPages.get(e.id);if(r){if(Sd.info("getOrCreatePage",e.id,"already attached"),!t)return r;await r.detachPuppeteer(),this._attachedPages.delete(e.id)}return Sd.info("getOrCreatePage",e.id,"creating new page"),new AG(e.id,e.url||"",e.title||"",this._config)}async cleanup(){const e=await this.getCurrentPage();e==null||e.removeHighlight();for(const t of this._attachedPages.values())await t.detachPuppeteer();this._attachedPages.clear(),this._currentTabId=null}async attachPage(e){return this._attachedPages.has(e.tabId)?(Sd.info("attachPage",e.tabId,"already attached"),!0):await e.attachPuppeteer()?(Sd.info("attachPage",e.tabId,"attached"),this._attachedPages.set(e.tabId,e),!0):!1}async detachPage(e){const t=this._attachedPages.get(e);t&&(await t.detachPuppeteer(),this._attachedPages.delete(e))}async getCurrentPage(){if(!this._currentTabId){let t;const[r]=await chrome.tabs.query({active:!0,currentWindow:!0});if(r!=null&&r.id)t=r;else{const i=await chrome.tabs.create({url:this._config.homePageUrl});if(!i.id)throw new Error("No tab ID available");t=i}Sd.info("active tab",t.id,t.url,t.title);const s=await this._getOrCreatePage(t);return await this.attachPage(s),this._currentTabId=t.id||null,s}const e=this._attachedPages.get(this._currentTabId);if(!e){const t=await chrome.tabs.get(this._currentTabId),r=await this._getOrCreatePage(t);return await this.attachPage(r),r}return e}async getAllTabIds(){const e=await chrome.tabs.query({currentWindow:!0});return new Set(e.map(t=>t.id).filter(t=>t!==void 0))}async waitForTabEvents(e,t={}){const{waitForUpdate:r=!0,waitForActivation:s=!0,timeoutMs:i=5e3}=t,a=[];if(r){const u=new Promise(l=>{let d=!1,h=!1,f=!1;const p=(m,g)=>{m===e&&(g.url&&(d=!0),g.title&&(h=!0),g.status==="complete"&&(f=!0),d&&h&&f&&(chrome.tabs.onUpdated.removeListener(p),l()))};chrome.tabs.onUpdated.addListener(p),chrome.tabs.get(e).then(m=>{m.url&&(d=!0),m.title&&(h=!0),m.status==="complete"&&(f=!0),d&&h&&f&&(chrome.tabs.onUpdated.removeListener(p),l())})});a.push(u)}if(s){const u=new Promise(l=>{const d=h=>{h.tabId===e&&(chrome.tabs.onActivated.removeListener(d),l())};chrome.tabs.onActivated.addListener(d),chrome.tabs.get(e).then(h=>{h.active&&(chrome.tabs.onActivated.removeListener(d),l())})});a.push(u)}const o=new Promise((u,l)=>setTimeout(()=>l(new Error(`Tab operation timed out after ${i} ms`)),i));await Promise.race([Promise.all(a),o])}async switchTab(e){Sd.info("switchTab",e),await chrome.tabs.update(e,{active:!0}),await this.waitForTabEvents(e,{waitForUpdate:!1});const t=await this._getOrCreatePage(await chrome.tabs.get(e));return await this.attachPage(t),this._currentTabId=e,t}async navigateTo(e){const t=await this.getCurrentPage();if(!t){await this.openTab(e);return}if(t.attached){await t.navigateTo(e);return}const r=t.tabId;await chrome.tabs.update(r,{url:e,active:!0}),await this.waitForTabEvents(r);const s=await this._getOrCreatePage(await chrome.tabs.get(r),!0);await this.attachPage(s),this._currentTabId=r}async openTab(e){const t=await chrome.tabs.create({url:e,active:!0});if(!t.id)throw new Error("No tab ID available");await this.waitForTabEvents(t.id);const r=await chrome.tabs.get(t.id),s=await this._getOrCreatePage(r);return await this.attachPage(s),this._currentTabId=t.id,s}async closeTab(e){await this.detachPage(e),await chrome.tabs.remove(e),this._currentTabId===e&&(this._currentTabId=null)}removeAttachedPage(e){this._attachedPages.delete(e),this._currentTabId===e&&(this._currentTabId=null)}async getTabInfos(){const e=await chrome.tabs.query({}),t=[];for(const r of e)r.id&&r.url&&r.title&&t.push({id:r.id,url:r.url,title:r.title});return t}async getState(){const e=await this.getCurrentPage(),t=e?await e.getState():Ab(),r=await this.getTabInfos();return{...t,tabs:r}}async removeHighlight(){const e=await this.getCurrentPage();e&&await e.removeHighlight()}}var lt;(function(n){n.assertEqual=s=>s;function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},n.getValidEnumValues=s=>{const i=n.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(const o of i)a[o]=s[o];return n.objectValues(a)},n.objectValues=s=>n.objectKeys(s).map(function(i){return s[i]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},n.find=(s,i)=>{for(const a of s)if(i(a))return a},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(lt||(lt={}));var $k;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})($k||($k={}));const ve=lt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ta=n=>{switch(typeof n){case"undefined":return ve.undefined;case"string":return ve.string;case"number":return isNaN(n)?ve.nan:ve.number;case"boolean":return ve.boolean;case"function":return ve.function;case"bigint":return ve.bigint;case"symbol":return ve.symbol;case"object":return Array.isArray(n)?ve.array:n===null?ve.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?ve.promise:typeof Map<"u"&&n instanceof Map?ve.map:typeof Set<"u"&&n instanceof Set?ve.set:typeof Date<"u"&&n instanceof Date?ve.date:ve.object;default:return ve.unknown}},ie=lt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),IG=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");let Qs=class YK extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)r._errors.push(t(a));else{let o=r,u=0;for(;u<a.path.length;){const l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return s(this),r}static assert(e){if(!(e instanceof YK))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,lt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}};Qs.create=n=>new Qs(n);const xd=(n,e)=>{let t;switch(n.code){case ie.invalid_type:n.received===ve.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case ie.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,lt.jsonStringifyReplacer)}`;break;case ie.unrecognized_keys:t=`Unrecognized key(s) in object: ${lt.joinValues(n.keys,", ")}`;break;case ie.invalid_union:t="Invalid input";break;case ie.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${lt.joinValues(n.options)}`;break;case ie.invalid_enum_value:t=`Invalid enum value. Expected ${lt.joinValues(n.options)}, received '${n.received}'`;break;case ie.invalid_arguments:t="Invalid function arguments";break;case ie.invalid_return_type:t="Invalid function return type";break;case ie.invalid_date:t="Invalid date";break;case ie.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:lt.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case ie.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case ie.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case ie.custom:t="Invalid input";break;case ie.invalid_intersection_types:t="Intersection results could not be merged";break;case ie.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case ie.not_finite:t="Number must be finite";break;default:t=e.defaultError,lt.assertNever(n)}return{message:t}};let rN=xd;function OG(n){rN=n}function Tb(){return rN}const Ib=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,i=[...t,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="";const u=r.filter(l=>!!l).slice().reverse();for(const l of u)o=l(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}},RG=[];function me(n,e){const t=Tb(),r=Ib({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===xd?void 0:xd].filter(s=>!!s)});n.common.issues.push(r)}let Ln=class QK{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return Ue;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t){const i=await s.key,a=await s.value;r.push({key:i,value:a})}return QK.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return Ue;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(r[i.value]=a.value)}return{status:e.value,value:r}}};const Ue=Object.freeze({status:"aborted"}),Ed=n=>({status:"dirty",value:n}),_n=n=>({status:"valid",value:n}),Nk=n=>n.status==="aborted",Fk=n=>n.status==="dirty",lu=n=>n.status==="valid",Xp=n=>typeof Promise<"u"&&n instanceof Promise;function Ob(n,e,t,r){if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function nN(n,e,t,r,s){if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}typeof SuppressedError=="function"&&SuppressedError;var Te;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(Te||(Te={}));var Yp,Qp;let Wi=class{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};const sN=(n,e)=>{if(lu(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Qs(n.common.issues);return this._error=t,this._error}}};function Ke(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{var u,l;const{message:d}=n;return a.code==="invalid_enum_value"?{message:d??o.defaultError}:typeof o.data>"u"?{message:(u=d??r)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=d??t)!==null&&l!==void 0?l:o.defaultError}},description:s}}let Ze=class{get description(){return this._def.description}_getType(e){return Ta(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ta(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ln,ctx:{common:e.parent.common,data:e.data,parsedType:Ta(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Xp(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ta(e)},i=this._parseSync({data:e,path:s.path,parent:s});return sN(s,i)}"~validate"(e){var t,r;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ta(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:s});return lu(i)?{value:i.value}:{issues:s.common.issues}}catch(i){!((r=(t=i==null?void 0:i.message)===null||t===void 0?void 0:t.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(i=>lu(i)?{value:i.value}:{issues:s.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ta(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(Xp(s)?s:Promise.resolve(s));return sN(r,i)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const a=e(s),o=()=>i.addIssue({code:ie.custom,...r(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new ei({schema:this,typeName:Q.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return ti.create(this,this._def)}nullable(){return Fo.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return hu.create(this)}promise(){return Ad.create(this,this._def)}or(e){return am.create([this,e],this._def)}and(e){return om.create(this,e,this._def)}transform(e){return new ei({...Ke(this._def),schema:this,typeName:Q.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new hm({...Ke(this._def),innerType:this,defaultValue:t,typeName:Q.ZodDefault})}brand(){return new Dk({typeName:Q.ZodBranded,type:this,...Ke(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new fm({...Ke(this._def),innerType:this,catchValue:t,typeName:Q.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Bk.create(this,e)}readonly(){return pm.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const MG=/^c[^\s-]{8,}$/i,$G=/^[0-9a-z]+$/,NG=/^[0-9A-HJKMNP-TV-Z]{26}$/i,FG=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,LG=/^[a-z0-9_-]{21}$/i,jG=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,DG=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,BG=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,UG="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Lk;const qG=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,HG=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,KG=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,WG=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,zG=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,VG=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,iN="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",GG=new RegExp(`^${iN}$`);function aN(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function ZG(n){return new RegExp(`^${aN(n)}$`)}function oN(n){let e=`${iN}T${aN(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function JG(n,e){return!!((e==="v4"||!e)&&qG.test(n)||(e==="v6"||!e)&&KG.test(n))}function XG(n,e){if(!jG.test(n))return!1;try{const[t]=n.split("."),r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function YG(n,e){return!!((e==="v4"||!e)&&HG.test(n)||(e==="v6"||!e)&&WG.test(n))}let kd=class O_ extends Ze{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ve.string){const i=this._getOrReturnCtx(e);return me(i,{code:ie.invalid_type,expected:ve.string,received:i.parsedType}),Ue}const r=new Ln;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),me(s,{code:ie.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),me(s,{code:ie.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?me(s,{code:ie.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&me(s,{code:ie.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")BG.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"email",code:ie.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")Lk||(Lk=new RegExp(UG,"u")),Lk.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"emoji",code:ie.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")FG.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"uuid",code:ie.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")LG.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"nanoid",code:ie.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")MG.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"cuid",code:ie.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")$G.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"cuid2",code:ie.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")NG.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"ulid",code:ie.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),me(s,{validation:"url",code:ie.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"regex",code:ie.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),me(s,{code:ie.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),me(s,{code:ie.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),me(s,{code:ie.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?oN(i).test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{code:ie.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?GG.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{code:ie.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?ZG(i).test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{code:ie.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?DG.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"duration",code:ie.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?JG(e.data,i.version)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"ip",code:ie.invalid_string,message:i.message}),r.dirty()):i.kind==="jwt"?XG(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"jwt",code:ie.invalid_string,message:i.message}),r.dirty()):i.kind==="cidr"?YG(e.data,i.version)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"cidr",code:ie.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?zG.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"base64",code:ie.invalid_string,message:i.message}),r.dirty()):i.kind==="base64url"?VG.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"base64url",code:ie.invalid_string,message:i.message}),r.dirty()):lt.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:ie.invalid_string,...Te.errToObj(r)})}_addCheck(e){return new O_({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Te.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Te.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Te.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Te.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Te.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Te.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Te.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Te.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Te.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Te.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Te.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Te.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Te.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...Te.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...Te.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Te.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Te.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...Te.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Te.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Te.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Te.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Te.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Te.errToObj(t)})}nonempty(e){return this.min(1,Te.errToObj(e))}trim(){return new O_({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new O_({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new O_({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};kd.create=n=>{var e;return new kd({checks:[],typeName:Q.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Ke(n)})};function QG(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,i=parseInt(n.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}let em=class rR extends Ze{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ve.number){const i=this._getOrReturnCtx(e);return me(i,{code:ie.invalid_type,expected:ve.number,received:i.parsedType}),Ue}let r;const s=new Ln;for(const i of this._def.checks)i.kind==="int"?lt.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),me(r,{code:ie.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),me(r,{code:ie.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),me(r,{code:ie.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?QG(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),me(r,{code:ie.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),me(r,{code:ie.not_finite,message:i.message}),s.dirty()):lt.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Te.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Te.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Te.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Te.toString(t))}setLimit(e,t,r,s){return new rR({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Te.toString(s)}]})}_addCheck(e){return new rR({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Te.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Te.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Te.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Te.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Te.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Te.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Te.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Te.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Te.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&lt.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}};em.create=n=>new em({checks:[],typeName:Q.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...Ke(n)});let tm=class nR extends Ze{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ve.bigint)return this._getInvalidInput(e);let r;const s=new Ln;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),me(r,{code:ie.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),me(r,{code:ie.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),me(r,{code:ie.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):lt.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return me(t,{code:ie.invalid_type,expected:ve.bigint,received:t.parsedType}),Ue}gte(e,t){return this.setLimit("min",e,!0,Te.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Te.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Te.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Te.toString(t))}setLimit(e,t,r,s){return new nR({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Te.toString(s)}]})}_addCheck(e){return new nR({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Te.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Te.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Te.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Te.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Te.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};tm.create=n=>{var e;return new tm({checks:[],typeName:Q.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Ke(n)})};let rm=class extends Ze{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ve.boolean){const r=this._getOrReturnCtx(e);return me(r,{code:ie.invalid_type,expected:ve.boolean,received:r.parsedType}),Ue}return _n(e.data)}};rm.create=n=>new rm({typeName:Q.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...Ke(n)});let nm=class e6 extends Ze{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ve.date){const i=this._getOrReturnCtx(e);return me(i,{code:ie.invalid_type,expected:ve.date,received:i.parsedType}),Ue}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return me(i,{code:ie.invalid_date}),Ue}const r=new Ln;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),me(s,{code:ie.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),me(s,{code:ie.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):lt.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new e6({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Te.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Te.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};nm.create=n=>new nm({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:Q.ZodDate,...Ke(n)});let Rb=class extends Ze{_parse(e){if(this._getType(e)!==ve.symbol){const r=this._getOrReturnCtx(e);return me(r,{code:ie.invalid_type,expected:ve.symbol,received:r.parsedType}),Ue}return _n(e.data)}};Rb.create=n=>new Rb({typeName:Q.ZodSymbol,...Ke(n)});let sm=class extends Ze{_parse(e){if(this._getType(e)!==ve.undefined){const r=this._getOrReturnCtx(e);return me(r,{code:ie.invalid_type,expected:ve.undefined,received:r.parsedType}),Ue}return _n(e.data)}};sm.create=n=>new sm({typeName:Q.ZodUndefined,...Ke(n)});let im=class extends Ze{_parse(e){if(this._getType(e)!==ve.null){const r=this._getOrReturnCtx(e);return me(r,{code:ie.invalid_type,expected:ve.null,received:r.parsedType}),Ue}return _n(e.data)}};im.create=n=>new im({typeName:Q.ZodNull,...Ke(n)});let Cd=class extends Ze{constructor(){super(...arguments),this._any=!0}_parse(e){return _n(e.data)}};Cd.create=n=>new Cd({typeName:Q.ZodAny,...Ke(n)});let du=class extends Ze{constructor(){super(...arguments),this._unknown=!0}_parse(e){return _n(e.data)}};du.create=n=>new du({typeName:Q.ZodUnknown,...Ke(n)});let Ia=class extends Ze{_parse(e){const t=this._getOrReturnCtx(e);return me(t,{code:ie.invalid_type,expected:ve.never,received:t.parsedType}),Ue}};Ia.create=n=>new Ia({typeName:Q.ZodNever,...Ke(n)});let Mb=class extends Ze{_parse(e){if(this._getType(e)!==ve.undefined){const r=this._getOrReturnCtx(e);return me(r,{code:ie.invalid_type,expected:ve.void,received:r.parsedType}),Ue}return _n(e.data)}};Mb.create=n=>new Mb({typeName:Q.ZodVoid,...Ke(n)});let hu=class pE extends Ze{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==ve.array)return me(t,{code:ie.invalid_type,expected:ve.array,received:t.parsedType}),Ue;if(s.exactLength!==null){const a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(me(t,{code:a?ie.too_big:ie.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(me(t,{code:ie.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(me(t,{code:ie.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new Wi(t,a,t.path,o)))).then(a=>Ln.mergeArray(r,a));const i=[...t.data].map((a,o)=>s.type._parseSync(new Wi(t,a,t.path,o)));return Ln.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new pE({...this._def,minLength:{value:e,message:Te.toString(t)}})}max(e,t){return new pE({...this._def,maxLength:{value:e,message:Te.toString(t)}})}length(e,t){return new pE({...this._def,exactLength:{value:e,message:Te.toString(t)}})}nonempty(e){return this.min(1,e)}};hu.create=(n,e)=>new hu({type:n,minLength:null,maxLength:null,exactLength:null,typeName:Q.ZodArray,...Ke(e)});function Pd(n){if(n instanceof Os){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=ti.create(Pd(r))}return new Os({...n._def,shape:()=>e})}else return n instanceof hu?new hu({...n._def,type:Pd(n.element)}):n instanceof ti?ti.create(Pd(n.unwrap())):n instanceof Fo?Fo.create(Pd(n.unwrap())):n instanceof No?No.create(n.items.map(e=>Pd(e))):n}let Os=class $i extends Ze{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=lt.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==ve.object){const l=this._getOrReturnCtx(e);return me(l,{code:ie.invalid_type,expected:ve.object,received:l.parsedType}),Ue}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ia&&this._def.unknownKeys==="strip"))for(const l in s.data)a.includes(l)||o.push(l);const u=[];for(const l of a){const d=i[l],h=s.data[l];u.push({key:{status:"valid",value:l},value:d._parse(new Wi(s,h,s.path,l)),alwaysSet:l in s.data})}if(this._def.catchall instanceof Ia){const l=this._def.unknownKeys;if(l==="passthrough")for(const d of o)u.push({key:{status:"valid",value:d},value:{status:"valid",value:s.data[d]}});else if(l==="strict")o.length>0&&(me(s,{code:ie.unrecognized_keys,keys:o}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const d of o){const h=s.data[d];u.push({key:{status:"valid",value:d},value:l._parse(new Wi(s,h,s.path,d)),alwaysSet:d in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const l=[];for(const d of u){const h=await d.key,f=await d.value;l.push({key:h,value:f,alwaysSet:d.alwaysSet})}return l}).then(l=>Ln.mergeObjectSync(r,l)):Ln.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return Te.errToObj,new $i({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var s,i,a,o;const u=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,r).message)!==null&&a!==void 0?a:r.defaultError;return t.code==="unrecognized_keys"?{message:(o=Te.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new $i({...this._def,unknownKeys:"strip"})}passthrough(){return new $i({...this._def,unknownKeys:"passthrough"})}extend(e){return new $i({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new $i({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Q.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new $i({...this._def,catchall:e})}pick(e){const t={};return lt.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new $i({...this._def,shape:()=>t})}omit(e){const t={};return lt.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new $i({...this._def,shape:()=>t})}deepPartial(){return Pd(this)}partial(e){const t={};return lt.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}),new $i({...this._def,shape:()=>t})}required(e){const t={};return lt.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof ti;)i=i._def.innerType;t[r]=i}}),new $i({...this._def,shape:()=>t})}keyof(){return dN(lt.objectKeys(this.shape))}};Os.create=(n,e)=>new Os({shape:()=>n,unknownKeys:"strip",catchall:Ia.create(),typeName:Q.ZodObject,...Ke(e)}),Os.strictCreate=(n,e)=>new Os({shape:()=>n,unknownKeys:"strict",catchall:Ia.create(),typeName:Q.ZodObject,...Ke(e)}),Os.lazycreate=(n,e)=>new Os({shape:n,unknownKeys:"strip",catchall:Ia.create(),typeName:Q.ZodObject,...Ke(e)});let am=class extends Ze{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new Qs(o.ctx.common.issues));return me(t,{code:ie.invalid_union,unionErrors:a}),Ue}if(t.common.async)return Promise.all(r.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const u of r){const l={...t,common:{...t.common,issues:[]},parent:null},d=u._parseSync({data:t.data,path:t.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!i&&(i={result:d,ctx:l}),l.common.issues.length&&a.push(l.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(u=>new Qs(u));return me(t,{code:ie.invalid_union,unionErrors:o}),Ue}}get options(){return this._def.options}};am.create=(n,e)=>new am({options:n,typeName:Q.ZodUnion,...Ke(e)});const Oa=n=>n instanceof cm?Oa(n.schema):n instanceof ei?Oa(n.innerType()):n instanceof um?[n.value]:n instanceof lm?n.options:n instanceof dm?lt.objectValues(n.enum):n instanceof hm?Oa(n._def.innerType):n instanceof sm?[void 0]:n instanceof im?[null]:n instanceof ti?[void 0,...Oa(n.unwrap())]:n instanceof Fo?[null,...Oa(n.unwrap())]:n instanceof Dk||n instanceof pm?Oa(n.unwrap()):n instanceof fm?Oa(n._def.innerType):[];let cN=class t6 extends Ze{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ve.object)return me(t,{code:ie.invalid_type,expected:ve.object,received:t.parsedType}),Ue;const r=this.discriminator,s=t.data[r],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(me(t,{code:ie.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),Ue)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const s=new Map;for(const i of t){const a=Oa(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new t6({typeName:Q.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...Ke(r)})}};function jk(n,e){const t=Ta(n),r=Ta(e);if(n===e)return{valid:!0,data:n};if(t===ve.object&&r===ve.object){const s=lt.objectKeys(e),i=lt.objectKeys(n).filter(o=>s.indexOf(o)!==-1),a={...n,...e};for(const o of i){const u=jk(n[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===ve.array&&r===ve.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<n.length;i++){const a=n[i],o=e[i],u=jk(a,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===ve.date&&r===ve.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}let om=class extends Ze{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(i,a)=>{if(Nk(i)||Nk(a))return Ue;const o=jk(i.value,a.value);return o.valid?((Fk(i)||Fk(a))&&t.dirty(),{status:t.value,value:o.data}):(me(r,{code:ie.invalid_intersection_types}),Ue)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};om.create=(n,e,t)=>new om({left:n,right:e,typeName:Q.ZodIntersection,...Ke(t)});let No=class r6 extends Ze{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ve.array)return me(r,{code:ie.invalid_type,expected:ve.array,received:r.parsedType}),Ue;if(r.data.length<this._def.items.length)return me(r,{code:ie.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ue;!this._def.rest&&r.data.length>this._def.items.length&&(me(r,{code:ie.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((a,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new Wi(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(i).then(a=>Ln.mergeArray(t,a)):Ln.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new r6({...this._def,rest:e})}};No.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new No({items:n,typeName:Q.ZodTuple,rest:null,...Ke(e)})};let uN=class sR extends Ze{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ve.object)return me(r,{code:ie.invalid_type,expected:ve.object,received:r.parsedType}),Ue;const s=[],i=this._def.keyType,a=this._def.valueType;for(const o in r.data)s.push({key:i._parse(new Wi(r,o,r.path,o)),value:a._parse(new Wi(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Ln.mergeObjectAsync(t,s):Ln.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof Ze?new sR({keyType:e,valueType:t,typeName:Q.ZodRecord,...Ke(r)}):new sR({keyType:kd.create(),valueType:e,typeName:Q.ZodRecord,...Ke(t)})}},$b=class extends Ze{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ve.map)return me(r,{code:ie.invalid_type,expected:ve.map,received:r.parsedType}),Ue;const s=this._def.keyType,i=this._def.valueType,a=[...r.data.entries()].map(([o,u],l)=>({key:s._parse(new Wi(r,o,r.path,[l,"key"])),value:i._parse(new Wi(r,u,r.path,[l,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of a){const l=await u.key,d=await u.value;if(l.status==="aborted"||d.status==="aborted")return Ue;(l.status==="dirty"||d.status==="dirty")&&t.dirty(),o.set(l.value,d.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const u of a){const l=u.key,d=u.value;if(l.status==="aborted"||d.status==="aborted")return Ue;(l.status==="dirty"||d.status==="dirty")&&t.dirty(),o.set(l.value,d.value)}return{status:t.value,value:o}}}};$b.create=(n,e,t)=>new $b({valueType:e,keyType:n,typeName:Q.ZodMap,...Ke(t)});let Nb=class iR extends Ze{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ve.set)return me(r,{code:ie.invalid_type,expected:ve.set,received:r.parsedType}),Ue;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(me(r,{code:ie.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(me(r,{code:ie.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function a(u){const l=new Set;for(const d of u){if(d.status==="aborted")return Ue;d.status==="dirty"&&t.dirty(),l.add(d.value)}return{status:t.value,value:l}}const o=[...r.data.values()].map((u,l)=>i._parse(new Wi(r,u,r.path,l)));return r.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new iR({...this._def,minSize:{value:e,message:Te.toString(t)}})}max(e,t){return new iR({...this._def,maxSize:{value:e,message:Te.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Nb.create=(n,e)=>new Nb({valueType:n,minSize:null,maxSize:null,typeName:Q.ZodSet,...Ke(e)});let lN=class mE extends Ze{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ve.function)return me(t,{code:ie.invalid_type,expected:ve.function,received:t.parsedType}),Ue;function r(o,u){return Ib({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Tb(),xd].filter(l=>!!l),issueData:{code:ie.invalid_arguments,argumentsError:u}})}function s(o,u){return Ib({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Tb(),xd].filter(l=>!!l),issueData:{code:ie.invalid_return_type,returnTypeError:u}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Ad){const o=this;return _n(async function(...u){const l=new Qs([]),d=await o._def.args.parseAsync(u,i).catch(p=>{throw l.addIssue(r(u,p)),l}),h=await Reflect.apply(a,this,d);return await o._def.returns._def.type.parseAsync(h,i).catch(p=>{throw l.addIssue(s(h,p)),l})})}else{const o=this;return _n(function(...u){const l=o._def.args.safeParse(u,i);if(!l.success)throw new Qs([r(u,l.error)]);const d=Reflect.apply(a,this,l.data),h=o._def.returns.safeParse(d,i);if(!h.success)throw new Qs([s(d,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new mE({...this._def,args:No.create(e).rest(du.create())})}returns(e){return new mE({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new mE({args:e||No.create([]).rest(du.create()),returns:t||du.create(),typeName:Q.ZodFunction,...Ke(r)})}},cm=class extends Ze{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};cm.create=(n,e)=>new cm({getter:n,typeName:Q.ZodLazy,...Ke(e)});let um=class extends Ze{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return me(t,{received:t.data,code:ie.invalid_literal,expected:this._def.value}),Ue}return{status:"valid",value:e.data}}get value(){return this._def.value}};um.create=(n,e)=>new um({value:n,typeName:Q.ZodLiteral,...Ke(e)});function dN(n,e){return new lm({values:n,typeName:Q.ZodEnum,...Ke(e)})}let lm=class aR extends Ze{constructor(){super(...arguments),Yp.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return me(t,{expected:lt.joinValues(r),received:t.parsedType,code:ie.invalid_type}),Ue}if(Ob(this,Yp)||nN(this,Yp,new Set(this._def.values)),!Ob(this,Yp).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return me(t,{received:t.data,code:ie.invalid_enum_value,options:r}),Ue}return _n(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return aR.create(e,{...this._def,...t})}exclude(e,t=this._def){return aR.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}};Yp=new WeakMap,lm.create=dN;let dm=class extends Ze{constructor(){super(...arguments),Qp.set(this,void 0)}_parse(e){const t=lt.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==ve.string&&r.parsedType!==ve.number){const s=lt.objectValues(t);return me(r,{expected:lt.joinValues(s),received:r.parsedType,code:ie.invalid_type}),Ue}if(Ob(this,Qp)||nN(this,Qp,new Set(lt.getValidEnumValues(this._def.values))),!Ob(this,Qp).has(e.data)){const s=lt.objectValues(t);return me(r,{received:r.data,code:ie.invalid_enum_value,options:s}),Ue}return _n(e.data)}get enum(){return this._def.values}};Qp=new WeakMap,dm.create=(n,e)=>new dm({values:n,typeName:Q.ZodNativeEnum,...Ke(e)});let Ad=class extends Ze{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ve.promise&&t.common.async===!1)return me(t,{code:ie.invalid_type,expected:ve.promise,received:t.parsedType}),Ue;const r=t.parsedType===ve.promise?t.data:Promise.resolve(t.data);return _n(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};Ad.create=(n,e)=>new Ad({type:n,typeName:Q.ZodPromise,...Ke(e)});let ei=class extends Ze{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Q.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{me(r,a),a.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const a=s.transform(r.data,i);if(r.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return Ue;const u=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return u.status==="aborted"?Ue:u.status==="dirty"||t.value==="dirty"?Ed(u.value):u});{if(t.value==="aborted")return Ue;const o=this._def.schema._parseSync({data:a,path:r.path,parent:r});return o.status==="aborted"?Ue:o.status==="dirty"||t.value==="dirty"?Ed(o.value):o}}if(s.type==="refinement"){const a=o=>{const u=s.refinement(o,i);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?Ue:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?Ue:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!lu(a))return a;const o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>lu(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);lt.assertNever(s)}};ei.create=(n,e,t)=>new ei({schema:n,typeName:Q.ZodEffects,effect:e,...Ke(t)}),ei.createWithPreprocess=(n,e,t)=>new ei({schema:e,effect:{type:"preprocess",transform:n},typeName:Q.ZodEffects,...Ke(t)});let ti=class extends Ze{_parse(e){return this._getType(e)===ve.undefined?_n(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ti.create=(n,e)=>new ti({innerType:n,typeName:Q.ZodOptional,...Ke(e)});let Fo=class extends Ze{_parse(e){return this._getType(e)===ve.null?_n(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Fo.create=(n,e)=>new Fo({innerType:n,typeName:Q.ZodNullable,...Ke(e)});let hm=class extends Ze{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===ve.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};hm.create=(n,e)=>new hm({innerType:n,typeName:Q.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Ke(e)});let fm=class extends Ze{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Xp(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Qs(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Qs(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};fm.create=(n,e)=>new fm({innerType:n,typeName:Q.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Ke(e)});let Fb=class extends Ze{_parse(e){if(this._getType(e)!==ve.nan){const r=this._getOrReturnCtx(e);return me(r,{code:ie.invalid_type,expected:ve.nan,received:r.parsedType}),Ue}return{status:"valid",value:e.data}}};Fb.create=n=>new Fb({typeName:Q.ZodNaN,...Ke(n)});const e8=Symbol("zod_brand");let Dk=class extends Ze{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}},Bk=class n6 extends Ze{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?Ue:i.status==="dirty"?(t.dirty(),Ed(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?Ue:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new n6({in:e,out:t,typeName:Q.ZodPipeline})}},pm=class extends Ze{_parse(e){const t=this._def.innerType._parse(e),r=s=>(lu(s)&&(s.value=Object.freeze(s.value)),s);return Xp(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}};pm.create=(n,e)=>new pm({innerType:n,typeName:Q.ZodReadonly,...Ke(e)});function hN(n,e={},t){return n?Cd.create().superRefine((r,s)=>{var i,a;if(!n(r)){const o=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,u=(a=(i=o.fatal)!==null&&i!==void 0?i:t)!==null&&a!==void 0?a:!0,l=typeof o=="string"?{message:o}:o;s.addIssue({code:"custom",...l,fatal:u})}}):Cd.create()}const t8={object:Os.lazycreate};var Q;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(Q||(Q={}));const r8=(n,e={message:`Input not instance of ${n.name}`})=>hN(t=>t instanceof n,e),fN=kd.create,pN=em.create,n8=Fb.create,s8=tm.create,mN=rm.create,i8=nm.create,a8=Rb.create,o8=sm.create,c8=im.create,u8=Cd.create,l8=du.create,d8=Ia.create,h8=Mb.create,f8=hu.create,p8=Os.create,m8=Os.strictCreate,g8=am.create,y8=cN.create,w8=om.create,v8=No.create,_8=uN.create,b8=$b.create,S8=Nb.create,x8=lN.create,E8=cm.create,k8=um.create,C8=lm.create,P8=dm.create,A8=Ad.create,gN=ei.create,T8=ti.create,I8=Fo.create,O8=ei.createWithPreprocess,R8=Bk.create;var ge=Object.freeze({__proto__:null,defaultErrorMap:xd,setErrorMap:OG,getErrorMap:Tb,makeIssue:Ib,EMPTY_PATH:RG,addIssueToContext:me,ParseStatus:Ln,INVALID:Ue,DIRTY:Ed,OK:_n,isAborted:Nk,isDirty:Fk,isValid:lu,isAsync:Xp,get util(){return lt},get objectUtil(){return $k},ZodParsedType:ve,getParsedType:Ta,ZodType:Ze,datetimeRegex:oN,ZodString:kd,ZodNumber:em,ZodBigInt:tm,ZodBoolean:rm,ZodDate:nm,ZodSymbol:Rb,ZodUndefined:sm,ZodNull:im,ZodAny:Cd,ZodUnknown:du,ZodNever:Ia,ZodVoid:Mb,ZodArray:hu,ZodObject:Os,ZodUnion:am,ZodDiscriminatedUnion:cN,ZodIntersection:om,ZodTuple:No,ZodRecord:uN,ZodMap:$b,ZodSet:Nb,ZodFunction:lN,ZodLazy:cm,ZodLiteral:um,ZodEnum:lm,ZodNativeEnum:dm,ZodPromise:Ad,ZodEffects:ei,ZodTransformer:ei,ZodOptional:ti,ZodNullable:Fo,ZodDefault:hm,ZodCatch:fm,ZodNaN:Fb,BRAND:e8,ZodBranded:Dk,ZodPipeline:Bk,ZodReadonly:pm,custom:hN,Schema:Ze,ZodSchema:Ze,late:t8,get ZodFirstPartyTypeKind(){return Q},coerce:{string:n=>kd.create({...n,coerce:!0}),number:n=>em.create({...n,coerce:!0}),boolean:n=>rm.create({...n,coerce:!0}),bigint:n=>tm.create({...n,coerce:!0}),date:n=>nm.create({...n,coerce:!0})},any:u8,array:f8,bigint:s8,boolean:mN,date:i8,discriminatedUnion:y8,effect:gN,enum:C8,function:x8,instanceof:r8,intersection:w8,lazy:E8,literal:k8,map:b8,nan:n8,nativeEnum:P8,never:d8,null:c8,nullable:I8,number:pN,object:p8,oboolean:()=>mN().optional(),onumber:()=>pN().optional(),optional:T8,ostring:()=>fN().optional(),pipeline:R8,preprocess:O8,promise:A8,record:_8,set:S8,strictObject:m8,string:fN,symbol:a8,transformer:gN,tuple:v8,undefined:o8,union:g8,unknown:l8,void:h8,NEVER:Ue,ZodIssueCode:ie,quotelessJson:IG,ZodError:Qs}),Me=(n=>(n.SYSTEM="system",n.USER="user",n.PLANNER="planner",n.NAVIGATOR="navigator",n.VALIDATOR="validator",n))(Me||{}),Uk=(n=>(n.EXECUTION="execution",n))(Uk||{}),Ie=(n=>(n.TASK_START="task.start",n.TASK_OK="task.ok",n.TASK_FAIL="task.fail",n.TASK_PAUSE="task.pause",n.TASK_RESUME="task.resume",n.TASK_CANCEL="task.cancel",n.STEP_START="step.start",n.STEP_OK="step.ok",n.STEP_FAIL="step.fail",n.STEP_CANCEL="step.cancel",n.ACT_START="act.start",n.ACT_OK="act.ok",n.ACT_FAIL="act.fail",n))(Ie||{});class M8{constructor(e,t,r,s=Date.now(),i="execution"){this.actor=e,this.state=t,this.data=r,this.timestamp=s,this.type=i}}const $8={maxSteps:100,maxActionsPerStep:10,maxFailures:3,maxValidatorFailures:3,retryDelay:10,maxInputTokens:128e3,maxErrorLength:400,useVision:!1,useVisionForPlanner:!1,validateOutput:!0,includeAttributes:["title","type","name","role","tabindex","aria-label","placeholder","value","alt","aria-expanded"],planningInterval:3};class N8{constructor(e,t,r,s,i){this.taskId=e,this.browserContext=t,this.messageManager=r,this.eventManager=s,this.options={...$8,...i},this.paused=!1,this.stopped=!1,this.nSteps=0,this.consecutiveFailures=0,this.consecutiveValidatorFailures=0,this.stepInfo=null,this.actionResults=[],this.stateMessageAdded=!1}async emitEvent(e,t,r){const s=new M8(e,t,{taskId:this.taskId,step:this.nSteps,maxSteps:this.options.maxSteps,details:r});await this.eventManager.emit(s)}async pause(){this.paused=!0}async resume(){this.paused=!1}async stop(){this.stopped=!0}}class Ct{constructor(e={}){this.isDone=e.isDone??!1,this.extractedContent=e.extractedContent??null,this.error=e.error??null,this.includeInMemory=e.includeInMemory??!1}}const F8=ge.object({page_summary:ge.string(),evaluation_previous_goal:ge.string(),memory:ge.string(),next_goal:ge.string()});function yN(n,e=qk){n=n.trim();const t=/```(json)?(.*)```/s.exec(n);return e(t?t[2]:n)}function qk(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="";const t=[];let r=!1,s=!1;for(let i of n){if(r)i==='"'&&!s?r=!1:i===`
`&&!s?i="\\n":i==="\\"?s=!s:s=!1;else if(i==='"')r=!0,s=!1;else if(i==="{")t.push("}");else if(i==="[")t.push("]");else if(i==="}"||i==="]")if(t&&t[t.length-1]===i)t.pop();else return null;e+=i}r&&(e+='"');for(let i=t.length-1;i>=0;i-=1)e+=t[i];try{return JSON.parse(e)}catch{return null}}var Hk,wN;function L8(){return wN||(wN=1,Hk=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),Hk}var j8=L8();const D8=Qe(j8);var Lb={exports:{}},vN;function B8(){if(vN)return Lb.exports;vN=1;const n=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,r=/([\p{Alpha}\p{N}_]|$)/u,s=/[_.\- ]+/,i=new RegExp("^"+s.source),a=new RegExp(s.source+r.source,"gu"),o=new RegExp("\\d+"+r.source,"gu"),u=(f,p,m)=>{let g=!1,y=!1,w=!1;for(let v=0;v<f.length;v++){const b=f[v];g&&n.test(b)?(f=f.slice(0,v)+"-"+f.slice(v),g=!1,w=y,y=!0,v++):y&&w&&e.test(b)?(f=f.slice(0,v-1)+"-"+f.slice(v-1),w=y,y=!1,g=!0):(g=p(b)===b&&m(b)!==b,w=y,y=m(b)===b&&p(b)!==b)}return f},l=(f,p)=>(t.lastIndex=0,f.replace(t,m=>p(m))),d=(f,p)=>(a.lastIndex=0,o.lastIndex=0,f.replace(a,(m,g)=>p(g)).replace(o,m=>p(m))),h=(f,p)=>{if(!(typeof f=="string"||Array.isArray(f)))throw new TypeError("Expected the input to be `string | string[]`");if(p={pascalCase:!1,preserveConsecutiveUppercase:!1,...p},Array.isArray(f)?f=f.map(w=>w.trim()).filter(w=>w.length).join("-"):f=f.trim(),f.length===0)return"";const m=p.locale===!1?w=>w.toLowerCase():w=>w.toLocaleLowerCase(p.locale),g=p.locale===!1?w=>w.toUpperCase():w=>w.toLocaleUpperCase(p.locale);return f.length===1?p.pascalCase?g(f):m(f):(f!==m(f)&&(f=u(f,m,g)),f=f.replace(i,""),p.preserveConsecutiveUppercase?f=l(f,m):f=m(f),p.pascalCase&&(f=g(f.charAt(0))+f.slice(1)),d(f,g))};return Lb.exports=h,Lb.exports.default=h,Lb.exports}B8();function U8(n,e){return(e==null?void 0:e[n])||D8(n)}function q8(n,e,t){const r={};for(const s in n)Object.hasOwn(n,s)&&(r[e(s,t)]=n[s]);return r}function _N(n){return Array.isArray(n)?[...n]:{...n}}function H8(n,e){const t=_N(n);for(const[r,s]of Object.entries(e)){const[i,...a]=r.split(".").reverse();let o=t;for(const u of a.reverse()){if(o[u]===void 0)break;o[u]=_N(o[u]),o=o[u]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return t}function bN(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}class fu{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,bN(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof fu||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let i=this,a=r;const[o,...u]=s.split(".").reverse();for(const l of u.reverse()){if(!(l in i)||i[l]===void 0)return;(!(l in a)||a[l]===void 0)&&(typeof i[l]=="object"&&i[l]!=null?a[l]={}:Array.isArray(i[l])&&(a[l]=[])),i=i[l],a=a[l]}o in i&&i[o]!==void 0&&(a[o]=a[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:q8(Object.keys(t).length?H8(r,t):r,U8,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function Td(n,e){return typeof n=="string"?typeof e=="string"?n+e:[{type:"text",text:n},...e]:Array.isArray(e)?jb(n,e)??[...n,...e]:[...n,{type:"text",text:e}]}function K8(n,e){return n==="error"||e==="error"?"error":"success"}function W8(n,e){function t(r,s){if(typeof r!="object"||r===null||r===void 0)return r;if(s>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(a=>t(a,s+1));const i={};for(const a of Object.keys(r))i[a]=t(r[a],s+1);return i}return JSON.stringify(t(n,0),null,2)}class Id extends fu{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=W8(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function bn(n,e){const t={...n};for(const[r,s]of Object.entries(e))if(t[r]==null)t[r]=s;else{if(s==null)continue;if(typeof t[r]!=typeof s||Array.isArray(t[r])!==Array.isArray(s))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;t[r]+=s}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=bn(t[r],s);else if(Array.isArray(t[r]))t[r]=jb(t[r],s);else{if(t[r]===s)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function jb(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{const t=[...n];for(const r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){const s=t.findIndex(i=>i.index===r.index);s!==-1?t[s]=bn(t[s],r):t.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}function z8(n,e){if(!n&&!e)throw new Error("Cannot merge two undefined objects.");if(!n||!e)return n||e;if(typeof n!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof n}
Right ${typeof e}`);if(typeof n=="string"&&typeof e=="string")return n+e;if(Array.isArray(n)&&Array.isArray(e))return jb(n,e);if(typeof n=="object"&&typeof e=="object")return bn(n,e);if(n===e)return n;throw new Error(`Can not merge objects of different types.
Left ${n}
Right ${e}`)}class Od extends Id{}function V8(n){return typeof n.role=="string"}function mm(n){return typeof(n==null?void 0:n._getType)=="function"}function G8(n){return mm(n)&&typeof n.concat=="function"}class Db extends Id{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class Bb extends Od{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new Bb({content:Td(this.content,e.content),additional_kwargs:bn(this.additional_kwargs,e.additional_kwargs),response_metadata:bn(this.response_metadata,e.response_metadata),artifact:z8(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:K8(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function Z8(n){const e=[],t=[];for(const r of n)if(r.function){const s=r.function.name;try{const i=JSON.parse(r.function.arguments),a={name:s||"",args:i||{},id:r.id};e.push(a)}catch{t.push({name:s,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,t]}class nn extends Id{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var s;let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;const i=(s=r.additional_kwargs)==null?void 0:s.tool_calls,a=r.tool_calls;i!=null&&i.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(i!=null&&a===void 0){const[o,u]=Z8(i);r.tool_calls=o??[],r.invalid_tool_calls=u??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function pu(n){return n._getType()==="ai"}function SN(n){return n._getType()==="ai"}class wr extends Od{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const r=[],s=[];for(const i of e.tool_call_chunks){let a={};try{if(a=qk(i.args||"{}"),a===null||typeof a!="object"||Array.isArray(a))throw new Error("Malformed tool call chunk args.");r.push({name:i.name??"",args:a,id:i.id,type:"tool_call"})}catch{s.push({name:i.name,args:i.args,id:i.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:s,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var r,s,i,a,o,u,l,d,h,f,p,m,g,y,w,v,b,S,P,k,C,E,M,I,N,O,T,L,U,Z,j,F,B,D,W,G,te,K,q,se;const t={content:Td(this.content,e.content),additional_kwargs:bn(this.additional_kwargs,e.additional_kwargs),response_metadata:bn(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const ke=jb(this.tool_call_chunks,e.tool_call_chunks);ke!==void 0&&ke.length>0&&(t.tool_call_chunks=ke)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const ke={...(((s=(r=this.usage_metadata)==null?void 0:r.input_token_details)==null?void 0:s.audio)!==void 0||((a=(i=e.usage_metadata)==null?void 0:i.input_token_details)==null?void 0:a.audio)!==void 0)&&{audio:(((u=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:u.audio)??0)+(((d=(l=e.usage_metadata)==null?void 0:l.input_token_details)==null?void 0:d.audio)??0)},...(((f=(h=this.usage_metadata)==null?void 0:h.input_token_details)==null?void 0:f.cache_read)!==void 0||((m=(p=e.usage_metadata)==null?void 0:p.input_token_details)==null?void 0:m.cache_read)!==void 0)&&{cache_read:(((y=(g=this.usage_metadata)==null?void 0:g.input_token_details)==null?void 0:y.cache_read)??0)+(((v=(w=e.usage_metadata)==null?void 0:w.input_token_details)==null?void 0:v.cache_read)??0)},...(((S=(b=this.usage_metadata)==null?void 0:b.input_token_details)==null?void 0:S.cache_creation)!==void 0||((k=(P=e.usage_metadata)==null?void 0:P.input_token_details)==null?void 0:k.cache_creation)!==void 0)&&{cache_creation:(((E=(C=this.usage_metadata)==null?void 0:C.input_token_details)==null?void 0:E.cache_creation)??0)+(((I=(M=e.usage_metadata)==null?void 0:M.input_token_details)==null?void 0:I.cache_creation)??0)}},he={...(((O=(N=this.usage_metadata)==null?void 0:N.output_token_details)==null?void 0:O.audio)!==void 0||((L=(T=e.usage_metadata)==null?void 0:T.output_token_details)==null?void 0:L.audio)!==void 0)&&{audio:(((Z=(U=this.usage_metadata)==null?void 0:U.output_token_details)==null?void 0:Z.audio)??0)+(((F=(j=e.usage_metadata)==null?void 0:j.output_token_details)==null?void 0:F.audio)??0)},...(((D=(B=this.usage_metadata)==null?void 0:B.output_token_details)==null?void 0:D.reasoning)!==void 0||((G=(W=e.usage_metadata)==null?void 0:W.output_token_details)==null?void 0:G.reasoning)!==void 0)&&{reasoning:(((K=(te=this.usage_metadata)==null?void 0:te.output_token_details)==null?void 0:K.reasoning)??0)+(((se=(q=e.usage_metadata)==null?void 0:q.output_token_details)==null?void 0:se.reasoning)??0)}},et=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},fe=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},R={input_tokens:et.input_tokens+fe.input_tokens,output_tokens:et.output_tokens+fe.output_tokens,total_tokens:et.total_tokens+fe.total_tokens,...Object.keys(ke).length>0&&{input_token_details:ke},...Object.keys(he).length>0&&{output_token_details:he}};t.usage_metadata=R}return new wr(t)}}class Lo extends Id{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Lo}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class gm extends Od{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new gm({content:Td(this.content,e.content),additional_kwargs:bn(this.additional_kwargs,e.additional_kwargs),response_metadata:bn(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class ym extends Od{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new ym({content:Td(this.content,e.content),additional_kwargs:bn(this.additional_kwargs,e.additional_kwargs),response_metadata:bn(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class Jt extends Id{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class wm extends Od{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new wm({content:Td(this.content,e.content),additional_kwargs:bn(this.additional_kwargs,e.additional_kwargs),response_metadata:bn(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class Rd extends Id{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class mu extends Od{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new mu({content:Td(this.content,e.content),additional_kwargs:bn(this.additional_kwargs,e.additional_kwargs),response_metadata:bn(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function Kk(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function xN(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}class J8 extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function X8(n){return xN(n)?n:typeof n.id=="string"&&n.type==="function"&&typeof n.function=="object"&&n.function!==null&&"arguments"in n.function&&typeof n.function.arguments=="string"&&"name"in n.function&&typeof n.function.name=="string"?{id:n.id,args:JSON.parse(n.function.arguments),name:n.function.name,type:"tool_call"}:n}function Y8(n){return typeof n=="object"&&n!=null&&n.lc===1&&Array.isArray(n.id)&&n.kwargs!=null&&typeof n.kwargs=="object"}function Wk(n){let e,t;if(Y8(n)){const r=n.id.at(-1);r==="HumanMessage"||r==="HumanMessageChunk"?e="user":r==="AIMessage"||r==="AIMessageChunk"?e="assistant":r==="SystemMessage"||r==="SystemMessageChunk"?e="system":e="unknown",t=n.kwargs}else{const{type:r,...s}=n;e=r,t=s}if(e==="human"||e==="user")return new Jt(t);if(e==="ai"||e==="assistant"){const{tool_calls:r,...s}=t;if(!Array.isArray(r))return new nn(t);const i=r.map(X8);return new nn({...s,tool_calls:i})}else{if(e==="system")return new Rd(t);if(e==="developer")return new Rd({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new Db({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw Kk(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(n,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function vm(n){if(typeof n=="string")return new Jt(n);if(mm(n))return n;if(Array.isArray(n)){const[e,t]=n;return Wk({type:e,content:t})}else if(V8(n)){const{role:e,...t}=n;return Wk({...t,type:e})}else return Wk(n)}function EN(n,e="Human",t="AI"){const r=[];for(const s of n){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=t;else if(s._getType()==="system")i="System";else if(s._getType()==="function")i="Function";else if(s._getType()==="tool")i="Tool";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const a=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);r.push(`${i}: ${a}${o}`)}return r.join(`
`)}function Q8(n){var t;const e=n._getType();if(e==="human")return new wm({...n});if(e==="ai"){let r={...n};return"tool_calls"in r&&(r={...r,tool_call_chunks:(t=r.tool_calls)==null?void 0:t.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new wr({...r})}else{if(e==="system")return new mu({...n});if(e==="function")return new ym({...n});if(Lo.isInstance(n))return new gm({...n});throw new Error("Unknown message type.")}}var _m={exports:{}},zk={},Vk,kN;function eZ(){if(kN)return Vk;kN=1;function n(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return Vk=n,n.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},n.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},n.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var s=this;return this._timer=setTimeout(function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout(function(){s._operationTimeoutCb(s._attempts)},s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)},r),this._options.unref&&this._timer.unref(),!0},n.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},n.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},n.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},n.prototype.start=n.prototype.try,n.prototype.errors=function(){return this._errors},n.prototype.attempts=function(){return this._attempts},n.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,r=0,s=0;s<this._errors.length;s++){var i=this._errors[s],a=i.message,o=(e[a]||0)+1;e[a]=o,o>=r&&(t=i,r=o)}return t},Vk}var CN;function tZ(){return CN||(CN=1,function(n){var e=eZ();n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)r[s]=t[s];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],a=0;a<r.retries;a++)i.push(this.createTimeout(a,r));return t&&t.forever&&!i.length&&i.push(this.createTimeout(a,r)),i.sort(function(o,u){return o-u}),i},n.createTimeout=function(t,r){var s=r.randomize?Math.random()+1:1,i=Math.round(s*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return i=Math.min(i,r.maxTimeout),i},n.wrap=function(t,r,s){if(r instanceof Array&&(s=r,r=null),!s){s=[];for(var i in t)typeof t[i]=="function"&&s.push(i)}for(var a=0;a<s.length;a++){var o=s[a],u=t[o];t[o]=(function(d){var h=n.operation(r),f=Array.prototype.slice.call(arguments,1),p=f.pop();f.push(function(m){h.retry(m)||(m&&(arguments[0]=h.mainError()),p.apply(this,arguments))}),h.attempt(function(){d.apply(t,f)})}).bind(t,u),t[o].options=r}}}(zk)),zk}var Gk,PN;function rZ(){return PN||(PN=1,Gk=tZ()),Gk}var AN;function nZ(){if(AN)return _m.exports;AN=1;const n=rZ(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(o){super(),o instanceof Error?(this.originalError=o,{message:o}=o):(this.originalError=new Error(o),this.originalError.stack=this.stack),this.name="AbortError",this.message=o}}const r=(a,o,u)=>{const l=u.retries-(o-1);return a.attemptNumber=o,a.retriesLeft=l,a},s=a=>e.includes(a),i=(a,o)=>new Promise((u,l)=>{o={onFailedAttempt:()=>{},retries:10,...o};const d=n.operation(o);d.attempt(async h=>{try{u(await a(h))}catch(f){if(!(f instanceof Error)){l(new TypeError(`Non-error was thrown: "${f}". You should only throw errors.`));return}if(f instanceof t)d.stop(),l(f.originalError);else if(f instanceof TypeError&&!s(f.message))d.stop(),l(f);else{r(f,h,o);try{await o.onFailedAttempt(f)}catch(p){l(p);return}d.retry(f)||l(d.mainError())}}})});return _m.exports=i,_m.exports.default=i,_m.exports.AbortError=t,_m.exports}var sZ=nZ();const Ub=Qe(sZ),iZ=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function bm(n){return typeof n=="string"&&iZ.test(n)}for(var Jr=[],Zk=0;Zk<256;++Zk)Jr.push((Zk+256).toString(16).slice(1));function aZ(n,e=0){return(Jr[n[e+0]]+Jr[n[e+1]]+Jr[n[e+2]]+Jr[n[e+3]]+"-"+Jr[n[e+4]]+Jr[n[e+5]]+"-"+Jr[n[e+6]]+Jr[n[e+7]]+"-"+Jr[n[e+8]]+Jr[n[e+9]]+"-"+Jr[n[e+10]]+Jr[n[e+11]]+Jr[n[e+12]]+Jr[n[e+13]]+Jr[n[e+14]]+Jr[n[e+15]]).toLowerCase()}var qb,oZ=new Uint8Array(16);function cZ(){if(!qb&&(qb=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!qb))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return qb(oZ)}var uZ=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const TN={randomUUID:uZ};function Sn(n,e,t){if(TN.randomUUID&&!e&&!n)return TN.randomUUID();n=n||{};var r=n.random||(n.rng||cZ)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,aZ(r)}var Hb={},Jk={exports:{}},IN;function lZ(){return IN||(IN=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(u,l,d){this.fn=u,this.context=l,this.once=d||!1}function i(u,l,d,h,f){if(typeof d!="function")throw new TypeError("The listener must be a function");var p=new s(d,h||u,f),m=t?t+l:l;return u._events[m]?u._events[m].fn?u._events[m]=[u._events[m],p]:u._events[m].push(p):(u._events[m]=p,u._eventsCount++),u}function a(u,l){--u._eventsCount===0?u._events=new r:delete u._events[l]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],d,h;if(this._eventsCount===0)return l;for(h in d=this._events)e.call(d,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},o.prototype.listeners=function(l){var d=t?t+l:l,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,p=h.length,m=new Array(p);f<p;f++)m[f]=h[f].fn;return m},o.prototype.listenerCount=function(l){var d=t?t+l:l,h=this._events[d];return h?h.fn?1:h.length:0},o.prototype.emit=function(l,d,h,f,p,m){var g=t?t+l:l;if(!this._events[g])return!1;var y=this._events[g],w=arguments.length,v,b;if(y.fn){switch(y.once&&this.removeListener(l,y.fn,void 0,!0),w){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,d),!0;case 3:return y.fn.call(y.context,d,h),!0;case 4:return y.fn.call(y.context,d,h,f),!0;case 5:return y.fn.call(y.context,d,h,f,p),!0;case 6:return y.fn.call(y.context,d,h,f,p,m),!0}for(b=1,v=new Array(w-1);b<w;b++)v[b-1]=arguments[b];y.fn.apply(y.context,v)}else{var S=y.length,P;for(b=0;b<S;b++)switch(y[b].once&&this.removeListener(l,y[b].fn,void 0,!0),w){case 1:y[b].fn.call(y[b].context);break;case 2:y[b].fn.call(y[b].context,d);break;case 3:y[b].fn.call(y[b].context,d,h);break;case 4:y[b].fn.call(y[b].context,d,h,f);break;default:if(!v)for(P=1,v=new Array(w-1);P<w;P++)v[P-1]=arguments[P];y[b].fn.apply(y[b].context,v)}}return!0},o.prototype.on=function(l,d,h){return i(this,l,d,h,!1)},o.prototype.once=function(l,d,h){return i(this,l,d,h,!0)},o.prototype.removeListener=function(l,d,h,f){var p=t?t+l:l;if(!this._events[p])return this;if(!d)return a(this,p),this;var m=this._events[p];if(m.fn)m.fn===d&&(!f||m.once)&&(!h||m.context===h)&&a(this,p);else{for(var g=0,y=[],w=m.length;g<w;g++)(m[g].fn!==d||f&&!m[g].once||h&&m[g].context!==h)&&y.push(m[g]);y.length?this._events[p]=y.length===1?y[0]:y:a(this,p)}return this},o.prototype.removeAllListeners=function(l){var d;return l?(d=t?t+l:l,this._events[d]&&a(this,d)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o}(Jk)),Jk.exports}var Sm={exports:{}},Xk,ON;function dZ(){return ON||(ON=1,Xk=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})))),Xk}var RN;function hZ(){if(RN)return Sm.exports;RN=1;const n=dZ();class e extends Error{constructor(s){super(s),this.name="TimeoutError"}}const t=(r,s,i)=>new Promise((a,o)=>{if(typeof s!="number"||s<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(s===1/0){a(r);return}const u=setTimeout(()=>{if(typeof i=="function"){try{a(i())}catch(h){o(h)}return}const l=typeof i=="string"?i:`Promise timed out after ${s} milliseconds`,d=i instanceof Error?i:new e(l);typeof r.cancel=="function"&&r.cancel(),o(d)},s);n(r.then(a,o),()=>{clearTimeout(u)})});return Sm.exports=t,Sm.exports.default=t,Sm.exports.TimeoutError=e,Sm.exports}var Kb={},Wb={},MN;function fZ(){if(MN)return Wb;MN=1,Object.defineProperty(Wb,"__esModule",{value:!0});function n(e,t,r){let s=0,i=e.length;for(;i>0;){const a=i/2|0;let o=s+a;r(e[o],t)<=0?(s=++o,i-=a+1):i=a}return s}return Wb.default=n,Wb}var $N;function pZ(){if($N)return Kb;$N=1,Object.defineProperty(Kb,"__esModule",{value:!0});const n=fZ();class e{constructor(){this._queue=[]}enqueue(r,s){s=Object.assign({priority:0},s);const i={priority:s.priority,run:r};if(this.size&&this._queue[this.size-1].priority>=s.priority){this._queue.push(i);return}const a=n.default(this._queue,i,(o,u)=>u.priority-o.priority);this._queue.splice(a,0,i)}dequeue(){const r=this._queue.shift();return r==null?void 0:r.run}filter(r){return this._queue.filter(s=>s.priority===r.priority).map(s=>s.run)}get size(){return this._queue.length}}return Kb.default=e,Kb}var NN;function mZ(){if(NN)return Hb;NN=1,Object.defineProperty(Hb,"__esModule",{value:!0});const n=lZ(),e=hZ(),t=pZ(),r=()=>{},s=new e.TimeoutError;class i extends n{constructor(o){var u,l,d,h;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=r,this._resolveIdle=r,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(l=(u=o.intervalCap)===null||u===void 0?void 0:u.toString())!==null&&l!==void 0?l:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(h=(d=o.interval)===null||d===void 0?void 0:d.toString())!==null&&h!==void 0?h:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=r,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=r,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const u=this._intervalEnd-o;if(u<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},u)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const u=this._queue.dequeue();return u?(this.emit("active"),u(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,u={}){return new Promise((l,d)=>{const h=async()=>{this._pendingCount++,this._intervalCount++;try{const f=this._timeout===void 0&&u.timeout===void 0?o():e.default(Promise.resolve(o()),u.timeout===void 0?this._timeout:u.timeout,()=>{(u.throwOnTimeout===void 0?this._throwOnTimeout:u.throwOnTimeout)&&d(s)});l(await f)}catch(f){d(f)}this._next()};this._queue.enqueue(h,u),this._tryToStartAnother(),this.emit("add")})}async addAll(o,u){return Promise.all(o.map(async l=>this.add(l,u)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const u=this._resolveEmpty;this._resolveEmpty=()=>{u(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const u=this._resolveIdle;this._resolveIdle=()=>{u(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return Hb.default=i,Hb}var gZ=mZ();const Ra=Qe(gZ),yZ=(...n)=>fetch(...n),wZ=Symbol.for("ls:fetch_implementation"),Re=()=>globalThis[wZ]??yZ,vZ=[400,401,403,404,405,406,407,408],_Z=[409];let FN=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Ra?this.queue=new Ra.default({concurrency:this.maxConcurrency}):this.queue=new Ra({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const r=this.onFailedResponseHook;return this.queue.add(()=>Ub(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const i=s==null?void 0:s.response,a=i==null?void 0:i.status;if(a){if(vZ.includes(+a))throw s;if(_Z.includes(+a))return;r&&await r(i)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>Re()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function LN(n){return typeof(n==null?void 0:n._getType)=="function"}function jN(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}function Ve(n,e){if(!bm(n)){const t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}const DN={};function BN(n){DN[n]||(console.warn(n),DN[n]=!0)}var zb={exports:{}},Yk,UN;function Vb(){if(UN)return Yk;UN=1;const n="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,r=16,s=e-6;return Yk={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:n,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Yk}var Qk,qN;function Gb(){return qN||(qN=1,Qk=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{}),Qk}var HN;function xm(){return HN||(HN=1,function(n,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:s}=Vb(),i=Gb();e=n.exports={};const a=e.re=[],o=e.safeRe=[],u=e.src=[],l=e.t={};let d=0;const h="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",s],[h,r]],p=g=>{for(const[y,w]of f)g=g.split(`${y}*`).join(`${y}{0,${w}}`).split(`${y}+`).join(`${y}{1,${w}}`);return g},m=(g,y,w)=>{const v=p(y),b=d++;i(g,b,y),l[g]=b,u[b]=y,a[b]=new RegExp(y,w?"g":void 0),o[b]=new RegExp(v,w?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),m("MAINVERSION",`(${u[l.NUMERICIDENTIFIER]})\\.(${u[l.NUMERICIDENTIFIER]})\\.(${u[l.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${u[l.NUMERICIDENTIFIERLOOSE]})\\.(${u[l.NUMERICIDENTIFIERLOOSE]})\\.(${u[l.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${u[l.NUMERICIDENTIFIER]}|${u[l.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${u[l.NUMERICIDENTIFIERLOOSE]}|${u[l.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${u[l.PRERELEASEIDENTIFIER]}(?:\\.${u[l.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${u[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[l.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${h}+`),m("BUILD",`(?:\\+(${u[l.BUILDIDENTIFIER]}(?:\\.${u[l.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${u[l.MAINVERSION]}${u[l.PRERELEASE]}?${u[l.BUILD]}?`),m("FULL",`^${u[l.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${u[l.MAINVERSIONLOOSE]}${u[l.PRERELEASELOOSE]}?${u[l.BUILD]}?`),m("LOOSE",`^${u[l.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${u[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${u[l.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${u[l.XRANGEIDENTIFIER]})(?:\\.(${u[l.XRANGEIDENTIFIER]})(?:\\.(${u[l.XRANGEIDENTIFIER]})(?:${u[l.PRERELEASE]})?${u[l.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${u[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[l.XRANGEIDENTIFIERLOOSE]})(?:${u[l.PRERELEASELOOSE]})?${u[l.BUILD]}?)?)?`),m("XRANGE",`^${u[l.GTLT]}\\s*${u[l.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${u[l.GTLT]}\\s*${u[l.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${u[l.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",u[l.COERCEPLAIN]+`(?:${u[l.PRERELEASE]})?(?:${u[l.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",u[l.COERCE],!0),m("COERCERTLFULL",u[l.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${u[l.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${u[l.LONETILDE]}${u[l.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${u[l.LONETILDE]}${u[l.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${u[l.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${u[l.LONECARET]}${u[l.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${u[l.LONECARET]}${u[l.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${u[l.GTLT]}\\s*(${u[l.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${u[l.GTLT]}\\s*(${u[l.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${u[l.GTLT]}\\s*(${u[l.LOOSEPLAIN]}|${u[l.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${u[l.XRANGEPLAIN]})\\s+-\\s+(${u[l.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${u[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[l.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(zb,zb.exports)),zb.exports}var eC,KN;function tC(){if(KN)return eC;KN=1;const n=Object.freeze({loose:!0}),e=Object.freeze({});return eC=r=>r?typeof r!="object"?n:r:e,eC}var rC,WN;function zN(){if(WN)return rC;WN=1;const n=/^[0-9]+$/,e=(r,s)=>{const i=n.test(r),a=n.test(s);return i&&a&&(r=+r,s=+s),r===s?0:i&&!a?-1:a&&!i?1:r<s?-1:1};return rC={compareIdentifiers:e,rcompareIdentifiers:(r,s)=>e(s,r)},rC}var nC,VN;function xn(){if(VN)return nC;VN=1;const n=Gb(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=Vb(),{safeRe:r,t:s}=xm(),i=tC(),{compareIdentifiers:a}=zN();class o{constructor(l,d){if(d=i(d),l instanceof o){if(l.loose===!!d.loose&&l.includePrerelease===!!d.includePrerelease)return l;l=l.version}else if(typeof l!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof l}".`);if(l.length>e)throw new TypeError(`version is longer than ${e} characters`);n("SemVer",l,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const h=l.trim().match(d.loose?r[s.LOOSE]:r[s.FULL]);if(!h)throw new TypeError(`Invalid Version: ${l}`);if(this.raw=l,this.major=+h[1],this.minor=+h[2],this.patch=+h[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");h[4]?this.prerelease=h[4].split(".").map(f=>{if(/^[0-9]+$/.test(f)){const p=+f;if(p>=0&&p<t)return p}return f}):this.prerelease=[],this.build=h[5]?h[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(l){if(n("SemVer.compare",this.version,this.options,l),!(l instanceof o)){if(typeof l=="string"&&l===this.version)return 0;l=new o(l,this.options)}return l.version===this.version?0:this.compareMain(l)||this.comparePre(l)}compareMain(l){return l instanceof o||(l=new o(l,this.options)),a(this.major,l.major)||a(this.minor,l.minor)||a(this.patch,l.patch)}comparePre(l){if(l instanceof o||(l=new o(l,this.options)),this.prerelease.length&&!l.prerelease.length)return-1;if(!this.prerelease.length&&l.prerelease.length)return 1;if(!this.prerelease.length&&!l.prerelease.length)return 0;let d=0;do{const h=this.prerelease[d],f=l.prerelease[d];if(n("prerelease compare",d,h,f),h===void 0&&f===void 0)return 0;if(f===void 0)return 1;if(h===void 0)return-1;if(h===f)continue;return a(h,f)}while(++d)}compareBuild(l){l instanceof o||(l=new o(l,this.options));let d=0;do{const h=this.build[d],f=l.build[d];if(n("build compare",d,h,f),h===void 0&&f===void 0)return 0;if(f===void 0)return 1;if(h===void 0)return-1;if(h===f)continue;return a(h,f)}while(++d)}inc(l,d,h){switch(l){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",d,h);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",d,h);break;case"prepatch":this.prerelease.length=0,this.inc("patch",d,h),this.inc("pre",d,h);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",d,h),this.inc("pre",d,h);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const f=Number(h)?1:0;if(!d&&h===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[f];else{let p=this.prerelease.length;for(;--p>=0;)typeof this.prerelease[p]=="number"&&(this.prerelease[p]++,p=-2);if(p===-1){if(d===this.prerelease.join(".")&&h===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(f)}}if(d){let p=[d,f];h===!1&&(p=[d]),a(this.prerelease[0],d)===0?isNaN(this.prerelease[1])&&(this.prerelease=p):this.prerelease=p}break}default:throw new Error(`invalid increment argument: ${l}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return nC=o,nC}var sC,GN;function Md(){if(GN)return sC;GN=1;const n=xn();return sC=(t,r,s=!1)=>{if(t instanceof n)return t;try{return new n(t,r)}catch(i){if(!s)return null;throw i}},sC}var iC,ZN;function bZ(){if(ZN)return iC;ZN=1;const n=Md();return iC=(t,r)=>{const s=n(t,r);return s?s.version:null},iC}var aC,JN;function SZ(){if(JN)return aC;JN=1;const n=Md();return aC=(t,r)=>{const s=n(t.trim().replace(/^[=v]+/,""),r);return s?s.version:null},aC}var oC,XN;function xZ(){if(XN)return oC;XN=1;const n=xn();return oC=(t,r,s,i,a)=>{typeof s=="string"&&(a=i,i=s,s=void 0);try{return new n(t instanceof n?t.version:t,s).inc(r,i,a).version}catch{return null}},oC}var cC,YN;function EZ(){if(YN)return cC;YN=1;const n=Md();return cC=(t,r)=>{const s=n(t,null,!0),i=n(r,null,!0),a=s.compare(i);if(a===0)return null;const o=a>0,u=o?s:i,l=o?i:s,d=!!u.prerelease.length;if(!!l.prerelease.length&&!d)return!l.patch&&!l.minor?"major":u.patch?"patch":u.minor?"minor":"major";const f=d?"pre":"";return s.major!==i.major?f+"major":s.minor!==i.minor?f+"minor":s.patch!==i.patch?f+"patch":"prerelease"},cC}var uC,QN;function kZ(){if(QN)return uC;QN=1;const n=xn();return uC=(t,r)=>new n(t,r).major,uC}var lC,eF;function CZ(){if(eF)return lC;eF=1;const n=xn();return lC=(t,r)=>new n(t,r).minor,lC}var dC,tF;function PZ(){if(tF)return dC;tF=1;const n=xn();return dC=(t,r)=>new n(t,r).patch,dC}var hC,rF;function AZ(){if(rF)return hC;rF=1;const n=Md();return hC=(t,r)=>{const s=n(t,r);return s&&s.prerelease.length?s.prerelease:null},hC}var fC,nF;function ri(){if(nF)return fC;nF=1;const n=xn();return fC=(t,r,s)=>new n(t,s).compare(new n(r,s)),fC}var pC,sF;function TZ(){if(sF)return pC;sF=1;const n=ri();return pC=(t,r,s)=>n(r,t,s),pC}var mC,iF;function IZ(){if(iF)return mC;iF=1;const n=ri();return mC=(t,r)=>n(t,r,!0),mC}var gC,aF;function yC(){if(aF)return gC;aF=1;const n=xn();return gC=(t,r,s)=>{const i=new n(t,s),a=new n(r,s);return i.compare(a)||i.compareBuild(a)},gC}var wC,oF;function OZ(){if(oF)return wC;oF=1;const n=yC();return wC=(t,r)=>t.sort((s,i)=>n(s,i,r)),wC}var vC,cF;function RZ(){if(cF)return vC;cF=1;const n=yC();return vC=(t,r)=>t.sort((s,i)=>n(i,s,r)),vC}var _C,uF;function Zb(){if(uF)return _C;uF=1;const n=ri();return _C=(t,r,s)=>n(t,r,s)>0,_C}var bC,lF;function SC(){if(lF)return bC;lF=1;const n=ri();return bC=(t,r,s)=>n(t,r,s)<0,bC}var xC,dF;function hF(){if(dF)return xC;dF=1;const n=ri();return xC=(t,r,s)=>n(t,r,s)===0,xC}var EC,fF;function pF(){if(fF)return EC;fF=1;const n=ri();return EC=(t,r,s)=>n(t,r,s)!==0,EC}var kC,mF;function CC(){if(mF)return kC;mF=1;const n=ri();return kC=(t,r,s)=>n(t,r,s)>=0,kC}var PC,gF;function AC(){if(gF)return PC;gF=1;const n=ri();return PC=(t,r,s)=>n(t,r,s)<=0,PC}var TC,yF;function wF(){if(yF)return TC;yF=1;const n=hF(),e=pF(),t=Zb(),r=CC(),s=SC(),i=AC();return TC=(o,u,l,d)=>{switch(u){case"===":return typeof o=="object"&&(o=o.version),typeof l=="object"&&(l=l.version),o===l;case"!==":return typeof o=="object"&&(o=o.version),typeof l=="object"&&(l=l.version),o!==l;case"":case"=":case"==":return n(o,l,d);case"!=":return e(o,l,d);case">":return t(o,l,d);case">=":return r(o,l,d);case"<":return s(o,l,d);case"<=":return i(o,l,d);default:throw new TypeError(`Invalid operator: ${u}`)}},TC}var IC,vF;function MZ(){if(vF)return IC;vF=1;const n=xn(),e=Md(),{safeRe:t,t:r}=xm();return IC=(i,a)=>{if(i instanceof n)return i;if(typeof i=="number"&&(i=String(i)),typeof i!="string")return null;a=a||{};let o=null;if(!a.rtl)o=i.match(a.includePrerelease?t[r.COERCEFULL]:t[r.COERCE]);else{const p=a.includePrerelease?t[r.COERCERTLFULL]:t[r.COERCERTL];let m;for(;(m=p.exec(i))&&(!o||o.index+o[0].length!==i.length);)(!o||m.index+m[0].length!==o.index+o[0].length)&&(o=m),p.lastIndex=m.index+m[1].length+m[2].length;p.lastIndex=-1}if(o===null)return null;const u=o[2],l=o[3]||"0",d=o[4]||"0",h=a.includePrerelease&&o[5]?`-${o[5]}`:"",f=a.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${u}.${l}.${d}${h}${f}`,a)},IC}var OC,_F;function $Z(){if(_F)return OC;_F=1;class n{constructor(){this.max=1e3,this.map=new Map}get(t){const r=this.map.get(t);if(r!==void 0)return this.map.delete(t),this.map.set(t,r),r}delete(t){return this.map.delete(t)}set(t,r){if(!this.delete(t)&&r!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(t,r)}return this}}return OC=n,OC}var RC,bF;function ni(){if(bF)return RC;bF=1;const n=/\s+/g;class e{constructor(U,Z){if(Z=s(Z),U instanceof e)return U.loose===!!Z.loose&&U.includePrerelease===!!Z.includePrerelease?U:new e(U.raw,Z);if(U instanceof i)return this.raw=U.value,this.set=[[U]],this.formatted=void 0,this;if(this.options=Z,this.loose=!!Z.loose,this.includePrerelease=!!Z.includePrerelease,this.raw=U.trim().replace(n," "),this.set=this.raw.split("||").map(j=>this.parseRange(j.trim())).filter(j=>j.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const j=this.set[0];if(this.set=this.set.filter(F=>!g(F[0])),this.set.length===0)this.set=[j];else if(this.set.length>1){for(const F of this.set)if(F.length===1&&y(F[0])){this.set=[F];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let U=0;U<this.set.length;U++){U>0&&(this.formatted+="||");const Z=this.set[U];for(let j=0;j<Z.length;j++)j>0&&(this.formatted+=" "),this.formatted+=Z[j].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(U){const j=((this.options.includePrerelease&&p)|(this.options.loose&&m))+":"+U,F=r.get(j);if(F)return F;const B=this.options.loose,D=B?u[l.HYPHENRANGELOOSE]:u[l.HYPHENRANGE];U=U.replace(D,O(this.options.includePrerelease)),a("hyphen replace",U),U=U.replace(u[l.COMPARATORTRIM],d),a("comparator trim",U),U=U.replace(u[l.TILDETRIM],h),a("tilde trim",U),U=U.replace(u[l.CARETTRIM],f),a("caret trim",U);let W=U.split(" ").map(q=>v(q,this.options)).join(" ").split(/\s+/).map(q=>N(q,this.options));B&&(W=W.filter(q=>(a("loose invalid filter",q,this.options),!!q.match(u[l.COMPARATORLOOSE])))),a("range list",W);const G=new Map,te=W.map(q=>new i(q,this.options));for(const q of te){if(g(q))return[q];G.set(q.value,q)}G.size>1&&G.has("")&&G.delete("");const K=[...G.values()];return r.set(j,K),K}intersects(U,Z){if(!(U instanceof e))throw new TypeError("a Range is required");return this.set.some(j=>w(j,Z)&&U.set.some(F=>w(F,Z)&&j.every(B=>F.every(D=>B.intersects(D,Z)))))}test(U){if(!U)return!1;if(typeof U=="string")try{U=new o(U,this.options)}catch{return!1}for(let Z=0;Z<this.set.length;Z++)if(T(this.set[Z],U,this.options))return!0;return!1}}RC=e;const t=$Z(),r=new t,s=tC(),i=Jb(),a=Gb(),o=xn(),{safeRe:u,t:l,comparatorTrimReplace:d,tildeTrimReplace:h,caretTrimReplace:f}=xm(),{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:m}=Vb(),g=L=>L.value==="<0.0.0-0",y=L=>L.value==="",w=(L,U)=>{let Z=!0;const j=L.slice();let F=j.pop();for(;Z&&j.length;)Z=j.every(B=>F.intersects(B,U)),F=j.pop();return Z},v=(L,U)=>(a("comp",L,U),L=k(L,U),a("caret",L),L=S(L,U),a("tildes",L),L=E(L,U),a("xrange",L),L=I(L,U),a("stars",L),L),b=L=>!L||L.toLowerCase()==="x"||L==="*",S=(L,U)=>L.trim().split(/\s+/).map(Z=>P(Z,U)).join(" "),P=(L,U)=>{const Z=U.loose?u[l.TILDELOOSE]:u[l.TILDE];return L.replace(Z,(j,F,B,D,W)=>{a("tilde",L,j,F,B,D,W);let G;return b(F)?G="":b(B)?G=`>=${F}.0.0 <${+F+1}.0.0-0`:b(D)?G=`>=${F}.${B}.0 <${F}.${+B+1}.0-0`:W?(a("replaceTilde pr",W),G=`>=${F}.${B}.${D}-${W} <${F}.${+B+1}.0-0`):G=`>=${F}.${B}.${D} <${F}.${+B+1}.0-0`,a("tilde return",G),G})},k=(L,U)=>L.trim().split(/\s+/).map(Z=>C(Z,U)).join(" "),C=(L,U)=>{a("caret",L,U);const Z=U.loose?u[l.CARETLOOSE]:u[l.CARET],j=U.includePrerelease?"-0":"";return L.replace(Z,(F,B,D,W,G)=>{a("caret",L,F,B,D,W,G);let te;return b(B)?te="":b(D)?te=`>=${B}.0.0${j} <${+B+1}.0.0-0`:b(W)?B==="0"?te=`>=${B}.${D}.0${j} <${B}.${+D+1}.0-0`:te=`>=${B}.${D}.0${j} <${+B+1}.0.0-0`:G?(a("replaceCaret pr",G),B==="0"?D==="0"?te=`>=${B}.${D}.${W}-${G} <${B}.${D}.${+W+1}-0`:te=`>=${B}.${D}.${W}-${G} <${B}.${+D+1}.0-0`:te=`>=${B}.${D}.${W}-${G} <${+B+1}.0.0-0`):(a("no pr"),B==="0"?D==="0"?te=`>=${B}.${D}.${W}${j} <${B}.${D}.${+W+1}-0`:te=`>=${B}.${D}.${W}${j} <${B}.${+D+1}.0-0`:te=`>=${B}.${D}.${W} <${+B+1}.0.0-0`),a("caret return",te),te})},E=(L,U)=>(a("replaceXRanges",L,U),L.split(/\s+/).map(Z=>M(Z,U)).join(" ")),M=(L,U)=>{L=L.trim();const Z=U.loose?u[l.XRANGELOOSE]:u[l.XRANGE];return L.replace(Z,(j,F,B,D,W,G)=>{a("xRange",L,j,F,B,D,W,G);const te=b(B),K=te||b(D),q=K||b(W),se=q;return F==="="&&se&&(F=""),G=U.includePrerelease?"-0":"",te?F===">"||F==="<"?j="<0.0.0-0":j="*":F&&se?(K&&(D=0),W=0,F===">"?(F=">=",K?(B=+B+1,D=0,W=0):(D=+D+1,W=0)):F==="<="&&(F="<",K?B=+B+1:D=+D+1),F==="<"&&(G="-0"),j=`${F+B}.${D}.${W}${G}`):K?j=`>=${B}.0.0${G} <${+B+1}.0.0-0`:q&&(j=`>=${B}.${D}.0${G} <${B}.${+D+1}.0-0`),a("xRange return",j),j})},I=(L,U)=>(a("replaceStars",L,U),L.trim().replace(u[l.STAR],"")),N=(L,U)=>(a("replaceGTE0",L,U),L.trim().replace(u[U.includePrerelease?l.GTE0PRE:l.GTE0],"")),O=L=>(U,Z,j,F,B,D,W,G,te,K,q,se)=>(b(j)?Z="":b(F)?Z=`>=${j}.0.0${L?"-0":""}`:b(B)?Z=`>=${j}.${F}.0${L?"-0":""}`:D?Z=`>=${Z}`:Z=`>=${Z}${L?"-0":""}`,b(te)?G="":b(K)?G=`<${+te+1}.0.0-0`:b(q)?G=`<${te}.${+K+1}.0-0`:se?G=`<=${te}.${K}.${q}-${se}`:L?G=`<${te}.${K}.${+q+1}-0`:G=`<=${G}`,`${Z} ${G}`.trim()),T=(L,U,Z)=>{for(let j=0;j<L.length;j++)if(!L[j].test(U))return!1;if(U.prerelease.length&&!Z.includePrerelease){for(let j=0;j<L.length;j++)if(a(L[j].semver),L[j].semver!==i.ANY&&L[j].semver.prerelease.length>0){const F=L[j].semver;if(F.major===U.major&&F.minor===U.minor&&F.patch===U.patch)return!0}return!1}return!0};return RC}var MC,SF;function Jb(){if(SF)return MC;SF=1;const n=Symbol("SemVer ANY");class e{static get ANY(){return n}constructor(d,h){if(h=t(h),d instanceof e){if(d.loose===!!h.loose)return d;d=d.value}d=d.trim().split(/\s+/).join(" "),a("comparator",d,h),this.options=h,this.loose=!!h.loose,this.parse(d),this.semver===n?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(d){const h=this.options.loose?r[s.COMPARATORLOOSE]:r[s.COMPARATOR],f=d.match(h);if(!f)throw new TypeError(`Invalid comparator: ${d}`);this.operator=f[1]!==void 0?f[1]:"",this.operator==="="&&(this.operator=""),f[2]?this.semver=new o(f[2],this.options.loose):this.semver=n}toString(){return this.value}test(d){if(a("Comparator.test",d,this.options.loose),this.semver===n||d===n)return!0;if(typeof d=="string")try{d=new o(d,this.options)}catch{return!1}return i(d,this.operator,this.semver,this.options)}intersects(d,h){if(!(d instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(d.value,h).test(this.value):d.operator===""?d.value===""?!0:new u(this.value,h).test(d.semver):(h=t(h),h.includePrerelease&&(this.value==="<0.0.0-0"||d.value==="<0.0.0-0")||!h.includePrerelease&&(this.value.startsWith("<0.0.0")||d.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&d.operator.startsWith(">")||this.operator.startsWith("<")&&d.operator.startsWith("<")||this.semver.version===d.semver.version&&this.operator.includes("=")&&d.operator.includes("=")||i(this.semver,"<",d.semver,h)&&this.operator.startsWith(">")&&d.operator.startsWith("<")||i(this.semver,">",d.semver,h)&&this.operator.startsWith("<")&&d.operator.startsWith(">")))}}MC=e;const t=tC(),{safeRe:r,t:s}=xm(),i=wF(),a=Gb(),o=xn(),u=ni();return MC}var $C,xF;function Xb(){if(xF)return $C;xF=1;const n=ni();return $C=(t,r,s)=>{try{r=new n(r,s)}catch{return!1}return r.test(t)},$C}var NC,EF;function NZ(){if(EF)return NC;EF=1;const n=ni();return NC=(t,r)=>new n(t,r).set.map(s=>s.map(i=>i.value).join(" ").trim().split(" ")),NC}var FC,kF;function FZ(){if(kF)return FC;kF=1;const n=xn(),e=ni();return FC=(r,s,i)=>{let a=null,o=null,u=null;try{u=new e(s,i)}catch{return null}return r.forEach(l=>{u.test(l)&&(!a||o.compare(l)===-1)&&(a=l,o=new n(a,i))}),a},FC}var LC,CF;function LZ(){if(CF)return LC;CF=1;const n=xn(),e=ni();return LC=(r,s,i)=>{let a=null,o=null,u=null;try{u=new e(s,i)}catch{return null}return r.forEach(l=>{u.test(l)&&(!a||o.compare(l)===1)&&(a=l,o=new n(a,i))}),a},LC}var jC,PF;function jZ(){if(PF)return jC;PF=1;const n=xn(),e=ni(),t=Zb();return jC=(s,i)=>{s=new e(s,i);let a=new n("0.0.0");if(s.test(a)||(a=new n("0.0.0-0"),s.test(a)))return a;a=null;for(let o=0;o<s.set.length;++o){const u=s.set[o];let l=null;u.forEach(d=>{const h=new n(d.semver.version);switch(d.operator){case">":h.prerelease.length===0?h.patch++:h.prerelease.push(0),h.raw=h.format();case"":case">=":(!l||t(h,l))&&(l=h);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${d.operator}`)}}),l&&(!a||t(a,l))&&(a=l)}return a&&s.test(a)?a:null},jC}var DC,AF;function DZ(){if(AF)return DC;AF=1;const n=ni();return DC=(t,r)=>{try{return new n(t,r).range||"*"}catch{return null}},DC}var BC,TF;function UC(){if(TF)return BC;TF=1;const n=xn(),e=Jb(),{ANY:t}=e,r=ni(),s=Xb(),i=Zb(),a=SC(),o=AC(),u=CC();return BC=(d,h,f,p)=>{d=new n(d,p),h=new r(h,p);let m,g,y,w,v;switch(f){case">":m=i,g=o,y=a,w=">",v=">=";break;case"<":m=a,g=u,y=i,w="<",v="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(d,h,p))return!1;for(let b=0;b<h.set.length;++b){const S=h.set[b];let P=null,k=null;if(S.forEach(C=>{C.semver===t&&(C=new e(">=0.0.0")),P=P||C,k=k||C,m(C.semver,P.semver,p)?P=C:y(C.semver,k.semver,p)&&(k=C)}),P.operator===w||P.operator===v||(!k.operator||k.operator===w)&&g(d,k.semver))return!1;if(k.operator===v&&y(d,k.semver))return!1}return!0},BC}var qC,IF;function BZ(){if(IF)return qC;IF=1;const n=UC();return qC=(t,r,s)=>n(t,r,">",s),qC}var HC,OF;function UZ(){if(OF)return HC;OF=1;const n=UC();return HC=(t,r,s)=>n(t,r,"<",s),HC}var KC,RF;function qZ(){if(RF)return KC;RF=1;const n=ni();return KC=(t,r,s)=>(t=new n(t,s),r=new n(r,s),t.intersects(r,s)),KC}var WC,MF;function HZ(){if(MF)return WC;MF=1;const n=Xb(),e=ri();return WC=(t,r,s)=>{const i=[];let a=null,o=null;const u=t.sort((f,p)=>e(f,p,s));for(const f of u)n(f,r,s)?(o=f,a||(a=f)):(o&&i.push([a,o]),o=null,a=null);a&&i.push([a,null]);const l=[];for(const[f,p]of i)f===p?l.push(f):!p&&f===u[0]?l.push("*"):p?f===u[0]?l.push(`<=${p}`):l.push(`${f} - ${p}`):l.push(`>=${f}`);const d=l.join(" || "),h=typeof r.raw=="string"?r.raw:String(r);return d.length<h.length?d:r},WC}var zC,$F;function KZ(){if($F)return zC;$F=1;const n=ni(),e=Jb(),{ANY:t}=e,r=Xb(),s=ri(),i=(h,f,p={})=>{if(h===f)return!0;h=new n(h,p),f=new n(f,p);let m=!1;e:for(const g of h.set){for(const y of f.set){const w=u(g,y,p);if(m=m||w!==null,w)continue e}if(m)return!1}return!0},a=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],u=(h,f,p)=>{if(h===f)return!0;if(h.length===1&&h[0].semver===t){if(f.length===1&&f[0].semver===t)return!0;p.includePrerelease?h=a:h=o}if(f.length===1&&f[0].semver===t){if(p.includePrerelease)return!0;f=o}const m=new Set;let g,y;for(const E of h)E.operator===">"||E.operator===">="?g=l(g,E,p):E.operator==="<"||E.operator==="<="?y=d(y,E,p):m.add(E.semver);if(m.size>1)return null;let w;if(g&&y){if(w=s(g.semver,y.semver,p),w>0)return null;if(w===0&&(g.operator!==">="||y.operator!=="<="))return null}for(const E of m){if(g&&!r(E,String(g),p)||y&&!r(E,String(y),p))return null;for(const M of f)if(!r(E,String(M),p))return!1;return!0}let v,b,S,P,k=y&&!p.includePrerelease&&y.semver.prerelease.length?y.semver:!1,C=g&&!p.includePrerelease&&g.semver.prerelease.length?g.semver:!1;k&&k.prerelease.length===1&&y.operator==="<"&&k.prerelease[0]===0&&(k=!1);for(const E of f){if(P=P||E.operator===">"||E.operator===">=",S=S||E.operator==="<"||E.operator==="<=",g){if(C&&E.semver.prerelease&&E.semver.prerelease.length&&E.semver.major===C.major&&E.semver.minor===C.minor&&E.semver.patch===C.patch&&(C=!1),E.operator===">"||E.operator===">="){if(v=l(g,E,p),v===E&&v!==g)return!1}else if(g.operator===">="&&!r(g.semver,String(E),p))return!1}if(y){if(k&&E.semver.prerelease&&E.semver.prerelease.length&&E.semver.major===k.major&&E.semver.minor===k.minor&&E.semver.patch===k.patch&&(k=!1),E.operator==="<"||E.operator==="<="){if(b=d(y,E,p),b===E&&b!==y)return!1}else if(y.operator==="<="&&!r(y.semver,String(E),p))return!1}if(!E.operator&&(y||g)&&w!==0)return!1}return!(g&&S&&!y&&w!==0||y&&P&&!g&&w!==0||C||k)},l=(h,f,p)=>{if(!h)return f;const m=s(h.semver,f.semver,p);return m>0?h:m<0||f.operator===">"&&h.operator===">="?f:h},d=(h,f,p)=>{if(!h)return f;const m=s(h.semver,f.semver,p);return m<0?h:m>0||f.operator==="<"&&h.operator==="<="?f:h};return zC=i,zC}var VC,NF;function WZ(){if(NF)return VC;NF=1;const n=xm(),e=Vb(),t=xn(),r=zN(),s=Md(),i=bZ(),a=SZ(),o=xZ(),u=EZ(),l=kZ(),d=CZ(),h=PZ(),f=AZ(),p=ri(),m=TZ(),g=IZ(),y=yC(),w=OZ(),v=RZ(),b=Zb(),S=SC(),P=hF(),k=pF(),C=CC(),E=AC(),M=wF(),I=MZ(),N=Jb(),O=ni(),T=Xb(),L=NZ(),U=FZ(),Z=LZ(),j=jZ(),F=DZ(),B=UC(),D=BZ(),W=UZ(),G=qZ(),te=HZ(),K=KZ();return VC={parse:s,valid:i,clean:a,inc:o,diff:u,major:l,minor:d,patch:h,prerelease:f,compare:p,rcompare:m,compareLoose:g,compareBuild:y,sort:w,rsort:v,gt:b,lt:S,eq:P,neq:k,gte:C,lte:E,cmp:M,coerce:I,Comparator:N,Range:O,satisfies:T,toComparators:L,maxSatisfying:U,minSatisfying:Z,minVersion:j,validRange:F,outside:B,gtr:D,ltr:W,intersects:G,simplifyRange:te,subset:K,SemVer:t,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:r.compareIdentifiers,rcompareIdentifiers:r.rcompareIdentifiers},VC}WZ();function jo(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);const[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){const[s,i]=e.split("/",2);if(!s||!i)throw new Error(`Invalid identifier format: ${n}`);return[s,i,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}class zZ extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function We(n,e,t){let r;if(n.ok){t&&(r=await n.text());return}r=await n.text();const s=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;throw n.status===409?new zZ(s):new Error(s)}var FF="[...]",VZ={result:"[Circular]"},Yb=[],$d=[];function GZ(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function cs(n,e,t,r){var a;try{return JSON.stringify(n,e,t)}catch(o){if(!((a=o.message)!=null&&a.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof r>"u"&&(r=GZ()),ZC(n,"",0,[],void 0,0,r);var s;try{$d.length===0?s=JSON.stringify(n,e,t):s=JSON.stringify(n,ZZ(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Yb.length!==0;){var i=Yb.pop();i.length===4?Object.defineProperty(i[0],i[1],i[3]):i[0][i[1]]=i[2]}}return s}}function GC(n,e,t,r){var s=Object.getOwnPropertyDescriptor(r,t);s.get!==void 0?s.configurable?(Object.defineProperty(r,t,{value:n}),Yb.push([r,t,e,s])):$d.push([e,t,n]):(r[t]=n,Yb.push([r,t,e]))}function ZC(n,e,t,r,s,i,a){i+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){GC(VZ,n,e,s);return}if(typeof a.depthLimit<"u"&&i>a.depthLimit){GC(FF,n,e,s);return}if(typeof a.edgesLimit<"u"&&t+1>a.edgesLimit){GC(FF,n,e,s);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)ZC(n[o],o,o,r,n,i,a);else{var u=Object.keys(n);for(o=0;o<u.length;o++){var l=u[o];ZC(n[l],l,o,r,n,i,a)}}r.pop()}}function ZZ(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if($d.length>0)for(var r=0;r<$d.length;r++){var s=$d[r];if(s[1]===e&&s[0]===t){t=s[2],$d.splice(r,1);break}}return n.call(this,e,t)}}function LF(n){const e=BF(),t=c7(),r=n.extra??{},s=r.metadata;return n.extra={...r,runtime:{...e,...r==null?void 0:r.runtime},metadata:{...t,...t.revision_id||n.revision_id?{revision_id:n.revision_id??t.revision_id}:{},...s}},n}const JZ=()=>{const n=Do("TRACING_SAMPLING_RATE");if(n===void 0)return;const e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},XZ=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function YZ(n){const e=[];for await(const t of n)e.push(t);return e}function JC(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const QZ=async n=>{if((n==null?void 0:n.status)===429){const e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};class e7{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const r=new Promise(i=>{t=i}),s=cs(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:s}),this.sizeBytes+=s,r}pop(e){var s;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let r=0;for(;r+(((s=this.peek())==null?void 0:s.size)??0)<e&&this.items.length>0;){const i=this.items.shift();i&&(t.push(i),r+=i.size,this.sizeBytes-=i.size)}if(t.length===0&&this.items.length>0){const i=this.items.shift();t.push(i),r+=i.size,this.sizeBytes-=i.size}return[t.map(i=>({action:i.action,item:i.payload})),()=>t.forEach(i=>i.itemPromiseResolve())]}}const t7=20971520,r7=2500;class Em{constructor(e={}){var r;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new e7}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:gu("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});const t=Em.getDefaultClientConfig();if(this.tracingSampleRate=JZ(),this.apiUrl=JC(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=JC(e.apiKey??t.apiKey),this.webUrl=JC(e.webUrl??t.webUrl),(r=this.webUrl)!=null&&r.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new FN(e.callerOptions??{}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new FN({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:QZ}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=Do("API_KEY"),t=Do("ENDPOINT")??"https://api.smith.langchain.com",r=Do("HIDE_INPUTS")==="true",s=Do("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:XZ(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${jF}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${r}`,i=await this.caller.call(Re(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(i,`Failed to fetch ${e}`),i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let s=Number(t.get("offset"))||0;const i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(i));const a=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(Re(),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(o,`Failed to fetch ${e}`);const u=r?r(await o.json()):await o.json();if(u.length===0||(yield u,u.length<i))break;s+=u.length}}async*_getCursorPaginatedList(e,t=null,r="POST",s="runs"){const i=t?{...t}:{};for(;;){const o=await(await this.caller.call(Re(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)})).json();if(!o||!o[s])break;yield o[s];const u=o.cursors;if(!u||!u.next)break;i.cursor=u.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const r=[];for(const s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):r.push(s);return r}else{const r=[];for(const s of e)s.id!==s.trace_id&&!this.filteredPostUuids.has(s.trace_id)||Math.random()<this.tracingSampleRate?r.push(s):this.filteredPostUuids.add(s.id);return r}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??t7}async _getMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[r,s]=this.autoBatchQueue.pop(e);if(!r.length){s();break}const i=this._processBatch(r,s).catch(console.error);t.push(i)}return Promise.all(t)}async _processBatch(e,t){var r;if(!e.length){t();return}try{const s={runCreates:e.filter(a=>a.action==="create").map(a=>a.item),runUpdates:e.filter(a=>a.action==="update").map(a=>a.item)},i=await this._ensureServerInfo();(r=i==null?void 0:i.batch_ingest_config)!=null&&r.use_multipart_endpoint?await this.multipartIngestRuns(s):await this.batchIngestRuns(s)}finally{t()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=LF(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await Re()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(r7),...this.fetchOptions});return await We(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const s=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}const i=LF(s),a=await this.caller.call(Re(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:cs(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(a,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r=(e==null?void 0:e.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[],s=(t==null?void 0:t.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[];if(r.length>0&&s.length>0){const o=r.reduce((l,d)=>(d.id&&(l[d.id]=d),l),{}),u=[];for(const l of s)l.id!==void 0&&o[l.id]?o[l.id]={...o[l.id],...l}:u.push(l);r=Object.values(o),s=u}const i={post:this._filterForSampling(r),patch:this._filterForSampling(s,!0)};if(!i.post.length&&!i.patch.length)return;const a={post:[],patch:[]};for(const o of["post","patch"]){const u=o,l=i[u].reverse();let d=l.pop();for(;d!==void 0;)a[u].push(d),d=l.pop()}(a.post.length>0||a.patch.length>0)&&await this._postBatchIngestRuns(cs(a))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(Re(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const r={};let s=[];for(const d of e??[]){const h=this.prepareRunCreateOrUpdateInputs(d);h.id!==void 0&&h.attachments!==void 0&&(r[h.id]=h.attachments),delete h.attachments,s.push(h)}let i=[];for(const d of t??[])i.push(this.prepareRunCreateOrUpdateInputs(d));if(s.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(i.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&i.length>0){const d=s.reduce((f,p)=>(p.id&&(f[p.id]=p),f),{}),h=[];for(const f of i)f.id!==void 0&&d[f.id]?d[f.id]={...d[f.id],...f}:h.push(f);s=Object.values(d),i=h}if(s.length===0&&i.length===0)return;const u=[],l=[];for(const[d,h]of[["post",s],["patch",i]])for(const f of h){const{inputs:p,outputs:m,events:g,attachments:y,...w}=f,v={inputs:p,outputs:m,events:g},b=cs(w);l.push({name:`${d}.${w.id}`,payload:new Blob([b],{type:`application/json; length=${b.length}`})});for(const[S,P]of Object.entries(v)){if(P===void 0)continue;const k=cs(P);l.push({name:`${d}.${w.id}.${S}`,payload:new Blob([k],{type:`application/json; length=${k.length}`})})}if(w.id!==void 0){const S=r[w.id];if(S){delete r[w.id];for(const[P,k]of Object.entries(S)){let C,E;if(Array.isArray(k)?[C,E]=k:(C=k.mimeType,E=k.data),P.includes(".")){console.warn(`Skipping attachment '${P}' for run ${w.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}l.push({name:`attachment.${w.id}.${P}`,payload:new Blob([E],{type:`${C}; length=${E.byteLength}`})})}}}u.push(`trace=${w.trace_id},id=${w.id}`)}await this._sendMultipartRequest(l,u.join("; "))}async _sendMultipartRequest(e,t){try{const r="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=[];for(const u of e)s.push(new Blob([`--${r}\r
`])),s.push(new Blob([`Content-Disposition: form-data; name="${u.name}"\r
`,`Content-Type: ${u.payload.type}\r
\r
`])),s.push(u.payload),s.push(new Blob([`\r
`]));s.push(new Blob([`--${r}--\r
`]));const a=await new Blob(s).arrayBuffer(),o=await this.batchIngestCaller.call(Re(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${r}`},body:a,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(o,"ingest multipart runs",!0)}catch(r){console.warn(`${r.message.trim()}

Context: ${t}`)}}async updateRun(e,t){Ve(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:r}).catch(console.error);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(Re(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:cs(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(i,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){Ve(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let s;t.session_id?s=t.session_id:r!=null&&r.projectName?s=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?s=r==null?void 0:r.projectId:s=(await this.readProject({projectName:Do("PROJECT")||"default"})).id;const i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await YZ(this.listRuns({id:e.child_run_ids})),r={},s={};t.sort((i,a)=>((i==null?void 0:i.dotted_order)??"").localeCompare((a==null?void 0:a.dotted_order)??""));for(const i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in r||(r[i.parent_run_id]=[]),r[i.parent_run_id].push(i),s[i.id]=i}e.child_runs=r[e.id]||[];for(const i in r)i!==e.id&&(s[i].child_runs=r[i]);return e}async*listRuns(e){const{projectId:t,projectName:r,parentRunId:s,traceId:i,referenceExampleId:a,startTime:o,executionOrder:u,isRoot:l,runType:d,error:h,id:f,query:p,filter:m,traceFilter:g,treeFilter:y,limit:w,select:v}=e;let b=[];if(t&&(b=Array.isArray(t)?t:[t]),r){const C=Array.isArray(r)?r:[r],E=await Promise.all(C.map(M=>this.readProject({projectName:M}).then(I=>I.id)));b.push(...E)}const S=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],P={session:b.length?b:null,run_type:d,reference_example:a,query:p,filter:m,trace_filter:g,tree_filter:y,execution_order:u,parent_run:s,start_time:o?o.toISOString():null,error:h,id:f,limit:w,trace:i,select:v||S,is_root:l};let k=0;for await(const C of this._getCursorPaginatedList("/runs/query",P))if(w){if(k>=w)break;if(C.length+k>w){yield*C.slice(0,w-k);break}k+=C.length,yield*C}else yield*C}async getRunStats({id:e,trace:t,parentRun:r,runType:s,projectNames:i,projectIds:a,referenceExampleIds:o,startTime:u,endTime:l,error:d,query:h,filter:f,traceFilter:p,treeFilter:m,isRoot:g,dataSourceType:y}){let w=a||[];i&&(w=[...a||[],...await Promise.all(i.map(k=>this.readProject({projectName:k}).then(C=>C.id)))]);const b=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:s,session:w,reference_example:o,start_time:u,end_time:l,error:d,query:h,filter:f,trace_filter:p,tree_filter:m,is_root:g,data_source_type:y}).filter(([k,C])=>C!==void 0));return await(await this.caller.call(Re(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(b),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||Sn()};Ve(e);const i=await(await this.caller.call(Re(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){Ve(e);const t=await this.caller.call(Re(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(t,"unshare run",!0)}async readRunSharedLink(e){Ve(e);const r=await(await this.caller.call(Re(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const a of t)r.append("id",a);return Ve(e),await(await this.caller.call(Re(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),Ve(e);const s=await(await this.caller.call(Re(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};Ve(e);const i=await(await this.caller.call(Re(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){Ve(e);const t=await this.caller.call(Re(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(t,"unshare dataset",!0)}async readSharedDataset(e){return Ve(e),await(await this.caller.call(Re(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const r={};t!=null&&t.exampleIds&&(r.id=t.exampleIds);const s=new URLSearchParams;Object.entries(r).forEach(([o,u])=>{Array.isArray(u)?u.forEach(l=>s.append(o,l)):s.append(o,u)});const i=await this.caller.call(Re(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await i.json();if(!i.ok)throw"detail"in a?new Error(`Failed to list shared examples.
Status: ${i.status}
Message: ${a.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${i.status} ${i.statusText}`);return a.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:s=!1,projectExtra:i=null,referenceDatasetId:a=null}){const o=s?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,l=i||{};r&&(l.metadata=r);const d={name:e,extra:l,description:t};a!==null&&(d.reference_dataset_id=a);const h=await this.caller.call(Re(),u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(h,"create project"),await h.json()}async updateProject(e,{name:t=null,description:r=null,metadata:s=null,projectExtra:i=null,endTime:a=null}){const o=`${this.apiUrl}/sessions/${e}`;let u=i;s&&(u={...u||{},metadata:s});const l={name:t,extra:u,description:r,end_time:a?new Date(a).toISOString():null},d=await this.caller.call(Re(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(d,"update project"),await d.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ve(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const i=await this.caller.call(Re(),`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const a=await i.json();return i.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let s="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Ve(e),s+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&i.append("include_stats",r.toString());const a=await this._get(s,i);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:s,referenceDatasetName:i,referenceFree:a,metadata:o}={}){const u=new URLSearchParams;if(e!==void 0)for(const l of e)u.append("id",l);if(t!==void 0&&u.append("name",t),r!==void 0&&u.append("name_contains",r),s!==void 0)u.append("reference_dataset",s);else if(i!==void 0){const l=await this.readDataset({datasetName:i});u.append("reference_dataset",l.id)}a!==void 0&&u.append("reference_free",a.toString()),o!==void 0&&u.append("metadata",JSON.stringify(o));for await(const l of this._getPaginated("/sessions",u))yield*l}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,Ve(r);const s=await this.caller.call(Re(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(s,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:s,description:i,dataType:a,name:o}){const u=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach(f=>{l.append("input_keys",f)}),s.forEach(f=>{l.append("output_keys",f)}),i&&l.append("description",i),a&&l.append("data_type",a),o&&l.append("name",o);const d=await this.caller.call(Re(),u,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(d,"upload CSV"),await d.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:s,outputsSchema:i,metadata:a}={}){const o={name:e,description:t,extra:a?{metadata:a}:void 0};r&&(o.data_type=r),s&&(o.inputs_schema_definition=s),i&&(o.outputs_schema_definition=i);const u=await this.caller.call(Re(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(u,"create dataset"),await u.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)Ve(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(r,s);let a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:s}){let i=e;if(i===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:t})).id);const a=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:s,datasetNameContains:i,metadata:a}={}){const o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const l of r)u.append("id",l);s!==void 0&&u.append("name",s),i!==void 0&&u.append("name_contains",i),a!==void 0&&u.append("metadata",JSON.stringify(a));for await(const l of this._getPaginated(o,u))yield*l}async updateDataset(e){const{datasetId:t,datasetName:r,...s}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:r})).id;Ve(i);const a=await this.caller.call(Re(),`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(a,"update dataset"),await a.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:r,asOf:s,tag:i}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:r})).id;Ve(a);const o=await this.caller.call(Re(),`${this.apiUrl}/datasets/${a}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)Ve(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const i=await this.caller.call(Re(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(i,`delete ${r}`),await i.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),Ve(s);const i={tag:r},a=await this.caller.call(Re(),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(a,"index dataset"),await a.json()}async similarExamples(e,t,r,{filter:s}={}){const i={limit:r,inputs:e};s!==void 0&&(i.filter=s),Ve(t);const a=await this.caller.call(Re(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(a,"fetch similar examples"),(await a.json()).examples}async createExample(e,t,{datasetId:r,datasetName:s,createdAt:i,exampleId:a,metadata:o,split:u,sourceRunId:l}){let d=r;if(d===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(d!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");d===void 0&&(d=(await this.readDataset({datasetName:s})).id);const h=i||new Date,f={dataset_id:d,inputs:e,outputs:t,created_at:h==null?void 0:h.toISOString(),id:a,metadata:o,split:u,source_run_id:l},p=await this.caller.call(Re(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(p,"create example"),await p.json()}async createExamples(e){const{inputs:t,outputs:r,metadata:s,sourceRunIds:i,exampleIds:a,datasetId:o,datasetName:u}=e;let l=o;if(l===void 0&&u===void 0)throw new Error("Must provide either datasetName or datasetId");if(l!==void 0&&u!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");l===void 0&&(l=(await this.readDataset({datasetName:u})).id);const d=t.map((p,m)=>({dataset_id:l,inputs:p,outputs:r?r[m]:void 0,metadata:s?s[m]:void 0,split:e.splits?e.splits[m]:void 0,id:a?a[m]:void 0,source_run_id:i?i[m]:void 0})),h=await this.caller.call(Re(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(h,"create examples"),await h.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const s=e.map(a=>LN(a)?jN(a):a),i=LN(t)?jN(t):t;return this.createExample({input:s},{output:i},r)}async readExample(e){Ve(e);const t=`/examples/${e}`,r=await this._get(t),{attachment_urls:s,...i}=r,a=i;return s&&(a.attachments=Object.entries(s).reduce((o,[u,l])=>(o[u.slice(11)]={presigned_url:l.presigned_url,mime_type:l.mime_type},o),{})),a}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:s,splits:i,inlineS3Urls:a,metadata:o,limit:u,offset:l,filter:d,includeAttachments:h}={}){let f;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)f=e;else if(t!==void 0)f=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const p=new URLSearchParams({dataset:f}),m=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;m&&p.append("as_of",m);const g=a??!0;if(p.append("inline_s3_urls",g.toString()),r!==void 0)for(const w of r)p.append("id",w);if(i!==void 0)for(const w of i)p.append("splits",w);if(o!==void 0){const w=JSON.stringify(o);p.append("metadata",w)}u!==void 0&&p.append("limit",u.toString()),l!==void 0&&p.append("offset",l.toString()),d!==void 0&&p.append("filter",d),h===!0&&["attachment_urls","outputs","metadata"].forEach(w=>p.append("select",w));let y=0;for await(const w of this._getPaginated("/examples",p)){for(const v of w){const{attachment_urls:b,...S}=v,P=S;b&&(P.attachments=Object.entries(b).reduce((k,[C,E])=>(k[C.slice(11)]={presigned_url:E.presigned_url,mime_type:E.mime_type||void 0},k),{})),yield P,y++}if(u!==void 0&&y>=u)break}}async deleteExample(e){Ve(e);const t=`/examples/${e}`,r=await this.caller.call(Re(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(r,`delete ${t}`),await r.json()}async updateExample(e,t){Ve(e);const r=await this.caller.call(Re(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(r,"update example"),await r.json()}async updateExamples(e){const t=await this.caller.call(Re(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(t,"update examples"),await t.json()}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:s}){let i;if(e?i=e:i=(await this.readDataset({datasetName:t})).id,Ve(i),r&&s||!r&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const a=new URLSearchParams;r!==void 0&&a.append("as_of",typeof r=="string"?r:r.toISOString()),s!==void 0&&a.append("tag",s);const o=await this.caller.call(Re(),`${this.apiUrl}/datasets/${i}/version?${a.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,Ve(s);const i=new URLSearchParams,a=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return a&&i.append("as_of",a),await this._get(`/datasets/${s}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:s,remove:i=!1}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,Ve(a);const o={split_name:r,examples:s.map(l=>(Ve(l),l)),remove:i},u=await this.caller.call(Re(),`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(u,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:s,referenceExample:i}={loadChildRuns:!1}){BN("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(i=await this.readExample(a.reference_example_id));const o=await t.evaluateRun(a,i),[u,l]=await this._logEvaluationFeedback(o,a,r);return l[0]}async createFeedback(e,t,{score:r,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:l,feedbackId:d,feedbackConfig:h,projectId:f,comparativeExperimentId:p}){var v;if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");const m={type:u??"api",metadata:o??{}};l!==void 0&&(m==null?void 0:m.metadata)!==void 0&&!m.metadata.__run&&(m.metadata.__run={run_id:l}),(m==null?void 0:m.metadata)!==void 0&&((v=m.metadata.__run)==null?void 0:v.run_id)!==void 0&&Ve(m.metadata.__run.run_id);const g={id:d??Sn(),run_id:e,key:t,score:r,value:s,correction:i,comment:a,feedback_source:m,comparative_experiment_id:p,feedbackConfig:h,session_id:f},y=`${this.apiUrl}/feedback`,w=await this.caller.call(Re(),y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(g),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(w,"create feedback",!0),g}async updateFeedback(e,{score:t,value:r,correction:s,comment:i}){const a={};t!=null&&(a.score=t),r!=null&&(a.value=r),s!=null&&(a.correction=s),i!=null&&(a.comment=i),Ve(e);const o=await this.caller.call(Re(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(o,"update feedback",!0)}async readFeedback(e){Ve(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){Ve(e);const t=`/feedback/${e}`,r=await this.caller.call(Re(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(const i of t)s.append("key",i);if(r)for(const i of r)s.append("source",i);for await(const i of this._getPaginated("/feedback",s))yield*i}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:s}={}){const i={run_id:e,feedback_key:t,feedback_config:s};return r?typeof r=="string"?i.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(i.expires_in=r):i.expires_in={hours:3},await(await this.caller.call(Re(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:s,description:i,metadata:a,id:o}){var d;if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const u={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:i,created_at:(d=s??new Date)==null?void 0:d.toISOString(),extra:{}};return a&&(u.extra.metadata=a),await(await this.caller.call(Re(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){Ve(e);const t=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}async _logEvaluationFeedback(e,t,r){const s=this._selectEvalResults(e),i=[];for(const a of s){let o=r||{};a.evaluatorInfo&&(o={...a.evaluatorInfo,...o});let u=null;a.targetRunId?u=a.targetRunId:t&&(u=t.id),i.push(await this.createFeedback(u,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[s,i]}async logEvaluationFeedback(e,t,r){const[s]=await this._logEvaluationFeedback(e,t,r);return s}async*listAnnotationQueues(e={}){const{queueIds:t,name:r,nameContains:s,limit:i}=e,a=new URLSearchParams;t&&t.forEach((u,l)=>{Ve(u,`queueIds[${l}]`),a.append("ids",u)}),r&&a.append("name",r),s&&a.append("name_contains",s),a.append("limit",(i!==void 0?Math.min(i,100):100).toString());let o=0;for await(const u of this._getPaginated("/annotation-queues",a))if(yield*u,o++,i!==void 0&&o>=i)break}async createAnnotationQueue(e){const{name:t,description:r,queueId:s}=e,i={name:t,description:r,id:s||Sn()},a=await this.caller.call(Re(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(i).filter(([u,l])=>l!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(a,"create annotation queue"),await a.json()}async readAnnotationQueue(e){const t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){const{name:r,description:s}=t,i=await this.caller.call(Re(),`${this.apiUrl}/annotation-queues/${Ve(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:s}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(i,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(Re(),`${this.apiUrl}/annotation-queues/${Ve(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const r=await this.caller.call(Re(),`${this.apiUrl}/annotation-queues/${Ve(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((s,i)=>Ve(s,`runIds[${i}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const r=`/annotation-queues/${Ve(e,"queueId")}/run`,s=await this.caller.call(Re(),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(s,"get run from annotation queue"),await s.json()}async deleteRunFromAnnotationQueue(e,t){const r=await this.caller.call(Re(),`${this.apiUrl}/annotation-queues/${Ve(e,"queueId")}/runs/${Ve(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(r,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(Re(),`${this.apiUrl}/annotation-queues/${Ve(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(Re(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){const s=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),i=new Error(`Error ${t.status}: ${t.statusText}
${s}`);throw i.statusCode=t.status,i}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[r,s,i]=jo(e),a=await this.caller.call(Re(),`${this.apiUrl}/likes/${r}/${s}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(a,`${t?"like":"unlike"} prompt`),await a.json()}async _getPromptUrl(e){const[t,r,s]=jo(e);if(await this._currentTenantIsOwner(t)){const i=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${r}/${s.substring(0,8)}?organizationId=${i.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${i.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const r of this._getPaginated("/repos",t,s=>s.repos))yield*r}async getPrompt(e){const[t,r,s]=jo(e),i=await this.caller.call(Re(),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(i.status===404)return null;await We(i,"get prompt");const a=await i.json();return a.repo?a.repo:null}async createPrompt(e,t){const r=await this._getSettings();if(t!=null&&t.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,i,a]=jo(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:i,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},u=await this.caller.call(Re(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(u,"create prompt");const{repo:l}=await u.json();return l}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,i,a]=jo(e),o=(r==null?void 0:r.parentCommitHash)==="latest"||!(r!=null&&r.parentCommitHash)?await this._getLatestCommitHash(`${s}/${i}`):r==null?void 0:r.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},l=await this.caller.call(Re(),`${this.apiUrl}/commits/${s}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(l,"create commit");const d=await l.json();return this._getPromptUrl(`${s}/${i}${d.commit_hash?`:${d.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const r=new FormData;for(const a of t){const o=a.id,u={...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split}},l=cs(u),d=new Blob([l],{type:"application/json"});if(r.append(o,d),a.inputs){const h=cs(a.inputs),f=new Blob([h],{type:"application/json"});r.append(`${o}.inputs`,f)}if(a.outputs){const h=cs(a.outputs),f=new Blob([h],{type:"application/json"});r.append(`${o}.outputs`,f)}if(a.attachments)for(const[h,f]of Object.entries(a.attachments)){let p,m;Array.isArray(f)?[p,m]=f:(p=f.mimeType,m=f.data);const g=new Blob([m],{type:`${p}; length=${m.byteLength}`});r.append(`${o}.attachment.${h}`,g)}if(a.attachments_operations){const h=cs(a.attachments_operations),f=new Blob([h],{type:"application/json"});r.append(`${o}.attachments_operations`,f)}}return await(await this.caller.call(Re(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"PATCH",headers:this.headers,body:r})).json()}async uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const r=new FormData;for(const a of t){const o=(a.id??Sn()).toString(),u={created_at:a.created_at,...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split}},l=cs(u),d=new Blob([l],{type:"application/json"});r.append(o,d);const h=cs(a.inputs),f=new Blob([h],{type:"application/json"});if(r.append(`${o}.inputs`,f),a.outputs){const p=cs(a.outputs),m=new Blob([p],{type:"application/json"});r.append(`${o}.outputs`,m)}if(a.attachments)for(const[p,m]of Object.entries(a.attachments)){let g,y;Array.isArray(m)?[g,y]=m:(g=m.mimeType,y=m.data);const w=new Blob([y],{type:`${g}; length=${y.byteLength}`});r.append(`${o}.attachment.${p}`,w)}}return await(await this.caller.call(Re(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:r})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,s]=jo(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const i={};if((t==null?void 0:t.description)!==void 0&&(i.description=t.description),(t==null?void 0:t.readme)!==void 0&&(i.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(i.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(i.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(i.is_archived=t.isArchived),Object.keys(i).length===0)throw new Error("No valid update options provided");const a=await this.caller.call(Re(),`${this.apiUrl}/repos/${r}/${s}`,{method:"PATCH",body:JSON.stringify(i),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await We(a,"update prompt"),a.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,r,s]=jo(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(Re(),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[r,s,i]=jo(e),a=await this.caller.call(Re(),`${this.apiUrl}/commits/${r}/${s}/${i}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await We(a,"pull prompt commit");const o=await a.json();return{owner:r,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const r=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:r=this.apiUrl,datasetName:s}=t,[i,a]=this.parseTokenOrUrl(e,r),o=new Em({apiUrl:i,apiKey:"placeholder"}),u=await o.readSharedDataset(a),l=s||u.name;try{if(await this.hasDataset({datasetId:l})){console.log(`Dataset ${l} already exists in your tenant. Skipping.`);return}}catch{}const d=await o.listSharedExamples(a),h=await this.createDataset(l,{description:u.description,dataType:u.data_type||"kv",inputsSchema:u.inputs_schema_definition??void 0,outputsSchema:u.outputs_schema_definition??void 0});try{await this.createExamples({inputs:d.map(f=>f.inputs),outputs:d.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:h.id})}catch(f){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),f}}parseTokenOrUrl(e,t,r=2,s="dataset"){try{return Ve(e),[t,e]}catch{}try{const a=new URL(e).pathname.split("/").filter(o=>o!=="");if(a.length>=r){const o=a[a.length-r];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}const jF="0.3.4";let Ma;const n7=()=>typeof window<"u"&&typeof window.document<"u",s7=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",i7=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),DF=()=>typeof Deno<"u",a7=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!DF(),o7=()=>Ma||(n7()?Ma="browser":a7()?Ma="node":s7()?Ma="webworker":i7()?Ma="jsdom":DF()?Ma="deno":Ma="other",Ma);let XC;function BF(){if(XC===void 0){const n=o7(),e=l7();XC={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:jF,...e}}return XC}function c7(){const n=u7()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,s]of Object.entries(n))(r.startsWith("LANGCHAIN_")||r.startsWith("LANGSMITH_"))&&typeof s=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[r]=s);return e}function u7(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function gu(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:void 0}catch{return}}function Do(n){return gu(`LANGSMITH_${n}`)||gu(`LANGCHAIN_${n}`)}let YC;function l7(){if(YC!==void 0)return YC;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=gu(t);r!==void 0&&(e[t]=r)}return YC=e,e}const d7=n=>!!["TRACING_V2","TRACING"].find(t=>Do(t)==="true"),QC=Symbol.for("lc:context_variables");function h7(n){return n.replace(/[-:.]/g,"")}function f7(n,e,t=1){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return h7(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}class Qb{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){const t=e.split(",");let r={},s=[];for(const i of t){const[a,o]=i.split("="),u=decodeURIComponent(o);a==="langsmith-metadata"?r=JSON.parse(u):a==="langsmith-tags"&&(s=u.split(","))}return new Qb(r,s)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class us{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),UF(e)){Object.assign(this,{...e});return}const t=us.getDefaultConfig(),{metadata:r,...s}=e,i=s.client??us.getSharedClient(),a={...r,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:a},Object.assign(this,{...t,...s,client:i}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const u=f7(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+u:this.dotted_order=u}}static getDefaultConfig(){return{id:Sn(),run_type:"chain",project_name:Do("PROJECT")??gu("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:gu("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:gu("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return us.sharedClient||(us.sharedClient=new Em),us.sharedClient}createChild(e){var u,l,d,h,f,p;const t=this.child_execution_order+1,r=new us({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});QC in this&&(r[QC]=this[QC]);const s=Symbol.for("lc:child_config"),i=((u=e.extra)==null?void 0:u[s])??this.extra[s];if(m7(i)){const m={...i},g=p7(m.callbacks)?(d=(l=m.callbacks).copy)==null?void 0:d.call(l):void 0;g&&(Object.assign(g,{_parentRunId:r.id}),(p=(f=(h=g.handlers)==null?void 0:h.find(qF))==null?void 0:f.updateFromRunTree)==null||p.call(f,r),m.callbacks=g),r.extra[s]=m}const a=new Set;let o=this;for(;o!=null&&!a.has(o.id);)a.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,r=!0){var u;const s=e.extra??{};if(s.runtime||(s.runtime={}),t)for(const[l,d]of Object.entries(t))s.runtime[l]||(s.runtime[l]=d);let i,a;return r?(a=(u=e.parent_run)==null?void 0:u.id,i=[]):(i=e.child_runs.map(l=>this._convertToCreate(l,t,r)),a=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{const t=BF(),r=await this._convertToCreate(this,t,!0);if(await this.client.createRun(r),!e){BN("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const s of this.child_runs)await s.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){var l,d,h,f;const r=e==null?void 0:e.callbacks;let s,i,a,o=d7();if(r){const p=((l=r==null?void 0:r.getParentRunId)==null?void 0:l.call(r))??"",m=(d=r==null?void 0:r.handlers)==null?void 0:d.find(g=>(g==null?void 0:g.name)=="langchain_tracer");s=(h=m==null?void 0:m.getRun)==null?void 0:h.call(m,p),i=m==null?void 0:m.projectName,a=m==null?void 0:m.client,o=o||!!m}return s?new us({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:a,tracingEnabled:o,project_name:i,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(f=s==null?void 0:s.extra)==null?void 0:f.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new us({...t,client:a,tracingEnabled:o,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var l;const r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=r["langsmith-trace"];if(!s||typeof s!="string")return;const i=s.trim(),a=i.split(".").map(d=>{const[h,f]=d.split("Z");return{strTime:h,time:Date.parse(h+"Z"),uuid:f}}),o=a[0].uuid,u={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(l=a.at(-1))==null?void 0:l.uuid,trace_id:o,dotted_order:i};if(r.baggage&&typeof r.baggage=="string"){const d=Qb.fromHeader(r.baggage);u.metadata=d.metadata,u.tags=d.tags}return new us(u)}toHeaders(e){var r;const t={"langsmith-trace":this.dotted_order,baggage:new Qb((r=this.extra)==null?void 0:r.metadata,this.tags).toHeader()};if(e)for(const[s,i]of Object.entries(t))e.set(s,i);return t}}Object.defineProperty(us,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function UF(n){return n!==void 0&&typeof n.createChild=="function"&&typeof n.postRun=="function"}function qF(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function HF(n){return Array.isArray(n)&&n.some(e=>qF(e))}function p7(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function m7(n){var e;return n!==void 0&&typeof n.callbacks=="object"&&(HF((e=n.callbacks)==null?void 0:e.handlers)||HF(n.callbacks))}let g7=class{getStore(){}run(e,t){return t()}};const eP=Symbol.for("ls:tracing_async_local_storage"),y7=new g7;let w7=class{getInstance(){return globalThis[eP]??y7}initializeGlobalInstance(e){globalThis[eP]===void 0&&(globalThis[eP]=e)}};const v7=new w7,_7=()=>{const n=v7.getInstance().getStore();if(!UF(n))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join(`
`));return n};function tP(n){return typeof n=="function"&&"langsmith:traceable"in n}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const b7=Object.prototype.hasOwnProperty;function rP(n,e){return b7.call(n,e)}function nP(n){if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)rP(n,t)&&e.push(t);return e}function zi(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function sP(n){let e=0;const t=n.length;let r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Nd(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function S7(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function iP(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(iP(n[t]))return!0}else if(typeof n=="object"){const t=nP(n),r=t.length;for(var e=0;e<r;e++)if(iP(n[t[e]]))return!0}}return!1}function KF(n,e){const t=[n];for(const r in e){const s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&t.push(`${r}: ${s}`)}return t.join(`
`)}class x7 extends Error{constructor(e,t,r,s,i){super(KF(e,{name:t,index:r,operation:s,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=KF(e,{name:t,index:r,operation:s,tree:i})}}const hr=x7,Fd={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=aP(t,this.path);r&&(r=zi(r));const s=km(t,{op:"remove",path:this.from}).removed;return km(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:r}},copy:function(n,e,t){const r=aP(t,this.from);return km(t,{op:"add",path:this.path,value:zi(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:t0(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}};var E7={add:function(n,e,t){return sP(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:Fd.move,copy:Fd.copy,test:Fd.test,_get:Fd._get};function aP(n,e){if(e=="")return n;var t={op:"_get",path:e};return km(n,t),t.value}function km(n,e,t=!1,r=!0,s=!0,i=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):oP(e,0)),e.path===""){let a={newDocument:n};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=n,a;if(e.op==="move"||e.op==="copy")return a.newDocument=aP(n,e.from),e.op==="move"&&(a.removed=n),a;if(e.op==="test"){if(a.test=t0(n,e.value),a.test===!1)throw new hr("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return a.newDocument=n,a}else{if(e.op==="remove")return a.removed=n,a.newDocument=null,a;if(e.op==="_get")return e.value=n,a;if(t)throw new hr("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,n);return a}}else{r||(n=zi(n));const o=(e.path||"").split("/");let u=n,l=1,d=o.length,h,f,p;for(typeof t=="function"?p=t:p=oP;;){if(f=o[l],f&&f.indexOf("~")!=-1&&(f=S7(f)),s&&(f=="__proto__"||f=="prototype"&&l>0&&o[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&h===void 0&&(u[f]===void 0?h=o.slice(0,l).join("/"):l==d-1&&(h=e.path),h!==void 0&&p(e,0,n,h)),l++,Array.isArray(u)){if(f==="-")f=u.length;else{if(t&&!sP(f))throw new hr("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,n);sP(f)&&(f=~~f)}if(l>=d){if(t&&e.op==="add"&&f>u.length)throw new hr("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,n);const m=E7[e.op].call(e,u,f,n);if(m.test===!1)throw new hr("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return m}}else if(l>=d){const m=Fd[e.op].call(e,u,f,n);if(m.test===!1)throw new hr("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return m}if(u=u[f],t&&l<d&&(!u||typeof u!="object"))throw new hr("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,n)}}}function e0(n,e,t,r=!0,s=!0){if(t&&!Array.isArray(e))throw new hr("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=zi(n));const i=new Array(e.length);for(let a=0,o=e.length;a<o;a++)i[a]=km(n,e[a],t,!0,s,a),n=i[a].newDocument;return i.newDocument=n,i}function oP(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new hr("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(Fd[n.op]){if(typeof n.path!="string")throw new hr("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new hr('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new hr("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new hr("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&iP(n.value))throw new hr("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var s=n.path.split("/").length,i=r.split("/").length;if(s!==i+1&&s!==i)throw new hr("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new hr("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var a={op:"_get",path:n.from,value:void 0},o=k7([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new hr("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new hr("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function k7(n,e,t){try{if(!Array.isArray(n))throw new hr("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)e0(zi(e),zi(n),t||!0);else{t=t||oP;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(s){if(s instanceof hr)return s;throw s}}function t0(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),s,i,a;if(t&&r){if(i=n.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!t0(n[s],e[s]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(i=o.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=i;s--!==0;)if(a=o[s],!t0(n[a],e[a]))return!1;return!0}return n!==n&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function WF(n,e,t,r,s){if(e!==n){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=nP(e),a=nP(n),o=!1,u=a.length-1;u>=0;u--){var l=a[u],d=n[l];if(rP(e,l)&&!(e[l]===void 0&&d!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof d=="object"&&d!=null&&typeof h=="object"&&h!=null&&Array.isArray(d)===Array.isArray(h)?WF(d,h,t,r+"/"+Nd(l),s):d!==h&&(s&&t.push({op:"test",path:r+"/"+Nd(l),value:zi(d)}),t.push({op:"replace",path:r+"/"+Nd(l),value:zi(h)}))}else Array.isArray(n)===Array.isArray(e)?(s&&t.push({op:"test",path:r+"/"+Nd(l),value:zi(d)}),t.push({op:"remove",path:r+"/"+Nd(l)}),o=!0):(s&&t.push({op:"test",path:r,value:n}),t.push({op:"replace",path:r,value:e}))}if(!(!o&&i.length==a.length))for(var u=0;u<i.length;u++){var l=i[u];!rP(n,l)&&e[l]!==void 0&&t.push({op:"add",path:r+"/"+Nd(l),value:zi(e[l])})}}}function C7(n,e,t=!1){var r=[];return WF(n,e,r,"",t),r}const P7=()=>typeof window<"u"&&typeof window.document<"u",A7=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",T7=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),cP=()=>typeof Deno<"u",I7=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!cP(),O7=()=>{let n;return P7()?n="browser":I7()?n="node":A7()?n="webworker":T7()?n="jsdom":cP()?n="deno":n="other",n};let uP;async function R7(){return uP===void 0&&(uP={library:"langchain-js",runtime:O7()}),uP}function sn(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:cP()?Deno==null?void 0:Deno.env.get(n):void 0}catch{return}}class M7{}function $7(n){return"lc_prefer_streaming"in n&&n.lc_prefer_streaming}class Cm extends M7{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,bN(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:sn("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return fu.prototype.toJSON.call(this)}toJSONNotImplemented(){return fu.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends Cm{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Sn()}),Object.assign(this,e)}}return new t}}const N7=n=>{const e=n;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};function lP(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function F7(n){return n.replace(/[-:.]/g,"")}function L7(n,e,t){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return F7(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function Pm(n){return typeof n._addRunToRunMap=="function"}class Am extends Cm{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=L7(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){const s=this.runMap.get(r.parent_run_id);s&&(this._addChildRun(s,r),s.child_execution_order=Math.max(s.child_execution_order,r.child_execution_order),r.trace_id=s.trace_id,s.dotted_order!==void 0&&(r.dotted_order=[s.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;return this.runMap.set(r.id,r),r}async _endTrace(e){var r;const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((r=this.onRunUpdate)==null?void 0:r.call(this,e))}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,s,i,a,o,u){const l=this._getExecutionOrder(s),d=Date.now(),h=o?{...i,metadata:o}:i,f={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:h??{},tags:a||[]};return this._addRunToRunMap(f)}async handleLLMStart(e,t,r,s,i,a,o,u){var d,h;const l=this.runMap.get(r)??this._createRunForLLMStart(e,t,r,s,i,a,o,u);return await((d=this.onRunCreate)==null?void 0:d.call(this,l)),await((h=this.onLLMStart)==null?void 0:h.call(this,l)),l}_createRunForChatModelStart(e,t,r,s,i,a,o,u){const l=this._getExecutionOrder(s),d=Date.now(),h=o?{...i,metadata:o}:i,f={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:h??{},tags:a||[]};return this._addRunToRunMap(f)}async handleChatModelStart(e,t,r,s,i,a,o,u){var d,h;const l=this.runMap.get(r)??this._createRunForChatModelStart(e,t,r,s,i,a,o,u);return await((d=this.onRunCreate)==null?void 0:d.call(this,l)),await((h=this.onLLMStart)==null?void 0:h.call(this,l)),l}async handleLLMEnd(e,t,r,s,i){var o;const a=this.runMap.get(t);if(!a||(a==null?void 0:a.run_type)!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await((o=this.onLLMEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleLLMError(e,t,r,s,i){var o;const a=this.runMap.get(t);if(!a||(a==null?void 0:a.run_type)!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await((o=this.onLLMError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForChainStart(e,t,r,s,i,a,o,u){const l=this._getExecutionOrder(s),d=Date.now(),h={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(h)}async handleChainStart(e,t,r,s,i,a,o,u){var d,h;const l=this.runMap.get(r)??this._createRunForChainStart(e,t,r,s,i,a,o,u);return await((d=this.onRunCreate)==null?void 0:d.call(this,l)),await((h=this.onChainStart)==null?void 0:h.call(this,l)),l}async handleChainEnd(e,t,r,s,i){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=lP(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=lP(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleChainError(e,t,r,s,i){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=lP(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForToolStart(e,t,r,s,i,a,o){const u=this._getExecutionOrder(s),l=Date.now(),d={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(d)}async handleToolStart(e,t,r,s,i,a,o){var l,d;const u=this.runMap.get(r)??this._createRunForToolStart(e,t,r,s,i,a,o);return await((l=this.onRunCreate)==null?void 0:l.call(this,u)),await((d=this.onToolStart)==null?void 0:d.call(this,u)),u}async handleToolEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleToolError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,r))}async handleAgentEnd(e,t){var s;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,r)))}_createRunForRetrieverStart(e,t,r,s,i,a,o){const u=this._getExecutionOrder(s),l=Date.now(),d={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(d)}async handleRetrieverStart(e,t,r,s,i,a,o){var l,d;const u=this.runMap.get(r)??this._createRunForRetrieverStart(e,t,r,s,i,a,o);return await((l=this.onRunCreate)==null?void 0:l.call(this,u)),await((d=this.onRetrieverStart)==null?void 0:d.call(this,u)),u}async handleRetrieverEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleText(e,t){var s;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,r)))}async handleLLMNewToken(e,t,r,s,i,a){var u;const o=this.runMap.get(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a==null?void 0:a.chunk}}),await((u=this.onLLMNewToken)==null?void 0:u.call(this,o,e,{chunk:a==null?void 0:a.chunk})),o}}var r0={exports:{}};r0.exports;var zF;function j7(){return zF||(zF=1,function(n){const t=(i=0)=>a=>`\x1B[${38+i};5;${a}m`,r=(i=0)=>(a,o,u)=>`\x1B[${38+i};2;${a};${o};${u}m`;function s(){const i=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,u]of Object.entries(a)){for(const[l,d]of Object.entries(u))a[l]={open:`\x1B[${d[0]}m`,close:`\x1B[${d[1]}m`},u[l]=a[l],i.set(d[0],d[1]);Object.defineProperty(a,o,{value:u,enumerable:!1})}return Object.defineProperty(a,"codes",{value:i,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=t(),a.color.ansi16m=r(),a.bgColor.ansi256=t(10),a.bgColor.ansi16m=r(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,u,l)=>o===u&&u===l?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(u/255*5)+Math.round(l/255*5),enumerable:!1},hexToRgb:{value:o=>{const u=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!u)return[0,0,0];let{colorString:l}=u.groups;l.length===3&&(l=l.split("").map(h=>h+h).join(""));const d=Number.parseInt(l,16);return[d>>16&255,d>>8&255,d&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(n,"exports",{enumerable:!0,get:s})}(r0)),r0.exports}var D7=j7();const VF=Qe(D7);function En(n,e){return`${n.open}${e}${n.close}`}function Rs(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function GF(n){return typeof n=="string"?n.trim():n==null?n:Rs(n,n.toString())}function Bo(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:jn}=VF;class ZF extends Am{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const s=this.runMap.get(r.parent_run_id);if(s)t.push(s),r=s;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((s,i,a)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?En(VF.bold,o):o}).join(" > ");return En(jn.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${En(jn.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Rs(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${En(jn.cyan,"[chain/end]")} [${t}] [${Bo(e)}] Exiting Chain run with output: ${Rs(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${En(jn.red,"[chain/error]")} [${t}] [${Bo(e)}] Chain run errored with error: ${Rs(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${En(jn.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Rs(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${En(jn.cyan,"[llm/end]")} [${t}] [${Bo(e)}] Exiting LLM run with output: ${Rs(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${En(jn.red,"[llm/error]")} [${t}] [${Bo(e)}] LLM run errored with error: ${Rs(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${En(jn.green,"[tool/start]")} [${t}] Entering Tool run with input: "${GF(e.inputs.input)}"`)}onToolEnd(e){var r;const t=this.getBreadcrumbs(e);console.log(`${En(jn.cyan,"[tool/end]")} [${t}] [${Bo(e)}] Exiting Tool run with output: "${GF((r=e.outputs)==null?void 0:r.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${En(jn.red,"[tool/error]")} [${t}] [${Bo(e)}] Tool run errored with error: ${Rs(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${En(jn.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Rs(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${En(jn.cyan,"[retriever/end]")} [${t}] [${Bo(e)}] Exiting Retriever run with output: ${Rs(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${En(jn.red,"[retriever/error]")} [${t}] [${Bo(e)}] Retriever run errored with error: ${Rs(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${En(jn.blue,"[agent/action]")} [${r}] Agent selected action: ${Rs(t.actions[t.actions.length-1],"[action]")}`)}}let dP;const B7=()=>{if(dP===void 0){const n=sn("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};dP=new Em(n)}return dP};class Tm extends Am{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:s}=e;this.projectName=r??sn("LANGCHAIN_PROJECT")??sn("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??B7();const i=Tm.getTraceableRunTree();i&&this.updateFromRunTree(i)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await R7()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();const s=[t];for(;s.length>0;){const i=s.shift();!i||r.has(i.id)||(r.add(i.id),this.runMap.set(i.id,i),i.child_runs&&s.push(...i.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},r=[];for(const[s,i]of this.runMap){const a=new us({...i,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[s]=a,r.push([s,i.dotted_order])}r.sort((s,i)=>!s[1]||!i[1]?0:s[1].localeCompare(i[1]));for(const[s]of r){const i=this.runMap.get(s),a=t[s];if(!(!i||!a)&&i.parent_run_id){const o=t[i.parent_run_id];o&&(o.child_runs.push(a),a.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return _7()}catch{return}}}const JF=Symbol.for("ls:tracing_async_local_storage"),n0=Symbol.for("lc:context_variables"),U7=n=>{globalThis[JF]=n},Im=()=>globalThis[JF];let Om;function q7(){const n="default"in Ra?Ra.default:Ra;return new n({autoStart:!0,concurrency:1})}function H7(){return typeof Om>"u"&&(Om=q7()),Om}async function vr(n,e){if(e===!0){const t=Im();t!==void 0?await t.run(void 0,async()=>n()):await n()}else Om=H7(),Om.add(async()=>{const t=Im();t!==void 0?await t.run(void 0,async()=>n()):await n()})}const K7=n=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>sn(t)==="true");function XF(n){var r;const e=Im();if(e===void 0)return;const t=e.getStore();return(r=t==null?void 0:t[n0])==null?void 0:r[n]}const W7=Symbol("lc:configure_hooks"),z7=()=>XF(W7)||[];class V7{setHandler(e){return this.setHandlers([e])}}class s0{constructor(e,t,r,s,i,a,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>vr(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,s,i){await Promise.all(this.handlers.map(a=>vr(async()=>{var o;try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,this.runId,this.tags,this.metadata))}catch(u){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}}class G7 extends s0{getChild(e){const t=new Dn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>vr(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw s}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>vr(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${s}`),t.raiseError)throw e}},t.awaitHandlers)))}}class YF extends s0{async handleLLMNewToken(e,t,r,s,i,a){await Promise.all(this.handlers.map(o=>vr(async()=>{var u;if(!o.ignoreLLM)try{await((u=o.handleLLMNewToken)==null?void 0:u.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(l){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${l}`),o.raiseError)throw l}},o.awaitHandlers)))}async handleLLMError(e,t,r,s,i){await Promise.all(this.handlers.map(a=>vr(async()=>{var o;if(!a.ignoreLLM)try{await((o=a.handleLLMError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMError: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}async handleLLMEnd(e,t,r,s,i){await Promise.all(this.handlers.map(a=>vr(async()=>{var o;if(!a.ignoreLLM)try{await((o=a.handleLLMEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMEnd: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}}class Z7 extends s0{getChild(e){const t=new Dn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,s,i){await Promise.all(this.handlers.map(a=>vr(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}async handleChainEnd(e,t,r,s,i){await Promise.all(this.handlers.map(a=>vr(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>vr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>vr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class J7 extends s0{getChild(e){const t=new Dn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>vr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>vr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class Dn extends V7{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,s=void 0,i=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(l,d)=>{const h=d===0&&r?r:Sn();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Pm(f)&&f._createRunForLLMStart(e,[l],h,this._parentRunId,i,this.tags,this.metadata,u),vr(async()=>{var p;try{await((p=f.handleLLMStart)==null?void 0:p.call(f,e,[l],h,this._parentRunId,i,this.tags,this.metadata,u))}catch(m){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${m}`),f.raiseError)throw m}},f.awaitHandlers)})),new YF(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,s=void 0,i=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(l,d)=>{const h=d===0&&r?r:Sn();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Pm(f)&&f._createRunForChatModelStart(e,[l],h,this._parentRunId,i,this.tags,this.metadata,u),vr(async()=>{var p,m;try{if(f.handleChatModelStart)await((p=f.handleChatModelStart)==null?void 0:p.call(f,e,[l],h,this._parentRunId,i,this.tags,this.metadata,u));else if(f.handleLLMStart){const g=EN(l);await((m=f.handleLLMStart)==null?void 0:m.call(f,e,[g],h,this._parentRunId,i,this.tags,this.metadata,u))}}catch(g){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${g}`),f.raiseError)throw g}},f.awaitHandlers)})),new YF(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=Sn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreChain)return Pm(u)&&u._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,s,o),vr(async()=>{var l;try{await((l=u.handleChainStart)==null?void 0:l.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,s,o))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new Z7(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=Sn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return Pm(u)&&u._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),vr(async()=>{var l;try{await((l=u.handleToolStart)==null?void 0:l.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new J7(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=Sn(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return Pm(u)&&u._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),vr(async()=>{var l;try{await((l=u.handleRetrieverStart)==null?void 0:l.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new G7(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,s,i){await Promise.all(this.handlers.map(a=>vr(async()=>{var o;if(!a.ignoreCustomEvent)try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,r,this.tags,this.metadata))}catch(u){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new Dn(this._parentRunId);for(const s of this.handlers){const i=this.inheritableHandlers.includes(s);r.addHandler(s,i)}for(const s of this.tags){const i=this.inheritableTags.includes(s);r.addTags([s],i)}for(const s of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(s);r.addMetadata({[s]:this.metadata[s]},i)}for(const s of e)r.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||r.addHandler(s,t);return r}static fromHandlers(e){class t extends Cm{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Sn()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static configure(e,t,r,s,i,a,o){return this._configureSync(e,t,r,s,i,a,o)}static _configureSync(e,t,r,s,i,a,o){var f,p;let u;(e||t)&&(Array.isArray(e)||!e?(u=new Dn,u.setHandlers((e==null?void 0:e.map(i0))??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(i0):t==null?void 0:t.handlers,!1));const l=sn("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),d=((f=Tm.getTraceableRunTree())==null?void 0:f.tracingEnabled)||K7(),h=d||(sn("LANGCHAIN_TRACING")??!1);if(l||h){if(u||(u=new Dn),l&&!u.handlers.some(m=>m.name===ZF.prototype.name)){const m=new ZF;u.addHandler(m,!0)}if(h&&!u.handlers.some(m=>m.name==="langchain_tracer")&&d){const m=new Tm;u.addHandler(m,!0),u._parentRunId=((p=Tm.getTraceableRunTree())==null?void 0:p.id)??u._parentRunId}}for(const{contextVar:m,inheritable:g=!0,handlerClass:y,envVar:w}of z7()){const v=w&&sn(w)==="true"&&y;let b;const S=m!==void 0?XF(m):void 0;S&&N7(S)?b=S:v&&(b=new y({})),b!==void 0&&(u||(u=new Dn),u.handlers.some(P=>P.name===b.name)||u.addHandler(b,g))}return(r||s)&&u&&(u.addTags(r??[]),u.addTags(s??[],!1)),(i||a)&&u&&(u.addMetadata(i??{}),u.addMetadata(a??{},!1)),u}}function i0(n){return"name"in n?n:Cm.fromMethods(n)}class X7{getStore(){}run(e,t){return t()}enterWith(e){}}const Y7=new X7,QF=Symbol.for("lc:child_config");class Q7{getInstance(){return Im()??Y7}getRunnableConfig(){var t,r;return(r=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:r[QF]}runWithConfig(e,t,r){var d;const s=Dn._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),i=this.getInstance(),a=i.getStore(),o=s==null?void 0:s.getParentRunId(),u=(d=s==null?void 0:s.handlers)==null?void 0:d.find(h=>(h==null?void 0:h.name)==="langchain_tracer");let l;return u&&o?l=u.convertToRunTree(o):r||(l=new us({name:"<runnable_lambda>",tracingEnabled:!1})),l&&(l.extra={...l.extra,[QF]:e}),a!==void 0&&a[n0]!==void 0&&(l[n0]=a[n0]),i.run(l,t)}initializeGlobalInstance(e){Im()===void 0&&U7(e)}}const Uo=new Q7,hP=25;async function si(n){return Dn._configureSync(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function eL(...n){const e={};for(const t of n.filter(r=>!!r))for(const r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){const s=e[r]??[];e[r]=[...new Set(s.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(r==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(r==="callbacks"){const s=e.callbacks,i=t.callbacks;if(Array.isArray(i))if(!s)e.callbacks=i;else if(Array.isArray(s))e.callbacks=s.concat(i);else{const a=s.copy();for(const o of i)a.addHandler(i0(o),!0);e.callbacks=a}else if(i)if(!s)e.callbacks=i;else if(Array.isArray(s)){const a=i.copy();for(const o of s)a.addHandler(i0(o),!0);e.callbacks=a}else e.callbacks=new Dn(i._parentRunId,{handlers:s.handlers.concat(i.handlers),inheritableHandlers:s.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(i.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(i.inheritableTags))),metadata:{...s.metadata,...i.metadata}})}else{const s=r;e[s]=t[s]??e[s]}return e}const eJ=new Set(["string","number","boolean"]);function Pt(n){var r;const e=Uo.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:i,...a}=e;t=Object.entries(a).reduce((o,[u,l])=>(l!==void 0&&(o[u]=l),o),t)}if(n&&(t=Object.entries(n).reduce((s,[i,a])=>(a!==void 0&&(s[i]=a),s),t)),t!=null&&t.configurable)for(const s of Object.keys(t.configurable))eJ.has(typeof t.configurable[s])&&!((r=t.metadata)!=null&&r[s])&&(t.metadata||(t.metadata={}),t.metadata[s]=t.configurable[s]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const s=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,s])):t.signal=s,delete t.timeout}return t}function an(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:s,configurable:i,runId:a}={}){const o=Pt(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),i!==void 0&&(o.configurable={...o.configurable,...i}),a!==void 0&&delete o.runId,o}function Ld(n){return n?{configurable:n.configurable,recursionLimit:n.recursionLimit,callbacks:n.callbacks,tags:n.tags,metadata:n.metadata,maxConcurrency:n.maxConcurrency,timeout:n.timeout,signal:n.signal}:void 0}async function qo(n,e){if(e===void 0)return n;let t;return Promise.race([n.catch(r=>{if(!(e!=null&&e.aborted))throw r}),new Promise((r,s)=>{t=()=>{s(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class ls extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new ls({start(r){return s();function s(){return t.read().then(({done:i,value:a})=>{if(i){r.close();return}return r.enqueue(a),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new ls({async pull(t){const{value:r,done:s}=await e.next();s&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function tL(n,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){const i=await n.next();for(const a of t)a.push(i)}else{if(s[0].done)return;yield s.shift().value}})}function Ms(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){const t={...n};for(const[r,s]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=Ms(t[r],s):t[r]=s;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}class jd{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((r,s)=>{Uo.runWithConfig(Ld(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(r,s):this.firstResult.then(i=>r(void 0),s)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?Uo.runWithConfig(Ld(this.config),this.signal?async()=>qo(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function tJ(n,e,t,r,...s){const i=new jd({generator:e,startSetup:t,signal:r}),a=await i.setup;return{output:n(i,a,...s),setup:a}}class Ho{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),r=e0({},t);return new Rm({ops:t,state:r[r.length-1].newDocument})}}class Rm extends Ho{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=e0(this.state,e.ops);return new Rm({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const t=e0({},e.ops);return new Rm({ops:e.ops,state:t[t.length-1].newDocument})}}const rJ=n=>n.name==="log_stream_tracer";async function rL(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function nL(n,e){const{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function nJ(n){return n!==void 0&&n.message!==void 0}class sL extends Am{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ls.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),r}async*tapOutputIterable(e,t){for await(const r of t){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new Ho({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Ho({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await rL(e,this._schemaFormat)),await this.writer.write(new Ho({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await rL(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await nL(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const s=new Ho({ops:r});await this.writer.write(s)}finally{if(e.id===this.rootId){const t=new Ho({ops:[{op:"replace",path:"/final_output",value:await nL(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const i=e.inputs.messages!==void 0;let a;i?nJ(r==null?void 0:r.chunk)?a=r==null?void 0:r.chunk:a=new wr({id:`run-${e.id}`,content:t}):a=t;const o=new Ho({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:a}]});await this.writer.write(o)}}const iL="__run";class Dd{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Dd({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class ds extends Dd{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new ds({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function a0({name:n,serialized:e}){return n!==void 0?n:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const sJ=n=>n.name==="event_stream_tracer";class iJ extends Am{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ls.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),r}async*tapOutputIterable(e,t){const r=await t.next();if(r.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield r.value;return}function i(o,u){return o==="llm"&&typeof u=="string"?new Dd({text:u}):u}let a=this.tappedPromises.get(e);if(a===void 0){let o;a=new Promise(u=>{o=u}),this.tappedPromises.set(e,a);try{const u={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...u,data:{chunk:i(s.runType,r.value)}},s),yield r.value;for await(const l of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...u,data:{chunk:i(s.runType,l)}},s),yield l}finally{o()}}else{yield r.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var a,o;const t=a0(e),r=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,s);const i=`on_${r}_start`;await this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,t,r){const s=this.runInfoMap.get(e.id);let i,a;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")a="on_chat_model_stream",(r==null?void 0:r.chunk)===void 0?i=new wr({content:t,id:`run-${e.id}`}):i=r.chunk.message;else if(s.runType==="llm")a="on_llm_stream",(r==null?void 0:r.chunk)===void 0?i=new Dd({text:t}):i=r.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:a,data:{chunk:i},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var a,o,u;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(a=e.outputs)==null?void 0:a.generations;let i;if(t.runType==="chat_model"){for(const l of s??[]){if(i!==void 0)break;i=(o=l[0])==null?void 0:o.message}r="on_chat_model_end"}else if(t.runType==="llm")i={generations:s==null?void 0:s.map(l=>l.map(d=>({text:d.text,generationInfo:d.generationInfo}))),llmOutput:((u=e.outputs)==null?void 0:u.llmOutput)??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:r,data:{output:i,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var a,o;const t=a0(e),r=e.run_type??"chain",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:e.run_type};let i={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(i={},s.inputs={}):e.inputs.input!==void 0?(i.input=e.inputs.input,s.inputs=e.inputs.input):(i.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${r}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},a={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(a.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:r,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var s,i;const t=a0(e),r={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{}},r)}async onToolEnd(e){var s;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var i,a;const t=a0(e),s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((a=e.extra)==null?void 0:a.metadata)??{}},s)}async onRetrieverEnd(e){var r;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((r=e.outputs)==null?void 0:r.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){const s=this.runInfoMap.get(r);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const aJ=[400,401,402,403,404,405,406,407,409],oJ=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&aJ.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const s=new Error(n==null?void 0:n.message);throw s.name="InsufficientQuotaError",s}};class fP{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??oJ;const t="default"in Ra?Ra.default:Ra;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Ub(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class aL extends Am{constructor({config:e,onStart:t,onEnd:r,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function pP(n){return n?n.lc_runnable:!1}class cJ{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const s=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||s.some(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&s.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),r}}const uJ=Symbol("Let zodToJsonSchema decide on which parser to use"),lJ={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},dJ=n=>({...lJ,...n}),hJ=n=>{const e=dJ(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function oL(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function Ot(n,e,t,r,s){n[e]=t,oL(n,e,r,s)}function fJ(){return{}}function pJ(n,e){var r,s,i;const t={type:"array"};return(r=n.type)!=null&&r._def&&((i=(s=n.type)==null?void 0:s._def)==null?void 0:i.typeName)!==Q.ZodAny&&(t.items=At(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&Ot(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&Ot(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(Ot(t,"minItems",n.exactLength.value,n.exactLength.message,e),Ot(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function mJ(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Ot(t,"minimum",r.value,r.message,e):Ot(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Ot(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ot(t,"maximum",r.value,r.message,e):Ot(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Ot(t,"maximum",r.value,r.message,e));break;case"multipleOf":Ot(t,"multipleOf",r.value,r.message,e);break}return t}function gJ(){return{type:"boolean"}}function cL(n,e){return At(n.type._def,e)}const yJ=(n,e)=>At(n.innerType._def,e);function uL(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,i)=>uL(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return wJ(n,e)}}const wJ=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":Ot(t,"minimum",r.value,r.message,e);break;case"max":Ot(t,"maximum",r.value,r.message,e);break}return t};function vJ(n,e){return{...At(n.innerType._def,e),default:n.defaultValue()}}function _J(n,e){return e.effectStrategy==="input"?At(n.schema._def,e):{}}function bJ(n){return{type:"string",enum:Array.from(n.values)}}const SJ=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function xJ(n,e){const t=[At(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),At(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(SJ(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...u}=i;a=u}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function EJ(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let mP;const ii={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(mP===void 0&&(mP=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),mP),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function lL(n,e){const t={type:"string"};if(n.checks)for(const r of n.checks)switch(r.kind){case"min":Ot(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":Ot(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":ai(t,"email",r.message,e);break;case"format:idn-email":ai(t,"idn-email",r.message,e);break;case"pattern:zod":kn(t,ii.email,r.message,e);break}break;case"url":ai(t,"uri",r.message,e);break;case"uuid":ai(t,"uuid",r.message,e);break;case"regex":kn(t,r.regex,r.message,e);break;case"cuid":kn(t,ii.cuid,r.message,e);break;case"cuid2":kn(t,ii.cuid2,r.message,e);break;case"startsWith":kn(t,RegExp(`^${gP(r.value,e)}`),r.message,e);break;case"endsWith":kn(t,RegExp(`${gP(r.value,e)}$`),r.message,e);break;case"datetime":ai(t,"date-time",r.message,e);break;case"date":ai(t,"date",r.message,e);break;case"time":ai(t,"time",r.message,e);break;case"duration":ai(t,"duration",r.message,e);break;case"length":Ot(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),Ot(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{kn(t,RegExp(gP(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&ai(t,"ipv4",r.message,e),r.version!=="v4"&&ai(t,"ipv6",r.message,e);break}case"base64url":kn(t,ii.base64url,r.message,e);break;case"jwt":kn(t,ii.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&kn(t,ii.ipv4Cidr,r.message,e),r.version!=="v4"&&kn(t,ii.ipv6Cidr,r.message,e);break}case"emoji":kn(t,ii.emoji(),r.message,e);break;case"ulid":{kn(t,ii.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{ai(t,"binary",r.message,e);break}case"contentEncoding:base64":{Ot(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{kn(t,ii.base64,r.message,e);break}}break}case"nanoid":kn(t,ii.nanoid,r.message,e)}return t}function gP(n,e){return e.patternStrategy==="escape"?CJ(n):n}const kJ=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function CJ(n){let e="";for(let t=0;t<n.length;t++)kJ.has(n[t])||(e+="\\"),e+=n[t];return e}function ai(n,e,t,r){var s;n.format||(s=n.anyOf)!=null&&s.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):Ot(n,"format",e,t,r)}function kn(n,e,t,r){var s;n.pattern||(s=n.allOf)!=null&&s.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:dL(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):Ot(n,"pattern",dL(e,r),t,r)}function dL(n,e){var u;if(!e.applyRegexFlags||!n.flags)return n.source;const t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source;let s="",i=!1,a=!1,o=!1;for(let l=0;l<r.length;l++){if(i){s+=r[l],i=!1;continue}if(t.i){if(a){if(r[l].match(/[a-z]/)){o?(s+=r[l],s+=`${r[l-2]}-${r[l]}`.toUpperCase(),o=!1):r[l+1]==="-"&&((u=r[l+2])!=null&&u.match(/[a-z]/))?(s+=r[l],o=!0):s+=`${r[l]}${r[l].toUpperCase()}`;continue}}else if(r[l].match(/[a-z]/)){s+=`[${r[l]}${r[l].toUpperCase()}]`;continue}}if(t.m){if(r[l]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[l]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&r[l]==="."){s+=a?`${r[l]}\r
`:`[${r[l]}\r
]`;continue}s+=r[l],r[l]==="\\"?i=!0:a&&r[l]==="]"?a=!1:!a&&r[l]==="["&&(a=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return s}function hL(n,e){var r,s,i,a,o,u;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===Q.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((l,d)=>({...l,[d]:At(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",d]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:At(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((s=n.keyType)==null?void 0:s._def.typeName)===Q.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const{type:l,...d}=lL(n.keyType._def,e);return{...t,propertyNames:d}}else{if(((a=n.keyType)==null?void 0:a._def.typeName)===Q.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(((o=n.keyType)==null?void 0:o._def.typeName)===Q.ZodBranded&&n.keyType._def.type._def.typeName===Q.ZodString&&((u=n.keyType._def.type._def.checks)!=null&&u.length)){const{type:l,...d}=cL(n.keyType._def,e);return{...t,propertyNames:d}}}return t}function PJ(n,e){if(e.mapStrategy==="record")return hL(n,e);const t=At(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=At(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function AJ(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function TJ(){return{not:{}}}function IJ(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const o0={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function OJ(n,e){if(e.target==="openApi3")return fL(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in o0&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((s,i)=>{const a=o0[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return fL(n,e)}const fL=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>At(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function RJ(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:o0[n.innerType._def.typeName],nullable:!0}:{type:[o0[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=At(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=At(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function MJ(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",oL(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Ot(t,"minimum",r.value,r.message,e):Ot(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Ot(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ot(t,"maximum",r.value,r.message,e):Ot(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Ot(t,"maximum",r.value,r.message,e));break;case"multipleOf":Ot(t,"multipleOf",r.value,r.message,e);break}return t}function $J(n,e){const t=e.target==="openAi",r={type:"object",properties:{}},s=[],i=n.shape();for(const o in i){let u=i[o];if(u===void 0||u._def===void 0)continue;let l=FJ(u);l&&t&&(u instanceof ti&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),l=!1);const d=At(u._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});d!==void 0&&(r.properties[o]=d,l||s.push(o))}s.length&&(r.required=s);const a=NJ(n,e);return a!==void 0&&(r.additionalProperties=a),r}function NJ(n,e){if(n.catchall._def.typeName!=="ZodNever")return At(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function FJ(n){try{return n.isOptional()}catch{return!0}}const LJ=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return At(n.innerType._def,e);const t=At(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},jJ=(n,e)=>{if(e.pipeStrategy==="input")return At(n.in._def,e);if(e.pipeStrategy==="output")return At(n.out._def,e);const t=At(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=At(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}};function DJ(n,e){return At(n.type._def,e)}function BJ(n,e){const r={type:"array",uniqueItems:!0,items:At(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&Ot(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&Ot(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function UJ(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>At(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:At(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>At(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function qJ(){return{not:{}}}function HJ(){return{}}const KJ=(n,e)=>At(n.innerType._def,e),WJ=(n,e,t)=>{switch(e){case Q.ZodString:return lL(n,t);case Q.ZodNumber:return MJ(n,t);case Q.ZodObject:return $J(n,t);case Q.ZodBigInt:return mJ(n,t);case Q.ZodBoolean:return gJ();case Q.ZodDate:return uL(n,t);case Q.ZodUndefined:return qJ();case Q.ZodNull:return IJ(t);case Q.ZodArray:return pJ(n,t);case Q.ZodUnion:case Q.ZodDiscriminatedUnion:return OJ(n,t);case Q.ZodIntersection:return xJ(n,t);case Q.ZodTuple:return UJ(n,t);case Q.ZodRecord:return hL(n,t);case Q.ZodLiteral:return EJ(n,t);case Q.ZodEnum:return bJ(n);case Q.ZodNativeEnum:return AJ(n);case Q.ZodNullable:return RJ(n,t);case Q.ZodOptional:return LJ(n,t);case Q.ZodMap:return PJ(n,t);case Q.ZodSet:return BJ(n,t);case Q.ZodLazy:return()=>n.getter()._def;case Q.ZodPromise:return DJ(n,t);case Q.ZodNaN:case Q.ZodNever:return TJ();case Q.ZodEffects:return _J(n,t);case Q.ZodAny:return fJ();case Q.ZodUnknown:return HJ();case Q.ZodDefault:return vJ(n,t);case Q.ZodBranded:return cL(n,t);case Q.ZodReadonly:return KJ(n,t);case Q.ZodCatch:return yJ(n,t);case Q.ZodPipeline:return jJ(n,t);case Q.ZodFunction:case Q.ZodVoid:case Q.ZodSymbol:return;default:return(r=>{})()}};function At(n,e,t=!1){var o;const r=e.seen.get(n);if(e.override){const u=(o=e.override)==null?void 0:o.call(e,n,e,r,t);if(u!==uJ)return u}if(r&&!t){const u=zJ(r,e);if(u!==void 0)return u}const s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);const i=WJ(n,n.typeName,e),a=typeof i=="function"?At(i(),e):i;if(a&&GJ(n,e,a),e.postProcess){const u=e.postProcess(a,n,e);return s.jsonSchema=a,u}return s.jsonSchema=a,a}const zJ=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:VJ(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},VJ=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},GJ=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),$a=(n,e)=>{const t=hJ(e),r=void 0,s=e==null?void 0:e.name,i=At(n._def,t,!1)??{},a=s===void 0?r?{...i,[t.definitionPath]:r}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...r,[s]:i}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function yP(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}const ZJ=["*","_","`"];function JJ(n){let e="";for(const[t,r]of Object.entries(n))e+=`	classDef ${t} ${r};
`;return e}function XJ(n,e,t){const{firstNode:r,lastNode:s,nodeColors:i,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=t??{};let l=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){const p="default",m={[p]:"{0}({1})"};r!==void 0&&(m[r]="{0}([{1}]):::first"),s!==void 0&&(m[s]="{0}([{1}]):::last");for(const[g,y]of Object.entries(n)){const w=y.name.split(":").pop()??"";let b=ZJ.some(P=>w.startsWith(P)&&w.endsWith(P))?`<p>${w}</p>`:w;Object.keys(y.metadata??{}).length&&(b+=`<hr/><small><em>${Object.entries(y.metadata??{}).map(([P,k])=>`${P} = ${k}`).join(`
`)}</em></small>`);const S=(m[g]??m[p]).replace("{0}",yP(g)).replace("{1}",b);l+=`	${S}
`}}const d={};for(const p of e){const m=p.source.split(":"),g=p.target.split(":"),y=m.filter((w,v)=>w===g[v]).join(":");d[y]||(d[y]=[]),d[y].push(p)}const h=new Set;function f(p,m){const g=p.length===1&&p[0].source===p[0].target;if(m&&!g){const y=m.split(":").pop();if(h.has(y))throw new Error(`Found duplicate subgraph '${y}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);h.add(y),l+=`	subgraph ${y}
`}for(const y of p){const{source:w,target:v,data:b,conditional:S}=y;let P="";if(b!==void 0){let k=b;const C=k.split(" ");C.length>u&&(k=Array.from({length:Math.ceil(C.length/u)},(E,M)=>C.slice(M*u,(M+1)*u).join(" ")).join("&nbsp;<br>&nbsp;")),P=S?` -. &nbsp;${k}&nbsp; .-> `:` -- &nbsp;${k}&nbsp; --> `}else P=S?" -.-> ":" --> ";l+=`	${yP(w)}${P}${yP(v)};
`}for(const y in d)y.startsWith(`${m}:`)&&y!==m&&f(d[y],y);m&&!g&&(l+=`	end
`)}f(d[""]??[],"");for(const p in d)!p.includes(":")&&p!==""&&f(d[p],p);return a&&(l+=JJ(i??{})),l}async function YJ(n,e){let{backgroundColor:t="white"}=e??{};const r=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const s=`https://mermaid.ink/img/${r}?bgColor=${t}`,i=await fetch(s);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join(`
`));return await i.blob()}function QJ(n,e){if(n!==void 0&&!bm(n))return n;if(pP(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function eX(n){return pP(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...$a(n.data.schema),title:n.data.name}}}class c0{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=bm(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...eX(t)})),edges:this.edges.map(t=>{const r={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(r.data=t.data),typeof t.conditional<"u"&&(r.conditional=t.conditional),r})}}addNode(e,t,r){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const s=t??Sn(),i={id:s,data:e,name:QJ(t,e),metadata:r};return this.nodes[s]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const i={source:e.id,target:t.id,data:r,conditional:s};return this.edges.push(i),i}firstNode(){return pL(this)}lastNode(){return mL(this)}extend(e,t=""){let r=t;Object.values(e.nodes).map(l=>l.id).every(bm)&&(r="");const i=l=>r?`${r}:${l}`:l;Object.entries(e.nodes).forEach(([l,d])=>{this.nodes[i(l)]={...d,id:i(l)}});const a=e.edges.map(l=>({...l,source:i(l.source),target:i(l.target)}));this.edges=[...this.edges,...a];const o=e.firstNode(),u=e.lastNode();return[o?{id:i(o.id),data:o.data}:void 0,u?{id:i(u.id),data:u.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&pL(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&mL(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),t=new Map;Object.values(e).forEach(s=>{t.set(s,(t.get(s)||0)+1)});const r=s=>{const i=e[s];return bm(s)&&t.get(i)===1?i:s};return new c0({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,i])=>[r(s),{...i,id:r(s)}])),edges:this.edges.map(s=>({...s,source:r(s.source),target:r(s.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:r,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:i}=e??{},a=this.reid(),o=a.firstNode(),u=a.lastNode();return XJ(a.nodes,a.edges,{firstNode:o==null?void 0:o.id,lastNode:u==null?void 0:u.id,withStyles:t,curveStyle:r,nodeColors:s,wrapLabelNWords:i})}async drawMermaidPng(e){const t=this.drawMermaid(e);return YJ(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function pL(n,e=[]){const t=new Set(n.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),r=[];for(const s of Object.values(n.nodes))!e.includes(s.id)&&!t.has(s.id)&&r.push(s);return r.length===1?r[0]:void 0}function mL(n,e=[]){const t=new Set(n.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),r=[];for(const s of Object.values(n.nodes))!e.includes(s.id)&&!t.has(s.id)&&r.push(s);return r.length===1?r[0]:void 0}function tX(n){const e=new TextEncoder,t=new ReadableStream({async start(r){for await(const s of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return ls.fromReadableStream(t)}function gL(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}const rX=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function";function wP(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*yL(n,e){for(;;){const{value:t,done:r}=Uo.runWithConfig(Ld(n),e.next.bind(e),!0);if(r)break;yield t}}async function*vP(n,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:r,done:s}=await Uo.runWithConfig(Ld(n),t.next.bind(e),!0);if(s)break;yield r}}function Fr(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}class _r extends fu{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new yu({bound:this,kwargs:e,config:{}})}map(){return new u0({bound:this})}withRetry(e){return new nX({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new yu({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new iX({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Pt);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,i)=>Pt(i===0?e:r))}return Array.from({length:t},()=>Pt(e))}async batch(e,t,r){var u;const s=this._getOptionsList(t??{},e.length),i=((u=s[0])==null?void 0:u.maxConcurrency)??(r==null?void 0:r.maxConcurrency),a=new fP({maxConcurrency:i,onFailedAttempt:l=>{throw l}}),o=e.map((l,d)=>a.call(async()=>{try{return await this.invoke(l,s[d])}catch(h){if(r!=null&&r.returnExceptions)return h;throw h}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const r=Pt(t),s=new jd({generator:this._streamIterator(e,r),config:r});return await s.setup,ls.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=Pt(e):t=Pt({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){const s=Pt(r),i=await si(s),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),Fr(t,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{const u=e.call(this,t,s,a);o=await qo(u,r==null?void 0:r.signal)}catch(u){throw await(a==null?void 0:a.handleChainError(u)),u}return await(a==null?void 0:a.handleChainEnd(Fr(o,"output"))),o}async _batchWithConfig(e,t,r,s){var l;const i=this._getOptionsList(r??{},t.length),a=await Promise.all(i.map(si)),o=await Promise.all(a.map(async(d,h)=>{const f=await(d==null?void 0:d.handleChainStart(this.toJSON(),Fr(t[h],"input"),i[h].runId,i[h].runType,void 0,void 0,i[h].runName??this.getName()));return delete i[h].runId,f}));let u;try{const d=e.call(this,t,i,o,s);u=await qo(d,(l=i==null?void 0:i[0])==null?void 0:l.signal)}catch(d){throw await Promise.all(o.map(h=>h==null?void 0:h.handleChainError(d))),d}return await Promise.all(o.map(d=>d==null?void 0:d.handleChainEnd(Fr(u,"output")))),u}async*_transformStreamWithConfig(e,t,r){let s,i=!0,a,o=!0;const u=Pt(r),l=await si(u);async function*d(){for await(const f of e){if(i)if(s===void 0)s=f;else try{s=Ms(s,f)}catch{s=void 0,i=!1}yield f}}let h;try{const f=await tJ(t.bind(this),d(),async()=>l==null?void 0:l.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),r==null?void 0:r.signal,u);delete u.runId,h=f.setup;const p=h==null?void 0:h.handlers.find(sJ);let m=f.output;p!==void 0&&h!==void 0&&(m=p.tapOutputIterable(h.runId,m));const g=h==null?void 0:h.handlers.find(rJ);g!==void 0&&h!==void 0&&(m=g.tapOutputIterable(h.runId,m));for await(const y of m)if(yield y,o)if(a===void 0)a=y;else try{a=Ms(a,y)}catch{a=void 0,o=!1}}catch(f){throw await(h==null?void 0:h.handleChainError(f,void 0,void 0,void 0,{inputs:Fr(s,"input")})),f}await(h==null?void 0:h.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:Fr(s,"input")}))}getGraph(e){const t=new c0,r=t.addNode({name:`${this.getName()}Input`,schema:ge.any()}),s=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:ge.any()});return t.addEdge(r,s),t.addEdge(s,i),t}pipe(e){return new hs({first:this,last:wu(e)})}pick(e){return this.pipe(new aX(e))}assign(e){return this.pipe(new wL(new Bd({steps:e})))}async*transform(e,t){let r;for await(const s of e)r===void 0?r=s:r=Ms(r,s);yield*this._streamIterator(r,Pt(t))}async*streamLog(e,t,r){const s=new sL({...r,autoClose:!1,_schemaFormat:"original"}),i=Pt(t);yield*this._streamLog(e,s,i)}async*_streamLog(e,t,r){const{callbacks:s}=r;if(s===void 0)r.callbacks=[t];else if(Array.isArray(s))r.callbacks=s.concat([t]);else{const u=s.copy();u.addHandler(t,!0),r.callbacks=u}const i=this.stream(e,r);async function a(){try{const u=await i;for await(const l of u){const d=new Ho({ops:[{op:"add",path:"/streamed_output/-",value:l}]});await t.writer.write(d)}}finally{await t.writer.close()}}const o=a();try{for await(const u of t)yield u}finally{await o}}streamEvents(e,t,r){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,r);else if(t.version==="v2")s=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?tX(s):ls.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,r){var m;const s=new iJ({...r,autoClose:!1}),i=Pt(t),a=i.runId??Sn();i.runId=a;const o=i.callbacks;if(o===void 0)i.callbacks=[s];else if(Array.isArray(o))i.callbacks=o.concat(s);else{const g=o.copy();g.addHandler(s,!0),i.callbacks=g}const u=new AbortController,l=this;async function d(){try{let g;t!=null&&t.signal?"any"in AbortSignal?g=AbortSignal.any([u.signal,t.signal]):(g=t.signal,t.signal.addEventListener("abort",()=>{u.abort()},{once:!0})):g=u.signal;const y=await l.stream(e,{...i,signal:g}),w=s.tapOutputIterable(a,y);for await(const v of w)if(u.signal.aborted)break}finally{await s.finish()}}const h=d();let f=!1,p;try{for await(const g of s){if(!f){g.data.input=e,f=!0,p=g.run_id,yield g;continue}g.run_id===p&&g.event.endsWith("_end")&&(m=g.data)!=null&&m.input&&delete g.data.input,yield g}}finally{u.abort(),await h}}async*_streamEventsV1(e,t,r){let s,i=!1;const a=Pt(t),o=a.tags??[],u=a.metadata??{},l=a.runName??this.getName(),d=new sL({...r,autoClose:!1,_schemaFormat:"streaming_events"}),h=new cJ({...r}),f=this._streamLog(e,d,a);for await(const m of f){if(s?s=s.concat(m):s=Rm.fromRunLogPatch(m),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;const v={...s.state},b={run_id:v.id,event:`on_${v.type}_start`,name:l,tags:o,metadata:u,data:{input:e}};h.includeEvent(b,v.type)&&(yield b)}const g=m.ops.filter(v=>v.path.startsWith("/logs/")).map(v=>v.path.split("/")[2]),y=[...new Set(g)];for(const v of y){let b,S={};const P=s.state.logs[v];if(P.end_time===void 0?P.streamed_output.length>0?b="stream":b="start":b="end",b==="start")P.inputs!==void 0&&(S.input=P.inputs);else if(b==="end")P.inputs!==void 0&&(S.input=P.inputs),S.output=P.final_output;else if(b==="stream"){const k=P.streamed_output.length;if(k!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${k} instead. Encountered in: "${P.name}"`);S={chunk:P.streamed_output[0]},P.streamed_output=[]}yield{event:`on_${P.type}_${b}`,name:P.name,run_id:P.id,tags:P.tags,metadata:P.metadata,data:S}}const{state:w}=s;if(w.streamed_output.length>0){const v=w.streamed_output.length;if(v!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${v} instead. Encountered in: "${w.name}"`);const b={chunk:w.streamed_output[0]};w.streamed_output=[];const S={event:`on_${w.type}_stream`,run_id:w.id,tags:o,metadata:u,name:l,data:b};h.includeEvent(S,w.type)&&(yield S)}}const p=s==null?void 0:s.state;if(p!==void 0){const m={event:`on_${p.type}_end`,name:l,run_id:p.id,tags:o,metadata:u,data:{output:p.final_output}};h.includeEvent(m,p.type)&&(yield m)}}static isRunnable(e){return pP(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new yu({bound:this,config:{},configFactories:[s=>({callbacks:[new aL({config:s,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return oX(this,e)}}class yu extends _r{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=eL(this.config,...e);return eL(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Pt(t),this.kwargs))}async batch(e,t,r){const s=Array.isArray(t)?await Promise.all(t.map(async i=>this._mergeConfig(Pt(i),this.kwargs))):await this._mergeConfig(Pt(t),this.kwargs);return this.bound.batch(e,s,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Pt(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Pt(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Pt(t),this.kwargs))}streamEvents(e,t,r){const s=this,i=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(Pt(t),s.kwargs),version:t.version},r)};return ls.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&_r.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new yu({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new aL({config:s,onStart:e,onEnd:t,onError:r})]})]})}}class u0 extends _r{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new u0({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,an(t,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new u0({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class nX extends yu{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const s=e>1?`retry:attempt:${e}`:void 0;return an(t,{callbacks:r==null?void 0:r.getChild(s)})}async _invoke(e,t,r){return Ub(s=>super.invoke(e,this._patchConfigForRetry(s,t,r)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,s){const i={};try{await Ub(async a=>{const o=e.map((f,p)=>p).filter(f=>i[f.toString()]===void 0||i[f.toString()]instanceof Error),u=o.map(f=>e[f]),l=o.map(f=>this._patchConfigForRetry(a,t==null?void 0:t[f],r==null?void 0:r[f])),d=await super.batch(u,l,{...s,returnExceptions:!0});let h;for(let f=0;f<d.length;f+=1){const p=d[f],m=o[f];p instanceof Error&&h===void 0&&(h=p,h.input=u[f]),i[m.toString()]=p}if(h)throw h;return d},{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((s==null?void 0:s.returnExceptions)!==!0)throw a}return Object.keys(i).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>i[parseInt(a,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class hs extends _r{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var u;const r=Pt(t),s=await si(r),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),Fr(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let a=e,o;try{const l=[this.first,...this.middle];for(let d=0;d<l.length;d+=1){const f=l[d].invoke(a,an(r,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${d+1}`)}));a=await qo(f,t==null?void 0:t.signal)}if((u=t==null?void 0:t.signal)!=null&&u.aborted)throw new Error("Aborted");o=await this.last.invoke(a,an(r,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(l){throw await(i==null?void 0:i.handleChainError(l)),l}return await(i==null?void 0:i.handleChainEnd(Fr(o,"output"))),o}async batch(e,t,r){var u;const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(si)),a=await Promise.all(i.map(async(l,d)=>{const h=await(l==null?void 0:l.handleChainStart(this.toJSON(),Fr(e[d],"input"),s[d].runId,void 0,void 0,void 0,s[d].runName));return delete s[d].runId,h}));let o=e;try{for(let l=0;l<this.steps.length;l+=1){const h=this.steps[l].batch(o,a.map((f,p)=>{const m=f==null?void 0:f.getChild(this.omitSequenceTags?void 0:`seq:step:${l+1}`);return an(s[p],{callbacks:m})}),r);o=await qo(h,(u=s[0])==null?void 0:u.signal)}}catch(l){throw await Promise.all(a.map(d=>d==null?void 0:d.handleChainError(l))),l}return await Promise.all(a.map(l=>l==null?void 0:l.handleChainEnd(Fr(o,"output")))),o}async*_streamIterator(e,t){var h;const r=await si(t),{runId:s,...i}=t??{},a=await(r==null?void 0:r.handleChainStart(this.toJSON(),Fr(e,"input"),s,void 0,void 0,void 0,i==null?void 0:i.runName)),o=[this.first,...this.middle,this.last];let u=!0,l;async function*d(){yield e}try{let f=o[0].transform(d(),an(i,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let p=1;p<o.length;p+=1)f=await o[p].transform(f,an(i,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${p+1}`)}));for await(const p of f)if((h=t==null?void 0:t.signal)==null||h.throwIfAborted(),yield p,u)if(l===void 0)l=p;else try{l=Ms(l,p)}catch{l=void 0,u=!1}}catch(f){throw await(a==null?void 0:a.handleChainError(f)),f}await(a==null?void 0:a.handleChainEnd(Fr(l,"output")))}getGraph(e){const t=new c0;let r=null;return this.steps.forEach((s,i)=>{const a=s.getGraph(e);i!==0&&a.trimFirstNode(),i!==this.steps.length-1&&a.trimLastNode(),t.extend(a);const o=a.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);r&&t.addEdge(r,o),r=a.lastNode()}),t}pipe(e){return hs.isRunnableSequence(e)?new hs({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new hs({first:this.first,middle:[...this.middle,this.last],last:wu(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&_r.isRunnable(e)}static from([e,...t],r){let s={};return typeof r=="string"?s.name=r:r!==void 0&&(s=r),new hs({...s,first:wu(e),middle:t.slice(0,-1).map(wu),last:wu(t[t.length-1])})}}class Bd extends _r{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=wu(r)}static from(e){return new Bd({steps:e})}async invoke(e,t){const r=Pt(t),s=await si(r),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const a={};try{const o=Object.entries(this.steps).map(async([u,l])=>{a[u]=await l.invoke(e,an(r,{callbacks:i==null?void 0:i.getChild(`map:key:${u}`)}))});await qo(Promise.all(o),t==null?void 0:t.signal)}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(a)),a}async*_transform(e,t,r){const s={...this.steps},i=tL(e,Object.keys(s).length),a=new Map(Object.entries(s).map(([o,u],l)=>{const d=u.transform(i[l],an(r,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,d.next().then(h=>({key:o,gen:d,result:h}))]}));for(;a.size;){const o=Promise.race(a.values()),{key:u,result:l,gen:d}=await qo(o,r==null?void 0:r.signal);a.delete(u),l.done||(yield{[u]:l.value},a.set(u,d.next().then(h=>({key:u,gen:d,result:h}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=Pt(t),i=new jd({generator:this.transform(r(),s),config:s});return await i.setup,ls.fromAsyncGenerator(i)}}class _P extends _r{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!tP(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[r]=this._getOptionsList(t??{},1),s=await si(r),i=this.func(an(r,{callbacks:s}),e);return qo(i,r==null?void 0:r.signal)}async*_streamIterator(e,t){var i,a;const[r]=this._getOptionsList(t??{},1),s=await this.invoke(e,t);if(wP(s)){for await(const o of s)(i=r==null?void 0:r.signal)==null||i.throwIfAborted(),yield o;return}if(rX(s)){for(;;){(a=r==null?void 0:r.signal)==null||a.throwIfAborted();const o=s.next();if(o.done)break;yield o.value}return}yield s}static from(e){return new _P({func:e})}}function sX(n){if(tP(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class Mm extends _r{static lc_name(){return"RunnableLambda"}constructor(e){if(tP(e.func))return _P.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),sX(e.func),this.func=e.func}static from(e){return new Mm({func:e})}async _invoke(e,t,r){return new Promise((s,i)=>{const a=an(t,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??hP)-1});Uo.runWithConfig(Ld(a),async()=>{var o,u;try{let l=await this.func(e,{...a});if(l&&_r.isRunnable(l)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");l=await l.invoke(e,{...a,recursionLimit:(a.recursionLimit??hP)-1})}else if(wP(l)){let d;for await(const h of vP(a,l))if((o=t==null?void 0:t.signal)==null||o.throwIfAborted(),d===void 0)d=h;else try{d=Ms(d,h)}catch{d=h}l=d}else if(gL(l)){let d;for(const h of yL(a,l))if((u=t==null?void 0:t.signal)==null||u.throwIfAborted(),d===void 0)d=h;else try{d=Ms(d,h)}catch{d=h}l=d}s(l)}catch(l){i(l)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,r){var o,u;let s;for await(const l of e)if(s===void 0)s=l;else try{s=Ms(s,l)}catch{s=l}const i=an(r,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??hP)-1}),a=await new Promise((l,d)=>{Uo.runWithConfig(Ld(i),async()=>{try{const h=await this.func(s,{...i,config:i});l(h)}catch(h){d(h)}})});if(a&&_r.isRunnable(a)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const l=await a.stream(s,i);for await(const d of l)yield d}else if(wP(a))for await(const l of vP(i,a))(o=r==null?void 0:r.signal)==null||o.throwIfAborted(),yield l;else if(gL(a))for(const l of yL(i,a))(u=r==null?void 0:r.signal)==null||u.throwIfAborted(),yield l;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=Pt(t),i=new jd({generator:this.transform(r(),s),config:s});return await i.setup,ls.fromAsyncGenerator(i)}}class iX extends _r{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=Pt(t),s=await si(r),{runId:i,...a}=r,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),Fr(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName)),u=an(a,{callbacks:o==null?void 0:o.getChild()});return await Uo.runWithConfig(u,async()=>{var h;let d;for(const f of this.runnables()){(h=r==null?void 0:r.signal)==null||h.throwIfAborted();try{const p=await f.invoke(e,u);return await(o==null?void 0:o.handleChainEnd(Fr(p,"output"))),p}catch(p){d===void 0&&(d=p)}}throw d===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(d)),d)})}async*_streamIterator(e,t){var h;const r=Pt(t),s=await si(r),{runId:i,...a}=r,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),Fr(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName));let u,l;for(const f of this.runnables()){(h=r==null?void 0:r.signal)==null||h.throwIfAborted();const p=an(a,{callbacks:o==null?void 0:o.getChild()});try{const m=await f.stream(e,p);l=vP(p,m);break}catch(m){u===void 0&&(u=m)}}if(l===void 0){const f=u??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(f)),f}let d;try{for await(const f of l){yield f;try{d=d===void 0?d:Ms(d,f)}catch{d=void 0}}}catch(f){throw await(o==null?void 0:o.handleChainError(f)),f}await(o==null?void 0:o.handleChainEnd(Fr(d,"output")))}async batch(e,t,r){var u;if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(l=>si(l))),a=await Promise.all(i.map(async(l,d)=>{const h=await(l==null?void 0:l.handleChainStart(this.toJSON(),Fr(e[d],"input"),s[d].runId,void 0,void 0,void 0,s[d].runName));return delete s[d].runId,h}));let o;for(const l of this.runnables()){(u=s[0].signal)==null||u.throwIfAborted();try{const d=await l.batch(e,a.map((h,f)=>an(s[f],{callbacks:h==null?void 0:h.getChild()})),r);return await Promise.all(a.map((h,f)=>h==null?void 0:h.handleChainEnd(Fr(d[f],"output")))),d}catch(d){o===void 0&&(o=d)}}throw o?(await Promise.all(a.map(l=>l==null?void 0:l.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function wu(n){if(typeof n=="function")return new Mm({func:n});if(_r.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=wu(r);return new Bd({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class wL extends _r{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Bd&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const s=this.mapper.getStepsKeys(),[i,a]=tL(e),o=this.mapper.transform(a,an(r,{callbacks:t==null?void 0:t.getChild()})),u=o.next();for await(const l of i){if(typeof l!="object"||Array.isArray(l))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof l}`);const d=Object.fromEntries(Object.entries(l).filter(([h])=>!s.includes(h)));Object.keys(d).length>0&&(yield d)}yield(await u).value;for await(const l of o)yield l}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=Pt(t),i=new jd({generator:this.transform(r(),s),config:s});return await i.setup,ls.fromAsyncGenerator(i)}}class aX extends _r{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=Pt(t),i=new jd({generator:this.transform(r(),s),config:s});return await i.setup,ls.fromAsyncGenerator(i)}}class vL extends yu{constructor(e){const t=hs.from([Mm.from(async r=>{let s;if(xN(r))try{s=await this.schema.parseAsync(r.args)}catch{throw new J8("Received tool input did not match expected schema",JSON.stringify(r.args))}else s=r;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function oX(n,e){var s;const t=e.name??n.getName(),r=e.description??((s=e.schema)==null?void 0:s.description);return e.schema.constructor===ge.ZodString?new vL({name:t,description:r,schema:ge.object({input:ge.string()}).transform(i=>i.input),bound:n}):new vL({name:t,description:r,schema:e.schema,bound:n})}class cX{constructor(){this.messages=[],this.totalTokens=0}addMessage(e,t={inputTokens:0},r){const s={message:e,metadata:t};r===void 0?this.messages.push(s):this.messages.splice(r,0,s),this.totalTokens+=t.inputTokens}removeMessage(e=-1){if(this.messages.length>0){const t=this.messages.splice(e,1)[0];this.totalTokens-=t.metadata.inputTokens}}removeLastHumanMessage(){if(this.messages.length>2&&this.messages[this.messages.length-1].message instanceof Jt){const e=this.messages.pop();e&&(this.totalTokens-=e.metadata.inputTokens)}}}const $m=Xs("MessageManager");class bP{constructor({maxInputTokens:e=128e3,estimatedCharactersPerToken:t=3,imageTokens:r=800,sensitiveData:s}={}){this.maxInputTokens=e,this.history=new cX,this.estimatedCharactersPerToken=t,this.IMG_TOKENS=r,this.sensitiveData=s,this.toolId=1}initTaskMessages(e,t,r){if(this.addMessageWithTokens(e),r&&r.length>0){const h=new Jt({content:`Context for the task: ${r}`});this.addMessageWithTokens(h)}const s=bP.taskInstructions(t);if(this.addMessageWithTokens(s),this.sensitiveData){const h=`Here are placeholders for sensitive data: ${Object.keys(this.sensitiveData)}`,f=new Jt({content:`${h}
To use them, write <secret>the placeholder name</secret>`});this.addMessageWithTokens(f)}const i=new Jt({content:"Example output:"});this.addMessageWithTokens(i);const a=this.nextToolId(),o=[{name:"navigator_output",args:{current_state:{page_summary:"On the page are company a,b,c wtih their revenue 1,2,3.",evaluation_previous_goal:"Success - I opend the first page",memory:"Starting with the new task. I have completed 1/10 steps",next_goal:"Click on company a"},action:[{click_element:{index:0}}]},id:String(a),type:"tool_call"}],u=new nn({content:"example tool call",tool_calls:o});this.addMessageWithTokens(u);const l=new Db({content:"Browser started",tool_call_id:String(a)});this.addMessageWithTokens(l);const d=new Jt({content:"[Your task history memory starts here]"});this.addMessageWithTokens(d)}nextToolId(){const e=this.toolId;return this.toolId+=1,e}static taskInstructions(e){const t=`Your ultimate task is: """${e}""". If you achieved your ultimate task, stop everything and use the done action in the next step to complete the task. If not, continue as usual.`;return new Jt({content:t})}length(){return this.history.messages.length}addNewTask(e){const t=`Your new ultimate task is: """${e}""". Take the previous context into account and finish your new ultimate task. `,r=new Jt({content:t});this.addMessageWithTokens(r)}addPlan(e,t){if(e){const r=new nn({content:e});this.addMessageWithTokens(r,t)}}addStateMessage(e){this.addMessageWithTokens(e)}removeLastStateMessage(){this.history.removeLastHumanMessage()}getMessages(){const e=this.history.messages.map(r=>r.message);let t=0;$m.debug(`Messages in history: ${this.history.messages.length}:`);for(const r of this.history.messages)t+=r.metadata.inputTokens,$m.debug(`${r.message.constructor.name} - Token count: ${r.metadata.inputTokens}`);return e}getMessagesWithTokens(){return this.history.messages}addMessageWithTokens(e,t){let r=e;this.sensitiveData&&(r=this._filterSensitiveData(e));const i={inputTokens:this._countTokens(r)};this.history.addMessage(r,i,t)}_filterSensitiveData(e){const t=r=>{let s=r;if(!this.sensitiveData)return s;for(const[i,a]of Object.entries(this.sensitiveData))s=s.replace(a,`<secret>${i}</secret>`);return s};return typeof e.content=="string"?e.content=t(e.content):Array.isArray(e.content)&&(e.content=e.content.map(r=>typeof r=="object"&&"text"in r?{...r,text:t(r.text)}:r)),e}_countTokens(e){let t=0;if(Array.isArray(e.content))for(const r of e.content)"image_url"in r?t+=this.IMG_TOKENS:typeof r=="object"&&"text"in r&&(t+=this._countTextTokens(r.text));else{let r=e.content;"tool_calls"in e&&(r+=JSON.stringify(e.tool_calls)),t+=this._countTextTokens(r)}return t}_countTextTokens(e){return Math.floor(e.length/this.estimatedCharactersPerToken)}cutMessages(){let e=this.history.totalTokens-this.maxInputTokens;if(e<=0)return;const t=this.history.messages[this.history.messages.length-1];if(Array.isArray(t.message.content)){let l="";t.message.content=t.message.content.filter(d=>"image_url"in d?(e-=this.IMG_TOKENS,t.metadata.inputTokens-=this.IMG_TOKENS,this.history.totalTokens-=this.IMG_TOKENS,$m.debug(`Removed image with ${this.IMG_TOKENS} tokens - total tokens now: ${this.history.totalTokens}/${this.maxInputTokens}`),!1):("text"in d&&(l+=d.text),!0)),t.message.content=l,this.history.messages[this.history.messages.length-1]=t}if(e<=0)return;const r=e/t.metadata.inputTokens;if(r>.99)throw new Error(`Max token limit reached - history is too long - reduce the system prompt or task. proportion_to_remove: ${r}`);$m.debug(`Removing ${(r*100).toFixed(2)}% of the last message (${(r*t.metadata.inputTokens).toFixed(2)} / ${t.metadata.inputTokens.toFixed(2)} tokens)`);const s=t.message.content,i=Math.floor(s.length*r),a=s.slice(0,-i);this.history.removeMessage(-1);const o=new Jt({content:a});this.addMessageWithTokens(o);const u=this.history.messages[this.history.messages.length-1];$m.debug(`Added message with ${u.metadata.inputTokens} tokens - total tokens now: ${this.history.totalTokens}/${this.maxInputTokens} - total messages: ${this.history.messages.length}`)}}function uX(n){return n.map(e=>{if(e instanceof Jt||e instanceof Rd)return e;if(e instanceof Db)return new Jt({content:`Tool Response: ${e.content}`});if(e instanceof nn){if("tool_calls"in e&&e.tool_calls){const t=e.tool_calls.map(r=>"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"arguments"in r.function?`Function: ${r.function.name}
Arguments: ${JSON.stringify(r.function.arguments)}`:`Tool Call: ${JSON.stringify(r)}`).join(`
`);return new nn({content:t})}return e}throw new Error(`Unknown message type: ${e.constructor.name}`)})}function _L(n,e){const t=[];let r=0;for(const s of n)if(s instanceof e)if(r+=1,r>1){const i=t[t.length-1];if(Array.isArray(s.content)){const a=s.content[0];"text"in a&&(i.content+=a.text)}else i.content+=s.content}else t.push(s);else t.push(s),r=0;return t}const l0=Xs("agent"),lX=/<think>[\s\S]*?<\/think>/;class SP{constructor(e,t,r){this.actions={},this.modelOutputSchema=e,this.chatLLM=t.chatLLM,this.prompt=t.prompt,this.context=t.context,this.chatModelLibrary=this.chatLLM.constructor.name,this.modelName=this.getModelName(),this.withStructuredOutput=this.setWithStructuredOutput(),this.id=(r==null?void 0:r.id)||"agent",this.toolCallingMethod=this.setToolCallingMethod(r==null?void 0:r.toolCallingMethod),this.callOptions=r==null?void 0:r.callOptions,this.modelOutputToolName=`${this.id}_output`}getModelName(){return"modelName"in this.chatLLM?this.chatLLM.modelName:"model_name"in this.chatLLM?this.chatLLM.model_name:"model"in this.chatLLM?this.chatLLM.model:"Unknown"}setToolCallingMethod(e){if(e==="auto")switch(this.chatModelLibrary){case"ChatGoogleGenerativeAI":return null;case"ChatOpenAI":case"AzureChatOpenAI":case"ChatGroq":case"ChatXAI":return"function_calling";default:return null}return e||null}setWithStructuredOutput(){return!(this.modelName==="deepseek-reasoner"||this.modelName==="deepseek-r1")}removeThinkTags(e){return e.replace(lX,"")}convertInputMessages(e,t){if(!t)return e;if(t==="deepseek-reasoner"||t.startsWith("deepseek-r1")){const r=uX(e);let s=_L(r,Jt);return s=_L(s,nn),s}return e}async invoke(e){if(this.withStructuredOutput){const i=this.chatLLM.withStructuredOutput(this.modelOutputSchema,{includeRaw:!0,name:this.modelOutputToolName});try{const a=await i.invoke(e,{...this.callOptions});if(a.parsed)return a.parsed;throw l0.error("Failed to parse response",a),new Error("Could not parse response with structured output")}catch(a){const o=`Failed to invoke ${this.modelName} with structured output: ${a}`;throw new Error(o)}}const t=this.convertInputMessages(e,this.modelName),r=await this.chatLLM.invoke(t,{...this.callOptions});if(typeof r.content=="string"){r.content=this.removeThinkTags(r.content);try{const i=this.extractJsonFromModelOutput(r.content),a=this.validateModelOutput(i);if(a)return a}catch(i){const a=`Failed to extract JSON from response: ${i}`;throw new Error(a)}}const s=`Failed to parse response: ${r}`;throw l0.error(s),new Error("Could not parse response")}validateModelOutput(e){if(!(!this.modelOutputSchema||!e))try{return this.modelOutputSchema.parse(e)}catch(t){throw l0.error("validateModelOutput",t),new Error("Could not validate model output")}}addModelOutputToMemory(e){const t=this.context.messageManager,r=String(t.nextToolId()),s=[{name:this.modelOutputToolName,args:e,id:r,type:"tool_call"}],i=new nn({content:"tool call",tool_calls:s});t.addMessageWithTokens(i);const a=new Db({content:"tool call response placeholder",tool_call_id:r});t.addMessageWithTokens(a)}extractJsonFromModelOutput(e){try{let t=e;return e.includes("```")&&(t=t.split("```")[1],t.includes(`json
`)&&(t=t.replace(/^json\s*/,""))),JSON.parse(t)}catch(t){throw l0.warning(`Failed to parse model output: ${e} ${t}`),new Error("Failed to extract JSON from model output.")}}}const bL={name:"done",description:"Complete task",schema:ge.object({text:ge.string()})},dX={name:"search_google",description:"Search Google in the current tab",schema:ge.object({query:ge.string()})},hX={name:"go_to_url",description:"Navigate to URL in the current tab",schema:ge.object({url:ge.string()})},fX={name:"go_back",description:"Go back to the previous page",schema:ge.object({})},pX={name:"click_element",description:"Click element",schema:ge.object({desc:ge.string().optional(),index:ge.number(),xpath:ge.string().nullable().optional()})},mX={name:"input_text",description:"Input text into an interactive input element",schema:ge.object({desc:ge.string().optional(),index:ge.number(),text:ge.string(),xpath:ge.string().nullable().optional()})},gX={name:"switch_tab",description:"Switch to tab by id",schema:ge.object({tab_id:ge.number()})},yX={name:"open_tab",description:"Open URL in new tab",schema:ge.object({url:ge.string()})},wX={name:"extract_content",description:"Extract page content to retrieve specific information from the page, e.g. all company names, a specific description, all information about, links with companies in structured format or simply links",schema:ge.object({goal:ge.string()})},SL={name:"cache_content",description:"Cache the extracted content of the page",schema:ge.object({content:ge.string()})},vX={name:"scroll_down",description:"Scroll down the page by pixel amount - if no amount is specified, scroll down one page",schema:ge.object({desc:ge.string().optional(),amount:ge.number().nullable().optional()})},_X={name:"scroll_up",description:"Scroll up the page by pixel amount - if no amount is specified, scroll up one page",schema:ge.object({desc:ge.string().optional(),amount:ge.number().nullable().optional()})},bX={name:"send_keys",description:"Send strings of special keys like Backspace, Insert, PageDown, Delete, Enter. Shortcuts such as `Control+o`, `Control+Shift+T` are supported as well. This gets used in keyboard press. Be aware of different operating systems and their shortcuts",schema:ge.object({desc:ge.string().optional(),keys:ge.string()})},SX={name:"scroll_to_text",description:"If you dont find something which you want to interact with, scroll to it",schema:ge.object({desc:ge.string().optional(),text:ge.string()})},xX={name:"get_dropdown_options",description:"Get all options from a native dropdown",schema:ge.object({index:ge.number()})},EX={name:"select_dropdown_option",description:"Select dropdown option for interactive element index by the text of the option you want to select",schema:ge.object({index:ge.number(),text:ge.string()})};class kX extends _r{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[i,a]of Object.entries(t))typeof a=="string"?r[i]=a:r[i]=await a();return{...r,...e}}async invoke(e,t){const r={...this.metadata,...t==null?void 0:t.metadata},s=[...this.tags??[],...(t==null?void 0:t.tags)??[]];return this._callWithConfig(i=>this.formatPromptValue(i),e,{...t,tags:s,metadata:r,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await Promise.resolve().then(()=>OL);return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await Promise.resolve().then(()=>OL);return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await Promise.resolve().then(()=>VX);return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class xL extends fu{}class EL extends xL{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Jt(this.value)]}}class CX extends xL{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return EN(this.messages)}toChatMessages(){return this.messages}}class kL extends kX{async formatPromptValue(e){const t=await this.format(e);return new EL(t)}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var PX=Object.prototype.toString,Ud=Array.isArray||function(e){return PX.call(e)==="[object Array]"};function xP(n){return typeof n=="function"}function AX(n){return Ud(n)?"array":typeof n}function EP(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function CL(n,e){return n!=null&&typeof n=="object"&&e in n}function TX(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var IX=RegExp.prototype.test;function OX(n,e){return IX.call(n,e)}var RX=/\S/;function MX(n){return!OX(RX,n)}var $X={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function NX(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return $X[t]})}var FX=/\s*/,LX=/\s+/,PL=/\s*=/,jX=/\s*\}/,DX=/#|\^|\/|>|\{|&|=|!/;function BX(n,e){if(!n)return[];var t=!1,r=[],s=[],i=[],a=!1,o=!1,u="",l=0;function d(){if(a&&!o)for(;i.length;)delete s[i.pop()];else i=[];a=!1,o=!1}var h,f,p;function m(E){if(typeof E=="string"&&(E=E.split(LX,2)),!Ud(E)||E.length!==2)throw new Error("Invalid tags: "+E);h=new RegExp(EP(E[0])+"\\s*"),f=new RegExp("\\s*"+EP(E[1])),p=new RegExp("\\s*"+EP("}"+E[1]))}m(e||Bn.tags);for(var g=new Nm(n),y,w,v,b,S,P;!g.eos();){if(y=g.pos,v=g.scanUntil(h),v)for(var k=0,C=v.length;k<C;++k)b=v.charAt(k),MX(b)?(i.push(s.length),u+=b):(o=!0,t=!0,u+=" "),s.push(["text",b,y,y+1]),y+=1,b===`
`&&(d(),u="",l=0,t=!1);if(!g.scan(h))break;if(a=!0,w=g.scan(DX)||"name",g.scan(FX),w==="="?(v=g.scanUntil(PL),g.scan(PL),g.scanUntil(f)):w==="{"?(v=g.scanUntil(p),g.scan(jX),g.scanUntil(f),w="&"):v=g.scanUntil(f),!g.scan(f))throw new Error("Unclosed tag at "+g.pos);if(w==">"?S=[w,v,y,g.pos,u,l,t]:S=[w,v,y,g.pos],l++,s.push(S),w==="#"||w==="^")r.push(S);else if(w==="/"){if(P=r.pop(),!P)throw new Error('Unopened section "'+v+'" at '+y);if(P[1]!==v)throw new Error('Unclosed section "'+P[1]+'" at '+y)}else w==="name"||w==="{"||w==="&"?o=!0:w==="="&&m(v)}if(d(),P=r.pop(),P)throw new Error('Unclosed section "'+P[1]+'" at '+g.pos);return qX(UX(s))}function UX(n){for(var e=[],t,r,s=0,i=n.length;s<i;++s)t=n[s],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function qX(n){for(var e=[],t=e,r=[],s,i,a=0,o=n.length;a<o;++a)switch(s=n[a],s[0]){case"#":case"^":t.push(s),r.push(s),t=s[4]=[];break;case"/":i=r.pop(),i[5]=s[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(s)}return e}function Nm(n){this.string=n,this.tail=n,this.pos=0}Nm.prototype.eos=function(){return this.tail===""},Nm.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r},Nm.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function qd(n,e){this.view=n,this.cache={".":this.view},this.parent=e}qd.prototype.push=function(e){return new qd(e,this)},qd.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var s=this,i,a,o,u=!1;s;){if(e.indexOf(".")>0)for(i=s.view,a=e.split("."),o=0;i!=null&&o<a.length;)o===a.length-1&&(u=CL(i,a[o])||TX(i,a[o])),i=i[a[o++]];else i=s.view[e],u=CL(s.view,e);if(u){r=i;break}s=s.parent}t[e]=r}return xP(r)&&(r=r.call(this.view)),r};function Cn(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}Cn.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()},Cn.prototype.parse=function(e,t){var r=this.templateCache,s=e+":"+(t||Bn.tags).join(":"),i=typeof r<"u",a=i?r.get(s):void 0;return a==null&&(a=BX(e,t),i&&r.set(s,a)),a},Cn.prototype.render=function(e,t,r,s){var i=this.getConfigTags(s),a=this.parse(e,i),o=t instanceof qd?t:new qd(t,void 0);return this.renderTokens(a,o,r,e,s)},Cn.prototype.renderTokens=function(e,t,r,s,i){for(var a="",o,u,l,d=0,h=e.length;d<h;++d)l=void 0,o=e[d],u=o[0],u==="#"?l=this.renderSection(o,t,r,s,i):u==="^"?l=this.renderInverted(o,t,r,s,i):u===">"?l=this.renderPartial(o,t,r,i):u==="&"?l=this.unescapedValue(o,t):u==="name"?l=this.escapedValue(o,t,i):u==="text"&&(l=this.rawValue(o)),l!==void 0&&(a+=l);return a},Cn.prototype.renderSection=function(e,t,r,s,i){var a=this,o="",u=t.lookup(e[1]);function l(f){return a.render(f,t,r,i)}if(u){if(Ud(u))for(var d=0,h=u.length;d<h;++d)o+=this.renderTokens(e[4],t.push(u[d]),r,s,i);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")o+=this.renderTokens(e[4],t.push(u),r,s,i);else if(xP(u)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,s.slice(e[3],e[5]),l),u!=null&&(o+=u)}else o+=this.renderTokens(e[4],t,r,s,i);return o}},Cn.prototype.renderInverted=function(e,t,r,s,i){var a=t.lookup(e[1]);if(!a||Ud(a)&&a.length===0)return this.renderTokens(e[4],t,r,s,i)},Cn.prototype.indentPartial=function(e,t,r){for(var s=t.replace(/[^ \t]/g,""),i=e.split(`
`),a=0;a<i.length;a++)i[a].length&&(a>0||!r)&&(i[a]=s+i[a]);return i.join(`
`)},Cn.prototype.renderPartial=function(e,t,r,s){if(r){var i=this.getConfigTags(s),a=xP(r)?r(e[1]):r[e[1]];if(a!=null){var o=e[6],u=e[5],l=e[4],d=a;u==0&&l&&(d=this.indentPartial(a,l,o));var h=this.parse(d,i);return this.renderTokens(h,t,r,d,s)}}},Cn.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r},Cn.prototype.escapedValue=function(e,t,r){var s=this.getConfigEscape(r)||Bn.escape,i=t.lookup(e[1]);if(i!=null)return typeof i=="number"&&s===Bn.escape?String(i):s(i)},Cn.prototype.rawValue=function(e){return e[1]},Cn.prototype.getConfigTags=function(e){return Ud(e)?e:e&&typeof e=="object"?e.tags:void 0},Cn.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Ud(e))return e.escape};var Bn={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){Fm.templateCache=n},get templateCache(){return Fm.templateCache}},Fm=new Cn;Bn.clearCache=function(){return Fm.clearCache()},Bn.parse=function(e,t){return Fm.parse(e,t)},Bn.render=function(e,t,r,s){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+AX(e)+'" was given as the first argument for mustache#render(template, view, partials)');return Fm.render(e,t,r,s)},Bn.escape=NX,Bn.Scanner=Nm,Bn.Context=qd,Bn.Writer=Cn;function AL(){Bn.escape=n=>n}const TL=n=>{const e=n.split(""),t=[],r=(i,a)=>{for(let o=a;o<e.length;o+=1)if(i.includes(e[o]))return o;return-1};let s=0;for(;s<e.length;)if(e[s]==="{"&&s+1<e.length&&e[s+1]==="{")t.push({type:"literal",text:"{"}),s+=2;else if(e[s]==="}"&&s+1<e.length&&e[s+1]==="}")t.push({type:"literal",text:"}"}),s+=2;else if(e[s]==="{"){const i=r("}",s);if(i<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(s+1,i).join("")}),s=i+1}else{if(e[s]==="}")throw new Error("Single '}' in template.");{const i=r("{}",s),a=(i<0?e.slice(s):e.slice(s,i)).join("");t.push({type:"literal",text:a}),s=i<0?e.length:i}}return t},HX=n=>n.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),KX=n=>{AL();const e=Bn.parse(n);return HX(e)},kP={"f-string":(n,e)=>TL(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e){const s=typeof e[r.name]=="string"?e[r.name]:JSON.stringify(e[r.name]);return t+s}throw new Error(`(f-string) Missing value for input ${r.name}`)}return t+r.text},""),mustache:(n,e)=>(AL(),Bn.render(n,e))},WX={"f-string":TL,mustache:KX},Hd=(n,e,t)=>{try{return kP[e](n,t)}catch(r){throw Kk(r,"INVALID_PROMPT_INPUT")}},zX=(n,e)=>WX[e](n),IL=(n,e,t)=>{if(!(e in kP)){const r=Object.keys(kP);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{const r=t.reduce((s,i)=>(s[i]="foo",s),{});Array.isArray(n)?n.forEach(s=>{if(s.type==="text")Hd(s.text,e,r);else if(s.type==="image_url")if(typeof s.image_url=="string")Hd(s.image_url,e,r);else{const i=s.image_url.url;Hd(i,e,r)}else throw new Error(`Invalid message template received. ${JSON.stringify(s,null,2)}`)}):Hd(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};class Ko extends kL{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),IL(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return Hd(this.template,this.templateFormat,t)}static fromExamples(e,t,r,s=`

`,i=""){const a=[i,...e,t].join(s);return new Ko({inputVariables:r,template:a})}static fromTemplate(e,t){const{templateFormat:r="f-string",...s}=t??{},i=new Set;return zX(e,r).forEach(a=>{a.type==="variable"&&i.add(a.name)}),new Ko({inputVariables:[...i],templateFormat:r,template:e,...s})}async partial(e){const t=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new Ko(s)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new Ko({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const OL=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:Ko},Symbol.toStringTag,{value:"Module"}));class d0 extends kL{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),IL(this.prefix+this.suffix,this.templateFormat,t)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new d0(s)}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),s=await Promise.all(r.map(a=>this.examplePrompt.format(a))),i=[this.prefix,...s,this.suffix].join(this.exampleSeparator);return Hd(i,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const r=await Ko.deserialize(t);let s;if(Array.isArray(e.examples))s=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new d0({inputVariables:e.input_variables,examplePrompt:r,examples:s,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}const VX=Object.freeze(Object.defineProperty({__proto__:null,FewShotPromptTemplate:d0},Symbol.toStringTag,{value:"Module"})),Un=Xs("Action");class GX extends Error{constructor(e){super(e),this.name="InvalidInputError"}}class on{constructor(e,t,r=!1){this.handler=e,this.schema=t,this.hasIndex=r}async call(e){const t=this.schema.schema;if(t instanceof ge.ZodObject&&Object.keys(t.shape||{}).length===0)return await this.handler({});const s=this.schema.schema.safeParse(e);if(!s.success){const i=s.error.message;throw new GX(i)}return await this.handler(s.data)}name(){return this.schema.name}prompt(){const e=this.schema.schema.shape||{},t=Object.entries(e).map(([s,i])=>{const a=i;return`'${s}': {'type': '${a.description}', ${a.isOptional()?"'optional': true":"'required': true"}}`}),r=t.length>0?`{${this.name()}: {${t.join(", ")}}}`:`{${this.name()}: {}}`;return`${this.schema.description}:
${r}`}getIndexArg(e){return this.hasIndex&&e&&typeof e=="object"&&"index"in e?e.index:null}}function ZX(n){let e=ge.object({});for(const t of n){const r=t.schema.schema.nullable().describe(t.schema.description);e=e.extend({[t.name()]:r})}return e.partial()}class JX{constructor(e,t){this.context=e,this.extractorLLM=t}buildDefaultActions(){const e=[],t=new on(async v=>(this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_START,bL.name),this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,v.text),new Ct({isDone:!0,extractedContent:v.text})),bL);e.push(t);const r=new on(async v=>{const b=this.context,S=`Searching for "${v.query}" in Google`;b.emitEvent(Me.NAVIGATOR,Ie.ACT_START,S),await b.browserContext.navigateTo(`https://www.google.com/search?q=${v.query}`);const P=`Searched for "${v.query}" in Google`;return b.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,P),new Ct({extractedContent:P,includeInMemory:!0})},dX);e.push(r);const s=new on(async v=>{const b=`Navigating to ${v.url}`;this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_START,b),await this.context.browserContext.navigateTo(v.url);const S=`Navigated to ${v.url}`;return this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,S),new Ct({extractedContent:S,includeInMemory:!0})},hX);e.push(s);const i=new on(async(v={})=>{this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_START,"Navigating back"),await(await this.context.browserContext.getCurrentPage()).goBack();const P="Navigated back";return this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,P),new Ct({extractedContent:P,includeInMemory:!0})},fX);e.push(i);const a=new on(async v=>{const b=v.desc||`Click element with index ${v.index}`;this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_START,b);const S=await this.context.browserContext.getCurrentPage(),P=await S.getState(),k=P==null?void 0:P.selectorMap.get(v.index);if(!k)throw new Error(`Element with index ${v.index} does not exist - retry or use alternative actions`);if(await S.isFileUploader(k)){const C=`Index ${v.index} - has an element which opens file upload dialog. To upload files please use a specific function to upload files`;return Un.info(C),new Ct({extractedContent:C,includeInMemory:!0})}try{const C=await this.context.browserContext.getAllTabIds();await S.clickElementNode(this.context.options.useVision,k);let E=`Clicked button with index ${v.index}: ${k.getAllTextTillNextClickableElement(2)}`;Un.info(E);const M=await this.context.browserContext.getAllTabIds();if(M.size>C.size){const I="New tab opened - switching to it";E+=` - ${I}`,Un.info(I);const N=Array.from(M).find(O=>!C.has(O));N&&await this.context.browserContext.switchTab(N)}return this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,E),new Ct({extractedContent:E,includeInMemory:!0})}catch(C){const E=`Element no longer available with index ${v.index} - most likely the page changed`;return this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_FAIL,E),new Ct({error:C instanceof Error?C.message:String(C)})}},pX,!0);e.push(a);const o=new on(async v=>{const b=v.desc||`Input text into index ${v.index}`;this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_START,b);const S=await this.context.browserContext.getCurrentPage(),P=await S.getState(),k=P==null?void 0:P.selectorMap.get(v.index);if(!k)throw new Error(`Element with index ${v.index} does not exist - retry or use alternative actions`);await S.inputTextElementNode(this.context.options.useVision,k,v.text);const C=`Input ${v.text} into index ${v.index}`;return this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,C),new Ct({extractedContent:C,includeInMemory:!0})},mX,!0);e.push(o);const u=new on(async v=>{this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_START,`Switching to tab ${v.tab_id}`),await this.context.browserContext.switchTab(v.tab_id);const b=`Switched to tab ${v.tab_id}`;return this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,b),new Ct({extractedContent:b,includeInMemory:!0})},gX);e.push(u);const l=new on(async v=>{this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_START,`Opening ${v.url} in new tab`),await this.context.browserContext.openTab(v.url);const b=`Opened ${v.url} in new tab`;return this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,b),new Ct({extractedContent:b,includeInMemory:!0})},yX);e.push(l);const d=new on(async v=>{const b=v.goal,P=await(await this.context.browserContext.getCurrentPage()).getReadabilityContent(),C=await Ko.fromTemplate("Your task is to extract the content of the page. You will be given a page and a goal and you should extract all relevant information around this goal from the page. If the goal is vague, summarize the page. Respond in json format. Extraction goal: {goal}, Page: {page}").invoke({goal:b,page:P.content});try{const M=`  Extracted from page
: ${(await this.extractorLLM.invoke(C)).content}
`;return new Ct({extractedContent:M,includeInMemory:!0})}catch(E){Un.error(`Error extracting content: ${E instanceof Error?E.message:String(E)}`);const M="Failed to extract content from page, you need to extract content from the current state of the page and store it in the memory. Then scroll down if you still need more information.";return new Ct({extractedContent:M,includeInMemory:!0})}},wX);e.push(d);const h=new on(async v=>{this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_START,SL.name);const b=`Cached findings: ${v.content}`;return this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,b),new Ct({extractedContent:b,includeInMemory:!0})},SL);e.push(h);const f=new on(async v=>{const b=v.desc||"Scroll down the page";this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_START,b),await(await this.context.browserContext.getCurrentPage()).scrollDown(v.amount);const k=`Scrolled down the page by ${v.amount!==void 0?`${v.amount} pixels`:"one page"}`;return this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,k),new Ct({extractedContent:k,includeInMemory:!0})},vX);e.push(f);const p=new on(async v=>{const b=v.desc||"Scroll up the page";this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_START,b),await(await this.context.browserContext.getCurrentPage()).scrollUp(v.amount);const k=`Scrolled up the page by ${v.amount!==void 0?`${v.amount} pixels`:"one page"}`;return this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,k),new Ct({extractedContent:k,includeInMemory:!0})},_X);e.push(p);const m=new on(async v=>{const b=v.desc||`Send keys: ${v.keys}`;this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_START,b),await(await this.context.browserContext.getCurrentPage()).sendKeys(v.keys);const P=`Sent keys: ${v.keys}`;return this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,P),new Ct({extractedContent:P,includeInMemory:!0})},bX);e.push(m);const g=new on(async v=>{const b=v.desc||`Scroll to text: ${v.text}`;this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_START,b);const S=await this.context.browserContext.getCurrentPage();try{const k=await S.scrollToText(v.text)?`Scrolled to text: ${v.text}`:`Text '${v.text}' not found or not visible on page`;return this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,k),new Ct({extractedContent:k,includeInMemory:!0})}catch(P){const k=`Failed to scroll to text: ${P instanceof Error?P.message:String(P)}`;return this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_FAIL,k),new Ct({error:k,includeInMemory:!0})}},SX);e.push(g);const y=new on(async v=>{const b=`Getting options from dropdown with index ${v.index}`;this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_START,b);const S=await this.context.browserContext.getCurrentPage(),P=await S.getState();if(!(P==null?void 0:P.selectorMap.get(v.index))){const C=`Element with index ${v.index} does not exist - retry or use alternative actions`;return Un.error(C),this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_FAIL,C),new Ct({error:C,includeInMemory:!0})}try{const C=await S.getDropdownOptions(v.index);if(C&&C.length>0){let I=C.map(N=>{const O=JSON.stringify(N.text);return`${N.index}: text=${O}`}).join(`
`);return I+=`
Use the exact text string in select_dropdown_option`,Un.info(I),this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,`Got ${C.length} options from dropdown`),new Ct({extractedContent:I,includeInMemory:!0})}const E="No options found in dropdown";return Un.info(E),this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,E),new Ct({extractedContent:E,includeInMemory:!0})}catch(C){const E=`Failed to get dropdown options: ${C instanceof Error?C.message:String(C)}`;return Un.error(E),this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_FAIL,E),new Ct({error:E,includeInMemory:!0})}},xX,!0);e.push(y);const w=new on(async v=>{const b=`Select option "${v.text}" from dropdown with index ${v.index}`;this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_START,b);const S=await this.context.browserContext.getCurrentPage(),P=await S.getState(),k=P==null?void 0:P.selectorMap.get(v.index);if(!k){const C=`Element with index ${v.index} does not exist - retry or use alternative actions`;return this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_FAIL,C),new Ct({error:C,includeInMemory:!0})}if(!k.tagName||k.tagName.toLowerCase()!=="select"){const C=`Cannot select option: Element with index ${v.index} is a ${k.tagName||"unknown"}, not a SELECT`;return Un.error(C),this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_FAIL,C),new Ct({error:C,includeInMemory:!0})}Un.debug(`Attempting to select '${v.text}' using xpath: ${k.xpath}`),Un.debug(`Element attributes: ${JSON.stringify(k.attributes)}`),Un.debug(`Element tag: ${k.tagName}`);try{const C=await S.selectDropdownOption(v.index,v.text),E=`Selected option "${v.text}" from dropdown with index ${v.index}`;return Un.info(E),this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_OK,E),new Ct({extractedContent:C,includeInMemory:!0})}catch(C){const E=`Failed to select option: ${C instanceof Error?C.message:String(C)}`;return Un.error(E),this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_FAIL,E),new Ct({error:E,includeInMemory:!0})}},EX,!0);return e.push(w),e}}class Kd extends Error{constructor(e,t){super(e),this.cause=t,this.name="ChatModelAuthError",Error.captureStackTrace&&Error.captureStackTrace(this,Kd)}toString(){return`${this.name}: ${this.message}${this.cause?` (Caused by: ${this.cause})`:""}`}}class Wd extends Error{constructor(e,t){super(e),this.cause=t,this.name="ChatModelForbiddenError",Error.captureStackTrace&&Error.captureStackTrace(this,Wd)}toString(){return`${this.name}: ${this.message}${this.cause?` (Caused by: ${this.cause})`:""}`}}const CP=`Access denied (403 Forbidden). Please check:

1. Your API key has the required permissions

2. For Ollama: Set OLLAMA_ORIGINS=chrome-extension://* 
see https://github.com/ollama/ollama/blob/main/docs/faq.md`;function PP(n){var s;if(!(n instanceof Error))return!1;const e=n.message||"";let t=n.name||"";const r=(s=n.constructor)==null?void 0:s.name;return r&&r!=="Error"&&(t=r),t==="AuthenticationError"?!0:e.toLowerCase().includes("authentication")||e.includes(" 401")||e.toLowerCase().includes("api key")}function AP(n){return n instanceof Error?n.message.includes(" 403")&&n.message.includes("Forbidden"):!1}const XX={properties:{current_state:{description:"Current state of the agent",properties:{page_summary:{title:"Page Summary",type:"string"},evaluation_previous_goal:{title:"Evaluation Previous Goal",type:"string"},memory:{title:"Memory",type:"string"},next_goal:{title:"Next Goal",type:"string"}},required:["page_summary","evaluation_previous_goal","memory","next_goal"],title:"AgentBrain",type:"object"},action:{items:{properties:{done:{properties:{text:{title:"Text",type:"string"}},required:["text"],title:"DoneAction",type:"object",nullable:!0},search_google:{properties:{query:{title:"Query",type:"string"}},required:["query"],title:"SearchGoogleAction",type:"object",nullable:!0},go_to_url:{properties:{url:{title:"Url",type:"string"}},required:["url"],title:"GoToUrlAction",type:"object",nullable:!0},go_back:{additionalProperties:!0,description:`Accepts absolutely anything in the incoming data
and discards it, so the final parsed model is empty.`,properties:{},title:"NoParamsAction",type:"object",nullable:!0},click_element:{properties:{desc:{title:"Intent",type:"string",description:"Very short explanation of the intent or purpose for calling this action"},index:{title:"Index",type:"integer"},xpath:{title:"XPath",type:"string",nullable:!0}},required:["desc","index"],title:"ClickElementAction",type:"object",nullable:!0},input_text:{properties:{desc:{title:"Intent",type:"string",description:"Very short explanation of the intent or purpose for calling this action"},index:{title:"Index",type:"integer"},text:{title:"Text",type:"string"},xpath:{title:"XPath",type:"string",nullable:!0}},required:["desc","index","text"],title:"InputTextAction",type:"object",nullable:!0},switch_tab:{properties:{tab_id:{title:"Page Id",type:"integer"}},required:["tab_id"],title:"SwitchTabAction",type:"object",nullable:!0},open_tab:{properties:{url:{title:"Url",type:"string"}},required:["url"],title:"OpenTabAction",type:"object",nullable:!0},cache_content:{properties:{content:{title:"Content",type:"string"}},required:["content"],title:"cache_content_parameters",type:"object",nullable:!0},scroll_down:{properties:{desc:{title:"Intent",type:"string",description:"Very short explanation of the intent or purpose for calling this action"},amount:{title:"Amount",type:"integer",nullable:!0}},required:["desc"],title:"ScrollAction",type:"object",nullable:!0},scroll_up:{properties:{desc:{title:"Intent",type:"string",description:"Very short explanation of the intent or purpose for calling this action"},amount:{title:"Amount",type:"integer",nullable:!0}},required:["desc"],title:"ScrollAction",type:"object",nullable:!0},send_keys:{properties:{desc:{title:"Intent",type:"string",description:"Very short explanation of the intent or purpose for calling this action"},keys:{title:"Keys",type:"string"}},required:["desc","keys"],title:"SendKeysAction",type:"object",nullable:!0},scroll_to_text:{properties:{desc:{title:"Intent",type:"string",description:"Very short explanation of the intent or purpose for calling this action"},text:{title:"Text",type:"string"}},required:["desc","text"],title:"scroll_to_text_parameters",type:"object",nullable:!0},get_dropdown_options:{properties:{index:{title:"Index",type:"integer"}},required:["index"],title:"get_dropdown_options_parameters",type:"object",nullable:!0},select_dropdown_option:{properties:{index:{title:"Index",type:"integer"},text:{title:"Text",type:"string"}},required:["index","text"],title:"select_dropdown_option_parameters",type:"object",nullable:!0}},title:"ActionModel",type:"object"},title:"Action",type:"array"}},required:["current_state","action"],title:"AgentOutput",type:"object"},YX={type:"object",properties:{current_state:{type:"object",description:"Current state of the agent",properties:{page_summary:{type:"string"},evaluation_previous_goal:{type:"string"},memory:{type:"string"},next_goal:{type:"string"}},required:["page_summary","evaluation_previous_goal","memory","next_goal"]},action:{type:"array",items:{type:"object",properties:{done:{type:"object",properties:{text:{type:"string"}},required:["text"],nullable:!0},search_google:{type:"object",properties:{query:{type:"string"}},required:["query"],nullable:!0},go_to_url:{type:"object",properties:{url:{type:"string"}},required:["url"],nullable:!0},go_back:{type:"string",nullable:!0,description:`Accepts absolutely anything in the incoming data
and discards it, so the final parsed model is empty.`},click_element:{type:"object",properties:{desc:{type:"string",description:"Very short explanation of the intent or purpose for calling this action"},index:{type:"integer"},xpath:{type:"string",nullable:!0}},required:["desc","index"],nullable:!0},input_text:{type:"object",properties:{desc:{type:"string",description:"Very short explanation of the intent or purpose for calling this action"},index:{type:"integer"},text:{type:"string"},xpath:{type:"string",nullable:!0}},required:["desc","index","text"],nullable:!0},switch_tab:{type:"object",properties:{tab_id:{type:"integer"}},required:["tab_id"],nullable:!0},open_tab:{type:"object",properties:{url:{type:"string"}},required:["url"],nullable:!0},cache_content:{type:"object",properties:{content:{type:"string"}},required:["content"],nullable:!0},scroll_down:{type:"object",properties:{desc:{type:"string",description:"Very short explanation of the intent or purpose for calling this action"},amount:{type:"integer",nullable:!0}},required:["desc"],nullable:!0},scroll_up:{type:"object",properties:{desc:{type:"string",description:"Very short explanation of the intent or purpose for calling this action"},amount:{type:"integer",nullable:!0}},required:["desc"],nullable:!0},send_keys:{type:"object",properties:{desc:{type:"string",description:"Very short explanation of the intent or purpose for calling this action"},keys:{type:"string"}},required:["desc","keys"],nullable:!0},scroll_to_text:{type:"object",properties:{desc:{type:"string",description:"Very short explanation of the intent or purpose for calling this action"},text:{type:"string"}},required:["desc","text"],nullable:!0},get_dropdown_options:{type:"object",properties:{index:{type:"integer"}},required:["index"],nullable:!0},select_dropdown_option:{type:"object",properties:{index:{type:"integer"},text:{type:"string"}},required:["index","text"],nullable:!0}},required:[]}}},required:["current_state","action"]},Na=Xs("NavigatorAgent");class QX{constructor(e){this.actions={};for(const t of e)this.registerAction(t)}registerAction(e){this.actions[e.name()]=e}unregisterAction(e){delete this.actions[e]}getAction(e){return this.actions[e]}setupModelOutputSchema(){const e=ZX(Object.values(this.actions));return ge.object({current_state:F8,action:ge.array(e)})}}class eY extends SP{constructor(e,t,r){super(e.setupModelOutputSchema(),t,{...r,id:"navigator"}),this.actionRegistry=e,this.jsonSchema=this.modelName.startsWith("gemini")?YX:XX}async invoke(e){if(this.withStructuredOutput){const t=this.chatLLM.withStructuredOutput(this.jsonSchema,{includeRaw:!0,name:this.modelOutputToolName});let r;try{if(r=await t.invoke(e,{...this.callOptions}),r.parsed)return r.parsed}catch(i){const a=`Failed to invoke ${this.modelName} with structured output: ${i}`;throw new Error(a)}const s=r.raw;if(s.tool_calls&&s.tool_calls.length>0){Na.info("Navigator structuredLlm tool call with empty content",s.tool_calls);const i=s.tool_calls[0];return{current_state:i.args.currentState,action:[...i.args.action]}}throw new Error("Could not parse response")}throw new Error("Navigator needs to work with LLM that supports tool calling")}async execute(){const e={id:this.id};let t=!1;try{this.context.emitEvent(Me.NAVIGATOR,Ie.STEP_START,"Navigating...");const r=this.context.messageManager;if(await this.addStateMessageToMemory(),this.context.paused||this.context.stopped)return t=!0,e;const s=r.getMessages(),i=await this.invoke(s);if(this.context.paused||this.context.stopped)return t=!0,e;this.removeLastStateMessageFromMemory(),this.addModelOutputToMemory(i);const a=await this.doMultiAction(i);if(this.context.actionResults=a,this.context.paused||this.context.stopped)return t=!0,e;this.context.emitEvent(Me.NAVIGATOR,Ie.STEP_OK,"Navigation done");let o=!1;return a.length>0&&a[a.length-1].isDone&&(o=!0),e.result={done:o},e}catch(r){if(this.removeLastStateMessageFromMemory(),PP(r))throw new Kd("Navigator API Authentication failed. Please verify your API key",r);if(AP(r))throw new Wd(CP,r);const s=r instanceof Error?r.message:String(r),i=`Navigation failed: ${s}`;return Na.error(i),this.context.emitEvent(Me.NAVIGATOR,Ie.STEP_FAIL,i),e.error=s,e}finally{t&&(this.removeLastStateMessageFromMemory(),this.context.emitEvent(Me.NAVIGATOR,Ie.STEP_CANCEL,"Navigation cancelled"))}}async addStateMessageToMemory(){if(this.context.stateMessageAdded)return;const e=this.context.messageManager,t=this.context.options;if(this.context.actionResults.length>0){let s=0;for(const i of this.context.actionResults){if(i.includeInMemory){if(i.extractedContent){const a=new Jt(`Action result: ${i.extractedContent}`);e.addMessageWithTokens(a)}if(i.error){const a=new Jt(`Action error: ${i.error.toString().slice(-t.maxErrorLength)}`);Na.info("Adding action error to memory",a.content),e.addMessageWithTokens(a)}this.context.actionResults[s]=new Ct}s++}}const r=await this.prompt.getUserMessage(this.context);e.addStateMessage(r),this.context.stateMessageAdded=!0}async removeLastStateMessageFromMemory(){if(!this.context.stateMessageAdded)return;this.context.messageManager.removeLastStateMessage(),this.context.stateMessageAdded=!1}async doMultiAction(e){const t=[];let r=0;Na.info("Actions",e.action);let s=[];if(Array.isArray(e.action))s=e.action.filter(u=>u!==null),s.length===0&&Na.warning("No valid actions found",e.action);else if(typeof e.action=="string")try{Na.warning("Unexpected action format",e.action),s=JSON.parse(e.action)}catch{throw Na.error("Invalid action format",e.action),new Error("Invalid action output format")}else s=[e.action];const i=this.context.browserContext,a=await i.getState(),o=await Q$(a);await i.removeHighlight();for(const[u,l]of s.entries()){const d=Object.keys(l)[0],h=l[d];try{if(this.context.paused||this.context.stopped)return t;const f=this.actionRegistry.getAction(d);if(f===void 0)throw new Error(`Action ${d} not exists`);const p=f.getIndexArg(h);if(u>0&&p!==null){const g=await i.getState();if(!(await Q$(g)).isSubsetOf(o)){const w=`Something new appeared after action ${u} / ${s.length}`;Na.info(w),t.push(new Ct({extractedContent:w,includeInMemory:!0}));break}}const m=await f.call(h);if(m===void 0)throw new Error(`Action ${d} returned undefined`);if(t.push(m),this.context.paused||this.context.stopped)return t;await new Promise(g=>setTimeout(g,1e3))}catch(f){const p=f instanceof Error?f.message:String(f);if(Na.error("doAction error",d,h,p),this.context.emitEvent(Me.NAVIGATOR,Ie.ACT_FAIL,p),r++,r>3)throw new Error("Too many errors in actions");t.push(new Ct({error:p,isDone:!1,includeInMemory:!0}))}}return t}}const tY=ge.object({observation:ge.string(),challenges:ge.string(),done:ge.union([ge.boolean(),ge.string().transform(n=>{if(n.toLowerCase()==="true")return!0;if(n.toLowerCase()==="false")return!1;throw new Error("Invalid boolean string")})]),next_steps:ge.string(),reasoning:ge.string(),web_task:ge.union([ge.boolean(),ge.string().transform(n=>{if(n.toLowerCase()==="true")return!0;if(n.toLowerCase()==="false")return!1;throw new Error("Invalid boolean string")})])});class rY extends SP{constructor(e,t){super(tY,e,{...t,id:"planner"})}async execute(){try{this.context.emitEvent(Me.PLANNER,Ie.STEP_START,"Planning...");const e=this.context.messageManager.getMessages(),t=[this.prompt.getSystemMessage(),...e.slice(1)];if(!this.context.options.useVisionForPlanner&&this.context.options.useVision){const s=t[t.length-1];let i="";if(Array.isArray(s.content))for(const a of s.content)a.type==="text"&&(i+=a.text);else i=s.content;t[t.length-1]=new Jt(i)}const r=await this.invoke(t);if(!r)throw new Error("Failed to validate planner output");return this.context.emitEvent(Me.PLANNER,Ie.STEP_OK,r.next_steps),{id:this.id,result:r}}catch(e){if(PP(e))throw new Kd("Planner API Authentication failed. Please verify your API key",e);if(AP(e))throw new Wd(CP,e);const t=e instanceof Error?e.message:String(e);return this.context.emitEvent(Me.PLANNER,Ie.STEP_FAIL,`Planning failed: ${t}`),{id:this.id,error:t}}}}const RL=Xs("ValidatorAgent"),nY=ge.object({is_valid:ge.union([ge.boolean(),ge.string().transform(n=>{if(n.toLowerCase()==="true")return!0;if(n.toLowerCase()==="false")return!1;throw new Error("Invalid boolean string")})]),reason:ge.string(),answer:ge.string()});class sY extends SP{constructor(e,t){super(nY,e,{...t,id:"validator"}),this.plan=null}setPlan(e){this.plan=e}async execute(){try{this.context.emitEvent(Me.VALIDATOR,Ie.STEP_START,"Validating...");let e=await this.prompt.getUserMessage(this.context);this.plan&&(e=new Jt(`${e.content}

The current plan is: 
${this.plan}`));const r=[this.prompt.getSystemMessage(),e],s=await this.invoke(r);if(!s)throw new Error("Failed to validate task result");if(RL.info("validator output",JSON.stringify(s,null,2)),s.is_valid)this.context.emitEvent(Me.VALIDATOR,Ie.STEP_OK,s.answer);else{const i=`The answer is not yet correct. ${s.reason}.`;this.context.emitEvent(Me.VALIDATOR,Ie.STEP_FAIL,i),this.context.actionResults=[new Ct({extractedContent:i,includeInMemory:!0})]}return{id:this.id,result:s}}catch(e){if(PP(e))throw new Kd("Validator API Authentication failed. Please verify your API key",e);if(AP(e))throw new Wd(CP,e);const t=e instanceof Error?e.message:String(e);return RL.error(`Validation failed: ${t}`),this.context.emitEvent(Me.VALIDATOR,Ie.STEP_FAIL,`Validation failed: ${t}`),{id:this.id,error:`Validation failed: ${t}`}}}}class TP{async buildBrowserStateUserMessage(e){const t=await e.browserContext.getState(),r=t.elementTree.clickableElementsToString(e.options.includeAttributes),s=(t.pixelsAbove||0)>0,i=(t.pixelsBelow||0)>0;let a="";r!==""?(s?a=`... ${t.pixelsAbove} pixels above - scroll up to see more ...
${r}`:a=`[Start of page]
${r}`,i?a=`${a}
... ${t.pixelsBelow} pixels below - scroll down to see more ...`:a=`${a}
[End of page]`):a="empty page";let o="";e.stepInfo&&(o=`Current step: ${e.stepInfo.stepNumber+1}/${e.stepInfo.maxSteps}`);const u=new Date().toISOString().slice(0,16).replace("T"," ");o+=`Current date and time: ${u}`;let l="";if(e.actionResults.length>0)for(let h=0;h<e.actionResults.length;h++){const f=e.actionResults[h];if(f.extractedContent&&(l+=`
Action result ${h+1}/${e.actionResults.length}: ${f.extractedContent}`),f.error){const p=f.error.slice(-300);l+=`
Action error ${h+1}/${e.actionResults.length}: ...${p}`}}const d=`
    [Task history memory ends here]
    [Current state starts here]
    You will see the following only once - if you need to remember it and you dont know it yet, write it down in the memory:
    Current tab: {id: ${t.tabId}, url: ${t.url}, title: ${t.title}}
    Other available tabs:
    ${t.tabs.filter(h=>h.id!==t.tabId).map(h=>` - {id: ${h.id}, url: ${h.url}, title: ${h.title}}`).join(`
`)}
    Interactive elements from current page:
    ${a}
    ${o}
    ${l}`;return t.screenshot&&e.options.useVision?new Jt({content:[{type:"text",text:d},{type:"image_url",image_url:{url:`data:image/jpeg;base64,${t.screenshot}`}}]}):new Jt(d)}}class iY extends TP{constructor(e=10){super(),this.maxActionsPerStep=e,this.default_action_description="A placeholder action description"}importantRules(){return`
1. RESPONSE FORMAT: You must ALWAYS respond with valid JSON in this exact format:
   {
     "current_state": {
		"page_summary": "Quick detailed summary of new information from the current page which is not yet in the task history memory. Be specific with details which are important for the task. This is not on the meta level, but should be facts. If all the information is already in the task history memory, leave this empty.",
		"evaluation_previous_goal": "Success|Failed|Unknown - Analyze the current elements and the image to check if the previous goals/actions are successful like intended by the task. Ignore the action result. The website is the ground truth. Also mention if something unexpected happened like new suggestions in an input field. Shortly state why/why not",
       "memory": "Description of what has been done and what you need to remember. Be very specific. Count here ALWAYS how many times you have done something and how many remain. E.g. 0 out of 10 websites analyzed. Continue with abc and xyz",
       "next_goal": "What needs to be done with the next actions"
     },
     "action": [
       {
         "one_action_name": {
           // action-specific parameter
         }
       },
       // ... more actions in sequence
     ]
   }

2. ACTIONS: You can specify multiple actions in the list to be executed in sequence. But always specify only one action name per item.

   Common action sequences:
   - Form filling: [
       {"input_text": {"desc": "Fill title", "index": 1, "text": "example title"}},
       {"input_text": {"desc": "Fill comment", "index": 2, "text": "example comment"}},
       {"click_element": {"desc": "Click submit button", "index": 3}}
     ]
   - Navigation: [
       {"open_tab": {"url": "https://example.com"}},
       {"go_to_url": {"url": "https://example.com"}},
     ]


3. ELEMENT INTERACTION:
   - Only use indexes that exist in the provided element list
   - Each element has a unique index number (e.g., "[33]<button>")
   - Elements marked with "[]Non-interactive text" are non-interactive (for context only)

4. NAVIGATION & ERROR HANDLING:
   - If you need to search in Google, use the search_google action. Don't need to input the search query manually, just use the action.
   - If no suitable elements exist, use other functions to complete the task
   - If stuck, try alternative approaches - like going back to a previous page, new search, new tab etc.
   - Handle popups/cookies by accepting or closing them
   - Use scroll to find elements you are looking for
   - If you want to research something, open a new tab instead of using the current tab
   - If captcha pops up, and you cant solve it, either ask for human help or try to continue the task on a different page.

5. TASK COMPLETION:
   - Use the done action as the last action as soon as the ultimate task is complete
   - Dont use "done" before you are done with everything the user asked you. 
   - If you have to do something repeatedly for example the task says for "each", or "for all", or "x times", count always inside "memory" how many times you have done it and how many remain. Don't stop until you have completed like the task asked you. Only call done after the last step.
   - Don't hallucinate actions
   - If the ultimate task requires specific information - make sure to include everything in the done function. This is what the user will see. Do not just say you are done, but include the requested information of the task.
   - Include exact relevant urls if available, but do NOT make up any urls

6. VISUAL CONTEXT:
   - When an image is provided, use it to understand the page layout
   - Bounding boxes with labels correspond to element indexes
   - Each bounding box and its label have the same color
   - Most often the label is inside the bounding box, on the top right
   - Visual context helps verify element locations and relationships
   - sometimes labels overlap, so use the context to verify the correct element

7. Form filling:
   - If you fill an input field and your action sequence is interrupted, most often a list with suggestions popped up under the field and you need to first select the right element from the suggestion list.

8. ACTION SEQUENCING:
   - Actions are executed in the order they appear in the list
   - Each action should logically follow from the previous one
   - If the page changes after an action, the sequence is interrupted and you get the new state.
   - If content only disappears the sequence continues.
   - Only provide the action sequence until you think the page will change.
   - Try to be efficient, e.g. fill forms at once, or chain actions where nothing changes on the page like saving, extracting, checkboxes...
   - only use multiple actions if it makes sense.

9. Long tasks:
- If the task is long keep track of the status in the memory. If the ultimate task requires multiple subinformation, keep track of the status in the memory.
- If you get stuck, 

10. Extraction:
- When searching for information or conducting research:
  1. First analyze and extract relevant content from the current visible state
  2. If the needed information is incomplete:
     - Use cache_content action to cache the current findings
     - Scroll down EXACTLY ONE PAGE at a time using scroll_page action
     - NEVER scroll more than one page at once as this will cause loss of information
     - Repeat the analyze-cache-scroll cycle until either:
       * All required information is found, or
       * Maximum 5 page scrolls have been performed
  3. Before completing the task:
     - Combine all cached content with the current state
     - Verify all required information is collected
     - Present the complete findings in the done action
- Important extraction guidelines:
  - Be thorough and specific when extracting information
  - Always cache findings before scrolling to avoid losing information
  - Always verify source information before caching
  - Scroll down EXACTLY ONE PAGE at a time
  - Stop after maximum 5 page scrolls
   - use maximum ${this.maxActionsPerStep} actions per sequence`}inputFormat(){return`
INPUT STRUCTURE:
1. Current URL: The webpage you're currently on
2. Available Tabs: List of open browser tabs
3. Interactive Elements: List in the format:
   index[:]<element_type>element_text</element_type>
   - index: Numeric identifier for interaction
   - element_type: HTML element type (button, input, etc.)
   - element_text: Visible text or element description

Example:
[33]<button>Submit Form</button>
[] Non-interactive text


Notes:
- Only elements with numeric indexes inside [] are interactive
- [] elements provide context but cannot be interacted with
`}getSystemMessage(){const e=`You are a precise browser automation agent that interacts with websites through structured commands. Your role is to:
1. Analyze the provided webpage elements and structure
2. Use the given information to accomplish the ultimate task
3. Respond with valid JSON containing your next action sequence and state assessment
4. If the webpage is asking for login credentials, never try to fill it by yourself. Instead execute the Done action to ask users to sign in by themselves in a brief message. Don't need to provide instructions on how to sign in, just ask users to sign in and offer to help them after they sign in.

${this.inputFormat()}

${this.importantRules()}

Functions:
${this.default_action_description}

Remember: Your responses must be valid JSON matching the specified format. Each action in the sequence must be valid.`;return new Rd(e)}async getUserMessage(e){return await this.buildBrowserStateUserMessage(e)}}class aY extends TP{getSystemMessage(){return new Rd(`You are a helpful assistant.

RESPONSIBILITIES:
1. Judge whether the ultimate task is related to web browsing or not and set the "web_task" field.
2. If web_task is false, then just answer the task directly as a helpful assistant
  - Output the answer into "next_steps" field in the JSON object. 
  - Set "done" field to true
  - Set these fields in the JSON object to empty string: "observation", "challenges", "reasoning"
  - Be kind and helpful when answering the task
  - Do NOT offer anything that users don't explicitly ask for.
  - Do NOT make up anything, if you don't know the answer, just say "I don't know"

3. If web_task is true, then helps break down tasks into smaller steps and reason about the current state
  - Analyze the current state and history
  - Evaluate progress towards the ultimate goal
  - Identify potential challenges or roadblocks
  - Suggest the next high-level steps to take
  - If you know the direct URL, use it directly instead of searching for it (e.g. github.com, www.espn.com). Search it if you don't know the direct URL.
  - Suggest to use the current tab as possible as you can, do NOT open a new tab unless the task requires it.
  - IMPORTANT: 
    - Always prioritize working with content visible in the current viewport first:
    - Focus on elements that are immediately visible without scrolling
    - Only suggest scrolling if the required content is confirmed to not be in the current view
    - Scrolling is your LAST resort unless you are explicitly required to do so by the task
    - NEVER suggest scrolling through the entire page, only scroll ONE PAGE at a time.
4. Once web_task is set to either true or false, its value The value must never change from its first set state in the conversation.

RESPONSE FORMAT: Your must always respond with a valid JSON object with the following fields:
{
    "observation": "[string type], brief analysis of the current state and what has been done so far",
    "done": "[boolean type], whether further steps are needed to complete the ultimate task",
    "challenges": "[string type], list any potential challenges or roadblocks",
    "next_steps": "[string type], list 2-3 high-level next steps to take, each step should start with a new line",
    "reasoning": "[string type], explain your reasoning for the suggested next steps",
    "web_task": "[boolean type], whether the ultimate task is related to browsing the web"
}

NOTE:
  - Inside the messages you receive, there will be other AI messages from other agents with different formats.
  - Ignore the output structures of other AI messages.

REMEMBER:
  - Keep your responses concise and focused on actionable insights.`)}async getUserMessage(e){return new Jt("")}}class oY extends TP{constructor(e){super(),this.tasks=[],this.tasks.push(e)}tasksToValidate(){if(this.tasks.length===1)return this.tasks[0];const e=this.tasks[this.tasks.length-1],t=this.tasks.slice(0,-1).map((s,i)=>`${i+1}. ${s}`).join(`
`);return`
${e}

The above task is a follow up task of the following tasks, please take the previous context into account when validating the task.

Previous tasks:
${t}
`}getSystemMessage(){return new Rd(`You are a validator of an agent who interacts with a browser.
YOUR ROLE:
1. Validate if the agent's last action matches the user's request and if the task is completed.
2. Determine if the task is fully completed
3. Answer the task based on the provided context if the task is completed

RULES of ANSWERING THE TASK:
  - Read the task description carefully, neither miss any detailed requirements nor make up any requirements
  - Compile the final answer from provided context, do NOT make up any information not provided in the context
  - Make answers concise and easy to read
  - Include relevant numerical data when available, but do NOT make up any numbers
  - Include exact urls when available, but do NOT make up any urls
  - Format the final answer in a user-friendly way

SPECIAL CASES:
1. If the task is unclear defined, you can let it pass. But if something is missing or the image does not show what was requested, do NOT let it pass
2. Try to understand the page and help the model with suggestions like scroll, do x, ... to get the solution right
3. If the webpage is asking for username or password, you should respond with:
  - is_valid: true
  - reason: describe the reason why it is valid although the task is not completed yet
  - answer: ask the user to sign in by themselves
4. If the output is correct and the task is completed, you should respond with 
  - is_valid: true
  - reason: "Task completed"
  - answer: The final answer to the task

RESPONSE FORMAT: You must ALWAYS respond with valid JSON in this exact format:
{
  "is_valid": true or false,  // Boolean value (not a string) indicating if task is completed correctly
  "reason": string,           // clear explanation of validation result
  "answer": string            // empty string if is_valid is false; human-readable final answer and should not be empty if is_valid is true
}

ANSWER FORMATTING GUIDELINES:
- Start with an emoji "" if is_valid is true
- Use markdown formatting if required by the task description
- By default use plain text
- Use bullet points for multiple items if needed
- Use line breaks for better readability
- Use indentations for nested lists

<example_output>
{
  "is_valid": false, 
  "reason": "The user wanted to search for \\"cat photos\\", but the agent searched for \\"dog photos\\" instead.",
  "answer": ""
}
</example_output>

<example_output>
{
  "is_valid": true, 
  "reason": "The task is completed",
  "answer": " Successfully followed @agent_ai on X."
}
</example_output>

TASK TO VALIDATE: 
${this.tasksToValidate()}`)}async getUserMessage(e){return await this.buildBrowserStateUserMessage(e)}addFollowUpTask(e){this.tasks.push(e)}}const cY=Xs("event-manager");let uY=class{constructor(){this._subscribers=new Map}subscribe(e,t){this._subscribers.has(e)||this._subscribers.set(e,[]);const r=this._subscribers.get(e);r&&!r.includes(t)&&r.push(t)}unsubscribe(e,t){if(this._subscribers.has(e)){const r=this._subscribers.get(e);r&&this._subscribers.set(e,r.filter(s=>s!==t))}}clearSubscribers(e){this._subscribers.has(e)&&this._subscribers.set(e,[])}async emit(e){const t=this._subscribers.get(e.type);if(t)try{await Promise.all(t.map(async r=>await r(e)))}catch(r){cY.error("Error executing event callbacks:",r)}}};const Vi=Xs("Executor");class lY{constructor(e,t,r,s,i){this.tasks=[];const a=new bP({}),o=(i==null?void 0:i.plannerLLM)??s,u=(i==null?void 0:i.validatorLLM)??s,l=(i==null?void 0:i.extractorLLM)??s,d=new uY,h=new N8(t,r,a,d,(i==null?void 0:i.agentOptions)??{});this.tasks.push(e),this.navigatorPrompt=new iY(h.options.maxActionsPerStep),this.plannerPrompt=new aY,this.validatorPrompt=new oY(e);const f=new JX(h,l),p=new QX(f.buildDefaultActions());this.navigator=new eY(p,{chatLLM:s,context:h,prompt:this.navigatorPrompt}),this.planner=new rY({chatLLM:o,context:h,prompt:this.plannerPrompt}),this.validator=new sY({chatLLM:u,context:h,prompt:this.validatorPrompt}),this.context=h,this.context.messageManager.initTaskMessages(this.navigatorPrompt.getSystemMessage(),e)}subscribeExecutionEvents(e){this.context.eventManager.subscribe(Uk.EXECUTION,e)}clearExecutionEvents(){this.context.eventManager.clearSubscribers(Uk.EXECUTION)}addFollowUpTask(e){this.tasks.push(e),this.context.messageManager.addNewTask(e),this.validatorPrompt.addFollowUpTask(e),this.context.actionResults=this.context.actionResults.filter(t=>t.includeInMemory)}async execute(){var r;Vi.info(` Executing task: ${this.tasks[this.tasks.length-1]}`);const e=this.context;e.nSteps=0;const t=this.context.options.maxSteps;try{this.context.emitEvent(Me.SYSTEM,Ie.TASK_START,this.context.taskId);let s=!1,i=0,a=!1;for(i=0;i<t&&(e.stepInfo={stepNumber:e.nSteps,maxSteps:e.options.maxSteps},Vi.info(` Step ${i+1} / ${t}`),!await this.shouldStop());i++){if(this.planner&&(e.nSteps%e.options.planningInterval===0||a)){a=!1,(this.tasks.length>1||i>0)&&await this.navigator.addStateMessageToMemory();const o=await this.planner.execute();if(o.result&&(Vi.info(` Planner output: ${JSON.stringify(o.result,null,2)}`),this.context.messageManager.addPlan(JSON.stringify(o.result),this.context.messageManager.length()-1),o.result.done?(s=!0,this.validator.setPlan(o.result.next_steps)):(this.validator.setPlan(null),s=!1),!o.result.web_task&&o.result.done))break}if(s||(s=await this.navigate()),s&&this.context.options.validateOutput&&!this.context.stopped&&!this.context.paused){if((r=(await this.validator.execute()).result)!=null&&r.is_valid){Vi.info(" Task completed successfully");break}if(a=!0,e.consecutiveValidatorFailures++,e.consecutiveValidatorFailures>=e.options.maxValidatorFailures)throw Vi.error(`Stopping due to ${e.options.maxValidatorFailures} consecutive validator failures`),new Error("Too many failures of validation")}}s?this.context.emitEvent(Me.SYSTEM,Ie.TASK_OK,this.context.taskId):i>=t?(Vi.info(" Task failed: Max steps reached"),this.context.emitEvent(Me.SYSTEM,Ie.TASK_FAIL,"Task failed: Max steps reached")):this.context.stopped?this.context.emitEvent(Me.SYSTEM,Ie.TASK_CANCEL,"Task cancelled"):this.context.emitEvent(Me.SYSTEM,Ie.TASK_PAUSE,"Task paused")}catch(s){const i=s instanceof Error?s.message:String(s);this.context.emitEvent(Me.SYSTEM,Ie.TASK_FAIL,`Task failed: ${i}`)}}async navigate(){var t;const e=this.context;try{if(e.paused||e.stopped)return!1;const r=await this.navigator.execute();if(e.paused||e.stopped)return!1;if(e.nSteps++,r.error)throw new Error(r.error);if(e.consecutiveFailures=0,(t=r.result)!=null&&t.done)return!0}catch(r){if(r instanceof Kd||r instanceof Wd)throw r;if(e.consecutiveFailures++,Vi.error(`Failed to execute step: ${r}`),e.consecutiveFailures>=e.options.maxFailures)throw new Error("Max failures reached")}return!1}async shouldStop(){if(this.context.stopped)return Vi.info("Agent stopped"),!0;for(;this.context.paused;)if(await new Promise(e=>setTimeout(e,200)),this.context.stopped)return!0;return this.context.consecutiveFailures>=this.context.options.maxFailures?(Vi.error(`Stopping due to ${this.context.options.maxFailures} consecutive failures`),!0):!1}async cancel(){this.context.stop()}async resume(){this.context.resume()}async pause(){this.context.pause()}async cleanup(){try{await this.context.browserContext.cleanup()}catch(e){Vi.error(`Failed to cleanup browser context: ${e}`)}}async getCurrentTaskId(){return this.context.taskId}}const IP="RFC3986",OP={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},dY="RFC1738",hY=Array.isArray,Gi=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),RP=1024,fY=(n,e,t,r,s)=>{if(n.length===0)return n;let i=n;if(typeof n=="symbol"?i=Symbol.prototype.toString.call(n):typeof n!="string"&&(i=String(n)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=RP){const u=i.length>=RP?i.slice(o,o+RP):i,l=[];for(let d=0;d<u.length;++d){let h=u.charCodeAt(d);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||s===dY&&(h===40||h===41)){l[l.length]=u.charAt(d);continue}if(h<128){l[l.length]=Gi[h];continue}if(h<2048){l[l.length]=Gi[192|h>>6]+Gi[128|h&63];continue}if(h<55296||h>=57344){l[l.length]=Gi[224|h>>12]+Gi[128|h>>6&63]+Gi[128|h&63];continue}d+=1,h=65536+((h&1023)<<10|u.charCodeAt(d)&1023),l[l.length]=Gi[240|h>>18]+Gi[128|h>>12&63]+Gi[128|h>>6&63]+Gi[128|h&63]}a+=l.join("")}return a};function pY(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function ML(n,e){if(hY(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const mY=Object.prototype.hasOwnProperty,$L={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},Zi=Array.isArray,gY=Array.prototype.push,NL=function(n,e){gY.apply(n,Zi(e)?e:[e])},yY=Date.prototype.toISOString,br={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:fY,encodeValuesOnly:!1,format:IP,formatter:OP[IP],indices:!1,serializeDate(n){return yY.call(n)},skipNulls:!1,strictNullHandling:!1};function wY(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const MP={};function FL(n,e,t,r,s,i,a,o,u,l,d,h,f,p,m,g,y,w){let v=n,b=w,S=0,P=!1;for(;(b=b.get(MP))!==void 0&&!P;){const I=b.get(n);if(S+=1,typeof I<"u"){if(I===S)throw new RangeError("Cyclic object value");P=!0}typeof b.get(MP)>"u"&&(S=0)}if(typeof l=="function"?v=l(e,v):v instanceof Date?v=f==null?void 0:f(v):t==="comma"&&Zi(v)&&(v=ML(v,function(I){return I instanceof Date?f==null?void 0:f(I):I})),v===null){if(i)return u&&!g?u(e,br.encoder,y,"key",p):e;v=""}if(wY(v)||pY(v)){if(u){const I=g?e:u(e,br.encoder,y,"key",p);return[(m==null?void 0:m(I))+"="+(m==null?void 0:m(u(v,br.encoder,y,"value",p)))]}return[(m==null?void 0:m(e))+"="+(m==null?void 0:m(String(v)))]}const k=[];if(typeof v>"u")return k;let C;if(t==="comma"&&Zi(v))g&&u&&(v=ML(v,u)),C=[{value:v.length>0?v.join(",")||null:void 0}];else if(Zi(l))C=l;else{const I=Object.keys(v);C=d?I.sort(d):I}const E=o?String(e).replace(/\./g,"%2E"):String(e),M=r&&Zi(v)&&v.length===1?E+"[]":E;if(s&&Zi(v)&&v.length===0)return M+"[]";for(let I=0;I<C.length;++I){const N=C[I],O=typeof N=="object"&&typeof N.value<"u"?N.value:v[N];if(a&&O===null)continue;const T=h&&o?N.replace(/\./g,"%2E"):N,L=Zi(v)?typeof t=="function"?t(M,T):M:M+(h?"."+T:"["+T+"]");w.set(n,S);const U=new WeakMap;U.set(MP,w),NL(k,FL(O,L,t,r,s,i,a,o,t==="comma"&&g&&Zi(v)?null:u,l,d,h,f,p,m,g,y,U))}return k}function vY(n=br){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||br.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=IP;if(typeof n.format<"u"){if(!mY.call(OP,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=OP[t];let s=br.filter;(typeof n.filter=="function"||Zi(n.filter))&&(s=n.filter);let i;if(n.arrayFormat&&n.arrayFormat in $L?i=n.arrayFormat:"indices"in n?i=n.indices?"indices":"repeat":i=br.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:br.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:br.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:br.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:br.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?br.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:br.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:br.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:br.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:br.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:br.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:br.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:br.strictNullHandling}}function _Y(n,e={}){let t=n;const r=vY(e);let s,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):Zi(r.filter)&&(i=r.filter,s=i);const a=[];if(typeof t!="object"||t===null)return"";const o=$L[r.arrayFormat],u=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);const l=new WeakMap;for(let f=0;f<s.length;++f){const p=s[f];r.skipNulls&&t[p]===null||NL(a,FL(t[p],p,o,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}const d=a.join(r.delimiter);let h=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),d.length>0?h+d:""}const zd="4.82.0";let LL=!1,Lm,jL,DL,$P,BL,UL,qL,HL,KL;function bY(n,e={auto:!1}){if(LL)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(Lm)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${Lm}'\``);LL=e.auto,Lm=n.kind,jL=n.fetch,DL=n.FormData,$P=n.File,BL=n.ReadableStream,UL=n.getMultipartRequestOptions,qL=n.getDefaultAgent,HL=n.fileFromPath,KL=n.isFsReadStream}let SY=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function xY({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new SY(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Lm||bY(xY(),{auto:!0});let st=class extends Error{},qn=class oR extends st{constructor(e,t,r,s){super(`${oR.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new h0({message:r,cause:jP(t)});const i=t==null?void 0:t.error;return e===400?new WL(e,i,r,s):e===401?new zL(e,i,r,s):e===403?new VL(e,i,r,s):e===404?new GL(e,i,r,s):e===409?new ZL(e,i,r,s):e===422?new JL(e,i,r,s):e===429?new XL(e,i,r,s):e>=500?new YL(e,i,r,s):new oR(e,i,r,s)}},$s=class extends qn{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},h0=class extends qn{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},f0=class extends h0{constructor({message:e}={}){super({message:e??"Request timed out."})}},WL=class extends qn{},zL=class extends qn{},VL=class extends qn{},GL=class extends qn{},ZL=class extends qn{},JL=class extends qn{},XL=class extends qn{},YL=class extends qn{},QL=class extends st{constructor(){super("Could not parse response content as the length limit was reached")}},ej=class extends st{constructor(){super("Could not parse response content as the request was rejected by the content filter")}},p0=class cR{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=cR.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(cR.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new st(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new st(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new st("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};p0.NEWLINE_CHARS=new Set([`
`,"\r"]),p0.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function tj(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}let jm=class R_{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of EY(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(o&&o.error)throw new qn(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(a.event=="error")throw new qn(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new R_(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new p0,o=tj(e);for await(const u of o)for(const l of a.decode(u))yield l;for(const u of a.flush())yield u}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new R_(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new R_(()=>s(e),this.controller),new R_(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new BL({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}};async function*EY(n,e){if(!n.body)throw e.abort(),new st("Attempted to iterate over a response with no body");const t=new PY,r=new p0,s=tj(n.body);for await(const i of kY(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*kY(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=CY(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function CY(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}let PY=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=AY(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function AY(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}const rj=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",nj=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&m0(n),m0=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",TY=n=>nj(n)||rj(n)||KL(n);async function sj(n,e,t){var s;if(n=await n,nj(n))return n;if(rj(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=m0(i)?[await i.arrayBuffer()]:[i];return new $P(a,e,t)}const r=await IY(n);if(e||(e=RY(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new $P(r,e,t)}async function IY(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(m0(n))e.push(await n.arrayBuffer());else if(MY(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${OY(n)}`);return e}function OY(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function RY(n){var e;return NP(n.name)||NP(n.filename)||((e=NP(n.path))==null?void 0:e.split(/[\\/]/).pop())}const NP=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},MY=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",ij=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",Vd=async n=>{const e=await $Y(n.body);return UL(e,n)},$Y=async n=>{const e=new DL;return await Promise.all(Object.entries(n||{}).map(([t,r])=>FP(e,t,r))),e},FP=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(TY(t)){const r=await sj(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>FP(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>FP(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var NY=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},FY=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},g0;async function aj(n){const{response:e}=n;if(n.options.stream)return Gd("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):jm.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return Gd("response",e.status,e.url,e.headers,i),oj(i,e)}const s=await e.text();return Gd("response",e.status,e.url,e.headers,s),s}function oj(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}let cj=class s6 extends Promise{constructor(e,t=aj){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new s6(this.responsePromise,async t=>oj(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},LY=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=LP("maxRetries",t),this.timeout=LP("timeout",r),this.httpAgent=s,this.fetch=i??jL}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...HY(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${VY()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&m0(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var g;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:ij(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,u=this.calculateContentLength(o),l=this.buildURL(s,i);"timeout"in e&&LP("timeout",e.timeout);const d=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??qL(l),f=d+1e3;typeof((g=h==null?void 0:h.options)==null?void 0:g.timeout)=="number"&&f>(h.options.timeout??0)&&(h.options.timeout=f),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const p=this.buildHeaders({options:e,headers:a,contentLength:u,retryCount:t});return{req:{method:r,...o&&{body:o},headers:p,...h&&{agent:h},signal:e.signal??null},url:l,timeout:d}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return mj(i,a),mj(i,t),ij(e.body)&&Lm!=="node"&&delete i["content-type"],yj(a,"x-stainless-retry-count")===void 0&&yj(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return qn.generate(e,t,r,s)}request(e,t=null){return new cj(this.makeRequest(e,t))}async makeRequest(e,t){var h,f;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),Gd("request",a,r,i.headers),(h=r.signal)!=null&&h.aborted)throw new $s;const u=new AbortController,l=await this.fetchWithTimeout(a,i,o,u).catch(jP);if(l instanceof Error){if((f=r.signal)!=null&&f.aborted)throw new $s;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new f0:new h0({cause:l})}const d=DY(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){const v=`retrying, ${t} attempts remaining`;return Gd(`response (error; ${v})`,l.status,a,d),this.retryRequest(r,t,d)}const p=await l.text().catch(v=>jP(v).message),m=KY(p),g=m?void 0:p;throw Gd(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,d,g),this.makeStatusError(l.status,m,g,d)}return{response:l,options:r,controller:u}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new jY(this,r,e)}buildURL(e,t){const r=zY(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return fj(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new st(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r),u={signal:s.signal,...a};return u.method&&(u.method=u.method.toUpperCase()),this.fetch.call(void 0,e,u).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Dm(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${zd}`}},uj=class{constructor(e,t,r,s){g0.set(this,void 0),NY(this,g0,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new st("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await FY(this,g0,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(g0=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},jY=class extends cj{constructor(e,t,r){super(t,async s=>new r(e,s.response,await aj(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const DY=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),BY={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Hn=n=>typeof n=="object"&&n!==null&&!fj(n)&&Object.keys(n).every(e=>pj(BY,e)),UY=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":zd,"X-Stainless-OS":dj(Deno.build.os),"X-Stainless-Arch":lj(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":zd,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":zd,"X-Stainless-OS":dj(process.platform),"X-Stainless-Arch":lj(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=qY();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":zd,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":zd,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function qY(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const lj=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",dj=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let hj;const HY=()=>hj??(hj=UY()),KY=n=>{try{return JSON.parse(n)}catch{return}},WY=/^[a-z][a-z0-9+.-]*:/i,zY=n=>WY.test(n),Dm=n=>new Promise(e=>setTimeout(e,n)),LP=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new st(`${n} must be an integer`);if(e<0)throw new st(`${n} must be a positive integer`);return e},jP=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},y0=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function fj(n){if(!n)return!0;for(const e in n)return!1;return!0}function pj(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function mj(n,e){for(const t in e){if(!pj(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}const gj=new Set(["authorization","api-key"]);function Gd(n,...e){var t;if(typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"){const r=e.map(s=>{if(!s)return s;if(s.headers){const a={...s,headers:{...s.headers}};for(const o in s.headers)gj.has(o.toLowerCase())&&(a.headers[o]="REDACTED");return a}let i=null;for(const a in s)gj.has(a.toLowerCase())&&(i??(i={...s}),i[a]="REDACTED");return i??s});console.log(`OpenAI:DEBUG:${n}`,...r)}}const VY=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),GY=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",ZY=n=>typeof(n==null?void 0:n.get)=="function",yj=(n,e)=>{var r;const t=e.toLowerCase();if(ZY(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};function DP(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}let JY=class extends uj{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}},oi=class extends uj{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}},xt=class{constructor(e){this._client=e}},wj=class extends xt{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},BP=class extends xt{constructor(){super(...arguments),this.completions=new wj(this._client)}};BP.Completions=wj;let vj=class extends xt{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}},_j=class extends xt{create(e,t){return this._client.post("/audio/transcriptions",Vd({body:e,...t}))}},bj=class extends xt{create(e,t){return this._client.post("/audio/translations",Vd({body:e,...t}))}},Bm=class extends xt{constructor(){super(...arguments),this.transcriptions=new _j(this._client),this.translations=new bj(this._client),this.speech=new vj(this._client)}};Bm.Transcriptions=_j,Bm.Translations=bj,Bm.Speech=vj;let UP=class extends xt{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Hn(e)?this.list({},e):this._client.getAPIList("/batches",qP,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}},qP=class extends oi{};UP.BatchesPage=qP;let HP=class extends xt{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return Hn(e)?this.list({},e):this._client.getAPIList("/assistants",KP,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}},KP=class extends oi{};HP.AssistantsPage=KP;function Sj(n){return typeof n.parse=="function"}const Zd=n=>(n==null?void 0:n.role)==="assistant",xj=n=>(n==null?void 0:n.role)==="function",Ej=n=>(n==null?void 0:n.role)==="tool";var ci=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},er=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},WP,w0,v0,Um,qm,_0,Hm,Fa,Km,b0,S0,Jd,kj;let Cj=class{constructor(){WP.add(this),this.controller=new AbortController,w0.set(this,void 0),v0.set(this,()=>{}),Um.set(this,()=>{}),qm.set(this,void 0),_0.set(this,()=>{}),Hm.set(this,()=>{}),Fa.set(this,{}),Km.set(this,!1),b0.set(this,!1),S0.set(this,!1),Jd.set(this,!1),ci(this,w0,new Promise((e,t)=>{ci(this,v0,e,"f"),ci(this,Um,t,"f")}),"f"),ci(this,qm,new Promise((e,t)=>{ci(this,_0,e,"f"),ci(this,Hm,t,"f")}),"f"),er(this,w0,"f").catch(()=>{}),er(this,qm,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},er(this,WP,"m",kj).bind(this))},0)}_connected(){this.ended||(er(this,v0,"f").call(this),this._emit("connect"))}get ended(){return er(this,Km,"f")}get errored(){return er(this,b0,"f")}get aborted(){return er(this,S0,"f")}abort(){this.controller.abort()}on(e,t){return(er(this,Fa,"f")[e]||(er(this,Fa,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=er(this,Fa,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(er(this,Fa,"f")[e]||(er(this,Fa,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{ci(this,Jd,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){ci(this,Jd,!0,"f"),await er(this,qm,"f")}_emit(e,...t){if(er(this,Km,"f"))return;e==="end"&&(ci(this,Km,!0,"f"),er(this,_0,"f").call(this));const r=er(this,Fa,"f")[e];if(r&&(er(this,Fa,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!er(this,Jd,"f")&&!(r!=null&&r.length)&&Promise.reject(s),er(this,Um,"f").call(this,s),er(this,Hm,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!er(this,Jd,"f")&&!(r!=null&&r.length)&&Promise.reject(s),er(this,Um,"f").call(this,s),er(this,Hm,"f").call(this,s),this._emit("end")}}_emitFinal(){}};w0=new WeakMap,v0=new WeakMap,Um=new WeakMap,qm=new WeakMap,_0=new WeakMap,Hm=new WeakMap,Fa=new WeakMap,Km=new WeakMap,b0=new WeakMap,S0=new WeakMap,Jd=new WeakMap,WP=new WeakSet,kj=function(e){if(ci(this,b0,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new $s),e instanceof $s)return ci(this,S0,!0,"f"),this._emit("abort",e);if(e instanceof st)return this._emit("error",e);if(e instanceof Error){const t=new st(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new st(String(e)))};function XY(n,e){const t={...n};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function Pj(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function YY(n,{parser:e,callback:t}){const r={...n};return Object.defineProperties(r,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),r}function Wm(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function QY(n,e){return!e||!Aj(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:zP(n,e)}function zP(n,e){const t=n.choices.map(r=>{var s;if(r.finish_reason==="length")throw new QL;if(r.finish_reason==="content_filter")throw new ej;return{...r,message:{...r.message,tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(i=>tQ(e,i)))??[],parsed:r.message.content&&!r.message.refusal?eQ(e,r.message.content):null}}});return{...n,choices:t}}function eQ(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function tQ(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Wm(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function rQ(n,e){var r;if(!n)return!1;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return Wm(t)||(t==null?void 0:t.function.strict)||!1}function Aj(n){var e;return Pj(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>Wm(t)||t.type==="function"&&t.function.strict===!0))??!1}function nQ(n){for(const e of n??[]){if(e.type!=="function")throw new st(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new st(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Kn=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},cn,VP,x0,GP,ZP,JP,Tj,XP;const Ij=10;let Oj=class extends Cj{constructor(){super(...arguments),cn.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(xj(e)||Ej(e))&&e.content)this._emit("functionCallResult",e.content);else if(Zd(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Zd(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new st("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Kn(this,cn,"m",VP).call(this)}async finalMessage(){return await this.done(),Kn(this,cn,"m",x0).call(this)}async finalFunctionCall(){return await this.done(),Kn(this,cn,"m",GP).call(this)}async finalFunctionCallResult(){return await this.done(),Kn(this,cn,"m",ZP).call(this)}async totalUsage(){return await this.done(),Kn(this,cn,"m",JP).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Kn(this,cn,"m",x0).call(this);t&&this._emit("finalMessage",t);const r=Kn(this,cn,"m",VP).call(this);r&&this._emit("finalContent",r);const s=Kn(this,cn,"m",GP).call(this);s&&this._emit("finalFunctionCall",s);const i=Kn(this,cn,"m",ZP).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",Kn(this,cn,"m",JP).call(this))}async _createChatCompletion(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Kn(this,cn,"m",Tj).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(zP(i,t))}async _runChatCompletion(e,t,r){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var f;const s="function",{function_call:i="auto",stream:a,...o}=t,u=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:l=Ij}=r||{},d={};for(const p of t.functions)d[p.name||p.function.name]=p;const h=t.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(const p of t.messages)this._addMessage(p,!1);for(let p=0;p<l;++p){const g=(f=(await this._createChatCompletion(e,{...o,function_call:i,functions:h,messages:[...this.messages]},r)).choices[0])==null?void 0:f.message;if(!g)throw new st("missing message in ChatCompletion response");if(!g.function_call)return;const{name:y,arguments:w}=g.function_call,v=d[y];if(v){if(u&&u!==y){const k=`Invalid function_call: ${JSON.stringify(y)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,name:y,content:k});continue}}else{const k=`Invalid function_call: ${JSON.stringify(y)}. Available options are: ${h.map(C=>JSON.stringify(C.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:y,content:k});continue}let b;try{b=Sj(v)?await v.parse(w):w}catch(k){this._addMessage({role:s,name:y,content:k instanceof Error?k.message:String(k)});continue}const S=await v.function(b,this),P=Kn(this,cn,"m",XP).call(this,S);if(this._addMessage({role:s,name:y,content:P}),u)return}}async _runTools(e,t,r){var p,m,g;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,u=typeof i!="string"&&((p=i==null?void 0:i.function)==null?void 0:p.name),{maxChatCompletions:l=Ij}=r||{},d=t.tools.map(y=>{if(Wm(y)){if(!y.$callback)throw new st("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:y.$callback,name:y.function.name,description:y.function.description||"",parameters:y.function.parameters,parse:y.$parseRaw,strict:!0}}}return y}),h={};for(const y of d)y.type==="function"&&(h[y.function.name||y.function.function.name]=y.function);const f="tools"in t?d.map(y=>y.type==="function"?{type:"function",function:{name:y.function.name||y.function.function.name,parameters:y.function.parameters,description:y.function.description,strict:y.function.strict}}:y):void 0;for(const y of t.messages)this._addMessage(y,!1);for(let y=0;y<l;++y){const v=(m=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:f,messages:[...this.messages]},r)).choices[0])==null?void 0:m.message;if(!v)throw new st("missing message in ChatCompletion response");if(!((g=v.tool_calls)!=null&&g.length))return;for(const b of v.tool_calls){if(b.type!=="function")continue;const S=b.id,{name:P,arguments:k}=b.function,C=h[P];if(C){if(u&&u!==P){const N=`Invalid tool_call: ${JSON.stringify(P)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,tool_call_id:S,content:N});continue}}else{const N=`Invalid tool_call: ${JSON.stringify(P)}. Available options are: ${Object.keys(h).map(O=>JSON.stringify(O)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:S,content:N});continue}let E;try{E=Sj(C)?await C.parse(k):k}catch(N){const O=N instanceof Error?N.message:String(N);this._addMessage({role:s,tool_call_id:S,content:O});continue}const M=await C.function(E,this),I=Kn(this,cn,"m",XP).call(this,M);if(this._addMessage({role:s,tool_call_id:S,content:I}),u)return}}}};cn=new WeakSet,VP=function(){return Kn(this,cn,"m",x0).call(this).content??null},x0=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Zd(t)){const{function_call:r,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return r&&(i.function_call=r),i}}throw new st("stream ended without producing a ChatCompletionMessage with role=assistant")},GP=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(Zd(s)&&(s!=null&&s.function_call))return s.function_call;if(Zd(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},ZP=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(xj(t)&&t.content!=null||Ej(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},JP=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Tj=function(e){if(e.n!=null&&e.n>1)throw new st("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},XP=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};let Rj=class uR extends Oj{static runFunctions(e,t,r){const s=new uR,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new uR,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),Zd(e)&&e.content&&this._emit("content",e.content)}};const Mj=1,$j=2,Nj=4,Fj=8,Lj=16,jj=32,Dj=64,Bj=128,Uj=256,qj=Bj|Uj,Hj=Lj|jj|qj|Dj,Kj=Mj|$j|Hj,Wj=Nj|Fj,sQ=Kj|Wj,Lr={STR:Mj,NUM:$j,ARR:Nj,OBJ:Fj,NULL:Lj,BOOL:jj,NAN:Dj,INFINITY:Bj,MINUS_INFINITY:Uj,INF:qj,SPECIAL:Hj,ATOM:Kj,COLLECTION:Wj,ALL:sQ};let iQ=class extends Error{},aQ=class extends Error{};function oQ(n,e=Lr.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return cQ(n.trim(),e)}const cQ=(n,e)=>{const t=n.length;let r=0;const s=f=>{throw new iQ(`${f} at position ${r}`)},i=f=>{throw new aQ(`${f} at position ${r}`)},a=()=>(h(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?u():n[r]==="["?l():n.substring(r,r+4)==="null"||Lr.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||Lr.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||Lr.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||Lr.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||Lr.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||Lr.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):d()),o=()=>{const f=r;let p=!1;for(r++;r<t&&(n[r]!=='"'||p&&n[r-1]==="\\");)p=n[r]==="\\"?!p:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(f,++r-Number(p)))}catch(m){i(String(m))}else if(Lr.STR&e)try{return JSON.parse(n.substring(f,r-Number(p))+'"')}catch{return JSON.parse(n.substring(f,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},u=()=>{r++,h();const f={};try{for(;n[r]!=="}";){if(h(),r>=t&&Lr.OBJ&e)return f;const p=o();h(),r++;try{const m=a();Object.defineProperty(f,p,{value:m,writable:!0,enumerable:!0,configurable:!0})}catch(m){if(Lr.OBJ&e)return f;throw m}h(),n[r]===","&&r++}}catch{if(Lr.OBJ&e)return f;s("Expected '}' at end of object")}return r++,f},l=()=>{r++;const f=[];try{for(;n[r]!=="]";)f.push(a()),h(),n[r]===","&&r++}catch{if(Lr.ARR&e)return f;s("Expected ']' at end of array")}return r++,f},d=()=>{if(r===0){n==="-"&&Lr.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(p){if(Lr.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}i(String(p))}}const f=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(Lr.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(f,r))}catch{n.substring(f,r)==="-"&&Lr.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(f,n.lastIndexOf("e")))}catch(m){i(String(m))}}},h=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return a()},zj=n=>oQ(n,Lr.ALL^Lr.NUM);var Xd=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Ft=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Sr,La,Yd,Wo,YP,E0,QP,eA,tA,k0,rA,Vj;let Gj=class lR extends Oj{constructor(e){super(),Sr.add(this),La.set(this,void 0),Yd.set(this,void 0),Wo.set(this,void 0),Xd(this,La,e,"f"),Xd(this,Yd,[],"f")}get currentChatCompletionSnapshot(){return Ft(this,Wo,"f")}static fromReadableStream(e){const t=new lR(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const s=new lR(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var a;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Ft(this,Sr,"m",YP).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)Ft(this,Sr,"m",QP).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new $s;return this._addChatCompletion(Ft(this,Sr,"m",k0).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Ft(this,Sr,"m",YP).call(this),this._connected();const s=jm.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(Ft(this,Sr,"m",k0).call(this)),Ft(this,Sr,"m",QP).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new $s;return this._addChatCompletion(Ft(this,Sr,"m",k0).call(this))}[(La=new WeakMap,Yd=new WeakMap,Wo=new WeakMap,Sr=new WeakSet,YP=function(){this.ended||Xd(this,Wo,void 0,"f")},E0=function(t){let r=Ft(this,Yd,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Ft(this,Yd,"f")[t.index]=r,r)},QP=function(t){var s,i,a,o,u,l,d,h,f,p,m,g,y,w,v;if(this.ended)return;const r=Ft(this,Sr,"m",Vj).call(this,t);this._emit("chunk",t,r);for(const b of t.choices){const S=r.choices[b.index];b.delta.content!=null&&((s=S.message)==null?void 0:s.role)==="assistant"&&((i=S.message)!=null&&i.content)&&(this._emit("content",b.delta.content,S.message.content),this._emit("content.delta",{delta:b.delta.content,snapshot:S.message.content,parsed:S.message.parsed})),b.delta.refusal!=null&&((a=S.message)==null?void 0:a.role)==="assistant"&&((o=S.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:b.delta.refusal,snapshot:S.message.refusal}),((u=b.logprobs)==null?void 0:u.content)!=null&&((l=S.message)==null?void 0:l.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(d=b.logprobs)==null?void 0:d.content,snapshot:((h=S.logprobs)==null?void 0:h.content)??[]}),((f=b.logprobs)==null?void 0:f.refusal)!=null&&((p=S.message)==null?void 0:p.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(m=b.logprobs)==null?void 0:m.refusal,snapshot:((g=S.logprobs)==null?void 0:g.refusal)??[]});const P=Ft(this,Sr,"m",E0).call(this,S);S.finish_reason&&(Ft(this,Sr,"m",tA).call(this,S),P.current_tool_call_index!=null&&Ft(this,Sr,"m",eA).call(this,S,P.current_tool_call_index));for(const k of b.delta.tool_calls??[])P.current_tool_call_index!==k.index&&(Ft(this,Sr,"m",tA).call(this,S),P.current_tool_call_index!=null&&Ft(this,Sr,"m",eA).call(this,S,P.current_tool_call_index)),P.current_tool_call_index=k.index;for(const k of b.delta.tool_calls??[]){const C=(y=S.message.tool_calls)==null?void 0:y[k.index];C!=null&&C.type&&((C==null?void 0:C.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(w=C.function)==null?void 0:w.name,index:k.index,arguments:C.function.arguments,parsed_arguments:C.function.parsed_arguments,arguments_delta:((v=k.function)==null?void 0:v.arguments)??""}):(C==null||C.type,void 0))}}},eA=function(t,r){var a,o,u;if(Ft(this,Sr,"m",E0).call(this,t).done_tool_calls.has(r))return;const i=(a=t.message.tool_calls)==null?void 0:a[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const l=(u=(o=Ft(this,La,"f"))==null?void 0:o.tools)==null?void 0:u.find(d=>d.type==="function"&&d.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:Wm(l)?l.$parseRaw(i.function.arguments):l!=null&&l.function.strict?JSON.parse(i.function.arguments):null})}else i.type},tA=function(t){var s,i;const r=Ft(this,Sr,"m",E0).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const a=Ft(this,Sr,"m",rA).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},k0=function(){if(this.ended)throw new st("stream has ended, this shouldn't happen");const t=Ft(this,Wo,"f");if(!t)throw new st("request ended without sending any chunks");return Xd(this,Wo,void 0,"f"),Xd(this,Yd,[],"f"),uQ(t,Ft(this,La,"f"))},rA=function(){var r;const t=(r=Ft(this,La,"f"))==null?void 0:r.response_format;return Pj(t)?t:null},Vj=function(t){var r,s,i,a;let o=Ft(this,Wo,"f");const{choices:u,...l}=t;o?Object.assign(o,l):o=Xd(this,Wo,{...l,choices:[]},"f");for(const{delta:d,finish_reason:h,index:f,logprobs:p=null,...m}of t.choices){let g=o.choices[f];if(g||(g=o.choices[f]={finish_reason:h,index:f,message:{},logprobs:p,...m}),p)if(!g.logprobs)g.logprobs=Object.assign({},p);else{const{content:k,refusal:C,...E}=p;Object.assign(g.logprobs,E),k&&((r=g.logprobs).content??(r.content=[]),g.logprobs.content.push(...k)),C&&((s=g.logprobs).refusal??(s.refusal=[]),g.logprobs.refusal.push(...C))}if(h&&(g.finish_reason=h,Ft(this,La,"f")&&Aj(Ft(this,La,"f")))){if(h==="length")throw new QL;if(h==="content_filter")throw new ej}if(Object.assign(g,m),!d)continue;const{content:y,refusal:w,function_call:v,role:b,tool_calls:S,...P}=d;if(Object.assign(g.message,P),w&&(g.message.refusal=(g.message.refusal||"")+w),b&&(g.message.role=b),v&&(g.message.function_call?(v.name&&(g.message.function_call.name=v.name),v.arguments&&((i=g.message.function_call).arguments??(i.arguments=""),g.message.function_call.arguments+=v.arguments)):g.message.function_call=v),y&&(g.message.content=(g.message.content||"")+y,!g.message.refusal&&Ft(this,Sr,"m",rA).call(this)&&(g.message.parsed=zj(g.message.content))),S){g.message.tool_calls||(g.message.tool_calls=[]);for(const{index:k,id:C,type:E,function:M,...I}of S){const N=(a=g.message.tool_calls)[k]??(a[k]={});Object.assign(N,I),C&&(N.id=C),E&&(N.type=E),M&&(N.function??(N.function={name:M.name??"",arguments:""})),M!=null&&M.name&&(N.function.name=M.name),M!=null&&M.arguments&&(N.function.arguments+=M.arguments,rQ(Ft(this,La,"f"),N)&&(N.function.parsed_arguments=zj(N.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new jm(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function uQ(n,e){const{id:t,choices:r,created:s,model:i,system_fingerprint:a,...o}=n,u={...o,id:t,choices:r.map(({message:l,finish_reason:d,index:h,logprobs:f,...p})=>{if(!d)throw new st(`missing finish_reason for choice ${h}`);const{content:m=null,function_call:g,tool_calls:y,...w}=l,v=l.role;if(!v)throw new st(`missing role for choice ${h}`);if(g){const{arguments:b,name:S}=g;if(b==null)throw new st(`missing function_call.arguments for choice ${h}`);if(!S)throw new st(`missing function_call.name for choice ${h}`);return{...p,message:{content:m,function_call:{arguments:b,name:S},role:v,refusal:l.refusal??null},finish_reason:d,index:h,logprobs:f}}return y?{...p,index:h,finish_reason:d,logprobs:f,message:{...w,role:v,content:m,refusal:l.refusal??null,tool_calls:y.map((b,S)=>{const{function:P,type:k,id:C,...E}=b,{arguments:M,name:I,...N}=P||{};if(C==null)throw new st(`missing choices[${h}].tool_calls[${S}].id
${C0(n)}`);if(k==null)throw new st(`missing choices[${h}].tool_calls[${S}].type
${C0(n)}`);if(I==null)throw new st(`missing choices[${h}].tool_calls[${S}].function.name
${C0(n)}`);if(M==null)throw new st(`missing choices[${h}].tool_calls[${S}].function.arguments
${C0(n)}`);return{...E,id:C,type:k,function:{...N,name:I,arguments:M}}})}}:{...p,message:{...w,content:m,role:v,refusal:l.refusal??null},finish_reason:d,index:h,logprobs:f}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return QY(u,e)}function C0(n){return JSON.stringify(n)}function Tle(n){}let Zj=class gE extends Gj{static fromReadableStream(e){const t=new gE(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const s=new gE(null),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new gE(t),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}},Jj=class extends xt{parse(e,t){return nQ(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>zP(r,e))}runFunctions(e,t){return e.stream?Zj.runFunctions(this._client,e,t):Rj.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Zj.runTools(this._client,e,t):Rj.runTools(this._client,e,t)}stream(e,t){return Gj.createChatCompletion(this._client,e,t)}},nA=class extends xt{constructor(){super(...arguments),this.completions=new Jj(this._client)}};(function(n){n.Completions=Jj})(nA||(nA={}));let Xj=class extends xt{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}},sA=class extends xt{constructor(){super(...arguments),this.sessions=new Xj(this._client)}};sA.Sessions=Xj;var Ne=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},fs=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Xr,iA,Ji,P0,ui,vu,Qd,_u,A0,ps,T0,I0,zm,Vm,Gm,Yj,Qj,eD,tD,rD,nD,sD;let eh=class M_ extends Cj{constructor(){super(...arguments),Xr.add(this),iA.set(this,[]),Ji.set(this,{}),P0.set(this,{}),ui.set(this,void 0),vu.set(this,void 0),Qd.set(this,void 0),_u.set(this,void 0),A0.set(this,void 0),ps.set(this,void 0),T0.set(this,void 0),I0.set(this,void 0),zm.set(this,void 0)}[(iA=new WeakMap,Ji=new WeakMap,P0=new WeakMap,ui=new WeakMap,vu=new WeakMap,Qd=new WeakMap,_u=new WeakMap,A0=new WeakMap,ps=new WeakMap,T0=new WeakMap,I0=new WeakMap,zm=new WeakMap,Xr=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new M_;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=jm.fromReadableStream(e,this.controller);for await(const a of s)Ne(this,Xr,"m",Vm).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new $s;return this._addRun(Ne(this,Xr,"m",Gm).call(this))}toReadableStream(){return new jm(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,i){const a=new M_;return a._run(()=>a._runToolAssistantStream(e,t,r,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,s,i){var l;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},u=await e.submitToolOutputs(t,r,o,{...i,signal:this.controller.signal});this._connected();for await(const d of u)Ne(this,Xr,"m",Vm).call(this,d);if((l=u.controller.signal)!=null&&l.aborted)throw new $s;return this._addRun(Ne(this,Xr,"m",Gm).call(this))}static createThreadAssistantStream(e,t,r){const s=new M_;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){const i=new M_;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return Ne(this,T0,"f")}currentRun(){return Ne(this,I0,"f")}currentMessageSnapshot(){return Ne(this,ui,"f")}currentRunStepSnapshot(){return Ne(this,zm,"f")}async finalRunSteps(){return await this.done(),Object.values(Ne(this,Ji,"f"))}async finalMessages(){return await this.done(),Object.values(Ne(this,P0,"f"))}async finalRun(){if(await this.done(),!Ne(this,vu,"f"))throw Error("Final run was not received.");return Ne(this,vu,"f")}async _createThreadAssistantStream(e,t,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const u of a)Ne(this,Xr,"m",Vm).call(this,u);if((o=a.controller.signal)!=null&&o.aborted)throw new $s;return this._addRun(Ne(this,Xr,"m",Gm).call(this))}async _createAssistantStream(e,t,r,s){var u;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const l of o)Ne(this,Xr,"m",Vm).call(this,l);if((u=o.controller.signal)!=null&&u.aborted)throw new $s;return this._addRun(Ne(this,Xr,"m",Gm).call(this))}static accumulateDelta(e,t){for(const[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(DP(i)&&DP(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(const a of s){if(!DP(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const u=i[o];u==null?i.push(a):i[o]=this.accumulateDelta(u,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,i){return await this._createToolAssistantStream(r,e,t,s,i)}};Vm=function(e){if(!this.ended)switch(fs(this,T0,e,"f"),Ne(this,Xr,"m",eD).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":Ne(this,Xr,"m",sD).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Ne(this,Xr,"m",Qj).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":Ne(this,Xr,"m",Yj).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Gm=function(){if(this.ended)throw new st("stream has ended, this shouldn't happen");if(!Ne(this,vu,"f"))throw Error("Final run has not been received");return Ne(this,vu,"f")},Yj=function(e){const[t,r]=Ne(this,Xr,"m",rD).call(this,e,Ne(this,ui,"f"));fs(this,ui,t,"f"),Ne(this,P0,"f")[t.id]=t;for(const s of r){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=Ne(this,Qd,"f")){if(Ne(this,_u,"f"))switch(Ne(this,_u,"f").type){case"text":this._emit("textDone",Ne(this,_u,"f").text,Ne(this,ui,"f"));break;case"image_file":this._emit("imageFileDone",Ne(this,_u,"f").image_file,Ne(this,ui,"f"));break}fs(this,Qd,s.index,"f")}fs(this,_u,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(Ne(this,Qd,"f")!==void 0){const s=e.data.content[Ne(this,Qd,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,Ne(this,ui,"f"));break;case"text":this._emit("textDone",s.text,Ne(this,ui,"f"));break}}Ne(this,ui,"f")&&this._emit("messageDone",e.data),fs(this,ui,void 0,"f")}},Qj=function(e){const t=Ne(this,Xr,"m",tD).call(this,e);switch(fs(this,zm,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==Ne(this,A0,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(Ne(this,ps,"f")&&this._emit("toolCallDone",Ne(this,ps,"f")),fs(this,A0,i.index,"f"),fs(this,ps,t.step_details.tool_calls[i.index],"f"),Ne(this,ps,"f")&&this._emit("toolCallCreated",Ne(this,ps,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":fs(this,zm,void 0,"f"),e.data.step_details.type=="tool_calls"&&Ne(this,ps,"f")&&(this._emit("toolCallDone",Ne(this,ps,"f")),fs(this,ps,void 0,"f")),this._emit("runStepDone",e.data,t);break}},eD=function(e){Ne(this,iA,"f").push(e),this._emit("event",e)},tD=function(e){switch(e.event){case"thread.run.step.created":return Ne(this,Ji,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=Ne(this,Ji,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=eh.accumulateDelta(t,r.delta);Ne(this,Ji,"f")[e.data.id]=s}return Ne(this,Ji,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":Ne(this,Ji,"f")[e.data.id]=e.data;break}if(Ne(this,Ji,"f")[e.data.id])return Ne(this,Ji,"f")[e.data.id];throw new Error("No snapshot available")},rD=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=Ne(this,Xr,"m",nD).call(this,i,a)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},nD=function(e,t){return eh.accumulateDelta(t,e)},sD=function(e){switch(fs(this,I0,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":fs(this,vu,e.data,"f"),Ne(this,ps,"f")&&(this._emit("toolCallDone",Ne(this,ps,"f")),fs(this,ps,void 0,"f"));break}};let aA=class extends xt{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return Hn(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,oA,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},oA=class extends oi{};aA.MessagesPage=oA;let cA=class extends xt{retrieve(e,t,r,s={},i){return Hn(s)?this.retrieve(e,t,r,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,r={},s){return Hn(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,uA,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}},uA=class extends oi{};cA.RunStepsPage=uA;let Zm=class extends xt{constructor(){super(...arguments),this.steps=new cA(this._client)}create(e,t,r){const{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return Hn(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,lA,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return eh.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=a.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await Dm(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return eh.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){const i=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,r,s){return eh.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}},lA=class extends oi{};Zm.RunsPage=lA,Zm.Steps=cA,Zm.RunStepsPage=uA;let th=class extends xt{constructor(){super(...arguments),this.runs=new Zm(this._client),this.messages=new aA(this._client)}create(e={},t){return Hn(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return eh.createThreadAssistantStream(e,this._client.beta.threads,t)}};th.Runs=Zm,th.RunsPage=lA,th.Messages=aA,th.MessagesPage=oA;const lQ=async n=>{const e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};let dA=class extends xt{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return Hn(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,O0,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...r,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=i.response.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await Dm(o);break;case"failed":case"completed":return a}}}async upload(e,t,r){const s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){const s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}},O0=class extends oi{};dA.VectorStoreFilesPage=O0;let iD=class extends xt{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return Hn(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,O0,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=a.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await Dm(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,u=t.values(),l=[...r];async function d(f){for(let p of f){const m=await o.files.create({file:p,purpose:"assistants"},s);l.push(m.id)}}const h=Array(a).fill(u).map(d);return await lQ(h),await this.createAndPoll(e,{file_ids:l})}},rh=class extends xt{constructor(){super(...arguments),this.files=new dA(this._client),this.fileBatches=new iD(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return Hn(e)?this.list({},e):this._client.getAPIList("/vector_stores",hA,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}},hA=class extends oi{};rh.VectorStoresPage=hA,rh.Files=dA,rh.VectorStoreFilesPage=O0,rh.FileBatches=iD;let zo=class extends xt{constructor(){super(...arguments),this.realtime=new sA(this._client),this.vectorStores=new rh(this._client),this.chat=new nA(this._client),this.assistants=new HP(this._client),this.threads=new th(this._client)}};zo.Realtime=sA,zo.VectorStores=rh,zo.VectorStoresPage=hA,zo.Assistants=HP,zo.AssistantsPage=KP,zo.Threads=th;let aD=class extends xt{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}},oD=class extends xt{create(e,t){return this._client.post("/embeddings",{body:e,...t})}},fA=class extends xt{create(e,t){return this._client.post("/files",Vd({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Hn(e)?this.list({},e):this._client.getAPIList("/files",pA,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await Dm(t),a=await this.retrieve(e),Date.now()-i>r)throw new f0({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}},pA=class extends oi{};fA.FileObjectsPage=pA;let mA=class extends xt{list(e,t={},r){return Hn(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,gA,{query:t,...r})}},gA=class extends oi{};mA.FineTuningJobCheckpointsPage=gA;let nh=class extends xt{constructor(){super(...arguments),this.checkpoints=new mA(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Hn(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",yA,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return Hn(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,wA,{query:t,...r})}},yA=class extends oi{},wA=class extends oi{};nh.FineTuningJobsPage=yA,nh.FineTuningJobEventsPage=wA,nh.Checkpoints=mA,nh.FineTuningJobCheckpointsPage=gA;let Jm=class extends xt{constructor(){super(...arguments),this.jobs=new nh(this._client)}};Jm.Jobs=nh,Jm.FineTuningJobsPage=yA,Jm.FineTuningJobEventsPage=wA;let cD=class extends xt{createVariation(e,t){return this._client.post("/images/variations",Vd({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Vd({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}},vA=class extends xt{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",_A,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},_A=class extends JY{};vA.ModelsPage=_A;let uD=class extends xt{create(e,t){return this._client.post("/moderations",{body:e,...t})}},lD=class extends xt{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,Vd({body:t,...r}))}},bA=class extends xt{constructor(){super(...arguments),this.parts=new lD(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}};bA.Parts=lD;var dD;let dt=class extends LY{constructor({baseURL:e=y0("OPENAI_BASE_URL"),apiKey:t=y0("OPENAI_API_KEY"),organization:r=y0("OPENAI_ORG_ID")??null,project:s=y0("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new st("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:r,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&GY())throw new st(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new aD(this),this.chat=new BP(this),this.embeddings=new oD(this),this.files=new fA(this),this.images=new cD(this),this.audio=new Bm(this),this.moderations=new uD(this),this.models=new vA(this),this.fineTuning=new Jm(this),this.beta=new zo(this),this.batches=new UP(this),this.uploads=new bA(this),this._options=a,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return _Y(e,{arrayFormat:"brackets"})}};dD=dt,dt.OpenAI=dD,dt.DEFAULT_TIMEOUT=6e5,dt.OpenAIError=st,dt.APIError=qn,dt.APIConnectionError=h0,dt.APIConnectionTimeoutError=f0,dt.APIUserAbortError=$s,dt.NotFoundError=GL,dt.ConflictError=ZL,dt.RateLimitError=XL,dt.BadRequestError=WL,dt.AuthenticationError=zL,dt.InternalServerError=YL,dt.PermissionDeniedError=VL,dt.UnprocessableEntityError=JL,dt.toFile=sj,dt.fileFromPath=HL,dt.Completions=aD,dt.Chat=BP,dt.Embeddings=oD,dt.Files=fA,dt.FileObjectsPage=pA,dt.Images=cD,dt.Audio=Bm,dt.Moderations=uD,dt.Models=vA,dt.ModelsPage=_A,dt.FineTuning=Jm,dt.Beta=zo,dt.Batches=UP,dt.BatchesPage=qP,dt.Uploads=bA;/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var dQ=typeof window=="object"?window:{},Je="0123456789abcdef".split(""),hQ=[-2147483648,8388608,32768,128],li=[24,16,8,0],jr=[];function di(n){n?(jr[0]=jr[16]=jr[1]=jr[2]=jr[3]=jr[4]=jr[5]=jr[6]=jr[7]=jr[8]=jr[9]=jr[10]=jr[11]=jr[12]=jr[13]=jr[14]=jr[15]=0,this.blocks=jr):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}di.prototype.update=function(n){if(!this.finalized){var e=typeof n!="string";e&&n.constructor===dQ.ArrayBuffer&&(n=new Uint8Array(n));for(var t,r=0,s,i=n.length||0,a=this.blocks;r<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(s=this.start;r<i&&s<64;++r)a[s>>2]|=n[r]<<li[s++&3];else for(s=this.start;r<i&&s<64;++r)t=n.charCodeAt(r),t<128?a[s>>2]|=t<<li[s++&3]:t<2048?(a[s>>2]|=(192|t>>6)<<li[s++&3],a[s>>2]|=(128|t&63)<<li[s++&3]):t<55296||t>=57344?(a[s>>2]|=(224|t>>12)<<li[s++&3],a[s>>2]|=(128|t>>6&63)<<li[s++&3],a[s>>2]|=(128|t&63)<<li[s++&3]):(t=65536+((t&1023)<<10|n.charCodeAt(++r)&1023),a[s>>2]|=(240|t>>18)<<li[s++&3],a[s>>2]|=(128|t>>12&63)<<li[s++&3],a[s>>2]|=(128|t>>6&63)<<li[s++&3],a[s>>2]|=(128|t&63)<<li[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=a[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},di.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>2]|=hQ[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}},di.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4,i,a,o,u=this.blocks;for(a=16;a<80;++a)o=u[a-3]^u[a-8]^u[a-14]^u[a-16],u[a]=o<<1|o>>>31;for(a=0;a<20;a+=5)i=e&t|~e&r,o=n<<5|n>>>27,s=o+i+s+1518500249+u[a]<<0,e=e<<30|e>>>2,i=n&e|~n&t,o=s<<5|s>>>27,r=o+i+r+1518500249+u[a+1]<<0,n=n<<30|n>>>2,i=s&n|~s&e,o=r<<5|r>>>27,t=o+i+t+1518500249+u[a+2]<<0,s=s<<30|s>>>2,i=r&s|~r&n,o=t<<5|t>>>27,e=o+i+e+1518500249+u[a+3]<<0,r=r<<30|r>>>2,i=t&r|~t&s,o=e<<5|e>>>27,n=o+i+n+1518500249+u[a+4]<<0,t=t<<30|t>>>2;for(;a<40;a+=5)i=e^t^r,o=n<<5|n>>>27,s=o+i+s+1859775393+u[a]<<0,e=e<<30|e>>>2,i=n^e^t,o=s<<5|s>>>27,r=o+i+r+1859775393+u[a+1]<<0,n=n<<30|n>>>2,i=s^n^e,o=r<<5|r>>>27,t=o+i+t+1859775393+u[a+2]<<0,s=s<<30|s>>>2,i=r^s^n,o=t<<5|t>>>27,e=o+i+e+1859775393+u[a+3]<<0,r=r<<30|r>>>2,i=t^r^s,o=e<<5|e>>>27,n=o+i+n+1859775393+u[a+4]<<0,t=t<<30|t>>>2;for(;a<60;a+=5)i=e&t|e&r|t&r,o=n<<5|n>>>27,s=o+i+s-1894007588+u[a]<<0,e=e<<30|e>>>2,i=n&e|n&t|e&t,o=s<<5|s>>>27,r=o+i+r-1894007588+u[a+1]<<0,n=n<<30|n>>>2,i=s&n|s&e|n&e,o=r<<5|r>>>27,t=o+i+t-1894007588+u[a+2]<<0,s=s<<30|s>>>2,i=r&s|r&n|s&n,o=t<<5|t>>>27,e=o+i+e-1894007588+u[a+3]<<0,r=r<<30|r>>>2,i=t&r|t&s|r&s,o=e<<5|e>>>27,n=o+i+n-1894007588+u[a+4]<<0,t=t<<30|t>>>2;for(;a<80;a+=5)i=e^t^r,o=n<<5|n>>>27,s=o+i+s-899497514+u[a]<<0,e=e<<30|e>>>2,i=n^e^t,o=s<<5|s>>>27,r=o+i+r-899497514+u[a+1]<<0,n=n<<30|n>>>2,i=s^n^e,o=r<<5|r>>>27,t=o+i+t-899497514+u[a+2]<<0,s=s<<30|s>>>2,i=r^s^n,o=t<<5|t>>>27,e=o+i+e-899497514+u[a+3]<<0,r=r<<30|r>>>2,i=t^r^s,o=e<<5|e>>>27,n=o+i+n-899497514+u[a+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+s<<0},di.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4;return Je[n>>28&15]+Je[n>>24&15]+Je[n>>20&15]+Je[n>>16&15]+Je[n>>12&15]+Je[n>>8&15]+Je[n>>4&15]+Je[n&15]+Je[e>>28&15]+Je[e>>24&15]+Je[e>>20&15]+Je[e>>16&15]+Je[e>>12&15]+Je[e>>8&15]+Je[e>>4&15]+Je[e&15]+Je[t>>28&15]+Je[t>>24&15]+Je[t>>20&15]+Je[t>>16&15]+Je[t>>12&15]+Je[t>>8&15]+Je[t>>4&15]+Je[t&15]+Je[r>>28&15]+Je[r>>24&15]+Je[r>>20&15]+Je[r>>16&15]+Je[r>>12&15]+Je[r>>8&15]+Je[r>>4&15]+Je[r&15]+Je[s>>28&15]+Je[s>>24&15]+Je[s>>20&15]+Je[s>>16&15]+Je[s>>12&15]+Je[s>>8&15]+Je[s>>4&15]+Je[s&15]},di.prototype.toString=di.prototype.hex,di.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4;return[n>>24&255,n>>16&255,n>>8&255,n&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,s>>24&255,s>>16&255,s>>8&255,s&255]},di.prototype.array=di.prototype.digest,di.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(20),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),n};const fQ=n=>new di(!0).update(n).hex(),hD=(...n)=>fQ(n.join("_"));class pQ{}const mQ=new Map;class SA extends pQ{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(hD(e,t))??null)}async update(e,t,r){this.cache.set(hD(e,t),r)}static global(){return new SA(mQ)}}var Xm={},fD;function gQ(){if(fD)return Xm;fD=1,Xm.byteLength=o,Xm.toByteArray=l,Xm.fromByteArray=f;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,i=r.length;s<i;++s)n[s]=r[s],e[r.charCodeAt(s)]=s;e[45]=62,e[95]=63;function a(p){var m=p.length;if(m%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var g=p.indexOf("=");g===-1&&(g=m);var y=g===m?0:4-g%4;return[g,y]}function o(p){var m=a(p),g=m[0],y=m[1];return(g+y)*3/4-y}function u(p,m,g){return(m+g)*3/4-g}function l(p){var m,g=a(p),y=g[0],w=g[1],v=new t(u(p,y,w)),b=0,S=w>0?y-4:y,P;for(P=0;P<S;P+=4)m=e[p.charCodeAt(P)]<<18|e[p.charCodeAt(P+1)]<<12|e[p.charCodeAt(P+2)]<<6|e[p.charCodeAt(P+3)],v[b++]=m>>16&255,v[b++]=m>>8&255,v[b++]=m&255;return w===2&&(m=e[p.charCodeAt(P)]<<2|e[p.charCodeAt(P+1)]>>4,v[b++]=m&255),w===1&&(m=e[p.charCodeAt(P)]<<10|e[p.charCodeAt(P+1)]<<4|e[p.charCodeAt(P+2)]>>2,v[b++]=m>>8&255,v[b++]=m&255),v}function d(p){return n[p>>18&63]+n[p>>12&63]+n[p>>6&63]+n[p&63]}function h(p,m,g){for(var y,w=[],v=m;v<g;v+=3)y=(p[v]<<16&16711680)+(p[v+1]<<8&65280)+(p[v+2]&255),w.push(d(y));return w.join("")}function f(p){for(var m,g=p.length,y=g%3,w=[],v=16383,b=0,S=g-y;b<S;b+=v)w.push(h(p,b,b+v>S?S:b+v));return y===1?(m=p[g-1],w.push(n[m>>2]+n[m<<4&63]+"==")):y===2&&(m=(p[g-2]<<8)+p[g-1],w.push(n[m>>10]+n[m>>4&63]+n[m<<2&63]+"=")),w.join("")}return Xm}var yQ=gQ();const wQ=Qe(yQ);var vQ=Object.defineProperty,_Q=(n,e,t)=>e in n?vQ(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,bQ=(n,e,t)=>(_Q(n,e+"",t),t);function SQ(n,e){let t=Array.from({length:n.length},(r,s)=>({start:s,end:s+1}));for(;t.length>1;){let r=null;for(let s=0;s<t.length-1;s++){const i=n.slice(t[s].start,t[s+1].end),a=e.get(i.join(","));a!=null&&(r==null||a<r[0])&&(r=[a,s])}if(r!=null){const s=r[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function xQ(n,e){return n.length===1?[e.get(n.join(","))]:SQ(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function EQ(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var xA=class{constructor(n,e){J(this,"specialTokens");J(this,"inverseSpecialTokens");J(this,"patStr");J(this,"textEncoder",new TextEncoder);J(this,"textDecoder",new TextDecoder("utf-8"));J(this,"rankMap",new Map);J(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{const[i,a,...o]=s.split(" "),u=Number.parseInt(a,10);return o.forEach((l,d)=>r[l]=u+d),r},{});for(const[r,s]of Object.entries(t)){const i=wQ.toByteArray(r);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,i])=>(r[i]=this.textEncoder.encode(s),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),s=xA.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(l=>!a.has(l)):t);if(o.size>0){const l=xA.specialTokenRegex([...o]),d=n.match(l);if(d!=null)throw new Error(`The text contains a special token that is not allowed: ${d[0]}`)}let u=0;for(;;){let l=null,d=u;for(;s.lastIndex=d,l=s.exec(n),!(l==null||a.has(l[0]));)d=l.index+1;const h=(l==null?void 0:l.index)??n.length;for(const p of n.substring(u,h).matchAll(r)){const m=this.textEncoder.encode(p[0]),g=this.rankMap.get(m.join(","));if(g!=null){i.push(g);continue}i.push(...xQ(m,this.rankMap))}if(l==null)break;let f=this.specialTokens[l[0]];i.push(f),u=l.index+l[0].length}return i}decode(n){const e=[];let t=0;for(let i=0;i<n.length;++i){const a=n[i],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let s=0;for(const i of e)r.set(i,s),s+=i.length;return this.textDecoder.decode(r)}},pD=xA;bQ(pD,"specialTokenRegex",n=>new RegExp(n.map(e=>EQ(e)).join("|"),"g"));function kQ(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"o3-mini":case"o3-mini-2025-01-31":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}const R0={},CQ=new fP({});async function PQ(n){return n in R0||(R0[n]=CQ.fetch(`https://tiktoken.pages.dev/js/${n}.json`).then(e=>e.json()).then(e=>new pD(e)).catch(e=>{throw delete R0[n],e})),await R0[n]}async function AQ(n){return PQ(kQ(n))}const TQ=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n.startsWith("gpt-4o")?"gpt-4o":n;function Ym(n){return typeof n!="object"||!n?!1:!!("type"in n&&n.type==="function"&&"function"in n&&typeof n.function=="object"&&n.function&&"name"in n.function&&"parameters"in n.function)}const IQ=()=>!1;class OQ extends _r{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??IQ(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class RQ extends OQ{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){const{cache:s,...i}=r;super({callbacks:e??t,...i}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof s=="object"?this.cache=s:s?this.cache=SA.global():this.cache=void 0,this.caller=new fP(r??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await AQ("modelName"in this?TQ(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new EL(e):Array.isArray(e)?new CX(e.map(vm)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const r={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([a,o])=>o!==void 0).map(([a,o])=>`${a}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class Ns extends _r{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const r=Pt(t);return this.func&&await this.func(e,r),this._callWithConfig(s=>Promise.resolve(s),e,r)}async*transform(e,t){const r=Pt(t);let s,i=!0;for await(const a of this._transformStreamWithConfig(e,o=>o,r))if(yield a,i)if(s===void 0)s=a;else try{s=Ms(s,a)}catch{s=void 0,i=!1}this.func&&s!==void 0&&await this.func(s,r)}static assign(e){return new wL(new Bd({steps:e}))}}function Qm(n){return typeof(n==null?void 0:n.parse)=="function"}class Fs extends RQ{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(e,t){const r=Fs._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){var r;if(this._streamResponseChunks===Fs.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{const i=Fs._convertInputToPromptValue(e).toChatMessages(),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(t),u={...a.metadata,...this.getLsParams(o)},l=await Dn.configure(a.callbacks,this.callbacks,a.tags,this.tags,u,this.metadata,{verbose:this.verbose}),d={options:o,invocation_params:this==null?void 0:this.invocationParams(o),batch_size:1},h=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),[i],a.runId,void 0,d,void 0,void 0,a.runName));let f,p;try{for await(const m of this._streamResponseChunks(i,o,h==null?void 0:h[0])){if(m.message.id==null){const g=(r=h==null?void 0:h.at(0))==null?void 0:r.runId;g!=null&&m.message._updateId(`run-${g}`)}m.message.response_metadata={...m.generationInfo,...m.message.response_metadata},yield m.message,f?f=f.concat(m):f=m,SN(m.message)&&m.message.usage_metadata!==void 0&&(p={tokenUsage:{promptTokens:m.message.usage_metadata.input_tokens,completionTokens:m.message.usage_metadata.output_tokens,totalTokens:m.message.usage_metadata.total_tokens}})}}catch(m){throw await Promise.all((h??[]).map(g=>g==null?void 0:g.handleLLMError(m))),m}await Promise.all((h??[]).map(m=>m==null?void 0:m.handleLLMEnd({generations:[[f]],llmOutput:p})))}}getLsParams(e){const t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,r,s){var h,f;const i=e.map(p=>p.map(vm));let a;if(s!==void 0&&s.length===i.length)a=s;else{const p={...r.metadata,...this.getLsParams(t)},m=await Dn.configure(r.callbacks,this.callbacks,r.tags,this.tags,p,this.metadata,{verbose:this.verbose}),g={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1};a=await(m==null?void 0:m.handleChatModelStart(this.toJSON(),i,r.runId,void 0,g,void 0,void 0,r.runName))}const o=[],u=[];if(!!(a!=null&&a[0].handlers.find($7))&&!this.disableStreaming&&i.length===1&&this._streamResponseChunks!==Fs.prototype._streamResponseChunks)try{const p=await this._streamResponseChunks(i[0],t,a==null?void 0:a[0]);let m,g;for await(const y of p){if(y.message.id==null){const w=(h=a==null?void 0:a.at(0))==null?void 0:h.runId;w!=null&&y.message._updateId(`run-${w}`)}m===void 0?m=y:m=Ms(m,y),SN(y.message)&&y.message.usage_metadata!==void 0&&(g={tokenUsage:{promptTokens:y.message.usage_metadata.input_tokens,completionTokens:y.message.usage_metadata.output_tokens,totalTokens:y.message.usage_metadata.total_tokens}})}if(m===void 0)throw new Error("Received empty response from chat model call.");o.push([m]),await(a==null?void 0:a[0].handleLLMEnd({generations:o,llmOutput:g}))}catch(p){throw await(a==null?void 0:a[0].handleLLMError(p)),p}else{const p=await Promise.allSettled(i.map((m,g)=>this._generate(m,{...t,promptIndex:g},a==null?void 0:a[g])));await Promise.all(p.map(async(m,g)=>{var y,w,v;if(m.status==="fulfilled"){const b=m.value;for(const S of b.generations){if(S.message.id==null){const P=(y=a==null?void 0:a.at(0))==null?void 0:y.runId;P!=null&&S.message._updateId(`run-${P}`)}S.message.response_metadata={...S.generationInfo,...S.message.response_metadata}}return b.generations.length===1&&(b.generations[0].message.response_metadata={...b.llmOutput,...b.generations[0].message.response_metadata}),o[g]=b.generations,u[g]=b.llmOutput,(w=a==null?void 0:a[g])==null?void 0:w.handleLLMEnd({generations:[b.generations],llmOutput:b.llmOutput})}else return await((v=a==null?void 0:a[g])==null?void 0:v.handleLLMError(m.reason)),Promise.reject(m.reason)}))}const d={generations:o,llmOutput:u.length?(f=this._combineLLMOutput)==null?void 0:f.call(this,...u):void 0};return Object.defineProperty(d,iL,{value:a?{runIds:a==null?void 0:a.map(p=>p.runId)}:void 0,configurable:!0}),d}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:s,handledOptions:i}){const a=e.map(y=>y.map(vm)),o={...i.metadata,...this.getLsParams(s)},u=await Dn.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),l={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1},d=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),a,i.runId,void 0,l,void 0,void 0,i.runName)),h=[],p=(await Promise.allSettled(a.map(async(y,w)=>{const v=Fs._convertInputToPromptValue(y).toString(),b=await t.lookup(v,r);return b==null&&h.push(w),b}))).map((y,w)=>({result:y,runManager:d==null?void 0:d[w]})).filter(({result:y})=>y.status==="fulfilled"&&y.value!=null||y.status==="rejected"),m=[];await Promise.all(p.map(async({result:y,runManager:w},v)=>{if(y.status==="fulfilled"){const b=y.value;return m[v]=b.map(S=>("message"in S&&mm(S.message)&&pu(S.message)&&(S.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),S.generationInfo={...S.generationInfo,tokenUsage:{}},S)),b.length&&await(w==null?void 0:w.handleLLMNewToken(b[0].text)),w==null?void 0:w.handleLLMEnd({generations:[b]},void 0,void 0,void 0,{cached:!0})}else return await(w==null?void 0:w.handleLLMError(y.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(y.reason)}));const g={generations:m,missingPromptIndices:h,startedRunManagers:d};return Object.defineProperty(g,iL,{value:d?{runIds:d==null?void 0:d.map(y=>y.runId)}:void 0,configurable:!0}),g}async generate(e,t,r){let s;Array.isArray(t)?s={stop:t}:s=t;const i=e.map(m=>m.map(vm)),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(a.callbacks=a.callbacks??r,!this.cache)return this._generateUncached(i,o,a);const{cache:u}=this,l=this._getSerializedCacheKeyParametersForCall(o),{generations:d,missingPromptIndices:h,startedRunManagers:f}=await this._generateCached({messages:i,cache:u,llmStringKey:l,parsedOptions:o,handledOptions:a});let p={};if(h.length>0){const m=await this._generateUncached(h.map(g=>i[g]),o,a,f!==void 0?h.map(g=>f==null?void 0:f[g]):void 0);await Promise.all(m.generations.map(async(g,y)=>{const w=h[y];d[w]=g;const v=Fs._convertInputToPromptValue(i[w]).toString();return u.update(v,l,g)})),p=m.llmOutput??{}}return{generations:d,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){const s=e.map(i=>i.toChatMessages());return this.generate(s,t,r)}async call(e,t,r){return(await this.generate([e.map(vm)],t,r)).generations[0][0].message}async callPrompt(e,t,r){const s=e.toChatMessages();return this.call(s,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const s=new Jt(e),i=await this.call([s],t,r);if(typeof i.content!="string")throw new Error("Cannot use predict when output is not a string.");return i.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t!=null&&t.strict)throw new Error('"strict" mode is not supported for this model by default.');const r=e,s=t==null?void 0:t.name,i=r.description??"A function available to call.",a=t==null?void 0:t.method,o=t==null?void 0:t.includeRaw;if(a==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=s??"extract",l;Qm(r)?l=[{type:"function",function:{name:u,description:i,parameters:$a(r)}}]:("name"in r&&(u=r.name),l=[{type:"function",function:{name:u,description:i,parameters:r}}]);const d=this.bindTools(l),h=Mm.from(g=>{if(!g.tool_calls||g.tool_calls.length===0)throw new Error("No tool calls found in the response.");const y=g.tool_calls.find(w=>w.name===u);if(!y)throw new Error(`No tool call found with name ${u}.`);return y.args});if(!o)return d.pipe(h).withConfig({runName:"StructuredOutput"});const f=Ns.assign({parsed:(g,y)=>h.invoke(g.raw,y)}),p=Ns.assign({parsed:()=>null}),m=f.withFallbacks({fallbacks:[p]});return hs.from([{raw:d},m]).withConfig({runName:"StructuredOutputRunnable"})}}class EA extends _r{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(r,s)=>this.parseResult([{text:r}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(r,s)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"})}}class mD extends EA{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class sh extends Error{constructor(e,t,r,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=r,this.sendToLLM=s,s&&(r===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");Kk(this,"OUTPUT_PARSING_FAILURE")}}function kA(n,e){const t=typeof n;if(t!==typeof e)return!1;if(Array.isArray(n)){if(!Array.isArray(e))return!1;const r=n.length;if(r!==e.length)return!1;for(let s=0;s<r;s++)if(!kA(n[s],e[s]))return!1;return!0}if(t==="object"){if(!n||!e)return n===e;const r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;for(const a of r)if(!kA(n[a],e[a]))return!1;return!0}return n===e}class MQ extends mD{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class gD extends MQ{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,r;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let i;if(G8(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new ds({message:s,text:s.content})}else if(mm(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new ds({message:Q8(s),text:s.content})}else i=new Dd({text:s});r===void 0?r=i:r=r.concat(i);const a=await this.parsePartialResult([r]);a!=null&&!kA(a,t)&&(this.diff?yield this._diff(t,a):yield a,t=a)}}getFormatInstructions(){return""}}class eg extends mD{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=ge.object(Object.fromEntries(Object.entries(e).map(([r,s])=>[r,ge.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify($a(this.schema))}
\`\`\`
`}async parse(e){try{const r=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,i)=>`"${i.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(r))}catch(t){throw new sh(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class tg extends gD{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?C7(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return yN(e[0].text)}async parse(e){return yN(e,JSON.parse)}getFormatInstructions(){return""}}function CA(n,e){if(n.function===void 0)return;let t;if(e!=null&&e.partial)try{t=qk(n.function.arguments??"{}")}catch{return}else try{t=JSON.parse(n.function.arguments)}catch(s){throw new sh([`Function "${n.function.name}" arguments:`,"",n.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const r={name:n.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(r.id=n.id),r}function yD(n){if(n.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:n.id,type:"function",function:{name:n.name,arguments:JSON.stringify(n.args)}}}function wD(n,e){var t,r;return{name:(t=n.function)==null?void 0:t.name,args:(r=n.function)==null?void 0:r.arguments,id:n.id,error:e,type:"invalid_tool_call"}}class $Q extends gD{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var a;const r=e[0].message;let s;if(pu(r)&&((a=r.tool_calls)!=null&&a.length)?s=r.tool_calls.map(o=>{const{id:u,...l}=o;return this.returnId?{id:u,...l}:l}):r.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(r.additional_kwargs.tool_calls)).map(u=>CA(u,{returnId:this.returnId,partial:t}))),!s)return[];const i=[];for(const o of s)if(o!==void 0){const u={type:o.name,args:o.args,id:o.id};i.push(u)}return i}}class M0 extends $Q{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new sh(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const r=(await super.parsePartialResult(e)).filter(i=>i.type===this.keyName);let s=r;if(r.length)return this.returnId||(s=r.map(i=>i.args)),this.returnSingle?s[0]:s}async parseResult(e){const r=(await super.parsePartialResult(e,!1)).filter(a=>a.type===this.keyName);let s=r;return r.length?(this.returnId||(s=r.map(a=>a.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(a=>this._validateResult(a)))):void 0}}const NQ=Symbol("Let zodToJsonSchema decide on which parser to use"),vD={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},FQ=n=>typeof n=="string"?{...vD,basePath:["#"],definitions:{},name:n}:{...vD,basePath:["#"],definitions:{},...n},PA=n=>"_def"in n?n._def:n;function LQ(n){if(!n)return!0;for(const e in n)return!1;return!0}const jQ=n=>{const e=FQ(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[PA(s),{def:PA(s),path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function _D(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function Rt(n,e,t,r,s){n[e]=t,_D(n,e,r,s)}function DQ(){return{}}function BQ(n,e){var r,s;const t={type:"array"};return((s=(r=n.type)==null?void 0:r._def)==null?void 0:s.typeName)!==Q.ZodAny&&(t.items=vt(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&Rt(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&Rt(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(Rt(t,"minItems",n.exactLength.value,n.exactLength.message,e),Rt(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function UQ(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Rt(t,"minimum",r.value,r.message,e):Rt(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Rt(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Rt(t,"maximum",r.value,r.message,e):Rt(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Rt(t,"maximum",r.value,r.message,e));break;case"multipleOf":Rt(t,"multipleOf",r.value,r.message,e);break}return t}function qQ(){return{type:"boolean"}}function HQ(n,e){return vt(n.type._def,e)}const KQ=(n,e)=>vt(n.innerType._def,e);function bD(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,i)=>bD(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return WQ(n,e)}}const WQ=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":Rt(t,"minimum",r.value,r.message,e);break;case"max":Rt(t,"maximum",r.value,r.message,e);break}return t};function zQ(n,e){return{...vt(n.innerType._def,e),default:n.defaultValue()}}function VQ(n,e,t){return e.effectStrategy==="input"?vt(n.schema._def,e,t):{}}function GQ(n){return{type:"string",enum:[...n.values]}}const ZQ=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function JQ(n,e){const t=[vt(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),vt(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(ZQ(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...u}=i;a=u}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function XQ(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let AA;const bu={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(AA===void 0&&(AA=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),AA),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function SD(n,e){const t={type:"string"};function r(s){return e.patternStrategy==="escape"?YQ(s):s}if(n.checks)for(const s of n.checks)switch(s.kind){case"min":Rt(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":Rt(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":hi(t,"email",s.message,e);break;case"format:idn-email":hi(t,"idn-email",s.message,e);break;case"pattern:zod":fi(t,bu.email,s.message,e);break}break;case"url":hi(t,"uri",s.message,e);break;case"uuid":hi(t,"uuid",s.message,e);break;case"regex":fi(t,s.regex,s.message,e);break;case"cuid":fi(t,bu.cuid,s.message,e);break;case"cuid2":fi(t,bu.cuid2,s.message,e);break;case"startsWith":fi(t,RegExp(`^${r(s.value)}`),s.message,e);break;case"endsWith":fi(t,RegExp(`${r(s.value)}$`),s.message,e);break;case"datetime":hi(t,"date-time",s.message,e);break;case"date":hi(t,"date",s.message,e);break;case"time":hi(t,"time",s.message,e);break;case"duration":hi(t,"duration",s.message,e);break;case"length":Rt(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),Rt(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{fi(t,RegExp(r(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&hi(t,"ipv4",s.message,e),s.version!=="v4"&&hi(t,"ipv6",s.message,e);break}case"emoji":fi(t,bu.emoji,s.message,e);break;case"ulid":{fi(t,bu.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{hi(t,"binary",s.message,e);break}case"contentEncoding:base64":{Rt(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{fi(t,bu.base64,s.message,e);break}}break}case"nanoid":fi(t,bu.nanoid,s.message,e)}return t}const YQ=n=>Array.from(n).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),hi=(n,e,t,r)=>{var s;n.format||(s=n.anyOf)!=null&&s.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):Rt(n,"format",e,t,r)},fi=(n,e,t,r)=>{var s;n.pattern||(s=n.allOf)!=null&&s.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:xD(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):Rt(n,"pattern",xD(e,r),t,r)},xD=(n,e)=>{var l;const t=typeof n=="function"?n():n;if(!e.applyRegexFlags||!t.flags)return t.source;const r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=r.i?t.source.toLowerCase():t.source;let i="",a=!1,o=!1,u=!1;for(let d=0;d<s.length;d++){if(a){i+=s[d],a=!1;continue}if(r.i){if(o){if(s[d].match(/[a-z]/)){u?(i+=s[d],i+=`${s[d-2]}-${s[d]}`.toUpperCase(),u=!1):s[d+1]==="-"&&((l=s[d+2])!=null&&l.match(/[a-z]/))?(i+=s[d],u=!0):i+=`${s[d]}${s[d].toUpperCase()}`;continue}}else if(s[d].match(/[a-z]/)){i+=`[${s[d]}${s[d].toUpperCase()}]`;continue}}if(r.m){if(s[d]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(s[d]==="$"){i+=`($|(?=[\r
]))`;continue}}if(r.s&&s[d]==="."){i+=o?`${s[d]}\r
`:`[${s[d]}\r
]`;continue}i+=s[d],s[d]==="\\"?a=!0:o&&s[d]==="]"?o=!1:!o&&s[d]==="["&&(o=!0)}try{const d=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i};function ED(n,e){var r,s,i,a;if(e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===Q.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((o,u)=>({...o,[u]:vt(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",u]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:vt(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((s=n.keyType)==null?void 0:s._def.typeName)===Q.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const o=Object.entries(SD(n.keyType._def,e)).reduce((u,[l,d])=>l==="type"?u:{...u,[l]:d},{});return{...t,propertyNames:o}}else if(((a=n.keyType)==null?void 0:a._def.typeName)===Q.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};return t}function QQ(n,e){if(e.mapStrategy==="record")return ED(n,e);const t=vt(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=vt(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function eee(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function tee(){return{not:{}}}function ree(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const $0={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function nee(n,e){if(e.target==="openApi3")return kD(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in $0&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((s,i)=>{const a=$0[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return kD(n,e)}const kD=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>vt(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function see(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:$0[n.innerType._def.typeName],nullable:!0}:{type:[$0[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=vt(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=vt(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function iee(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",_D(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Rt(t,"minimum",r.value,r.message,e):Rt(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Rt(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Rt(t,"maximum",r.value,r.message,e):Rt(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Rt(t,"maximum",r.value,r.message,e));break;case"multipleOf":Rt(t,"multipleOf",r.value,r.message,e);break}return t}function aee(n,e){return e.removeAdditionalStrategy==="strict"?n.catchall._def.typeName==="ZodNever"?n.unknownKeys!=="strict":vt(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":vt(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function oee(n,e){const t={type:"object",...Object.entries(n.shape()).reduce((r,[s,i])=>{if(i===void 0||i._def===void 0)return r;const a=vt(i._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return a===void 0?r:{properties:{...r.properties,[s]:a},required:i.isOptional()&&!e.openaiStrictMode?r.required:[...r.required,s]}},{properties:{},required:[]}),additionalProperties:aee(n,e)};return t.required.length||delete t.required,t}const cee=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return vt(n.innerType._def,e);const t=vt(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},uee=(n,e)=>{if(e.pipeStrategy==="input")return vt(n.in._def,e);if(e.pipeStrategy==="output")return vt(n.out._def,e);const t=vt(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=vt(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}};function lee(n,e){return vt(n.type._def,e)}function dee(n,e){const r={type:"array",uniqueItems:!0,items:vt(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&Rt(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&Rt(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function hee(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>vt(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:vt(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>vt(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function fee(){return{not:{}}}function pee(){return{}}const mee=(n,e)=>vt(n.innerType._def,e);function vt(n,e,t=!1){var a;const r=e.seen.get(n);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,n,e,r,t);if(o!==NQ)return o}if(r&&!t){const o=gee(r,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);const i=wee(n,n.typeName,e,t);return i&&vee(n,e,i),s.jsonSchema=i,i}const gee=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"extract-to-root":const t=n.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=n.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:yee(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((r,s)=>e.currentPath[s]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},yee=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},wee=(n,e,t,r)=>{switch(e){case Q.ZodString:return SD(n,t);case Q.ZodNumber:return iee(n,t);case Q.ZodObject:return oee(n,t);case Q.ZodBigInt:return UQ(n,t);case Q.ZodBoolean:return qQ();case Q.ZodDate:return bD(n,t);case Q.ZodUndefined:return fee();case Q.ZodNull:return ree(t);case Q.ZodArray:return BQ(n,t);case Q.ZodUnion:case Q.ZodDiscriminatedUnion:return nee(n,t);case Q.ZodIntersection:return JQ(n,t);case Q.ZodTuple:return hee(n,t);case Q.ZodRecord:return ED(n,t);case Q.ZodLiteral:return XQ(n,t);case Q.ZodEnum:return GQ(n);case Q.ZodNativeEnum:return eee(n);case Q.ZodNullable:return see(n,t);case Q.ZodOptional:return cee(n,t);case Q.ZodMap:return QQ(n,t);case Q.ZodSet:return dee(n,t);case Q.ZodLazy:return vt(n.getter()._def,t);case Q.ZodPromise:return lee(n,t);case Q.ZodNaN:case Q.ZodNever:return tee();case Q.ZodEffects:return VQ(n,t,r);case Q.ZodAny:return DQ();case Q.ZodUnknown:return pee();case Q.ZodDefault:return zQ(n,t);case Q.ZodBranded:return HQ(n,t);case Q.ZodReadonly:return mee(n,t);case Q.ZodCatch:return KQ(n,t);case Q.ZodPipeline:return uee(n,t);case Q.ZodFunction:case Q.ZodVoid:case Q.ZodSymbol:return;default:return(s=>{})()}},vee=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),_ee=(n,e)=>{const t=jQ(e),r=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=vt(n._def,r===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,r]},!1)??{},i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i);const a=(()=>{if(LQ(t.definitions))return;const u={},l=new Set;for(let d=0;d<500;d++){const h=Object.entries(t.definitions).filter(([f])=>!l.has(f));if(h.length===0)break;for(const[f,p]of h)u[f]=vt(PA(p),{...t,currentPath:[...t.basePath,t.definitionPath,f]},!0)??{},l.add(f)}return u})(),o=r===void 0?a?{...s,[t.definitionPath]:a}:s:t.nameStrategy==="duplicate-ref"?{...s,...a||t.seenRefs.size?{[t.definitionPath]:{...a,...t.seenRefs.size?{[r]:s}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,r].join("/"),[t.definitionPath]:{...a,[r]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function CD(n,e){return _ee(n,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function bee(n,e,t){return XY({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:CD(n,{name:e})}},r=>n.parse(JSON.parse(r)))}function See(n){return YY({type:"function",function:{name:n.name,parameters:CD(n.parameters,{name:n.name}),strict:!0,...n.description?{description:n.description}:void 0}},{callback:n.function,parser:e=>n.parameters.parse(JSON.parse(e))})}function xee(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a,azureOpenAIEndpoint:o}=n;if((r||a)&&s&&e)return`${s}/${e}`;if((r||a)&&o&&e)return`${o}/openai/deployments/${e}`;if(r||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function TA(n,e){const t=typeof e=="number"?void 0:e;return{name:n.name,description:n.description,parameters:$a(n.schema),...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}}function PD(n,e){let t;return ih(n)?t={type:"function",function:TA(n)}:t=n,t}function Eee(n){return n!==void 0&&Array.isArray(n.lc_namespace)}function kee(n){return n!==void 0&&_r.isRunnable(n)&&"lc_name"in n.constructor&&typeof n.constructor.lc_name=="function"&&n.constructor.lc_name()==="RunnableToolLike"}function Cee(n){return!!n&&typeof n=="object"&&"name"in n&&"schema"in n&&Qm(n.schema)}function ih(n){return Cee(n)||kee(n)||Eee(n)}function N0(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function AD(n){let e;return n.constructor.name===f0.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===$s.name?(e=new Error(n.message),e.name="AbortError"):n.status===400&&n.message.includes("tool_calls")?e=N0(n,"INVALID_TOOL_RESULTS"):n.status===401?e=N0(n,"MODEL_AUTHENTICATION"):n.status===429?e=N0(n,"MODEL_RATE_LIMIT"):n.status===404?e=N0(n,"MODEL_NOT_FOUND"):e=n,e}function Pee(n){if(n)return n==="any"||n==="required"?"required":n==="auto"?"auto":n==="none"?"none":typeof n=="string"?{type:"function",function:{name:n}}:n}function Aee(n){return n.anyOf!==void 0&&Array.isArray(n.anyOf)}function Tee(n){const e=["namespace functions {",""];for(const t of n)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(TD(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function TD(n,e){var r;const t=[];for(const[s,i]of Object.entries(n.properties??{}))i.description&&e<2&&t.push(`// ${i.description}`),(r=n.required)!=null&&r.includes(s)?t.push(`${s}: ${F0(i,e)},`):t.push(`${s}?: ${F0(i,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function F0(n,e){if(Aee(n))return n.anyOf.map(t=>F0(t,e)).join(" | ");switch(n.type){case"string":return n.enum?n.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",TD(n,e+2),"}"].join(`
`);case"array":return n.items?`${F0(n.items,e)}[]`:"any[]";default:return""}}function Iee(n,e){let t;if(ih(n)){const r=See({name:n.name,parameters:n.schema,description:n.description});r.function.parameters?t={type:r.type,function:{name:r.function.name,description:r.function.description,parameters:r.function.parameters,...(e==null?void 0:e.strict)!==void 0?{strict:e.strict}:{}}}:t={type:"function",function:TA(n,e)}}else t=n;return(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function Oee(n){return n.role!=="system"&&n.role!=="developer"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&n.role!=="tool"&&console.warn(`Unknown message role: ${n.role}`),n.role}function ID(n){const e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Lo.isInstance(n))throw new Error("Invalid generic chat message");return Oee(n)}default:throw new Error(`Unknown message type: ${e}`)}}function OD(n,e){return n.flatMap(t=>{var i;let r=ID(t);r==="system"&&(e!=null&&e.startsWith("o1"))&&(r="developer");const s={role:r,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=null),pu(t)&&((i=t.tool_calls)!=null&&i.length)?(s.tool_calls=t.tool_calls.map(yD),s.content=null):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const a={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,a]}return s})}function RD(n,e){return Ym(n)?(e==null?void 0:e.strict)!==void 0?{...n,function:{...n.function,strict:e.strict}}:n:Iee(n,e)}let Ree=class extends Fs{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}constructor(e){var t,r;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??sn("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??sn("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this==null?void 0:this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let r;return(t==null?void 0:t.strict)!==void 0?r=t.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>RD(s,{strict:r})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&L0(e.json_schema.schema)?bee(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){var o;let r;(e==null?void 0:e.strict)!==void 0?r=e.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling);let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}});const i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(u=>RD(u,{strict:r})):void 0,tool_choice:Pee(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(i.prediction=e.prediction);const a=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return a!==void 0&&(i.reasoning_effort=a),i}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const r=e.tool_calls;switch(e.role){case"assistant":{const s=[],i=[];for(const u of r??[])try{s.push(CA(u,{returnId:!0}))}catch(l){i.push(wD(u,l.message))}const a={function_call:e.function_call,tool_calls:r};this.__includeRawResponse!==void 0&&(a.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(a.audio=e.audio),new nn({content:e.content||"",tool_calls:s,invalid_tool_calls:i,additional_kwargs:a,response_metadata:o,id:t.id})}default:return new Lo(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,r){var u,l;const s=e.role??r,i=e.content??"";let a;e.function_call?a={function_call:e.function_call}:e.tool_calls?a={tool_calls:e.tool_calls}:a={},this.__includeRawResponse&&(a.__raw_response=t),e.audio&&(a.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(s==="user")return new wm({content:i,response_metadata:o});if(s==="assistant"){const d=[];if(Array.isArray(e.tool_calls))for(const h of e.tool_calls)d.push({name:(u=h.function)==null?void 0:u.name,args:(l=h.function)==null?void 0:l.arguments,id:h.id,index:h.index,type:"tool_call_chunk"});return new wr({content:i,tool_call_chunks:d,additional_kwargs:a,id:t.id,response_metadata:o})}else return s==="system"?new mu({content:i,response_metadata:o}):s==="developer"?new mu({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new ym({content:i,additional_kwargs:a,name:e.name,response_metadata:o}):s==="tool"?new Bb({content:i,additional_kwargs:a,tool_call_id:e.tool_call_id,response_metadata:o}):new gm({content:i,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){var l,d,h,f,p,m,g,y,w,v;const s=OD(e,this.model),i={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let a;const o=await this.completionWithRetry(i,t);let u;for await(const b of o){const S=(l=b==null?void 0:b.choices)==null?void 0:l[0];if(b.usage&&(u=b.usage),!S)continue;const{delta:P}=S;if(!P)continue;const k=this._convertOpenAIDeltaToBaseMessageChunk(P,b,a);a=P.role??a;const C={prompt:t.promptIndex??0,completion:S.index??0};if(typeof k.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const E={...C};S.finish_reason!=null&&(E.finish_reason=S.finish_reason,E.system_fingerprint=b.system_fingerprint,E.model_name=b.model),this.logprobs&&(E.logprobs=S.logprobs);const M=new ds({message:k,text:k.content,generationInfo:E});yield M,await(r==null?void 0:r.handleLLMNewToken(M.text??"",C,void 0,void 0,void 0,{chunk:M}))}if(u){const b={...((d=u.prompt_tokens_details)==null?void 0:d.audio_tokens)!==null&&{audio:(h=u.prompt_tokens_details)==null?void 0:h.audio_tokens},...((f=u.prompt_tokens_details)==null?void 0:f.cached_tokens)!==null&&{cache_read:(p=u.prompt_tokens_details)==null?void 0:p.cached_tokens}},S={...((m=u.completion_tokens_details)==null?void 0:m.audio_tokens)!==null&&{audio:(g=u.completion_tokens_details)==null?void 0:g.audio_tokens},...((y=u.completion_tokens_details)==null?void 0:y.reasoning_tokens)!==null&&{reasoning:(w=u.completion_tokens_details)==null?void 0:w.reasoning_tokens}};yield new ds({message:new wr({content:"",response_metadata:{usage:{...u}},usage_metadata:{input_tokens:u.prompt_tokens,output_tokens:u.completion_tokens,total_tokens:u.total_tokens,...Object.keys(b).length>0&&{input_token_details:b},...Object.keys(S).length>0&&{output_token_details:S}}}),text:""})}if((v=t.signal)!=null&&v.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){var o,u;const s={},i=this.invocationParams(t),a=OD(e,this.model);if(i.stream){const l=this._streamResponseChunks(e,t,r),d={};for await(const y of l){y.message.response_metadata={...y.generationInfo,...y.message.response_metadata};const w=((o=y.generationInfo)==null?void 0:o.completion)??0;d[w]===void 0?d[w]=y:d[w]=d[w].concat(y)}const h=Object.entries(d).sort(([y],[w])=>parseInt(y,10)-parseInt(w,10)).map(([y,w])=>w),{functions:f,function_call:p}=this.invocationParams(t),m=await this.getEstimatedTokenCountFromPrompt(e,f,p),g=await this.getNumTokensFromGenerations(h);return s.input_tokens=m,s.output_tokens=g,s.total_tokens=m+g,{generations:h,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let l;t.response_format&&t.response_format.type==="json_schema"?l=await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):l=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:d,prompt_tokens:h,total_tokens:f,prompt_tokens_details:p,completion_tokens_details:m}=(l==null?void 0:l.usage)??{};d&&(s.output_tokens=(s.output_tokens??0)+d),h&&(s.input_tokens=(s.input_tokens??0)+h),f&&(s.total_tokens=(s.total_tokens??0)+f),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.cached_tokens)!==null)&&(s.input_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.cached_tokens)!==null&&{cache_read:p==null?void 0:p.cached_tokens}}),((m==null?void 0:m.audio_tokens)!==null||(m==null?void 0:m.reasoning_tokens)!==null)&&(s.output_token_details={...(m==null?void 0:m.audio_tokens)!==null&&{audio:m==null?void 0:m.audio_tokens},...(m==null?void 0:m.reasoning_tokens)!==null&&{reasoning:m==null?void 0:m.reasoning_tokens}});const g=[];for(const y of(l==null?void 0:l.choices)??[]){const v={text:((u=y.message)==null?void 0:u.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(y.message??{role:"assistant"},l)};v.generationInfo={...y.finish_reason?{finish_reason:y.finish_reason}:{},...y.logprobs?{logprobs:y.logprobs}:{}},pu(v.message)&&(v.message.usage_metadata=s),v.message=new nn(Object.fromEntries(Object.entries(v.message).filter(([b])=>!b.startsWith("lc_")))),g.push(v)}return{generations:g,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,r){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&r!=="auto"){const i=Tee(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),r==="none"?s+=1:typeof r=="object"&&(s+=await this.getNumTokens(r.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var s;return(s=r.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,s)=>r+s,0)}async getNumTokensFromMessages(e){let t=0,r=0,s=0;this.model==="gpt-3.5-turbo-0301"?(r=4,s=-1):(r=3,s=1);const i=await Promise.all(e.map(async a=>{var f,p,m,g,y,w;const o=await this.getNumTokens(a.content),u=await this.getNumTokens(ID(a)),l=a.name!==void 0?s+await this.getNumTokens(a.name):0;let d=o+r+u+l;const h=a;if(h._getType()==="function"&&(d-=2),(f=h.additional_kwargs)!=null&&f.function_call&&(d+=3),(p=h==null?void 0:h.additional_kwargs.function_call)!=null&&p.name&&(d+=await this.getNumTokens((m=h.additional_kwargs.function_call)==null?void 0:m.name)),(g=h.additional_kwargs.function_call)!=null&&g.arguments)try{d+=await this.getNumTokens(JSON.stringify(JSON.parse((y=h.additional_kwargs.function_call)==null?void 0:y.arguments)))}catch(v){console.error("Error parsing function arguments",v,JSON.stringify(h.additional_kwargs.function_call)),d+=await this.getNumTokens((w=h.additional_kwargs.function_call)==null?void 0:w.arguments)}return t+=d,d}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(s){throw AD(s)}})}async betaParsedCompletionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,r)}catch(s){throw AD(s)}})}_getClientOptions(e){if(!this.client){const r={baseURL:this.clientConfig.baseURL},s=xee(r),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new dt(i)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let r,s,i,a;Mee(e)?(r=e.schema,s=e.name,i=e.method,a=e.includeRaw):(r=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw);let o,u;if((t==null?void 0:t.strict)!==void 0&&i==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?i===void 0&&(i="jsonSchema"):i==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),L0(r)?u=eg.fromZodSchema(r):u=new tg;else if(i==="jsonSchema")o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:r.description,schema:r,strict:t==null?void 0:t.strict}}}),L0(r)?u=eg.fromZodSchema(r):u=new tg;else{let f=s??"extract";if(L0(r)){const p=$a(r);o=this.bind({tools:[{type:"function",function:{name:f,description:p.description,parameters:p}}],tool_choice:{type:"function",function:{name:f}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),u=new M0({returnSingle:!0,keyName:f,zodSchema:r})}else{let p;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(p=r,f=r.name):(f=r.title??f,p={name:f,description:r.description??"",parameters:r}),o=this.bind({tools:[{type:"function",function:p}],tool_choice:{type:"function",function:{name:f}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),u=new M0({returnSingle:!0,keyName:f})}}if(!a)return o.pipe(u);const l=Ns.assign({parsed:(f,p)=>u.invoke(f.raw,p)}),d=Ns.assign({parsed:()=>null}),h=l.withFallbacks({fallbacks:[d]});return hs.from([{raw:o},h])}};function L0(n){return typeof(n==null?void 0:n.parse)=="function"}function Mee(n){return n!==void 0&&typeof n.schema=="object"}const ah="0.32.1";let MD=!1,rg,$D,IA,ND,FD,LD;function $ee(n,e={auto:!1}){if(MD)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${n.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(rg)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${n.kind}'\` after \`import '@anthropic-ai/sdk/shims/${rg}'\``);MD=e.auto,rg=n.kind,$D=n.fetch,IA=n.File,ND=n.ReadableStream,FD=n.getDefaultAgent,LD=n.fileFromPath}let Nee=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function Fee({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import  from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new Nee(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:a=>!1}}rg||$ee(Fee(),{auto:!0});class gt extends Error{}let ms=class dR extends gt{constructor(e,t,r,s){super(`${dR.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["request-id"],this.error=t}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e)return new j0({message:r,cause:$A(t)});const i=t;return e===400?new DD(e,i,r,s):e===401?new BD(e,i,r,s):e===403?new UD(e,i,r,s):e===404?new qD(e,i,r,s):e===409?new HD(e,i,r,s):e===422?new KD(e,i,r,s):e===429?new WD(e,i,r,s):e>=500?new zD(e,i,r,s):new dR(e,i,r,s)}},pi=class extends ms{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},j0=class extends ms{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},jD=class extends j0{constructor({message:e}={}){super({message:e??"Request timed out."})}},DD=class extends ms{constructor(){super(...arguments),this.status=400}},BD=class extends ms{constructor(){super(...arguments),this.status=401}},UD=class extends ms{constructor(){super(...arguments),this.status=403}},qD=class extends ms{constructor(){super(...arguments),this.status=404}},HD=class extends ms{constructor(){super(...arguments),this.status=409}},KD=class extends ms{constructor(){super(...arguments),this.status=422}},WD=class extends ms{constructor(){super(...arguments),this.status=429}},zD=class extends ms{},ng=class hR{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=hR.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(hR.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new gt(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new gt(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new gt("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};ng.NEWLINE_CHARS=new Set([`
`,"\r"]),ng.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let sg=class $_{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of Lee(e,t)){if(a.event==="completion")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event==="message_start"||a.event==="message_delta"||a.event==="message_stop"||a.event==="content_block_start"||a.event==="content_block_delta"||a.event==="content_block_stop")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event!=="ping"&&a.event==="error")throw ms.generate(void 0,`SSE Error: ${a.data}`,a.data,JD(e.headers))}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new $_(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new ng,o=OA(e);for await(const u of o)for(const l of a.decode(u))yield l;for(const u of a.flush())yield u}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new $_(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new $_(()=>s(e),this.controller),new $_(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new ND({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}};async function*Lee(n,e){if(!n.body)throw e.abort(),new gt("Attempted to iterate over a response with no body");const t=new Bee,r=new ng,s=OA(n.body);for await(const i of jee(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*jee(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=Dee(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function Dee(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}let Bee=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=Uee(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function Uee(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function OA(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const qee=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Hee=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&D0(n),D0=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function";async function Kee(n,e,t){var s;if(n=await n,Hee(n))return n;if(qee(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=D0(i)?[await i.arrayBuffer()]:[i];return new IA(a,e,t)}const r=await Wee(n);if(e||(e=Vee(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new IA(r,e,t)}async function Wee(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(D0(n))e.push(await n.arrayBuffer());else if(Gee(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${zee(n)}`);return e}function zee(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Vee(n){var e;return RA(n.name)||RA(n.filename)||((e=RA(n.path))==null?void 0:e.split(/[\\/]/).pop())}const RA=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},Gee=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",VD=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var Zee=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Jee=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},B0;async function GD(n){const{response:e}=n;if(n.options.stream)return oh("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):sg.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return oh("response",e.status,e.url,e.headers,i),i}const s=await e.text();return oh("response",e.status,e.url,e.headers,s),s}let ZD=class i6 extends Promise{constructor(e,t=GD){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new i6(this.responsePromise,async t=>e(await this.parseResponse(t),t))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},Xee=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=MA("maxRetries",t),this.timeout=MA("timeout",r),this.httpAgent=s,this.fetch=i??$D}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...nte(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${cte()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&D0(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var g;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:VD(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,u=this.calculateContentLength(o),l=this.buildURL(s,i);"timeout"in e&&MA("timeout",e.timeout);const d=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??FD(l),f=d+1e3;typeof((g=h==null?void 0:h.options)==null?void 0:g.timeout)=="number"&&f>(h.options.timeout??0)&&(h.options.timeout=f),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const p=this.buildHeaders({options:e,headers:a,contentLength:u,retryCount:t});return{req:{method:r,...o&&{body:o},headers:p,...h&&{agent:h},signal:e.signal??null},url:l,timeout:d}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return t2(i,a),t2(i,t),VD(e.body)&&rg!=="node"&&delete i["content-type"],r2(a,"x-stainless-retry-count")===void 0&&r2(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return ms.generate(e,t,r,s)}request(e,t=null){return new ZD(this.makeRequest(e,t))}async makeRequest(e,t){var h,f;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),oh("request",a,r,i.headers),(h=r.signal)!=null&&h.aborted)throw new pi;const u=new AbortController,l=await this.fetchWithTimeout(a,i,o,u).catch($A);if(l instanceof Error){if((f=r.signal)!=null&&f.aborted)throw new pi;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new jD:new j0({cause:l})}const d=JD(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){const v=`retrying, ${t} attempts remaining`;return oh(`response (error; ${v})`,l.status,a,d),this.retryRequest(r,t,d)}const p=await l.text().catch(v=>$A(v).message),m=ste(p),g=m?void 0:p;throw oh(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,d,g),this.makeStatusError(l.status,m,g,d)}return{response:l,options:r,controller:u}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new Qee(this,r,e)}buildURL(e,t){const r=ate(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return q0(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new gt(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...a}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await ote(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${ah}`}},Yee=class{constructor(e,t,r,s){B0.set(this,void 0),Zee(this,B0,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new gt("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await Jee(this,B0,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(B0=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},Qee=class extends ZD{constructor(e,t,r){super(t,async s=>new r(e,s.response,await GD(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const JD=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),ete={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},U0=n=>typeof n=="object"&&n!==null&&!q0(n)&&Object.keys(n).every(e=>e2(ete,e)),tte=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ah,"X-Stainless-OS":YD(Deno.build.os),"X-Stainless-Arch":XD(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ah,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ah,"X-Stainless-OS":YD(process.platform),"X-Stainless-Arch":XD(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=rte();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ah,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ah,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function rte(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const XD=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",YD=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let QD;const nte=()=>QD??(QD=tte()),ste=n=>{try{return JSON.parse(n)}catch{return}},ite=new RegExp("^(?:[a-z]+:)?//","i"),ate=n=>ite.test(n),ote=n=>new Promise(e=>setTimeout(e,n)),MA=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new gt(`${n} must be an integer`);if(e<0)throw new gt(`${n} must be a positive integer`);return e},$A=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(String(n))},NA=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function q0(n){if(!n)return!0;for(const e in n)return!1;return!0}function e2(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function t2(n,e){for(const t in e){if(!e2(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function oh(n,...e){var t;typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`Anthropic:DEBUG:${n}`,...e)}const cte=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),ute=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",lte=n=>typeof(n==null?void 0:n.get)=="function",r2=(n,e)=>{var r;const t=e.toLowerCase();if(lte(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};let dte=class extends Yee{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var t;if((t=this.options.query)!=null&&t.before_id){const r=this.first_id;return r?{params:{before_id:r}}:null}const e=this.last_id;return e?{params:{after_id:e}}:null}},Su=class{constructor(e){this._client=e}};class FA{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new ng;for await(const t of this.iterator)for(const r of e.decode(t))yield JSON.parse(r);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),new gt("Attempted to iterate over a response with no body");return new FA(OA(e.body),t)}}let LA=class extends Su{create(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages/batches?beta=true",{body:s,...t,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}retrieve(e,t={},r){if(U0(t))return this.retrieve(e,{},t);const{betas:s}=t;return this._client.get(`/v1/messages/batches/${e}?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}list(e={},t){if(U0(e))return this.list({},e);const{betas:r,...s}=e;return this._client.getAPIList("/v1/messages/batches?beta=true",jA,{query:s,...t,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}cancel(e,t={},r){if(U0(t))return this.cancel(e,{},t);const{betas:s}=t;return this._client.post(`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}async results(e,t={},r){if(U0(t))return this.results(e,{},t);const s=await this.retrieve(e);if(!s.results_url)throw new gt(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);const{betas:i}=t;return this._client.get(s.results_url,{...r,headers:{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers},__binaryResponse:!0})._thenUnwrap((a,o)=>FA.fromResponse(o.response,o.controller))}};class jA extends dte{}LA.BetaMessageBatchesPage=jA;let H0=class extends Su{constructor(){super(...arguments),this.batches=new LA(this._client)}create(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages?beta=true",{body:s,timeout:this._client._options.timeout??6e5,...t,headers:{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0,...t==null?void 0:t.headers},stream:e.stream??!1})}countTokens(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:s,...t,headers:{"anthropic-beta":[...r??[],"token-counting-2024-11-01"].toString(),...t==null?void 0:t.headers}})}};H0.Batches=LA,H0.BetaMessageBatchesPage=jA;const hte=n=>{let e=0,t=[];for(;e<n.length;){let r=n[e];if(r==="\\"){e++;continue}if(r==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(r==="["){t.push({type:"paren",value:"["}),e++;continue}if(r==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(r===":"){t.push({type:"separator",value:":"}),e++;continue}if(r===","){t.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let o="",u=!1;for(r=n[++e];r!=='"';){if(e===n.length){u=!0;break}if(r==="\\"){if(e++,e===n.length){u=!0;break}o+=r+n[e],r=n[++e]}else o+=r,r=n[++e]}r=n[++e],u||t.push({type:"string",value:o});continue}if(r&&/\s/.test(r)){e++;continue}let i=/[0-9]/;if(r&&i.test(r)||r==="-"||r==="."){let o="";for(r==="-"&&(o+=r,r=n[++e]);r&&i.test(r)||r===".";)o+=r,r=n[++e];t.push({type:"number",value:o});continue}let a=/[a-z]/i;if(r&&a.test(r)){let o="";for(;r&&a.test(r)&&e!==n.length;)o+=r,r=n[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},ch=n=>{if(n.length===0)return n;let e=n[n.length-1];switch(e.type){case"separator":return n=n.slice(0,n.length-1),ch(n);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return n=n.slice(0,n.length-1),ch(n);case"string":let r=n[n.length-2];if((r==null?void 0:r.type)==="delimiter")return n=n.slice(0,n.length-1),ch(n);if((r==null?void 0:r.type)==="brace"&&r.value==="{")return n=n.slice(0,n.length-1),ch(n);break;case"delimiter":return n=n.slice(0,n.length-1),ch(n)}return n},fte=n=>{let e=[];return n.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?n.push({type:"brace",value:"}"}):t==="]"&&n.push({type:"paren",value:"]"})}),n},pte=n=>{let e="";return n.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},n2=n=>JSON.parse(pte(fte(ch(hte(n)))));var Wn=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},it=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Ls,Vo,K0,W0,ig,ag,z0,og,ja,cg,V0,G0,uh,DA,s2,BA,UA,qA,HA,i2;const a2="__json_buf";class Z0{constructor(){Ls.add(this),this.messages=[],this.receivedMessages=[],Vo.set(this,void 0),this.controller=new AbortController,K0.set(this,void 0),W0.set(this,()=>{}),ig.set(this,()=>{}),ag.set(this,void 0),z0.set(this,()=>{}),og.set(this,()=>{}),ja.set(this,{}),cg.set(this,!1),V0.set(this,!1),G0.set(this,!1),uh.set(this,!1),BA.set(this,e=>{if(Wn(this,V0,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new pi),e instanceof pi)return Wn(this,G0,!0,"f"),this._emit("abort",e);if(e instanceof gt)return this._emit("error",e);if(e instanceof Error){const t=new gt(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new gt(String(e)))}),Wn(this,K0,new Promise((e,t)=>{Wn(this,W0,e,"f"),Wn(this,ig,t,"f")}),"f"),Wn(this,ag,new Promise((e,t)=>{Wn(this,z0,e,"f"),Wn(this,og,t,"f")}),"f"),it(this,K0,"f").catch(()=>{}),it(this,ag,"f").catch(()=>{})}static fromReadableStream(e){const t=new Z0;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){const s=new Z0;for(const i of t.messages)s._addPromptCachingBetaMessageParam(i);return s._run(()=>s._createPromptCachingBetaMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},it(this,BA,"f"))}_addPromptCachingBetaMessageParam(e){this.messages.push(e)}_addPromptCachingBetaMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createPromptCachingBetaMessage(e,t,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),it(this,Ls,"m",UA).call(this);const i=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)it(this,Ls,"m",qA).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new pi;it(this,Ls,"m",HA).call(this)}_connected(){this.ended||(it(this,W0,"f").call(this),this._emit("connect"))}get ended(){return it(this,cg,"f")}get errored(){return it(this,V0,"f")}get aborted(){return it(this,G0,"f")}abort(){this.controller.abort()}on(e,t){return(it(this,ja,"f")[e]||(it(this,ja,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=it(this,ja,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(it(this,ja,"f")[e]||(it(this,ja,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Wn(this,uh,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Wn(this,uh,!0,"f"),await it(this,ag,"f")}get currentMessage(){return it(this,Vo,"f")}async finalMessage(){return await this.done(),it(this,Ls,"m",DA).call(this)}async finalText(){return await this.done(),it(this,Ls,"m",s2).call(this)}_emit(e,...t){if(it(this,cg,"f"))return;e==="end"&&(Wn(this,cg,!0,"f"),it(this,z0,"f").call(this));const r=it(this,ja,"f")[e];if(r&&(it(this,ja,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!it(this,uh,"f")&&!(r!=null&&r.length)&&Promise.reject(s),it(this,ig,"f").call(this,s),it(this,og,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!it(this,uh,"f")&&!(r!=null&&r.length)&&Promise.reject(s),it(this,ig,"f").call(this,s),it(this,og,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalPromptCachingBetaMessage",it(this,Ls,"m",DA).call(this))}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),it(this,Ls,"m",UA).call(this),this._connected();const s=sg.fromReadableStream(e,this.controller);for await(const a of s)it(this,Ls,"m",qA).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new pi;it(this,Ls,"m",HA).call(this)}[(Vo=new WeakMap,K0=new WeakMap,W0=new WeakMap,ig=new WeakMap,ag=new WeakMap,z0=new WeakMap,og=new WeakMap,ja=new WeakMap,cg=new WeakMap,V0=new WeakMap,G0=new WeakMap,uh=new WeakMap,BA=new WeakMap,Ls=new WeakSet,DA=function(){if(this.receivedMessages.length===0)throw new gt("stream ended without producing a PromptCachingBetaMessage with role=assistant");return this.receivedMessages.at(-1)},s2=function(){if(this.receivedMessages.length===0)throw new gt("stream ended without producing a PromptCachingBetaMessage with role=assistant");const t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new gt("stream ended without producing a content block with type=text");return t.join(" ")},UA=function(){this.ended||Wn(this,Vo,void 0,"f")},qA=function(t){if(this.ended)return;const r=it(this,Ls,"m",i2).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{const s=r.content.at(-1);t.delta.type==="text_delta"&&s.type==="text"?this._emit("text",t.delta.text,s.text||""):t.delta.type==="input_json_delta"&&s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"message_stop":{this._addPromptCachingBetaMessageParam(r),this._addPromptCachingBetaMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{Wn(this,Vo,r,"f");break}}},HA=function(){if(this.ended)throw new gt("stream has ended, this shouldn't happen");const t=it(this,Vo,"f");if(!t)throw new gt("request ended without sending any chunks");return Wn(this,Vo,void 0,"f"),t},i2=function(t){let r=it(this,Vo,"f");if(t.type==="message_start"){if(r)throw new gt(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new gt(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{const s=r.content.at(t.index);if((s==null?void 0:s.type)==="text"&&t.delta.type==="text_delta")s.text+=t.delta.text;else if((s==null?void 0:s.type)==="tool_use"&&t.delta.type==="input_json_delta"){let i=s[a2]||"";i+=t.delta.partial_json,Object.defineProperty(s,a2,{value:i,enumerable:!1,writable:!0}),i&&(s.input=n2(i))}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("streamEvent",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new sg(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let o2=class extends Su{create(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages?beta=prompt_caching",{body:s,timeout:this._client._options.timeout??6e5,...t,headers:{"anthropic-beta":[...r??[],"prompt-caching-2024-07-31"].toString(),...t==null?void 0:t.headers},stream:e.stream??!1})}stream(e,t){return Z0.createMessage(this,e,t)}};class KA extends Su{constructor(){super(...arguments),this.messages=new o2(this._client)}}KA.Messages=o2;let J0=class extends Su{constructor(){super(...arguments),this.messages=new H0(this._client),this.promptCaching=new KA(this._client)}};J0.Messages=H0,J0.PromptCaching=KA;let c2=class extends Su{create(e,t){return this._client.post("/v1/complete",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}};var zn=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},at=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},js,Go,X0,Y0,ug,lg,Q0,dg,Da,hg,eS,tS,lh,WA,u2,zA,VA,GA,ZA,l2;const d2="__json_buf";class rS{constructor(){js.add(this),this.messages=[],this.receivedMessages=[],Go.set(this,void 0),this.controller=new AbortController,X0.set(this,void 0),Y0.set(this,()=>{}),ug.set(this,()=>{}),lg.set(this,void 0),Q0.set(this,()=>{}),dg.set(this,()=>{}),Da.set(this,{}),hg.set(this,!1),eS.set(this,!1),tS.set(this,!1),lh.set(this,!1),zA.set(this,e=>{if(zn(this,eS,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new pi),e instanceof pi)return zn(this,tS,!0,"f"),this._emit("abort",e);if(e instanceof gt)return this._emit("error",e);if(e instanceof Error){const t=new gt(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new gt(String(e)))}),zn(this,X0,new Promise((e,t)=>{zn(this,Y0,e,"f"),zn(this,ug,t,"f")}),"f"),zn(this,lg,new Promise((e,t)=>{zn(this,Q0,e,"f"),zn(this,dg,t,"f")}),"f"),at(this,X0,"f").catch(()=>{}),at(this,lg,"f").catch(()=>{})}static fromReadableStream(e){const t=new rS;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){const s=new rS;for(const i of t.messages)s._addMessageParam(i);return s._run(()=>s._createMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},at(this,zA,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),at(this,js,"m",VA).call(this);const i=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)at(this,js,"m",GA).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new pi;at(this,js,"m",ZA).call(this)}_connected(){this.ended||(at(this,Y0,"f").call(this),this._emit("connect"))}get ended(){return at(this,hg,"f")}get errored(){return at(this,eS,"f")}get aborted(){return at(this,tS,"f")}abort(){this.controller.abort()}on(e,t){return(at(this,Da,"f")[e]||(at(this,Da,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=at(this,Da,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(at(this,Da,"f")[e]||(at(this,Da,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{zn(this,lh,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){zn(this,lh,!0,"f"),await at(this,lg,"f")}get currentMessage(){return at(this,Go,"f")}async finalMessage(){return await this.done(),at(this,js,"m",WA).call(this)}async finalText(){return await this.done(),at(this,js,"m",u2).call(this)}_emit(e,...t){if(at(this,hg,"f"))return;e==="end"&&(zn(this,hg,!0,"f"),at(this,Q0,"f").call(this));const r=at(this,Da,"f")[e];if(r&&(at(this,Da,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!at(this,lh,"f")&&!(r!=null&&r.length)&&Promise.reject(s),at(this,ug,"f").call(this,s),at(this,dg,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!at(this,lh,"f")&&!(r!=null&&r.length)&&Promise.reject(s),at(this,ug,"f").call(this,s),at(this,dg,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",at(this,js,"m",WA).call(this))}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),at(this,js,"m",VA).call(this),this._connected();const s=sg.fromReadableStream(e,this.controller);for await(const a of s)at(this,js,"m",GA).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new pi;at(this,js,"m",ZA).call(this)}[(Go=new WeakMap,X0=new WeakMap,Y0=new WeakMap,ug=new WeakMap,lg=new WeakMap,Q0=new WeakMap,dg=new WeakMap,Da=new WeakMap,hg=new WeakMap,eS=new WeakMap,tS=new WeakMap,lh=new WeakMap,zA=new WeakMap,js=new WeakSet,WA=function(){if(this.receivedMessages.length===0)throw new gt("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},u2=function(){if(this.receivedMessages.length===0)throw new gt("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new gt("stream ended without producing a content block with type=text");return t.join(" ")},VA=function(){this.ended||zn(this,Go,void 0,"f")},GA=function(t){if(this.ended)return;const r=at(this,js,"m",l2).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{const s=r.content.at(-1);t.delta.type==="text_delta"&&s.type==="text"?this._emit("text",t.delta.text,s.text||""):t.delta.type==="input_json_delta"&&s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{zn(this,Go,r,"f");break}}},ZA=function(){if(this.ended)throw new gt("stream has ended, this shouldn't happen");const t=at(this,Go,"f");if(!t)throw new gt("request ended without sending any chunks");return zn(this,Go,void 0,"f"),t},l2=function(t){let r=at(this,Go,"f");if(t.type==="message_start"){if(r)throw new gt(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new gt(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{const s=r.content.at(t.index);if((s==null?void 0:s.type)==="text"&&t.delta.type==="text_delta")s.text+=t.delta.text;else if((s==null?void 0:s.type)==="tool_use"&&t.delta.type==="input_json_delta"){let i=s[d2]||"";i+=t.delta.partial_json,Object.defineProperty(s,d2,{value:i,enumerable:!1,writable:!0}),i&&(s.input=n2(i))}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("streamEvent",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new sg(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let h2=class extends Su{create(e,t){return e.model in f2&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${f2[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}stream(e,t){return rS.createMessage(this,e,t)}};const f2={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024"};var p2;class Xt extends Xee{constructor({baseURL:e=NA("ANTHROPIC_BASE_URL"),apiKey:t=NA("ANTHROPIC_API_KEY")??null,authToken:r=NA("ANTHROPIC_AUTH_TOKEN")??null,...s}={}){const i={apiKey:t,authToken:r,...s,baseURL:e||"https://api.anthropic.com"};if(!i.dangerouslyAllowBrowser&&ute())throw new gt(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });

TODO: link!
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new c2(this),this.messages=new h2(this),this.beta=new J0(this),this._options=i,this.apiKey=t,this.authToken=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,t){if(!(this.apiKey&&e["x-api-key"])&&t["x-api-key"]!==null&&!(this.authToken&&e.authorization)&&t.authorization!==null)throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){const t=this.apiKeyAuth(e),r=this.bearerAuth(e);return t!=null&&!q0(t)?t:r!=null&&!q0(r)?r:{}}apiKeyAuth(e){return this.apiKey==null?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return this.authToken==null?{}:{Authorization:`Bearer ${this.authToken}`}}}p2=Xt,Xt.Anthropic=p2,Xt.HUMAN_PROMPT=`

Human:`,Xt.AI_PROMPT=`

Assistant:`,Xt.DEFAULT_TIMEOUT=6e5,Xt.AnthropicError=gt,Xt.APIError=ms,Xt.APIConnectionError=j0,Xt.APIConnectionTimeoutError=jD,Xt.APIUserAbortError=pi,Xt.NotFoundError=qD,Xt.ConflictError=HD,Xt.RateLimitError=WD,Xt.BadRequestError=DD,Xt.AuthenticationError=BD,Xt.InternalServerError=zD,Xt.PermissionDeniedError=UD,Xt.UnprocessableEntityError=KD,Xt.toFile=Kee,Xt.fileFromPath=LD,Xt.Completions=c2,Xt.Messages=h2,Xt.Beta=J0;class m2 extends EA{static lc_name(){return"AnthropicToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","anthropic","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){let t=e;if(typeof e=="string")try{t=JSON.parse(e)}catch(s){throw new sh(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(s.message)}`,e)}else t=e;if(this.zodSchema===void 0)return t;const r=await this.zodSchema.safeParseAsync(t);if(r.success)return r.data;throw new sh(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(r.error.errors)}`,JSON.stringify(t,null,2))}async parseResult(e){const t=e.flatMap(i=>{const{message:a}=i;return Array.isArray(a.content)?g2(a.content)[0]:[]});if(t[0]===void 0)throw new Error("No parseable tool calls provided to AnthropicToolsOutputParser.");const[r]=t;return await this._validateResult(r.args)}}function g2(n){const e=[];for(const t of n)t.type==="tool_use"&&e.push({name:t.name,args:t.input,id:t.id,type:"tool_call"});return e}function mte(n){if(n)return n==="any"?{type:"any"}:n==="auto"?{type:"auto"}:typeof n=="string"?{type:"tool",name:n}:n}function y2(n){const e=/^data:(image\/.+);base64,(.+)$/,t=n.match(e);if(t===null)throw new Error(["Anthropic only supports base64-encoded images currently.","Example: data:image/png;base64,/9j/4AAQSk..."].join(`

`));return{type:"base64",media_type:t[1]??"",data:t[2]??""}}function gte(n){const e=[];for(const t of n)if(t._getType()==="tool")if(typeof t.content=="string"){const r=e[e.length-1];(r==null?void 0:r._getType())==="human"&&Array.isArray(r.content)&&"type"in r.content[0]&&r.content[0].type==="tool_result"?r.content.push({type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}):e.push(new Jt({content:[{type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}]}))}else e.push(new Jt({content:[{type:"tool_result",content:JA(t.content),tool_use_id:t.tool_call_id}]}));else e.push(t);return e}function w2(n){if(n.id===void 0)throw new Error('Anthropic requires all tool calls to have an "id".');return{type:"tool_use",id:n.id,name:n.name,input:n.args}}function JA(n){const e=["tool_use","tool_result","input_json_delta"],t=["text","text_delta"];return typeof n=="string"?n:n.map(s=>{const i="cache_control"in s?s.cache_control:void 0;if(s.type==="image_url"){let a;return typeof s.image_url=="string"?a=y2(s.image_url):a=y2(s.image_url.url),{type:"image",source:a,...i?{cache_control:i}:{}}}else{if(s.type==="document")return{type:"document",source:s.source,...i?{cache_control:i}:{}};if(t.find(a=>a===s.type)&&"text"in s)return{type:"text",text:s.text,...i?{cache_control:i}:{}};if(e.find(a=>a===s.type)){const a={...s};if("index"in a&&delete a.index,a.type==="input_json_delta"&&(a.type="tool_use"),"input"in a)try{a.input=JSON.parse(a.input)}catch{}return{...a,...i?{cache_control:i}:{}}}else throw new Error("Unsupported message content format")}})}function v2(n){const e=gte(n);let t;e.length>0&&e[0]._getType()==="system"&&(t=n[0].content);const s=(t!==void 0?e.slice(1):e).map(i=>{var o;let a;if(i._getType()==="human")a="user";else if(i._getType()==="ai")a="assistant";else if(i._getType()==="tool")a="user";else throw i._getType()==="system"?new Error("System messages are only permitted as the first passed message."):new Error(`Message type "${i._getType()}" is not supported.`);if(pu(i)&&((o=i.tool_calls)!=null&&o.length)){if(typeof i.content=="string")return i.content===""?{role:a,content:i.tool_calls.map(w2)}:{role:a,content:[{type:"text",text:i.content},...i.tool_calls.map(w2)]};{const{content:u}=i;return!i.tool_calls.every(d=>u.find(h=>(h.type==="tool_use"||h.type==="input_json_delta")&&h.id===d.id))&&console.warn('The "tool_calls" field on a message is only respected if content is a string.'),{role:a,content:JA(i.content)}}}else return{role:a,content:JA(i.content)}});return{messages:yte(s),system:t}}function yte(n){if(!n||n.length<=1)return n;const e=[];let t=n[0];const r=i=>typeof i=="string"?[{type:"text",text:i}]:i,s=i=>i.role!=="user"||typeof i.content=="string"?!1:Array.isArray(i.content)&&i.content.every(a=>a.type==="tool_result");for(let i=1;i<n.length;i+=1){const a=n[i];s(t)&&s(a)?t={...t,content:[...r(t.content),...r(a.content)]}:(e.push(t),t=a)}return e.push(t),e}function wte(n,e){var t,r;if(n.type==="message_start"){const{content:s,usage:i,...a}=n.message,o={};for(const[f,p]of Object.entries(a))p!=null&&(o[f]=p);const{input_tokens:u,output_tokens:l,...d}=i??{},h={input_tokens:u,output_tokens:l,total_tokens:u+l,input_token_details:{cache_creation:d.cache_creation_input_tokens,cache_read:d.cache_read_input_tokens}};return{chunk:new wr({content:e.coerceContentToString?"":[],additional_kwargs:o,usage_metadata:e.streamUsage?h:void 0,response_metadata:{usage:{...d}},id:n.message.id})}}else if(n.type==="message_delta"){const s={input_tokens:0,output_tokens:n.usage.output_tokens,total_tokens:n.usage.output_tokens,input_token_details:{cache_creation:n.usage.cache_creation_input_tokens,cache_read:n.usage.cache_read_input_tokens}};return{chunk:new wr({content:e.coerceContentToString?"":[],additional_kwargs:{...n.delta},usage_metadata:e.streamUsage?s:void 0})}}else if(n.type==="content_block_start"&&n.content_block.type==="tool_use"){const s=n.content_block;return{chunk:new wr({content:e.coerceContentToString?"":[{index:n.index,...n.content_block,input:""}],additional_kwargs:{},tool_call_chunks:[{id:s.id,index:n.index,name:s.name,args:""}]})}}else if(n.type==="content_block_delta"&&n.delta.type==="text_delta"){const s=(t=n.delta)==null?void 0:t.text;if(s!==void 0)return{chunk:new wr({content:e.coerceContentToString?s:[{index:n.index,...n.delta}],additional_kwargs:{}})}}else{if(n.type==="content_block_delta"&&n.delta.type==="input_json_delta")return{chunk:new wr({content:e.coerceContentToString?"":[{index:n.index,input:n.delta.partial_json,type:n.delta.type}],additional_kwargs:{},tool_call_chunks:[{index:n.index,args:n.delta.partial_json}]})};if(n.type==="content_block_start"&&n.content_block.type==="text"){const s=(r=n.content_block)==null?void 0:r.text;if(s!==void 0)return{chunk:new wr({content:e.coerceContentToString?s:[{index:n.index,...n.content_block}],additional_kwargs:{}})}}}return null}function vte(n,e){const t=e.usage,r=t!=null?{input_tokens:t.input_tokens??0,output_tokens:t.output_tokens??0,total_tokens:(t.input_tokens??0)+(t.output_tokens??0),input_token_details:{cache_creation:t.cache_creation_input_tokens,cache_read:t.cache_read_input_tokens}}:void 0;if(n.length===1&&n[0].type==="text")return[{text:n[0].text,message:new nn({content:n[0].text,additional_kwargs:e,usage_metadata:r,response_metadata:e,id:e.id})}];{const s=g2(n);return[{text:"",message:new nn({content:n,additional_kwargs:e,tool_calls:s,usage_metadata:r,response_metadata:e,id:e.id})}]}}function nS(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function _2(n){let e;return n.status===400&&n.message.includes("tool")?e=nS(n,"INVALID_TOOL_RESULTS"):n.status===401?e=nS(n,"MODEL_AUTHENTICATION"):n.status===404?e=nS(n,"MODEL_NOT_FOUND"):n.status===429?e=nS(n,"MODEL_RATE_LIMIT"):e=n,e}function _te(n){return!!(n.tools&&n.tools.length>0)}function bte(n){return"input_schema"in n}function Ste(n){if(typeof n.content=="string")return n.content;if(Array.isArray(n.content)&&n.content.length>=1&&"input"in n.content[0])return typeof n.content[0].input=="string"?n.content[0].input:JSON.stringify(n.content[0].input);if(Array.isArray(n.content)&&n.content.length>=1&&"text"in n.content[0])return n.content[0].text}class xte extends Fs{static lc_name(){return"ChatAnthropic"}get lc_secrets(){return{anthropicApiKey:"ANTHROPIC_API_KEY",apiKey:"ANTHROPIC_API_KEY"}}get lc_aliases(){return{modelName:"model"}}constructor(e){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"anthropicApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"invocationKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"clientOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamingClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"createClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.anthropicApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.anthropicApiKey)??sn("ANTHROPIC_API_KEY"),!this.anthropicApiKey&&!(e!=null&&e.createClient))throw new Error("Anthropic API key not found");this.clientOptions=(e==null?void 0:e.clientOptions)??{},this.apiKey=this.anthropicApiKey,this.apiUrl=e==null?void 0:e.anthropicApiUrl,this.modelName=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.model=this.modelName,this.invocationKwargs=(e==null?void 0:e.invocationKwargs)??{},this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topK=(e==null?void 0:e.topK)??this.topK,this.topP=(e==null?void 0:e.topP)??this.topP,this.maxTokens=(e==null?void 0:e.maxTokensToSample)??(e==null?void 0:e.maxTokens)??this.maxTokens,this.stopSequences=(e==null?void 0:e.stopSequences)??this.stopSequences,this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.createClient=(e==null?void 0:e.createClient)??(t=>new Xt(t))}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"anthropic",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}formatStructuredToolToAnthropic(e){if(!(!e||!e.length))return e.map(t=>{if(bte(t))return t;if(Ym(t))return{name:t.function.name,description:t.function.description,input_schema:t.function.parameters};if(ih(t))return{name:t.name,description:t.description,input_schema:$a(t.schema)};throw new Error(`Unknown tool type passed to ChatAnthropic: ${JSON.stringify(t,null,2)}`)})}bindTools(e,t){return this.bind({tools:this.formatStructuredToolToAnthropic(e),...t})}invocationParams(e){const t=mte(e==null?void 0:e.tool_choice);return{model:this.model,temperature:this.temperature,top_k:this.topK,top_p:this.topP,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:t,...this.invocationKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams()}}identifyingParams(){return{model_name:this.model,...this.invocationParams()}}async*_streamResponseChunks(e,t,r){var u;const s=this.invocationParams(t),i=v2(e),a=!_te({...s,...i,stream:!1}),o=await this.createStreamWithRetry({...s,...i,stream:!0},{headers:t.headers});for await(const l of o){if((u=t.signal)!=null&&u.aborted)throw o.controller.abort(),new Error("AbortError: User aborted the request.");const d=this.streamUsage??t.streamUsage,h=wte(l,{streamUsage:d,coerceContentToString:a});if(!h)continue;const{chunk:f}=h,p=Ste(f),m=new ds({message:new wr({content:f.content,additional_kwargs:f.additional_kwargs,tool_call_chunks:f.tool_call_chunks,usage_metadata:d?f.usage_metadata:void 0,response_metadata:f.response_metadata,id:f.id}),text:p??""});yield m,await(r==null?void 0:r.handleLLMNewToken(p??"",void 0,void 0,void 0,void 0,{chunk:m}))}}async _generateNonStreaming(e,t,r){const s=await this.completionWithRetry({...t,stream:!1,...v2(e)},r),{content:i,...a}=s,o=vte(i,a),{role:u,type:l,...d}=a;return{generations:o,llmOutput:d}}async _generate(e,t,r){if(this.stopSequences&&t.stop)throw new Error('"stopSequence" parameter found in input and default params');const s=this.invocationParams(t);if(s.stream){let i;const a=this._streamResponseChunks(e,t,r);for await(const o of a)i===void 0?i=o:i=i.concat(o);if(i===void 0)throw new Error("No chunks returned from Anthropic API.");return{generations:[{text:i.text,message:i.message}]}}else return this._generateNonStreaming(e,s,{signal:t.signal,headers:t.headers})}async createStreamWithRetry(e,t){if(!this.streamingClient){const s=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.streamingClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...s,apiKey:this.apiKey,maxRetries:0})}const r=async()=>{try{return await this.streamingClient.messages.create({...e,...this.invocationKwargs,stream:!0},t)}catch(s){throw _2(s)}};return this.caller.call(r)}async completionWithRetry(e,t){if(!this.batchClient){const s=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.batchClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...s,apiKey:this.apiKey,maxRetries:0})}const r=async()=>{try{return await this.batchClient.messages.create({...e,...this.invocationKwargs},t)}catch(s){throw _2(s)}};return this.caller.callWithOptions({signal:t.signal??void 0},r)}_llmType(){return"anthropic"}withStructuredOutput(e,t){const r=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw;if(i==="jsonMode")throw new Error('Anthropic only supports "functionCalling" as a method.');let o=s??"extract",u,l;if(Qm(r)){const m=$a(r);l=[{name:o,description:m.description??"A function available to call.",input_schema:m}],u=new m2({returnSingle:!0,keyName:o,zodSchema:r})}else{let m;typeof r.name=="string"&&typeof r.description=="string"&&typeof r.input_schema=="object"&&r.input_schema!=null?(m=r,o=r.name):m={name:o,description:r.description??"",input_schema:r},l=[m],u=new m2({returnSingle:!0,keyName:o})}const d=this.bind({tools:l,tool_choice:{type:"tool",name:o}});if(!a)return d.pipe(u).withConfig({runName:"ChatAnthropicStructuredOutput"});const h=Ns.assign({parsed:(m,g)=>u.invoke(m.raw,g)}),f=Ns.assign({parsed:()=>null}),p=h.withFallbacks({fallbacks:[f]});return hs.from([{raw:d},p]).withConfig({runName:"StructuredOutputRunnable"})}}class Ete extends xte{}var b2;(function(n){n.STRING="string",n.NUMBER="number",n.INTEGER="integer",n.BOOLEAN="boolean",n.ARRAY="array",n.OBJECT="object"})(b2||(b2={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var S2;(function(n){n.LANGUAGE_UNSPECIFIED="language_unspecified",n.PYTHON="python"})(S2||(S2={}));var x2;(function(n){n.OUTCOME_UNSPECIFIED="outcome_unspecified",n.OUTCOME_OK="outcome_ok",n.OUTCOME_FAILED="outcome_failed",n.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(x2||(x2={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E2=["user","model","function","system"];var k2;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(k2||(k2={}));var C2;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(C2||(C2={}));var P2;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(P2||(P2={}));var A2;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER"})(A2||(A2={}));var fg;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER"})(fg||(fg={}));var T2;(function(n){n.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING"})(T2||(T2={}));var dh;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(dh||(dh={}));var I2;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(I2||(I2={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class hh extends Vn{constructor(e,t){super(e),this.response=t}}class O2 extends Vn{constructor(e,t,r,s){super(e),this.status=t,this.statusText=r,this.errorDetails=s}}class Zo extends Vn{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kte="https://generativelanguage.googleapis.com",Cte="v1beta",Pte="0.21.0",Ate="genai-js";var xu;(function(n){n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents"})(xu||(xu={}));class Tte{constructor(e,t,r,s,i){this.model=e,this.task=t,this.apiKey=r,this.stream=s,this.requestOptions=i}toString(){var e,t;const r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||Cte;let i=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||kte}/${r}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}}function Ite(n){const e=[];return n!=null&&n.apiClient&&e.push(n.apiClient),e.push(`${Ate}/${Pte}`),e.join(" ")}async function Ote(n){var e;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",Ite(n.requestOptions)),t.append("x-goog-api-key",n.apiKey);let r=(e=n.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(s){throw new Zo(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${s.message}`)}for(const[s,i]of r.entries()){if(s==="x-goog-api-key")throw new Zo(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new Zo(`Header name ${s} can only be set using the apiClient field`);t.append(s,i)}}return t}async function Rte(n,e,t,r,s,i){const a=new Tte(n,e,t,r,i);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},Fte(i)),{method:"POST",headers:await Ote(a),body:s})}}async function pg(n,e,t,r,s,i={},a=fetch){const{url:o,fetchOptions:u}=await Rte(n,e,t,r,s,i);return Mte(o,u,a)}async function Mte(n,e,t=fetch){let r;try{r=await t(n,e)}catch(s){$te(s,n)}return r.ok||await Nte(r,n),r}function $te(n,e){let t=n;throw n instanceof O2||n instanceof Zo||(t=new Vn(`Error fetching from ${e.toString()}: ${n.message}`),t.stack=n.stack),t}async function Nte(n,e){let t="",r;try{const s=await n.json();t=s.error.message,s.error.details&&(t+=` ${JSON.stringify(s.error.details)}`,r=s.error.details)}catch{}throw new O2(`Error fetching from ${e.toString()}: [${n.status} ${n.statusText}] ${t}`,n.status,n.statusText,r)}function Fte(n){const e={};if((n==null?void 0:n.signal)!==void 0||(n==null?void 0:n.timeout)>=0){const t=new AbortController;(n==null?void 0:n.timeout)>=0&&setTimeout(()=>t.abort(),n.timeout),n!=null&&n.signal&&n.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XA(n){return n.text=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),sS(n.candidates[0]))throw new hh(`${Jo(n)}`,n);return Lte(n)}else if(n.promptFeedback)throw new hh(`Text not available. ${Jo(n)}`,n);return""},n.functionCall=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),sS(n.candidates[0]))throw new hh(`${Jo(n)}`,n);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),R2(n)[0]}else if(n.promptFeedback)throw new hh(`Function call not available. ${Jo(n)}`,n)},n.functionCalls=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),sS(n.candidates[0]))throw new hh(`${Jo(n)}`,n);return R2(n)}else if(n.promptFeedback)throw new hh(`Function call not available. ${Jo(n)}`,n)},n}function Lte(n){var e,t,r,s;const i=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const a of(s=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)a.text&&i.push(a.text),a.executableCode&&i.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&i.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}function R2(n){var e,t,r,s;const i=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const a of(s=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)a.functionCall&&i.push(a.functionCall);if(i.length>0)return i}const jte=[fg.RECITATION,fg.SAFETY,fg.LANGUAGE];function sS(n){return!!n.finishReason&&jte.includes(n.finishReason)}function Jo(n){var e,t,r;let s="";if((!n.candidates||n.candidates.length===0)&&n.promptFeedback)s+="Response was blocked",!((e=n.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${n.promptFeedback.blockReason}`),!((t=n.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(s+=`: ${n.promptFeedback.blockReasonMessage}`);else if(!((r=n.candidates)===null||r===void 0)&&r[0]){const i=n.candidates[0];sS(i)&&(s+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(s+=`: ${i.finishMessage}`))}return s}function mg(n){return this instanceof mg?(this.v=n,this):new mg(n)}function Dte(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(f){r[f]&&(s[f]=function(p){return new Promise(function(m,g){i.push([f,p,m,g])>1||o(f,p)})})}function o(f,p){try{u(r[f](p))}catch(m){h(i[0][3],m)}}function u(f){f.value instanceof mg?Promise.resolve(f.value.v).then(l,d):h(i[0][2],f)}function l(f){o("next",f)}function d(f){o("throw",f)}function h(f,p){f(p),i.shift(),i.length&&o(i[0][0],i[0][1])}}typeof SuppressedError=="function"&&SuppressedError;/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M2=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Bte(n){const e=n.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=Hte(e),[r,s]=t.tee();return{stream:qte(r),response:Ute(s)}}async function Ute(n){const e=[],t=n.getReader();for(;;){const{done:r,value:s}=await t.read();if(r)return XA(Kte(e));e.push(s)}}function qte(n){return Dte(this,arguments,function*(){const t=n.getReader();for(;;){const{value:r,done:s}=yield mg(t.read());if(s)break;yield yield mg(XA(r))}})}function Hte(n){const e=n.getReader();return new ReadableStream({start(r){let s="";return i();function i(){return e.read().then(({value:a,done:o})=>{if(o){if(s.trim()){r.error(new Vn("Failed to parse stream"));return}r.close();return}s+=a;let u=s.match(M2),l;for(;u;){try{l=JSON.parse(u[1])}catch{r.error(new Vn(`Error parsing JSON response: "${u[1]}"`));return}r.enqueue(l),s=s.substring(u[0].length),u=s.match(M2)}return i()})}}})}function Kte(n){const e=n[n.length-1],t={promptFeedback:e==null?void 0:e.promptFeedback};for(const r of n){if(r.candidates)for(const s of r.candidates){const i=s.index;if(t.candidates||(t.candidates=[]),t.candidates[i]||(t.candidates[i]={index:s.index}),t.candidates[i].citationMetadata=s.citationMetadata,t.candidates[i].groundingMetadata=s.groundingMetadata,t.candidates[i].finishReason=s.finishReason,t.candidates[i].finishMessage=s.finishMessage,t.candidates[i].safetyRatings=s.safetyRatings,s.content&&s.content.parts){t.candidates[i].content||(t.candidates[i].content={role:s.content.role||"user",parts:[]});const a={};for(const o of s.content.parts)o.text&&(a.text=o.text),o.functionCall&&(a.functionCall=o.functionCall),o.executableCode&&(a.executableCode=o.executableCode),o.codeExecutionResult&&(a.codeExecutionResult=o.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),t.candidates[i].content.parts.push(a)}}r.usageMetadata&&(t.usageMetadata=r.usageMetadata)}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $2(n,e,t,r){const s=await pg(e,xu.STREAM_GENERATE_CONTENT,n,!0,JSON.stringify(t),r);return Bte(s)}async function N2(n,e,t,r){const i=await(await pg(e,xu.GENERATE_CONTENT,n,!1,JSON.stringify(t),r)).json();return{response:XA(i)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F2(n){if(n!=null){if(typeof n=="string")return{role:"system",parts:[{text:n}]};if(n.text)return{role:"system",parts:[n]};if(n.parts)return n.role?n:{role:"system",parts:n.parts}}}function gg(n){let e=[];if(typeof n=="string")e=[{text:n}];else for(const t of n)typeof t=="string"?e.push({text:t}):e.push(t);return Wte(e)}function Wte(n){const e={role:"user",parts:[]},t={role:"function",parts:[]};let r=!1,s=!1;for(const i of n)"functionResponse"in i?(t.parts.push(i),s=!0):(e.parts.push(i),r=!0);if(r&&s)throw new Vn("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!s)throw new Vn("No content is provided for sending chat message.");return r?e:t}function zte(n,e){var t;let r={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(t=e==null?void 0:e.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const s=n.generateContentRequest!=null;if(n.contents){if(s)throw new Zo("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=n.contents}else if(s)r=Object.assign(Object.assign({},r),n.generateContentRequest);else{const i=gg(n);r.contents=[i]}return{generateContentRequest:r}}function L2(n){let e;return n.contents?e=n:e={contents:[gg(n)]},n.systemInstruction&&(e.systemInstruction=F2(n.systemInstruction)),e}function Vte(n){return typeof n=="string"||Array.isArray(n)?{content:gg(n)}:n}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j2=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Gte={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Zte(n){let e=!1;for(const t of n){const{role:r,parts:s}=t;if(!e&&r!=="user")throw new Vn(`First content should be with role 'user', got ${r}`);if(!E2.includes(r))throw new Vn(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(E2)}`);if(!Array.isArray(s))throw new Vn("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new Vn("Each Content should have at least one part");const i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const o of s)for(const u of j2)u in o&&(i[u]+=1);const a=Gte[r];for(const o of j2)if(!a.includes(o)&&i[o]>0)throw new Vn(`Content with role '${r}' can't contain '${o}' part`);e=!0}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D2="SILENT_ERROR";class Jte{constructor(e,t,r,s={}){this.model=t,this.params=r,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r!=null&&r.history&&(Zte(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var r,s,i,a,o,u;await this._sendPromise;const l=gg(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,l]},h=Object.assign(Object.assign({},this._requestOptions),t);let f;return this._sendPromise=this._sendPromise.then(()=>N2(this._apiKey,this.model,d,h)).then(p=>{var m;if(p.response.candidates&&p.response.candidates.length>0){this._history.push(l);const g=Object.assign({parts:[],role:"model"},(m=p.response.candidates)===null||m===void 0?void 0:m[0].content);this._history.push(g)}else{const g=Jo(p.response);g&&console.warn(`sendMessage() was unsuccessful. ${g}. Inspect response object for details.`)}f=p}),await this._sendPromise,f}async sendMessageStream(e,t={}){var r,s,i,a,o,u;await this._sendPromise;const l=gg(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,l]},h=Object.assign(Object.assign({},this._requestOptions),t),f=$2(this._apiKey,this.model,d,h);return this._sendPromise=this._sendPromise.then(()=>f).catch(p=>{throw new Error(D2)}).then(p=>p.response).then(p=>{if(p.candidates&&p.candidates.length>0){this._history.push(l);const m=Object.assign({},p.candidates[0].content);m.role||(m.role="model"),this._history.push(m)}else{const m=Jo(p);m&&console.warn(`sendMessageStream() was unsuccessful. ${m}. Inspect response object for details.`)}}).catch(p=>{p.message!==D2&&console.error(p)}),f}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xte(n,e,t,r){return(await pg(e,xu.COUNT_TOKENS,n,!1,JSON.stringify(t),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yte(n,e,t,r){return(await pg(e,xu.EMBED_CONTENT,n,!1,JSON.stringify(t),r)).json()}async function Qte(n,e,t,r){const s=t.requests.map(a=>Object.assign(Object.assign({},a),{model:e}));return(await pg(e,xu.BATCH_EMBED_CONTENTS,n,!1,JSON.stringify({requests:s}),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B2{constructor(e,t,r={}){this.apiKey=e,this._requestOptions=r,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=F2(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var r;const s=L2(e),i=Object.assign(Object.assign({},this._requestOptions),t);return N2(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}async generateContentStream(e,t={}){var r;const s=L2(e),i=Object.assign(Object.assign({},this._requestOptions),t);return $2(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}startChat(e){var t;return new Jte(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const r=zte(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return Xte(this.apiKey,this.model,r,s)}async embedContent(e,t={}){const r=Vte(e),s=Object.assign(Object.assign({},this._requestOptions),t);return Yte(this.apiKey,this.model,r,s)}async batchEmbedContents(e,t={}){const r=Object.assign(Object.assign({},this._requestOptions),t);return Qte(this.apiKey,this.model,e,r)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U2{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new Vn("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new B2(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,r){if(!e.name)throw new Zo("Cached content must contain a `name` field.");if(!e.model)throw new Zo("Cached content must contain a `model` field.");const s=["model","systemInstruction"];for(const a of s)if(t!=null&&t[a]&&e[a]&&(t==null?void 0:t[a])!==e[a]){if(a==="model"){const o=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,u=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(o===u)continue}throw new Zo(`Different value for "${a}" specified in modelParams (${t[a]}) and cachedContent (${e[a]})`)}const i=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new B2(this.apiKey,i,r)}}function yg(n){if(typeof n=="object"&&n!==null){const e={...n};"additionalProperties"in e&&delete e.additionalProperties,"$schema"in e&&delete e.$schema;for(const t in e)t in e&&(Array.isArray(e[t])?e[t]=e[t].map(yg):typeof e[t]=="object"&&e[t]!==null&&(e[t]=yg(e[t])));return e}return n}function q2(n){const e=yg($a(n)),{$schema:t,...r}=e;return r}function ere(n){const e=yg(n),{$schema:t,...r}=e;return r}function tre(n){const e=n._getType();return Lo.isInstance(n)?n.role:e==="tool"?e:n.name??e}function rre(n){switch(n){case"ai":case"model":return"model";case"system":return"system";case"human":return"user";case"tool":case"function":return"function";default:throw new Error(`Unknown / unsupported author: ${n}`)}}function nre(n){if("mimeType"in n&&"data"in n)return{inlineData:{mimeType:n.mimeType,data:n.data}};if("mimeType"in n&&"fileUri"in n)return{fileData:{mimeType:n.mimeType,fileUri:n.fileUri}};throw new Error("Invalid media content")}function sre(n,e){if(typeof n.content=="string"&&n.content!=="")return[{text:n.content}];let t=[],r=[],s=[];return"tool_calls"in n&&Array.isArray(n.tool_calls)&&n.tool_calls.length>0?t=n.tool_calls.map(i=>({functionCall:{name:i.name,args:i.args}})):n.getType()==="tool"&&n.name&&n.content?r=[{functionResponse:{name:n.name,response:n.content}}]:Array.isArray(n.content)&&(s=n.content.map(i=>{var a;if(i.type==="text")return{text:i.text};if(i.type==="executableCode")return{executableCode:i.executableCode};if(i.type==="codeExecutionResult")return{codeExecutionResult:i.codeExecutionResult};if(i.type==="image_url"){if(!e)throw new Error("This model does not support images");let o;if(typeof i.image_url=="string")o=i.image_url;else if(typeof i.image_url=="object"&&"url"in i.image_url)o=i.image_url.url;else throw new Error("Please provide image as base64 encoded data URL");const[u,l]=o.split(",");if(!u.startsWith("data:"))throw new Error("Please provide image as base64 encoded data URL");const[d,h]=u.replace(/^data:/,"").split(";");if(h!=="base64")throw new Error("Please provide image as base64 encoded data URL");return{inlineData:{data:l,mimeType:d}}}else{if(i.type==="media")return nre(i);if(i.type==="tool_use")return{functionCall:{name:i.name,args:i.input}};if((a=i.type)!=null&&a.includes("/")&&i.type.split("/").length===2&&"data"in i&&typeof i.data=="string")return{inlineData:{mimeType:i.type,data:i.data}}}throw new Error(`Unknown content type ${i.type}`)})),[...s,...t,...r]}function H2(n,e,t=!1){return n.reduce((r,s,i)=>{if(!mm(s))throw new Error("Unsupported message input");const a=tre(s);if(a==="system"&&i!==0)throw new Error("System message should be the first one");const o=rre(a),u=r.content[r.content.length];if(!r.mergeWithPreviousContent&&u&&u.role===o)throw new Error("Google Generative AI requires alternate messages between authors");const l=sre(s,e);if(r.mergeWithPreviousContent){const f=r.content[r.content.length-1];if(!f)throw new Error("There was a problem parsing your system message. Please try a prompt without one.");return f.parts.push(...l),{mergeWithPreviousContent:!1,content:r.content}}let d=o;(d==="function"||d==="system"&&!t)&&(d="user");const h={role:d,parts:l};return{mergeWithPreviousContent:a==="system"&&!t,content:[...r.content,h]}},{content:[],mergeWithPreviousContent:!1}).content}function ire(n,e){var l,d,h;if(!n.candidates||n.candidates.length===0||!n.candidates[0])return{generations:[],llmOutput:{filters:n.promptFeedback}};const t=n.functionCalls(),[r]=n.candidates,{content:s,...i}=r;let a;(s==null?void 0:s.parts.length)===1&&s.parts[0].text?a=s.parts[0].text:a=s.parts.map(f=>"text"in f?{type:"text",text:f.text}:"executableCode"in f?{type:"executableCode",executableCode:f.executableCode}:"codeExecutionResult"in f?{type:"codeExecutionResult",codeExecutionResult:f.codeExecutionResult}:f);let o="";return typeof a=="string"?o=a:"text"in a[0]&&(o=a[0].text),{generations:[{text:o,message:new nn({content:a,tool_calls:t==null?void 0:t.map(f=>({...f,type:"tool_call"})),additional_kwargs:{...i},usage_metadata:e==null?void 0:e.usageMetadata}),generationInfo:i}],llmOutput:{tokenUsage:{promptTokens:(l=e==null?void 0:e.usageMetadata)==null?void 0:l.input_tokens,completionTokens:(d=e==null?void 0:e.usageMetadata)==null?void 0:d.output_tokens,totalTokens:(h=e==null?void 0:e.usageMetadata)==null?void 0:h.total_tokens}}}}function are(n,e){if(!n.candidates||n.candidates.length===0)return null;const t=n.functionCalls(),[r]=n.candidates,{content:s,...i}=r;let a;s!=null&&s.parts&&s.parts.every(l=>"text"in l)?a=s.parts.map(l=>l.text).join(""):s.parts&&(a=s.parts.map(l=>"text"in l?{type:"text",text:l.text}:"executableCode"in l?{type:"executableCode",executableCode:l.executableCode}:"codeExecutionResult"in l?{type:"codeExecutionResult",codeExecutionResult:l.codeExecutionResult}:l));let o="";a&&typeof a=="string"?o=a:a&&typeof a=="object"&&"text"in a[0]&&(o=a[0].text);const u=[];return t&&u.push(...t.map(l=>({...l,args:JSON.stringify(l.args),index:e.index,type:"tool_call_chunk"}))),new ds({text:o,message:new wr({content:a||"",name:s?s.role:void 0,tool_call_chunks:u,additional_kwargs:{},usage_metadata:e.usageMetadata}),generationInfo:i})}function ore(n){return n.every(e=>"functionDeclarations"in e&&Array.isArray(e.functionDeclarations))?n:[{functionDeclarations:n.map(e=>{if(ih(e)){const t=q2(e.schema);return{name:e.name,description:e.description,parameters:t}}return Ym(e)?{name:e.function.name,description:e.function.description??"A function available to call.",parameters:ere(e.function.parameters)}:e})}]}class K2 extends EA{static lc_name(){return"GoogleGenerativeAIToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","google_genai","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new sh(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parseResult(e){const t=e.flatMap(i=>{const{message:a}=i;return!("tool_calls"in a)||!Array.isArray(a.tool_calls)?[]:a.tool_calls});if(t[0]===void 0)throw new Error("No parseable tool calls provided to GoogleGenerativeAIToolsOutputParser.");const[r]=t;return await this._validateResult(r.args)}}function W2(n,e){const t=cre(n),r=lre(t,e);return{tools:t,toolConfig:r}}function cre(n){let e=[];const t=[];return n.forEach(s=>{if(ih(s)){const[i]=ore([s]);i.functionDeclarations&&e.push(...i.functionDeclarations)}else if(Ym(s)){const{functionDeclarations:i}=ure(s);if(i)e.push(...i);else throw new Error("Failed to convert OpenAI structured tool to GenerativeAI tool")}else t.push(s)}),t.find(s=>"functionDeclarations"in s)?t.map(s=>{if((e==null?void 0:e.length)>0&&"functionDeclarations"in s){const i={functionDeclarations:[...s.functionDeclarations||[],...e]};return e=[],i}return s}):[...t,...e.length>0?[{functionDeclarations:e}]:[]]}function ure(n){return{functionDeclarations:[{name:n.function.name,description:n.function.description,parameters:yg(n.function.parameters)}]}}function lre(n,e){if(!n.length||!e)return;const{toolChoice:t,allowedFunctionNames:r}=e,s={any:dh.ANY,auto:dh.AUTO,none:dh.NONE};if(t&&["any","auto","none"].includes(t))return{functionCallingConfig:{mode:s[t]??"MODE_UNSPECIFIED",allowedFunctionNames:r}};if(typeof t=="string"||r)return{functionCallingConfig:{mode:dh.ANY,allowedFunctionNames:[...r??[],...t&&typeof t=="string"?[t]:[]]}}}class dre extends Fs{static lc_name(){return"ChatGoogleGenerativeAI"}get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}get lc_aliases(){return{apiKey:"google_api_key"}}get _isMultimodalModel(){return this.model.includes("vision")||this.model.startsWith("gemini-1.5")||this.model.startsWith("gemini-2")}constructor(e){var t,r;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","google_genai"]}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gemini-pro"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gemini-pro"}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxOutputTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"safetySettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"convertSystemMessageToHumanContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.modelName=((t=e==null?void 0:e.model)==null?void 0:t.replace(/^models\//,""))??((r=e==null?void 0:e.modelName)==null?void 0:r.replace(/^models\//,""))??this.model,this.model=this.modelName,this.maxOutputTokens=(e==null?void 0:e.maxOutputTokens)??this.maxOutputTokens,this.maxOutputTokens&&this.maxOutputTokens<0)throw new Error("`maxOutputTokens` must be a positive integer");if(this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.temperature&&(this.temperature<0||this.temperature>2))throw new Error("`temperature` must be in the range of [0.0,2.0]");if(this.topP=(e==null?void 0:e.topP)??this.topP,this.topP&&this.topP<0)throw new Error("`topP` must be a positive integer");if(this.topP&&this.topP>1)throw new Error("`topP` must be below 1.");if(this.topK=(e==null?void 0:e.topK)??this.topK,this.topK&&this.topK<0)throw new Error("`topK` must be a positive integer");if(this.stopSequences=(e==null?void 0:e.stopSequences)??this.stopSequences,this.apiKey=(e==null?void 0:e.apiKey)??sn("GOOGLE_API_KEY"),!this.apiKey)throw new Error("Please set an API key for Google GenerativeAI in the environment variable GOOGLE_API_KEY or in the `apiKey` field of the ChatGoogleGenerativeAI constructor");if(this.safetySettings=(e==null?void 0:e.safetySettings)??this.safetySettings,this.safetySettings&&this.safetySettings.length>0&&new Set(this.safetySettings.map(i=>i.category)).size!==this.safetySettings.length)throw new Error("The categories in `safetySettings` array must be unique");this.streaming=(e==null?void 0:e.streaming)??this.streaming,this.client=new U2(this.apiKey).getGenerativeModel({model:this.model,safetySettings:this.safetySettings,generationConfig:{candidateCount:1,stopSequences:this.stopSequences,maxOutputTokens:this.maxOutputTokens,temperature:this.temperature,topP:this.topP,topK:this.topK,...e!=null&&e.json?{responseMimeType:"application/json"}:{}}},{apiVersion:e==null?void 0:e.apiVersion,baseUrl:e==null?void 0:e.baseUrl}),this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage}useCachedContent(e,t,r){this.apiKey&&(this.client=new U2(this.apiKey).getGenerativeModelFromCachedContent(e,t,r))}get useSystemInstruction(){return typeof this.convertSystemMessageToHumanContent=="boolean"?!this.convertSystemMessageToHumanContent:this.computeUseSystemInstruction}get computeUseSystemInstruction(){return this.modelName==="gemini-1.0-pro-001"||this.modelName.startsWith("gemini-pro-vision")||this.modelName.startsWith("gemini-1.0-pro-vision")?!1:this.modelName!=="gemini-pro"}getLsParams(e){return{ls_provider:"google_genai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:this.client.generationConfig.temperature,ls_max_tokens:this.client.generationConfig.maxOutputTokens,ls_stop:e.stop}}_combineLLMOutput(){return[]}_llmType(){return"googlegenerativeai"}bindTools(e,t){var r;return this.bind({tools:(r=W2(e))==null?void 0:r.tools,...t})}invocationParams(e){var r;const t=(r=e==null?void 0:e.tools)!=null&&r.length?W2(e.tools,{toolChoice:e.tool_choice,allowedFunctionNames:e.allowedFunctionNames}):void 0;return{...t!=null&&t.tools?{tools:t.tools}:{},...t!=null&&t.toolConfig?{toolConfig:t.toolConfig}:{}}}async _generate(e,t,r){var d;const s=H2(e,this._isMultimodalModel,this.useSystemInstruction);let i=s;if(s[0].role==="system"){const[h]=s;this.client.systemInstruction=h,i=s.slice(1)}const a=this.invocationParams(t);if(this.streaming){const h={},f=this._streamResponseChunks(e,t,r),p={};for await(const g of f){const y=((d=g.generationInfo)==null?void 0:d.completion)??0;p[y]===void 0?p[y]=g:p[y]=p[y].concat(g)}return{generations:Object.entries(p).sort(([g],[y])=>parseInt(g,10)-parseInt(y,10)).map(([g,y])=>y),llmOutput:{estimatedTokenUsage:h}}}const o=await this.completionWithRetry({...a,contents:i});let u;if("usageMetadata"in o.response){const h=o.response.usageMetadata;u={input_tokens:h.promptTokenCount??0,output_tokens:h.candidatesTokenCount??0,total_tokens:h.totalTokenCount??0}}const l=ire(o.response,{usageMetadata:u});return await(r==null?void 0:r.handleLLMNewToken(l.generations[0].text??"")),l}async*_streamResponseChunks(e,t,r){const s=H2(e,this._isMultimodalModel,this.useSystemInstruction);let i=s;if(s[0].role==="system"){const[h]=s;this.client.systemInstruction=h,i=s.slice(1)}const o={...this.invocationParams(t),contents:i},u=await this.caller.callWithOptions({signal:t==null?void 0:t.signal},async()=>{const{stream:h}=await this.client.generateContentStream(o);return h});let l,d=0;for await(const h of u){if("usageMetadata"in h&&this.streamUsage!==!1&&t.streamUsage!==!1){const p=h.usageMetadata;if(!l)l={input_tokens:p.promptTokenCount??0,output_tokens:p.candidatesTokenCount??0,total_tokens:p.totalTokenCount??0};else{const m=(p.candidatesTokenCount??0)-l.output_tokens;l={input_tokens:0,output_tokens:m,total_tokens:m}}}const f=are(h,{usageMetadata:l,index:d});d+=1,f&&(yield f,await(r==null?void 0:r.handleLLMNewToken(f.text??"")))}}async completionWithRetry(e,t){return this.caller.callWithOptions({signal:t==null?void 0:t.signal},async()=>{var r;try{return await this.client.generateContent(e)}catch(s){throw(r=s.message)!=null&&r.includes("400 Bad Request")&&(s.status=400),s}})}withStructuredOutput(e,t){const r=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw;if(i==="jsonMode")throw new Error('ChatGoogleGenerativeAI only supports "functionCalling" as a method.');let o=s??"extract",u,l;if(Qm(r)){const m=q2(r);l=[{functionDeclarations:[{name:o,description:m.description??"A function available to call.",parameters:m}]}],u=new K2({returnSingle:!0,keyName:o,zodSchema:r})}else{let m;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(m=r,o=r.name):m={name:o,description:r.description??"",parameters:r},l=[{functionDeclarations:[m]}],u=new K2({returnSingle:!0,keyName:o})}const d=this.bind({tools:l,tool_choice:o});if(!a)return d.pipe(u).withConfig({runName:"ChatGoogleGenerativeAIStructuredOutput"});const h=Ns.assign({parsed:(m,g)=>u.invoke(m.raw,g)}),f=Ns.assign({parsed:()=>null}),p=h.withFallbacks({fallbacks:[f]});return hs.from([{raw:d},p]).withConfig({runName:"StructuredOutputRunnable"})}}const YA="RFC3986",QA={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},hre="RFC1738",fre=Array.isArray,Xi=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),eT=1024,pre=(n,e,t,r,s)=>{if(n.length===0)return n;let i=n;if(typeof n=="symbol"?i=Symbol.prototype.toString.call(n):typeof n!="string"&&(i=String(n)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=eT){const u=i.length>=eT?i.slice(o,o+eT):i,l=[];for(let d=0;d<u.length;++d){let h=u.charCodeAt(d);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||s===hre&&(h===40||h===41)){l[l.length]=u.charAt(d);continue}if(h<128){l[l.length]=Xi[h];continue}if(h<2048){l[l.length]=Xi[192|h>>6]+Xi[128|h&63];continue}if(h<55296||h>=57344){l[l.length]=Xi[224|h>>12]+Xi[128|h>>6&63]+Xi[128|h&63];continue}d+=1,h=65536+((h&1023)<<10|u.charCodeAt(d)&1023),l[l.length]=Xi[240|h>>18]+Xi[128|h>>12&63]+Xi[128|h>>6&63]+Xi[128|h&63]}a+=l.join("")}return a};function mre(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function z2(n,e){if(fre(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const gre=Object.prototype.hasOwnProperty,V2={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},Yi=Array.isArray,yre=Array.prototype.push,G2=function(n,e){yre.apply(n,Yi(e)?e:[e])},wre=Date.prototype.toISOString,xr={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:pre,encodeValuesOnly:!1,format:YA,formatter:QA[YA],indices:!1,serializeDate(n){return wre.call(n)},skipNulls:!1,strictNullHandling:!1};function vre(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const tT={};function Z2(n,e,t,r,s,i,a,o,u,l,d,h,f,p,m,g,y,w){let v=n,b=w,S=0,P=!1;for(;(b=b.get(tT))!==void 0&&!P;){const I=b.get(n);if(S+=1,typeof I<"u"){if(I===S)throw new RangeError("Cyclic object value");P=!0}typeof b.get(tT)>"u"&&(S=0)}if(typeof l=="function"?v=l(e,v):v instanceof Date?v=f==null?void 0:f(v):t==="comma"&&Yi(v)&&(v=z2(v,function(I){return I instanceof Date?f==null?void 0:f(I):I})),v===null){if(i)return u&&!g?u(e,xr.encoder,y,"key",p):e;v=""}if(vre(v)||mre(v)){if(u){const I=g?e:u(e,xr.encoder,y,"key",p);return[(m==null?void 0:m(I))+"="+(m==null?void 0:m(u(v,xr.encoder,y,"value",p)))]}return[(m==null?void 0:m(e))+"="+(m==null?void 0:m(String(v)))]}const k=[];if(typeof v>"u")return k;let C;if(t==="comma"&&Yi(v))g&&u&&(v=z2(v,u)),C=[{value:v.length>0?v.join(",")||null:void 0}];else if(Yi(l))C=l;else{const I=Object.keys(v);C=d?I.sort(d):I}const E=o?String(e).replace(/\./g,"%2E"):String(e),M=r&&Yi(v)&&v.length===1?E+"[]":E;if(s&&Yi(v)&&v.length===0)return M+"[]";for(let I=0;I<C.length;++I){const N=C[I],O=typeof N=="object"&&typeof N.value<"u"?N.value:v[N];if(a&&O===null)continue;const T=h&&o?N.replace(/\./g,"%2E"):N,L=Yi(v)?typeof t=="function"?t(M,T):M:M+(h?"."+T:"["+T+"]");w.set(n,S);const U=new WeakMap;U.set(tT,w),G2(k,Z2(O,L,t,r,s,i,a,o,t==="comma"&&g&&Yi(v)?null:u,l,d,h,f,p,m,g,y,U))}return k}function _re(n=xr){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||xr.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=YA;if(typeof n.format<"u"){if(!gre.call(QA,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=QA[t];let s=xr.filter;(typeof n.filter=="function"||Yi(n.filter))&&(s=n.filter);let i;if(n.arrayFormat&&n.arrayFormat in V2?i=n.arrayFormat:"indices"in n?i=n.indices?"indices":"repeat":i=xr.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:xr.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:xr.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:xr.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:xr.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?xr.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:xr.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:xr.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:xr.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:xr.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:xr.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:xr.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:xr.strictNullHandling}}function bre(n,e={}){let t=n;const r=_re(e);let s,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):Yi(r.filter)&&(i=r.filter,s=i);const a=[];if(typeof t!="object"||t===null)return"";const o=V2[r.arrayFormat],u=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);const l=new WeakMap;for(let f=0;f<s.length;++f){const p=s[f];r.skipNulls&&t[p]===null||G2(a,Z2(t[p],p,o,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}const d=a.join(r.delimiter);let h=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),d.length>0?h+d:""}const fh="4.82.0";let J2=!1,wg,X2,Y2,rT,Q2,eB,tB,rB,nB;function Sre(n,e={auto:!1}){if(J2)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(wg)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${wg}'\``);J2=e.auto,wg=n.kind,X2=n.fetch,Y2=n.FormData,rT=n.File,Q2=n.ReadableStream,eB=n.getMultipartRequestOptions,tB=n.getDefaultAgent,rB=n.fileFromPath,nB=n.isFsReadStream}class xre{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function Ere({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new xre(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}wg||Sre(Ere(),{auto:!0});class ot extends Error{}class Yr extends ot{constructor(e,t,r,s){super(`${Yr.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new iS({message:r,cause:aT(t)});const i=t==null?void 0:t.error;return e===400?new sB(e,i,r,s):e===401?new iB(e,i,r,s):e===403?new aB(e,i,r,s):e===404?new oB(e,i,r,s):e===409?new cB(e,i,r,s):e===422?new uB(e,i,r,s):e===429?new lB(e,i,r,s):e>=500?new dB(e,i,r,s):new Yr(e,i,r,s)}}class Ds extends Yr{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class iS extends Yr{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class aS extends iS{constructor({message:e}={}){super({message:e??"Request timed out."})}}class sB extends Yr{}class iB extends Yr{}class aB extends Yr{}class oB extends Yr{}class cB extends Yr{}class uB extends Yr{}class lB extends Yr{}class dB extends Yr{}class hB extends ot{constructor(){super("Could not parse response content as the length limit was reached")}}class fB extends ot{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Eu{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=Eu.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(Eu.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new ot(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new ot(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new ot("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}Eu.NEWLINE_CHARS=new Set([`
`,"\r"]),Eu.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function pB(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class Qi{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of kre(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(o&&o.error)throw new Yr(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(a.event=="error")throw new Yr(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Qi(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new Eu,o=pB(e);for await(const u of o)for(const l of a.decode(u))yield l;for(const u of a.flush())yield u}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Qi(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new Qi(()=>s(e),this.controller),new Qi(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new Q2({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*kre(n,e){if(!n.body)throw e.abort(),new ot("Attempted to iterate over a response with no body");const t=new Are,r=new Eu,s=pB(n.body);for await(const i of Cre(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*Cre(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=Pre(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function Pre(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}class Are{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=Tre(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function Tre(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}const mB=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",gB=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&oS(n),oS=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Ire=n=>gB(n)||mB(n)||nB(n);async function yB(n,e,t){var s;if(n=await n,gB(n))return n;if(mB(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=oS(i)?[await i.arrayBuffer()]:[i];return new rT(a,e,t)}const r=await Ore(n);if(e||(e=Mre(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new rT(r,e,t)}async function Ore(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(oS(n))e.push(await n.arrayBuffer());else if($re(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${Rre(n)}`);return e}function Rre(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function Mre(n){var e;return nT(n.name)||nT(n.filename)||((e=nT(n.path))==null?void 0:e.split(/[\\/]/).pop())}const nT=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},$re=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",wB=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",ph=async n=>{const e=await Nre(n.body);return eB(e,n)},Nre=async n=>{const e=new Y2;return await Promise.all(Object.entries(n||{}).map(([t,r])=>sT(e,t,r))),e},sT=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(Ire(t)){const r=await yB(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>sT(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>sT(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Fre=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Lre=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},cS;async function vB(n){const{response:e}=n;if(n.options.stream)return mh("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Qi.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return mh("response",e.status,e.url,e.headers,i),_B(i,e)}const s=await e.text();return mh("response",e.status,e.url,e.headers,s),s}function _B(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class uS extends Promise{constructor(e,t=vB){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new uS(this.responsePromise,async t=>_B(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class jre{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=iT("maxRetries",t),this.timeout=iT("timeout",r),this.httpAgent=s,this.fetch=i??X2}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Kre(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Gre()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&oS(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var g;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:wB(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,u=this.calculateContentLength(o),l=this.buildURL(s,i);"timeout"in e&&iT("timeout",e.timeout);const d=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??tB(l),f=d+1e3;typeof((g=h==null?void 0:h.options)==null?void 0:g.timeout)=="number"&&f>(h.options.timeout??0)&&(h.options.timeout=f),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const p=this.buildHeaders({options:e,headers:a,contentLength:u,retryCount:t});return{req:{method:r,...o&&{body:o},headers:p,...h&&{agent:h},signal:e.signal??null},url:l,timeout:d}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return PB(i,a),PB(i,t),wB(e.body)&&wg!=="node"&&delete i["content-type"],TB(a,"x-stainless-retry-count")===void 0&&TB(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return Yr.generate(e,t,r,s)}request(e,t=null){return new uS(this.makeRequest(e,t))}async makeRequest(e,t){var h,f;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),mh("request",a,r,i.headers),(h=r.signal)!=null&&h.aborted)throw new Ds;const u=new AbortController,l=await this.fetchWithTimeout(a,i,o,u).catch(aT);if(l instanceof Error){if((f=r.signal)!=null&&f.aborted)throw new Ds;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new aS:new iS({cause:l})}const d=Bre(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){const v=`retrying, ${t} attempts remaining`;return mh(`response (error; ${v})`,l.status,a,d),this.retryRequest(r,t,d)}const p=await l.text().catch(v=>aT(v).message),m=Wre(p),g=m?void 0:p;throw mh(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,d,g),this.makeStatusError(l.status,m,g,d)}return{response:l,options:r,controller:u}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new Dre(this,r,e)}buildURL(e,t){const r=Vre(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return kB(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new ot(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r),u={signal:s.signal,...a};return u.method&&(u.method=u.method.toUpperCase()),this.fetch.call(void 0,e,u).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await vg(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${fh}`}}class bB{constructor(e,t,r,s){cS.set(this,void 0),Fre(this,cS,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new ot("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await Lre(this,cS,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(cS=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Dre extends uS{constructor(e,t,r){super(t,async s=>new r(e,s.response,await vB(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const Bre=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),Ure={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Gn=n=>typeof n=="object"&&n!==null&&!kB(n)&&Object.keys(n).every(e=>CB(Ure,e)),qre=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fh,"X-Stainless-OS":xB(Deno.build.os),"X-Stainless-Arch":SB(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fh,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fh,"X-Stainless-OS":xB(process.platform),"X-Stainless-Arch":SB(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=Hre();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fh,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":fh,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Hre(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const SB=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",xB=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let EB;const Kre=()=>EB??(EB=qre()),Wre=n=>{try{return JSON.parse(n)}catch{return}},zre=/^[a-z][a-z0-9+.-]*:/i,Vre=n=>zre.test(n),vg=n=>new Promise(e=>setTimeout(e,n)),iT=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ot(`${n} must be an integer`);if(e<0)throw new ot(`${n} must be a positive integer`);return e},aT=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},lS=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function kB(n){if(!n)return!0;for(const e in n)return!1;return!0}function CB(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function PB(n,e){for(const t in e){if(!CB(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}const AB=new Set(["authorization","api-key"]);function mh(n,...e){var t;if(typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"){const r=e.map(s=>{if(!s)return s;if(s.headers){const a={...s,headers:{...s.headers}};for(const o in s.headers)AB.has(o.toLowerCase())&&(a.headers[o]="REDACTED");return a}let i=null;for(const a in s)AB.has(a.toLowerCase())&&(i??(i={...s}),i[a]="REDACTED");return i??s});console.log(`OpenAI:DEBUG:${n}`,...r)}}const Gre=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),Zre=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Jre=n=>typeof(n==null?void 0:n.get)=="function",TB=(n,e)=>{var r;const t=e.toLowerCase();if(Jre(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};function oT(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}class Xre extends bB{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class mi extends bB{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}}class Et{constructor(e){this._client=e}}let IB=class extends Et{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},cT=class extends Et{constructor(){super(...arguments),this.completions=new IB(this._client)}};cT.Completions=IB;class OB extends Et{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class RB extends Et{create(e,t){return this._client.post("/audio/transcriptions",ph({body:e,...t}))}}class MB extends Et{create(e,t){return this._client.post("/audio/translations",ph({body:e,...t}))}}class _g extends Et{constructor(){super(...arguments),this.transcriptions=new RB(this._client),this.translations=new MB(this._client),this.speech=new OB(this._client)}}_g.Transcriptions=RB,_g.Translations=MB,_g.Speech=OB;class uT extends Et{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Gn(e)?this.list({},e):this._client.getAPIList("/batches",lT,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class lT extends mi{}uT.BatchesPage=lT;class dT extends Et{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return Gn(e)?this.list({},e):this._client.getAPIList("/assistants",hT,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class hT extends mi{}dT.AssistantsPage=hT;function $B(n){return typeof n.parse=="function"}const gh=n=>(n==null?void 0:n.role)==="assistant",NB=n=>(n==null?void 0:n.role)==="function",FB=n=>(n==null?void 0:n.role)==="tool";var gi=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},tr=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},fT,dS,hS,bg,Sg,fS,xg,Ba,Eg,pS,mS,yh,LB;class jB{constructor(){fT.add(this),this.controller=new AbortController,dS.set(this,void 0),hS.set(this,()=>{}),bg.set(this,()=>{}),Sg.set(this,void 0),fS.set(this,()=>{}),xg.set(this,()=>{}),Ba.set(this,{}),Eg.set(this,!1),pS.set(this,!1),mS.set(this,!1),yh.set(this,!1),gi(this,dS,new Promise((e,t)=>{gi(this,hS,e,"f"),gi(this,bg,t,"f")}),"f"),gi(this,Sg,new Promise((e,t)=>{gi(this,fS,e,"f"),gi(this,xg,t,"f")}),"f"),tr(this,dS,"f").catch(()=>{}),tr(this,Sg,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},tr(this,fT,"m",LB).bind(this))},0)}_connected(){this.ended||(tr(this,hS,"f").call(this),this._emit("connect"))}get ended(){return tr(this,Eg,"f")}get errored(){return tr(this,pS,"f")}get aborted(){return tr(this,mS,"f")}abort(){this.controller.abort()}on(e,t){return(tr(this,Ba,"f")[e]||(tr(this,Ba,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=tr(this,Ba,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(tr(this,Ba,"f")[e]||(tr(this,Ba,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{gi(this,yh,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){gi(this,yh,!0,"f"),await tr(this,Sg,"f")}_emit(e,...t){if(tr(this,Eg,"f"))return;e==="end"&&(gi(this,Eg,!0,"f"),tr(this,fS,"f").call(this));const r=tr(this,Ba,"f")[e];if(r&&(tr(this,Ba,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!tr(this,yh,"f")&&!(r!=null&&r.length)&&Promise.reject(s),tr(this,bg,"f").call(this,s),tr(this,xg,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!tr(this,yh,"f")&&!(r!=null&&r.length)&&Promise.reject(s),tr(this,bg,"f").call(this,s),tr(this,xg,"f").call(this,s),this._emit("end")}}_emitFinal(){}}dS=new WeakMap,hS=new WeakMap,bg=new WeakMap,Sg=new WeakMap,fS=new WeakMap,xg=new WeakMap,Ba=new WeakMap,Eg=new WeakMap,pS=new WeakMap,mS=new WeakMap,yh=new WeakMap,fT=new WeakSet,LB=function(e){if(gi(this,pS,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Ds),e instanceof Ds)return gi(this,mS,!0,"f"),this._emit("abort",e);if(e instanceof ot)return this._emit("error",e);if(e instanceof Error){const t=new ot(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ot(String(e)))};function Yre(n,e){const t={...n};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function DB(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function Qre(n,{parser:e,callback:t}){const r={...n};return Object.defineProperties(r,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),r}function kg(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function ene(n,e){return!e||!BB(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:pT(n,e)}function pT(n,e){const t=n.choices.map(r=>{var s;if(r.finish_reason==="length")throw new hB;if(r.finish_reason==="content_filter")throw new fB;return{...r,message:{...r.message,tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(i=>rne(e,i)))??[],parsed:r.message.content&&!r.message.refusal?tne(e,r.message.content):null}}});return{...n,choices:t}}function tne(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function rne(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:kg(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function nne(n,e){var r;if(!n)return!1;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return kg(t)||(t==null?void 0:t.function.strict)||!1}function BB(n){var e;return DB(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>kg(t)||t.type==="function"&&t.function.strict===!0))??!1}function sne(n){for(const e of n??[]){if(e.type!=="function")throw new ot(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new ot(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Zn=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},un,mT,gS,gT,yT,wT,UB,vT;const qB=10;class HB extends jB{constructor(){super(...arguments),un.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(NB(e)||FB(e))&&e.content)this._emit("functionCallResult",e.content);else if(gh(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(gh(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new ot("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Zn(this,un,"m",mT).call(this)}async finalMessage(){return await this.done(),Zn(this,un,"m",gS).call(this)}async finalFunctionCall(){return await this.done(),Zn(this,un,"m",gT).call(this)}async finalFunctionCallResult(){return await this.done(),Zn(this,un,"m",yT).call(this)}async totalUsage(){return await this.done(),Zn(this,un,"m",wT).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Zn(this,un,"m",gS).call(this);t&&this._emit("finalMessage",t);const r=Zn(this,un,"m",mT).call(this);r&&this._emit("finalContent",r);const s=Zn(this,un,"m",gT).call(this);s&&this._emit("finalFunctionCall",s);const i=Zn(this,un,"m",yT).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",Zn(this,un,"m",wT).call(this))}async _createChatCompletion(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Zn(this,un,"m",UB).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(pT(i,t))}async _runChatCompletion(e,t,r){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var f;const s="function",{function_call:i="auto",stream:a,...o}=t,u=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:l=qB}=r||{},d={};for(const p of t.functions)d[p.name||p.function.name]=p;const h=t.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(const p of t.messages)this._addMessage(p,!1);for(let p=0;p<l;++p){const g=(f=(await this._createChatCompletion(e,{...o,function_call:i,functions:h,messages:[...this.messages]},r)).choices[0])==null?void 0:f.message;if(!g)throw new ot("missing message in ChatCompletion response");if(!g.function_call)return;const{name:y,arguments:w}=g.function_call,v=d[y];if(v){if(u&&u!==y){const k=`Invalid function_call: ${JSON.stringify(y)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,name:y,content:k});continue}}else{const k=`Invalid function_call: ${JSON.stringify(y)}. Available options are: ${h.map(C=>JSON.stringify(C.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:y,content:k});continue}let b;try{b=$B(v)?await v.parse(w):w}catch(k){this._addMessage({role:s,name:y,content:k instanceof Error?k.message:String(k)});continue}const S=await v.function(b,this),P=Zn(this,un,"m",vT).call(this,S);if(this._addMessage({role:s,name:y,content:P}),u)return}}async _runTools(e,t,r){var p,m,g;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,u=typeof i!="string"&&((p=i==null?void 0:i.function)==null?void 0:p.name),{maxChatCompletions:l=qB}=r||{},d=t.tools.map(y=>{if(kg(y)){if(!y.$callback)throw new ot("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:y.$callback,name:y.function.name,description:y.function.description||"",parameters:y.function.parameters,parse:y.$parseRaw,strict:!0}}}return y}),h={};for(const y of d)y.type==="function"&&(h[y.function.name||y.function.function.name]=y.function);const f="tools"in t?d.map(y=>y.type==="function"?{type:"function",function:{name:y.function.name||y.function.function.name,parameters:y.function.parameters,description:y.function.description,strict:y.function.strict}}:y):void 0;for(const y of t.messages)this._addMessage(y,!1);for(let y=0;y<l;++y){const v=(m=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:f,messages:[...this.messages]},r)).choices[0])==null?void 0:m.message;if(!v)throw new ot("missing message in ChatCompletion response");if(!((g=v.tool_calls)!=null&&g.length))return;for(const b of v.tool_calls){if(b.type!=="function")continue;const S=b.id,{name:P,arguments:k}=b.function,C=h[P];if(C){if(u&&u!==P){const N=`Invalid tool_call: ${JSON.stringify(P)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,tool_call_id:S,content:N});continue}}else{const N=`Invalid tool_call: ${JSON.stringify(P)}. Available options are: ${Object.keys(h).map(O=>JSON.stringify(O)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:S,content:N});continue}let E;try{E=$B(C)?await C.parse(k):k}catch(N){const O=N instanceof Error?N.message:String(N);this._addMessage({role:s,tool_call_id:S,content:O});continue}const M=await C.function(E,this),I=Zn(this,un,"m",vT).call(this,M);if(this._addMessage({role:s,tool_call_id:S,content:I}),u)return}}}}un=new WeakSet,mT=function(){return Zn(this,un,"m",gS).call(this).content??null},gS=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(gh(t)){const{function_call:r,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return r&&(i.function_call=r),i}}throw new ot("stream ended without producing a ChatCompletionMessage with role=assistant")},gT=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(gh(s)&&(s!=null&&s.function_call))return s.function_call;if(gh(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},yT=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(NB(t)&&t.content!=null||FB(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},wT=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},UB=function(e){if(e.n!=null&&e.n>1)throw new ot("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},vT=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Cg extends HB{static runFunctions(e,t,r){const s=new Cg,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new Cg,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),gh(e)&&e.content&&this._emit("content",e.content)}}const KB=1,WB=2,zB=4,VB=8,GB=16,ZB=32,JB=64,XB=128,YB=256,QB=XB|YB,e3=GB|ZB|QB|JB,t3=KB|WB|e3,r3=zB|VB,ine=t3|r3,Dr={STR:KB,NUM:WB,ARR:zB,OBJ:VB,NULL:GB,BOOL:ZB,NAN:JB,INFINITY:XB,MINUS_INFINITY:YB,INF:QB,SPECIAL:e3,ATOM:t3,COLLECTION:r3,ALL:ine};class ane extends Error{}class one extends Error{}function cne(n,e=Dr.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return une(n.trim(),e)}const une=(n,e)=>{const t=n.length;let r=0;const s=f=>{throw new ane(`${f} at position ${r}`)},i=f=>{throw new one(`${f} at position ${r}`)},a=()=>(h(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?u():n[r]==="["?l():n.substring(r,r+4)==="null"||Dr.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||Dr.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||Dr.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||Dr.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||Dr.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||Dr.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):d()),o=()=>{const f=r;let p=!1;for(r++;r<t&&(n[r]!=='"'||p&&n[r-1]==="\\");)p=n[r]==="\\"?!p:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(f,++r-Number(p)))}catch(m){i(String(m))}else if(Dr.STR&e)try{return JSON.parse(n.substring(f,r-Number(p))+'"')}catch{return JSON.parse(n.substring(f,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},u=()=>{r++,h();const f={};try{for(;n[r]!=="}";){if(h(),r>=t&&Dr.OBJ&e)return f;const p=o();h(),r++;try{const m=a();Object.defineProperty(f,p,{value:m,writable:!0,enumerable:!0,configurable:!0})}catch(m){if(Dr.OBJ&e)return f;throw m}h(),n[r]===","&&r++}}catch{if(Dr.OBJ&e)return f;s("Expected '}' at end of object")}return r++,f},l=()=>{r++;const f=[];try{for(;n[r]!=="]";)f.push(a()),h(),n[r]===","&&r++}catch{if(Dr.ARR&e)return f;s("Expected ']' at end of array")}return r++,f},d=()=>{if(r===0){n==="-"&&Dr.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(p){if(Dr.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}i(String(p))}}const f=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(Dr.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(f,r))}catch{n.substring(f,r)==="-"&&Dr.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(f,n.lastIndexOf("e")))}catch(m){i(String(m))}}},h=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return a()},n3=n=>cne(n,Dr.ALL^Dr.NUM);var wh=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Lt=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Er,Ua,vh,Xo,_T,yS,bT,ST,xT,wS,ET,s3;class Pg extends HB{constructor(e){super(),Er.add(this),Ua.set(this,void 0),vh.set(this,void 0),Xo.set(this,void 0),wh(this,Ua,e,"f"),wh(this,vh,[],"f")}get currentChatCompletionSnapshot(){return Lt(this,Xo,"f")}static fromReadableStream(e){const t=new Pg(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const s=new Pg(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var a;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Lt(this,Er,"m",_T).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)Lt(this,Er,"m",bT).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new Ds;return this._addChatCompletion(Lt(this,Er,"m",wS).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Lt(this,Er,"m",_T).call(this),this._connected();const s=Qi.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(Lt(this,Er,"m",wS).call(this)),Lt(this,Er,"m",bT).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new Ds;return this._addChatCompletion(Lt(this,Er,"m",wS).call(this))}[(Ua=new WeakMap,vh=new WeakMap,Xo=new WeakMap,Er=new WeakSet,_T=function(){this.ended||wh(this,Xo,void 0,"f")},yS=function(t){let r=Lt(this,vh,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Lt(this,vh,"f")[t.index]=r,r)},bT=function(t){var s,i,a,o,u,l,d,h,f,p,m,g,y,w,v;if(this.ended)return;const r=Lt(this,Er,"m",s3).call(this,t);this._emit("chunk",t,r);for(const b of t.choices){const S=r.choices[b.index];b.delta.content!=null&&((s=S.message)==null?void 0:s.role)==="assistant"&&((i=S.message)!=null&&i.content)&&(this._emit("content",b.delta.content,S.message.content),this._emit("content.delta",{delta:b.delta.content,snapshot:S.message.content,parsed:S.message.parsed})),b.delta.refusal!=null&&((a=S.message)==null?void 0:a.role)==="assistant"&&((o=S.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:b.delta.refusal,snapshot:S.message.refusal}),((u=b.logprobs)==null?void 0:u.content)!=null&&((l=S.message)==null?void 0:l.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(d=b.logprobs)==null?void 0:d.content,snapshot:((h=S.logprobs)==null?void 0:h.content)??[]}),((f=b.logprobs)==null?void 0:f.refusal)!=null&&((p=S.message)==null?void 0:p.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(m=b.logprobs)==null?void 0:m.refusal,snapshot:((g=S.logprobs)==null?void 0:g.refusal)??[]});const P=Lt(this,Er,"m",yS).call(this,S);S.finish_reason&&(Lt(this,Er,"m",xT).call(this,S),P.current_tool_call_index!=null&&Lt(this,Er,"m",ST).call(this,S,P.current_tool_call_index));for(const k of b.delta.tool_calls??[])P.current_tool_call_index!==k.index&&(Lt(this,Er,"m",xT).call(this,S),P.current_tool_call_index!=null&&Lt(this,Er,"m",ST).call(this,S,P.current_tool_call_index)),P.current_tool_call_index=k.index;for(const k of b.delta.tool_calls??[]){const C=(y=S.message.tool_calls)==null?void 0:y[k.index];C!=null&&C.type&&((C==null?void 0:C.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(w=C.function)==null?void 0:w.name,index:k.index,arguments:C.function.arguments,parsed_arguments:C.function.parsed_arguments,arguments_delta:((v=k.function)==null?void 0:v.arguments)??""}):(C==null||C.type,void 0))}}},ST=function(t,r){var a,o,u;if(Lt(this,Er,"m",yS).call(this,t).done_tool_calls.has(r))return;const i=(a=t.message.tool_calls)==null?void 0:a[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const l=(u=(o=Lt(this,Ua,"f"))==null?void 0:o.tools)==null?void 0:u.find(d=>d.type==="function"&&d.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:kg(l)?l.$parseRaw(i.function.arguments):l!=null&&l.function.strict?JSON.parse(i.function.arguments):null})}else i.type},xT=function(t){var s,i;const r=Lt(this,Er,"m",yS).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const a=Lt(this,Er,"m",ET).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},wS=function(){if(this.ended)throw new ot("stream has ended, this shouldn't happen");const t=Lt(this,Xo,"f");if(!t)throw new ot("request ended without sending any chunks");return wh(this,Xo,void 0,"f"),wh(this,vh,[],"f"),lne(t,Lt(this,Ua,"f"))},ET=function(){var r;const t=(r=Lt(this,Ua,"f"))==null?void 0:r.response_format;return DB(t)?t:null},s3=function(t){var r,s,i,a;let o=Lt(this,Xo,"f");const{choices:u,...l}=t;o?Object.assign(o,l):o=wh(this,Xo,{...l,choices:[]},"f");for(const{delta:d,finish_reason:h,index:f,logprobs:p=null,...m}of t.choices){let g=o.choices[f];if(g||(g=o.choices[f]={finish_reason:h,index:f,message:{},logprobs:p,...m}),p)if(!g.logprobs)g.logprobs=Object.assign({},p);else{const{content:k,refusal:C,...E}=p;Object.assign(g.logprobs,E),k&&((r=g.logprobs).content??(r.content=[]),g.logprobs.content.push(...k)),C&&((s=g.logprobs).refusal??(s.refusal=[]),g.logprobs.refusal.push(...C))}if(h&&(g.finish_reason=h,Lt(this,Ua,"f")&&BB(Lt(this,Ua,"f")))){if(h==="length")throw new hB;if(h==="content_filter")throw new fB}if(Object.assign(g,m),!d)continue;const{content:y,refusal:w,function_call:v,role:b,tool_calls:S,...P}=d;if(Object.assign(g.message,P),w&&(g.message.refusal=(g.message.refusal||"")+w),b&&(g.message.role=b),v&&(g.message.function_call?(v.name&&(g.message.function_call.name=v.name),v.arguments&&((i=g.message.function_call).arguments??(i.arguments=""),g.message.function_call.arguments+=v.arguments)):g.message.function_call=v),y&&(g.message.content=(g.message.content||"")+y,!g.message.refusal&&Lt(this,Er,"m",ET).call(this)&&(g.message.parsed=n3(g.message.content))),S){g.message.tool_calls||(g.message.tool_calls=[]);for(const{index:k,id:C,type:E,function:M,...I}of S){const N=(a=g.message.tool_calls)[k]??(a[k]={});Object.assign(N,I),C&&(N.id=C),E&&(N.type=E),M&&(N.function??(N.function={name:M.name??"",arguments:""})),M!=null&&M.name&&(N.function.name=M.name),M!=null&&M.arguments&&(N.function.arguments+=M.arguments,nne(Lt(this,Ua,"f"),N)&&(N.function.parsed_arguments=n3(N.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Qi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function lne(n,e){const{id:t,choices:r,created:s,model:i,system_fingerprint:a,...o}=n,u={...o,id:t,choices:r.map(({message:l,finish_reason:d,index:h,logprobs:f,...p})=>{if(!d)throw new ot(`missing finish_reason for choice ${h}`);const{content:m=null,function_call:g,tool_calls:y,...w}=l,v=l.role;if(!v)throw new ot(`missing role for choice ${h}`);if(g){const{arguments:b,name:S}=g;if(b==null)throw new ot(`missing function_call.arguments for choice ${h}`);if(!S)throw new ot(`missing function_call.name for choice ${h}`);return{...p,message:{content:m,function_call:{arguments:b,name:S},role:v,refusal:l.refusal??null},finish_reason:d,index:h,logprobs:f}}return y?{...p,index:h,finish_reason:d,logprobs:f,message:{...w,role:v,content:m,refusal:l.refusal??null,tool_calls:y.map((b,S)=>{const{function:P,type:k,id:C,...E}=b,{arguments:M,name:I,...N}=P||{};if(C==null)throw new ot(`missing choices[${h}].tool_calls[${S}].id
${vS(n)}`);if(k==null)throw new ot(`missing choices[${h}].tool_calls[${S}].type
${vS(n)}`);if(I==null)throw new ot(`missing choices[${h}].tool_calls[${S}].function.name
${vS(n)}`);if(M==null)throw new ot(`missing choices[${h}].tool_calls[${S}].function.arguments
${vS(n)}`);return{...E,id:C,type:k,function:{...N,name:I,arguments:M}}})}}:{...p,message:{...w,content:m,role:v,refusal:l.refusal??null},finish_reason:d,index:h,logprobs:f}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return ene(u,e)}function vS(n){return JSON.stringify(n)}function Ile(n){}class _h extends Pg{static fromReadableStream(e){const t=new _h(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const s=new _h(null),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new _h(t),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let i3=class extends Et{parse(e,t){return sne(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>pT(r,e))}runFunctions(e,t){return e.stream?_h.runFunctions(this._client,e,t):Cg.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?_h.runTools(this._client,e,t):Cg.runTools(this._client,e,t)}stream(e,t){return Pg.createChatCompletion(this._client,e,t)}};class kT extends Et{constructor(){super(...arguments),this.completions=new i3(this._client)}}(function(n){n.Completions=i3})(kT||(kT={}));class a3 extends Et{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class CT extends Et{constructor(){super(...arguments),this.sessions=new a3(this._client)}}CT.Sessions=a3;var Fe=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},gs=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Qr,PT,ea,_S,yi,ku,bh,Cu,bS,ys,SS,xS,Ag,Tg,Ig,o3,c3,u3,l3,d3,h3,f3;class wi extends jB{constructor(){super(...arguments),Qr.add(this),PT.set(this,[]),ea.set(this,{}),_S.set(this,{}),yi.set(this,void 0),ku.set(this,void 0),bh.set(this,void 0),Cu.set(this,void 0),bS.set(this,void 0),ys.set(this,void 0),SS.set(this,void 0),xS.set(this,void 0),Ag.set(this,void 0)}[(PT=new WeakMap,ea=new WeakMap,_S=new WeakMap,yi=new WeakMap,ku=new WeakMap,bh=new WeakMap,Cu=new WeakMap,bS=new WeakMap,ys=new WeakMap,SS=new WeakMap,xS=new WeakMap,Ag=new WeakMap,Qr=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new wi;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=Qi.fromReadableStream(e,this.controller);for await(const a of s)Fe(this,Qr,"m",Tg).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new Ds;return this._addRun(Fe(this,Qr,"m",Ig).call(this))}toReadableStream(){return new Qi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,i){const a=new wi;return a._run(()=>a._runToolAssistantStream(e,t,r,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,s,i){var l;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},u=await e.submitToolOutputs(t,r,o,{...i,signal:this.controller.signal});this._connected();for await(const d of u)Fe(this,Qr,"m",Tg).call(this,d);if((l=u.controller.signal)!=null&&l.aborted)throw new Ds;return this._addRun(Fe(this,Qr,"m",Ig).call(this))}static createThreadAssistantStream(e,t,r){const s=new wi;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){const i=new wi;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return Fe(this,SS,"f")}currentRun(){return Fe(this,xS,"f")}currentMessageSnapshot(){return Fe(this,yi,"f")}currentRunStepSnapshot(){return Fe(this,Ag,"f")}async finalRunSteps(){return await this.done(),Object.values(Fe(this,ea,"f"))}async finalMessages(){return await this.done(),Object.values(Fe(this,_S,"f"))}async finalRun(){if(await this.done(),!Fe(this,ku,"f"))throw Error("Final run was not received.");return Fe(this,ku,"f")}async _createThreadAssistantStream(e,t,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const u of a)Fe(this,Qr,"m",Tg).call(this,u);if((o=a.controller.signal)!=null&&o.aborted)throw new Ds;return this._addRun(Fe(this,Qr,"m",Ig).call(this))}async _createAssistantStream(e,t,r,s){var u;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const l of o)Fe(this,Qr,"m",Tg).call(this,l);if((u=o.controller.signal)!=null&&u.aborted)throw new Ds;return this._addRun(Fe(this,Qr,"m",Ig).call(this))}static accumulateDelta(e,t){for(const[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(oT(i)&&oT(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(const a of s){if(!oT(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const u=i[o];u==null?i.push(a):i[o]=this.accumulateDelta(u,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,i){return await this._createToolAssistantStream(r,e,t,s,i)}}Tg=function(e){if(!this.ended)switch(gs(this,SS,e,"f"),Fe(this,Qr,"m",u3).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":Fe(this,Qr,"m",f3).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Fe(this,Qr,"m",c3).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":Fe(this,Qr,"m",o3).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Ig=function(){if(this.ended)throw new ot("stream has ended, this shouldn't happen");if(!Fe(this,ku,"f"))throw Error("Final run has not been received");return Fe(this,ku,"f")},o3=function(e){const[t,r]=Fe(this,Qr,"m",d3).call(this,e,Fe(this,yi,"f"));gs(this,yi,t,"f"),Fe(this,_S,"f")[t.id]=t;for(const s of r){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=Fe(this,bh,"f")){if(Fe(this,Cu,"f"))switch(Fe(this,Cu,"f").type){case"text":this._emit("textDone",Fe(this,Cu,"f").text,Fe(this,yi,"f"));break;case"image_file":this._emit("imageFileDone",Fe(this,Cu,"f").image_file,Fe(this,yi,"f"));break}gs(this,bh,s.index,"f")}gs(this,Cu,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(Fe(this,bh,"f")!==void 0){const s=e.data.content[Fe(this,bh,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,Fe(this,yi,"f"));break;case"text":this._emit("textDone",s.text,Fe(this,yi,"f"));break}}Fe(this,yi,"f")&&this._emit("messageDone",e.data),gs(this,yi,void 0,"f")}},c3=function(e){const t=Fe(this,Qr,"m",l3).call(this,e);switch(gs(this,Ag,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==Fe(this,bS,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(Fe(this,ys,"f")&&this._emit("toolCallDone",Fe(this,ys,"f")),gs(this,bS,i.index,"f"),gs(this,ys,t.step_details.tool_calls[i.index],"f"),Fe(this,ys,"f")&&this._emit("toolCallCreated",Fe(this,ys,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":gs(this,Ag,void 0,"f"),e.data.step_details.type=="tool_calls"&&Fe(this,ys,"f")&&(this._emit("toolCallDone",Fe(this,ys,"f")),gs(this,ys,void 0,"f")),this._emit("runStepDone",e.data,t);break}},u3=function(e){Fe(this,PT,"f").push(e),this._emit("event",e)},l3=function(e){switch(e.event){case"thread.run.step.created":return Fe(this,ea,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=Fe(this,ea,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=wi.accumulateDelta(t,r.delta);Fe(this,ea,"f")[e.data.id]=s}return Fe(this,ea,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":Fe(this,ea,"f")[e.data.id]=e.data;break}if(Fe(this,ea,"f")[e.data.id])return Fe(this,ea,"f")[e.data.id];throw new Error("No snapshot available")},d3=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=Fe(this,Qr,"m",h3).call(this,i,a)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},h3=function(e,t){return wi.accumulateDelta(t,e)},f3=function(e){switch(gs(this,xS,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":gs(this,ku,e.data,"f"),Fe(this,ys,"f")&&(this._emit("toolCallDone",Fe(this,ys,"f")),gs(this,ys,void 0,"f"));break}};class AT extends Et{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return Gn(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,TT,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class TT extends mi{}AT.MessagesPage=TT;class IT extends Et{retrieve(e,t,r,s={},i){return Gn(s)?this.retrieve(e,t,r,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,r={},s){return Gn(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,OT,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class OT extends mi{}IT.RunStepsPage=OT;class Og extends Et{constructor(){super(...arguments),this.steps=new IT(this._client)}create(e,t,r){const{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return Gn(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,RT,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return wi.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=a.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await vg(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return wi.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){const i=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,r,s){return wi.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}}class RT extends mi{}Og.RunsPage=RT,Og.Steps=IT,Og.RunStepsPage=OT;class Sh extends Et{constructor(){super(...arguments),this.runs=new Og(this._client),this.messages=new AT(this._client)}create(e={},t){return Gn(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return wi.createThreadAssistantStream(e,this._client.beta.threads,t)}}Sh.Runs=Og,Sh.RunsPage=RT,Sh.Messages=AT,Sh.MessagesPage=TT;const dne=async n=>{const e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};let MT=class extends Et{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return Gn(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,ES,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...r,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=i.response.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await vg(o);break;case"failed":case"completed":return a}}}async upload(e,t,r){const s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){const s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}};class ES extends mi{}MT.VectorStoreFilesPage=ES;class p3 extends Et{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return Gn(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,ES,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=a.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await vg(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,u=t.values(),l=[...r];async function d(f){for(let p of f){const m=await o.files.create({file:p,purpose:"assistants"},s);l.push(m.id)}}const h=Array(a).fill(u).map(d);return await dne(h),await this.createAndPoll(e,{file_ids:l})}}class xh extends Et{constructor(){super(...arguments),this.files=new MT(this._client),this.fileBatches=new p3(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return Gn(e)?this.list({},e):this._client.getAPIList("/vector_stores",$T,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class $T extends mi{}xh.VectorStoresPage=$T,xh.Files=MT,xh.VectorStoreFilesPage=ES,xh.FileBatches=p3;class Yo extends Et{constructor(){super(...arguments),this.realtime=new CT(this._client),this.vectorStores=new xh(this._client),this.chat=new kT(this._client),this.assistants=new dT(this._client),this.threads=new Sh(this._client)}}Yo.Realtime=CT,Yo.VectorStores=xh,Yo.VectorStoresPage=$T,Yo.Assistants=dT,Yo.AssistantsPage=hT,Yo.Threads=Sh;class m3 extends Et{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class g3 extends Et{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class NT extends Et{create(e,t){return this._client.post("/files",ph({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Gn(e)?this.list({},e):this._client.getAPIList("/files",FT,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await vg(t),a=await this.retrieve(e),Date.now()-i>r)throw new aS({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class FT extends mi{}NT.FileObjectsPage=FT;class LT extends Et{list(e,t={},r){return Gn(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,jT,{query:t,...r})}}class jT extends mi{}LT.FineTuningJobCheckpointsPage=jT;class Eh extends Et{constructor(){super(...arguments),this.checkpoints=new LT(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Gn(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",DT,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return Gn(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,BT,{query:t,...r})}}class DT extends mi{}class BT extends mi{}Eh.FineTuningJobsPage=DT,Eh.FineTuningJobEventsPage=BT,Eh.Checkpoints=LT,Eh.FineTuningJobCheckpointsPage=jT;class Rg extends Et{constructor(){super(...arguments),this.jobs=new Eh(this._client)}}Rg.Jobs=Eh,Rg.FineTuningJobsPage=DT,Rg.FineTuningJobEventsPage=BT;class y3 extends Et{createVariation(e,t){return this._client.post("/images/variations",ph({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",ph({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class UT extends Et{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",qT,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class qT extends Xre{}UT.ModelsPage=qT;class w3 extends Et{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class v3 extends Et{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,ph({body:t,...r}))}}class HT extends Et{constructor(){super(...arguments),this.parts=new v3(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}HT.Parts=v3;var _3;let ht=class extends jre{constructor({baseURL:e=lS("OPENAI_BASE_URL"),apiKey:t=lS("OPENAI_API_KEY"),organization:r=lS("OPENAI_ORG_ID")??null,project:s=lS("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new ot("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:r,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&Zre())throw new ot(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new m3(this),this.chat=new cT(this),this.embeddings=new g3(this),this.files=new NT(this),this.images=new y3(this),this.audio=new _g(this),this.moderations=new w3(this),this.models=new UT(this),this.fineTuning=new Rg(this),this.beta=new Yo(this),this.batches=new uT(this),this.uploads=new HT(this),this._options=a,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return bre(e,{arrayFormat:"brackets"})}};_3=ht,ht.OpenAI=_3,ht.DEFAULT_TIMEOUT=6e5,ht.OpenAIError=ot,ht.APIError=Yr,ht.APIConnectionError=iS,ht.APIConnectionTimeoutError=aS,ht.APIUserAbortError=Ds,ht.NotFoundError=oB,ht.ConflictError=cB,ht.RateLimitError=lB,ht.BadRequestError=sB,ht.AuthenticationError=iB,ht.InternalServerError=dB,ht.PermissionDeniedError=aB,ht.UnprocessableEntityError=uB,ht.toFile=yB,ht.fileFromPath=rB,ht.Completions=m3,ht.Chat=cT,ht.Embeddings=g3,ht.Files=NT,ht.FileObjectsPage=FT,ht.Images=y3,ht.Audio=_g,ht.Moderations=w3,ht.Models=UT,ht.ModelsPage=qT,ht.FineTuning=Rg,ht.Beta=Yo,ht.Batches=uT,ht.BatchesPage=lT,ht.Uploads=HT;const hne=Symbol("Let zodToJsonSchema decide on which parser to use"),fne={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},pne=n=>({...fne,...n}),mne=n=>{const e=pne(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function b3(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function Mt(n,e,t,r,s){n[e]=t,b3(n,e,r,s)}var yt;(function(n){n.assertEqual=s=>s;function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},n.getValidEnumValues=s=>{const i=n.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(const o of i)a[o]=s[o];return n.objectValues(a)},n.objectValues=s=>n.objectKeys(s).map(function(i){return s[i]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},n.find=(s,i)=>{for(const a of s)if(i(a))return a},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(yt||(yt={}));var S3;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(S3||(S3={}));const be=yt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Qo=n=>{switch(typeof n){case"undefined":return be.undefined;case"string":return be.string;case"number":return isNaN(n)?be.nan:be.number;case"boolean":return be.boolean;case"function":return be.function;case"bigint":return be.bigint;case"symbol":return be.symbol;case"object":return Array.isArray(n)?be.array:n===null?be.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?be.promise:typeof Map<"u"&&n instanceof Map?be.map:typeof Set<"u"&&n instanceof Set?be.set:typeof Date<"u"&&n instanceof Date?be.date:be.object;default:return be.unknown}},oe=yt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Bs extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)r._errors.push(t(a));else{let o=r,u=0;for(;u<a.path.length;){const l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return s(this),r}static assert(e){if(!(e instanceof Bs))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,yt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Bs.create=n=>new Bs(n);const Mg=(n,e)=>{let t;switch(n.code){case oe.invalid_type:n.received===be.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case oe.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,yt.jsonStringifyReplacer)}`;break;case oe.unrecognized_keys:t=`Unrecognized key(s) in object: ${yt.joinValues(n.keys,", ")}`;break;case oe.invalid_union:t="Invalid input";break;case oe.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${yt.joinValues(n.options)}`;break;case oe.invalid_enum_value:t=`Invalid enum value. Expected ${yt.joinValues(n.options)}, received '${n.received}'`;break;case oe.invalid_arguments:t="Invalid function arguments";break;case oe.invalid_return_type:t="Invalid function return type";break;case oe.invalid_date:t="Invalid date";break;case oe.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:yt.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case oe.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case oe.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case oe.custom:t="Invalid input";break;case oe.invalid_intersection_types:t="Intersection results could not be merged";break;case oe.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case oe.not_finite:t="Number must be finite";break;default:t=e.defaultError,yt.assertNever(n)}return{message:t}};let gne=Mg;function KT(){return gne}const WT=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,i=[...t,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="";const u=r.filter(l=>!!l).slice().reverse();for(const l of u)o=l(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}};function ye(n,e){const t=KT(),r=WT({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===Mg?void 0:Mg].filter(s=>!!s)});n.common.issues.push(r)}class Pn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return qe;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t){const i=await s.key,a=await s.value;r.push({key:i,value:a})}return Pn.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return qe;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(r[i.value]=a.value)}return{status:e.value,value:r}}}const qe=Object.freeze({status:"aborted"}),$g=n=>({status:"dirty",value:n}),Jn=n=>({status:"valid",value:n}),x3=n=>n.status==="aborted",E3=n=>n.status==="dirty",kh=n=>n.status==="valid",kS=n=>typeof Promise<"u"&&n instanceof Promise;function CS(n,e,t,r){if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function k3(n,e,t,r,s){if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}typeof SuppressedError=="function"&&SuppressedError;var Oe;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(Oe||(Oe={}));var Ng,Fg;class ta{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const C3=(n,e)=>{if(kh(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Bs(n.common.issues);return this._error=t,this._error}}};function ze(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{var u,l;const{message:d}=n;return a.code==="invalid_enum_value"?{message:d??o.defaultError}:typeof o.data>"u"?{message:(u=d??r)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=d??t)!==null&&l!==void 0?l:o.defaultError}},description:s}}class rt{get description(){return this._def.description}_getType(e){return Qo(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Qo(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Pn,ctx:{common:e.parent.common,data:e.data,parsedType:Qo(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(kS(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qo(e)},i=this._parseSync({data:e,path:s.path,parent:s});return C3(s,i)}"~validate"(e){var t,r;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qo(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:s});return kh(i)?{value:i.value}:{issues:s.common.issues}}catch(i){!((r=(t=i==null?void 0:i.message)===null||t===void 0?void 0:t.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(i=>kh(i)?{value:i.value}:{issues:s.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Qo(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(kS(s)?s:Promise.resolve(s));return C3(r,i)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const a=e(s),o=()=>i.addIssue({code:oe.custom,...r(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new Wa({schema:this,typeName:ee.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return na.create(this,this._def)}nullable(){return Au.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ra.create(this)}promise(){return Dg.create(this,this._def)}or(e){return TS.create([this,e],this._def)}and(e){return IS.create(this,e,this._def)}transform(e){return new Wa({...ze(this._def),schema:this,typeName:ee.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new NS({...ze(this._def),innerType:this,defaultValue:t,typeName:ee.ZodDefault})}brand(){return new I3({typeName:ee.ZodBranded,type:this,...ze(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new FS({...ze(this._def),innerType:this,catchValue:t,typeName:ee.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return LS.create(this,e)}readonly(){return jS.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const yne=/^c[^\s-]{8,}$/i,wne=/^[0-9a-z]+$/,vne=/^[0-9A-HJKMNP-TV-Z]{26}$/i,_ne=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,bne=/^[a-z0-9_-]{21}$/i,Sne=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,xne=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Ene=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,kne="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let zT;const Cne=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Pne=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Ane=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Tne=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ine=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,One=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,P3="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Rne=new RegExp(`^${P3}$`);function A3(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Mne(n){return new RegExp(`^${A3(n)}$`)}function $ne(n){let e=`${P3}T${A3(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Nne(n,e){return!!((e==="v4"||!e)&&Cne.test(n)||(e==="v6"||!e)&&Ane.test(n))}function Fne(n,e){if(!Sne.test(n))return!1;try{const[t]=n.split("."),r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function Lne(n,e){return!!((e==="v4"||!e)&&Pne.test(n)||(e==="v6"||!e)&&Tne.test(n))}class qa extends rt{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==be.string){const i=this._getOrReturnCtx(e);return ye(i,{code:oe.invalid_type,expected:be.string,received:i.parsedType}),qe}const r=new Pn;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),ye(s,{code:oe.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),ye(s,{code:oe.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?ye(s,{code:oe.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&ye(s,{code:oe.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")Ene.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"email",code:oe.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")zT||(zT=new RegExp(kne,"u")),zT.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"emoji",code:oe.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")_ne.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"uuid",code:oe.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")bne.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"nanoid",code:oe.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")yne.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"cuid",code:oe.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")wne.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"cuid2",code:oe.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")vne.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"ulid",code:oe.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),ye(s,{validation:"url",code:oe.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"regex",code:oe.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),ye(s,{code:oe.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),ye(s,{code:oe.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),ye(s,{code:oe.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?$ne(i).test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{code:oe.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?Rne.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{code:oe.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?Mne(i).test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{code:oe.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?xne.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"duration",code:oe.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?Nne(e.data,i.version)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"ip",code:oe.invalid_string,message:i.message}),r.dirty()):i.kind==="jwt"?Fne(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"jwt",code:oe.invalid_string,message:i.message}),r.dirty()):i.kind==="cidr"?Lne(e.data,i.version)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"cidr",code:oe.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?Ine.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"base64",code:oe.invalid_string,message:i.message}),r.dirty()):i.kind==="base64url"?One.test(e.data)||(s=this._getOrReturnCtx(e,s),ye(s,{validation:"base64url",code:oe.invalid_string,message:i.message}),r.dirty()):yt.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:oe.invalid_string,...Oe.errToObj(r)})}_addCheck(e){return new qa({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Oe.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Oe.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Oe.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Oe.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Oe.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Oe.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Oe.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Oe.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Oe.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Oe.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Oe.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Oe.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Oe.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...Oe.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...Oe.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Oe.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Oe.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...Oe.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Oe.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Oe.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Oe.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Oe.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Oe.errToObj(t)})}nonempty(e){return this.min(1,Oe.errToObj(e))}trim(){return new qa({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new qa({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new qa({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}qa.create=n=>{var e;return new qa({checks:[],typeName:ee.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...ze(n)})};function jne(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,i=parseInt(n.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}class Ch extends rt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==be.number){const i=this._getOrReturnCtx(e);return ye(i,{code:oe.invalid_type,expected:be.number,received:i.parsedType}),qe}let r;const s=new Pn;for(const i of this._def.checks)i.kind==="int"?yt.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),ye(r,{code:oe.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),ye(r,{code:oe.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),ye(r,{code:oe.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?jne(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),ye(r,{code:oe.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),ye(r,{code:oe.not_finite,message:i.message}),s.dirty()):yt.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Oe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Oe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Oe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Oe.toString(t))}setLimit(e,t,r,s){return new Ch({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Oe.toString(s)}]})}_addCheck(e){return new Ch({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Oe.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Oe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Oe.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Oe.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Oe.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Oe.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&yt.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Ch.create=n=>new Ch({checks:[],typeName:ee.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...ze(n)});class Ph extends rt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==be.bigint)return this._getInvalidInput(e);let r;const s=new Pn;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),ye(r,{code:oe.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),ye(r,{code:oe.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),ye(r,{code:oe.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):yt.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return ye(t,{code:oe.invalid_type,expected:be.bigint,received:t.parsedType}),qe}gte(e,t){return this.setLimit("min",e,!0,Oe.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Oe.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Oe.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Oe.toString(t))}setLimit(e,t,r,s){return new Ph({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Oe.toString(s)}]})}_addCheck(e){return new Ph({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Oe.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Oe.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Oe.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Oe.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Oe.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Ph.create=n=>{var e;return new Ph({checks:[],typeName:ee.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...ze(n)})};class VT extends rt{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==be.boolean){const r=this._getOrReturnCtx(e);return ye(r,{code:oe.invalid_type,expected:be.boolean,received:r.parsedType}),qe}return Jn(e.data)}}VT.create=n=>new VT({typeName:ee.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...ze(n)});class Lg extends rt{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==be.date){const i=this._getOrReturnCtx(e);return ye(i,{code:oe.invalid_type,expected:be.date,received:i.parsedType}),qe}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return ye(i,{code:oe.invalid_date}),qe}const r=new Pn;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),ye(s,{code:oe.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),ye(s,{code:oe.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):yt.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Lg({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Oe.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Oe.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Lg.create=n=>new Lg({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:ee.ZodDate,...ze(n)});class GT extends rt{_parse(e){if(this._getType(e)!==be.symbol){const r=this._getOrReturnCtx(e);return ye(r,{code:oe.invalid_type,expected:be.symbol,received:r.parsedType}),qe}return Jn(e.data)}}GT.create=n=>new GT({typeName:ee.ZodSymbol,...ze(n)});class PS extends rt{_parse(e){if(this._getType(e)!==be.undefined){const r=this._getOrReturnCtx(e);return ye(r,{code:oe.invalid_type,expected:be.undefined,received:r.parsedType}),qe}return Jn(e.data)}}PS.create=n=>new PS({typeName:ee.ZodUndefined,...ze(n)});class AS extends rt{_parse(e){if(this._getType(e)!==be.null){const r=this._getOrReturnCtx(e);return ye(r,{code:oe.invalid_type,expected:be.null,received:r.parsedType}),qe}return Jn(e.data)}}AS.create=n=>new AS({typeName:ee.ZodNull,...ze(n)});class ZT extends rt{constructor(){super(...arguments),this._any=!0}_parse(e){return Jn(e.data)}}ZT.create=n=>new ZT({typeName:ee.ZodAny,...ze(n)});class Ah extends rt{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Jn(e.data)}}Ah.create=n=>new Ah({typeName:ee.ZodUnknown,...ze(n)});class ec extends rt{_parse(e){const t=this._getOrReturnCtx(e);return ye(t,{code:oe.invalid_type,expected:be.never,received:t.parsedType}),qe}}ec.create=n=>new ec({typeName:ee.ZodNever,...ze(n)});class JT extends rt{_parse(e){if(this._getType(e)!==be.undefined){const r=this._getOrReturnCtx(e);return ye(r,{code:oe.invalid_type,expected:be.void,received:r.parsedType}),qe}return Jn(e.data)}}JT.create=n=>new JT({typeName:ee.ZodVoid,...ze(n)});class ra extends rt{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==be.array)return ye(t,{code:oe.invalid_type,expected:be.array,received:t.parsedType}),qe;if(s.exactLength!==null){const a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(ye(t,{code:a?oe.too_big:oe.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(ye(t,{code:oe.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(ye(t,{code:oe.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new ta(t,a,t.path,o)))).then(a=>Pn.mergeArray(r,a));const i=[...t.data].map((a,o)=>s.type._parseSync(new ta(t,a,t.path,o)));return Pn.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new ra({...this._def,minLength:{value:e,message:Oe.toString(t)}})}max(e,t){return new ra({...this._def,maxLength:{value:e,message:Oe.toString(t)}})}length(e,t){return new ra({...this._def,exactLength:{value:e,message:Oe.toString(t)}})}nonempty(e){return this.min(1,e)}}ra.create=(n,e)=>new ra({type:n,minLength:null,maxLength:null,exactLength:null,typeName:ee.ZodArray,...ze(e)});function Th(n){if(n instanceof nr){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=na.create(Th(r))}return new nr({...n._def,shape:()=>e})}else return n instanceof ra?new ra({...n._def,type:Th(n.element)}):n instanceof na?na.create(Th(n.unwrap())):n instanceof Au?Au.create(Th(n.unwrap())):n instanceof Ka?Ka.create(n.items.map(e=>Th(e))):n}class nr extends rt{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=yt.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==be.object){const l=this._getOrReturnCtx(e);return ye(l,{code:oe.invalid_type,expected:be.object,received:l.parsedType}),qe}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof ec&&this._def.unknownKeys==="strip"))for(const l in s.data)a.includes(l)||o.push(l);const u=[];for(const l of a){const d=i[l],h=s.data[l];u.push({key:{status:"valid",value:l},value:d._parse(new ta(s,h,s.path,l)),alwaysSet:l in s.data})}if(this._def.catchall instanceof ec){const l=this._def.unknownKeys;if(l==="passthrough")for(const d of o)u.push({key:{status:"valid",value:d},value:{status:"valid",value:s.data[d]}});else if(l==="strict")o.length>0&&(ye(s,{code:oe.unrecognized_keys,keys:o}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const d of o){const h=s.data[d];u.push({key:{status:"valid",value:d},value:l._parse(new ta(s,h,s.path,d)),alwaysSet:d in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const l=[];for(const d of u){const h=await d.key,f=await d.value;l.push({key:h,value:f,alwaysSet:d.alwaysSet})}return l}).then(l=>Pn.mergeObjectSync(r,l)):Pn.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return Oe.errToObj,new nr({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var s,i,a,o;const u=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,r).message)!==null&&a!==void 0?a:r.defaultError;return t.code==="unrecognized_keys"?{message:(o=Oe.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new nr({...this._def,unknownKeys:"strip"})}passthrough(){return new nr({...this._def,unknownKeys:"passthrough"})}extend(e){return new nr({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new nr({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ee.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new nr({...this._def,catchall:e})}pick(e){const t={};return yt.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new nr({...this._def,shape:()=>t})}omit(e){const t={};return yt.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new nr({...this._def,shape:()=>t})}deepPartial(){return Th(this)}partial(e){const t={};return yt.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}),new nr({...this._def,shape:()=>t})}required(e){const t={};return yt.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof na;)i=i._def.innerType;t[r]=i}}),new nr({...this._def,shape:()=>t})}keyof(){return T3(yt.objectKeys(this.shape))}}nr.create=(n,e)=>new nr({shape:()=>n,unknownKeys:"strip",catchall:ec.create(),typeName:ee.ZodObject,...ze(e)}),nr.strictCreate=(n,e)=>new nr({shape:()=>n,unknownKeys:"strict",catchall:ec.create(),typeName:ee.ZodObject,...ze(e)}),nr.lazycreate=(n,e)=>new nr({shape:n,unknownKeys:"strip",catchall:ec.create(),typeName:ee.ZodObject,...ze(e)});class TS extends rt{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new Bs(o.ctx.common.issues));return ye(t,{code:oe.invalid_union,unionErrors:a}),qe}if(t.common.async)return Promise.all(r.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const u of r){const l={...t,common:{...t.common,issues:[]},parent:null},d=u._parseSync({data:t.data,path:t.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!i&&(i={result:d,ctx:l}),l.common.issues.length&&a.push(l.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(u=>new Bs(u));return ye(t,{code:oe.invalid_union,unionErrors:o}),qe}}get options(){return this._def.options}}TS.create=(n,e)=>new TS({options:n,typeName:ee.ZodUnion,...ze(e)});const Ha=n=>n instanceof RS?Ha(n.schema):n instanceof Wa?Ha(n.innerType()):n instanceof MS?[n.value]:n instanceof Pu?n.options:n instanceof $S?yt.objectValues(n.enum):n instanceof NS?Ha(n._def.innerType):n instanceof PS?[void 0]:n instanceof AS?[null]:n instanceof na?[void 0,...Ha(n.unwrap())]:n instanceof Au?[null,...Ha(n.unwrap())]:n instanceof I3||n instanceof jS?Ha(n.unwrap()):n instanceof FS?Ha(n._def.innerType):[];class XT extends rt{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==be.object)return ye(t,{code:oe.invalid_type,expected:be.object,received:t.parsedType}),qe;const r=this.discriminator,s=t.data[r],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(ye(t,{code:oe.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),qe)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const s=new Map;for(const i of t){const a=Ha(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new XT({typeName:ee.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...ze(r)})}}function YT(n,e){const t=Qo(n),r=Qo(e);if(n===e)return{valid:!0,data:n};if(t===be.object&&r===be.object){const s=yt.objectKeys(e),i=yt.objectKeys(n).filter(o=>s.indexOf(o)!==-1),a={...n,...e};for(const o of i){const u=YT(n[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===be.array&&r===be.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<n.length;i++){const a=n[i],o=e[i],u=YT(a,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===be.date&&r===be.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class IS extends rt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(i,a)=>{if(x3(i)||x3(a))return qe;const o=YT(i.value,a.value);return o.valid?((E3(i)||E3(a))&&t.dirty(),{status:t.value,value:o.data}):(ye(r,{code:oe.invalid_intersection_types}),qe)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}IS.create=(n,e,t)=>new IS({left:n,right:e,typeName:ee.ZodIntersection,...ze(t)});class Ka extends rt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==be.array)return ye(r,{code:oe.invalid_type,expected:be.array,received:r.parsedType}),qe;if(r.data.length<this._def.items.length)return ye(r,{code:oe.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),qe;!this._def.rest&&r.data.length>this._def.items.length&&(ye(r,{code:oe.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((a,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new ta(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(i).then(a=>Pn.mergeArray(t,a)):Pn.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new Ka({...this._def,rest:e})}}Ka.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ka({items:n,typeName:ee.ZodTuple,rest:null,...ze(e)})};class OS extends rt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==be.object)return ye(r,{code:oe.invalid_type,expected:be.object,received:r.parsedType}),qe;const s=[],i=this._def.keyType,a=this._def.valueType;for(const o in r.data)s.push({key:i._parse(new ta(r,o,r.path,o)),value:a._parse(new ta(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Pn.mergeObjectAsync(t,s):Pn.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof rt?new OS({keyType:e,valueType:t,typeName:ee.ZodRecord,...ze(r)}):new OS({keyType:qa.create(),valueType:e,typeName:ee.ZodRecord,...ze(t)})}}class QT extends rt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==be.map)return ye(r,{code:oe.invalid_type,expected:be.map,received:r.parsedType}),qe;const s=this._def.keyType,i=this._def.valueType,a=[...r.data.entries()].map(([o,u],l)=>({key:s._parse(new ta(r,o,r.path,[l,"key"])),value:i._parse(new ta(r,u,r.path,[l,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of a){const l=await u.key,d=await u.value;if(l.status==="aborted"||d.status==="aborted")return qe;(l.status==="dirty"||d.status==="dirty")&&t.dirty(),o.set(l.value,d.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const u of a){const l=u.key,d=u.value;if(l.status==="aborted"||d.status==="aborted")return qe;(l.status==="dirty"||d.status==="dirty")&&t.dirty(),o.set(l.value,d.value)}return{status:t.value,value:o}}}}QT.create=(n,e,t)=>new QT({valueType:e,keyType:n,typeName:ee.ZodMap,...ze(t)});class Ih extends rt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==be.set)return ye(r,{code:oe.invalid_type,expected:be.set,received:r.parsedType}),qe;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(ye(r,{code:oe.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(ye(r,{code:oe.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function a(u){const l=new Set;for(const d of u){if(d.status==="aborted")return qe;d.status==="dirty"&&t.dirty(),l.add(d.value)}return{status:t.value,value:l}}const o=[...r.data.values()].map((u,l)=>i._parse(new ta(r,u,r.path,l)));return r.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new Ih({...this._def,minSize:{value:e,message:Oe.toString(t)}})}max(e,t){return new Ih({...this._def,maxSize:{value:e,message:Oe.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Ih.create=(n,e)=>new Ih({valueType:n,minSize:null,maxSize:null,typeName:ee.ZodSet,...ze(e)});class jg extends rt{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==be.function)return ye(t,{code:oe.invalid_type,expected:be.function,received:t.parsedType}),qe;function r(o,u){return WT({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,KT(),Mg].filter(l=>!!l),issueData:{code:oe.invalid_arguments,argumentsError:u}})}function s(o,u){return WT({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,KT(),Mg].filter(l=>!!l),issueData:{code:oe.invalid_return_type,returnTypeError:u}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Dg){const o=this;return Jn(async function(...u){const l=new Bs([]),d=await o._def.args.parseAsync(u,i).catch(p=>{throw l.addIssue(r(u,p)),l}),h=await Reflect.apply(a,this,d);return await o._def.returns._def.type.parseAsync(h,i).catch(p=>{throw l.addIssue(s(h,p)),l})})}else{const o=this;return Jn(function(...u){const l=o._def.args.safeParse(u,i);if(!l.success)throw new Bs([r(u,l.error)]);const d=Reflect.apply(a,this,l.data),h=o._def.returns.safeParse(d,i);if(!h.success)throw new Bs([s(d,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new jg({...this._def,args:Ka.create(e).rest(Ah.create())})}returns(e){return new jg({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new jg({args:e||Ka.create([]).rest(Ah.create()),returns:t||Ah.create(),typeName:ee.ZodFunction,...ze(r)})}}class RS extends rt{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}RS.create=(n,e)=>new RS({getter:n,typeName:ee.ZodLazy,...ze(e)});class MS extends rt{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return ye(t,{received:t.data,code:oe.invalid_literal,expected:this._def.value}),qe}return{status:"valid",value:e.data}}get value(){return this._def.value}}MS.create=(n,e)=>new MS({value:n,typeName:ee.ZodLiteral,...ze(e)});function T3(n,e){return new Pu({values:n,typeName:ee.ZodEnum,...ze(e)})}class Pu extends rt{constructor(){super(...arguments),Ng.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return ye(t,{expected:yt.joinValues(r),received:t.parsedType,code:oe.invalid_type}),qe}if(CS(this,Ng)||k3(this,Ng,new Set(this._def.values)),!CS(this,Ng).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return ye(t,{received:t.data,code:oe.invalid_enum_value,options:r}),qe}return Jn(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Pu.create(e,{...this._def,...t})}exclude(e,t=this._def){return Pu.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}Ng=new WeakMap,Pu.create=T3;class $S extends rt{constructor(){super(...arguments),Fg.set(this,void 0)}_parse(e){const t=yt.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==be.string&&r.parsedType!==be.number){const s=yt.objectValues(t);return ye(r,{expected:yt.joinValues(s),received:r.parsedType,code:oe.invalid_type}),qe}if(CS(this,Fg)||k3(this,Fg,new Set(yt.getValidEnumValues(this._def.values))),!CS(this,Fg).has(e.data)){const s=yt.objectValues(t);return ye(r,{received:r.data,code:oe.invalid_enum_value,options:s}),qe}return Jn(e.data)}get enum(){return this._def.values}}Fg=new WeakMap,$S.create=(n,e)=>new $S({values:n,typeName:ee.ZodNativeEnum,...ze(e)});class Dg extends rt{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==be.promise&&t.common.async===!1)return ye(t,{code:oe.invalid_type,expected:be.promise,received:t.parsedType}),qe;const r=t.parsedType===be.promise?t.data:Promise.resolve(t.data);return Jn(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Dg.create=(n,e)=>new Dg({type:n,typeName:ee.ZodPromise,...ze(e)});class Wa extends rt{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ee.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{ye(r,a),a.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const a=s.transform(r.data,i);if(r.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return qe;const u=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return u.status==="aborted"?qe:u.status==="dirty"||t.value==="dirty"?$g(u.value):u});{if(t.value==="aborted")return qe;const o=this._def.schema._parseSync({data:a,path:r.path,parent:r});return o.status==="aborted"?qe:o.status==="dirty"||t.value==="dirty"?$g(o.value):o}}if(s.type==="refinement"){const a=o=>{const u=s.refinement(o,i);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?qe:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?qe:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!kh(a))return a;const o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>kh(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);yt.assertNever(s)}}Wa.create=(n,e,t)=>new Wa({schema:n,typeName:ee.ZodEffects,effect:e,...ze(t)}),Wa.createWithPreprocess=(n,e,t)=>new Wa({schema:e,effect:{type:"preprocess",transform:n},typeName:ee.ZodEffects,...ze(t)});class na extends rt{_parse(e){return this._getType(e)===be.undefined?Jn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}na.create=(n,e)=>new na({innerType:n,typeName:ee.ZodOptional,...ze(e)});class Au extends rt{_parse(e){return this._getType(e)===be.null?Jn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Au.create=(n,e)=>new Au({innerType:n,typeName:ee.ZodNullable,...ze(e)});class NS extends rt{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===be.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}NS.create=(n,e)=>new NS({innerType:n,typeName:ee.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...ze(e)});class FS extends rt{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return kS(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Bs(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Bs(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}FS.create=(n,e)=>new FS({innerType:n,typeName:ee.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...ze(e)});class e1 extends rt{_parse(e){if(this._getType(e)!==be.nan){const r=this._getOrReturnCtx(e);return ye(r,{code:oe.invalid_type,expected:be.nan,received:r.parsedType}),qe}return{status:"valid",value:e.data}}}e1.create=n=>new e1({typeName:ee.ZodNaN,...ze(n)});class I3 extends rt{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class LS extends rt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?qe:i.status==="dirty"?(t.dirty(),$g(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?qe:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new LS({in:e,out:t,typeName:ee.ZodPipeline})}}class jS extends rt{_parse(e){const t=this._def.innerType._parse(e),r=s=>(kh(s)&&(s.value=Object.freeze(s.value)),s);return kS(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}}jS.create=(n,e)=>new jS({innerType:n,typeName:ee.ZodReadonly,...ze(e)}),nr.lazycreate;var ee;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(ee||(ee={})),qa.create,Ch.create,e1.create,Ph.create,VT.create,Lg.create,GT.create,PS.create,AS.create,ZT.create,Ah.create,ec.create,JT.create,ra.create,nr.create,nr.strictCreate,TS.create,XT.create,IS.create,Ka.create,OS.create,QT.create,Ih.create,jg.create,RS.create,MS.create,Pu.create,$S.create,Dg.create,Wa.create,na.create,Au.create,Wa.createWithPreprocess,LS.create;function Dne(){return{}}function Bne(n,e){var r,s,i;const t={type:"array"};return(r=n.type)!=null&&r._def&&((i=(s=n.type)==null?void 0:s._def)==null?void 0:i.typeName)!==ee.ZodAny&&(t.items=Tt(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&Mt(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&Mt(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(Mt(t,"minItems",n.exactLength.value,n.exactLength.message,e),Mt(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Une(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Mt(t,"minimum",r.value,r.message,e):Mt(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Mt(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Mt(t,"maximum",r.value,r.message,e):Mt(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Mt(t,"maximum",r.value,r.message,e));break;case"multipleOf":Mt(t,"multipleOf",r.value,r.message,e);break}return t}function qne(){return{type:"boolean"}}function O3(n,e){return Tt(n.type._def,e)}const Hne=(n,e)=>Tt(n.innerType._def,e);function R3(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,i)=>R3(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Kne(n,e)}}const Kne=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":Mt(t,"minimum",r.value,r.message,e);break;case"max":Mt(t,"maximum",r.value,r.message,e);break}return t};function Wne(n,e){return{...Tt(n.innerType._def,e),default:n.defaultValue()}}function zne(n,e){return e.effectStrategy==="input"?Tt(n.schema._def,e):{}}function Vne(n){return{type:"string",enum:Array.from(n.values)}}const Gne=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function Zne(n,e){const t=[Tt(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Tt(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(Gne(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...u}=i;a=u}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function Jne(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let t1;const vi={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(t1===void 0&&(t1=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),t1),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function M3(n,e){const t={type:"string"};if(n.checks)for(const r of n.checks)switch(r.kind){case"min":Mt(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":Mt(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":_i(t,"email",r.message,e);break;case"format:idn-email":_i(t,"idn-email",r.message,e);break;case"pattern:zod":An(t,vi.email,r.message,e);break}break;case"url":_i(t,"uri",r.message,e);break;case"uuid":_i(t,"uuid",r.message,e);break;case"regex":An(t,r.regex,r.message,e);break;case"cuid":An(t,vi.cuid,r.message,e);break;case"cuid2":An(t,vi.cuid2,r.message,e);break;case"startsWith":An(t,RegExp(`^${r1(r.value,e)}`),r.message,e);break;case"endsWith":An(t,RegExp(`${r1(r.value,e)}$`),r.message,e);break;case"datetime":_i(t,"date-time",r.message,e);break;case"date":_i(t,"date",r.message,e);break;case"time":_i(t,"time",r.message,e);break;case"duration":_i(t,"duration",r.message,e);break;case"length":Mt(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),Mt(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{An(t,RegExp(r1(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&_i(t,"ipv4",r.message,e),r.version!=="v4"&&_i(t,"ipv6",r.message,e);break}case"base64url":An(t,vi.base64url,r.message,e);break;case"jwt":An(t,vi.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&An(t,vi.ipv4Cidr,r.message,e),r.version!=="v4"&&An(t,vi.ipv6Cidr,r.message,e);break}case"emoji":An(t,vi.emoji(),r.message,e);break;case"ulid":{An(t,vi.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{_i(t,"binary",r.message,e);break}case"contentEncoding:base64":{Mt(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{An(t,vi.base64,r.message,e);break}}break}case"nanoid":An(t,vi.nanoid,r.message,e)}return t}function r1(n,e){return e.patternStrategy==="escape"?Yne(n):n}const Xne=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Yne(n){let e="";for(let t=0;t<n.length;t++)Xne.has(n[t])||(e+="\\"),e+=n[t];return e}function _i(n,e,t,r){var s;n.format||(s=n.anyOf)!=null&&s.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):Mt(n,"format",e,t,r)}function An(n,e,t,r){var s;n.pattern||(s=n.allOf)!=null&&s.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:$3(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):Mt(n,"pattern",$3(e,r),t,r)}function $3(n,e){var u;if(!e.applyRegexFlags||!n.flags)return n.source;const t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source;let s="",i=!1,a=!1,o=!1;for(let l=0;l<r.length;l++){if(i){s+=r[l],i=!1;continue}if(t.i){if(a){if(r[l].match(/[a-z]/)){o?(s+=r[l],s+=`${r[l-2]}-${r[l]}`.toUpperCase(),o=!1):r[l+1]==="-"&&((u=r[l+2])!=null&&u.match(/[a-z]/))?(s+=r[l],o=!0):s+=`${r[l]}${r[l].toUpperCase()}`;continue}}else if(r[l].match(/[a-z]/)){s+=`[${r[l]}${r[l].toUpperCase()}]`;continue}}if(t.m){if(r[l]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[l]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&r[l]==="."){s+=a?`${r[l]}\r
`:`[${r[l]}\r
]`;continue}s+=r[l],r[l]==="\\"?i=!0:a&&r[l]==="]"?a=!1:!a&&r[l]==="["&&(a=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return s}function N3(n,e){var r,s,i,a,o,u;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===ee.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((l,d)=>({...l,[d]:Tt(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",d]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:Tt(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((s=n.keyType)==null?void 0:s._def.typeName)===ee.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const{type:l,...d}=M3(n.keyType._def,e);return{...t,propertyNames:d}}else{if(((a=n.keyType)==null?void 0:a._def.typeName)===ee.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(((o=n.keyType)==null?void 0:o._def.typeName)===ee.ZodBranded&&n.keyType._def.type._def.typeName===ee.ZodString&&((u=n.keyType._def.type._def.checks)!=null&&u.length)){const{type:l,...d}=O3(n.keyType._def,e);return{...t,propertyNames:d}}}return t}function Qne(n,e){if(e.mapStrategy==="record")return N3(n,e);const t=Tt(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=Tt(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function ese(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function tse(){return{not:{}}}function rse(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const DS={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function nse(n,e){if(e.target==="openApi3")return F3(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in DS&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((s,i)=>{const a=DS[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return F3(n,e)}const F3=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>Tt(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function sse(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:DS[n.innerType._def.typeName],nullable:!0}:{type:[DS[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=Tt(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=Tt(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function ise(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",b3(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Mt(t,"minimum",r.value,r.message,e):Mt(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Mt(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Mt(t,"maximum",r.value,r.message,e):Mt(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Mt(t,"maximum",r.value,r.message,e));break;case"multipleOf":Mt(t,"multipleOf",r.value,r.message,e);break}return t}function ase(n,e){const t=e.target==="openAi",r={type:"object",properties:{}},s=[],i=n.shape();for(const o in i){let u=i[o];if(u===void 0||u._def===void 0)continue;let l=cse(u);l&&t&&(u instanceof na&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),l=!1);const d=Tt(u._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});d!==void 0&&(r.properties[o]=d,l||s.push(o))}s.length&&(r.required=s);const a=ose(n,e);return a!==void 0&&(r.additionalProperties=a),r}function ose(n,e){if(n.catchall._def.typeName!=="ZodNever")return Tt(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function cse(n){try{return n.isOptional()}catch{return!0}}const use=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return Tt(n.innerType._def,e);const t=Tt(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},lse=(n,e)=>{if(e.pipeStrategy==="input")return Tt(n.in._def,e);if(e.pipeStrategy==="output")return Tt(n.out._def,e);const t=Tt(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=Tt(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}};function dse(n,e){return Tt(n.type._def,e)}function hse(n,e){const r={type:"array",uniqueItems:!0,items:Tt(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&Mt(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&Mt(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function fse(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>Tt(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:Tt(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>Tt(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function pse(){return{not:{}}}function mse(){return{}}const gse=(n,e)=>Tt(n.innerType._def,e),yse=(n,e,t)=>{switch(e){case ee.ZodString:return M3(n,t);case ee.ZodNumber:return ise(n,t);case ee.ZodObject:return ase(n,t);case ee.ZodBigInt:return Une(n,t);case ee.ZodBoolean:return qne();case ee.ZodDate:return R3(n,t);case ee.ZodUndefined:return pse();case ee.ZodNull:return rse(t);case ee.ZodArray:return Bne(n,t);case ee.ZodUnion:case ee.ZodDiscriminatedUnion:return nse(n,t);case ee.ZodIntersection:return Zne(n,t);case ee.ZodTuple:return fse(n,t);case ee.ZodRecord:return N3(n,t);case ee.ZodLiteral:return Jne(n,t);case ee.ZodEnum:return Vne(n);case ee.ZodNativeEnum:return ese(n);case ee.ZodNullable:return sse(n,t);case ee.ZodOptional:return use(n,t);case ee.ZodMap:return Qne(n,t);case ee.ZodSet:return hse(n,t);case ee.ZodLazy:return()=>n.getter()._def;case ee.ZodPromise:return dse(n,t);case ee.ZodNaN:case ee.ZodNever:return tse();case ee.ZodEffects:return zne(n,t);case ee.ZodAny:return Dne();case ee.ZodUnknown:return mse();case ee.ZodDefault:return Wne(n,t);case ee.ZodBranded:return O3(n,t);case ee.ZodReadonly:return gse(n,t);case ee.ZodCatch:return Hne(n,t);case ee.ZodPipeline:return lse(n,t);case ee.ZodFunction:case ee.ZodVoid:case ee.ZodSymbol:return;default:return(r=>{})()}};function Tt(n,e,t=!1){var o;const r=e.seen.get(n);if(e.override){const u=(o=e.override)==null?void 0:o.call(e,n,e,r,t);if(u!==hne)return u}if(r&&!t){const u=wse(r,e);if(u!==void 0)return u}const s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);const i=yse(n,n.typeName,e),a=typeof i=="function"?Tt(i(),e):i;if(a&&_se(n,e,a),e.postProcess){const u=e.postProcess(a,n,e);return s.jsonSchema=a,u}return s.jsonSchema=a,a}const wse=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:vse(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},vse=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},_se=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),bse=(n,e)=>{const t=mne(e),r=void 0,s=e==null?void 0:e.name,i=Tt(n._def,t,!1)??{},a=s===void 0?r?{...i,[t.definitionPath]:r}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...r,[s]:i}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a},Sse=Symbol("Let zodToJsonSchema decide on which parser to use"),L3={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},xse=n=>typeof n=="string"?{...L3,basePath:["#"],definitions:{},name:n}:{...L3,basePath:["#"],definitions:{},...n},n1=n=>"_def"in n?n._def:n;function Ese(n){if(!n)return!0;for(const e in n)return!1;return!0}const kse=n=>{const e=xse(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[n1(s),{def:n1(s),path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function j3(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function $t(n,e,t,r,s){n[e]=t,j3(n,e,r,s)}function Cse(){return{}}function Pse(n,e){var r,s;const t={type:"array"};return((s=(r=n.type)==null?void 0:r._def)==null?void 0:s.typeName)!==ee.ZodAny&&(t.items=_t(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&$t(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&$t(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&($t(t,"minItems",n.exactLength.value,n.exactLength.message,e),$t(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Ase(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?$t(t,"minimum",r.value,r.message,e):$t(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),$t(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?$t(t,"maximum",r.value,r.message,e):$t(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),$t(t,"maximum",r.value,r.message,e));break;case"multipleOf":$t(t,"multipleOf",r.value,r.message,e);break}return t}function Tse(){return{type:"boolean"}}function Ise(n,e){return _t(n.type._def,e)}const Ose=(n,e)=>_t(n.innerType._def,e);function D3(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,i)=>D3(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Rse(n,e)}}const Rse=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":$t(t,"minimum",r.value,r.message,e);break;case"max":$t(t,"maximum",r.value,r.message,e);break}return t};function Mse(n,e){return{..._t(n.innerType._def,e),default:n.defaultValue()}}function $se(n,e,t){return e.effectStrategy==="input"?_t(n.schema._def,e,t):{}}function Nse(n){return{type:"string",enum:[...n.values]}}const Fse=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function Lse(n,e){const t=[_t(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),_t(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(Fse(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...u}=i;a=u}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function jse(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let s1;const Tu={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(s1===void 0&&(s1=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),s1),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function B3(n,e){const t={type:"string"};function r(s){return e.patternStrategy==="escape"?Dse(s):s}if(n.checks)for(const s of n.checks)switch(s.kind){case"min":$t(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":$t(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":bi(t,"email",s.message,e);break;case"format:idn-email":bi(t,"idn-email",s.message,e);break;case"pattern:zod":Si(t,Tu.email,s.message,e);break}break;case"url":bi(t,"uri",s.message,e);break;case"uuid":bi(t,"uuid",s.message,e);break;case"regex":Si(t,s.regex,s.message,e);break;case"cuid":Si(t,Tu.cuid,s.message,e);break;case"cuid2":Si(t,Tu.cuid2,s.message,e);break;case"startsWith":Si(t,RegExp(`^${r(s.value)}`),s.message,e);break;case"endsWith":Si(t,RegExp(`${r(s.value)}$`),s.message,e);break;case"datetime":bi(t,"date-time",s.message,e);break;case"date":bi(t,"date",s.message,e);break;case"time":bi(t,"time",s.message,e);break;case"duration":bi(t,"duration",s.message,e);break;case"length":$t(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),$t(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{Si(t,RegExp(r(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&bi(t,"ipv4",s.message,e),s.version!=="v4"&&bi(t,"ipv6",s.message,e);break}case"emoji":Si(t,Tu.emoji,s.message,e);break;case"ulid":{Si(t,Tu.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{bi(t,"binary",s.message,e);break}case"contentEncoding:base64":{$t(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{Si(t,Tu.base64,s.message,e);break}}break}case"nanoid":Si(t,Tu.nanoid,s.message,e)}return t}const Dse=n=>Array.from(n).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),bi=(n,e,t,r)=>{var s;n.format||(s=n.anyOf)!=null&&s.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):$t(n,"format",e,t,r)},Si=(n,e,t,r)=>{var s;n.pattern||(s=n.allOf)!=null&&s.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:U3(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):$t(n,"pattern",U3(e,r),t,r)},U3=(n,e)=>{var l;const t=typeof n=="function"?n():n;if(!e.applyRegexFlags||!t.flags)return t.source;const r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=r.i?t.source.toLowerCase():t.source;let i="",a=!1,o=!1,u=!1;for(let d=0;d<s.length;d++){if(a){i+=s[d],a=!1;continue}if(r.i){if(o){if(s[d].match(/[a-z]/)){u?(i+=s[d],i+=`${s[d-2]}-${s[d]}`.toUpperCase(),u=!1):s[d+1]==="-"&&((l=s[d+2])!=null&&l.match(/[a-z]/))?(i+=s[d],u=!0):i+=`${s[d]}${s[d].toUpperCase()}`;continue}}else if(s[d].match(/[a-z]/)){i+=`[${s[d]}${s[d].toUpperCase()}]`;continue}}if(r.m){if(s[d]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(s[d]==="$"){i+=`($|(?=[\r
]))`;continue}}if(r.s&&s[d]==="."){i+=o?`${s[d]}\r
`:`[${s[d]}\r
]`;continue}i+=s[d],s[d]==="\\"?a=!0:o&&s[d]==="]"?o=!1:!o&&s[d]==="["&&(o=!0)}try{const d=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i};function q3(n,e){var r,s,i,a;if(e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===ee.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((o,u)=>({...o,[u]:_t(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",u]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:_t(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((s=n.keyType)==null?void 0:s._def.typeName)===ee.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const o=Object.entries(B3(n.keyType._def,e)).reduce((u,[l,d])=>l==="type"?u:{...u,[l]:d},{});return{...t,propertyNames:o}}else if(((a=n.keyType)==null?void 0:a._def.typeName)===ee.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};return t}function Bse(n,e){if(e.mapStrategy==="record")return q3(n,e);const t=_t(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=_t(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function Use(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function qse(){return{not:{}}}function Hse(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const BS={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Kse(n,e){if(e.target==="openApi3")return H3(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in BS&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((s,i)=>{const a=BS[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return H3(n,e)}const H3=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>_t(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function Wse(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:BS[n.innerType._def.typeName],nullable:!0}:{type:[BS[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=_t(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=_t(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function zse(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",j3(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?$t(t,"minimum",r.value,r.message,e):$t(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),$t(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?$t(t,"maximum",r.value,r.message,e):$t(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),$t(t,"maximum",r.value,r.message,e));break;case"multipleOf":$t(t,"multipleOf",r.value,r.message,e);break}return t}function Vse(n,e){return e.removeAdditionalStrategy==="strict"?n.catchall._def.typeName==="ZodNever"?n.unknownKeys!=="strict":_t(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":_t(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function Gse(n,e){const t={type:"object",...Object.entries(n.shape()).reduce((r,[s,i])=>{if(i===void 0||i._def===void 0)return r;const a=_t(i._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return a===void 0?r:{properties:{...r.properties,[s]:a},required:i.isOptional()&&!e.openaiStrictMode?r.required:[...r.required,s]}},{properties:{},required:[]}),additionalProperties:Vse(n,e)};return t.required.length||delete t.required,t}const Zse=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return _t(n.innerType._def,e);const t=_t(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},Jse=(n,e)=>{if(e.pipeStrategy==="input")return _t(n.in._def,e);if(e.pipeStrategy==="output")return _t(n.out._def,e);const t=_t(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=_t(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}};function Xse(n,e){return _t(n.type._def,e)}function Yse(n,e){const r={type:"array",uniqueItems:!0,items:_t(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&$t(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&$t(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function Qse(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>_t(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:_t(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>_t(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function eie(){return{not:{}}}function tie(){return{}}const rie=(n,e)=>_t(n.innerType._def,e);function _t(n,e,t=!1){var a;const r=e.seen.get(n);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,n,e,r,t);if(o!==Sse)return o}if(r&&!t){const o=nie(r,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);const i=iie(n,n.typeName,e,t);return i&&aie(n,e,i),s.jsonSchema=i,i}const nie=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"extract-to-root":const t=n.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=n.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:sie(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((r,s)=>e.currentPath[s]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},sie=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},iie=(n,e,t,r)=>{switch(e){case ee.ZodString:return B3(n,t);case ee.ZodNumber:return zse(n,t);case ee.ZodObject:return Gse(n,t);case ee.ZodBigInt:return Ase(n,t);case ee.ZodBoolean:return Tse();case ee.ZodDate:return D3(n,t);case ee.ZodUndefined:return eie();case ee.ZodNull:return Hse(t);case ee.ZodArray:return Pse(n,t);case ee.ZodUnion:case ee.ZodDiscriminatedUnion:return Kse(n,t);case ee.ZodIntersection:return Lse(n,t);case ee.ZodTuple:return Qse(n,t);case ee.ZodRecord:return q3(n,t);case ee.ZodLiteral:return jse(n,t);case ee.ZodEnum:return Nse(n);case ee.ZodNativeEnum:return Use(n);case ee.ZodNullable:return Wse(n,t);case ee.ZodOptional:return Zse(n,t);case ee.ZodMap:return Bse(n,t);case ee.ZodSet:return Yse(n,t);case ee.ZodLazy:return _t(n.getter()._def,t);case ee.ZodPromise:return Xse(n,t);case ee.ZodNaN:case ee.ZodNever:return qse();case ee.ZodEffects:return $se(n,t,r);case ee.ZodAny:return Cse();case ee.ZodUnknown:return tie();case ee.ZodDefault:return Mse(n,t);case ee.ZodBranded:return Ise(n,t);case ee.ZodReadonly:return rie(n,t);case ee.ZodCatch:return Ose(n,t);case ee.ZodPipeline:return Jse(n,t);case ee.ZodFunction:case ee.ZodVoid:case ee.ZodSymbol:return;default:return(s=>{})()}},aie=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),oie=(n,e)=>{const t=kse(e),r=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=_t(n._def,r===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,r]},!1)??{},i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i);const a=(()=>{if(Ese(t.definitions))return;const u={},l=new Set;for(let d=0;d<500;d++){const h=Object.entries(t.definitions).filter(([f])=>!l.has(f));if(h.length===0)break;for(const[f,p]of h)u[f]=_t(n1(p),{...t,currentPath:[...t.basePath,t.definitionPath,f]},!0)??{},l.add(f)}return u})(),o=r===void 0?a?{...s,[t.definitionPath]:a}:s:t.nameStrategy==="duplicate-ref"?{...s,...a||t.seenRefs.size?{[t.definitionPath]:{...a,...t.seenRefs.size?{[r]:s}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,r].join("/"),[t.definitionPath]:{...a,[r]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function K3(n,e){return oie(n,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function cie(n,e,t){return Yre({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:K3(n,{name:e})}},r=>n.parse(JSON.parse(r)))}function uie(n){return Qre({type:"function",function:{name:n.name,parameters:K3(n.parameters,{name:n.name}),strict:!0,...n.description?{description:n.description}:void 0}},{callback:n.function,parser:e=>n.parameters.parse(JSON.parse(e))})}function lie(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a,azureOpenAIEndpoint:o}=n;if((r||a)&&s&&e)return`${s}/${e}`;if((r||a)&&o&&e)return`${o}/openai/deployments/${e}`;if(r||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function US(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function W3(n){let e;return n.constructor.name===aS.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===Ds.name?(e=new Error(n.message),e.name="AbortError"):n.status===400&&n.message.includes("tool_calls")?e=US(n,"INVALID_TOOL_RESULTS"):n.status===401?e=US(n,"MODEL_AUTHENTICATION"):n.status===429?e=US(n,"MODEL_RATE_LIMIT"):n.status===404?e=US(n,"MODEL_NOT_FOUND"):e=n,e}function die(n){if(n)return n==="any"||n==="required"?"required":n==="auto"?"auto":n==="none"?"none":typeof n=="string"?{type:"function",function:{name:n}}:n}function hie(n){return n.anyOf!==void 0&&Array.isArray(n.anyOf)}function fie(n){const e=["namespace functions {",""];for(const t of n)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(z3(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function z3(n,e){var r;const t=[];for(const[s,i]of Object.entries(n.properties??{}))i.description&&e<2&&t.push(`// ${i.description}`),(r=n.required)!=null&&r.includes(s)?t.push(`${s}: ${qS(i,e)},`):t.push(`${s}?: ${qS(i,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function qS(n,e){if(hie(n))return n.anyOf.map(t=>qS(t,e)).join(" | ");switch(n.type){case"string":return n.enum?n.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",z3(n,e+2),"}"].join(`
`);case"array":return n.items?`${qS(n.items,e)}[]`:"any[]";default:return""}}function pie(n,e){let t;if(ih(n)){const r=uie({name:n.name,parameters:n.schema,description:n.description});r.function.parameters?t={type:r.type,function:{name:r.function.name,description:r.function.description,parameters:r.function.parameters,...(e==null?void 0:e.strict)!==void 0?{strict:e.strict}:{}}}:t={type:"function",function:TA(n,e)}}else t=n;return(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function mie(n){return n.role!=="system"&&n.role!=="developer"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&n.role!=="tool"&&console.warn(`Unknown message role: ${n.role}`),n.role}function V3(n){const e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Lo.isInstance(n))throw new Error("Invalid generic chat message");return mie(n)}default:throw new Error(`Unknown message type: ${e}`)}}function G3(n,e){return n.flatMap(t=>{var i;let r=V3(t);r==="system"&&J3(e)&&(r="developer");const s={role:r,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=null),pu(t)&&((i=t.tool_calls)!=null&&i.length)?(s.tool_calls=t.tool_calls.map(yD),s.content=null):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const a={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,a]}return s})}function Z3(n,e){return Ym(n)?(e==null?void 0:e.strict)!==void 0?{...n,function:{...n.function,strict:e.strict}}:n:pie(n,e)}function J3(n){return(n==null?void 0:n.startsWith("o1"))||(n==null?void 0:n.startsWith("o3"))}class X3 extends Fs{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming"]}constructor(e){var t,r;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??sn("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??sn("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this==null?void 0:this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let r;return(t==null?void 0:t.strict)!==void 0?r=t.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>Z3(s,{strict:r})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&HS(e.json_schema.schema)?cie(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){var o;let r;(e==null?void 0:e.strict)!==void 0?r=e.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling);let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}});const i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(u=>Z3(u,{strict:r})):void 0,tool_choice:die(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(i.prediction=e.prediction);const a=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return a!==void 0&&(i.reasoning_effort=a),J3(i.model)?i.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:i.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,i}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const r=e.tool_calls;switch(e.role){case"assistant":{const s=[],i=[];for(const u of r??[])try{s.push(CA(u,{returnId:!0}))}catch(l){i.push(wD(u,l.message))}const a={function_call:e.function_call,tool_calls:r};this.__includeRawResponse!==void 0&&(a.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(a.audio=e.audio),new nn({content:e.content||"",tool_calls:s,invalid_tool_calls:i,additional_kwargs:a,response_metadata:o,id:t.id})}default:return new Lo(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,r){var u,l;const s=e.role??r,i=e.content??"";let a;e.function_call?a={function_call:e.function_call}:e.tool_calls?a={tool_calls:e.tool_calls}:a={},this.__includeRawResponse&&(a.__raw_response=t),e.audio&&(a.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(s==="user")return new wm({content:i,response_metadata:o});if(s==="assistant"){const d=[];if(Array.isArray(e.tool_calls))for(const h of e.tool_calls)d.push({name:(u=h.function)==null?void 0:u.name,args:(l=h.function)==null?void 0:l.arguments,id:h.id,index:h.index,type:"tool_call_chunk"});return new wr({content:i,tool_call_chunks:d,additional_kwargs:a,id:t.id,response_metadata:o})}else return s==="system"?new mu({content:i,response_metadata:o}):s==="developer"?new mu({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new ym({content:i,additional_kwargs:a,name:e.name,response_metadata:o}):s==="tool"?new Bb({content:i,additional_kwargs:a,tool_call_id:e.tool_call_id,response_metadata:o}):new gm({content:i,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){var l,d,h,f,p,m,g,y,w,v;const s=G3(e,this.model),i={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let a;const o=await this.completionWithRetry(i,t);let u;for await(const b of o){const S=(l=b==null?void 0:b.choices)==null?void 0:l[0];if(b.usage&&(u=b.usage),!S)continue;const{delta:P}=S;if(!P)continue;const k=this._convertOpenAIDeltaToBaseMessageChunk(P,b,a);a=P.role??a;const C={prompt:t.promptIndex??0,completion:S.index??0};if(typeof k.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const E={...C};S.finish_reason!=null&&(E.finish_reason=S.finish_reason,E.system_fingerprint=b.system_fingerprint,E.model_name=b.model),this.logprobs&&(E.logprobs=S.logprobs);const M=new ds({message:k,text:k.content,generationInfo:E});yield M,await(r==null?void 0:r.handleLLMNewToken(M.text??"",C,void 0,void 0,void 0,{chunk:M}))}if(u){const b={...((d=u.prompt_tokens_details)==null?void 0:d.audio_tokens)!==null&&{audio:(h=u.prompt_tokens_details)==null?void 0:h.audio_tokens},...((f=u.prompt_tokens_details)==null?void 0:f.cached_tokens)!==null&&{cache_read:(p=u.prompt_tokens_details)==null?void 0:p.cached_tokens}},S={...((m=u.completion_tokens_details)==null?void 0:m.audio_tokens)!==null&&{audio:(g=u.completion_tokens_details)==null?void 0:g.audio_tokens},...((y=u.completion_tokens_details)==null?void 0:y.reasoning_tokens)!==null&&{reasoning:(w=u.completion_tokens_details)==null?void 0:w.reasoning_tokens}};yield new ds({message:new wr({content:"",response_metadata:{usage:{...u}},usage_metadata:{input_tokens:u.prompt_tokens,output_tokens:u.completion_tokens,total_tokens:u.total_tokens,...Object.keys(b).length>0&&{input_token_details:b},...Object.keys(S).length>0&&{output_token_details:S}}}),text:""})}if((v=t.signal)!=null&&v.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){var o,u;const s={},i=this.invocationParams(t),a=G3(e,this.model);if(i.stream){const l=this._streamResponseChunks(e,t,r),d={};for await(const y of l){y.message.response_metadata={...y.generationInfo,...y.message.response_metadata};const w=((o=y.generationInfo)==null?void 0:o.completion)??0;d[w]===void 0?d[w]=y:d[w]=d[w].concat(y)}const h=Object.entries(d).sort(([y],[w])=>parseInt(y,10)-parseInt(w,10)).map(([y,w])=>w),{functions:f,function_call:p}=this.invocationParams(t),m=await this.getEstimatedTokenCountFromPrompt(e,f,p),g=await this.getNumTokensFromGenerations(h);return s.input_tokens=m,s.output_tokens=g,s.total_tokens=m+g,{generations:h,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let l;t.response_format&&t.response_format.type==="json_schema"?l=await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):l=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:d,prompt_tokens:h,total_tokens:f,prompt_tokens_details:p,completion_tokens_details:m}=(l==null?void 0:l.usage)??{};d&&(s.output_tokens=(s.output_tokens??0)+d),h&&(s.input_tokens=(s.input_tokens??0)+h),f&&(s.total_tokens=(s.total_tokens??0)+f),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.cached_tokens)!==null)&&(s.input_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.cached_tokens)!==null&&{cache_read:p==null?void 0:p.cached_tokens}}),((m==null?void 0:m.audio_tokens)!==null||(m==null?void 0:m.reasoning_tokens)!==null)&&(s.output_token_details={...(m==null?void 0:m.audio_tokens)!==null&&{audio:m==null?void 0:m.audio_tokens},...(m==null?void 0:m.reasoning_tokens)!==null&&{reasoning:m==null?void 0:m.reasoning_tokens}});const g=[];for(const y of(l==null?void 0:l.choices)??[]){const v={text:((u=y.message)==null?void 0:u.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(y.message??{role:"assistant"},l)};v.generationInfo={...y.finish_reason?{finish_reason:y.finish_reason}:{},...y.logprobs?{logprobs:y.logprobs}:{}},pu(v.message)&&(v.message.usage_metadata=s),v.message=new nn(Object.fromEntries(Object.entries(v.message).filter(([b])=>!b.startsWith("lc_")))),g.push(v)}return{generations:g,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,r){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&r!=="auto"){const i=fie(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),r==="none"?s+=1:typeof r=="object"&&(s+=await this.getNumTokens(r.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var s;return(s=r.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,s)=>r+s,0)}async getNumTokensFromMessages(e){let t=0,r=0,s=0;this.model==="gpt-3.5-turbo-0301"?(r=4,s=-1):(r=3,s=1);const i=await Promise.all(e.map(async a=>{var f,p,m,g,y,w;const o=await this.getNumTokens(a.content),u=await this.getNumTokens(V3(a)),l=a.name!==void 0?s+await this.getNumTokens(a.name):0;let d=o+r+u+l;const h=a;if(h._getType()==="function"&&(d-=2),(f=h.additional_kwargs)!=null&&f.function_call&&(d+=3),(p=h==null?void 0:h.additional_kwargs.function_call)!=null&&p.name&&(d+=await this.getNumTokens((m=h.additional_kwargs.function_call)==null?void 0:m.name)),(g=h.additional_kwargs.function_call)!=null&&g.arguments)try{d+=await this.getNumTokens(JSON.stringify(JSON.parse((y=h.additional_kwargs.function_call)==null?void 0:y.arguments)))}catch(v){console.error("Error parsing function arguments",v,JSON.stringify(h.additional_kwargs.function_call)),d+=await this.getNumTokens((w=h.additional_kwargs.function_call)==null?void 0:w.arguments)}return t+=d,d}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(s){throw W3(s)}})}async betaParsedCompletionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,r)}catch(s){throw W3(s)}})}_getClientOptions(e){if(!this.client){const r={baseURL:this.clientConfig.baseURL},s=lie(r),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new ht(i)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let r,s,i,a;gie(e)?(r=e.schema,s=e.name,i=e.method,a=e.includeRaw):(r=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw);let o,u;if((t==null?void 0:t.strict)!==void 0&&i==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?i===void 0&&(i="jsonSchema"):i==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),HS(r)?u=eg.fromZodSchema(r):u=new tg;else if(i==="jsonSchema")o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:r.description,schema:r,strict:t==null?void 0:t.strict}}}),HS(r)?u=eg.fromZodSchema(r):u=new tg;else{let f=s??"extract";if(HS(r)){const p=bse(r);o=this.bind({tools:[{type:"function",function:{name:f,description:p.description,parameters:p}}],tool_choice:{type:"function",function:{name:f}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),u=new M0({returnSingle:!0,keyName:f,zodSchema:r})}else{let p;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(p=r,f=r.name):(f=r.title??f,p={name:f,description:r.description??"",parameters:r}),o=this.bind({tools:[{type:"function",function:p}],tool_choice:{type:"function",function:{name:f}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),u=new M0({returnSingle:!0,keyName:f})}}if(!a)return o.pipe(u);const l=Ns.assign({parsed:(f,p)=>u.invoke(f.raw,p)}),d=Ns.assign({parsed:()=>null}),h=l.withFallbacks({fallbacks:[d]});return hs.from([{raw:o},h])}}function HS(n){return typeof(n==null?void 0:n.parse)=="function"}function gie(n){return n!==void 0&&typeof n.schema=="object"}class yie extends X3{static lc_name(){return"ChatXAI"}_llmType(){return"xai"}get lc_secrets(){return{apiKey:"XAI_API_KEY"}}constructor(e){const t=(e==null?void 0:e.apiKey)||sn("XAI_API_KEY");if(!t)throw new Error('xAI API key not found. Please set the XAI_API_KEY environment variable or provide the key into "apiKey" field.');super({...e,model:(e==null?void 0:e.model)||"grok-beta",apiKey:t,configuration:{baseURL:"https://api.x.ai/v1"}}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","xai"]})}toJSON(){const e=super.toJSON();return"kwargs"in e&&typeof e.kwargs=="object"&&e.kwargs!=null&&(delete e.kwargs.openai_api_key,delete e.kwargs.configuration),e}getLsParams(e){const t=super.getLsParams(e);return t.ls_provider="xai",t}async completionWithRetry(e,t){delete e.frequency_penalty,delete e.presence_penalty,delete e.logit_bias,delete e.functions;const r=e.messages.map(i=>i.content?i:{...i,content:""}),s={...e,messages:r};return s.stream===!0?super.completionWithRetry(s,t):super.completionWithRetry(s,t)}_convertOpenAIDeltaToBaseMessageChunk(e,t,r){var i;const s=super._convertOpenAIDeltaToBaseMessageChunk(e,t,r);return(i=t.choices[0])!=null&&i.finish_reason?s.usage_metadata=s.response_metadata.usage:(delete s.response_metadata.usage,delete s.usage_metadata),s}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const r=super._convertOpenAIChatCompletionMessageToBaseMessage(e,t);return r.additional_kwargs.reasoning_content=e.reasoning_content,r}withStructuredOutput(e,t){const r={...t};return(r==null?void 0:r.method)===void 0&&(r.method="functionCalling"),super.withStructuredOutput(e,r)}}var en=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},Tn={searchParams:"URLSearchParams"in en,iterable:"Symbol"in en&&"iterator"in Symbol,blob:"FileReader"in en&&"Blob"in en&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in en,arrayBuffer:"ArrayBuffer"in en};function wie(n){return n&&DataView.prototype.isPrototypeOf(n)}if(Tn.arrayBuffer)var vie=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],_ie=ArrayBuffer.isView||function(n){return n&&vie.indexOf(Object.prototype.toString.call(n))>-1};function Oh(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(n)||n==="")throw new TypeError('Invalid character in header field name: "'+n+'"');return n.toLowerCase()}function i1(n){return typeof n!="string"&&(n=String(n)),n}function a1(n){var e={next:function(){var t=n.shift();return{done:t===void 0,value:t}}};return Tn.iterable&&(e[Symbol.iterator]=function(){return e}),e}function kr(n){this.map={},n instanceof kr?n.forEach(function(e,t){this.append(t,e)},this):Array.isArray(n)?n.forEach(function(e){if(e.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(e){this.append(e,n[e])},this)}kr.prototype.append=function(n,e){n=Oh(n),e=i1(e);var t=this.map[n];this.map[n]=t?t+", "+e:e},kr.prototype.delete=function(n){delete this.map[Oh(n)]},kr.prototype.get=function(n){return n=Oh(n),this.has(n)?this.map[n]:null},kr.prototype.has=function(n){return this.map.hasOwnProperty(Oh(n))},kr.prototype.set=function(n,e){this.map[Oh(n)]=i1(e)},kr.prototype.forEach=function(n,e){for(var t in this.map)this.map.hasOwnProperty(t)&&n.call(e,this.map[t],t,this)},kr.prototype.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),a1(n)},kr.prototype.values=function(){var n=[];return this.forEach(function(e){n.push(e)}),a1(n)},kr.prototype.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),a1(n)},Tn.iterable&&(kr.prototype[Symbol.iterator]=kr.prototype.entries);function o1(n){if(!n._noBody){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}}function Y3(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function bie(n){var e=new FileReader,t=Y3(e);return e.readAsArrayBuffer(n),t}function Sie(n){var e=new FileReader,t=Y3(e),r=/charset=([A-Za-z0-9_-]+)/.exec(n.type),s=r?r[1]:"utf-8";return e.readAsText(n,s),t}function xie(n){for(var e=new Uint8Array(n),t=new Array(e.length),r=0;r<e.length;r++)t[r]=String.fromCharCode(e[r]);return t.join("")}function Q3(n){if(n.slice)return n.slice(0);var e=new Uint8Array(n.byteLength);return e.set(new Uint8Array(n)),e.buffer}function eU(){return this.bodyUsed=!1,this._initBody=function(n){this.bodyUsed=this.bodyUsed,this._bodyInit=n,n?typeof n=="string"?this._bodyText=n:Tn.blob&&Blob.prototype.isPrototypeOf(n)?this._bodyBlob=n:Tn.formData&&FormData.prototype.isPrototypeOf(n)?this._bodyFormData=n:Tn.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)?this._bodyText=n.toString():Tn.arrayBuffer&&Tn.blob&&wie(n)?(this._bodyArrayBuffer=Q3(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):Tn.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||_ie(n))?this._bodyArrayBuffer=Q3(n):this._bodyText=n=Object.prototype.toString.call(n):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Tn.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},Tn.blob&&(this.blob=function(){var n=o1(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var n=o1(this);return n||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(Tn.blob)return this.blob().then(bie);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var n=o1(this);if(n)return n;if(this._bodyBlob)return Sie(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(xie(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},Tn.formData&&(this.formData=function(){return this.text().then(Cie)}),this.json=function(){return this.text().then(JSON.parse)},this}var Eie=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function kie(n){var e=n.toUpperCase();return Eie.indexOf(e)>-1?e:n}function Iu(n,e){if(!(this instanceof Iu))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var t=e.body;if(n instanceof Iu){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url,this.credentials=n.credentials,e.headers||(this.headers=new kr(n.headers)),this.method=n.method,this.mode=n.mode,this.signal=n.signal,!t&&n._bodyInit!=null&&(t=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new kr(e.headers)),this.method=kie(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal||function(){if("AbortController"in en){var i=new AbortController;return i.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&t)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(t),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var r=/([?&])_=[^&]*/;if(r.test(this.url))this.url=this.url.replace(r,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Iu.prototype.clone=function(){return new Iu(this,{body:this._bodyInit})};function Cie(n){var e=new FormData;return n.trim().split("&").forEach(function(t){if(t){var r=t.split("="),s=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(s),decodeURIComponent(i))}}),e}function Pie(n){var e=new kr,t=n.replace(/\r?\n[\t ]+/g," ");return t.split("\r").map(function(r){return r.indexOf(`
`)===0?r.substr(1,r.length):r}).forEach(function(r){var s=r.split(":"),i=s.shift().trim();if(i){var a=s.join(":").trim();try{e.append(i,a)}catch(o){console.warn("Response "+o.message)}}}),e}eU.call(Iu.prototype);function sa(n,e){if(!(this instanceof sa))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new kr(e.headers),this.url=e.url||"",this._initBody(n)}eU.call(sa.prototype),sa.prototype.clone=function(){return new sa(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new kr(this.headers),url:this.url})},sa.error=function(){var n=new sa(null,{status:200,statusText:""});return n.ok=!1,n.status=0,n.type="error",n};var Aie=[301,302,303,307,308];sa.redirect=function(n,e){if(Aie.indexOf(e)===-1)throw new RangeError("Invalid status code");return new sa(null,{status:e,headers:{location:n}})};var Ou=en.DOMException;try{new Ou}catch{Ou=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},Ou.prototype=Object.create(Error.prototype),Ou.prototype.constructor=Ou}function tU(n,e){return new Promise(function(t,r){var s=new Iu(n,e);if(s.signal&&s.signal.aborted)return r(new Ou("Aborted","AbortError"));var i=new XMLHttpRequest;function a(){i.abort()}i.onload=function(){var l={statusText:i.statusText,headers:Pie(i.getAllResponseHeaders()||"")};s.url.indexOf("file://")===0&&(i.status<200||i.status>599)?l.status=200:l.status=i.status,l.url="responseURL"in i?i.responseURL:l.headers.get("X-Request-URL");var d="response"in i?i.response:i.responseText;setTimeout(function(){t(new sa(d,l))},0)},i.onerror=function(){setTimeout(function(){r(new TypeError("Network request failed"))},0)},i.ontimeout=function(){setTimeout(function(){r(new TypeError("Network request timed out"))},0)},i.onabort=function(){setTimeout(function(){r(new Ou("Aborted","AbortError"))},0)};function o(l){try{return l===""&&en.location.href?en.location.href:l}catch{return l}}if(i.open(s.method,o(s.url),!0),s.credentials==="include"?i.withCredentials=!0:s.credentials==="omit"&&(i.withCredentials=!1),"responseType"in i&&(Tn.blob?i.responseType="blob":Tn.arrayBuffer&&(i.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof kr||en.Headers&&e.headers instanceof en.Headers)){var u=[];Object.getOwnPropertyNames(e.headers).forEach(function(l){u.push(Oh(l)),i.setRequestHeader(l,i1(e.headers[l]))}),s.headers.forEach(function(l,d){u.indexOf(d)===-1&&i.setRequestHeader(d,l)})}else s.headers.forEach(function(l,d){i.setRequestHeader(d,l)});s.signal&&(s.signal.addEventListener("abort",a),i.onreadystatechange=function(){i.readyState===4&&s.signal.removeEventListener("abort",a)}),i.send(typeof s._bodyInit>"u"?null:s._bodyInit)})}tU.polyfill=!0,en.fetch||(en.fetch=tU,en.Headers=kr,en.Request=Iu,en.Response=sa);const Tie="0.5.14",rU="11434",nU=`http://127.0.0.1:${rU}`;var Iie=Object.defineProperty,Oie=(n,e,t)=>e in n?Iie(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,c1=(n,e,t)=>(Oie(n,typeof e!="symbol"?e+"":e,t),t);class u1 extends Error{constructor(e,t){super(e),this.error=e,this.status_code=t,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,u1)}}class Rie{constructor(e,t,r){c1(this,"abortController"),c1(this,"itr"),c1(this,"doneCallback"),this.abortController=e,this.itr=t,this.doneCallback=r}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(const e of this.itr){if("error"in e)throw new Error(e.error);if(yield e,e.done||e.status==="success"){this.doneCallback();return}}throw new Error("Did not receive done or success response in stream.")}}const l1=async n=>{var r;if(n.ok)return;let e=`Error ${n.status}: ${n.statusText}`,t=null;if((r=n.headers.get("content-type"))!=null&&r.includes("application/json"))try{t=await n.json(),e=t.error||e}catch{console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),e=await n.text()||e}catch{console.log("Failed to get text from error response")}throw new u1(e,n.status)};function Mie(){var n;if(typeof window<"u"&&window.navigator){const e=navigator;return"userAgentData"in e&&((n=e.userAgentData)!=null&&n.platform)?`${e.userAgentData.platform.toLowerCase()} Browser/${navigator.userAgent};`:navigator.platform?`${navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:`unknown Browser/${navigator.userAgent};`}else if(typeof process<"u")return`${process.arch} ${process.platform} Node.js/${process.version}`;return""}function $ie(n){if(n instanceof Headers){const e={};return n.forEach((t,r)=>{e[r]=t}),e}else return Array.isArray(n)?Object.fromEntries(n):n||{}}const d1=async(n,e,t={})=>{const r={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/${Tie} (${Mie()})`};t.headers=$ie(t.headers);const s=Object.fromEntries(Object.entries(t.headers).filter(([i])=>!Object.keys(r).some(a=>a.toLowerCase()===i.toLowerCase())));return t.headers={...r,...s},n(e,t)},sU=async(n,e,t)=>{const r=await d1(n,e,{headers:t==null?void 0:t.headers});return await l1(r),r},Rh=async(n,e,t,r)=>{const i=(o=>o!==null&&typeof o=="object"&&!Array.isArray(o))(t)?JSON.stringify(t):t,a=await d1(n,e,{method:"POST",body:i,signal:r==null?void 0:r.signal,headers:r==null?void 0:r.headers});return await l1(a),a},Nie=async(n,e,t,r)=>{const s=await d1(n,e,{method:"DELETE",body:JSON.stringify(t),headers:r==null?void 0:r.headers});return await l1(s),s},Fie=async function*(n){const e=new TextDecoder("utf-8");let t="";const r=n.getReader();for(;;){const{done:s,value:i}=await r.read();if(s)break;t+=e.decode(i);const a=t.split(`
`);t=a.pop()??"";for(const o of a)try{yield JSON.parse(o)}catch{console.warn("invalid json: ",o)}}for(const s of t.split(`
`).filter(i=>i!==""))try{yield JSON.parse(s)}catch{console.warn("invalid json: ",s)}},Lie=n=>{if(!n)return nU;let e=n.includes("://");n.startsWith(":")&&(n=`http://127.0.0.1${n}`,e=!0),e||(n=`http://${n}`);const t=new URL(n);let r=t.port;r||(e?r=t.protocol==="https:"?"443":"80":r=rU);let s=`${t.protocol}//${t.hostname}:${r}${t.pathname}`;return s.endsWith("/")&&(s=s.slice(0,-1)),s};var jie=Object.defineProperty,Die=(n,e,t)=>e in n?jie(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,h1=(n,e,t)=>(Die(n,typeof e!="symbol"?e+"":e,t),t);let iU=class{constructor(e){h1(this,"config"),h1(this,"fetch"),h1(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:e==null?void 0:e.headers},e!=null&&e.proxy||(this.config.host=Lie((e==null?void 0:e.host)??nU)),this.fetch=(e==null?void 0:e.fetch)??fetch}abort(){for(const e of this.ongoingStreamedRequests)e.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(e,t){t.stream=t.stream??!1;const r=`${this.config.host}/api/${e}`;if(t.stream){const i=new AbortController,a=await Rh(this.fetch,r,t,{signal:i.signal,headers:this.config.headers});if(!a.body)throw new Error("Missing body");const o=Fie(a.body),u=new Rie(i,o,()=>{const l=this.ongoingStreamedRequests.indexOf(u);l>-1&&this.ongoingStreamedRequests.splice(l,1)});return this.ongoingStreamedRequests.push(u),u}return await(await Rh(this.fetch,r,t,{headers:this.config.headers})).json()}async encodeImage(e){if(typeof e!="string"){const t=new Uint8Array(e);let r="";const s=t.byteLength;for(let i=0;i<s;i++)r+=String.fromCharCode(t[i]);return btoa(r)}return e}async generate(e){return e.images&&(e.images=await Promise.all(e.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",e)}async chat(e){if(e.messages)for(const t of e.messages)t.images&&(t.images=await Promise.all(t.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",e)}async create(e){return this.processStreamableRequest("create",{...e})}async pull(e){return this.processStreamableRequest("pull",{name:e.model,stream:e.stream,insecure:e.insecure})}async push(e){return this.processStreamableRequest("push",{name:e.model,stream:e.stream,insecure:e.insecure})}async delete(e){return await Nie(this.fetch,`${this.config.host}/api/delete`,{name:e.model},{headers:this.config.headers}),{status:"success"}}async copy(e){return await Rh(this.fetch,`${this.config.host}/api/copy`,{...e},{headers:this.config.headers}),{status:"success"}}async list(){return await(await sU(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers})).json()}async show(e){return await(await Rh(this.fetch,`${this.config.host}/api/show`,{...e},{headers:this.config.headers})).json()}async embed(e){return await(await Rh(this.fetch,`${this.config.host}/api/embed`,{...e},{headers:this.config.headers})).json()}async embeddings(e){return await(await Rh(this.fetch,`${this.config.host}/api/embeddings`,{...e},{headers:this.config.headers})).json()}async ps(){return await(await sU(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers})).json()}};new iU;function aU(n,e){var t;return new wr({content:n.content??"",tool_call_chunks:(t=n.tool_calls)==null?void 0:t.map(r=>({name:r.function.name,args:JSON.stringify(r.function.arguments),type:"tool_call_chunk",index:0,id:Sn()})),response_metadata:e==null?void 0:e.responseMetadata,usage_metadata:e==null?void 0:e.usageMetadata})}function oU(n){const e=n.match(/^data:.*?;base64,(.*)$/);return e?e[1]:""}function Bie(n){var s,i,a;if(typeof n.content=="string")return[{role:"assistant",content:n.content}];const t=n.content.filter(o=>o.type==="text"&&typeof o.text=="string").map(o=>({role:"assistant",content:o.text}));let r;if(n.content.find(o=>o.type==="tool_use")&&((s=n.tool_calls)!=null&&s.length)){const o=(i=n.tool_calls)==null?void 0:i.map(u=>({id:u.id,type:"function",function:{name:u.name,arguments:u.args}}));o&&(r={role:"assistant",tool_calls:o,content:""})}else if(n.content.find(o=>o.type==="tool_use")&&!((a=n.tool_calls)!=null&&a.length))throw new Error("'tool_use' content type is not supported without tool calls.");return[...t,...r?[r]:[]]}function Uie(n){return typeof n.content=="string"?[{role:"user",content:n.content}]:n.content.map(e=>{if(e.type==="text")return{role:"user",content:e.text};if(e.type==="image_url"){if(typeof e.image_url=="string")return{role:"user",content:"",images:[oU(e.image_url)]};if(e.image_url.url&&typeof e.image_url.url=="string")return{role:"user",content:"",images:[oU(e.image_url.url)]}}throw new Error(`Unsupported content type: ${e.type}`)})}function qie(n){if(typeof n.content=="string")return[{role:"system",content:n.content}];if(n.content.every(e=>e.type==="text"&&typeof e.text=="string"))return n.content.map(e=>({role:"system",content:e.text}));throw new Error(`Unsupported content type(s): ${n.content.map(e=>e.type).join(", ")}`)}function Hie(n){if(typeof n.content!="string")throw new Error("Non string tool message content is not supported");return[{role:"tool",content:n.content}]}function Kie(n){return n.flatMap(e=>{if(["human","generic"].includes(e._getType()))return Uie(e);if(e._getType()==="ai")return Bie(e);if(e._getType()==="system")return qie(e);if(e._getType()==="tool")return Hie(e);throw new Error(`Unsupported message type: ${e._getType()}`)})}class Wie extends Fs{static lc_name(){return"ChatOllama"}constructor(e){super(e??{}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"llama3"}),Object.defineProperty(this,"numa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numCtx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numBatch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mainGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowVram",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"f16Kv",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitsAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"vocabOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMmap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMlock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"embeddingOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numThread",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numKeep",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"seed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numPredict",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tfsZ",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"typicalP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatLastN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatTau",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatEta",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"penalizeNewline",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"format",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keepAlive",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkOrPullModel",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:"http://127.0.0.1:11434"}),this.client=new iU({host:e==null?void 0:e.baseUrl,headers:e==null?void 0:e.headers}),this.baseUrl=(e==null?void 0:e.baseUrl)??this.baseUrl,this.model=(e==null?void 0:e.model)??this.model,this.numa=e==null?void 0:e.numa,this.numCtx=e==null?void 0:e.numCtx,this.numBatch=e==null?void 0:e.numBatch,this.numGpu=e==null?void 0:e.numGpu,this.mainGpu=e==null?void 0:e.mainGpu,this.lowVram=e==null?void 0:e.lowVram,this.f16Kv=e==null?void 0:e.f16Kv,this.logitsAll=e==null?void 0:e.logitsAll,this.vocabOnly=e==null?void 0:e.vocabOnly,this.useMmap=e==null?void 0:e.useMmap,this.useMlock=e==null?void 0:e.useMlock,this.embeddingOnly=e==null?void 0:e.embeddingOnly,this.numThread=e==null?void 0:e.numThread,this.numKeep=e==null?void 0:e.numKeep,this.seed=e==null?void 0:e.seed,this.numPredict=e==null?void 0:e.numPredict,this.topK=e==null?void 0:e.topK,this.topP=e==null?void 0:e.topP,this.tfsZ=e==null?void 0:e.tfsZ,this.typicalP=e==null?void 0:e.typicalP,this.repeatLastN=e==null?void 0:e.repeatLastN,this.temperature=e==null?void 0:e.temperature,this.repeatPenalty=e==null?void 0:e.repeatPenalty,this.presencePenalty=e==null?void 0:e.presencePenalty,this.frequencyPenalty=e==null?void 0:e.frequencyPenalty,this.mirostat=e==null?void 0:e.mirostat,this.mirostatTau=e==null?void 0:e.mirostatTau,this.mirostatEta=e==null?void 0:e.mirostatEta,this.penalizeNewline=e==null?void 0:e.penalizeNewline,this.streaming=e==null?void 0:e.streaming,this.format=e==null?void 0:e.format,this.keepAlive=e==null?void 0:e.keepAlive,this.checkOrPullModel=(e==null?void 0:e.checkOrPullModel)??this.checkOrPullModel}_llmType(){return"ollama"}async pull(e,t){const{stream:r,insecure:s,logProgress:i}={stream:!0,...t};if(r)for await(const a of await this.client.pull({model:e,insecure:s,stream:r}))i&&console.log(a);else{const a=await this.client.pull({model:e,insecure:s});i&&console.log(a)}}bindTools(e,t){return this.bind({tools:e.map(r=>PD(r)),...t})}getLsParams(e){var r,s;const t=this.invocationParams(e);return{ls_provider:"ollama",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:((r=t.options)==null?void 0:r.temperature)??void 0,ls_max_tokens:((s=t.options)==null?void 0:s.num_predict)??void 0,ls_stop:e.stop}}invocationParams(e){var t;if(e!=null&&e.tool_choice)throw new Error("Tool choice is not supported for ChatOllama.");return{model:this.model,format:(e==null?void 0:e.format)??this.format,keep_alive:this.keepAlive,options:{numa:this.numa,num_ctx:this.numCtx,num_batch:this.numBatch,num_gpu:this.numGpu,main_gpu:this.mainGpu,low_vram:this.lowVram,f16_kv:this.f16Kv,logits_all:this.logitsAll,vocab_only:this.vocabOnly,use_mmap:this.useMmap,use_mlock:this.useMlock,embedding_only:this.embeddingOnly,num_thread:this.numThread,num_keep:this.numKeep,seed:this.seed,num_predict:this.numPredict,top_k:this.topK,top_p:this.topP,tfs_z:this.tfsZ,typical_p:this.typicalP,repeat_last_n:this.repeatLastN,temperature:this.temperature,repeat_penalty:this.repeatPenalty,presence_penalty:this.presencePenalty,frequency_penalty:this.frequencyPenalty,mirostat:this.mirostat,mirostat_tau:this.mirostatTau,mirostat_eta:this.mirostatEta,penalize_newline:this.penalizeNewline,stop:e==null?void 0:e.stop},tools:(t=e==null?void 0:e.tools)!=null&&t.length?e.tools.map(r=>PD(r)):void 0}}async checkModelExistsOnMachine(e){const{models:t}=await this.client.list();return!!t.find(r=>r.name===e||r.name===`${e}:latest`)}async _generate(e,t,r){this.checkOrPullModel&&(await this.checkModelExistsOnMachine(this.model)||await this.pull(this.model,{logProgress:!0}));let s;for await(const a of this._streamResponseChunks(e,t,r))s?s=Ms(s,a.message):s=a.message;const i=new nn({id:s==null?void 0:s.id,content:(s==null?void 0:s.content)??"",tool_calls:s==null?void 0:s.tool_calls,response_metadata:s==null?void 0:s.response_metadata,usage_metadata:s==null?void 0:s.usage_metadata});return{generations:[{text:typeof i.content=="string"?i.content:"",message:i}]}}async*_streamResponseChunks(e,t,r){var l;this.checkOrPullModel&&(await this.checkModelExistsOnMachine(this.model)||await this.pull(this.model,{logProgress:!0}));const s=this.invocationParams(t),i=Kie(e),a={input_tokens:0,output_tokens:0,total_tokens:0};if(s.tools&&s.tools.length>0){const d=await this.client.chat({...s,messages:i,stream:!1}),{message:h,...f}=d;return a.input_tokens+=f.prompt_eval_count??0,a.output_tokens+=f.eval_count??0,a.total_tokens=a.input_tokens+a.output_tokens,yield new ds({text:h.content,message:aU(h,{responseMetadata:f,usageMetadata:a})}),r==null?void 0:r.handleLLMNewToken(h.content)}const o=await this.client.chat({...s,messages:i,stream:!0});let u;for await(const d of o){(l=t.signal)!=null&&l.aborted&&this.client.abort();const{message:h,...f}=d;a.input_tokens+=f.prompt_eval_count??0,a.output_tokens+=f.eval_count??0,a.total_tokens=a.input_tokens+a.output_tokens,u=f,yield new ds({text:h.content??"",message:aU(h)}),await(r==null?void 0:r.handleLLMNewToken(h.content??""))}yield new ds({text:"",message:new wr({content:"",response_metadata:u,usage_metadata:a})})}withStructuredOutput(e,t){if((t==null?void 0:t.method)===void 0||(t==null?void 0:t.method)==="jsonSchema"){const r=Qm(e),s=r?$a(e):e,i=this.bind({format:s}),a=r?eg.fromZodSchema(e):new tg;if(!(t!=null&&t.includeRaw))return i.pipe(a);const o=Ns.assign({parsed:(d,h)=>a.invoke(d.raw,h)}),u=Ns.assign({parsed:()=>null}),l=o.withFallbacks({fallbacks:[u]});return hs.from([{raw:i},l])}else return super.withStructuredOutput(e,t)}}class zie extends X3{static lc_name(){return"ChatDeepSeek"}_llmType(){return"deepseek"}get lc_secrets(){return{apiKey:"DEEPSEEK_API_KEY"}}constructor(e){const t=(e==null?void 0:e.apiKey)||sn("DEEPSEEK_API_KEY");if(!t)throw new Error('Deepseek API key not found. Please set the DEEPSEEK_API_KEY environment variable or pass the key into "apiKey" field.');super({...e,apiKey:t,configuration:{baseURL:"https://api.deepseek.com",...e==null?void 0:e.configuration}}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","deepseek"]})}_convertOpenAIDeltaToBaseMessageChunk(e,t,r){const s=super._convertOpenAIDeltaToBaseMessageChunk(e,t,r);return s.additional_kwargs.reasoning_content=e.reasoning_content,s}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const r=super._convertOpenAIChatCompletionMessageToBaseMessage(e,t);return r.additional_kwargs.reasoning_content=e.reasoning_content,r}withStructuredOutput(e,t){const r={...t};return(r==null?void 0:r.method)===void 0&&(r.method="functionCalling"),super.withStructuredOutput(e,r)}}const Bg=1024*4;function Vie(n){return n.startsWith("openai/o")||n.startsWith("o")}function cU(n,e){var s,i;const t={model:e.modelName,apiKey:n.apiKey},r=n.baseUrl&&n.baseUrl.trim()!==""?n.baseUrl:"http://llm.nxtscape.ai/";return t.configuration={baseURL:r},n.apiKey&&(t.apiKey=n.apiKey),Vie(e.modelName)?t.modelKwargs={max_completion_tokens:Bg}:(t.topP=((s=e.parameters)==null?void 0:s.topP)??.1,t.temperature=((i=e.parameters)==null?void 0:i.temperature)??.1,t.maxTokens=Bg),console.log("baseUrl",n.baseUrl),new Ree(t)}function f1(n,e){var s,i;const t=((s=e.parameters)==null?void 0:s.temperature)??.1,r=((i=e.parameters)==null?void 0:i.topP)??.1;switch(e.provider){case ur.OpenAI:return cU(n,e);case ur.Anthropic:{const a={model:e.modelName,apiKey:n.apiKey,baseUrl:n.baseUrl??"http://llm.nxtscape.ai",maxTokens:Bg,temperature:t,topP:r,clientOptions:{}};return new Ete(a)}case ur.DeepSeek:{const a={model:e.modelName,apiKey:n.apiKey,temperature:t,topP:r};return new zie(a)}case ur.Gemini:{const a={model:e.modelName,apiKey:n.apiKey,temperature:t,topP:r};return new dre(a)}case ur.Grok:{const a={model:e.modelName,apiKey:n.apiKey,temperature:t,topP:r,maxTokens:Bg,configuration:{}};return new yie(a)}case ur.Ollama:{const a={model:e.modelName,apiKey:n.apiKey===""?"ollama":n.apiKey,baseUrl:n.baseUrl??"http://localhost:11434",topP:r,temperature:t,maxTokens:Bg,numCtx:64e3};return new Wie(a)}default:return cU(n,e)}}const Cr={generalSettings:{maxSteps:100,maxActionsPerStep:5,maxFailures:3,useVision:!0,useVisionForPlanner:!0,planningInterval:3},llmProviders:{openai:{name:"OpenAI",apiKey:"sk-nT9x0q4OnypBj7wPczNeSA",models:["gpt-4o"]}},modelSelections:{planner:{description:"Develops and refines strategies to complete tasks",provider:"openai",modelName:"gpt-4o",parameters:{temperature:.01,topP:.001}},navigator:{description:"Navigates websites and performs actions",provider:"openai",modelName:"gpt-4o",parameters:{temperature:0,topP:.001}},validator:{description:"Checks if tasks are completed successfully",provider:"openai",modelName:"gpt-4o",parameters:{temperature:0,topP:.001}}}};var xi,Y=typeof window<"u"?window:void 0,Xn=typeof globalThis<"u"?globalThis:Y,uU=Array.prototype,lU=uU.forEach,dU=uU.indexOf,ws=Xn==null?void 0:Xn.navigator,Se=Xn==null?void 0:Xn.document,Yn=Xn==null?void 0:Xn.location,p1=Xn==null?void 0:Xn.fetch,m1=Xn!=null&&Xn.XMLHttpRequest&&"withCredentials"in new Xn.XMLHttpRequest?Xn.XMLHttpRequest:void 0,hU=Xn==null?void 0:Xn.AbortController,Qn=ws==null?void 0:ws.userAgent,Ge=Y??{},za={DEBUG:!1,LIB_VERSION:"1.242.2"},g1="$copy_autocapture",Gie=["$snapshot","$pageview","$pageleave","$set","survey dismissed","survey sent","survey shown","$identify","$groupidentify","$create_alias","$$client_ingestion_warning","$web_experiment_applied","$feature_enrollment_update","$feature_flag_called"];(function(n){n.GZipJS="gzip-js",n.Base64="base64"})(xi||(xi={}));var Zie=["fatal","error","warning","log","info","debug"];function nt(n,e){return n.indexOf(e)!==-1}var KS=function(n){return n.trim()},y1=function(n){return n.replace(/^\$/,"")},Jie=Array.isArray,fU=Object.prototype,pU=fU.hasOwnProperty,WS=fU.toString,sr=Jie||function(n){return WS.call(n)==="[object Array]"},Us=n=>typeof n=="function",ir=n=>n===Object(n)&&!sr(n),Mh=n=>{if(ir(n)){for(var e in n)if(pU.call(n,e))return!1;return!0}return!1},we=n=>n===void 0,fr=n=>WS.call(n)=="[object String]",w1=n=>fr(n)&&n.trim().length===0,tc=n=>n===null,kt=n=>we(n)||tc(n),ln=n=>WS.call(n)=="[object Number]",Va=n=>WS.call(n)==="[object Boolean]",Xie=n=>n instanceof FormData,Yie=n=>nt(Gie,n),mU=n=>{var e={t:function(t){if(Y&&(za.DEBUG||Ge.POSTHOG_DEBUG)&&!we(Y.console)&&Y.console){for(var r=("__rrweb_original__"in Y.console[t])?Y.console[t].__rrweb_original__:Y.console[t],s=arguments.length,i=new Array(s>1?s-1:0),a=1;a<s;a++)i[a-1]=arguments[a];r(n,...i)}},info:function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];e.t("log",...r)},warn:function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];e.t("warn",...r)},error:function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];e.t("error",...r)},critical:function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];console.error(n,...r)},uninitializedWarning:t=>{e.error("You must initialize PostHog before calling "+t)},createLogger:t=>mU(n+" "+t)};return e},Ce=mU("[PostHog.js]"),dn=Ce.createLogger,Qie=dn("[ExternalScriptsLoader]"),gU=(n,e,t)=>{if(n.config.disable_external_dependency_loading)return Qie.warn(e+" was requested but loading of external scripts is disabled."),t("Loading of external scripts is disabled");var r=Se==null?void 0:Se.querySelectorAll("script");if(r){for(var s=0;s<r.length;s++)if(r[s].src===e)return t()}var i=()=>{if(!Se)return t("document not found");var a=Se.createElement("script");if(a.type="text/javascript",a.crossOrigin="anonymous",a.src=e,a.onload=l=>t(void 0,l),a.onerror=l=>t(l),n.config.prepare_external_dependency_script&&(a=n.config.prepare_external_dependency_script(a)),!a)return t("prepare_external_dependency_script returned null");var o,u=Se.querySelectorAll("body > script");u.length>0?(o=u[0].parentNode)==null||o.insertBefore(a,u[0]):Se.body.appendChild(a)};Se!=null&&Se.body?i():Se==null||Se.addEventListener("DOMContentLoaded",i)};function _e(){return _e=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},_e.apply(this,arguments)}function yU(n,e){if(n==null)return{};var t,r,s={},i=Object.keys(n);for(r=0;r<i.length;r++)t=i[r],e.indexOf(t)>=0||(s[t]=n[t]);return s}Ge.__PosthogExtensions__=Ge.__PosthogExtensions__||{},Ge.__PosthogExtensions__.loadExternalDependency=(n,e,t)=>{var r="/static/"+e+".js?v="+n.version;if(e==="remote-config"&&(r="/array/"+n.config.token+"/config.js"),e==="toolbar"){var s=3e5;r=r+"&t="+Math.floor(Date.now()/s)*s}var i=n.requestRouter.endpointFor("assets",r);gU(n,i,t)},Ge.__PosthogExtensions__.loadSiteApp=(n,e,t)=>{var r=n.requestRouter.endpointFor("api",e);gU(n,r,t)};var zS={};function rc(n,e,t){if(sr(n)){if(lU&&n.forEach===lU)n.forEach(e,t);else if("length"in n&&n.length===+n.length){for(var r=0,s=n.length;r<s;r++)if(r in n&&e.call(t,n[r],r)===zS)return}}}function jt(n,e,t){if(!kt(n)){if(sr(n))return rc(n,e,t);if(Xie(n)){for(var r of n.entries())if(e.call(t,r[1],r[0])===zS)return}else for(var s in n)if(pU.call(n,s)&&e.call(t,n[s],s)===zS)return}}var pr=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return rc(t,function(s){for(var i in s)s[i]!==void 0&&(n[i]=s[i])}),n},VS=function(n){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];return rc(t,function(s){rc(s,function(i){n.push(i)})}),n};function GS(n){for(var e=Object.keys(n),t=e.length,r=new Array(t);t--;)r[t]=[e[t],n[e[t]]];return r}var wU=function(n){try{return n()}catch{return}},eae=function(n){return function(){try{for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(this,t)}catch(s){Ce.critical("Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A."),Ce.critical(s)}}},v1=function(n){var e={};return jt(n,function(t,r){(fr(t)&&t.length>0||ln(t))&&(e[r]=t)}),e};function tae(n,e){return t=n,r=i=>fr(i)&&!tc(e)?i.slice(0,e):i,s=new Set,function i(a,o){return a!==Object(a)?r?r(a,o):a:s.has(a)?void 0:(s.add(a),sr(a)?(u=[],rc(a,l=>{u.push(i(l))})):(u={},jt(a,(l,d)=>{s.has(l)||(u[d]=i(l,d))})),u);var u}(t);var t,r,s}var rae=["herokuapp.com","vercel.app","netlify.app"];function nae(n){var e=n==null?void 0:n.hostname;if(!fr(e))return!1;var t=e.split(".").slice(-2).join(".");for(var r of rae)if(t===r)return!1;return!0}function vU(n,e){for(var t=0;t<n.length;t++)if(e(n[t]))return n[t]}function rr(n,e,t,r){var{capture:s=!1,passive:i=!0}=r??{};n==null||n.addEventListener(e,t,{capture:s,passive:i})}var _U="$people_distinct_id",Ug="__alias",qg="__timers",bU="$autocapture_disabled_server_side",_1="$heatmaps_enabled_server_side",SU="$exception_capture_enabled_server_side",xU="$web_vitals_enabled_server_side",EU="$dead_clicks_enabled_server_side",kU="$web_vitals_allowed_metrics",b1="$session_recording_enabled_server_side",CU="$console_log_recording_enabled_server_side",PU="$session_recording_network_payload_capture",AU="$session_recording_masking",TU="$session_recording_canvas_recording",IU="$replay_sample_rate",OU="$replay_minimum_duration",RU="$replay_script_config",ZS="$sesid",Hg="$session_is_sampled",S1="$session_recording_url_trigger_activated_session",x1="$session_recording_event_trigger_activated_session",$h="$enabled_feature_flags",JS="$early_access_features",E1="$feature_flag_details",Kg="$stored_person_properties",Ru="$stored_group_properties",k1="$surveys",XS="$surveys_activated",YS="$flag_call_reported",Ga="$user_state",C1="$client_session_props",P1="$capture_rate_limit",A1="$initial_campaign_params",T1="$initial_referrer_info",QS="$initial_person_info",ex="$epp",MU="__POSTHOG_TOOLBAR__",$U="$posthog_cookieless",sae=[_U,Ug,"__cmpns",qg,b1,_1,ZS,$h,Ga,JS,E1,Ru,Kg,k1,YS,C1,P1,A1,T1,ex,QS];function NU(n){return n instanceof Element&&(n.id===MU||!(n.closest==null||!n.closest(".toolbar-global-fade-container")))}function tx(n){return!!n&&n.nodeType===1}function nc(n,e){return!!n&&!!n.tagName&&n.tagName.toLowerCase()===e.toLowerCase()}function FU(n){return!!n&&n.nodeType===3}function LU(n){return!!n&&n.nodeType===11}function I1(n){return n?KS(n).split(/\s+/):[]}function jU(n){var e=Y==null?void 0:Y.location.href;return!!(e&&n&&n.some(t=>e.match(t)))}function rx(n){var e="";switch(typeof n.className){case"string":e=n.className;break;case"object":e=(n.className&&"baseVal"in n.className?n.className.baseVal:null)||n.getAttribute("class")||"";break;default:e=""}return I1(e)}function DU(n){return kt(n)?null:KS(n).split(/(\s+)/).filter(e=>Nh(e)).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)}function nx(n){var e="";return R1(n)&&!qU(n)&&n.childNodes&&n.childNodes.length&&jt(n.childNodes,function(t){var r;FU(t)&&t.textContent&&(e+=(r=DU(t.textContent))!==null&&r!==void 0?r:"")}),KS(e)}function BU(n){return we(n.target)?n.srcElement||null:(e=n.target)!=null&&e.shadowRoot?n.composedPath()[0]||null:n.target||null;var e}var O1=["a","button","form","input","select","textarea","label"];function UU(n){var e=n.parentNode;return!(!e||!tx(e))&&e}function iae(n,e,t,r,s){var i,a,o;if(t===void 0&&(t=void 0),!Y||!n||nc(n,"html")||!tx(n)||(i=t)!=null&&i.url_allowlist&&!jU(t.url_allowlist)||(a=t)!=null&&a.url_ignorelist&&jU(t.url_ignorelist))return!1;if((o=t)!=null&&o.dom_event_allowlist){var u=t.dom_event_allowlist;if(u&&!u.some(y=>e.type===y))return!1}for(var l=!1,d=[n],h=!0,f=n;f.parentNode&&!nc(f,"body");)if(LU(f.parentNode))d.push(f.parentNode.host),f=f.parentNode.host;else{if(!(h=UU(f)))break;if(r||O1.indexOf(h.tagName.toLowerCase())>-1)l=!0;else{var p=Y.getComputedStyle(h);p&&p.getPropertyValue("cursor")==="pointer"&&(l=!0)}d.push(h),f=h}if(!function(y,w){var v=w==null?void 0:w.element_allowlist;if(we(v))return!0;var b=function(k){if(v.some(C=>k.tagName.toLowerCase()===C))return{v:!0}};for(var S of y){var P=b(S);if(typeof P=="object")return P.v}return!1}(d,t)||!function(y,w){var v=w==null?void 0:w.css_selector_allowlist;if(we(v))return!0;var b=function(k){if(v.some(C=>k.matches(C)))return{v:!0}};for(var S of y){var P=b(S);if(typeof P=="object")return P.v}return!1}(d,t))return!1;var m=Y.getComputedStyle(n);if(m&&m.getPropertyValue("cursor")==="pointer"&&e.type==="click")return!0;var g=n.tagName.toLowerCase();switch(g){case"html":return!1;case"form":return(s||["submit"]).indexOf(e.type)>=0;case"input":case"select":case"textarea":return(s||["change","click"]).indexOf(e.type)>=0;default:return l?(s||["click"]).indexOf(e.type)>=0:(s||["click"]).indexOf(e.type)>=0&&(O1.indexOf(g)>-1||n.getAttribute("contenteditable")==="true")}}function R1(n){for(var e=n;e.parentNode&&!nc(e,"body");e=e.parentNode){var t=rx(e);if(nt(t,"ph-sensitive")||nt(t,"ph-no-capture"))return!1}if(nt(rx(n),"ph-include"))return!0;var r=n.type||"";if(fr(r))switch(r.toLowerCase()){case"hidden":case"password":return!1}var s=n.name||n.id||"";return!(fr(s)&&/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(s.replace(/[^a-zA-Z0-9]/g,"")))}function qU(n){return!!(nc(n,"input")&&!["button","checkbox","submit","reset"].includes(n.type)||nc(n,"select")||nc(n,"textarea")||n.getAttribute("contenteditable")==="true")}var HU="(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11})",aae=new RegExp("^(?:"+HU+")$"),oae=new RegExp(HU),KU="\\d{3}-?\\d{2}-?\\d{4}",cae=new RegExp("^("+KU+")$"),uae=new RegExp("("+KU+")");function Nh(n,e){return e===void 0&&(e=!0),!(kt(n)||fr(n)&&(n=KS(n),(e?aae:oae).test((n||"").replace(/[- ]/g,""))||(e?cae:uae).test(n)))}function WU(n){var e=nx(n);return Nh(e=(e+" "+zU(n)).trim())?e:""}function zU(n){var e="";return n&&n.childNodes&&n.childNodes.length&&jt(n.childNodes,function(t){var r;if(t&&((r=t.tagName)==null?void 0:r.toLowerCase())==="span")try{var s=nx(t);e=(e+" "+s).trim(),t.childNodes&&t.childNodes.length&&(e=(e+" "+zU(t)).trim())}catch(i){Ce.error("[AutoCapture]",i)}}),e}function lae(n){return function(e){var t=e.map(r=>{var s,i,a="";if(r.tag_name&&(a+=r.tag_name),r.attr_class)for(var o of(r.attr_class.sort(),r.attr_class))a+="."+o.replace(/"/g,"");var u=_e({},r.text?{text:r.text}:{},{"nth-child":(s=r.nth_child)!==null&&s!==void 0?s:0,"nth-of-type":(i=r.nth_of_type)!==null&&i!==void 0?i:0},r.href?{href:r.href}:{},r.attr_id?{attr_id:r.attr_id}:{},r.attributes),l={};return GS(u).sort((d,h)=>{var[f]=d,[p]=h;return f.localeCompare(p)}).forEach(d=>{var[h,f]=d;return l[VU(h.toString())]=VU(f.toString())}),a+=":",a+=GS(l).map(d=>{var[h,f]=d;return h+'="'+f+'"'}).join("")});return t.join(";")}(function(e){return e.map(t=>{var r,s,i={text:(r=t.$el_text)==null?void 0:r.slice(0,400),tag_name:t.tag_name,href:(s=t.attr__href)==null?void 0:s.slice(0,2048),attr_class:dae(t),attr_id:t.attr__id,nth_child:t.nth_child,nth_of_type:t.nth_of_type,attributes:{}};return GS(t).filter(a=>{var[o]=a;return o.indexOf("attr__")===0}).forEach(a=>{var[o,u]=a;return i.attributes[o]=u}),i})}(n))}function VU(n){return n.replace(/"|\\"/g,'\\"')}function dae(n){var e=n.attr__class;return e?sr(e)?e:I1(e):void 0}class GU{constructor(){this.clicks=[]}isRageClick(e,t,r){var s=this.clicks[this.clicks.length-1];if(s&&Math.abs(e-s.x)+Math.abs(t-s.y)<30&&r-s.timestamp<1e3){if(this.clicks.push({x:e,y:t,timestamp:r}),this.clicks.length===3)return!0}else this.clicks=[{x:e,y:t,timestamp:r}];return!1}}var hae=["localhost","127.0.0.1"],Fh=n=>{var e=Se==null?void 0:Se.createElement("a");return we(e)?null:(e.href=n,e)},fae=function(n,e){var t,r;e===void 0&&(e="&");var s=[];return jt(n,function(i,a){we(i)||we(a)||a==="undefined"||(t=encodeURIComponent((o=>o instanceof File)(i)?i.name:i.toString()),r=encodeURIComponent(a),s[s.length]=r+"="+t)}),s.join(e)},sx=function(n,e){for(var t,r=((n.split("#")[0]||"").split(/\?(.*)/)[1]||"").replace(/^\?+/g,"").split("&"),s=0;s<r.length;s++){var i=r[s].split("=");if(i[0]===e){t=i;break}}if(!sr(t)||t.length<2)return"";var a=t[1];try{a=decodeURIComponent(a)}catch{Ce.error("Skipping decoding for malformed query param: "+a)}return a.replace(/\+/g," ")},M1=function(n,e,t){if(!n||!e||!e.length)return n;for(var r=n.split("#"),s=r[0]||"",i=r[1],a=s.split("?"),o=a[1],u=a[0],l=(o||"").split("&"),d=[],h=0;h<l.length;h++){var f=l[h].split("=");sr(f)&&(e.includes(f[0])?d.push(f[0]+"="+t):d.push(l[h]))}var p=u;return o!=null&&(p+="?"+d.join("&")),i!=null&&(p+="#"+i),p},ix=function(n,e){var t=n.match(new RegExp(e+"=([^&]*)"));return t?t[1]:null},ZU=dn("[AutoCapture]");function $1(n,e){return e.length>n?e.slice(0,n)+"...":e}function pae(n){if(n.previousElementSibling)return n.previousElementSibling;var e=n;do e=e.previousSibling;while(e&&!tx(e));return e}function mae(n,e,t,r){var s=n.tagName.toLowerCase(),i={tag_name:s};O1.indexOf(s)>-1&&!t&&(s.toLowerCase()==="a"||s.toLowerCase()==="button"?i.$el_text=$1(1024,WU(n)):i.$el_text=$1(1024,nx(n)));var a=rx(n);a.length>0&&(i.classes=a.filter(function(d){return d!==""})),jt(n.attributes,function(d){var h;if((!qU(n)||["name","id","class","aria-label"].indexOf(d.name)!==-1)&&(r==null||!r.includes(d.name))&&!e&&Nh(d.value)&&(h=d.name,!fr(h)||h.substring(0,10)!=="_ngcontent"&&h.substring(0,7)!=="_nghost")){var f=d.value;d.name==="class"&&(f=I1(f).join(" ")),i["attr__"+d.name]=$1(1024,f)}});for(var o=1,u=1,l=n;l=pae(l);)o++,l.tagName===n.tagName&&u++;return i.nth_child=o,i.nth_of_type=u,i}function gae(n,e){for(var t,r,{e:s,maskAllElementAttributes:i,maskAllText:a,elementAttributeIgnoreList:o,elementsChainAsString:u}=e,l=[n],d=n;d.parentNode&&!nc(d,"body");)LU(d.parentNode)?(l.push(d.parentNode.host),d=d.parentNode.host):(l.push(d.parentNode),d=d.parentNode);var h,f=[],p={},m=!1,g=!1;if(jt(l,S=>{var P=R1(S);S.tagName.toLowerCase()==="a"&&(m=S.getAttribute("href"),m=P&&m&&Nh(m)&&m),nt(rx(S),"ph-no-capture")&&(g=!0),f.push(mae(S,i,a,o));var k=function(C){if(!R1(C))return{};var E={};return jt(C.attributes,function(M){if(M.name&&M.name.indexOf("data-ph-capture-attribute")===0){var I=M.name.replace("data-ph-capture-attribute-",""),N=M.value;I&&N&&Nh(N)&&(E[I]=N)}}),E}(S);pr(p,k)}),g)return{props:{},explicitNoCapture:g};if(a||(n.tagName.toLowerCase()==="a"||n.tagName.toLowerCase()==="button"?f[0].$el_text=WU(n):f[0].$el_text=nx(n)),m){var y,w;f[0].attr__href=m;var v=(y=Fh(m))==null?void 0:y.host,b=Y==null||(w=Y.location)==null?void 0:w.host;v&&b&&v!==b&&(h=m)}return{props:pr({$event_type:s.type,$ce_version:1},u?{}:{$elements:f},{$elements_chain:lae(f)},(t=f[0])!=null&&t.$el_text?{$el_text:(r=f[0])==null?void 0:r.$el_text}:{},h&&s.type==="click"?{$external_click_url:h}:{},p)}}class yae{constructor(e){this.i=!1,this.o=null,this.rageclicks=new GU,this.h=!1,this.instance=e,this.m=null}get S(){var e,t,r=ir(this.instance.config.autocapture)?this.instance.config.autocapture:{};return r.url_allowlist=(e=r.url_allowlist)==null?void 0:e.map(s=>new RegExp(s)),r.url_ignorelist=(t=r.url_ignorelist)==null?void 0:t.map(s=>new RegExp(s)),r}$(){if(this.isBrowserSupported()){if(Y&&Se){var e=r=>{r=r||(Y==null?void 0:Y.event);try{this.k(r)}catch(s){ZU.error("Failed to capture event",s)}};if(rr(Se,"submit",e,{capture:!0}),rr(Se,"change",e,{capture:!0}),rr(Se,"click",e,{capture:!0}),this.S.capture_copied_text){var t=r=>{r=r||(Y==null?void 0:Y.event),this.k(r,g1)};rr(Se,"copy",t,{capture:!0}),rr(Se,"cut",t,{capture:!0})}}}else ZU.info("Disabling Automatic Event Collection because this browser is not supported")}startIfEnabled(){this.isEnabled&&!this.i&&(this.$(),this.i=!0)}onRemoteConfig(e){e.elementsChainAsString&&(this.h=e.elementsChainAsString),this.instance.persistence&&this.instance.persistence.register({[bU]:!!e.autocapture_opt_out}),this.o=!!e.autocapture_opt_out,this.startIfEnabled()}setElementSelectors(e){this.m=e}getElementSelectors(e){var t,r=[];return(t=this.m)==null||t.forEach(s=>{var i=Se==null?void 0:Se.querySelectorAll(s);i==null||i.forEach(a=>{e===a&&r.push(s)})}),r}get isEnabled(){var e,t,r=(e=this.instance.persistence)==null?void 0:e.props[bU],s=this.o;if(tc(s)&&!Va(r)&&!this.instance.config.advanced_disable_decide)return!1;var i=(t=this.o)!==null&&t!==void 0?t:!!r;return!!this.instance.config.autocapture&&!i}k(e,t){if(t===void 0&&(t="$autocapture"),this.isEnabled){var r,s=BU(e);FU(s)&&(s=s.parentNode||null),t==="$autocapture"&&e.type==="click"&&e instanceof MouseEvent&&this.instance.config.rageclick&&(r=this.rageclicks)!=null&&r.isRageClick(e.clientX,e.clientY,new Date().getTime())&&this.k(e,"$rageclick");var i=t===g1;if(s&&iae(s,e,this.S,i,i?["copy","cut"]:void 0)){var{props:a,explicitNoCapture:o}=gae(s,{e,maskAllElementAttributes:this.instance.config.mask_all_element_attributes,maskAllText:this.instance.config.mask_all_text,elementAttributeIgnoreList:this.S.element_attribute_ignorelist,elementsChainAsString:this.h});if(o)return!1;var u=this.getElementSelectors(s);if(u&&u.length>0&&(a.$element_selectors=u),t===g1){var l,d=DU(Y==null||(l=Y.getSelection())==null?void 0:l.toString()),h=e.type||"clipboard";if(!d)return!1;a.$selected_content=d,a.$copy_type=h}return this.instance.capture(t,a),!0}}}isBrowserSupported(){return Us(Se==null?void 0:Se.querySelectorAll)}}Math.trunc||(Math.trunc=function(n){return n<0?Math.ceil(n):Math.floor(n)}),Number.isInteger||(Number.isInteger=function(n){return ln(n)&&isFinite(n)&&Math.floor(n)===n});var JU="0123456789abcdef";class ax{constructor(e){if(this.bytes=e,e.length!==16)throw new TypeError("not 128-bit length")}static fromFieldsV7(e,t,r,s){if(!Number.isInteger(e)||!Number.isInteger(t)||!Number.isInteger(r)||!Number.isInteger(s)||e<0||t<0||r<0||s<0||e>0xffffffffffff||t>4095||r>1073741823||s>4294967295)throw new RangeError("invalid field value");var i=new Uint8Array(16);return i[0]=e/Math.pow(2,40),i[1]=e/Math.pow(2,32),i[2]=e/Math.pow(2,24),i[3]=e/Math.pow(2,16),i[4]=e/Math.pow(2,8),i[5]=e,i[6]=112|t>>>8,i[7]=t,i[8]=128|r>>>24,i[9]=r>>>16,i[10]=r>>>8,i[11]=r,i[12]=s>>>24,i[13]=s>>>16,i[14]=s>>>8,i[15]=s,new ax(i)}toString(){for(var e="",t=0;t<this.bytes.length;t++)e=e+JU.charAt(this.bytes[t]>>>4)+JU.charAt(15&this.bytes[t]),t!==3&&t!==5&&t!==7&&t!==9||(e+="-");if(e.length!==36)throw new Error("Invalid UUIDv7 was generated");return e}clone(){return new ax(this.bytes.slice(0))}equals(e){return this.compareTo(e)===0}compareTo(e){for(var t=0;t<16;t++){var r=this.bytes[t]-e.bytes[t];if(r!==0)return Math.sign(r)}return 0}}class wae{constructor(){this.I=0,this.P=0,this.R=new vae}generate(){var e=this.generateOrAbort();if(we(e)){this.I=0;var t=this.generateOrAbort();if(we(t))throw new Error("Could not generate UUID after timestamp reset");return t}return e}generateOrAbort(){var e=Date.now();if(e>this.I)this.I=e,this.T();else{if(!(e+1e4>this.I))return;this.P++,this.P>4398046511103&&(this.I++,this.T())}return ax.fromFieldsV7(this.I,Math.trunc(this.P/Math.pow(2,30)),this.P&Math.pow(2,30)-1,this.R.nextUint32())}T(){this.P=1024*this.R.nextUint32()+(1023&this.R.nextUint32())}}var XU,YU=n=>{if(typeof UUIDV7_DENY_WEAK_RNG<"u"&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var e=0;e<n.length;e++)n[e]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return n};Y&&!we(Y.crypto)&&crypto.getRandomValues&&(YU=n=>crypto.getRandomValues(n));class vae{constructor(){this.M=new Uint32Array(8),this.C=1/0}nextUint32(){return this.C>=this.M.length&&(YU(this.M),this.C=0),this.M[this.C++]}}var sc=()=>_ae().toString(),_ae=()=>(XU||(XU=new wae)).generate(),bae="Thu, 01 Jan 1970 00:00:00 GMT",Wg="",Sae=/[a-z0-9][a-z0-9-]+\.[a-z]{2,}$/i;function xae(n,e){if(e){var t=function(s,i){if(i===void 0&&(i=Se),Wg)return Wg;if(!i||["localhost","127.0.0.1"].includes(s))return"";for(var a=s.split("."),o=Math.min(a.length,8),u="dmn_chk_"+sc(),l=new RegExp("(^|;)\\s*"+u+"=1");!Wg&&o--;){var d=a.slice(o).join("."),h=u+"=1;domain=."+d;i.cookie=h,l.test(i.cookie)&&(i.cookie=h+";expires="+bae,Wg=d)}return Wg}(n);if(!t){var r=(s=>{var i=s.match(Sae);return i?i[0]:""})(n);r!==t&&Ce.info("Warning: cookie subdomain discovery mismatch",r,t),t=r}return t?"; domain=."+t:""}return""}var ic,Za={O:()=>!!Se,F:function(n){Ce.error("cookieStore error: "+n)},A:function(n){if(Se){try{for(var e=n+"=",t=Se.cookie.split(";").filter(i=>i.length),r=0;r<t.length;r++){for(var s=t[r];s.charAt(0)==" ";)s=s.substring(1,s.length);if(s.indexOf(e)===0)return decodeURIComponent(s.substring(e.length,s.length))}}catch{}return null}},D:function(n){var e;try{e=JSON.parse(Za.A(n))||{}}catch{}return e},j:function(n,e,t,r,s){if(Se)try{var i="",a="",o=xae(Se.location.hostname,r);if(t){var u=new Date;u.setTime(u.getTime()+24*t*60*60*1e3),i="; expires="+u.toUTCString()}s&&(a="; secure");var l=n+"="+encodeURIComponent(JSON.stringify(e))+i+"; SameSite=Lax; path=/"+o+a;return l.length>3686.4&&Ce.warn("cookieStore warning: large cookie, len="+l.length),Se.cookie=l,l}catch{return}},L:function(n,e){try{Za.j(n,"",-1,e)}catch{return}}},N1=null,Pr={O:function(){if(!tc(N1))return N1;var n=!0;if(we(Y))n=!1;else try{var e="__mplssupport__";Pr.j(e,"xyz"),Pr.A(e)!=='"xyz"'&&(n=!1),Pr.L(e)}catch{n=!1}return n||Ce.error("localStorage unsupported; falling back to cookie store"),N1=n,n},F:function(n){Ce.error("localStorage error: "+n)},A:function(n){try{return Y==null?void 0:Y.localStorage.getItem(n)}catch(e){Pr.F(e)}return null},D:function(n){try{return JSON.parse(Pr.A(n))||{}}catch{}return null},j:function(n,e){try{Y==null||Y.localStorage.setItem(n,JSON.stringify(e))}catch(t){Pr.F(t)}},L:function(n){try{Y==null||Y.localStorage.removeItem(n)}catch(e){Pr.F(e)}}},Eae=["distinct_id",ZS,Hg,ex,QS],ox=_e({},Pr,{D:function(n){try{var e={};try{e=Za.D(n)||{}}catch{}var t=pr(e,JSON.parse(Pr.A(n)||"{}"));return Pr.j(n,t),t}catch{}return null},j:function(n,e,t,r,s,i){try{Pr.j(n,e,void 0,void 0,i);var a={};Eae.forEach(o=>{e[o]&&(a[o]=e[o])}),Object.keys(a).length&&Za.j(n,a,t,r,s,i)}catch(o){Pr.F(o)}},L:function(n,e){try{Y==null||Y.localStorage.removeItem(n),Za.L(n,e)}catch(t){Pr.F(t)}}}),cx={},kae={O:function(){return!0},F:function(n){Ce.error("memoryStorage error: "+n)},A:function(n){return cx[n]||null},D:function(n){return cx[n]||null},j:function(n,e){cx[n]=e},L:function(n){delete cx[n]}},Mu=null,tn={O:function(){if(!tc(Mu))return Mu;if(Mu=!0,we(Y))Mu=!1;else try{var n="__support__";tn.j(n,"xyz"),tn.A(n)!=='"xyz"'&&(Mu=!1),tn.L(n)}catch{Mu=!1}return Mu},F:function(n){Ce.error("sessionStorage error: ",n)},A:function(n){try{return Y==null?void 0:Y.sessionStorage.getItem(n)}catch(e){tn.F(e)}return null},D:function(n){try{return JSON.parse(tn.A(n))||null}catch{}return null},j:function(n,e){try{Y==null||Y.sessionStorage.setItem(n,JSON.stringify(e))}catch(t){tn.F(t)}},L:function(n){try{Y==null||Y.sessionStorage.removeItem(n)}catch(e){tn.F(e)}}};(function(n){n[n.PENDING=-1]="PENDING",n[n.DENIED=0]="DENIED",n[n.GRANTED=1]="GRANTED"})(ic||(ic={}));class Cae{constructor(e){this._instance=e}get S(){return this._instance.config}get consent(){return this.N()?ic.DENIED:this.U}isOptedOut(){return this.consent===ic.DENIED||this.consent===ic.PENDING&&this.S.opt_out_capturing_by_default}isOptedIn(){return!this.isOptedOut()}optInOut(e){this.q.j(this.B,e?1:0,this.S.cookie_expiration,this.S.cross_subdomain_cookie,this.S.secure_cookie)}reset(){this.q.L(this.B,this.S.cross_subdomain_cookie)}get B(){var{token:e,opt_out_capturing_cookie_prefix:t}=this._instance.config;return(t||"__ph_opt_in_out_")+e}get U(){var e=this.q.A(this.B);return e==="1"?ic.GRANTED:e==="0"?ic.DENIED:ic.PENDING}get q(){if(!this.H){var e=this.S.opt_out_capturing_persistence_type;this.H=e==="localStorage"?Pr:Za;var t=e==="localStorage"?Za:Pr;t.A(this.B)&&(this.H.A(this.B)||this.optInOut(t.A(this.B)==="1"),t.L(this.B,this.S.cross_subdomain_cookie))}return this.H}N(){return!!this.S.respect_dnt&&!!vU([ws==null?void 0:ws.doNotTrack,ws==null?void 0:ws.msDoNotTrack,Ge.doNotTrack],e=>nt([!0,1,"1","yes"],e))}}var ux=dn("[Dead Clicks]"),Pae=()=>!0,Aae=n=>{var e,t=!((e=n.instance.persistence)==null||!e.get_property(EU)),r=n.instance.config.capture_dead_clicks;return Va(r)?r:t};class QU{get lazyLoadedDeadClicksAutocapture(){return this.W}constructor(e,t,r){this.instance=e,this.isEnabled=t,this.onCapture=r,this.startIfEnabled()}onRemoteConfig(e){this.instance.persistence&&this.instance.persistence.register({[EU]:e==null?void 0:e.captureDeadClicks}),this.startIfEnabled()}startIfEnabled(){this.isEnabled(this)&&this.G(()=>{this.J()})}G(e){var t,r;(t=Ge.__PosthogExtensions__)!=null&&t.initDeadClicksAutocapture&&e(),(r=Ge.__PosthogExtensions__)==null||r.loadExternalDependency==null||r.loadExternalDependency(this.instance,"dead-clicks-autocapture",s=>{s?ux.error("failed to load script",s):e()})}J(){var e;if(Se){if(!this.W&&(e=Ge.__PosthogExtensions__)!=null&&e.initDeadClicksAutocapture){var t=ir(this.instance.config.capture_dead_clicks)?this.instance.config.capture_dead_clicks:{};t.__onCapture=this.onCapture,this.W=Ge.__PosthogExtensions__.initDeadClicksAutocapture(this.instance,t),this.W.start(Se),ux.info("starting...")}}else ux.error("`document` not found. Cannot start.")}stop(){this.W&&(this.W.stop(),this.W=void 0,ux.info("stopping..."))}}var F1=dn("[ExceptionAutocapture]");class Tae{constructor(e){var t;this.V=()=>{var r;if(Y&&this.isEnabled&&(r=Ge.__PosthogExtensions__)!=null&&r.errorWrappingFunctions){var s=Ge.__PosthogExtensions__.errorWrappingFunctions.wrapOnError,i=Ge.__PosthogExtensions__.errorWrappingFunctions.wrapUnhandledRejection,a=Ge.__PosthogExtensions__.errorWrappingFunctions.wrapConsoleError;try{!this.K&&this.S.capture_unhandled_errors&&(this.K=s(this.captureException.bind(this))),!this.Y&&this.S.capture_unhandled_rejections&&(this.Y=i(this.captureException.bind(this))),!this.X&&this.S.capture_console_errors&&(this.X=a(this.captureException.bind(this)))}catch(o){F1.error("failed to start",o),this.Z()}}},this._instance=e,this.tt=!((t=this._instance.persistence)==null||!t.props[SU]),this.S=this.it(),this.startIfEnabled()}it(){var e=this._instance.config.capture_exceptions,t={capture_unhandled_errors:!1,capture_unhandled_rejections:!1,capture_console_errors:!1};return ir(e)?t=_e({},t,e):(we(e)?this.tt:e)&&(t=_e({},t,{capture_unhandled_errors:!0,capture_unhandled_rejections:!0})),t}get isEnabled(){return this.S.capture_console_errors||this.S.capture_unhandled_errors||this.S.capture_unhandled_rejections}startIfEnabled(){this.isEnabled&&(F1.info("enabled"),this.G(this.V))}G(e){var t,r;(t=Ge.__PosthogExtensions__)!=null&&t.errorWrappingFunctions&&e(),(r=Ge.__PosthogExtensions__)==null||r.loadExternalDependency==null||r.loadExternalDependency(this._instance,"exception-autocapture",s=>{if(s)return F1.error("failed to load script",s);e()})}Z(){var e,t,r;(e=this.K)==null||e.call(this),this.K=void 0,(t=this.Y)==null||t.call(this),this.Y=void 0,(r=this.X)==null||r.call(this),this.X=void 0}onRemoteConfig(e){var t=e.autocaptureExceptions;this.tt=!!t||!1,this.S=this.it(),this._instance.persistence&&this._instance.persistence.register({[SU]:this.tt}),this.startIfEnabled()}captureException(e){var t=this._instance.requestRouter.endpointFor("ui");e.$exception_personURL=t+"/project/"+this._instance.config.token+"/person/"+this._instance.get_distinct_id(),this._instance.exceptions.sendExceptionEvent(e)}}function eq(n){return!we(Event)&&tq(n,Event)}function tq(n,e){try{return n instanceof e}catch{return!1}}function rq(n){switch(Object.prototype.toString.call(n)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object DOMError]":return!0;default:return tq(n,Error)}}function lx(n,e){return Object.prototype.toString.call(n)==="[object "+e+"]"}function L1(n){return lx(n,"DOMError")}var nq=/\(error: (.*)\)/,sq=50,Lh="?";function j1(n,e,t,r){var s={platform:"web:javascript",filename:n,function:e==="<anonymous>"?Lh:e,in_app:!0};return we(t)||(s.lineno=t),we(r)||(s.colno=r),s}var Iae=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,Oae=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Rae=/\((\S*)(?::(\d+))(?::(\d+))\)/,Mae=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,$ae=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,Nae=function(){for(var n=arguments.length,e=new Array(n),t=0;t<n;t++)e[t]=arguments[t];var r=e.sort((s,i)=>s[0]-i[0]).map(s=>s[1]);return function(s,i){i===void 0&&(i=0);for(var a=[],o=s.split(`
`),u=i;u<o.length;u++){var l=o[u];if(!(l.length>1024)){var d=nq.test(l)?l.replace(nq,"$1"):l;if(!d.match(/\S*Error: /)){for(var h of r){var f=h(d);if(f){a.push(f);break}}if(a.length>=sq)break}}}return function(p){if(!p.length)return[];var m=Array.from(p);return m.reverse(),m.slice(0,sq).map(g=>_e({},g,{filename:g.filename||Fae(m).filename,function:g.function||Lh}))}(a)}}([30,n=>{var e=Iae.exec(n);if(e){var[,t,r,s]=e;return j1(t,Lh,+r,+s)}var i=Oae.exec(n);if(i){if(i[2]&&i[2].indexOf("eval")===0){var a=Rae.exec(i[2]);a&&(i[2]=a[1],i[3]=a[2],i[4]=a[3])}var[o,u]=aq(i[1]||Lh,i[2]);return j1(u,o,i[3]?+i[3]:void 0,i[4]?+i[4]:void 0)}}],[50,n=>{var e=Mae.exec(n);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){var t=$ae.exec(e[3]);t&&(e[1]=e[1]||"eval",e[3]=t[1],e[4]=t[2],e[5]="")}var r=e[3],s=e[1]||Lh;return[s,r]=aq(s,r),j1(r,s,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}}]);function Fae(n){return n[n.length-1]||{}}var dx,iq,D1,aq=(n,e)=>{var t=n.indexOf("safari-extension")!==-1,r=n.indexOf("safari-web-extension")!==-1;return t||r?[n.indexOf("@")!==-1?n.split("@")[0]:Lh,t?"safari-extension:"+e:"safari-web-extension:"+e]:[n,e]},Lae=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i;function B1(n,e){e===void 0&&(e=0);var t=n.stacktrace||n.stack||"",r=function(a){return a&&jae.test(a.message)?1:0}(n);try{var s=Nae,i=function(a,o){var u=function(l){var d=globalThis._posthogChunkIds;if(!d)return{};var h=Object.keys(d);return D1&&h.length===iq||(iq=h.length,D1=h.reduce((f,p)=>{dx||(dx={});var m=dx[p];if(m)f[m[0]]=m[1];else for(var g=l(p),y=g.length-1;y>=0;y--){var w=g[y],v=w==null?void 0:w.filename,b=d[p];if(v&&b){f[v]=b,dx[p]=[v,b];break}}return f},{})),D1}(o);return a.forEach(l=>{l.filename&&(l.chunk_id=u[l.filename])}),a}(s(t,r),s);return i.slice(0,i.length-e)}catch{}return[]}var jae=/Minified React error #\d+;/i;function Dae(n,e){var t,r,s=B1(n),i=(t=e==null?void 0:e.handled)===null||t===void 0||t,a=(r=e==null?void 0:e.synthetic)!==null&&r!==void 0&&r;return{type:e!=null&&e.overrideExceptionType?e.overrideExceptionType:n.name,value:function(o){var u=o.message;return u.error&&typeof u.error.message=="string"?String(u.error.message):String(u)}(n),stacktrace:{frames:s,type:"raw"},mechanism:{handled:i,synthetic:a}}}function oq(n,e){var t=Dae(n,e);return n.cause&&rq(n.cause)&&n.cause!==n?[t,...oq(n.cause,{handled:e==null?void 0:e.handled,synthetic:e==null?void 0:e.synthetic})]:[t]}function U1(n,e){return{$exception_list:oq(n,e),$exception_level:"error"}}function q1(n,e){var t,r,s,i=(t=e==null?void 0:e.handled)===null||t===void 0||t,a=(r=e==null?void 0:e.synthetic)===null||r===void 0||r,o={type:e!=null&&e.overrideExceptionType?e.overrideExceptionType:(s=e==null?void 0:e.defaultExceptionType)!==null&&s!==void 0?s:"Error",value:n||(e==null?void 0:e.defaultExceptionMessage),mechanism:{handled:i,synthetic:a}};if(e!=null&&e.syntheticException){var u=B1(e.syntheticException,1);u.length&&(o.stacktrace={frames:u,type:"raw"})}return{$exception_list:[o],$exception_level:"error"}}function Bae(n){return fr(n)&&!w1(n)&&Zie.indexOf(n)>=0}function Uae(n,e){var t,r,s=(t=e==null?void 0:e.handled)===null||t===void 0||t,i=(r=e==null?void 0:e.synthetic)===null||r===void 0||r,a=e!=null&&e.overrideExceptionType?e.overrideExceptionType:eq(n)?n.constructor.name:"Error",o="Non-Error 'exception' captured with keys: "+function(d,h){h===void 0&&(h=40);var f=Object.keys(d);if(f.sort(),!f.length)return"[object has no keys]";for(var p=f.length;p>0;p--){var m=f.slice(0,p).join(", ");if(!(m.length>h))return p===f.length||m.length<=h?m:m.slice(0,h)+"..."}return""}(n),u={type:a,value:o,mechanism:{handled:s,synthetic:i}};if(e!=null&&e.syntheticException){var l=B1(e==null?void 0:e.syntheticException,1);l.length&&(u.stacktrace={frames:l,type:"raw"})}return{$exception_list:[u],$exception_level:Bae(n.level)?n.level:"error"}}function qae(n,e){var{error:t,event:r}=n,s={$exception_list:[]},i=t||r;if(L1(i)||function(f){return lx(f,"DOMException")}(i)){var a=i;if(function(f){return"stack"in f}(i))s=U1(i,e);else{var o=a.name||(L1(a)?"DOMError":"DOMException"),u=a.message?o+": "+a.message:o;s=q1(u,_e({},e,{overrideExceptionType:L1(a)?"DOMError":"DOMException",defaultExceptionMessage:u}))}return"code"in a&&(s.$exception_DOMException_code=""+a.code),s}if(function(f){return lx(f,"ErrorEvent")}(i)&&i.error)return U1(i.error,e);if(rq(i))return U1(i,e);if(function(f){return lx(f,"Object")}(i)||eq(i))return Uae(i,e);if(we(t)&&fr(r)){var l="Error",d=r,h=r.match(Lae);return h&&(l=h[1],d=h[2]),q1(d,_e({},e,{overrideExceptionType:l,defaultExceptionMessage:d}))}return q1(i,e)}function cq(n,e,t){try{if(!(e in n))return()=>{};var r=n[e],s=t(r);return Us(s)&&(s.prototype=s.prototype||{},Object.defineProperties(s,{__posthog_wrapped__:{enumerable:!1,value:!0}})),n[e]=s,()=>{n[e]=r}}catch{return()=>{}}}class Hae{constructor(e){var t;this._instance=e,this.et=(Y==null||(t=Y.location)==null?void 0:t.pathname)||""}get isEnabled(){return this._instance.config.capture_pageview==="history_change"}startIfEnabled(){this.isEnabled&&(Ce.info("History API monitoring enabled, starting..."),this.monitorHistoryChanges())}stop(){this.rt&&this.rt(),this.rt=void 0,Ce.info("History API monitoring stopped")}monitorHistoryChanges(){var e,t;if(Y&&Y.history){var r=this;(e=Y.history.pushState)!=null&&e.__posthog_wrapped__||cq(Y.history,"pushState",s=>function(i,a,o){s.call(this,i,a,o),r.st("pushState")}),(t=Y.history.replaceState)!=null&&t.__posthog_wrapped__||cq(Y.history,"replaceState",s=>function(i,a,o){s.call(this,i,a,o),r.st("replaceState")}),this.nt()}}st(e){try{var t,r=Y==null||(t=Y.location)==null?void 0:t.pathname;if(!r)return;r!==this.et&&this.isEnabled&&this._instance.capture("$pageview",{navigation_type:e}),this.et=r}catch(s){Ce.error("Error capturing "+e+" pageview",s)}}nt(){if(!this.rt){var e=()=>{this.st("popstate")};rr(Y,"popstate",e),this.rt=()=>{Y&&Y.removeEventListener("popstate",e)}}}}function hx(n){var e,t;return((e=JSON.stringify(n,(t=[],function(r,s){if(ir(s)){for(;t.length>0&&t[t.length-1]!==this;)t.pop();return t.includes(s)?"[Circular]":(t.push(s),s)}return s})))==null?void 0:e.length)||0}function H1(n,e){if(e===void 0&&(e=66060288e-1),n.size>=e&&n.data.length>1){var t=Math.floor(n.data.length/2),r=n.data.slice(0,t),s=n.data.slice(t);return[H1({size:hx(r),data:r,sessionId:n.sessionId,windowId:n.windowId}),H1({size:hx(s),data:s,sessionId:n.sessionId,windowId:n.windowId})].flatMap(i=>i)}return[n]}var Ja=(n=>(n[n.DomContentLoaded=0]="DomContentLoaded",n[n.Load=1]="Load",n[n.FullSnapshot=2]="FullSnapshot",n[n.IncrementalSnapshot=3]="IncrementalSnapshot",n[n.Meta=4]="Meta",n[n.Custom=5]="Custom",n[n.Plugin=6]="Plugin",n))(Ja||{}),Ei=(n=>(n[n.Mutation=0]="Mutation",n[n.MouseMove=1]="MouseMove",n[n.MouseInteraction=2]="MouseInteraction",n[n.Scroll=3]="Scroll",n[n.ViewportResize=4]="ViewportResize",n[n.Input=5]="Input",n[n.TouchMove=6]="TouchMove",n[n.MediaInteraction=7]="MediaInteraction",n[n.StyleSheetRule=8]="StyleSheetRule",n[n.CanvasMutation=9]="CanvasMutation",n[n.Font=10]="Font",n[n.Log=11]="Log",n[n.Drag=12]="Drag",n[n.StyleDeclaration=13]="StyleDeclaration",n[n.Selection=14]="Selection",n[n.AdoptedStyleSheet=15]="AdoptedStyleSheet",n[n.CustomElement=16]="CustomElement",n))(Ei||{}),K1="[SessionRecording]",W1="redacted",fx={initiatorTypes:["audio","beacon","body","css","early-hint","embed","fetch","frame","iframe","icon","image","img","input","link","navigation","object","ping","script","track","video","xmlhttprequest"],maskRequestFn:n=>n,recordHeaders:!1,recordBody:!1,recordInitialRequests:!1,recordPerformance:!1,performanceEntryTypeToObserve:["first-input","navigation","paint","resource"],payloadSizeLimitBytes:1e6,payloadHostDenyList:[".lr-ingest.io",".ingest.sentry.io",".clarity.ms","analytics.google.com"]},Kae=["authorization","x-forwarded-for","authorization","cookie","set-cookie","x-api-key","x-real-ip","remote-addr","forwarded","proxy-authorization","x-csrf-token","x-csrftoken","x-xsrf-token"],Wae=["password","secret","passwd","api_key","apikey","auth","credentials","mysql_pwd","privatekey","private_key","token"],zae=["/s/","/e/","/i/"];function uq(n,e,t,r){if(kt(n))return n;var s=(e==null?void 0:e["content-length"])||function(i){return new Blob([i]).size}(n);return fr(s)&&(s=parseInt(s)),s>t?K1+" "+r+" body too large to record ("+s+" bytes)":n}function lq(n,e){if(kt(n))return n;var t=n;return Nh(t,!1)||(t=K1+" "+e+" body "+W1),jt(Wae,r=>{var s,i;(s=t)!=null&&s.length&&((i=t)==null?void 0:i.indexOf(r))!==-1&&(t=K1+" "+e+" body "+W1+" as might contain: "+r)}),t}var Vae=(n,e)=>{var t,r,s,i={payloadSizeLimitBytes:fx.payloadSizeLimitBytes,performanceEntryTypeToObserve:[...fx.performanceEntryTypeToObserve],payloadHostDenyList:[...e.payloadHostDenyList||[],...fx.payloadHostDenyList]},a=n.session_recording.recordHeaders!==!1&&e.recordHeaders,o=n.session_recording.recordBody!==!1&&e.recordBody,u=n.capture_performance!==!1&&e.recordPerformance,l=(t=i,s=Math.min(1e6,(r=t.payloadSizeLimitBytes)!==null&&r!==void 0?r:1e6),f=>(f!=null&&f.requestBody&&(f.requestBody=uq(f.requestBody,f.requestHeaders,s,"Request")),f!=null&&f.responseBody&&(f.responseBody=uq(f.responseBody,f.responseHeaders,s,"Response")),f)),d=f=>{return l(((g,y)=>{var w,v=Fh(g.name),b=y.indexOf("http")===0?(w=Fh(y))==null?void 0:w.pathname:y;b==="/"&&(b="");var S=v==null?void 0:v.pathname.replace(b||"","");if(!(v&&S&&zae.some(P=>S.indexOf(P)===0)))return g})((m=(p=f).requestHeaders,kt(m)||jt(Object.keys(m??{}),g=>{Kae.includes(g.toLowerCase())&&(m[g]=W1)}),p),n.api_host));var p,m},h=Us(n.session_recording.maskNetworkRequestFn);return h&&Us(n.session_recording.maskCapturedNetworkRequestFn)&&Ce.warn("Both `maskNetworkRequestFn` and `maskCapturedNetworkRequestFn` are defined. `maskNetworkRequestFn` will be ignored."),h&&(n.session_recording.maskCapturedNetworkRequestFn=f=>{var p=n.session_recording.maskNetworkRequestFn({url:f.name});return _e({},f,{name:p==null?void 0:p.url})}),i.maskRequestFn=Us(n.session_recording.maskCapturedNetworkRequestFn)?f=>{var p,m=d(f);return m&&(p=n.session_recording.maskCapturedNetworkRequestFn==null?void 0:n.session_recording.maskCapturedNetworkRequestFn(m))!==null&&p!==void 0?p:void 0}:f=>function(p){if(!we(p))return p.requestBody=lq(p.requestBody,"Request"),p.responseBody=lq(p.responseBody,"Response"),p}(d(f)),_e({},fx,i,{recordHeaders:a,recordBody:o,recordPerformance:u,recordInitialRequests:u})};function qs(n,e,t,r,s){return e>t&&(Ce.warn("min cannot be greater than max."),e=t),ln(n)?n>t?(r&&Ce.warn(r+" cannot be  greater than max: "+t+". Using max value instead."),t):n<e?(r&&Ce.warn(r+" cannot be less than min: "+e+". Using min value instead."),e):n:(r&&Ce.warn(r+" must be a number. using max or fallback. max: "+t+", fallback: "+s),qs(s||t,e,t,r))}class Gae{constructor(e,t){var r,s;t===void 0&&(t={}),this.ot=100,this.lt=10,this.ht={},this.ut={},this.dt=()=>{Object.keys(this.ht).forEach(i=>{this.ht[i]=this.ht[i]+this.lt,this.ht[i]>=this.ot&&delete this.ht[i]})},this.vt=i=>{var a=this._rrweb.mirror.getNode(i);if((a==null?void 0:a.nodeName)!=="svg"&&a instanceof Element){var o=a.closest("svg");if(o)return[this._rrweb.mirror.getId(o),o]}return[i,a]},this.ct=i=>{var a,o,u,l,d,h,f,p;return((a=(o=i.removes)==null?void 0:o.length)!==null&&a!==void 0?a:0)+((u=(l=i.attributes)==null?void 0:l.length)!==null&&u!==void 0?u:0)+((d=(h=i.texts)==null?void 0:h.length)!==null&&d!==void 0?d:0)+((f=(p=i.adds)==null?void 0:p.length)!==null&&f!==void 0?f:0)},this.throttleMutations=i=>{if(i.type!==3||i.data.source!==0)return i;var a=i.data,o=this.ct(a);a.attributes&&(a.attributes=a.attributes.filter(l=>{var d,h,f,[p,m]=this.vt(l.id);return this.ht[p]===0?!1:(this.ht[p]=(d=this.ht[p])!==null&&d!==void 0?d:this.ot,this.ht[p]=Math.max(this.ht[p]-1,0),this.ht[p]===0&&(this.ut[p]||(this.ut[p]=!0,(h=(f=this.ft).onBlockedNode)==null||h.call(f,p,m))),l)}));var u=this.ct(a);return u!==0||o===u?i:void 0},this._rrweb=e,this.ft=t,this.lt=qs((r=this.ft.refillRate)!==null&&r!==void 0?r:this.lt,0,100,"mutation throttling refill rate"),this.ot=qs((s=this.ft.bucketSize)!==null&&s!==void 0?s:this.ot,0,100,"mutation throttling bucket size"),setInterval(()=>{this.dt()},1e3)}}var Hs=Uint8Array,es=Uint16Array,jh=Uint32Array,z1=new Hs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),V1=new Hs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dq=new Hs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),hq=function(n,e){for(var t=new es(31),r=0;r<31;++r)t[r]=e+=1<<n[r-1];var s=new jh(t[30]);for(r=1;r<30;++r)for(var i=t[r];i<t[r+1];++i)s[i]=i-t[r]<<5|r;return[t,s]},fq=hq(z1,2),Zae=fq[0],G1=fq[1];Zae[28]=258,G1[258]=28;for(var pq=hq(V1,0)[1],mq=new es(32768),Vt=0;Vt<32768;++Vt){var $u=(43690&Vt)>>>1|(21845&Vt)<<1;$u=(61680&($u=(52428&$u)>>>2|(13107&$u)<<2))>>>4|(3855&$u)<<4,mq[Vt]=((65280&$u)>>>8|(255&$u)<<8)>>>1}var zg=function(n,e,t){for(var r=n.length,s=0,i=new es(e);s<r;++s)++i[n[s]-1];var a,o=new es(e);for(s=0;s<e;++s)o[s]=o[s-1]+i[s-1]<<1;for(a=new es(r),s=0;s<r;++s)a[s]=mq[o[n[s]-1]++]>>>15-n[s];return a},Nu=new Hs(288);for(Vt=0;Vt<144;++Vt)Nu[Vt]=8;for(Vt=144;Vt<256;++Vt)Nu[Vt]=9;for(Vt=256;Vt<280;++Vt)Nu[Vt]=7;for(Vt=280;Vt<288;++Vt)Nu[Vt]=8;var px=new Hs(32);for(Vt=0;Vt<32;++Vt)px[Vt]=5;var Jae=zg(Nu,9),Xae=zg(px,5),gq=function(n){return(n/8>>0)+(7&n&&1)},yq=function(n,e,t){(t==null||t>n.length)&&(t=n.length);var r=new(n instanceof es?es:n instanceof jh?jh:Hs)(t-e);return r.set(n.subarray(e,t)),r},Xa=function(n,e,t){t<<=7&e;var r=e/8>>0;n[r]|=t,n[r+1]|=t>>>8},Vg=function(n,e,t){t<<=7&e;var r=e/8>>0;n[r]|=t,n[r+1]|=t>>>8,n[r+2]|=t>>>16},Z1=function(n,e){for(var t=[],r=0;r<n.length;++r)n[r]&&t.push({s:r,f:n[r]});var s=t.length,i=t.slice();if(!s)return[new Hs(0),0];if(s==1){var a=new Hs(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort(function(P,k){return P.f-k.f}),t.push({s:-1,f:25001});var o=t[0],u=t[1],l=0,d=1,h=2;for(t[0]={s:-1,f:o.f+u.f,l:o,r:u};d!=s-1;)o=t[t[l].f<t[h].f?l++:h++],u=t[l!=d&&t[l].f<t[h].f?l++:h++],t[d++]={s:-1,f:o.f+u.f,l:o,r:u};var f=i[0].s;for(r=1;r<s;++r)i[r].s>f&&(f=i[r].s);var p=new es(f+1),m=J1(t[d-1],p,0);if(m>e){r=0;var g=0,y=m-e,w=1<<y;for(i.sort(function(P,k){return p[k.s]-p[P.s]||P.f-k.f});r<s;++r){var v=i[r].s;if(!(p[v]>e))break;g+=w-(1<<m-p[v]),p[v]=e}for(g>>>=y;g>0;){var b=i[r].s;p[b]<e?g-=1<<e-p[b]++-1:++r}for(;r>=0&&g;--r){var S=i[r].s;p[S]==e&&(--p[S],++g)}m=e}return[new Hs(p),m]},J1=function(n,e,t){return n.s==-1?Math.max(J1(n.l,e,t+1),J1(n.r,e,t+1)):e[n.s]=t},wq=function(n){for(var e=n.length;e&&!n[--e];);for(var t=new es(++e),r=0,s=n[0],i=1,a=function(u){t[r++]=u},o=1;o<=e;++o)if(n[o]==s&&o!=e)++i;else{if(!s&&i>2){for(;i>138;i-=138)a(32754);i>2&&(a(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(a(s),--i;i>6;i-=6)a(8304);i>2&&(a(i-3<<5|8208),i=0)}for(;i--;)a(s);i=1,s=n[o]}return[t.subarray(0,r),e]},Gg=function(n,e){for(var t=0,r=0;r<e.length;++r)t+=n[r]*e[r];return t},X1=function(n,e,t){var r=t.length,s=gq(e+2);n[s]=255&r,n[s+1]=r>>>8,n[s+2]=255^n[s],n[s+3]=255^n[s+1];for(var i=0;i<r;++i)n[s+i+4]=t[i];return 8*(s+4+r)},vq=function(n,e,t,r,s,i,a,o,u,l,d){Xa(e,d++,t),++s[256];for(var h=Z1(s,15),f=h[0],p=h[1],m=Z1(i,15),g=m[0],y=m[1],w=wq(f),v=w[0],b=w[1],S=wq(g),P=S[0],k=S[1],C=new es(19),E=0;E<v.length;++E)C[31&v[E]]++;for(E=0;E<P.length;++E)C[31&P[E]]++;for(var M=Z1(C,7),I=M[0],N=M[1],O=19;O>4&&!I[dq[O-1]];--O);var T,L,U,Z,j=l+5<<3,F=Gg(s,Nu)+Gg(i,px)+a,B=Gg(s,f)+Gg(i,g)+a+14+3*O+Gg(C,I)+(2*C[16]+3*C[17]+7*C[18]);if(j<=F&&j<=B)return X1(e,d,n.subarray(u,u+l));if(Xa(e,d,1+(B<F)),d+=2,B<F){T=zg(f,p),L=f,U=zg(g,y),Z=g;var D=zg(I,N);for(Xa(e,d,b-257),Xa(e,d+5,k-1),Xa(e,d+10,O-4),d+=14,E=0;E<O;++E)Xa(e,d+3*E,I[dq[E]]);d+=3*O;for(var W=[v,P],G=0;G<2;++G){var te=W[G];for(E=0;E<te.length;++E){var K=31&te[E];Xa(e,d,D[K]),d+=I[K],K>15&&(Xa(e,d,te[E]>>>5&127),d+=te[E]>>>12)}}}else T=Jae,L=Nu,U=Xae,Z=px;for(E=0;E<o;++E)if(r[E]>255){K=r[E]>>>18&31,Vg(e,d,T[K+257]),d+=L[K+257],K>7&&(Xa(e,d,r[E]>>>23&31),d+=z1[K]);var q=31&r[E];Vg(e,d,U[q]),d+=Z[q],q>3&&(Vg(e,d,r[E]>>>5&8191),d+=V1[q])}else Vg(e,d,T[r[E]]),d+=L[r[E]];return Vg(e,d,T[256]),d+L[256]},Yae=new jh([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Qae=function(){for(var n=new jh(256),e=0;e<256;++e){for(var t=e,r=9;--r;)t=(1&t&&3988292384)^t>>>1;n[e]=t}return n}(),eoe=function(){var n=4294967295;return{p:function(e){for(var t=n,r=0;r<e.length;++r)t=Qae[255&t^e[r]]^t>>>8;n=t},d:function(){return 4294967295^n}}},toe=function(n,e,t,r,s){return function(i,a,o,u,l,d){var h=i.length,f=new Hs(u+h+5*(1+Math.floor(h/7e3))+l),p=f.subarray(u,f.length-l),m=0;if(!a||h<8)for(var g=0;g<=h;g+=65535){var y=g+65535;y<h?m=X1(p,m,i.subarray(g,y)):(p[g]=d,m=X1(p,m,i.subarray(g,h)))}else{for(var w=Yae[a-1],v=w>>>13,b=8191&w,S=(1<<o)-1,P=new es(32768),k=new es(S+1),C=Math.ceil(o/3),E=2*C,M=function(ce){return(i[ce]^i[ce+1]<<C^i[ce+2]<<E)&S},I=new jh(25e3),N=new es(288),O=new es(32),T=0,L=0,U=(g=0,0),Z=0,j=0;g<h;++g){var F=M(g),B=32767&g,D=k[F];if(P[B]=D,k[F]=B,Z<=g){var W=h-g;if((T>7e3||U>24576)&&W>423){m=vq(i,p,0,I,N,O,L,U,j,g-j,m),U=T=L=0,j=g;for(var G=0;G<286;++G)N[G]=0;for(G=0;G<30;++G)O[G]=0}var te=2,K=0,q=b,se=B-D&32767;if(W>2&&F==M(g-se))for(var ke=Math.min(v,W)-1,he=Math.min(32767,g),et=Math.min(258,W);se<=he&&--q&&B!=D;){if(i[g+te]==i[g+te-se]){for(var fe=0;fe<et&&i[g+fe]==i[g+fe-se];++fe);if(fe>te){if(te=fe,K=se,fe>ke)break;var R=Math.min(se,fe-2),$=0;for(G=0;G<R;++G){var H=g-se+G+32768&32767,V=H-P[H]+32768&32767;V>$&&($=V,D=H)}}}se+=(B=D)-(D=P[B])+32768&32767}if(K){I[U++]=268435456|G1[te]<<18|pq[K];var X=31&G1[te],ne=31&pq[K];L+=z1[X]+V1[ne],++N[257+X],++O[ne],Z=g+te,++T}else I[U++]=i[g],++N[i[g]]}}m=vq(i,p,d,I,N,O,L,U,j,g-j,m)}return yq(f,0,u+gq(m)+l)}(n,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(n.length)))):12+e.mem,t,r,!s)},Y1=function(n,e,t){for(;t;++e)n[e]=t,t>>>=8},roe=function(n,e){var t=e.filename;if(n[0]=31,n[1]=139,n[2]=8,n[8]=e.level<2?4:e.level==9?2:0,n[9]=3,e.mtime!=0&&Y1(n,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){n[3]=8;for(var r=0;r<=t.length;++r)n[r+10]=t.charCodeAt(r)}},noe=function(n){return 10+(n.filename&&n.filename.length+1||0)};function _q(n,e){e===void 0&&(e={});var t=eoe(),r=n.length;t.p(n);var s=toe(n,e,noe(e),8),i=s.length;return roe(s,e),Y1(s,i-8,t.d()),Y1(s,i-4,r),s}function bq(n,e){var t=n.length;if(typeof TextEncoder<"u")return new TextEncoder().encode(n);for(var r=new Hs(n.length+(n.length>>>1)),s=0,i=function(l){r[s++]=l},a=0;a<t;++a){if(s+5>r.length){var o=new Hs(s+8+(t-a<<1));o.set(r),r=o}var u=n.charCodeAt(a);u<128||e?i(u):u<2048?(i(192|u>>>6),i(128|63&u)):u>55295&&u<57344?(i(240|(u=65536+(1047552&u)|1023&n.charCodeAt(++a))>>>18),i(128|u>>>12&63),i(128|u>>>6&63),i(128|63&u)):(i(224|u>>>12),i(128|u>>>6&63),i(128|63&u))}return yq(r,0,s)}function soe(n,e){return function(t){for(var r=0,s=0;s<t.length;s++)r=(r<<5)-r+t.charCodeAt(s),r|=0;return Math.abs(r)}(n)%100<qs(100*e,0,100)}var ac="disabled",Q1="sampled",mx="active",Fu="buffering",eI="paused",tI="trigger",ia=tI+"_activated",hn=tI+"_pending",aa=tI+"_"+ac;function Sq(n,e){return e.some(t=>t.matching==="regex"&&new RegExp(t.url).test(n))}class xq{constructor(e){this.gt=e}triggerStatus(e){var t=this.gt.map(r=>r.triggerStatus(e));return t.includes(ia)?ia:t.includes(hn)?hn:aa}stop(){this.gt.forEach(e=>e.stop())}}class Eq{constructor(e){this.gt=e}triggerStatus(e){var t=new Set;for(var r of this.gt)t.add(r.triggerStatus(e));switch(t.delete(aa),t.size){case 0:return aa;case 1:return Array.from(t)[0];default:return hn}}stop(){this.gt.forEach(e=>e.stop())}}class ioe{triggerStatus(){return hn}stop(){}}class aoe{constructor(e){this._t=[],this.bt=[],this.urlBlocked=!1,this._instance=e}onRemoteConfig(e){var t,r;this._t=((t=e.sessionRecording)==null?void 0:t.urlTriggers)||[],this.bt=((r=e.sessionRecording)==null?void 0:r.urlBlocklist)||[]}wt(e){var t;return this._t.length===0?aa:((t=this._instance)==null?void 0:t.get_property(S1))===e?ia:hn}triggerStatus(e){var t=this.wt(e),r=t===ia?ia:t===hn?hn:aa;return this._instance.register_for_session({$sdk_debug_replay_url_trigger_status:r}),r}checkUrlTriggerConditions(e,t,r){if(Y!==void 0&&Y.location.href){var s=Y.location.href,i=this.urlBlocked,a=Sq(s,this.bt);i&&a||(a&&!i?e():!a&&i&&t(),Sq(s,this._t)&&r("url"))}}stop(){}}class ooe{constructor(e){this.linkedFlag=null,this.linkedFlagSeen=!1,this.yt=()=>{},this._instance=e}triggerStatus(){var e=hn;return kt(this.linkedFlag)&&(e=aa),this.linkedFlagSeen&&(e=ia),this._instance.register_for_session({$sdk_debug_replay_linked_flag_trigger_status:e}),e}onRemoteConfig(e,t){var r;if(this.linkedFlag=((r=e.sessionRecording)==null?void 0:r.linkedFlag)||null,!kt(this.linkedFlag)&&!this.linkedFlagSeen){var s=fr(this.linkedFlag)?this.linkedFlag:this.linkedFlag.flag,i=fr(this.linkedFlag)?null:this.linkedFlag.variant;this.yt=this._instance.onFeatureFlags((a,o)=>{var u=ir(o)&&s in o&&(i?o[s]===i:o[s]===!0);u&&t(s,i),this.linkedFlagSeen=u})}}stop(){this.yt()}}class coe{constructor(e){this.St=[],this._instance=e}onRemoteConfig(e){var t;this.St=((t=e.sessionRecording)==null?void 0:t.eventTriggers)||[]}$t(e){var t;return this.St.length===0?aa:((t=this._instance)==null?void 0:t.get_property(x1))===e?ia:hn}triggerStatus(e){var t=this.$t(e),r=t===ia?ia:t===hn?hn:aa;return this._instance.register_for_session({$sdk_debug_replay_event_trigger_status:r}),r}stop(){}}function uoe(n){return n.isRecordingEnabled?Fu:ac}function loe(n){if(!n.receivedDecide)return Fu;if(!n.isRecordingEnabled)return ac;if(n.urlTriggerMatching.urlBlocked)return eI;var e=n.isSampled===!0,t=new xq([n.eventTriggerMatching,n.urlTriggerMatching,n.linkedFlagMatching]).triggerStatus(n.sessionId);return e?Q1:t===ia?mx:t===hn?Fu:n.isSampled===!1?ac:mx}function doe(n){if(!n.receivedDecide)return Fu;if(!n.isRecordingEnabled)return ac;if(n.urlTriggerMatching.urlBlocked)return eI;var e=new Eq([n.eventTriggerMatching,n.urlTriggerMatching,n.linkedFlagMatching]).triggerStatus(n.sessionId),t=e!==aa,r=Va(n.isSampled);return t&&e===hn?Fu:t&&e===aa||r&&!n.isSampled?ac:n.isSampled===!0?Q1:mx}var Zg="[SessionRecording]",fn=dn(Zg);function gx(){var n,e;return Ge==null||(n=Ge.__PosthogExtensions__)==null||(e=n.rrweb)==null?void 0:e.record}var hoe=3e5,foe=[Ei.MouseMove,Ei.MouseInteraction,Ei.Scroll,Ei.ViewportResize,Ei.Input,Ei.TouchMove,Ei.MediaInteraction,Ei.Drag],kq=n=>({rrwebMethod:n,enqueuedAt:Date.now(),attempt:1});function Lu(n){return function(e,t){for(var r="",s=0;s<e.length;){var i=e[s++];i<128||t?r+=String.fromCharCode(i):i<224?r+=String.fromCharCode((31&i)<<6|63&e[s++]):i<240?r+=String.fromCharCode((15&i)<<12|(63&e[s++])<<6|63&e[s++]):(i=((15&i)<<18|(63&e[s++])<<12|(63&e[s++])<<6|63&e[s++])-65536,r+=String.fromCharCode(55296|i>>10,56320|1023&i))}return r}(_q(bq(JSON.stringify(n))),!0)}function Cq(n){return n.type===Ja.Custom&&n.data.tag==="sessionIdle"}class poe{get sessionId(){return this.kt}get xt(){return this._instance.config.session_recording.session_idle_threshold_ms||3e5}get started(){return this.Et}get It(){if(!this._instance.sessionManager)throw new Error(Zg+" must be started with a valid sessionManager.");return this._instance.sessionManager}get Pt(){var e,t;return this.Rt.triggerStatus(this.sessionId)===hn?6e4:(e=(t=this._instance.config.session_recording)==null?void 0:t.full_snapshot_interval_millis)!==null&&e!==void 0?e:hoe}get Tt(){var e=this._instance.get_property(Hg);return Va(e)?e:null}get Mt(){var e,t,r=(e=this.M)==null?void 0:e.data[((t=this.M)==null?void 0:t.data.length)-1],{sessionStartTimestamp:s}=this.It.checkAndGetSessionAndWindowId(!0);return r?r.timestamp-s:null}get Ct(){var e=!!this._instance.get_property(b1),t=!this._instance.config.disable_session_recording;return Y&&e&&t}get Ot(){var e=!!this._instance.get_property(CU),t=this._instance.config.enable_recording_console_log;return t??e}get Ft(){var e,t,r,s,i,a,o=this._instance.config.session_recording.captureCanvas,u=this._instance.get_property(TU),l=(e=(t=o==null?void 0:o.recordCanvas)!==null&&t!==void 0?t:u==null?void 0:u.enabled)!==null&&e!==void 0&&e,d=(r=(s=o==null?void 0:o.canvasFps)!==null&&s!==void 0?s:u==null?void 0:u.fps)!==null&&r!==void 0?r:4,h=(i=(a=o==null?void 0:o.canvasQuality)!==null&&a!==void 0?a:u==null?void 0:u.quality)!==null&&i!==void 0?i:.4;if(typeof h=="string"){var f=parseFloat(h);h=isNaN(f)?.4:f}return{enabled:l,fps:qs(d,0,12,"canvas recording fps",4),quality:qs(h,0,1,"canvas recording quality",.4)}}get At(){var e,t,r=this._instance.get_property(PU),s={recordHeaders:(e=this._instance.config.session_recording)==null?void 0:e.recordHeaders,recordBody:(t=this._instance.config.session_recording)==null?void 0:t.recordBody},i=(s==null?void 0:s.recordHeaders)||(r==null?void 0:r.recordHeaders),a=(s==null?void 0:s.recordBody)||(r==null?void 0:r.recordBody),o=ir(this._instance.config.capture_performance)?this._instance.config.capture_performance.network_timing:this._instance.config.capture_performance,u=!!(Va(o)?o:r!=null&&r.capturePerformance);return i||a||u?{recordHeaders:i,recordBody:a,recordPerformance:u}:void 0}get Dt(){var e,t,r,s,i,a,o=this._instance.get_property(AU),u={maskAllInputs:(e=this._instance.config.session_recording)==null?void 0:e.maskAllInputs,maskTextSelector:(t=this._instance.config.session_recording)==null?void 0:t.maskTextSelector,blockSelector:(r=this._instance.config.session_recording)==null?void 0:r.blockSelector},l=(s=u==null?void 0:u.maskAllInputs)!==null&&s!==void 0?s:o==null?void 0:o.maskAllInputs,d=(i=u==null?void 0:u.maskTextSelector)!==null&&i!==void 0?i:o==null?void 0:o.maskTextSelector,h=(a=u==null?void 0:u.blockSelector)!==null&&a!==void 0?a:o==null?void 0:o.blockSelector;return we(l)&&we(d)&&we(h)?void 0:{maskAllInputs:l==null||l,maskTextSelector:d,blockSelector:h}}get jt(){var e=this._instance.get_property(IU);return ln(e)?e:null}get Lt(){var e=this._instance.get_property(OU);return ln(e)?e:null}get status(){return this.Nt?this.zt({receivedDecide:this.Nt,isRecordingEnabled:this.Ct,isSampled:this.Tt,urlTriggerMatching:this.Ut,eventTriggerMatching:this.qt,linkedFlagMatching:this.Bt,sessionId:this.sessionId}):Fu}constructor(e){if(this.zt=uoe,this.Nt=!1,this.Ht=[],this.Wt="unknown",this.Gt=Date.now(),this.Rt=new ioe,this.Jt=void 0,this.Vt=void 0,this.Kt=void 0,this.Yt=void 0,this.Xt=void 0,this._forceAllowLocalhostNetworkCapture=!1,this.Qt=()=>{this.Zt()},this.ti=()=>{this.ii("browser offline",{})},this.ei=()=>{this.ii("browser online",{})},this.ri=()=>{if(Se!=null&&Se.visibilityState){var s="window "+Se.visibilityState;this.ii(s,{})}},this._instance=e,this.Et=!1,this.si="/s/",this.ni=void 0,this.Nt=!1,!this._instance.sessionManager)throw fn.error("started without valid sessionManager"),new Error(Zg+" started without valid sessionManager. This is a bug.");if(this._instance.config.__preview_experimental_cookieless_mode)throw new Error(Zg+" cannot be used with __preview_experimental_cookieless_mode.");this.Bt=new ooe(this._instance),this.Ut=new aoe(this._instance),this.qt=new coe(this._instance);var{sessionId:t,windowId:r}=this.It.checkAndGetSessionAndWindowId();this.kt=t,this.oi=r,this.M=this.ai(),this.xt>=this.It.sessionTimeoutMs&&fn.warn("session_idle_threshold_ms ("+this.xt+") is greater than the session timeout ("+this.It.sessionTimeoutMs+"). Session will never be detected as idle")}startIfEnabledOrStop(e){this.Ct?(this.li(e),rr(Y,"beforeunload",this.Qt),rr(Y,"offline",this.ti),rr(Y,"online",this.ei),rr(Y,"visibilitychange",this.ri),this.hi(),this.ui(),kt(this.Jt)&&(this.Jt=this._instance.on("eventCaptured",t=>{try{if(t.event==="$pageview"){var r=t!=null&&t.properties.$current_url?this.di(t==null?void 0:t.properties.$current_url):"";if(!r)return;this.ii("$pageview",{href:r})}}catch(s){fn.error("Could not add $pageview to rrweb session",s)}})),this.Vt||(this.Vt=this.It.onSessionId((t,r,s)=>{var i,a,o,u;s&&(this.ii("$session_id_change",{sessionId:t,windowId:r,changeReason:s}),(i=this._instance)==null||(a=i.persistence)==null||a.unregister(x1),(o=this._instance)==null||(u=o.persistence)==null||u.unregister(S1))}))):this.stopRecording()}stopRecording(){var e,t,r,s;this.Et&&this.ni&&(this.ni(),this.ni=void 0,this.Et=!1,Y==null||Y.removeEventListener("beforeunload",this.Qt),Y==null||Y.removeEventListener("offline",this.ti),Y==null||Y.removeEventListener("online",this.ei),Y==null||Y.removeEventListener("visibilitychange",this.ri),this.ai(),clearInterval(this.vi),(e=this.Jt)==null||e.call(this),this.Jt=void 0,(t=this.Xt)==null||t.call(this),this.Xt=void 0,(r=this.Vt)==null||r.call(this),this.Vt=void 0,(s=this.Yt)==null||s.call(this),this.Yt=void 0,this.qt.stop(),this.Ut.stop(),this.Bt.stop(),fn.info("stopped"))}ci(){var e;(e=this._instance.persistence)==null||e.unregister(Hg)}fi(e){var t,r=this.kt!==e,s=this.jt;if(ln(s)){var i=this.Tt,a=r||!Va(i),o=a?soe(e,s):i;a&&(o?this.pi(Q1):fn.warn("Sample rate ("+s+") has determined that this sessionId ("+e+") will not be sent to the server."),this.ii("samplingDecisionMade",{sampleRate:s,isSampled:o})),(t=this._instance.persistence)==null||t.register({[Hg]:o})}else this.ci()}onRemoteConfig(e){var t,r,s,i;this.ii("$remote_config_received",e),this.gi(e),(t=e.sessionRecording)!=null&&t.endpoint&&(this.si=(i=e.sessionRecording)==null?void 0:i.endpoint),this.hi(),((r=e.sessionRecording)==null?void 0:r.triggerMatchType)==="any"?(this.zt=loe,this.Rt=new xq([this.qt,this.Ut])):(this.zt=doe,this.Rt=new Eq([this.qt,this.Ut])),this._instance.register_for_session({$sdk_debug_replay_remote_trigger_matching_config:(s=e.sessionRecording)==null?void 0:s.triggerMatchType}),this.Ut.onRemoteConfig(e),this.qt.onRemoteConfig(e),this.Bt.onRemoteConfig(e,(a,o)=>{this.pi("linked_flag_matched",{flag:a,variant:o})}),this.Nt=!0,this.startIfEnabledOrStop()}hi(){ln(this.jt)&&kt(this.Yt)&&(this.Yt=this.It.onSessionId(e=>{this.fi(e)}))}gi(e){if(this._instance.persistence){var t,r=this._instance.persistence,s=()=>{var i,a,o,u,l,d,h,f,p,m=(i=e.sessionRecording)==null?void 0:i.sampleRate,g=kt(m)?null:parseFloat(m);kt(g)&&this.ci();var y=(a=e.sessionRecording)==null?void 0:a.minimumDurationMilliseconds;r.register({[b1]:!!e.sessionRecording,[CU]:(o=e.sessionRecording)==null?void 0:o.consoleLogRecordingEnabled,[PU]:_e({capturePerformance:e.capturePerformance},(u=e.sessionRecording)==null?void 0:u.networkPayloadCapture),[AU]:(l=e.sessionRecording)==null?void 0:l.masking,[TU]:{enabled:(d=e.sessionRecording)==null?void 0:d.recordCanvas,fps:(h=e.sessionRecording)==null?void 0:h.canvasFps,quality:(f=e.sessionRecording)==null?void 0:f.canvasQuality},[IU]:g,[OU]:we(y)?null:y,[RU]:(p=e.sessionRecording)==null?void 0:p.scriptConfig})};s(),(t=this.Kt)==null||t.call(this),this.Kt=this.It.onSessionId(s)}}log(e,t){var r;t===void 0&&(t="log"),(r=this._instance.sessionRecording)==null||r.onRRwebEmit({type:6,data:{plugin:"rrweb/console@1",payload:{level:t,trace:[],payload:[JSON.stringify(e)]}},timestamp:Date.now()})}li(e){if(!we(Object.assign)&&!we(Array.from)&&!(this.Et||this._instance.config.disable_session_recording||this._instance.consent.isOptedOut())){var t;this.Et=!0,this.It.checkAndGetSessionAndWindowId(),gx()?this.mi():(t=Ge.__PosthogExtensions__)==null||t.loadExternalDependency==null||t.loadExternalDependency(this._instance,this.bi,r=>{if(r)return fn.error("could not load recorder",r);this.mi()}),fn.info("starting"),this.status===mx&&this.pi(e||"recording_initialized")}}get bi(){var e,t,r;return((e=this._instance)==null||(t=e.persistence)==null||(r=t.get_property(RU))==null?void 0:r.script)||"recorder"}wi(e){var t;return e.type===3&&foe.indexOf((t=e.data)==null?void 0:t.source)!==-1}yi(e){var t=this.wi(e);t||this.Wt||e.timestamp-this.Gt>this.xt&&(this.Wt=!0,clearInterval(this.vi),this.ii("sessionIdle",{eventTimestamp:e.timestamp,lastActivityTimestamp:this.Gt,threshold:this.xt,bufferLength:this.M.data.length,bufferSize:this.M.size}),this.Zt());var r=!1;if(t&&(this.Gt=e.timestamp,this.Wt)){var s=this.Wt==="unknown";this.Wt=!1,s||(this.ii("sessionNoLongerIdle",{reason:"user activity",type:e.type}),r=!0)}if(!this.Wt){var{windowId:i,sessionId:a}=this.It.checkAndGetSessionAndWindowId(!t,e.timestamp),o=this.kt!==a,u=this.oi!==i;this.oi=i,this.kt=a,o||u?(this.stopRecording(),this.startIfEnabledOrStop("session_id_changed")):r&&this.Si()}}$i(e){try{return e.rrwebMethod(),!0}catch(t){return this.Ht.length<10?this.Ht.push({enqueuedAt:e.enqueuedAt||Date.now(),attempt:e.attempt++,rrwebMethod:e.rrwebMethod}):fn.warn("could not emit queued rrweb event.",t,e),!1}}ii(e,t){return this.$i(kq(()=>gx().addCustomEvent(e,t)))}ki(){return this.$i(kq(()=>gx().takeFullSnapshot()))}mi(){var e,t,r,s,i={blockClass:"ph-no-capture",blockSelector:void 0,ignoreClass:"ph-ignore-input",maskTextClass:"ph-mask",maskTextSelector:void 0,maskTextFn:void 0,maskAllInputs:!0,maskInputOptions:{password:!0},maskInputFn:void 0,slimDOMOptions:{},collectFonts:!1,inlineStylesheet:!0,recordCrossOriginIframes:!1},a=this._instance.config.session_recording;for(var[o,u]of Object.entries(a||{}))o in i&&(o==="maskInputOptions"?i.maskInputOptions=_e({password:!0},u):i[o]=u);this.Ft&&this.Ft.enabled&&(i.recordCanvas=!0,i.sampling={canvas:this.Ft.fps},i.dataURLOptions={type:"image/webp",quality:this.Ft.quality}),this.Dt&&(i.maskAllInputs=(t=this.Dt.maskAllInputs)===null||t===void 0||t,i.maskTextSelector=(r=this.Dt.maskTextSelector)!==null&&r!==void 0?r:void 0,i.blockSelector=(s=this.Dt.blockSelector)!==null&&s!==void 0?s:void 0);var l=gx();if(l){this.xi=(e=this.xi)!==null&&e!==void 0?e:new Gae(l,{refillRate:this._instance.config.session_recording.__mutationRateLimiterRefillRate,bucketSize:this._instance.config.session_recording.__mutationRateLimiterBucketSize,onBlockedNode:(h,f)=>{var p="Too many mutations on node '"+h+"'. Rate limiting. This could be due to SVG animations or something similar";fn.info(p,{node:f}),this.log(Zg+" "+p,"warn")}});var d=this.Ei();this.ni=l(_e({emit:h=>{this.onRRwebEmit(h)},plugins:d},i)),this.Gt=Date.now(),this.Wt=Va(this.Wt)?this.Wt:"unknown",this.ii("$session_options",{sessionRecordingOptions:i,activePlugins:d.map(h=>h==null?void 0:h.name)}),this.ii("$posthog_config",{config:this._instance.config})}else fn.error("onScriptLoaded was called but rrwebRecord is not available. This indicates something has gone wrong.")}Si(){if(this.vi&&clearInterval(this.vi),this.Wt!==!0){var e=this.Pt;e&&(this.vi=setInterval(()=>{this.ki()},e))}}Ei(){var e,t,r,s,i=[],a=(e=Ge.__PosthogExtensions__)==null||(t=e.rrwebPlugins)==null?void 0:t.getRecordConsolePlugin;a&&this.Ot&&i.push(a());var o=(r=Ge.__PosthogExtensions__)==null||(s=r.rrwebPlugins)==null?void 0:s.getRecordNetworkPlugin;return this.At&&Us(o)&&(!hae.includes(location.hostname)||this._forceAllowLocalhostNetworkCapture?i.push(o(Vae(this._instance.config,this.At))):fn.info("NetworkCapture not started because we are on localhost.")),i}onRRwebEmit(e){var t;if(this.Ii(),e&&ir(e)){if(e.type===Ja.Meta){var r=this.di(e.data.href);if(this.Pi=r,!r)return;e.data.href=r}else this.Ri();if(this.Ut.checkUrlTriggerConditions(()=>this.Ti(),()=>this.Mi(),f=>this.Ci(f)),!this.Ut.urlBlocked||(s=e).type===Ja.Custom&&s.data.tag==="recording paused"){var s;e.type===Ja.FullSnapshot&&this.Si(),e.type===Ja.FullSnapshot&&this.Nt&&this.Rt.triggerStatus(this.sessionId)===hn&&this.ai();var i=this.xi?this.xi.throttleMutations(e):e;if(i){var a=function(f){var p=f;if(p&&ir(p)&&p.type===6&&ir(p.data)&&p.data.plugin==="rrweb/console@1"){p.data.payload.payload.length>10&&(p.data.payload.payload=p.data.payload.payload.slice(0,10),p.data.payload.payload.push("...[truncated]"));for(var m=[],g=0;g<p.data.payload.payload.length;g++)p.data.payload.payload[g]&&p.data.payload.payload[g].length>2e3?m.push(p.data.payload.payload[g].slice(0,2e3)+"...[truncated]"):m.push(p.data.payload.payload[g]);return p.data.payload.payload=m,f}return f}(i);if(this.yi(a),this.Wt!==!0||Cq(a)){if(Cq(a)){var o=a.data.payload;if(o){var u=o.lastActivityTimestamp,l=o.threshold;a.timestamp=u+l}}var d=(t=this._instance.config.session_recording.compress_events)===null||t===void 0||t?function(f){if(hx(f)<1024)return f;try{if(f.type===Ja.FullSnapshot)return _e({},f,{data:Lu(f.data),cv:"2024-10"});if(f.type===Ja.IncrementalSnapshot&&f.data.source===Ei.Mutation)return _e({},f,{cv:"2024-10",data:_e({},f.data,{texts:Lu(f.data.texts),attributes:Lu(f.data.attributes),removes:Lu(f.data.removes),adds:Lu(f.data.adds)})});if(f.type===Ja.IncrementalSnapshot&&f.data.source===Ei.StyleSheetRule)return _e({},f,{cv:"2024-10",data:_e({},f.data,{adds:f.data.adds?Lu(f.data.adds):void 0,removes:f.data.removes?Lu(f.data.removes):void 0})})}catch(p){fn.error("could not compress event - will use uncompressed event",p)}return f}(a):a,h={$snapshot_bytes:hx(d),$snapshot_data:d,$session_id:this.kt,$window_id:this.oi};this.status!==ac?this.Oi(h):this.ai()}}}}}Ri(){if(!this._instance.config.capture_pageview&&Y){var e=this.di(Y.location.href);this.Pi!==e&&(this.ii("$url_changed",{href:e}),this.Pi=e)}}Ii(){if(this.Ht.length){var e=[...this.Ht];this.Ht=[],e.forEach(t=>{Date.now()-t.enqueuedAt<=2e3&&this.$i(t)})}}di(e){var t=this._instance.config.session_recording;if(t.maskNetworkRequestFn){var r,s={url:e};return(r=s=t.maskNetworkRequestFn(s))==null?void 0:r.url}return e}ai(){return this.M={size:0,data:[],sessionId:this.kt,windowId:this.oi},this.M}Zt(){this.Fi&&(clearTimeout(this.Fi),this.Fi=void 0);var e=this.Lt,t=this.Mt,r=ln(t)&&t>=0,s=ln(e)&&r&&t<e;return this.status===Fu||this.status===eI||this.status===ac||s?(this.Fi=setTimeout(()=>{this.Zt()},2e3),this.M):(this.M.data.length>0&&H1(this.M).forEach(i=>{this.Ai({$snapshot_bytes:i.size,$snapshot_data:i.data,$session_id:i.sessionId,$window_id:i.windowId,$lib:"web",$lib_version:za.LIB_VERSION})}),this.ai())}Oi(e){var t,r=2+(((t=this.M)==null?void 0:t.data.length)||0);!this.Wt&&(this.M.size+e.$snapshot_bytes+r>943718.4||this.M.sessionId!==this.kt)&&(this.M=this.Zt()),this.M.size+=e.$snapshot_bytes,this.M.data.push(e.$snapshot_data),this.Fi||this.Wt||(this.Fi=setTimeout(()=>{this.Zt()},2e3))}Ai(e){this._instance.capture("$snapshot",e,{_url:this._instance.requestRouter.endpointFor("api",this.si),_noTruncate:!0,_batchKey:"recordings",skip_client_rate_limiting:!0})}Ci(e){var t,r;this.Rt.triggerStatus(this.sessionId)===hn&&((t=this._instance)==null||(r=t.persistence)==null||r.register({[e==="url"?S1:x1]:this.kt}),this.Zt(),this.pi(e+"_trigger_matched"))}Ti(){this.Ut.urlBlocked||(this.Ut.urlBlocked=!0,clearInterval(this.vi),fn.info("recording paused due to URL blocker"),this.ii("recording paused",{reason:"url blocker"}))}Mi(){this.Ut.urlBlocked&&(this.Ut.urlBlocked=!1,this.ki(),this.Si(),this.ii("recording resumed",{reason:"left blocked url"}),fn.info("recording resumed"))}ui(){this.qt.St.length!==0&&kt(this.Xt)&&(this.Xt=this._instance.on("eventCaptured",e=>{try{this.qt.St.includes(e.event)&&this.Ci("event")}catch(t){fn.error("Could not activate event trigger",t)}}))}overrideLinkedFlag(){this.Bt.linkedFlagSeen=!0,this.ki(),this.pi("linked_flag_overridden")}overrideSampling(){var e;(e=this._instance.persistence)==null||e.register({[Hg]:!0}),this.ki(),this.pi("sampling_overridden")}overrideTrigger(e){this.Ci(e)}pi(e,t){this._instance.register_for_session({$session_recording_start_reason:e}),fn.info(e.replace("_"," "),t),nt(["recording_initialized","session_id_changed"],e)||this.ii(e,t)}get sdkDebugProperties(){var{sessionStartTimestamp:e}=this.It.checkAndGetSessionAndWindowId(!0);return{$recording_status:this.status,$sdk_debug_replay_internal_buffer_length:this.M.data.length,$sdk_debug_replay_internal_buffer_size:this.M.size,$sdk_debug_current_session_duration:this.Mt,$sdk_debug_session_start:e}}}var rI=dn("[SegmentIntegration]");function moe(n,e){var t=n.config.segment;if(!t)return e();(function(r,s){var i=r.config.segment;if(!i)return s();var a=u=>{var l=()=>u.anonymousId()||sc();r.config.get_device_id=l,u.id()&&(r.register({distinct_id:u.id(),$device_id:l()}),r.persistence.set_property(Ga,"identified")),s()},o=i.user();"then"in o&&Us(o.then)?o.then(u=>a(u)):a(o)})(n,()=>{t.register((r=>{Promise&&Promise.resolve||rI.warn("This browser does not have Promise support, and can not use the segment integration");var s=(i,a)=>{if(!a)return i;i.event.userId||i.event.anonymousId===r.get_distinct_id()||(rI.info("No userId set, resetting PostHog"),r.reset()),i.event.userId&&i.event.userId!==r.get_distinct_id()&&(rI.info("UserId set, identifying with PostHog"),r.identify(i.event.userId));var o=r.calculateEventProperties(a,i.event.properties);return i.event.properties=Object.assign({},o,i.event.properties),i};return{name:"PostHog JS",type:"enrichment",version:"1.0.0",isLoaded:()=>!0,load:()=>Promise.resolve(),track:i=>s(i,i.event.event),page:i=>s(i,"$pageview"),identify:i=>s(i,"$identify"),screen:i=>s(i,"$screen")}})(n)).then(()=>{e()})})}var Pq="posthog-js";function Aq(n,e){var{organization:t,projectId:r,prefix:s,severityAllowList:i=["error"]}=e===void 0?{}:e;return a=>{var o,u,l,d,h;if(!(i==="*"||i.includes(a.level))||!n.__loaded)return a;a.tags||(a.tags={});var f=n.requestRouter.endpointFor("ui","/project/"+n.config.token+"/person/"+n.get_distinct_id());a.tags["PostHog Person URL"]=f,n.sessionRecordingStarted()&&(a.tags["PostHog Recording URL"]=n.get_session_replay_url({withTimestamp:!0}));var p=((o=a.exception)==null?void 0:o.values)||[],m=p.map(y=>_e({},y,{stacktrace:y.stacktrace?_e({},y.stacktrace,{type:"raw",frames:(y.stacktrace.frames||[]).map(w=>_e({},w,{platform:"web:javascript"}))}):void 0})),g={$exception_message:((u=p[0])==null?void 0:u.value)||a.message,$exception_type:(l=p[0])==null?void 0:l.type,$exception_personURL:f,$exception_level:a.level,$exception_list:m,$sentry_event_id:a.event_id,$sentry_exception:a.exception,$sentry_exception_message:((d=p[0])==null?void 0:d.value)||a.message,$sentry_exception_type:(h=p[0])==null?void 0:h.type,$sentry_tags:a.tags};return t&&r&&(g.$sentry_url=(s||"https://sentry.io/organizations/")+t+"/issues/?project="+r+"&query="+a.event_id),n.exceptions.sendExceptionEvent(g),a}}class goe{constructor(e,t,r,s,i){this.name=Pq,this.setupOnce=function(a){a(Aq(e,{organization:t,projectId:r,prefix:s,severityAllowList:i}))}}}var Ya,yoe=Y!=null&&Y.location?ix(Y.location.hash,"__posthog")||ix(location.hash,"state"):null,Tq="_postHogToolbarParams",Iq=dn("[Toolbar]");(function(n){n[n.UNINITIALIZED=0]="UNINITIALIZED",n[n.LOADING=1]="LOADING",n[n.LOADED=2]="LOADED"})(Ya||(Ya={}));class woe{constructor(e){this.instance=e}Di(e){Ge.ph_toolbar_state=e}ji(){var e;return(e=Ge.ph_toolbar_state)!==null&&e!==void 0?e:Ya.UNINITIALIZED}maybeLoadToolbar(e,t,r){var s,i;if(e===void 0&&(e=void 0),t===void 0&&(t=void 0),r===void 0&&(r=void 0),!Y||!Se)return!1;e=(s=e)!==null&&s!==void 0?s:Y.location,r=(i=r)!==null&&i!==void 0?i:Y.history;try{if(!t){try{Y.localStorage.setItem("test","test"),Y.localStorage.removeItem("test")}catch{return!1}t=Y==null?void 0:Y.localStorage}var a,o=yoe||ix(e.hash,"__posthog")||ix(e.hash,"state"),u=o?wU(()=>JSON.parse(atob(decodeURIComponent(o))))||wU(()=>JSON.parse(decodeURIComponent(o))):null;return u&&u.action==="ph_authorize"?((a=u).source="url",a&&Object.keys(a).length>0&&(u.desiredHash?e.hash=u.desiredHash:r?r.replaceState(r.state,"",e.pathname+e.search):e.hash="")):((a=JSON.parse(t.getItem(Tq)||"{}")).source="localstorage",delete a.userIntent),!(!a.token||this.instance.config.token!==a.token)&&(this.loadToolbar(a),!0)}catch{return!1}}Li(e){var t=Ge.ph_load_toolbar||Ge.ph_load_editor;!kt(t)&&Us(t)?t(e,this.instance):Iq.warn("No toolbar load function found")}loadToolbar(e){var t=!(Se==null||!Se.getElementById(MU));if(!Y||t)return!1;var r=this.instance.requestRouter.region==="custom"&&this.instance.config.advanced_disable_toolbar_metrics,s=_e({token:this.instance.config.token},e,{apiURL:this.instance.requestRouter.endpointFor("ui")},r?{instrument:!1}:{});if(Y.localStorage.setItem(Tq,JSON.stringify(_e({},s,{source:void 0}))),this.ji()===Ya.LOADED)this.Li(s);else if(this.ji()===Ya.UNINITIALIZED){var i;this.Di(Ya.LOADING),(i=Ge.__PosthogExtensions__)==null||i.loadExternalDependency==null||i.loadExternalDependency(this.instance,"toolbar",a=>{if(a)return Iq.error("[Toolbar] Failed to load",a),void this.Di(Ya.UNINITIALIZED);this.Di(Ya.LOADED),this.Li(s)}),rr(Y,"turbolinks:load",()=>{this.Di(Ya.UNINITIALIZED),this.loadToolbar(s)})}return!0}Ni(e){return this.loadToolbar(e)}maybeLoadEditor(e,t,r){return e===void 0&&(e=void 0),t===void 0&&(t=void 0),r===void 0&&(r=void 0),this.maybeLoadToolbar(e,t,r)}}var voe=dn("[TracingHeaders]");class _oe{constructor(e){this.zi=void 0,this.Ui=void 0,this.V=()=>{var t,r,s,i;we(this.zi)&&((t=Ge.__PosthogExtensions__)==null||(r=t.tracingHeadersPatchFns)==null||r._patchXHR(this._instance.sessionManager)),we(this.Ui)&&((s=Ge.__PosthogExtensions__)==null||(i=s.tracingHeadersPatchFns)==null||i._patchFetch(this._instance.sessionManager))},this._instance=e}G(e){var t,r;(t=Ge.__PosthogExtensions__)!=null&&t.tracingHeadersPatchFns&&e(),(r=Ge.__PosthogExtensions__)==null||r.loadExternalDependency==null||r.loadExternalDependency(this._instance,"tracing-headers",s=>{if(s)return voe.error("failed to load script",s);e()})}startIfEnabledOrStop(){var e,t;this._instance.config.__add_tracing_headers?this.G(this.V):((e=this.zi)==null||e.call(this),(t=this.Ui)==null||t.call(this),this.zi=void 0,this.Ui=void 0)}}var oc=dn("[Web Vitals]"),Oq=9e5;class boe{constructor(e){var t;this.qi=!1,this.i=!1,this.M={url:void 0,metrics:[],firstMetricTimestamp:void 0},this.Bi=()=>{clearTimeout(this.Hi),this.M.metrics.length!==0&&(this._instance.capture("$web_vitals",this.M.metrics.reduce((r,s)=>_e({},r,{["$web_vitals_"+s.name+"_event"]:_e({},s),["$web_vitals_"+s.name+"_value"]:s.value}),{})),this.M={url:void 0,metrics:[],firstMetricTimestamp:void 0})},this.Wi=r=>{var s,i=(s=this._instance.sessionManager)==null?void 0:s.checkAndGetSessionAndWindowId(!0);if(we(i))oc.error("Could not read session ID. Dropping metrics!");else{this.M=this.M||{url:void 0,metrics:[],firstMetricTimestamp:void 0};var a=this.Gi();we(a)||(kt(r==null?void 0:r.name)||kt(r==null?void 0:r.value)?oc.error("Invalid metric received",r):this.Ji&&r.value>=this.Ji?oc.error("Ignoring metric with value >= "+this.Ji,r):(this.M.url!==a&&(this.Bi(),this.Hi=setTimeout(this.Bi,this.flushToCaptureTimeoutMs)),we(this.M.url)&&(this.M.url=a),this.M.firstMetricTimestamp=we(this.M.firstMetricTimestamp)?Date.now():this.M.firstMetricTimestamp,r.attribution&&r.attribution.interactionTargetElement&&(r.attribution.interactionTargetElement=void 0),this.M.metrics.push(_e({},r,{$current_url:a,$session_id:i.sessionId,$window_id:i.windowId,timestamp:Date.now()})),this.M.metrics.length===this.allowedMetrics.length&&this.Bi()))}},this.V=()=>{var r,s,i,a,o=Ge.__PosthogExtensions__;we(o)||we(o.postHogWebVitalsCallbacks)||({onLCP:r,onCLS:s,onFCP:i,onINP:a}=o.postHogWebVitalsCallbacks),r&&s&&i&&a?(this.allowedMetrics.indexOf("LCP")>-1&&r(this.Wi.bind(this)),this.allowedMetrics.indexOf("CLS")>-1&&s(this.Wi.bind(this)),this.allowedMetrics.indexOf("FCP")>-1&&i(this.Wi.bind(this)),this.allowedMetrics.indexOf("INP")>-1&&a(this.Wi.bind(this)),this.i=!0):oc.error("web vitals callbacks not loaded - not starting")},this._instance=e,this.qi=!((t=this._instance.persistence)==null||!t.props[xU]),this.startIfEnabled()}get allowedMetrics(){var e,t,r=ir(this._instance.config.capture_performance)?(e=this._instance.config.capture_performance)==null?void 0:e.web_vitals_allowed_metrics:void 0;return we(r)?((t=this._instance.persistence)==null?void 0:t.props[kU])||["CLS","FCP","INP","LCP"]:r}get flushToCaptureTimeoutMs(){return(ir(this._instance.config.capture_performance)?this._instance.config.capture_performance.web_vitals_delayed_flush_ms:void 0)||5e3}get Ji(){var e=ir(this._instance.config.capture_performance)&&ln(this._instance.config.capture_performance.__web_vitals_max_value)?this._instance.config.capture_performance.__web_vitals_max_value:Oq;return 0<e&&e<=6e4?Oq:e}get isEnabled(){var e=Yn==null?void 0:Yn.protocol;if(e!=="http:"&&e!=="https:")return oc.info("Web Vitals are disabled on non-http/https protocols"),!1;var t=ir(this._instance.config.capture_performance)?this._instance.config.capture_performance.web_vitals:Va(this._instance.config.capture_performance)?this._instance.config.capture_performance:void 0;return Va(t)?t:this.qi}startIfEnabled(){this.isEnabled&&!this.i&&(oc.info("enabled, starting..."),this.G(this.V))}onRemoteConfig(e){var t=ir(e.capturePerformance)&&!!e.capturePerformance.web_vitals,r=ir(e.capturePerformance)?e.capturePerformance.web_vitals_allowed_metrics:void 0;this._instance.persistence&&(this._instance.persistence.register({[xU]:t}),this._instance.persistence.register({[kU]:r})),this.qi=t,this.startIfEnabled()}G(e){var t,r;(t=Ge.__PosthogExtensions__)!=null&&t.postHogWebVitalsCallbacks&&e(),(r=Ge.__PosthogExtensions__)==null||r.loadExternalDependency==null||r.loadExternalDependency(this._instance,"web-vitals",s=>{s?oc.error("failed to load script",s):e()})}Gi(){var e=Y?Y.location.href:void 0;return e||oc.error("Could not determine current URL"),e}}var Soe=dn("[Heatmaps]");function Rq(n){return ir(n)&&"clientX"in n&&"clientY"in n&&ln(n.clientX)&&ln(n.clientY)}class xoe{constructor(e){var t;this.rageclicks=new GU,this.qi=!1,this.i=!1,this.Vi=null,this.instance=e,this.qi=!((t=this.instance.persistence)==null||!t.props[_1])}get flushIntervalMilliseconds(){var e=5e3;return ir(this.instance.config.capture_heatmaps)&&this.instance.config.capture_heatmaps.flush_interval_milliseconds&&(e=this.instance.config.capture_heatmaps.flush_interval_milliseconds),e}get isEnabled(){return we(this.instance.config.capture_heatmaps)?we(this.instance.config.enable_heatmaps)?this.qi:this.instance.config.enable_heatmaps:this.instance.config.capture_heatmaps!==!1}startIfEnabled(){if(this.isEnabled){if(this.i)return;Soe.info("starting..."),this.Ki(),this.Vi=setInterval(this.Yi.bind(this),this.flushIntervalMilliseconds)}else{var e,t;clearInterval((e=this.Vi)!==null&&e!==void 0?e:void 0),(t=this.Xi)==null||t.stop(),this.getAndClearBuffer()}}onRemoteConfig(e){var t=!!e.heatmaps;this.instance.persistence&&this.instance.persistence.register({[_1]:t}),this.qi=t,this.startIfEnabled()}getAndClearBuffer(){var e=this.M;return this.M=void 0,e}Qi(e){this.Zi(e.originalEvent,"deadclick")}Ki(){Y&&Se&&(rr(Y,"beforeunload",this.Yi.bind(this)),rr(Se,"click",e=>this.Zi(e||(Y==null?void 0:Y.event)),{capture:!0}),rr(Se,"mousemove",e=>this.te(e||(Y==null?void 0:Y.event)),{capture:!0}),this.Xi=new QU(this.instance,Pae,this.Qi.bind(this)),this.Xi.startIfEnabled(),this.i=!0)}ie(e,t){var r=this.instance.scrollManager.scrollY(),s=this.instance.scrollManager.scrollX(),i=this.instance.scrollManager.scrollElement(),a=function(o,u,l){for(var d=o;d&&tx(d)&&!nc(d,"body");){if(d===l)return!1;if(nt(u,Y==null?void 0:Y.getComputedStyle(d).position))return!0;d=UU(d)}return!1}(BU(e),["fixed","sticky"],i);return{x:e.clientX+(a?0:s),y:e.clientY+(a?0:r),target_fixed:a,type:t}}Zi(e,t){var r;if(t===void 0&&(t="click"),!NU(e.target)&&Rq(e)){var s=this.ie(e,t);(r=this.rageclicks)!=null&&r.isRageClick(e.clientX,e.clientY,new Date().getTime())&&this.ee(_e({},s,{type:"rageclick"})),this.ee(s)}}te(e){!NU(e.target)&&Rq(e)&&(clearTimeout(this.re),this.re=setTimeout(()=>{this.ee(this.ie(e,"mousemove"))},500))}ee(e){if(Y){var t=Y.location.href;this.M=this.M||{},this.M[t]||(this.M[t]=[]),this.M[t].push(e)}}Yi(){this.M&&!Mh(this.M)&&this.instance.capture("$$heatmap",{$heatmap_data:this.getAndClearBuffer()})}}class Eoe{constructor(e){this._instance=e}doPageView(e,t){var r,s=this.se(e,t);return this.ne={pathname:(r=Y==null?void 0:Y.location.pathname)!==null&&r!==void 0?r:"",pageViewId:t,timestamp:e},this._instance.scrollManager.resetContext(),s}doPageLeave(e){var t;return this.se(e,(t=this.ne)==null?void 0:t.pageViewId)}doEvent(){var e;return{$pageview_id:(e=this.ne)==null?void 0:e.pageViewId}}se(e,t){var r=this.ne;if(!r)return{$pageview_id:t};var s={$pageview_id:t,$prev_pageview_id:r.pageViewId},i=this._instance.scrollManager.getContext();if(i&&!this._instance.config.disable_scroll_properties){var{maxScrollHeight:a,lastScrollY:o,maxScrollY:u,maxContentHeight:l,lastContentY:d,maxContentY:h}=i;if(!(we(a)||we(o)||we(u)||we(l)||we(d)||we(h))){a=Math.ceil(a),o=Math.ceil(o),u=Math.ceil(u),l=Math.ceil(l),d=Math.ceil(d),h=Math.ceil(h);var f=a<=1?1:qs(o/a,0,1),p=a<=1?1:qs(u/a,0,1),m=l<=1?1:qs(d/l,0,1),g=l<=1?1:qs(h/l,0,1);s=pr(s,{$prev_pageview_last_scroll:o,$prev_pageview_last_scroll_percentage:f,$prev_pageview_max_scroll:u,$prev_pageview_max_scroll_percentage:p,$prev_pageview_last_content:d,$prev_pageview_last_content_percentage:m,$prev_pageview_max_content:h,$prev_pageview_max_content_percentage:g})}}return r.pathname&&(s.$prev_pageview_pathname=r.pathname),r.timestamp&&(s.$prev_pageview_duration=(e.getTime()-r.timestamp.getTime())/1e3),s}}class koe{constructor(e){this._instance=e}sendExceptionEvent(e){this._instance.capture("$exception",e,{_noTruncate:!0,_batchKey:"exceptionEvent"})}}var Ks="Mobile",yx="iOS",oa="Android",Jg="Tablet",Mq=oa+" "+Jg,$q="iPad",Nq="Apple",Fq=Nq+" Watch",Xg="Safari",Dh="BlackBerry",Lq="Samsung",jq=Lq+"Browser",Dq=Lq+" Internet",ju="Chrome",Coe=ju+" OS",Bq=ju+" "+yx,nI="Internet Explorer",Uq=nI+" "+Ks,sI="Opera",Poe=sI+" Mini",iI="Edge",qq="Microsoft "+iI,Bh="Firefox",Hq=Bh+" "+yx,Yg="Nintendo",Qg="PlayStation",Uh="Xbox",Kq=oa+" "+Ks,Wq=Ks+" "+Xg,ey="Windows",aI=ey+" Phone",zq="Nokia",oI="Ouya",Vq="Generic",Aoe=Vq+" "+Ks.toLowerCase(),Gq=Vq+" "+Jg.toLowerCase(),cI="Konqueror",In="(\\d+(\\.\\d+)?)",uI=new RegExp("Version/"+In),Toe=new RegExp(Uh,"i"),Ioe=new RegExp(Qg+" \\w+","i"),Ooe=new RegExp(Yg+" \\w+","i"),lI=new RegExp(Dh+"|PlayBook|BB10","i"),Roe={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000",5.1:"XP",5.2:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1",6.4:"10","10.0":"10"},Moe=(n,e)=>e&&nt(e,Nq)||function(t){return nt(t,Xg)&&!nt(t,ju)&&!nt(t,oa)}(n),Zq=function(n,e){return e=e||"",nt(n," OPR/")&&nt(n,"Mini")?Poe:nt(n," OPR/")?sI:lI.test(n)?Dh:nt(n,"IE"+Ks)||nt(n,"WPDesktop")?Uq:nt(n,jq)?Dq:nt(n,iI)||nt(n,"Edg/")?qq:nt(n,"FBIOS")?"Facebook "+Ks:nt(n,"UCWEB")||nt(n,"UCBrowser")?"UC Browser":nt(n,"CriOS")?Bq:nt(n,"CrMo")||nt(n,ju)?ju:nt(n,oa)&&nt(n,Xg)?Kq:nt(n,"FxiOS")?Hq:nt(n.toLowerCase(),cI.toLowerCase())?cI:Moe(n,e)?nt(n,Ks)?Wq:Xg:nt(n,Bh)?Bh:nt(n,"MSIE")||nt(n,"Trident/")?nI:nt(n,"Gecko")?Bh:""},$oe={[Uq]:[new RegExp("rv:"+In)],[qq]:[new RegExp(iI+"?\\/"+In)],[ju]:[new RegExp("("+ju+"|CrMo)\\/"+In)],[Bq]:[new RegExp("CriOS\\/"+In)],"UC Browser":[new RegExp("(UCBrowser|UCWEB)\\/"+In)],[Xg]:[uI],[Wq]:[uI],[sI]:[new RegExp("(Opera|OPR)\\/"+In)],[Bh]:[new RegExp(Bh+"\\/"+In)],[Hq]:[new RegExp("FxiOS\\/"+In)],[cI]:[new RegExp("Konqueror[:/]?"+In,"i")],[Dh]:[new RegExp(Dh+" "+In),uI],[Kq]:[new RegExp("android\\s"+In,"i")],[Dq]:[new RegExp(jq+"\\/"+In)],[nI]:[new RegExp("(rv:|MSIE )"+In)],Mozilla:[new RegExp("rv:"+In)]},Noe=function(n,e){var t=Zq(n,e),r=$oe[t];if(we(r))return null;for(var s=0;s<r.length;s++){var i=r[s],a=n.match(i);if(a)return parseFloat(a[a.length-2])}return null},Jq=[[new RegExp(Uh+"; "+Uh+" (.*?)[);]","i"),n=>[Uh,n&&n[1]||""]],[new RegExp(Yg,"i"),[Yg,""]],[new RegExp(Qg,"i"),[Qg,""]],[lI,[Dh,""]],[new RegExp(ey,"i"),(n,e)=>{if(/Phone/.test(e)||/WPDesktop/.test(e))return[aI,""];if(new RegExp(Ks).test(e)&&!/IEMobile\b/.test(e))return[ey+" "+Ks,""];var t=/Windows NT ([0-9.]+)/i.exec(e);if(t&&t[1]){var r=t[1],s=Roe[r]||"";return/arm/i.test(e)&&(s="RT"),[ey,s]}return[ey,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,n=>{if(n&&n[3]){var e=[n[3],n[4],n[5]||"0"];return[yx,e.join(".")]}return[yx,""]}],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,n=>{var e="";return n&&n.length>=3&&(e=we(n[2])?n[3]:n[2]),["watchOS",e]}],[new RegExp("("+oa+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+oa+")","i"),n=>{if(n&&n[2]){var e=[n[2],n[3],n[4]||"0"];return[oa,e.join(".")]}return[oa,""]}],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,n=>{var e=["Mac OS X",""];if(n&&n[1]){var t=[n[1],n[2],n[3]||"0"];e[1]=t.join(".")}return e}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[Coe,""]],[/Linux|debian/i,["Linux",""]]],Xq=function(n){return Ooe.test(n)?Yg:Ioe.test(n)?Qg:Toe.test(n)?Uh:new RegExp(oI,"i").test(n)?oI:new RegExp("("+aI+"|WPDesktop)","i").test(n)?aI:/iPad/.test(n)?$q:/iPod/.test(n)?"iPod Touch":/iPhone/.test(n)?"iPhone":/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i.test(n)?Fq:lI.test(n)?Dh:/(kobo)\s(ereader|touch)/i.test(n)?"Kobo":new RegExp(zq,"i").test(n)?zq:/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i.test(n)||/(kf[a-z]+)( bui|\)).+silk\//i.test(n)?"Kindle Fire":/(Android|ZTE)/i.test(n)?!new RegExp(Ks).test(n)||/(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(n)?/pixel[\daxl ]{1,6}/i.test(n)&&!/pixel c/i.test(n)||/(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(n)||/lmy47v/i.test(n)&&!/QTAQZ3/i.test(n)?oa:Mq:oa:new RegExp("(pda|"+Ks+")","i").test(n)?Aoe:new RegExp(Jg,"i").test(n)&&!new RegExp(Jg+" pc","i").test(n)?Gq:""},wx="https?://(.*)",vx=["gclid","gclsrc","dclid","gbraid","wbraid","fbclid","msclkid","twclid","li_fat_id","igshid","ttclid","rdt_cid","epik","qclid","sccid","irclid","_kx"],Foe=VS(["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gad_source","mc_cid"],vx),dI="<masked>";function Yq(n,e,t){if(!Se)return{};var r=e?VS([],vx,t||[]):[];return Qq(M1(Se.URL,r,dI),n)}function Qq(n,e){var t=Foe.concat(e||[]),r={};return jt(t,function(s){var i=sx(n,s);r[s]=i||null}),r}function e4(n){var e=function(i){return i?i.search(wx+"google.([^/?]*)")===0?"google":i.search(wx+"bing.com")===0?"bing":i.search(wx+"yahoo.com")===0?"yahoo":i.search(wx+"duckduckgo.com")===0?"duckduckgo":null:null}(n),t=e!="yahoo"?"q":"p",r={};if(!tc(e)){r.$search_engine=e;var s=Se?sx(Se.referrer,t):"";s.length&&(r.ph_keyword=s)}return r}function t4(){return navigator.language||navigator.userLanguage}function r4(){return(Se==null?void 0:Se.referrer)||"$direct"}function n4(n,e){var t=n?VS([],vx,e||[]):[],r=Yn==null?void 0:Yn.href.substring(0,1e3);return{r:r4().substring(0,1e3),u:r?M1(r,t,dI):void 0}}function s4(n){var e,{r:t,u:r}=n,s={$referrer:t,$referring_domain:t==null?void 0:t=="$direct"?"$direct":(e=Fh(t))==null?void 0:e.host};if(r){s.$current_url=r;var i=Fh(r);s.$host=i==null?void 0:i.host,s.$pathname=i==null?void 0:i.pathname;var a=Qq(r);pr(s,a)}if(t){var o=e4(t);pr(s,o)}return s}function i4(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return}}function Loe(){try{return new Date().getTimezoneOffset()}catch{return}}function joe(n,e){if(!Qn)return{};var t,r,s,i=n?VS([],vx,e||[]):[],[a,o]=function(u){for(var l=0;l<Jq.length;l++){var[d,h]=Jq[l],f=d.exec(u),p=f&&(Us(h)?h(f,u):h);if(p)return p}return["",""]}(Qn);return pr(v1({$os:a,$os_version:o,$browser:Zq(Qn,navigator.vendor),$device:Xq(Qn),$device_type:(r=Qn,s=Xq(r),s===$q||s===Mq||s==="Kobo"||s==="Kindle Fire"||s===Gq?Jg:s===Yg||s===Uh||s===Qg||s===oI?"Console":s===Fq?"Wearable":s?Ks:"Desktop"),$timezone:i4(),$timezone_offset:Loe()}),{$current_url:M1(Yn==null?void 0:Yn.href,i,dI),$host:Yn==null?void 0:Yn.host,$pathname:Yn==null?void 0:Yn.pathname,$raw_user_agent:Qn.length>1e3?Qn.substring(0,997)+"...":Qn,$browser_version:Noe(Qn,navigator.vendor),$browser_language:t4(),$browser_language_prefix:(t=t4(),typeof t=="string"?t.split("-")[0]:void 0),$screen_height:Y==null?void 0:Y.screen.height,$screen_width:Y==null?void 0:Y.screen.width,$viewport_height:Y==null?void 0:Y.innerHeight,$viewport_width:Y==null?void 0:Y.innerWidth,$lib:"web",$lib_version:za.LIB_VERSION,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:Date.now()/1e3})}var hI,ca=dn("[FeatureFlags]"),fI="$active_feature_flags",qh="$override_feature_flags",a4="$feature_flag_payloads",ty="$override_feature_flag_payloads",o4="$feature_flag_request_id",c4=n=>{var e={};for(var[t,r]of GS(n||{}))r&&(e[t]=r);return e},Doe=n=>{var e=n.flags;return e?(n.featureFlags=Object.fromEntries(Object.keys(e).map(t=>{var r;return[t,(r=e[t].variant)!==null&&r!==void 0?r:e[t].enabled]})),n.featureFlagPayloads=Object.fromEntries(Object.keys(e).filter(t=>e[t].enabled).filter(t=>{var r;return(r=e[t].metadata)==null?void 0:r.payload}).map(t=>{var r;return[t,(r=e[t].metadata)==null?void 0:r.payload]}))):ca.warn("Using an older version of the feature flags endpoint. Please upgrade your PostHog server to the latest version"),n};(function(n){n.FeatureFlags="feature_flags",n.Recordings="recordings"})(hI||(hI={}));class Boe{constructor(e){this.oe=!1,this.ae=!1,this.le=!1,this.he=!1,this.ue=!1,this.de=!1,this.ve=!1,this._instance=e,this.featureFlagEventHandlers=[]}decide(){if(this._instance.config.__preview_remote_config)this.de=!0;else{var e=!this.ce&&(this._instance.config.advanced_disable_feature_flags||this._instance.config.advanced_disable_feature_flags_on_first_load);this.fe({disableFlags:e})}}get hasLoadedFlags(){return this.ae}getFlags(){return Object.keys(this.getFlagVariants())}getFlagsWithDetails(){var e=this._instance.get_property(E1),t=this._instance.get_property(qh),r=this._instance.get_property(ty);if(!r&&!t)return e||{};var s=pr({},e||{}),i=[...new Set([...Object.keys(r||{}),...Object.keys(t||{})])];for(var a of i){var o,u,l=s[a],d=t==null?void 0:t[a],h=we(d)?(o=l==null?void 0:l.enabled)!==null&&o!==void 0&&o:!!d,f=we(d)?l.variant:typeof d=="string"?d:void 0,p=r==null?void 0:r[a],m=_e({},l,{enabled:h,variant:h?f??(l==null?void 0:l.variant):void 0});h!==(l==null?void 0:l.enabled)&&(m.original_enabled=l==null?void 0:l.enabled),f!==(l==null?void 0:l.variant)&&(m.original_variant=l==null?void 0:l.variant),p&&(m.metadata=_e({},l==null?void 0:l.metadata,{payload:p,original_payload:l==null||(u=l.metadata)==null?void 0:u.payload})),s[a]=m}return this.oe||(ca.warn(" Overriding feature flag details!",{flagDetails:e,overriddenPayloads:r,finalDetails:s}),this.oe=!0),s}getFlagVariants(){var e=this._instance.get_property($h),t=this._instance.get_property(qh);if(!t)return e||{};for(var r=pr({},e),s=Object.keys(t),i=0;i<s.length;i++)r[s[i]]=t[s[i]];return this.oe||(ca.warn(" Overriding feature flags!",{enabledFlags:e,overriddenFlags:t,finalFlags:r}),this.oe=!0),r}getFlagPayloads(){var e=this._instance.get_property(a4),t=this._instance.get_property(ty);if(!t)return e||{};for(var r=pr({},e||{}),s=Object.keys(t),i=0;i<s.length;i++)r[s[i]]=t[s[i]];return this.oe||(ca.warn(" Overriding feature flag payloads!",{flagPayloads:e,overriddenPayloads:t,finalPayloads:r}),this.oe=!0),r}reloadFeatureFlags(){this.he||this._instance.config.advanced_disable_feature_flags||this.ce||(this.ce=setTimeout(()=>{this.fe()},5))}pe(){clearTimeout(this.ce),this.ce=void 0}ensureFlagsLoaded(){this.ae||this.le||this.ce||this.reloadFeatureFlags()}setAnonymousDistinctId(e){this.$anon_distinct_id=e}setReloadingPaused(e){this.he=e}fe(e){var t;if(this.pe(),!this._instance.config.advanced_disable_decide)if(this.le)this.ue=!0;else{var r={token:this._instance.config.token,distinct_id:this._instance.get_distinct_id(),groups:this._instance.getGroups(),$anon_distinct_id:this.$anon_distinct_id,person_properties:_e({},((t=this._instance.persistence)==null?void 0:t.get_initial_props())||{},this._instance.get_property(Kg)||{}),group_properties:this._instance.get_property(Ru)};(e!=null&&e.disableFlags||this._instance.config.advanced_disable_feature_flags)&&(r.disable_flags=!0);var s=this._instance.config.__preview_flags_v2&&this._instance.config.__preview_remote_config;s&&(r.timezone=i4()),this.le=!0,this._instance.ge({method:"POST",url:this._instance.requestRouter.endpointFor("api",s?"/flags/?v=2":"/decide/?v=4"),data:r,compression:this._instance.config.disable_compression?void 0:xi.Base64,timeout:this._instance.config.feature_flag_request_timeout_ms,callback:i=>{var a,o,u,l=!0;i.statusCode===200&&(this.ue||(this.$anon_distinct_id=void 0),l=!1),this.le=!1,this.de||(this.de=!0,this._instance._e((u=i.json)!==null&&u!==void 0?u:{})),r.disable_flags&&!this.ue||(this.ve=!l,i.json&&(a=i.json.quotaLimited)!=null&&a.includes(hI.FeatureFlags)?ca.warn("You have hit your feature flags quota limit, and will not be able to load feature flags until the quota is reset.  Please visit https://posthog.com/docs/billing/limits-alerts to learn more."):(this.receivedFeatureFlags((o=i.json)!==null&&o!==void 0?o:{},l),this.ue&&(this.ue=!1,this.fe())))}})}}getFeatureFlag(e,t){if(t===void 0&&(t={}),this.ae||this.getFlags()&&this.getFlags().length>0){var r=this.getFlagVariants()[e],s=""+r,i=this._instance.get_property(o4)||void 0,a=this._instance.get_property(YS)||{};if((t.send_event||!("send_event"in t))&&(!(e in a)||!a[e].includes(s))){var o,u,l,d,h,f,p,m,g,y,w;sr(a[e])?a[e].push(s):a[e]=[s],(o=this._instance.persistence)==null||o.register({[YS]:a});var v=this.getFeatureFlagDetails(e),b={$feature_flag:e,$feature_flag_response:r,$feature_flag_payload:this.getFeatureFlagPayload(e)||null,$feature_flag_request_id:i,$feature_flag_bootstrapped_response:((u=this._instance.config.bootstrap)==null||(l=u.featureFlags)==null?void 0:l[e])||null,$feature_flag_bootstrapped_payload:((d=this._instance.config.bootstrap)==null||(h=d.featureFlagPayloads)==null?void 0:h[e])||null,$used_bootstrap_value:!this.ve};we(v==null||(f=v.metadata)==null?void 0:f.version)||(b.$feature_flag_version=v.metadata.version);var S,P=(p=v==null||(m=v.reason)==null?void 0:m.description)!==null&&p!==void 0?p:v==null||(g=v.reason)==null?void 0:g.code;P&&(b.$feature_flag_reason=P),v!=null&&(y=v.metadata)!=null&&y.id&&(b.$feature_flag_id=v.metadata.id),we(v==null?void 0:v.original_variant)&&we(v==null?void 0:v.original_enabled)||(b.$feature_flag_original_response=we(v.original_variant)?v.original_enabled:v.original_variant),v!=null&&(w=v.metadata)!=null&&w.original_payload&&(b.$feature_flag_original_payload=v==null||(S=v.metadata)==null?void 0:S.original_payload),this._instance.capture("$feature_flag_called",b)}return r}ca.warn('getFeatureFlag for key "'+e+`" failed. Feature flags didn't load in time.`)}getFeatureFlagDetails(e){return this.getFlagsWithDetails()[e]}getFeatureFlagPayload(e){return this.getFlagPayloads()[e]}getRemoteConfigPayload(e,t){var r=this._instance.config.token;this._instance.ge({method:"POST",url:this._instance.requestRouter.endpointFor("api","/decide/?v=4"),data:{distinct_id:this._instance.get_distinct_id(),token:r},compression:this._instance.config.disable_compression?void 0:xi.Base64,timeout:this._instance.config.feature_flag_request_timeout_ms,callback:s=>{var i,a=(i=s.json)==null?void 0:i.featureFlagPayloads;t((a==null?void 0:a[e])||void 0)}})}isFeatureEnabled(e,t){if(t===void 0&&(t={}),this.ae||this.getFlags()&&this.getFlags().length>0)return!!this.getFeatureFlag(e,t);ca.warn('isFeatureEnabled for key "'+e+`" failed. Feature flags didn't load in time.`)}addFeatureFlagsHandler(e){this.featureFlagEventHandlers.push(e)}removeFeatureFlagsHandler(e){this.featureFlagEventHandlers=this.featureFlagEventHandlers.filter(t=>t!==e)}receivedFeatureFlags(e,t){if(this._instance.persistence){this.ae=!0;var r=this.getFlagVariants(),s=this.getFlagPayloads(),i=this.getFlagsWithDetails();(function(a,o,u,l,d){u===void 0&&(u={}),l===void 0&&(l={}),d===void 0&&(d={});var h=Doe(a),f=h.flags,p=h.featureFlags,m=h.featureFlagPayloads;if(p){var g=a.requestId;if(sr(p)){ca.warn("v1 of the feature flags endpoint is deprecated. Please use the latest version.");var y={};if(p)for(var w=0;w<p.length;w++)y[p[w]]=!0;o&&o.register({[fI]:p,[$h]:y})}else{var v=p,b=m,S=f;a.errorsWhileComputingFlags&&(v=_e({},u,v),b=_e({},l,b),S=_e({},d,S)),o&&o.register(_e({[fI]:Object.keys(c4(v)),[$h]:v||{},[a4]:b||{},[E1]:S||{}},g?{[o4]:g}:{}))}}})(e,this._instance.persistence,r,s,i),this.me(t)}}override(e,t){t===void 0&&(t=!1),ca.warn("override is deprecated. Please use overrideFeatureFlags instead."),this.overrideFeatureFlags({flags:e,suppressWarning:t})}overrideFeatureFlags(e){if(!this._instance.__loaded||!this._instance.persistence)return ca.uninitializedWarning("posthog.featureFlags.overrideFeatureFlags");if(e===!1)return this._instance.persistence.unregister(qh),this._instance.persistence.unregister(ty),void this.me();if(e&&typeof e=="object"&&("flags"in e||"payloads"in e)){var t,r=e;if(this.oe=!!((t=r.suppressWarning)!==null&&t!==void 0&&t),"flags"in r){if(r.flags===!1)this._instance.persistence.unregister(qh);else if(r.flags)if(sr(r.flags)){for(var s={},i=0;i<r.flags.length;i++)s[r.flags[i]]=!0;this._instance.persistence.register({[qh]:s})}else this._instance.persistence.register({[qh]:r.flags})}return"payloads"in r&&(r.payloads===!1?this._instance.persistence.unregister(ty):r.payloads&&this._instance.persistence.register({[ty]:r.payloads})),void this.me()}this.me()}onFeatureFlags(e){if(this.addFeatureFlagsHandler(e),this.ae){var{flags:t,flagVariants:r}=this.be();e(t,r)}return()=>this.removeFeatureFlagsHandler(e)}updateEarlyAccessFeatureEnrollment(e,t){var r,s=(this._instance.get_property(JS)||[]).find(u=>u.flagKey===e),i={["$feature_enrollment/"+e]:t},a={$feature_flag:e,$feature_enrollment:t,$set:i};s&&(a.$early_access_feature_name=s.name),this._instance.capture("$feature_enrollment_update",a),this.setPersonPropertiesForFlags(i,!1);var o=_e({},this.getFlagVariants(),{[e]:t});(r=this._instance.persistence)==null||r.register({[fI]:Object.keys(c4(o)),[$h]:o}),this.me()}getEarlyAccessFeatures(e,t,r){t===void 0&&(t=!1);var s=this._instance.get_property(JS),i=r?"&"+r.map(a=>"stage="+a).join("&"):"";if(s&&!t)return e(s);this._instance.ge({url:this._instance.requestRouter.endpointFor("api","/api/early_access_features/?token="+this._instance.config.token+i),method:"GET",callback:a=>{var o;if(a.json){var u=a.json.earlyAccessFeatures;return(o=this._instance.persistence)==null||o.register({[JS]:u}),e(u)}}})}be(){var e=this.getFlags(),t=this.getFlagVariants();return{flags:e.filter(r=>t[r]),flagVariants:Object.keys(t).filter(r=>t[r]).reduce((r,s)=>(r[s]=t[s],r),{})}}me(e){var{flags:t,flagVariants:r}=this.be();this.featureFlagEventHandlers.forEach(s=>s(t,r,{errorsLoading:e}))}setPersonPropertiesForFlags(e,t){t===void 0&&(t=!0);var r=this._instance.get_property(Kg)||{};this._instance.register({[Kg]:_e({},r,e)}),t&&this._instance.reloadFeatureFlags()}resetPersonPropertiesForFlags(){this._instance.unregister(Kg)}setGroupPropertiesForFlags(e,t){t===void 0&&(t=!0);var r=this._instance.get_property(Ru)||{};Object.keys(r).length!==0&&Object.keys(r).forEach(s=>{r[s]=_e({},r[s],e[s]),delete e[s]}),this._instance.register({[Ru]:_e({},r,e)}),t&&this._instance.reloadFeatureFlags()}resetGroupPropertiesForFlags(e){if(e){var t=this._instance.get_property(Ru)||{};this._instance.register({[Ru]:_e({},t,{[e]:{}})})}else this._instance.unregister(Ru)}}var Uoe=["cookie","localstorage","localstorage+cookie","sessionstorage","memory"];class pI{constructor(e){this.S=e,this.props={},this.we=!1,this.ye=(t=>{var r="";return t.token&&(r=t.token.replace(/\+/g,"PL").replace(/\//g,"SL").replace(/=/g,"EQ")),t.persistence_name?"ph_"+t.persistence_name:"ph_"+r+"_posthog"})(e),this.q=this.Se(e),this.load(),e.debug&&Ce.info("Persistence loaded",e.persistence,_e({},this.props)),this.update_config(e,e),this.save()}Se(e){Uoe.indexOf(e.persistence.toLowerCase())===-1&&(Ce.critical("Unknown persistence type "+e.persistence+"; falling back to localStorage+cookie"),e.persistence="localStorage+cookie");var t=e.persistence.toLowerCase();return t==="localstorage"&&Pr.O()?Pr:t==="localstorage+cookie"&&ox.O()?ox:t==="sessionstorage"&&tn.O()?tn:t==="memory"?kae:t==="cookie"?Za:ox.O()?ox:Za}properties(){var e={};return jt(this.props,function(t,r){if(r===$h&&ir(t))for(var s=Object.keys(t),i=0;i<s.length;i++)e["$feature/"+s[i]]=t[s[i]];else o=r,u=!1,(tc(a=sae)?u:dU&&a.indexOf===dU?a.indexOf(o)!=-1:(jt(a,function(l){if(u||(u=l===o))return zS}),u))||(e[r]=t);var a,o,u}),e}load(){if(!this.$e){var e=this.q.D(this.ye);e&&(this.props=pr({},e))}}save(){this.$e||this.q.j(this.ye,this.props,this.ke,this.xe,this.Ee,this.S.debug)}remove(){this.q.L(this.ye,!1),this.q.L(this.ye,!0)}clear(){this.remove(),this.props={}}register_once(e,t,r){if(ir(e)){we(t)&&(t="None"),this.ke=we(r)?this.Ie:r;var s=!1;if(jt(e,(i,a)=>{this.props.hasOwnProperty(a)&&this.props[a]!==t||(this.props[a]=i,s=!0)}),s)return this.save(),!0}return!1}register(e,t){if(ir(e)){this.ke=we(t)?this.Ie:t;var r=!1;if(jt(e,(s,i)=>{e.hasOwnProperty(i)&&this.props[i]!==s&&(this.props[i]=s,r=!0)}),r)return this.save(),!0}return!1}unregister(e){e in this.props&&(delete this.props[e],this.save())}update_campaign_params(){if(!this.we){var e=Yq(this.S.custom_campaign_params,this.S.mask_personal_data_properties,this.S.custom_personal_data_properties);Mh(v1(e))||this.register(e),this.we=!0}}update_search_keyword(){var e;this.register((e=Se==null?void 0:Se.referrer)?e4(e):{})}update_referrer_info(){var e;this.register_once({$referrer:r4(),$referring_domain:Se!=null&&Se.referrer&&((e=Fh(Se.referrer))==null?void 0:e.host)||"$direct"},void 0)}set_initial_person_info(){this.props[A1]||this.props[T1]||this.register_once({[QS]:n4(this.S.mask_personal_data_properties,this.S.custom_personal_data_properties)},void 0)}get_initial_props(){var e={};jt([T1,A1],a=>{var o=this.props[a];o&&jt(o,function(u,l){e["$initial_"+y1(l)]=u})});var t,r,s=this.props[QS];if(s){var i=(t=s4(s),r={},jt(t,function(a,o){r["$initial_"+y1(o)]=a}),r);pr(e,i)}return e}safe_merge(e){return jt(this.props,function(t,r){r in e||(e[r]=t)}),e}update_config(e,t){if(this.Ie=this.ke=e.cookie_expiration,this.set_disabled(e.disable_persistence),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie),e.persistence!==t.persistence){var r=this.Se(e),s=this.props;this.clear(),this.q=r,this.props=s,this.save()}}set_disabled(e){this.$e=e,this.$e?this.remove():this.save()}set_cross_subdomain(e){e!==this.xe&&(this.xe=e,this.remove(),this.save())}set_secure(e){e!==this.Ee&&(this.Ee=e,this.remove(),this.save())}set_event_timer(e,t){var r=this.props[qg]||{};r[e]=t,this.props[qg]=r,this.save()}remove_event_timer(e){var t=(this.props[qg]||{})[e];return we(t)||(delete this.props[qg][e],this.save()),t}get_property(e){return this.props[e]}set_property(e,t){this.props[e]=t,this.save()}}class u4{constructor(){this.Pe={},this.Pe={}}on(e,t){return this.Pe[e]||(this.Pe[e]=[]),this.Pe[e].push(t),()=>{this.Pe[e]=this.Pe[e].filter(r=>r!==t)}}emit(e,t){for(var r of this.Pe[e]||[])r(t);for(var s of this.Pe["*"]||[])s(e,t)}}var _x=function(n,e){if(!function(t){try{new RegExp(t)}catch{return!1}return!0}(e))return!1;try{return new RegExp(e).test(n)}catch{return!1}};class Du{constructor(e){this.Re=new u4,this.Te=(t,r)=>this.Me(t,r)&&this.Ce(t,r)&&this.Oe(t,r),this.Me=(t,r)=>r==null||!r.event||(t==null?void 0:t.event)===(r==null?void 0:r.event),this._instance=e,this.Fe=new Set,this.Ae=new Set}init(){var e;if(!we((e=this._instance)==null?void 0:e.De)){var t;(t=this._instance)==null||t.De((r,s)=>{this.on(r,s)})}}register(e){var t,r;if(!we((t=this._instance)==null?void 0:t.De)&&(e.forEach(a=>{var o,u;(o=this.Ae)==null||o.add(a),(u=a.steps)==null||u.forEach(l=>{var d;(d=this.Fe)==null||d.add((l==null?void 0:l.event)||"")})}),(r=this._instance)!=null&&r.autocapture)){var s,i=new Set;e.forEach(a=>{var o;(o=a.steps)==null||o.forEach(u=>{u!=null&&u.selector&&i.add(u==null?void 0:u.selector)})}),(s=this._instance)==null||s.autocapture.setElementSelectors(i)}}on(e,t){var r;t!=null&&e.length!=0&&(this.Fe.has(e)||this.Fe.has(t==null?void 0:t.event))&&this.Ae&&((r=this.Ae)==null?void 0:r.size)>0&&this.Ae.forEach(s=>{this.je(t,s)&&this.Re.emit("actionCaptured",s.name)})}Le(e){this.onAction("actionCaptured",t=>e(t))}je(e,t){if((t==null?void 0:t.steps)==null)return!1;for(var r of t.steps)if(this.Te(e,r))return!0;return!1}onAction(e,t){return this.Re.on(e,t)}Ce(e,t){if(t!=null&&t.url){var r,s=e==null||(r=e.properties)==null?void 0:r.$current_url;if(!s||typeof s!="string"||!Du.Ne(s,t==null?void 0:t.url,(t==null?void 0:t.url_matching)||"contains"))return!1}return!0}static Ne(e,t,r){switch(r){case"regex":return!!Y&&_x(e,t);case"exact":return t===e;case"contains":var s=Du.ze(t).replace(/_/g,".").replace(/%/g,".*");return _x(e,s);default:return!1}}static ze(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}Oe(e,t){if((t!=null&&t.href||t!=null&&t.tag_name||t!=null&&t.text)&&!this.Ue(e).some(i=>!(t!=null&&t.href&&!Du.Ne(i.href||"",t==null?void 0:t.href,(t==null?void 0:t.href_matching)||"exact"))&&(t==null||!t.tag_name||i.tag_name===(t==null?void 0:t.tag_name))&&!(t!=null&&t.text&&!Du.Ne(i.text||"",t==null?void 0:t.text,(t==null?void 0:t.text_matching)||"exact")&&!Du.Ne(i.$el_text||"",t==null?void 0:t.text,(t==null?void 0:t.text_matching)||"exact"))))return!1;if(t!=null&&t.selector){var r,s=e==null||(r=e.properties)==null?void 0:r.$element_selectors;if(!s||!s.includes(t==null?void 0:t.selector))return!1}return!0}Ue(e){return(e==null?void 0:e.properties.$elements)==null?[]:e==null?void 0:e.properties.$elements}}var Ar=dn("[Surveys]");class qoe{constructor(e){this._instance=e,this.qe=new Map,this.Be=new Map}register(e){var t;we((t=this._instance)==null?void 0:t.De)||(this.He(e),this.We(e))}We(e){var t=e.filter(r=>{var s,i,a,o;return((s=r.conditions)==null?void 0:s.actions)&&((i=r.conditions)==null||(a=i.actions)==null||(o=a.values)==null?void 0:o.length)>0});t.length!==0&&(this.Ge==null&&(this.Ge=new Du(this._instance),this.Ge.init(),this.Ge.Le(r=>{this.onAction(r)})),t.forEach(r=>{var s,i,a,o,u,l,d,h,f,p;r.conditions&&(s=r.conditions)!=null&&s.actions&&(i=r.conditions)!=null&&(a=i.actions)!=null&&a.values&&((o=r.conditions)==null||(u=o.actions)==null||(l=u.values)==null?void 0:l.length)>0&&((d=this.Ge)==null||d.register(r.conditions.actions.values),(h=r.conditions)==null||(f=h.actions)==null||(p=f.values)==null||p.forEach(m=>{if(m&&m.name){var g=this.Be.get(m.name);g&&g.push(r.id),this.Be.set(m.name,g||[r.id])}}))}))}He(e){var t;e.filter(r=>{var s,i,a,o;return((s=r.conditions)==null?void 0:s.events)&&((i=r.conditions)==null||(a=i.events)==null||(o=a.values)==null?void 0:o.length)>0}).length!==0&&((t=this._instance)==null||t.De((r,s)=>{this.onEvent(r,s)}),e.forEach(r=>{var s,i,a;(s=r.conditions)==null||(i=s.events)==null||(a=i.values)==null||a.forEach(o=>{if(o&&o.name){var u=this.qe.get(o.name);u&&u.push(r.id),this.qe.set(o.name,u||[r.id])}})}))}onEvent(e,t){var r,s,i=((r=this._instance)==null||(s=r.persistence)==null?void 0:s.props[XS])||[];if(e==="survey shown"&&t&&i.length>0){var a;Ar.info("survey event matched, removing survey from activated surveys",{event:e,eventPayload:t,existingActivatedSurveys:i});var o=t==null||(a=t.properties)==null?void 0:a.$survey_id;if(o){var u=i.indexOf(o);u>=0&&(i.splice(u,1),this.Je(i))}}else this.qe.has(e)&&(Ar.info("survey event matched, updating activated surveys",{event:e,surveys:this.qe.get(e)}),this.Je(i.concat(this.qe.get(e)||[])))}onAction(e){var t,r,s=((t=this._instance)==null||(r=t.persistence)==null?void 0:r.props[XS])||[];this.Be.has(e)&&this.Je(s.concat(this.Be.get(e)||[]))}Je(e){var t,r;(t=this._instance)==null||(r=t.persistence)==null||r.register({[XS]:[...new Set(e)]})}getSurveys(){var e,t,r=(e=this._instance)==null||(t=e.persistence)==null?void 0:t.props[XS];return r||[]}getEventToSurveys(){return this.qe}Ve(){return this.Ge}}class Hoe{constructor(e){this.Ke=null,this.Ye=!1,this.Xe=!1,this.Qe=[],this._instance=e,this._surveyEventReceiver=null}onRemoteConfig(e){var t=e.surveys;if(kt(t))return Ar.warn("Decide not loaded yet. Not loading surveys.");var r=sr(t);this.Ze=r?t.length>0:t,Ar.info("decide response received, hasSurveys: "+this.Ze),this.Ze&&this.loadIfEnabled()}reset(){localStorage.removeItem("lastSeenSurveyDate");for(var e=[],t=0;t<localStorage.length;t++){var r=localStorage.key(t);(r!=null&&r.startsWith("seenSurvey_")||r!=null&&r.startsWith("inProgressSurvey_"))&&e.push(r)}e.forEach(s=>localStorage.removeItem(s))}loadIfEnabled(){if(!this.Ke)if(this.Xe)Ar.info("Already initializing surveys, skipping...");else if(this._instance.config.disable_surveys)Ar.info("Disabled. Not loading surveys.");else if(this.Ze){var e=Ge==null?void 0:Ge.__PosthogExtensions__;if(e){this.Xe=!0;try{var t=e.generateSurveys;if(t)return void this.tr(t);var r=e.loadExternalDependency;if(!r)return void this.ir("PostHog loadExternalDependency extension not found.");r(this._instance,"surveys",s=>{s||!e.generateSurveys?this.ir("Could not load surveys script",s):this.tr(e.generateSurveys)})}catch(s){throw this.ir("Error initializing surveys",s),s}finally{this.Xe=!1}}else Ar.error("PostHog Extensions not found.")}else Ar.info("No surveys to load.")}tr(e){this.Ke=e(this._instance),this._surveyEventReceiver=new qoe(this._instance),Ar.info("Surveys loaded successfully"),this.er({isLoaded:!0})}ir(e,t){Ar.error(e,t),this.er({isLoaded:!1,error:e})}onSurveysLoaded(e){return this.Qe.push(e),this.Ke&&this.er({isLoaded:!0}),()=>{this.Qe=this.Qe.filter(t=>t!==e)}}getSurveys(e,t){if(t===void 0&&(t=!1),this._instance.config.disable_surveys)return Ar.info("Disabled. Not loading surveys."),e([]);var r=this._instance.get_property(k1);if(r&&!t)return e(r,{isLoaded:!0});if(this.Ye)return e([],{isLoaded:!1,error:"Surveys are already being loaded"});try{this.Ye=!0,this._instance.ge({url:this._instance.requestRouter.endpointFor("api","/api/surveys/?token="+this._instance.config.token),method:"GET",timeout:this._instance.config.surveys_request_timeout_ms,callback:s=>{var i;this.Ye=!1;var a=s.statusCode;if(a!==200||!s.json){var o="Surveys API could not be loaded, status: "+a;return Ar.error(o),e([],{isLoaded:!1,error:o})}var u,l=s.json.surveys||[],d=l.filter(h=>function(f){return!(!f.start_date||f.end_date)}(h)&&(function(f){var p,m,g;return!((p=f.conditions)==null||(m=p.events)==null||(g=m.values)==null||!g.length)}(h)||function(f){var p,m,g;return!((p=f.conditions)==null||(m=p.actions)==null||(g=m.values)==null||!g.length)}(h)));return d.length>0&&((u=this._surveyEventReceiver)==null||u.register(d)),(i=this._instance.persistence)==null||i.register({[k1]:l}),e(l,{isLoaded:!0})}})}catch(s){throw this.Ye=!1,s}}er(e){for(var t of this.Qe)try{e.isLoaded?this.getSurveys(t):t([],e)}catch(r){Ar.error("Error in survey callback",r)}}getActiveMatchingSurveys(e,t){if(t===void 0&&(t=!1),!kt(this.Ke))return this.Ke.getActiveMatchingSurveys(e,t);Ar.warn("init was not called")}rr(e){var t=null;return this.getSurveys(r=>{var s;t=(s=r.find(i=>i.id===e))!==null&&s!==void 0?s:null}),t}sr(e){if(kt(this.Ke))return{eligible:!1,reason:"SDK is not enabled or survey functionality is not yet loaded"};var t=typeof e=="string"?this.rr(e):e;return t?this.Ke.checkSurveyEligibility(t):{eligible:!1,reason:"Survey not found"}}canRenderSurvey(e){if(kt(this.Ke))return Ar.warn("init was not called"),{visible:!1,disabledReason:"SDK is not enabled or survey functionality is not yet loaded"};var t=this.sr(e);return{visible:t.eligible,disabledReason:t.reason}}canRenderSurveyAsync(e,t){return kt(this.Ke)?(Ar.warn("init was not called"),Promise.resolve({visible:!1,disabledReason:"SDK is not enabled or survey functionality is not yet loaded"})):new Promise(r=>{this.getSurveys(s=>{var i,a=(i=s.find(u=>u.id===e))!==null&&i!==void 0?i:null;if(a){var o=this.sr(a);r({visible:o.eligible,disabledReason:o.reason})}else r({visible:!1,disabledReason:"Survey not found"})},t)})}renderSurvey(e,t){if(kt(this.Ke))Ar.warn("init was not called");else{var r=this.rr(e),s=Se==null?void 0:Se.querySelector(t);r?s?this.Ke.renderSurvey(r,s):Ar.warn("Survey element not found"):Ar.warn("Survey not found")}}}var l4=dn("[RateLimiter]");class Koe{constructor(e){var t,r;this.serverLimits={},this.lastEventRateLimited=!1,this.checkForLimiting=s=>{var i=s.text;if(i&&i.length)try{(JSON.parse(i).quota_limited||[]).forEach(a=>{l4.info((a||"events")+" is quota limited."),this.serverLimits[a]=new Date().getTime()+6e4})}catch(a){return void l4.warn('could not rate limit - continuing. Error: "'+(a==null?void 0:a.message)+'"',{text:i})}},this.instance=e,this.captureEventsPerSecond=((t=e.config.rate_limiting)==null?void 0:t.events_per_second)||10,this.captureEventsBurstLimit=Math.max(((r=e.config.rate_limiting)==null?void 0:r.events_burst_limit)||10*this.captureEventsPerSecond,this.captureEventsPerSecond),this.lastEventRateLimited=this.clientRateLimitContext(!0).isRateLimited}clientRateLimitContext(e){var t,r,s;e===void 0&&(e=!1);var i=new Date().getTime(),a=(t=(r=this.instance.persistence)==null?void 0:r.get_property(P1))!==null&&t!==void 0?t:{tokens:this.captureEventsBurstLimit,last:i};a.tokens+=(i-a.last)/1e3*this.captureEventsPerSecond,a.last=i,a.tokens>this.captureEventsBurstLimit&&(a.tokens=this.captureEventsBurstLimit);var o=a.tokens<1;return o||e||(a.tokens=Math.max(0,a.tokens-1)),!o||this.lastEventRateLimited||e||this.instance.capture("$$client_ingestion_warning",{$$client_ingestion_warning_message:"posthog-js client rate limited. Config is set to "+this.captureEventsPerSecond+" events per second and "+this.captureEventsBurstLimit+" events burst limit."},{skip_client_rate_limiting:!0}),this.lastEventRateLimited=o,(s=this.instance.persistence)==null||s.set_property(P1,a),{isRateLimited:o,remainingTokens:a.tokens}}isServerRateLimited(e){var t=this.serverLimits[e||"events"]||!1;return t!==!1&&new Date().getTime()<t}}var Bu=dn("[RemoteConfig]");class Woe{constructor(e){this._instance=e}get remoteConfig(){var e,t;return(e=Ge._POSTHOG_REMOTE_CONFIG)==null||(t=e[this._instance.config.token])==null?void 0:t.config}nr(e){var t,r;(t=Ge.__PosthogExtensions__)!=null&&t.loadExternalDependency?(r=Ge.__PosthogExtensions__)==null||r.loadExternalDependency==null||r.loadExternalDependency(this._instance,"remote-config",()=>e(this.remoteConfig)):(Bu.error("PostHog Extensions not found. Cannot load remote config."),e())}ar(e){this._instance.ge({method:"GET",url:this._instance.requestRouter.endpointFor("assets","/array/"+this._instance.config.token+"/config"),callback:t=>{e(t.json)}})}load(){try{if(this.remoteConfig)return Bu.info("Using preloaded remote config",this.remoteConfig),void this._e(this.remoteConfig);if(this._instance.config.advanced_disable_decide)return void Bu.warn("Remote config is disabled. Falling back to local config.");this.nr(e=>{if(!e)return Bu.info("No config found after loading remote JS config. Falling back to JSON."),void this.ar(t=>{this._e(t)});this._e(e)})}catch(e){Bu.error("Error loading remote config",e)}}_e(e){e?this._instance.config.__preview_remote_config?(this._instance._e(e),e.hasFeatureFlags!==!1&&this._instance.featureFlags.ensureFlagsLoaded()):Bu.info("__preview_remote_config is disabled. Logging config instead",e):Bu.error("Failed to fetch remote config from PostHog.")}}var zoe=function(n){var e,t,r,s,i="";for(e=t=0,r=(n=(n+"").replace(/\r\n/g,`
`).replace(/\r/g,`
`)).length,s=0;s<r;s++){var a=n.charCodeAt(s),o=null;a<128?t++:o=a>127&&a<2048?String.fromCharCode(a>>6|192,63&a|128):String.fromCharCode(a>>12|224,a>>6&63|128,63&a|128),tc(o)||(t>e&&(i+=n.substring(e,t)),i+=o,e=t=s+1)}return t>e&&(i+=n.substring(e,n.length)),i},Voe=!!m1||!!p1,d4="text/plain",bx=(n,e)=>{var[t,r]=n.split("?"),s=_e({},e);r==null||r.split("&").forEach(a=>{var[o]=a.split("=");delete s[o]});var i=fae(s);return t+"?"+(i=i?(r?r+"&":"")+i:r)},ry=(n,e)=>JSON.stringify(n,(t,r)=>typeof r=="bigint"?r.toString():r,e),mI=n=>{var{data:e,compression:t}=n;if(e){if(t===xi.GZipJS){var r=_q(bq(ry(e)),{mtime:0}),s=new Blob([r],{type:d4});return{contentType:d4,body:s,estimatedSize:s.size}}if(t===xi.Base64){var i=function(u){var l,d,h,f,p,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g=0,y=0,w="",v=[];if(!u)return u;u=zoe(u);do l=(p=u.charCodeAt(g++)<<16|u.charCodeAt(g++)<<8|u.charCodeAt(g++))>>18&63,d=p>>12&63,h=p>>6&63,f=63&p,v[y++]=m.charAt(l)+m.charAt(d)+m.charAt(h)+m.charAt(f);while(g<u.length);switch(w=v.join(""),u.length%3){case 1:w=w.slice(0,-2)+"==";break;case 2:w=w.slice(0,-1)+"="}return w}(ry(e)),a=(u=>"data="+encodeURIComponent(typeof u=="string"?u:ry(u)))(i);return{contentType:"application/x-www-form-urlencoded",body:a,estimatedSize:new Blob([a]).size}}var o=ry(e);return{contentType:"application/json",body:o,estimatedSize:new Blob([o]).size}}},ny=[];p1&&ny.push({transport:"fetch",method:n=>{var e,t,{contentType:r,body:s,estimatedSize:i}=(e=mI(n))!==null&&e!==void 0?e:{},a=new Headers;jt(n.headers,function(d,h){a.append(h,d)}),r&&a.append("Content-Type",r);var o=n.url,u=null;if(hU){var l=new hU;u={signal:l.signal,timeout:setTimeout(()=>l.abort(),n.timeout)}}p1(o,_e({method:(n==null?void 0:n.method)||"GET",headers:a,keepalive:n.method==="POST"&&(i||0)<52428.8,body:s,signal:(t=u)==null?void 0:t.signal},n.fetchOptions)).then(d=>d.text().then(h=>{var f={statusCode:d.status,text:h};if(d.status===200)try{f.json=JSON.parse(h)}catch(p){Ce.error(p)}n.callback==null||n.callback(f)})).catch(d=>{Ce.error(d),n.callback==null||n.callback({statusCode:0,text:d})}).finally(()=>u?clearTimeout(u.timeout):null)}}),m1&&ny.push({transport:"XHR",method:n=>{var e,t=new m1;t.open(n.method||"GET",n.url,!0);var{contentType:r,body:s}=(e=mI(n))!==null&&e!==void 0?e:{};jt(n.headers,function(i,a){t.setRequestHeader(a,i)}),r&&t.setRequestHeader("Content-Type",r),n.timeout&&(t.timeout=n.timeout),t.withCredentials=!0,t.onreadystatechange=()=>{if(t.readyState===4){var i={statusCode:t.status,text:t.responseText};if(t.status===200)try{i.json=JSON.parse(t.responseText)}catch{}n.callback==null||n.callback(i)}},t.send(s)}}),ws!=null&&ws.sendBeacon&&ny.push({transport:"sendBeacon",method:n=>{var e=bx(n.url,{beacon:"1"});try{var t,{contentType:r,body:s}=(t=mI(n))!==null&&t!==void 0?t:{},i=typeof s=="string"?new Blob([s],{type:r}):s;ws.sendBeacon(e,i)}catch{}}});var gI=3e3;class Goe{constructor(e,t){this.lr=!0,this.hr=[],this.ur=qs((t==null?void 0:t.flush_interval_ms)||gI,250,5e3,"flush interval",gI),this.dr=e}enqueue(e){this.hr.push(e),this.vr||this.cr()}unload(){this.pr();var e=this.hr.length>0?this.gr():{},t=Object.values(e);[...t.filter(r=>r.url.indexOf("/e")===0),...t.filter(r=>r.url.indexOf("/e")!==0)].map(r=>{this.dr(_e({},r,{transport:"sendBeacon"}))})}enable(){this.lr=!1,this.cr()}cr(){var e=this;this.lr||(this.vr=setTimeout(()=>{if(this.pr(),this.hr.length>0){var t=this.gr(),r=function(i){var a=t[i],o=new Date().getTime();a.data&&sr(a.data)&&jt(a.data,u=>{u.offset=Math.abs(u.timestamp-o),delete u.timestamp}),e.dr(a)};for(var s in t)r(s)}},this.ur))}pr(){clearTimeout(this.vr),this.vr=void 0}gr(){var e={};return jt(this.hr,t=>{var r,s=t,i=(s?s.batchKey:null)||s.url;we(e[i])&&(e[i]=_e({},s,{data:[]})),(r=e[i].data)==null||r.push(s.data)}),this.hr=[],e}}var Zoe=["retriesPerformedSoFar"];class Joe{constructor(e){this._r=!1,this.mr=3e3,this.hr=[],this._instance=e,this.hr=[],this.br=!0,!we(Y)&&"onLine"in Y.navigator&&(this.br=Y.navigator.onLine,rr(Y,"online",()=>{this.br=!0,this.Yi()}),rr(Y,"offline",()=>{this.br=!1}))}get length(){return this.hr.length}retriableRequest(e){var{retriesPerformedSoFar:t}=e,r=yU(e,Zoe);ln(t)&&t>0&&(r.url=bx(r.url,{retry_count:t})),this._instance.ge(_e({},r,{callback:s=>{s.statusCode!==200&&(s.statusCode<400||s.statusCode>=500)&&(t??0)<10?this.wr(_e({retriesPerformedSoFar:t},r)):r.callback==null||r.callback(s)}}))}wr(e){var t=e.retriesPerformedSoFar||0;e.retriesPerformedSoFar=t+1;var r=function(a){var o=3e3*Math.pow(2,a),u=o/2,l=Math.min(18e5,o),d=(Math.random()-.5)*(l-u);return Math.ceil(l+d)}(t),s=Date.now()+r;this.hr.push({retryAt:s,requestOptions:e});var i="Enqueued failed request for retry in "+r;navigator.onLine||(i+=" (Browser is offline)"),Ce.warn(i),this._r||(this._r=!0,this.yr())}yr(){this.Sr&&clearTimeout(this.Sr),this.Sr=setTimeout(()=>{this.br&&this.hr.length>0&&this.Yi(),this.yr()},this.mr)}Yi(){var e=Date.now(),t=[],r=this.hr.filter(i=>i.retryAt<e||(t.push(i),!1));if(this.hr=t,r.length>0)for(var{requestOptions:s}of r)this.retriableRequest(s)}unload(){for(var{requestOptions:e}of(this.Sr&&(clearTimeout(this.Sr),this.Sr=void 0),this.hr))try{this._instance.ge(_e({},e,{transport:"sendBeacon"}))}catch(t){Ce.error(t)}this.hr=[]}}class Xoe{constructor(e){this.$r=()=>{var t,r,s,i;this.kr||(this.kr={});var a=this.scrollElement(),o=this.scrollY(),u=a?Math.max(0,a.scrollHeight-a.clientHeight):0,l=o+((a==null?void 0:a.clientHeight)||0),d=(a==null?void 0:a.scrollHeight)||0;this.kr.lastScrollY=Math.ceil(o),this.kr.maxScrollY=Math.max(o,(t=this.kr.maxScrollY)!==null&&t!==void 0?t:0),this.kr.maxScrollHeight=Math.max(u,(r=this.kr.maxScrollHeight)!==null&&r!==void 0?r:0),this.kr.lastContentY=l,this.kr.maxContentY=Math.max(l,(s=this.kr.maxContentY)!==null&&s!==void 0?s:0),this.kr.maxContentHeight=Math.max(d,(i=this.kr.maxContentHeight)!==null&&i!==void 0?i:0)},this._instance=e}getContext(){return this.kr}resetContext(){var e=this.kr;return setTimeout(this.$r,0),e}startMeasuringScrollPosition(){rr(Y,"scroll",this.$r,{capture:!0}),rr(Y,"scrollend",this.$r,{capture:!0}),rr(Y,"resize",this.$r)}scrollElement(){if(!this._instance.config.scroll_root_selector)return Y==null?void 0:Y.document.documentElement;var e=sr(this._instance.config.scroll_root_selector)?this._instance.config.scroll_root_selector:[this._instance.config.scroll_root_selector];for(var t of e){var r=Y==null?void 0:Y.document.querySelector(t);if(r)return r}}scrollY(){if(this._instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollTop||0}return Y&&(Y.scrollY||Y.pageYOffset||Y.document.documentElement.scrollTop)||0}scrollX(){if(this._instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollLeft||0}return Y&&(Y.scrollX||Y.pageXOffset||Y.document.documentElement.scrollLeft)||0}}var Yoe=n=>n4(n==null?void 0:n.config.mask_personal_data_properties,n==null?void 0:n.config.custom_personal_data_properties);class Qoe{constructor(e,t,r,s){this.Er=i=>{var a=this.Ir();if(!a||a.sessionId!==i){var o={sessionId:i,props:this.Pr(this._instance)};this.Rr.register({[C1]:o})}},this._instance=e,this.Tr=t,this.Rr=r,this.Pr=s||Yoe,this.Tr.onSessionId(this.Er)}Ir(){return this.Rr.props[C1]}getSetOnceProps(){var e,t=(e=this.Ir())==null?void 0:e.props;return t?"r"in t?s4(t):{$referring_domain:t.referringDomain,$pathname:t.initialPathName,utm_source:t.utm_source,utm_campaign:t.utm_campaign,utm_medium:t.utm_medium,utm_content:t.utm_content,utm_term:t.utm_term}:{}}getSessionProps(){var e={};return jt(v1(this.getSetOnceProps()),(t,r)=>{r==="$current_url"&&(r="url"),e["$session_entry_"+y1(r)]=t}),e}}var h4=dn("[SessionId]");class ece{constructor(e,t,r){var s;if(this.Mr=[],!e.persistence)throw new Error("SessionIdManager requires a PostHogPersistence instance");if(e.config.__preview_experimental_cookieless_mode)throw new Error("SessionIdManager cannot be used with __preview_experimental_cookieless_mode");this.S=e.config,this.Rr=e.persistence,this.oi=void 0,this.kt=void 0,this._sessionStartTimestamp=null,this._sessionActivityTimestamp=null,this.Cr=t||sc,this.Or=r||sc;var i=this.S.persistence_name||this.S.token,a=this.S.session_idle_timeout_seconds||1800;if(this._sessionTimeoutMs=1e3*qs(a,60,36e3,"session_idle_timeout_seconds",1800),e.register({$configured_session_timeout_ms:this._sessionTimeoutMs}),this.Fr(),this.Ar="ph_"+i+"_window_id",this.Dr="ph_"+i+"_primary_window_exists",this.jr()){var o=tn.D(this.Ar),u=tn.D(this.Dr);o&&!u?this.oi=o:tn.L(this.Ar),tn.j(this.Dr,!0)}if((s=this.S.bootstrap)!=null&&s.sessionID)try{var l=(d=>{var h=d.replace(/-/g,"");if(h.length!==32)throw new Error("Not a valid UUID");if(h[12]!=="7")throw new Error("Not a UUIDv7");return parseInt(h.substring(0,12),16)})(this.S.bootstrap.sessionID);this.Lr(this.S.bootstrap.sessionID,new Date().getTime(),l)}catch(d){h4.error("Invalid sessionID in bootstrap",d)}this.Nr()}get sessionTimeoutMs(){return this._sessionTimeoutMs}onSessionId(e){return we(this.Mr)&&(this.Mr=[]),this.Mr.push(e),this.kt&&e(this.kt,this.oi),()=>{this.Mr=this.Mr.filter(t=>t!==e)}}jr(){return this.S.persistence!=="memory"&&!this.Rr.$e&&tn.O()}zr(e){e!==this.oi&&(this.oi=e,this.jr()&&tn.j(this.Ar,e))}Ur(){return this.oi?this.oi:this.jr()?tn.D(this.Ar):null}Lr(e,t,r){e===this.kt&&t===this._sessionActivityTimestamp&&r===this._sessionStartTimestamp||(this._sessionStartTimestamp=r,this._sessionActivityTimestamp=t,this.kt=e,this.Rr.register({[ZS]:[t,e,r]}))}qr(){if(this.kt&&this._sessionActivityTimestamp&&this._sessionStartTimestamp)return[this._sessionActivityTimestamp,this.kt,this._sessionStartTimestamp];var e=this.Rr.props[ZS];return sr(e)&&e.length===2&&e.push(e[0]),e||[0,null,0]}resetSessionId(){this.Lr(null,null,null)}Nr(){rr(Y,"beforeunload",()=>{this.jr()&&tn.L(this.Dr)},{capture:!1})}checkAndGetSessionAndWindowId(e,t){if(e===void 0&&(e=!1),t===void 0&&(t=null),this.S.__preview_experimental_cookieless_mode)throw new Error("checkAndGetSessionAndWindowId should not be called in __preview_experimental_cookieless_mode");var r=t||new Date().getTime(),[s,i,a]=this.qr(),o=this.Ur(),u=ln(a)&&a>0&&Math.abs(r-a)>864e5,l=!1,d=!i,h=!e&&Math.abs(r-s)>this.sessionTimeoutMs;d||h||u?(i=this.Cr(),o=this.Or(),h4.info("new session ID generated",{sessionId:i,windowId:o,changeReason:{noSessionId:d,activityTimeout:h,sessionPastMaximumLength:u}}),a=r,l=!0):o||(o=this.Or(),l=!0);var f=s===0||!e||u?r:s,p=a===0?new Date().getTime():a;return this.zr(o),this.Lr(i,f,p),e||this.Fr(),l&&this.Mr.forEach(m=>m(i,o,l?{noSessionId:d,activityTimeout:h,sessionPastMaximumLength:u}:void 0)),{sessionId:i,windowId:o,sessionStartTimestamp:p,changeReason:l?{noSessionId:d,activityTimeout:h,sessionPastMaximumLength:u}:void 0,lastActivityTimestamp:s}}Fr(){clearTimeout(this.Br),this.Br=setTimeout(()=>{this.resetSessionId()},1.1*this.sessionTimeoutMs)}}var tce=["$set_once","$set"],cc=dn("[SiteApps]");class rce{constructor(e){this._instance=e,this.Hr=[],this.apps={}}get isEnabled(){return!!this._instance.config.opt_in_site_apps}Wr(e,t){if(t){var r=this.globalsForEvent(t);this.Hr.push(r),this.Hr.length>1e3&&(this.Hr=this.Hr.slice(10))}}get siteAppLoaders(){var e,t;return(e=Ge._POSTHOG_REMOTE_CONFIG)==null||(t=e[this._instance.config.token])==null?void 0:t.siteApps}init(){if(this.isEnabled){var e=this._instance.De(this.Wr.bind(this));this.Gr=()=>{e(),this.Hr=[],this.Gr=void 0}}}globalsForEvent(e){var t,r,s,i,a,o,u;if(!e)throw new Error("Event payload is required");var l={},d=this._instance.get_property("$groups")||[],h=this._instance.get_property("$stored_group_properties")||{};for(var[f,p]of Object.entries(h))l[f]={id:d[f],type:f,properties:p};var{$set_once:m,$set:g}=e;return{event:_e({},yU(e,tce),{properties:_e({},e.properties,g?{$set:_e({},(t=(r=e.properties)==null?void 0:r.$set)!==null&&t!==void 0?t:{},g)}:{},m?{$set_once:_e({},(s=(i=e.properties)==null?void 0:i.$set_once)!==null&&s!==void 0?s:{},m)}:{}),elements_chain:(a=(o=e.properties)==null?void 0:o.$elements_chain)!==null&&a!==void 0?a:"",distinct_id:(u=e.properties)==null?void 0:u.distinct_id}),person:{properties:this._instance.get_property("$stored_person_properties")},groups:l}}setupSiteApp(e){var t=this.apps[e.id],r=()=>{var o;!t.errored&&this.Hr.length&&(cc.info("Processing "+this.Hr.length+" events for site app with id "+e.id),this.Hr.forEach(u=>t.processEvent==null?void 0:t.processEvent(u)),t.processedBuffer=!0),Object.values(this.apps).every(u=>u.processedBuffer||u.errored)&&((o=this.Gr)==null||o.call(this))},s=!1,i=o=>{t.errored=!o,t.loaded=!0,cc.info("Site app with id "+e.id+" "+(o?"loaded":"errored")),s&&r()};try{var{processEvent:a}=e.init({posthog:this._instance,callback:o=>{i(o)}});a&&(t.processEvent=a),s=!0}catch(o){cc.error("Error while initializing PostHog app with config id "+e.id,o),i(!1)}if(s&&t.loaded)try{r()}catch(o){cc.error("Error while processing buffered events PostHog app with config id "+e.id,o),t.errored=!0}}Jr(){var e=this.siteAppLoaders||[];for(var t of e)this.apps[t.id]={id:t.id,loaded:!1,errored:!1,processedBuffer:!1};for(var r of e)this.setupSiteApp(r)}Vr(e){if(Object.keys(this.apps).length!==0){var t=this.globalsForEvent(e);for(var r of Object.values(this.apps))try{r.processEvent==null||r.processEvent(t)}catch(s){cc.error("Error while processing event "+e.event+" for site app "+r.id,s)}}}onRemoteConfig(e){var t,r,s,i=this;if((t=this.siteAppLoaders)!=null&&t.length)return this.isEnabled?(this.Jr(),void this._instance.on("eventCaptured",l=>this.Vr(l))):void cc.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.');if((r=this.Gr)==null||r.call(this),(s=e.siteApps)!=null&&s.length)if(this.isEnabled){var a=function(l,d){var h;Ge["__$$ph_site_app_"+l]=i._instance,(h=Ge.__PosthogExtensions__)==null||h.loadSiteApp==null||h.loadSiteApp(i._instance,d,f=>{if(f)return cc.error("Error while initializing PostHog app with config id "+l,f)})};for(var{id:o,url:u}of e.siteApps)a(o,u)}else cc.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.')}}var Uu,nce=["amazonbot","amazonproductbot","app.hypefactors.com","applebot","archive.org_bot","awariobot","backlinksextendedbot","baiduspider","bingbot","bingpreview","chrome-lighthouse","dataforseobot","deepscan","duckduckbot","facebookexternal","facebookcatalog","http://yandex.com/bots","hubspot","ia_archiver","linkedinbot","meta-externalagent","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","sebot-wa","sitebulb","slackbot","slurp","trendictionbot","turnitin","twitterbot","vercelbot","yahoo! slurp","yandexbot","zoombot","bot.htm","bot.php","(bot;","bot/","crawler","ahrefsbot","ahrefssiteaudit","semrushbot","siteauditbot","splitsignalbot","gptbot","oai-searchbot","chatgpt-user","perplexitybot","better uptime bot","sentryuptimebot","uptimerobot","headlesschrome","cypress","google-hoteladsverifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleweblight","mediapartners-google","storebot-google","bytespider"],f4=function(n,e){if(!n)return!1;var t=n.toLowerCase();return nce.concat(e||[]).some(r=>{var s=r.toLowerCase();return t.indexOf(s)!==-1})},p4=function(n,e){if(!n)return!1;var t=n.userAgent;if(t&&f4(t,e))return!0;try{var r=n==null?void 0:n.userAgentData;if(r!=null&&r.brands&&r.brands.some(s=>f4(s==null?void 0:s.brand,e)))return!0}catch{}return!!n.webdriver};function m4(n,e,t){return ry({distinct_id:n,userPropertiesToSet:e,userPropertiesToSetOnce:t})}(function(n){n.US="us",n.EU="eu",n.CUSTOM="custom"})(Uu||(Uu={}));var g4="i.posthog.com";class sce{constructor(e){this.Kr={},this.instance=e}get apiHost(){var e=this.instance.config.api_host.trim().replace(/\/$/,"");return e==="https://app.posthog.com"?"https://us.i.posthog.com":e}get uiHost(){var e,t=(e=this.instance.config.ui_host)==null?void 0:e.replace(/\/$/,"");return t||(t=this.apiHost.replace("."+g4,".posthog.com")),t==="https://app.posthog.com"?"https://us.posthog.com":t}get region(){return this.Kr[this.apiHost]||(/https:\/\/(app|us|us-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this.Kr[this.apiHost]=Uu.US:/https:\/\/(eu|eu-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this.Kr[this.apiHost]=Uu.EU:this.Kr[this.apiHost]=Uu.CUSTOM),this.Kr[this.apiHost]}endpointFor(e,t){if(t===void 0&&(t=""),t&&(t=t[0]==="/"?t:"/"+t),e==="ui")return this.uiHost+t;if(this.region===Uu.CUSTOM)return this.apiHost+t;var r=g4+t;switch(e){case"assets":return"https://"+this.region+"-assets."+r;case"api":return"https://"+this.region+"."+r}}}var ice={icontains:(n,e)=>!!Y&&e.href.toLowerCase().indexOf(n.toLowerCase())>-1,not_icontains:(n,e)=>!!Y&&e.href.toLowerCase().indexOf(n.toLowerCase())===-1,regex:(n,e)=>!!Y&&_x(e.href,n),not_regex:(n,e)=>!!Y&&!_x(e.href,n),exact:(n,e)=>e.href===n,is_not:(n,e)=>e.href!==n};class pn{constructor(e){var t=this;this.getWebExperimentsAndEvaluateDisplayLogic=function(r){r===void 0&&(r=!1),t.getWebExperiments(s=>{pn.Yr("retrieved web experiments from the server"),t.Xr=new Map,s.forEach(i=>{if(i.feature_flag_key){var a;t.Xr&&(pn.Yr("setting flag key ",i.feature_flag_key," to web experiment ",i),(a=t.Xr)==null||a.set(i.feature_flag_key,i));var o=t._instance.getFeatureFlag(i.feature_flag_key);fr(o)&&i.variants[o]&&t.Qr(i.name,o,i.variants[o].transforms)}else if(i.variants)for(var u in i.variants){var l=i.variants[u];pn.Zr(l)&&t.Qr(i.name,u,l.transforms)}})},r)},this._instance=e,this._instance.onFeatureFlags(r=>{this.onFeatureFlags(r)})}onFeatureFlags(e){if(this._is_bot())pn.Yr("Refusing to render web experiment since the viewer is a likely bot");else if(!this._instance.config.disable_web_experiments){if(kt(this.Xr))return this.Xr=new Map,this.loadIfEnabled(),void this.previewWebExperiment();pn.Yr("applying feature flags",e),e.forEach(t=>{var r;if(this.Xr&&(r=this.Xr)!=null&&r.has(t)){var s,i=this._instance.getFeatureFlag(t),a=(s=this.Xr)==null?void 0:s.get(t);i&&a!=null&&a.variants[i]&&this.Qr(a.name,i,a.variants[i].transforms)}})}}previewWebExperiment(){var e=pn.getWindowLocation();if(e!=null&&e.search){var t=sx(e==null?void 0:e.search,"__experiment_id"),r=sx(e==null?void 0:e.search,"__experiment_variant");t&&r&&(pn.Yr("previewing web experiments "+t+" && "+r),this.getWebExperiments(s=>{this.ts(parseInt(t),r,s)},!1,!0))}}loadIfEnabled(){this._instance.config.disable_web_experiments||this.getWebExperimentsAndEvaluateDisplayLogic()}getWebExperiments(e,t,r){if(this._instance.config.disable_web_experiments&&!r)return e([]);var s=this._instance.get_property("$web_experiments");if(s&&!t)return e(s);this._instance.ge({url:this._instance.requestRouter.endpointFor("api","/api/web_experiments/?token="+this._instance.config.token),method:"GET",callback:i=>{if(i.statusCode!==200||!i.json)return e([]);var a=i.json.experiments||[];return e(a)}})}ts(e,t,r){var s=r.filter(i=>i.id===e);s&&s.length>0&&(pn.Yr("Previewing web experiment ["+s[0].name+"] with variant ["+t+"]"),this.Qr(s[0].name,t,s[0].variants[t].transforms))}static Zr(e){return!kt(e.conditions)&&pn.es(e)&&pn.rs(e)}static es(e){var t;if(kt(e.conditions)||kt((t=e.conditions)==null?void 0:t.url))return!0;var r,s,i,a=pn.getWindowLocation();return!!a&&((r=e.conditions)==null||!r.url||ice[(s=(i=e.conditions)==null?void 0:i.urlMatchType)!==null&&s!==void 0?s:"icontains"](e.conditions.url,a))}static getWindowLocation(){return Y==null?void 0:Y.location}static rs(e){var t;if(kt(e.conditions)||kt((t=e.conditions)==null?void 0:t.utm))return!0;var r=Yq();if(r.utm_source){var s,i,a,o,u,l,d,h,f,p,m,g,y,w,v,b,S=(s=e.conditions)==null||(i=s.utm)==null||!i.utm_campaign||((a=e.conditions)==null||(o=a.utm)==null?void 0:o.utm_campaign)==r.utm_campaign,P=(u=e.conditions)==null||(l=u.utm)==null||!l.utm_source||((d=e.conditions)==null||(h=d.utm)==null?void 0:h.utm_source)==r.utm_source,k=(f=e.conditions)==null||(p=f.utm)==null||!p.utm_medium||((m=e.conditions)==null||(g=m.utm)==null?void 0:g.utm_medium)==r.utm_medium,C=(y=e.conditions)==null||(w=y.utm)==null||!w.utm_term||((v=e.conditions)==null||(b=v.utm)==null?void 0:b.utm_term)==r.utm_term;return S&&k&&C&&P}return!1}static Yr(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];Ce.info("[WebExperiments] "+e,r)}Qr(e,t,r){this._is_bot()?pn.Yr("Refusing to render web experiment since the viewer is a likely bot"):t!=="control"?r.forEach(s=>{if(s.selector){var i;pn.Yr("applying transform of variant "+t+" for experiment "+e+" ",s);var a=(i=document)==null?void 0:i.querySelectorAll(s.selector);a==null||a.forEach(o=>{var u=o;s.html&&(u.innerHTML=s.html),s.css&&u.setAttribute("style",s.css)})}}):pn.Yr("Control variants leave the page unmodified.")}_is_bot(){return ws&&this._instance?p4(ws,this._instance.config.custom_blocked_useragents):void 0}}var sy={},yI=()=>{},Hh="posthog",y4=!Voe&&(Qn==null?void 0:Qn.indexOf("MSIE"))===-1&&(Qn==null?void 0:Qn.indexOf("Mozilla"))===-1,w4=()=>{var n;return{api_host:"https://us.i.posthog.com",ui_host:null,token:"",autocapture:!0,rageclick:!0,cross_subdomain_cookie:nae(Se==null?void 0:Se.location),persistence:"localStorage+cookie",persistence_name:"",loaded:yI,save_campaign_params:!0,custom_campaign_params:[],custom_blocked_useragents:[],save_referrer:!0,capture_pageview:!0,capture_pageleave:"if_capture_pageview",debug:Yn&&fr(Yn==null?void 0:Yn.search)&&Yn.search.indexOf("__posthog_debug=true")!==-1||!1,cookie_expiration:365,upgrade:!1,disable_session_recording:!1,disable_persistence:!1,disable_web_experiments:!0,disable_surveys:!1,disable_external_dependency_loading:!1,enable_recording_console_log:void 0,secure_cookie:(Y==null||(n=Y.location)==null?void 0:n.protocol)==="https:",ip:!0,opt_out_capturing_by_default:!1,opt_out_persistence_by_default:!1,opt_out_useragent_filter:!1,opt_out_capturing_persistence_type:"localStorage",opt_out_capturing_cookie_prefix:null,opt_in_site_apps:!1,property_denylist:[],respect_dnt:!1,sanitize_properties:null,request_headers:{},request_batching:!0,properties_string_max_length:65535,session_recording:{},mask_all_element_attributes:!1,mask_all_text:!1,mask_personal_data_properties:!1,custom_personal_data_properties:[],advanced_disable_decide:!1,advanced_disable_feature_flags:!1,advanced_disable_feature_flags_on_first_load:!1,advanced_disable_toolbar_metrics:!1,feature_flag_request_timeout_ms:3e3,surveys_request_timeout_ms:1e4,on_request_error:e=>{var t="Bad HTTP status: "+e.statusCode+" "+e.text;Ce.error(t)},get_device_id:e=>e,capture_performance:void 0,name:"posthog",bootstrap:{},disable_compression:!1,session_idle_timeout_seconds:1800,person_profiles:"identified_only",before_send:void 0,request_queue_config:{flush_interval_ms:gI},_onCapture:yI}},v4=n=>{var e={};we(n.process_person)||(e.person_profiles=n.process_person),we(n.xhr_headers)||(e.request_headers=n.xhr_headers),we(n.cookie_name)||(e.persistence_name=n.cookie_name),we(n.disable_cookie)||(e.disable_persistence=n.disable_cookie),we(n.store_google)||(e.save_campaign_params=n.store_google),we(n.verbose)||(e.debug=n.verbose);var t=pr({},e,n);return sr(n.property_blacklist)&&(we(n.property_denylist)?t.property_denylist=n.property_blacklist:sr(n.property_denylist)?t.property_denylist=[...n.property_blacklist,...n.property_denylist]:Ce.error("Invalid value for property_denylist config: "+n.property_denylist)),t};class ace{constructor(){this.__forceAllowLocalhost=!1}get ss(){return this.__forceAllowLocalhost}set ss(e){Ce.error("WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`"),this.__forceAllowLocalhost=e}}class Sx{get decideEndpointWasHit(){var e,t;return(e=(t=this.featureFlags)==null?void 0:t.hasLoadedFlags)!==null&&e!==void 0&&e}constructor(){this.webPerformance=new ace,this.ns=!1,this.version=za.LIB_VERSION,this.os=new u4,this._calculate_event_properties=this.calculateEventProperties.bind(this),this.config=w4(),this.SentryIntegration=goe,this.sentryIntegration=e=>function(t,r){var s=Aq(t,r);return{name:Pq,processEvent:i=>s(i)}}(this,e),this.__request_queue=[],this.__loaded=!1,this.analyticsDefaultEndpoint="/e/",this.ls=!1,this.hs=null,this.us=null,this.ds=null,this.featureFlags=new Boe(this),this.toolbar=new woe(this),this.scrollManager=new Xoe(this),this.pageViewManager=new Eoe(this),this.surveys=new Hoe(this),this.experiments=new pn(this),this.exceptions=new koe(this),this.rateLimiter=new Koe(this),this.requestRouter=new sce(this),this.consent=new Cae(this),this.people={set:(e,t,r)=>{var s=fr(e)?{[e]:t}:e;this.setPersonProperties(s),r==null||r({})},set_once:(e,t,r)=>{var s=fr(e)?{[e]:t}:e;this.setPersonProperties(void 0,s),r==null||r({})}},this.on("eventCaptured",e=>Ce.info('send "'+(e==null?void 0:e.event)+'"',e))}init(e,t,r){if(r&&r!==Hh){var s,i=(s=sy[r])!==null&&s!==void 0?s:new Sx;return i._init(e,t,r),sy[r]=i,sy[Hh][r]=i,i}return this._init(e,t,r)}_init(e,t,r){var s,i;if(t===void 0&&(t={}),we(e)||w1(e))return Ce.critical("PostHog was initialized without a token. This likely indicates a misconfiguration. Please check the first argument passed to posthog.init()"),this;if(this.__loaded)return Ce.warn("You have already initialized PostHog! Re-initializing is a no-op"),this;this.__loaded=!0,this.config={},this.vs=[],t.person_profiles&&(this.us=t.person_profiles),this.set_config(pr({},w4(),v4(t),{name:r,token:e})),this.config.on_xhr_error&&Ce.error("on_xhr_error is deprecated. Use on_request_error instead"),this.compression=t.disable_compression?void 0:xi.GZipJS,this.persistence=new pI(this.config),this.sessionPersistence=this.config.persistence==="sessionStorage"||this.config.persistence==="memory"?this.persistence:new pI(_e({},this.config,{persistence:"sessionStorage"}));var a=_e({},this.persistence.props),o=_e({},this.sessionPersistence.props);if(this.cs=new Goe(w=>this.fs(w),this.config.request_queue_config),this.ps=new Joe(this),this.__request_queue=[],this.config.__preview_experimental_cookieless_mode||(this.sessionManager=new ece(this),this.sessionPropsManager=new Qoe(this,this.sessionManager,this.persistence)),new _oe(this).startIfEnabledOrStop(),this.siteApps=new rce(this),(s=this.siteApps)==null||s.init(),this.config.__preview_experimental_cookieless_mode||(this.sessionRecording=new poe(this),this.sessionRecording.startIfEnabledOrStop()),this.config.disable_scroll_properties||this.scrollManager.startMeasuringScrollPosition(),this.autocapture=new yae(this),this.autocapture.startIfEnabled(),this.surveys.loadIfEnabled(),this.heatmaps=new xoe(this),this.heatmaps.startIfEnabled(),this.webVitalsAutocapture=new boe(this),this.exceptionObserver=new Tae(this),this.exceptionObserver.startIfEnabled(),this.deadClicksAutocapture=new QU(this,Aae),this.deadClicksAutocapture.startIfEnabled(),this.historyAutocapture=new Hae(this),this.historyAutocapture.startIfEnabled(),za.DEBUG=za.DEBUG||this.config.debug,za.DEBUG&&Ce.info("Starting in debug mode",{this:this,config:t,thisC:_e({},this.config),p:a,s:o}),this.gs(),((i=t.bootstrap)==null?void 0:i.distinctID)!==void 0){var u,l,d=this.config.get_device_id(sc()),h=(u=t.bootstrap)!=null&&u.isIdentifiedID?d:t.bootstrap.distinctID;this.persistence.set_property(Ga,(l=t.bootstrap)!=null&&l.isIdentifiedID?"identified":"anonymous"),this.register({distinct_id:t.bootstrap.distinctID,$device_id:h})}if(this._s()){var f,p,m=Object.keys(((f=t.bootstrap)==null?void 0:f.featureFlags)||{}).filter(w=>{var v,b;return!((v=t.bootstrap)==null||(b=v.featureFlags)==null||!b[w])}).reduce((w,v)=>{var b,S;return w[v]=((b=t.bootstrap)==null||(S=b.featureFlags)==null?void 0:S[v])||!1,w},{}),g=Object.keys(((p=t.bootstrap)==null?void 0:p.featureFlagPayloads)||{}).filter(w=>m[w]).reduce((w,v)=>{var b,S,P,k;return(b=t.bootstrap)!=null&&(S=b.featureFlagPayloads)!=null&&S[v]&&(w[v]=(P=t.bootstrap)==null||(k=P.featureFlagPayloads)==null?void 0:k[v]),w},{});this.featureFlags.receivedFeatureFlags({featureFlags:m,featureFlagPayloads:g})}if(this.config.__preview_experimental_cookieless_mode)this.register_once({distinct_id:$U,$device_id:null},"");else if(!this.get_distinct_id()){var y=this.config.get_device_id(sc());this.register_once({distinct_id:y,$device_id:y},""),this.persistence.set_property(Ga,"anonymous")}return rr(Y,"onpagehide"in self?"pagehide":"unload",this._handle_unload.bind(this),{passive:!1}),this.toolbar.maybeLoadToolbar(),t.segment?moe(this,()=>this.bs()):this.bs(),Us(this.config._onCapture)&&this.config._onCapture!==yI&&(Ce.warn("onCapture is deprecated. Please use `before_send` instead"),this.on("eventCaptured",w=>this.config._onCapture(w.event,w))),this}_e(e){var t,r,s,i,a,o,u,l;if(!Se||!Se.body)return Ce.info("document not ready yet, trying again in 500 milliseconds..."),void setTimeout(()=>{this._e(e)},500);this.compression=void 0,e.supportedCompression&&!this.config.disable_compression&&(this.compression=nt(e.supportedCompression,xi.GZipJS)?xi.GZipJS:nt(e.supportedCompression,xi.Base64)?xi.Base64:void 0),(t=e.analytics)!=null&&t.endpoint&&(this.analyticsDefaultEndpoint=e.analytics.endpoint),this.set_config({person_profiles:this.us?this.us:"identified_only"}),(r=this.siteApps)==null||r.onRemoteConfig(e),(s=this.sessionRecording)==null||s.onRemoteConfig(e),(i=this.autocapture)==null||i.onRemoteConfig(e),(a=this.heatmaps)==null||a.onRemoteConfig(e),this.surveys.onRemoteConfig(e),(o=this.webVitalsAutocapture)==null||o.onRemoteConfig(e),(u=this.exceptionObserver)==null||u.onRemoteConfig(e),(l=this.deadClicksAutocapture)==null||l.onRemoteConfig(e)}bs(){try{this.config.loaded(this)}catch(e){Ce.critical("`loaded` function failed",e)}this.ws(),this.config.capture_pageview&&setTimeout(()=>{this.consent.isOptedIn()&&this.ys()},1),new Woe(this).load(),this.featureFlags.decide()}ws(){var e;this.has_opted_out_capturing()||this.config.request_batching&&((e=this.cs)==null||e.enable())}_dom_loaded(){this.has_opted_out_capturing()||rc(this.__request_queue,e=>this.fs(e)),this.__request_queue=[],this.ws()}_handle_unload(){var e,t;this.config.request_batching?(this.Ss()&&this.capture("$pageleave"),(e=this.cs)==null||e.unload(),(t=this.ps)==null||t.unload()):this.Ss()&&this.capture("$pageleave",null,{transport:"sendBeacon"})}ge(e){this.__loaded&&(y4?this.__request_queue.push(e):this.rateLimiter.isServerRateLimited(e.batchKey)||(e.transport=e.transport||this.config.api_transport,e.url=bx(e.url,{ip:this.config.ip?1:0}),e.headers=_e({},this.config.request_headers),e.compression=e.compression==="best-available"?this.compression:e.compression,e.fetchOptions=e.fetchOptions||this.config.fetch_options,(t=>{var r,s,i,a=_e({},t);a.timeout=a.timeout||6e4,a.url=bx(a.url,{_:new Date().getTime().toString(),ver:za.LIB_VERSION,compression:a.compression});var o=(r=a.transport)!==null&&r!==void 0?r:"fetch",u=(s=(i=vU(ny,l=>l.transport===o))==null?void 0:i.method)!==null&&s!==void 0?s:ny[0].method;if(!u)throw new Error("No available transport method");u(a)})(_e({},e,{callback:t=>{var r,s;this.rateLimiter.checkForLimiting(t),t.statusCode>=400&&((r=(s=this.config).on_request_error)==null||r.call(s,t)),e.callback==null||e.callback(t)}}))))}fs(e){this.ps?this.ps.retriableRequest(e):this.ge(e)}_execute_array(e){var t,r=[],s=[],i=[];rc(e,o=>{o&&(t=o[0],sr(t)?i.push(o):Us(o)?o.call(this):sr(o)&&t==="alias"?r.push(o):sr(o)&&t.indexOf("capture")!==-1&&Us(this[t])?i.push(o):s.push(o))});var a=function(o,u){rc(o,function(l){if(sr(l[0])){var d=u;jt(l,function(h){d=d[h[0]].apply(d,h.slice(1))})}else this[l[0]].apply(this,l.slice(1))},u)};a(r,this),a(s,this),a(i,this)}_s(){var e,t;return((e=this.config.bootstrap)==null?void 0:e.featureFlags)&&Object.keys((t=this.config.bootstrap)==null?void 0:t.featureFlags).length>0||!1}push(e){this._execute_array([e])}capture(e,t,r){var s;if(this.__loaded&&this.persistence&&this.sessionPersistence&&this.cs){if(!this.consent.isOptedOut())if(!we(e)&&fr(e)){if(this.config.opt_out_useragent_filter||!this._is_bot()){var i=r!=null&&r.skip_client_rate_limiting?void 0:this.rateLimiter.clientRateLimitContext();if(i==null||!i.isRateLimited){t!=null&&t.$current_url&&!fr(t==null?void 0:t.$current_url)&&(Ce.error("Invalid `$current_url` property provided to `posthog.capture`. Input must be a string. Ignoring provided value."),t==null||delete t.$current_url),this.sessionPersistence.update_search_keyword(),this.config.save_campaign_params&&this.sessionPersistence.update_campaign_params(),this.config.save_referrer&&this.sessionPersistence.update_referrer_info(),(this.config.save_campaign_params||this.config.save_referrer)&&this.persistence.set_initial_person_info();var a=new Date,o=(r==null?void 0:r.timestamp)||a,u=sc(),l={uuid:u,event:e,properties:this.calculateEventProperties(e,t||{},o,u)};i&&(l.properties.$lib_rate_limit_remaining_tokens=i.remainingTokens),r!=null&&r.$set&&(l.$set=r==null?void 0:r.$set);var d=this.$s(r==null?void 0:r.$set_once);d&&(l.$set_once=d),(l=tae(l,r!=null&&r._noTruncate?null:this.config.properties_string_max_length)).timestamp=o,we(r==null?void 0:r.timestamp)||(l.properties.$event_time_override_provided=!0,l.properties.$event_time_override_system_time=a);var h=_e({},l.properties.$set,l.$set);if(Mh(h)||this.setPersonPropertiesForFlags(h),!kt(this.config.before_send)){var f=this.ks(l);if(!f)return;l=f}this.os.emit("eventCaptured",l);var p={method:"POST",url:(s=r==null?void 0:r._url)!==null&&s!==void 0?s:this.requestRouter.endpointFor("api",this.analyticsDefaultEndpoint),data:l,compression:"best-available",batchKey:r==null?void 0:r._batchKey};return!this.config.request_batching||r&&(r==null||!r._batchKey)||r!=null&&r.send_instantly?this.fs(p):this.cs.enqueue(p),l}Ce.critical("This capture call is ignored due to client rate limiting.")}}else Ce.error("No event name provided to posthog.capture")}else Ce.uninitializedWarning("posthog.capture")}De(e){return this.on("eventCaptured",t=>e(t.event,t))}calculateEventProperties(e,t,r,s,i){if(r=r||new Date,!this.persistence||!this.sessionPersistence)return t;var a=i?void 0:this.persistence.remove_event_timer(e),o=_e({},t);if(o.token=this.config.token,this.config.__preview_experimental_cookieless_mode&&(o.$cookieless_mode=!0),e==="$snapshot"){var u=_e({},this.persistence.properties(),this.sessionPersistence.properties());return o.distinct_id=u.distinct_id,(!fr(o.distinct_id)&&!ln(o.distinct_id)||w1(o.distinct_id))&&Ce.error("Invalid distinct_id for replay event. This indicates a bug in your implementation"),o}var l,d=joe(this.config.mask_personal_data_properties,this.config.custom_personal_data_properties);if(this.sessionManager){var{sessionId:h,windowId:f}=this.sessionManager.checkAndGetSessionAndWindowId(i,r.getTime());o.$session_id=h,o.$window_id=f}this.sessionPropsManager&&pr(o,this.sessionPropsManager.getSessionProps());try{var p;this.sessionRecording&&pr(o,this.sessionRecording.sdkDebugProperties),o.$sdk_debug_retry_queue_size=(p=this.ps)==null?void 0:p.length}catch(w){o.$sdk_debug_error_capturing_properties=String(w)}if(this.requestRouter.region===Uu.CUSTOM&&(o.$lib_custom_api_host=this.config.api_host),l=e!=="$pageview"||i?e!=="$pageleave"||i?this.pageViewManager.doEvent():this.pageViewManager.doPageLeave(r):this.pageViewManager.doPageView(r,s),o=pr(o,l),e==="$pageview"&&Se&&(o.title=Se.title),!we(a)){var m=r.getTime()-a;o.$duration=parseFloat((m/1e3).toFixed(3))}Qn&&this.config.opt_out_useragent_filter&&(o.$browser_type=this._is_bot()?"bot":"browser"),(o=pr({},d,this.persistence.properties(),this.sessionPersistence.properties(),o)).$is_identified=this._isIdentified(),sr(this.config.property_denylist)?jt(this.config.property_denylist,function(w){delete o[w]}):Ce.error("Invalid value for property_denylist config: "+this.config.property_denylist+" or property_blacklist config: "+this.config.property_blacklist);var g=this.config.sanitize_properties;g&&(Ce.error("sanitize_properties is deprecated. Use before_send instead"),o=g(o,e));var y=this.xs();return o.$process_person_profile=y,y&&!i&&this.Es("_calculate_event_properties"),o}$s(e){var t;if(!this.persistence||!this.xs()||this.ns)return e;var r=this.persistence.get_initial_props(),s=(t=this.sessionPropsManager)==null?void 0:t.getSetOnceProps(),i=pr({},r,s||{},e||{}),a=this.config.sanitize_properties;return a&&(Ce.error("sanitize_properties is deprecated. Use before_send instead"),i=a(i,"$set_once")),this.ns=!0,Mh(i)?void 0:i}register(e,t){var r;(r=this.persistence)==null||r.register(e,t)}register_once(e,t,r){var s;(s=this.persistence)==null||s.register_once(e,t,r)}register_for_session(e){var t;(t=this.sessionPersistence)==null||t.register(e)}unregister(e){var t;(t=this.persistence)==null||t.unregister(e)}unregister_for_session(e){var t;(t=this.sessionPersistence)==null||t.unregister(e)}Is(e,t){this.register({[e]:t})}getFeatureFlag(e,t){return this.featureFlags.getFeatureFlag(e,t)}getFeatureFlagPayload(e){var t=this.featureFlags.getFeatureFlagPayload(e);try{return JSON.parse(t)}catch{return t}}isFeatureEnabled(e,t){return this.featureFlags.isFeatureEnabled(e,t)}reloadFeatureFlags(){this.featureFlags.reloadFeatureFlags()}updateEarlyAccessFeatureEnrollment(e,t){this.featureFlags.updateEarlyAccessFeatureEnrollment(e,t)}getEarlyAccessFeatures(e,t,r){return t===void 0&&(t=!1),this.featureFlags.getEarlyAccessFeatures(e,t,r)}on(e,t){return this.os.on(e,t)}onFeatureFlags(e){return this.featureFlags.onFeatureFlags(e)}onSurveysLoaded(e){return this.surveys.onSurveysLoaded(e)}onSessionId(e){var t,r;return(t=(r=this.sessionManager)==null?void 0:r.onSessionId(e))!==null&&t!==void 0?t:()=>{}}getSurveys(e,t){t===void 0&&(t=!1),this.surveys.getSurveys(e,t)}getActiveMatchingSurveys(e,t){t===void 0&&(t=!1),this.surveys.getActiveMatchingSurveys(e,t)}renderSurvey(e,t){this.surveys.renderSurvey(e,t)}canRenderSurvey(e){return this.surveys.canRenderSurvey(e)}canRenderSurveyAsync(e,t){return t===void 0&&(t=!1),this.surveys.canRenderSurveyAsync(e,t)}identify(e,t,r){if(!this.__loaded||!this.persistence)return Ce.uninitializedWarning("posthog.identify");if(ln(e)&&(e=e.toString(),Ce.warn("The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.")),e){if(["distinct_id","distinctid"].includes(e.toLowerCase()))Ce.critical('The string "'+e+'" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.');else if(this.Es("posthog.identify")){var s=this.get_distinct_id();if(this.register({$user_id:e}),!this.get_property("$device_id")){var i=s;this.register_once({$had_persisted_distinct_id:!0,$device_id:i},"")}e!==s&&e!==this.get_property(Ug)&&(this.unregister(Ug),this.register({distinct_id:e}));var a=(this.persistence.get_property(Ga)||"anonymous")==="anonymous";e!==s&&a?(this.persistence.set_property(Ga,"identified"),this.setPersonPropertiesForFlags(_e({},r||{},t||{}),!1),this.capture("$identify",{distinct_id:e,$anon_distinct_id:s},{$set:t||{},$set_once:r||{}}),this.ds=m4(e,t,r),this.featureFlags.setAnonymousDistinctId(s)):(t||r)&&this.setPersonProperties(t,r),e!==s&&(this.reloadFeatureFlags(),this.unregister(YS))}}else Ce.error("Unique user id has not been set in posthog.identify")}setPersonProperties(e,t){if((e||t)&&this.Es("posthog.setPersonProperties")){var r=m4(this.get_distinct_id(),e,t);this.ds!==r?(this.setPersonPropertiesForFlags(_e({},t||{},e||{})),this.capture("$set",{$set:e||{},$set_once:t||{}}),this.ds=r):Ce.info("A duplicate setPersonProperties call was made with the same properties. It has been ignored.")}}group(e,t,r){if(e&&t){if(this.Es("posthog.group")){var s=this.getGroups();s[e]!==t&&this.resetGroupPropertiesForFlags(e),this.register({$groups:_e({},s,{[e]:t})}),r&&(this.capture("$groupidentify",{$group_type:e,$group_key:t,$group_set:r}),this.setGroupPropertiesForFlags({[e]:r})),s[e]===t||r||this.reloadFeatureFlags()}}else Ce.error("posthog.group requires a group type and group key")}resetGroups(){this.register({$groups:{}}),this.resetGroupPropertiesForFlags(),this.reloadFeatureFlags()}setPersonPropertiesForFlags(e,t){t===void 0&&(t=!0),this.featureFlags.setPersonPropertiesForFlags(e,t)}resetPersonPropertiesForFlags(){this.featureFlags.resetPersonPropertiesForFlags()}setGroupPropertiesForFlags(e,t){t===void 0&&(t=!0),this.Es("posthog.setGroupPropertiesForFlags")&&this.featureFlags.setGroupPropertiesForFlags(e,t)}resetGroupPropertiesForFlags(e){this.featureFlags.resetGroupPropertiesForFlags(e)}reset(e){var t,r,s,i;if(Ce.info("reset"),!this.__loaded)return Ce.uninitializedWarning("posthog.reset");var a=this.get_property("$device_id");if(this.consent.reset(),(t=this.persistence)==null||t.clear(),(r=this.sessionPersistence)==null||r.clear(),this.surveys.reset(),(s=this.persistence)==null||s.set_property(Ga,"anonymous"),(i=this.sessionManager)==null||i.resetSessionId(),this.ds=null,this.config.__preview_experimental_cookieless_mode)this.register_once({distinct_id:$U,$device_id:null},"");else{var o=this.config.get_device_id(sc());this.register_once({distinct_id:o,$device_id:e?o:a},"")}this.register({$last_posthog_reset:new Date().toISOString()},1)}get_distinct_id(){return this.get_property("distinct_id")}getGroups(){return this.get_property("$groups")||{}}get_session_id(){var e,t;return(e=(t=this.sessionManager)==null?void 0:t.checkAndGetSessionAndWindowId(!0).sessionId)!==null&&e!==void 0?e:""}get_session_replay_url(e){if(!this.sessionManager)return"";var{sessionId:t,sessionStartTimestamp:r}=this.sessionManager.checkAndGetSessionAndWindowId(!0),s=this.requestRouter.endpointFor("ui","/project/"+this.config.token+"/replay/"+t);if(e!=null&&e.withTimestamp&&r){var i,a=(i=e.timestampLookBack)!==null&&i!==void 0?i:10;if(!r)return s;s+="?t="+Math.max(Math.floor((new Date().getTime()-r)/1e3)-a,0)}return s}alias(e,t){return e===this.get_property(_U)?(Ce.critical("Attempting to create alias for existing People user - aborting."),-2):this.Es("posthog.alias")?(we(t)&&(t=this.get_distinct_id()),e!==t?(this.Is(Ug,e),this.capture("$create_alias",{alias:e,distinct_id:t})):(Ce.warn("alias matches current distinct_id - skipping api call."),this.identify(e),-1)):void 0}set_config(e){var t,r,s,i,a=_e({},this.config);ir(e)&&(pr(this.config,v4(e)),(t=this.persistence)==null||t.update_config(this.config,a),this.sessionPersistence=this.config.persistence==="sessionStorage"||this.config.persistence==="memory"?this.persistence:new pI(_e({},this.config,{persistence:"sessionStorage"})),Pr.O()&&Pr.A("ph_debug")==="true"&&(this.config.debug=!0),this.config.debug&&(za.DEBUG=!0,Ce.info("set_config",JSON.stringify({config:e,oldConfig:a,newConfig:_e({},this.config)},null,2))),(r=this.sessionRecording)==null||r.startIfEnabledOrStop(),(s=this.autocapture)==null||s.startIfEnabled(),(i=this.heatmaps)==null||i.startIfEnabled(),this.surveys.loadIfEnabled(),this.gs())}startSessionRecording(e){var t=e===!0,r={sampling:t||!(e==null||!e.sampling),linked_flag:t||!(e==null||!e.linked_flag),url_trigger:t||!(e==null||!e.url_trigger),event_trigger:t||!(e==null||!e.event_trigger)};if(Object.values(r).some(Boolean)){var s,i,a,o,u;(s=this.sessionManager)==null||s.checkAndGetSessionAndWindowId(),r.sampling&&((i=this.sessionRecording)==null||i.overrideSampling()),r.linked_flag&&((a=this.sessionRecording)==null||a.overrideLinkedFlag()),r.url_trigger&&((o=this.sessionRecording)==null||o.overrideTrigger("url")),r.event_trigger&&((u=this.sessionRecording)==null||u.overrideTrigger("event"))}this.set_config({disable_session_recording:!1})}stopSessionRecording(){this.set_config({disable_session_recording:!0})}sessionRecordingStarted(){var e;return!((e=this.sessionRecording)==null||!e.started)}captureException(e,t){var r=new Error("PostHog syntheticException");this.exceptions.sendExceptionEvent(_e({},qae((s=>s instanceof Error)(e)?{error:e,event:e.message}:{event:e},{syntheticException:r}),t))}loadToolbar(e){return this.toolbar.loadToolbar(e)}get_property(e){var t;return(t=this.persistence)==null?void 0:t.props[e]}getSessionProperty(e){var t;return(t=this.sessionPersistence)==null?void 0:t.props[e]}toString(){var e,t=(e=this.config.name)!==null&&e!==void 0?e:Hh;return t!==Hh&&(t=Hh+"."+t),t}_isIdentified(){var e,t;return((e=this.persistence)==null?void 0:e.get_property(Ga))==="identified"||((t=this.sessionPersistence)==null?void 0:t.get_property(Ga))==="identified"}xs(){var e,t,r,s;return!(this.config.person_profiles==="never"||this.config.person_profiles==="identified_only"&&!this._isIdentified()&&Mh(this.getGroups())&&((e=this.persistence)==null||(t=e.props)==null||!t[Ug])&&((r=this.persistence)==null||(s=r.props)==null||!s[ex]))}Ss(){return this.config.capture_pageleave===!0||this.config.capture_pageleave==="if_capture_pageview"&&(this.config.capture_pageview===!0||this.config.capture_pageview==="history_change")}createPersonProfile(){this.xs()||this.Es("posthog.createPersonProfile")&&this.setPersonProperties({},{})}Es(e){return this.config.person_profiles==="never"?(Ce.error(e+' was called, but process_person is set to "never". This call will be ignored.'),!1):(this.Is(ex,!0),!0)}gs(){var e,t,r,s,i=this.consent.isOptedOut(),a=this.config.opt_out_persistence_by_default,o=this.config.disable_persistence||i&&!!a;((e=this.persistence)==null?void 0:e.$e)!==o&&((r=this.persistence)==null||r.set_disabled(o)),((t=this.sessionPersistence)==null?void 0:t.$e)!==o&&((s=this.sessionPersistence)==null||s.set_disabled(o))}opt_in_capturing(e){var t;this.consent.optInOut(!0),this.gs(),(we(e==null?void 0:e.captureEventName)||e!=null&&e.captureEventName)&&this.capture((t=e==null?void 0:e.captureEventName)!==null&&t!==void 0?t:"$opt_in",e==null?void 0:e.captureProperties,{send_instantly:!0}),this.config.capture_pageview&&this.ys()}opt_out_capturing(){this.consent.optInOut(!1),this.gs()}has_opted_in_capturing(){return this.consent.isOptedIn()}has_opted_out_capturing(){return this.consent.isOptedOut()}clear_opt_in_out_capturing(){this.consent.reset(),this.gs()}_is_bot(){return ws?p4(ws,this.config.custom_blocked_useragents):void 0}ys(){Se&&(Se.visibilityState==="visible"?this.ls||(this.ls=!0,this.capture("$pageview",{title:Se.title},{send_instantly:!0}),this.hs&&(Se.removeEventListener("visibilitychange",this.hs),this.hs=null)):this.hs||(this.hs=this.ys.bind(this),rr(Se,"visibilitychange",this.hs)))}debug(e){e===!1?(Y==null||Y.console.log("You've disabled debug mode."),localStorage&&localStorage.removeItem("ph_debug"),this.set_config({debug:!1})):(Y==null||Y.console.log("You're now in debug mode. All calls to PostHog will be logged in your console.\nYou can disable this with `posthog.debug(false)`."),localStorage&&localStorage.setItem("ph_debug","true"),this.set_config({debug:!0}))}ks(e){if(kt(this.config.before_send))return e;var t=sr(this.config.before_send)?this.config.before_send:[this.config.before_send],r=e;for(var s of t){if(r=s(r),kt(r)){var i="Event '"+e.event+"' was rejected in beforeSend function";return Yie(e.event)?Ce.warn(i+". This can cause unexpected behavior."):Ce.info(i),null}r.properties&&!Mh(r.properties)||Ce.warn("Event '"+e.event+"' has no properties after beforeSend function, this is likely an error.")}return r}getPageViewId(){var e;return(e=this.pageViewManager.ne)==null?void 0:e.pageViewId}captureTraceFeedback(e,t){this.capture("$ai_feedback",{$ai_trace_id:String(e),$ai_feedback_text:t})}captureTraceMetric(e,t,r){this.capture("$ai_metric",{$ai_trace_id:String(e),$ai_metric_name:t,$ai_metric_value:String(r)})}}(function(n,e){for(var t=0;t<e.length;t++)n.prototype[e[t]]=eae(n.prototype[e[t]])})(Sx,["identify"]);var _4,b4,S4,x4,E4,k4;(function(n){n.Button="button",n.Tab="tab",n.Selector="selector"})(_4||(_4={})),function(n){n.Left="left",n.Center="center",n.Right="right",n.NextToTrigger="next_to_trigger"}(b4||(b4={})),function(n){n.Popover="popover",n.API="api",n.Widget="widget"}(S4||(S4={})),function(n){n.Open="open",n.MultipleChoice="multiple_choice",n.SingleChoice="single_choice",n.Rating="rating",n.Link="link"}(x4||(x4={})),function(n){n.NextQuestion="next_question",n.End="end",n.ResponseBased="response_based",n.SpecificQuestion="specific_question"}(E4||(E4={})),function(n){n.Once="once",n.Recurring="recurring",n.Always="always"}(k4||(k4={}));var C4,P4=(C4=sy[Hh]=new Sx,function(){function n(){n.done||(n.done=!0,y4=!1,jt(sy,function(e){e._dom_loaded()}))}Se!=null&&Se.addEventListener?Se.readyState==="complete"?n():rr(Se,"DOMContentLoaded",n,{capture:!1}):Y&&Ce.error("Browser doesn't support `document.addEventListener` so PostHog couldn't be initialized")}(),C4);P4.init("phc_nWs0kBH4Kx4lYOQNFL4lzUncjnEHuDPsCwhewmEgOOJ",{api_host:"https://us.i.posthog.com",person_profiles:"identified_only"});function A4(n,e={}){const t=`ai_agent:${n}`;P4.capture(t,e)}const vs=Xs("background");chrome.runtime.onInstalled.addListener(async n=>{if(n.reason==="install"||n.reason==="update"){vs.info("Extension installed or updated, initializing default settings");try{const e=await UE.getSettings();(!e||Object.keys(e).length===0)&&(await UE.updateSettings({maxSteps:Cr.generalSettings.maxSteps,maxActionsPerStep:Cr.generalSettings.maxActionsPerStep,maxFailures:Cr.generalSettings.maxFailures,useVision:Cr.generalSettings.useVision,useVisionForPlanner:Cr.generalSettings.useVisionForPlanner,planningInterval:Cr.generalSettings.planningInterval}),vs.info("Default general settings initialized"));const t=await jE.getAllProviders();if(Object.keys(t).length===0){for(const[s,i]of Object.entries(Cr.llmProviders))await jE.setProvider(s,{name:i.name,apiKey:i.apiKey,modelNames:i.models});vs.info("Default LLM providers initialized")}const r=await Qc.getAllAgentModels();Object.keys(r).length===0&&(await Qc.setAgentModel(Ea.Planner,{provider:Cr.modelSelections.planner.provider,modelName:Cr.modelSelections.planner.modelName,parameters:Cr.modelSelections.planner.parameters}),await Qc.setAgentModel(Ea.Navigator,{provider:Cr.modelSelections.navigator.provider,modelName:Cr.modelSelections.navigator.modelName,parameters:Cr.modelSelections.navigator.parameters}),await Qc.setAgentModel(Ea.Validator,{provider:Cr.modelSelections.validator.provider,modelName:Cr.modelSelections.validator.modelName,parameters:Cr.modelSelections.validator.parameters}),vs.info("Default agent models initialized"))}catch(e){vs.error("Failed to initialize default settings:",e)}}});async function oce(){try{const n=await Qc.getAgentModel(Ea.Navigator);console.log("Current navigator model:",n),(!n||!n.modelName)&&(console.log("Navigator model not set, setting default navigator model"),await Qc.setAgentModel(Ea.Navigator,{provider:Cr.modelSelections.navigator.provider,modelName:Cr.modelSelections.navigator.modelName,parameters:Cr.modelSelections.navigator.parameters}),console.log("Navigator model has been set"))}catch(n){console.error("Failed to ensure navigator model:",n)}}oce();const xx=new TG({});let mn=null,Ex=null;chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(n=>console.error(n));async function cce(n){var e;try{return((e=(await chrome.scripting.executeScript({target:{tabId:n},func:()=>Object.prototype.hasOwnProperty.call(window,"buildDomTree")}))[0])==null?void 0:e.result)||!1}catch(t){return console.error("Failed to check script injection status:",t),!1}}async function uce(n){try{if(await cce(n)){console.log("Scripts already injected, skipping...");return}await chrome.scripting.executeScript({target:{tabId:n},files:["buildDomTree.js"]}),console.log("Scripts successfully injected")}catch(e){console.error("Failed to inject scripts:",e)}}chrome.tabs.onUpdated.addListener(async(n,e,t)=>{var r;n&&e.status==="complete"&&((r=t.url)!=null&&r.startsWith("http"))&&await uce(n)}),chrome.debugger.onDetach.addListener(async(n,e)=>{console.log("Debugger detached:",n,e),e==="canceled_by_user"&&n.tabId&&await xx.cleanup()}),chrome.tabs.onRemoved.addListener(n=>{xx.removeAttachedPage(n)}),vs.info("background loaded"),chrome.runtime.onConnect.addListener(n=>{n.name==="side-panel-connection"&&(Ex=n,n.onMessage.addListener(async e=>{try{switch(e.type){case"heartbeat":n.postMessage({type:"heartbeat_ack"});break;case"new_task":{if(A4("new_task"),!e.task)return n.postMessage({type:"error",error:"No task provided"});if(!e.tabId)return n.postMessage({type:"error",error:"No tab ID provided"});vs.info("new_task",e.tabId,e.task),mn=await lce(e.taskId,e.task,xx),T4(mn);const t=await mn.execute();vs.info("new_task execution result",e.tabId,t);break}case"follow_up_task":{if(!e.task)return n.postMessage({type:"error",error:"No follow up task provided"});if(!e.tabId)return n.postMessage({type:"error",error:"No tab ID provided"});if(vs.info("follow_up_task",e.tabId,e.task),mn){mn.addFollowUpTask(e.task),T4(mn);const t=await mn.execute();vs.info("follow_up_task execution result",e.tabId,t)}else return vs.info("follow_up_task: executor was cleaned up, can not add follow-up task"),n.postMessage({type:"error",error:"Executor was cleaned up, can not add follow-up task"});break}case"cancel_task":{if(A4("cancel_task"),!mn)return n.postMessage({type:"error",error:"No task to cancel"});await mn.cancel();break}case"screenshot":{if(!e.tabId)return n.postMessage({type:"error",error:"No tab ID provided"});const r=await(await xx.switchTab(e.tabId)).takeScreenshot();return vs.info("screenshot",e.tabId,r),n.postMessage({type:"success",screenshot:r})}case"resume_task":return mn?(await mn.resume(),n.postMessage({type:"success"})):n.postMessage({type:"error",error:"No task to resume"});case"pause_task":return mn?(await mn.pause(),n.postMessage({type:"success"})):n.postMessage({type:"error",error:"No task to pause"});default:return n.postMessage({type:"error",error:"Unknown message type"})}}catch(t){console.error("Error handling port message:",t),n.postMessage({type:"error",error:t instanceof Error?t.message:"Unknown error"})}}),n.onDisconnect.addListener(()=>{console.log("Side panel disconnected"),Ex=null}))});async function lce(n,e,t){const r=await jE.getAllProviders();if(Object.keys(r).length===0)throw new Error("Please configure API keys in the settings first");const s=await Qc.getAllAgentModels();for(const p of Object.values(s))if(!r[p.provider])throw new Error(`Provider ${p.provider} not found in the settings`);const i=s[Ea.Navigator];if(!i)throw new Error("Please choose a model for the navigator in the settings first");const a=f1(r[i.provider],i);let o=null;const u=s[Ea.Planner];u&&(o=f1(r[u.provider],u));let l=null;const d=s[Ea.Validator];d&&(l=f1(r[d.provider],d));const h=await UE.getSettings();return new lY(e,n,t,a,{plannerLLM:o??a,validatorLLM:l??a,agentOptions:{maxSteps:h.maxSteps,maxFailures:h.maxFailures,maxActionsPerStep:h.maxActionsPerStep,useVision:h.useVision,useVisionForPlanner:h.useVisionForPlanner,planningInterval:h.planningInterval}})}async function T4(n){n.clearExecutionEvents(),n.subscribeExecutionEvents(async e=>{try{Ex&&Ex.postMessage(e)}catch(t){vs.error("Failed to send message to side panel:",t)}(e.state===Ie.TASK_OK||e.state===Ie.TASK_FAIL||e.state===Ie.TASK_CANCEL)&&await(mn==null?void 0:mn.cleanup())})}var kx={exports:{}},wI,I4;function dce(){if(I4)return wI;I4=1;var n=1e3,e=n*60,t=e*60,r=t*24,s=r*7,i=r*365.25;wI=function(d,h){h=h||{};var f=typeof d;if(f==="string"&&d.length>0)return a(d);if(f==="number"&&isFinite(d))return h.long?u(d):o(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function a(d){if(d=String(d),!(d.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(h){var f=parseFloat(h[1]),p=(h[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return f*i;case"weeks":case"week":case"w":return f*s;case"days":case"day":case"d":return f*r;case"hours":case"hour":case"hrs":case"hr":case"h":return f*t;case"minutes":case"minute":case"mins":case"min":case"m":return f*e;case"seconds":case"second":case"secs":case"sec":case"s":return f*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function o(d){var h=Math.abs(d);return h>=r?Math.round(d/r)+"d":h>=t?Math.round(d/t)+"h":h>=e?Math.round(d/e)+"m":h>=n?Math.round(d/n)+"s":d+"ms"}function u(d){var h=Math.abs(d);return h>=r?l(d,h,r,"day"):h>=t?l(d,h,t,"hour"):h>=e?l(d,h,e,"minute"):h>=n?l(d,h,n,"second"):d+" ms"}function l(d,h,f,p){var m=h>=f*1.5;return Math.round(d/f)+" "+p+(m?"s":"")}return wI}var vI,O4;function hce(){if(O4)return vI;O4=1;function n(e){r.debug=r,r.default=r,r.coerce=l,r.disable=o,r.enable=i,r.enabled=u,r.humanize=dce(),r.destroy=d,Object.keys(e).forEach(h=>{r[h]=e[h]}),r.names=[],r.skips=[],r.formatters={};function t(h){let f=0;for(let p=0;p<h.length;p++)f=(f<<5)-f+h.charCodeAt(p),f|=0;return r.colors[Math.abs(f)%r.colors.length]}r.selectColor=t;function r(h){let f,p=null,m,g;function y(...w){if(!y.enabled)return;const v=y,b=Number(new Date),S=b-(f||b);v.diff=S,v.prev=f,v.curr=b,f=b,w[0]=r.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let P=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,(C,E)=>{if(C==="%%")return"%";P++;const M=r.formatters[E];if(typeof M=="function"){const I=w[P];C=M.call(v,I),w.splice(P,1),P--}return C}),r.formatArgs.call(v,w),(v.log||r.log).apply(v,w)}return y.namespace=h,y.useColors=r.useColors(),y.color=r.selectColor(h),y.extend=s,y.destroy=r.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(m!==r.namespaces&&(m=r.namespaces,g=r.enabled(h)),g),set:w=>{p=w}}),typeof r.init=="function"&&r.init(y),y}function s(h,f){const p=r(this.namespace+(typeof f>"u"?":":f)+h);return p.log=this.log,p}function i(h){r.save(h),r.namespaces=h,r.names=[],r.skips=[];const f=(typeof h=="string"?h:"").trim().replace(" ",",").split(",").filter(Boolean);for(const p of f)p[0]==="-"?r.skips.push(p.slice(1)):r.names.push(p)}function a(h,f){let p=0,m=0,g=-1,y=0;for(;p<h.length;)if(m<f.length&&(f[m]===h[p]||f[m]==="*"))f[m]==="*"?(g=m,y=p,m++):(p++,m++);else if(g!==-1)m=g+1,y++,p=y;else return!1;for(;m<f.length&&f[m]==="*";)m++;return m===f.length}function o(){const h=[...r.names,...r.skips.map(f=>"-"+f)].join(",");return r.enable(""),h}function u(h){for(const f of r.skips)if(a(h,f))return!1;for(const f of r.names)if(a(h,f))return!0;return!1}function l(h){return h instanceof Error?h.stack||h.message:h}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return vI=n,vI}var R4;function fce(){return R4||(R4=1,function(n,e){e.formatArgs=r,e.save=s,e.load=i,e.useColors=t,e.storage=a(),e.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let u;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(u=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(u[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;u.splice(1,0,l,"color: inherit");let d=0,h=0;u[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(d++,f==="%c"&&(h=d))}),u.splice(h,0,l)}e.log=console.debug||console.log||(()=>{});function s(u){try{u?e.storage.setItem("debug",u):e.storage.removeItem("debug")}catch{}}function i(){let u;try{u=e.storage.getItem("debug")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u=process.env.DEBUG),u}function a(){try{return localStorage}catch{}}n.exports=hce()(e);const{formatters:o}=n.exports;o.j=function(u){try{return JSON.stringify(u)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}}(kx,kx.exports)),kx.exports}var pce=fce();const mce=Object.freeze(Object.defineProperty({__proto__:null,default:Qe(pce)},Symbol.toStringTag,{value:"Module"}));var _I={},iy={},qu={};function gce(n){return{all:n=n||new Map,on:function(e,t){var r=n.get(e);r?r.push(t):n.set(e,[t])},off:function(e,t){var r=n.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):n.set(e,[]))},emit:function(e,t){var r=n.get(e);r&&r.slice().map(function(s){s(t)}),(r=n.get("*"))&&r.slice().map(function(s){s(e,t)})}}}const yce=ct(Object.freeze(Object.defineProperty({__proto__:null,default:gce},Symbol.toStringTag,{value:"Module"})));var M4;function Kh(){var r,s;if(M4)return qu;M4=1;var n=qu&&qu.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(qu,"__esModule",{value:!0}),qu.EventEmitter=void 0;const e=n(yce);let t=(s=class{constructor(){_(this,r,(0,e.default)())}on(a,o){return c(this,r).on(a,o),this}once(a,o){const u=l=>{o(l),this.off(a,u)};return this.on(a,u)}off(a,o){return c(this,r).off(a,o),this}emit(a,o){c(this,r).emit(a,o)}removeAllListeners(a){return a?c(this,r).all.delete(a):c(this,r).all.clear(),this}},r=new WeakMap,s);return qu.EventEmitter=t,qu}var ay={},$4;function Ws(){if($4)return ay;$4=1,Object.defineProperty(ay,"__esModule",{value:!0}),ay.LogType=void 0;var n;return function(e){e.bidi="bidi",e.cdp="cdp",e.debug="debug",e.debugError="debug:error",e.debugInfo="debug:info"}(n||(ay.LogType=n={})),ay}var oy={},N4;function wce(){var r,s,i,a,o,u,a6;if(N4)return oy;N4=1;var n;Object.defineProperty(oy,"__esModule",{value:!0}),oy.ProcessingQueue=void 0;const e=Ws();let t=(r=class{constructor(h,f){_(this,u);_(this,s);_(this,i);_(this,a,[]);_(this,o,!1);x(this,i,h),x(this,s,f)}add(h,f){c(this,a).push([h,f]),A(this,u,a6).call(this)}},s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakSet,a6=async function(){var h;if(!c(this,o)){for(x(this,o,!0);c(this,a).length>0;){const f=c(this,a).shift();if(!f)continue;const[p,m]=f;(h=c(this,s))==null||h.call(this,n.LOGGER_PREFIX,"Processing event:",m),await p.then(g=>{var y;if(g.kind==="error"){(y=c(this,s))==null||y.call(this,e.LogType.debugError,"Event threw before sending:",g.error.message,g.error.stack);return}return c(this,i).call(this,g.value)}).catch(g=>{var y;(y=c(this,s))==null||y.call(this,e.LogType.debugError,"Event was not processed:",g==null?void 0:g.message)})}x(this,o,!1)}},J(r,"LOGGER_PREFIX",`${e.LogType.debug}:queue`),r);return oy.ProcessingQueue=t,n=t,oy}var cy={},ki={},bI={},F4;function vce(){return F4||(F4=1,Object.defineProperty(bI,"__esModule",{value:!0})),bI}var rn={},L4;function j4(){if(L4)return rn;L4=1,Object.defineProperty(rn,"__esModule",{value:!0}),rn.EVENT_NAMES=rn.Bluetooth=rn.Network=rn.BrowsingContext=rn.Log=rn.Script=rn.BiDiModule=void 0;var n;(function(a){a.Bluetooth="bluetooth",a.Browser="browser",a.BrowsingContext="browsingContext",a.Cdp="goog:cdp",a.DeprecatedCdp="cdp",a.Input="input",a.Log="log",a.Network="network",a.Script="script",a.Session="session"})(n||(rn.BiDiModule=n={}));var e;(function(a){(function(o){o.Message="script.message",o.RealmCreated="script.realmCreated",o.RealmDestroyed="script.realmDestroyed"})(a.EventNames||(a.EventNames={}))})(e||(rn.Script=e={}));var t;(function(a){(function(o){o.LogEntryAdded="log.entryAdded"})(a.EventNames||(a.EventNames={}))})(t||(rn.Log=t={}));var r;(function(a){(function(o){o.ContextCreated="browsingContext.contextCreated",o.ContextDestroyed="browsingContext.contextDestroyed",o.DomContentLoaded="browsingContext.domContentLoaded",o.DownloadWillBegin="browsingContext.downloadWillBegin",o.FragmentNavigated="browsingContext.fragmentNavigated",o.HistoryUpdated="browsingContext.historyUpdated",o.Load="browsingContext.load",o.NavigationAborted="browsingContext.navigationAborted",o.NavigationFailed="browsingContext.navigationFailed",o.NavigationStarted="browsingContext.navigationStarted",o.UserPromptClosed="browsingContext.userPromptClosed",o.UserPromptOpened="browsingContext.userPromptOpened"})(a.EventNames||(a.EventNames={}))})(r||(rn.BrowsingContext=r={}));var s;(function(a){(function(o){o.AuthRequired="network.authRequired",o.BeforeRequestSent="network.beforeRequestSent",o.FetchError="network.fetchError",o.ResponseCompleted="network.responseCompleted",o.ResponseStarted="network.responseStarted"})(a.EventNames||(a.EventNames={}))})(s||(rn.Network=s={}));var i;return function(a){(function(o){o.RequestDevicePromptUpdated="bluetooth.requestDevicePromptUpdated"})(a.EventNames||(a.EventNames={}))}(i||(rn.Bluetooth=i={})),rn.EVENT_NAMES=new Set([...Object.values(n),...Object.values(r.EventNames),...Object.values(t.EventNames),...Object.values(s.EventNames),...Object.values(e.EventNames)]),rn}var SI={},D4;function _ce(){return D4||(D4=1,Object.defineProperty(SI,"__esModule",{value:!0})),SI}var $e={},B4;function U4(){if(B4)return $e;B4=1,Object.defineProperty($e,"__esModule",{value:!0}),$e.NoSuchWebExtensionException=$e.InvalidWebExtensionException=$e.UnderspecifiedStoragePartitionException=$e.UnableToSetFileInputException=$e.UnableToSetCookieException=$e.NoSuchStoragePartitionException=$e.UnsupportedOperationException=$e.UnableToCloseBrowserException=$e.UnableToCaptureScreenException=$e.UnknownErrorException=$e.UnknownCommandException=$e.SessionNotCreatedException=$e.NoSuchUserContextException=$e.NoSuchScriptException=$e.NoSuchRequestException=$e.NoSuchNodeException=$e.NoSuchInterceptException=$e.NoSuchHistoryEntryException=$e.NoSuchHandleException=$e.NoSuchFrameException=$e.NoSuchElementException=$e.NoSuchAlertException=$e.MoveTargetOutOfBoundsException=$e.InvalidSessionIdException=$e.InvalidSelectorException=$e.InvalidArgumentException=$e.Exception=void 0;class n extends Error{constructor(T,L,U){super();J(this,"error");J(this,"message");J(this,"stacktrace");this.error=T,this.message=L,this.stacktrace=U}toErrorResponse(T){return{type:"error",id:T,error:this.error,message:this.message,stacktrace:this.stacktrace}}}$e.Exception=n;class e extends n{constructor(O,T){super("invalid argument",O,T)}}$e.InvalidArgumentException=e;class t extends n{constructor(O,T){super("invalid selector",O,T)}}$e.InvalidSelectorException=t;class r extends n{constructor(O,T){super("invalid session id",O,T)}}$e.InvalidSessionIdException=r;class s extends n{constructor(O,T){super("move target out of bounds",O,T)}}$e.MoveTargetOutOfBoundsException=s;class i extends n{constructor(O,T){super("no such alert",O,T)}}$e.NoSuchAlertException=i;class a extends n{constructor(O,T){super("no such element",O,T)}}$e.NoSuchElementException=a;class o extends n{constructor(O,T){super("no such frame",O,T)}}$e.NoSuchFrameException=o;class u extends n{constructor(O,T){super("no such handle",O,T)}}$e.NoSuchHandleException=u;class l extends n{constructor(O,T){super("no such history entry",O,T)}}$e.NoSuchHistoryEntryException=l;class d extends n{constructor(O,T){super("no such intercept",O,T)}}$e.NoSuchInterceptException=d;class h extends n{constructor(O,T){super("no such node",O,T)}}$e.NoSuchNodeException=h;class f extends n{constructor(O,T){super("no such request",O,T)}}$e.NoSuchRequestException=f;class p extends n{constructor(O,T){super("no such script",O,T)}}$e.NoSuchScriptException=p;class m extends n{constructor(O,T){super("no such user context",O,T)}}$e.NoSuchUserContextException=m;class g extends n{constructor(O,T){super("session not created",O,T)}}$e.SessionNotCreatedException=g;class y extends n{constructor(O,T){super("unknown command",O,T)}}$e.UnknownCommandException=y;class w extends n{constructor(O,T=new Error().stack){super("unknown error",O,T)}}$e.UnknownErrorException=w;class v extends n{constructor(O,T){super("unable to capture screen",O,T)}}$e.UnableToCaptureScreenException=v;class b extends n{constructor(O,T){super("unable to close browser",O,T)}}$e.UnableToCloseBrowserException=b;class S extends n{constructor(O,T){super("unsupported operation",O,T)}}$e.UnsupportedOperationException=S;class P extends n{constructor(O,T){super("no such storage partition",O,T)}}$e.NoSuchStoragePartitionException=P;class k extends n{constructor(O,T){super("unable to set cookie",O,T)}}$e.UnableToSetCookieException=k;class C extends n{constructor(O,T){super("unable to set file input",O,T)}}$e.UnableToSetFileInputException=C;class E extends n{constructor(O,T){super("underspecified storage partition",O,T)}}$e.UnderspecifiedStoragePartitionException=E;class M extends n{constructor(O,T){super("invalid web extension",O,T)}}$e.InvalidWebExtensionException=M;class I extends n{constructor(O,T){super("no such web extension",O,T)}}return $e.NoSuchWebExtensionException=I,$e}var xI={},q4;function bce(){return q4||(q4=1,Object.defineProperty(xI,"__esModule",{value:!0})),xI}var EI={},H4;function Sce(){return H4||(H4=1,Object.defineProperty(EI,"__esModule",{value:!0})),EI}var K4;function Ht(){return K4||(K4=1,function(n){var e=ki&&ki.__createBinding||(Object.create?function(i,a,o,u){u===void 0&&(u=o);var l=Object.getOwnPropertyDescriptor(a,o);(!l||("get"in l?!a.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(i,u,l)}:function(i,a,o,u){u===void 0&&(u=o),i[u]=a[o]}),t=ki&&ki.__setModuleDefault||(Object.create?function(i,a){Object.defineProperty(i,"default",{enumerable:!0,value:a})}:function(i,a){i.default=a}),r=ki&&ki.__importStar||function(){var i=function(a){return i=Object.getOwnPropertyNames||function(o){var u=[];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(u[u.length]=l);return u},i(a)};return function(a){if(a&&a.__esModule)return a;var o={};if(a!=null)for(var u=i(a),l=0;l<u.length;l++)u[l]!=="default"&&e(o,a,u[l]);return t(o,a),o}}(),s=ki&&ki.__exportStar||function(i,a){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&e(a,i,o)};Object.defineProperty(n,"__esModule",{value:!0}),n.ChromiumBidi=n.Cdp=void 0,n.Cdp=r(vce()),n.ChromiumBidi=r(j4()),s(_ce(),n),s(U4(),n),s(bce(),n),s(Sce(),n)}(ki)),ki}var uy={},W4;function xce(){if(W4)return uy;W4=1,Object.defineProperty(uy,"__esModule",{value:!0}),uy.BidiNoOpParser=void 0;let n=class{parseHandleRequestDevicePromptParams(t){return t}parseSimulateAdapterParameters(t){return t}parseSimulateAdvertisementParameters(t){return t}parseSimulatePreconnectedPeripheralParameters(t){return t}parseRemoveUserContextParams(t){return t}parseActivateParams(t){return t}parseCaptureScreenshotParams(t){return t}parseCloseParams(t){return t}parseCreateParams(t){return t}parseGetTreeParams(t){return t}parseHandleUserPromptParams(t){return t}parseLocateNodesParams(t){return t}parseNavigateParams(t){return t}parsePrintParams(t){return t}parseReloadParams(t){return t}parseSetViewportParams(t){return t}parseTraverseHistoryParams(t){return t}parseGetSessionParams(t){return t}parseResolveRealmParams(t){return t}parseSendCommandParams(t){return t}parseAddPreloadScriptParams(t){return t}parseCallFunctionParams(t){return t}parseDisownParams(t){return t}parseEvaluateParams(t){return t}parseGetRealmsParams(t){return t}parseRemovePreloadScriptParams(t){return t}parsePerformActionsParams(t){return t}parseReleaseActionsParams(t){return t}parseSetFilesParams(t){return t}parseAddInterceptParams(t){return t}parseContinueRequestParams(t){return t}parseContinueResponseParams(t){return t}parseContinueWithAuthParams(t){return t}parseFailRequestParams(t){return t}parseProvideResponseParams(t){return t}parseRemoveInterceptParams(t){return t}parseSetCacheBehavior(t){return t}parseSetPermissionsParams(t){return t}parseSubscribeParams(t){return t}parseDeleteCookiesParams(t){return t}parseGetCookiesParams(t){return t}parseSetCookieParams(t){return t}};return uy.BidiNoOpParser=n,uy}var ly={},z4;function Ece(){var t,r,s,o6,a;if(z4)return ly;z4=1,Object.defineProperty(ly,"__esModule",{value:!0}),ly.BrowserProcessor=void 0;const n=Ht();let e=(a=class{constructor(u,l){_(this,s);_(this,t);_(this,r);x(this,t,u),x(this,r,l)}close(){return setTimeout(()=>c(this,t).sendCommand("Browser.close"),0),{}}async createUserContext(u){const l={proxyServer:u["goog:proxyServer"]??void 0},d=u["goog:proxyBypassList"]??void 0;return d&&(l.proxyBypassList=d.join(",")),{userContext:(await c(this,t).sendCommand("Target.createBrowserContext",l)).browserContextId}}async removeUserContext(u){const l=u.userContext;if(l==="default")throw new n.InvalidArgumentException("`default` user context cannot be removed");try{await c(this,t).sendCommand("Target.disposeBrowserContext",{browserContextId:l})}catch(d){throw d.message.startsWith("Failed to find context with id")?new n.NoSuchUserContextException(d.message):d}return{}}async getUserContexts(){const u=await c(this,t).sendCommand("Target.getBrowserContexts");return{userContexts:[{userContext:"default"},...u.browserContextIds.map(l=>({userContext:l}))]}}async getClientWindows(){const u=c(this,r).getTopLevelContexts().map(f=>f.cdpTarget.id),l=await Promise.all(u.map(async f=>await A(this,s,o6).call(this,f))),d=new Set,h=new Array;for(const f of l)d.has(f.clientWindow)||(d.add(f.clientWindow),h.push(f));return{clientWindows:h}}},t=new WeakMap,r=new WeakMap,s=new WeakSet,o6=async function(u){const l=await c(this,t).sendCommand("Browser.getWindowForTarget",{targetId:u});return{active:!1,clientWindow:`${l.windowId}`,state:l.bounds.windowState??"normal",height:l.bounds.height??0,width:l.bounds.width??0,x:l.bounds.left??0,y:l.bounds.top??0}},a);return ly.BrowserProcessor=e,ly}var dy={},V4;function kce(){var t,r,s,i,a;if(V4)return dy;V4=1,Object.defineProperty(dy,"__esModule",{value:!0}),dy.CdpProcessor=void 0;const n=Ht();let e=(a=class{constructor(u,l,d,h){_(this,t);_(this,r);_(this,s);_(this,i);x(this,t,u),x(this,r,l),x(this,s,d),x(this,i,h)}getSession(u){const l=u.context,d=c(this,t).getContext(l).cdpTarget.cdpSessionId;return d===void 0?{}:{session:d}}resolveRealm(u){const l=u.realm,d=c(this,r).getRealm({realmId:l});if(d===void 0)throw new n.UnknownErrorException(`Could not find realm ${u.realm}`);return{executionContextId:d.executionContextId}}async sendCommand(u){return{result:await(u.session?c(this,s).getCdpClient(u.session):c(this,i)).sendCommand(u.method,u.params),session:u.session}}},t=new WeakMap,r=new WeakMap,s=new WeakMap,i=new WeakMap,a);return dy.CdpProcessor=e,dy}var hy={},G4;function Cce(){var t,r,s,i,c6,o;if(G4)return hy;G4=1,Object.defineProperty(hy,"__esModule",{value:!0}),hy.BrowsingContextProcessor=void 0;const n=Ht();let e=(o=class{constructor(l,d,h){_(this,i);_(this,t);_(this,r);_(this,s);x(this,t,l),x(this,r,d),x(this,s,h),c(this,s).addSubscribeHook(n.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,A(this,i,c6).bind(this))}getTree(l){return{contexts:(l.root===void 0?c(this,r).getTopLevelContexts():[c(this,r).getContext(l.root)]).map(h=>h.serializeToBidiValue(l.maxDepth??Number.MAX_VALUE))}}async create(l){let d,h="default";if(l.referenceContext!==void 0){if(d=c(this,r).getContext(l.referenceContext),!d.isTopLevelContext())throw new n.InvalidArgumentException("referenceContext should be a top-level context");h=d.userContext}l.userContext!==void 0&&(h=l.userContext);const f=c(this,r).getAllContexts().filter(y=>y.userContext===h);let p=!1;switch(l.type){case"tab":p=!1;break;case"window":p=!0;break}f.length||(p=!0);let m;try{m=await c(this,t).sendCommand("Target.createTarget",{url:"about:blank",newWindow:p,browserContextId:h==="default"?void 0:h,background:l.background===!0})}catch(y){throw y.message.startsWith("Failed to find browser context with id")||y.message==="browserContextId"?new n.NoSuchUserContextException(`The context ${h} was not found`):y}const g=await c(this,r).waitForContext(m.targetId);return await g.lifecycleLoaded(),{context:g.id}}navigate(l){return c(this,r).getContext(l.context).navigate(l.url,l.wait??"none")}reload(l){return c(this,r).getContext(l.context).reload(l.ignoreCache??!1,l.wait??"none")}async activate(l){const d=c(this,r).getContext(l.context);if(!d.isTopLevelContext())throw new n.InvalidArgumentException("Activation is only supported on the top-level context");return await d.activate(),{}}async captureScreenshot(l){return await c(this,r).getContext(l.context).captureScreenshot(l)}async print(l){return await c(this,r).getContext(l.context).print(l)}async setViewport(l){const d=c(this,r).getContext(l.context);if(!d.isTopLevelContext())throw new n.InvalidArgumentException("Emulating viewport is only supported on the top-level context");return await d.setViewport(l.viewport,l.devicePixelRatio),{}}async traverseHistory(l){const d=c(this,r).getContext(l.context);if(!d)throw new n.InvalidArgumentException(`No browsing context with id ${l.context}`);if(!d.isTopLevelContext())throw new n.InvalidArgumentException("Traversing history is only supported on the top-level context");return await d.traverseHistory(l.delta),{}}async handleUserPrompt(l){var h;const d=c(this,r).getContext(l.context);try{await d.handleUserPrompt(l.accept,l.userText)}catch(f){throw(h=f.message)!=null&&h.includes("No dialog is showing")?new n.NoSuchAlertException("No dialog is showing"):f}return{}}async close(l){const d=c(this,r).getContext(l.context);if(!d.isTopLevelContext())throw new n.InvalidArgumentException(`Non top-level browsing context ${d.id} cannot be closed.`);const h=d.cdpTarget.parentCdpClient;try{const f=new Promise(p=>{const m=g=>{g.targetId===l.context&&(h.off("Target.detachedFromTarget",m),p())};h.on("Target.detachedFromTarget",m)});try{l.promptUnload?await d.close():await h.sendCommand("Target.closeTarget",{targetId:l.context})}catch(p){if(!h.isCloseError(p))throw p}await f}catch(f){if(!(f.code===-32e3&&f.message==="Not attached to an active page"))throw f}return{}}async locateNodes(l){return await c(this,r).getContext(l.context).locateNodes(l)}},t=new WeakMap,r=new WeakMap,s=new WeakMap,i=new WeakSet,c6=function(l){return[c(this,r).getContext(l),...c(this,r).getContext(l).allChildren].forEach(f=>{c(this,s).registerEvent({type:"event",method:n.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,params:f.serializeToBidiValue()},f.id)}),Promise.resolve()},o);return hy.BrowsingContextProcessor=e,hy}var fy={},Cx={},Z4;function Hu(){if(Z4)return Cx;Z4=1,Object.defineProperty(Cx,"__esModule",{value:!0}),Cx.assert=n;function n(e,t){if(!e)throw new Error(t??"Internal assertion failed.")}return Cx}var py={},my={},J4;function Pce(){if(J4)return my;J4=1,Object.defineProperty(my,"__esModule",{value:!0}),my.isSingleComplexGrapheme=n,my.isSingleGrapheme=e;function n(t){return e(t)&&t.length>1}function e(t){return[...new Intl.Segmenter("en",{granularity:"grapheme"}).segment(t)].length===1}return my}var Ci={},X4;function Y4(){var s,i,N_,o,u,l,d,h,f,p;if(X4)return Ci;X4=1,Object.defineProperty(Ci,"__esModule",{value:!0}),Ci.WheelSource=Ci.PointerSource=Ci.KeySource=Ci.NoneSource=void 0;class n{constructor(){J(this,"type","none")}}Ci.NoneSource=n;class e{constructor(){_(this,i);J(this,"type","key");J(this,"pressed",new Set);_(this,s,0)}get modifiers(){return c(this,s)}get alt(){return(c(this,s)&1)===1}set alt(g){A(this,i,N_).call(this,g,1)}get ctrl(){return(c(this,s)&2)===2}set ctrl(g){A(this,i,N_).call(this,g,2)}get meta(){return(c(this,s)&4)===4}set meta(g){A(this,i,N_).call(this,g,4)}get shift(){return(c(this,s)&8)===8}set shift(g){A(this,i,N_).call(this,g,8)}}s=new WeakMap,i=new WeakSet,N_=function(g,y){g?x(this,s,c(this,s)|y):x(this,s,c(this,s)&~y)},Ci.KeySource=e;class t{constructor(g,y){J(this,"type","pointer");J(this,"subtype");J(this,"pointerId");J(this,"pressed",new Set);J(this,"x",0);J(this,"y",0);J(this,"radiusX");J(this,"radiusY");J(this,"force");_(this,p,new Map);this.pointerId=g,this.subtype=y}get buttons(){let g=0;for(const y of this.pressed)switch(y){case 0:g|=1;break;case 1:g|=4;break;case 2:g|=2;break;case 3:g|=8;break;case 4:g|=16;break}return g}setClickCount(g,y){let w=c(this,p).get(g);return(!w||w.compare(y))&&(w=y),++w.count,c(this,p).set(g,w),w.count}getClickCount(g){var y;return((y=c(this,p).get(g))==null?void 0:y.count)??0}}p=new WeakMap,J(t,"ClickContext",(o=class{constructor(y,w,v){J(this,"count",0);_(this,d);_(this,h);_(this,f);x(this,d,y),x(this,h,w),x(this,f,v)}compare(y){return c(y,f)-c(this,f)>c(o,u)||Math.abs(c(y,d)-c(this,d))>c(o,l)||Math.abs(c(y,h)-c(this,h))>c(o,l)}},u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,_(o,u,500),_(o,l,2),o)),Ci.PointerSource=t;class r{constructor(){J(this,"type","wheel")}}return Ci.WheelSource=r,Ci}var Wh={},Q4;function Ace(){if(Q4)return Wh;Q4=1,Object.defineProperty(Wh,"__esModule",{value:!0}),Wh.getNormalizedKey=n,Wh.getKeyCode=e,Wh.getKeyLocation=t;function n(r){switch(r){case"":return"Unidentified";case"":return"Cancel";case"":return"Help";case"":return"Backspace";case"":return"Tab";case"":return"Clear";case"":case"":return"Enter";case"":return"Shift";case"":return"Control";case"":return"Alt";case"":return"Pause";case"":return"Escape";case"":return" ";case"":return"PageUp";case"":return"PageDown";case"":return"End";case"":return"Home";case"":return"ArrowLeft";case"":return"ArrowUp";case"":return"ArrowRight";case"":return"ArrowDown";case"":return"Insert";case"":return"Delete";case"":return";";case"":return"=";case"":return"0";case"":return"1";case"":return"2";case"":return"3";case"":return"4";case"":return"5";case"":return"6";case"":return"7";case"":return"8";case"":return"9";case"":return"*";case"":return"+";case"":return",";case"":return"-";case"":return".";case"":return"/";case"":return"F1";case"":return"F2";case"":return"F3";case"":return"F4";case"":return"F5";case"":return"F6";case"":return"F7";case"":return"F8";case"":return"F9";case"":return"F10";case"":return"F11";case"":return"F12";case"":return"Meta";case"":return"ZenkakuHankaku";case"":return"Shift";case"":return"Control";case"":return"Alt";case"":return"Meta";case"":return"PageUp";case"":return"PageDown";case"":return"End";case"":return"Home";case"":return"ArrowLeft";case"":return"ArrowUp";case"":return"ArrowRight";case"":return"ArrowDown";case"":return"Insert";case"":return"Delete";default:return r}}function e(r){switch(r){case"`":case"~":return"Backquote";case"\\":case"|":return"Backslash";case"":return"Backspace";case"[":case"{":return"BracketLeft";case"]":case"}":return"BracketRight";case",":case"<":return"Comma";case"0":case")":return"Digit0";case"1":case"!":return"Digit1";case"2":case"@":return"Digit2";case"3":case"#":return"Digit3";case"4":case"$":return"Digit4";case"5":case"%":return"Digit5";case"6":case"^":return"Digit6";case"7":case"&":return"Digit7";case"8":case"*":return"Digit8";case"9":case"(":return"Digit9";case"=":case"+":return"Equal";case">":return"IntlBackslash";case"a":case"A":return"KeyA";case"b":case"B":return"KeyB";case"c":case"C":return"KeyC";case"d":case"D":return"KeyD";case"e":case"E":return"KeyE";case"f":case"F":return"KeyF";case"g":case"G":return"KeyG";case"h":case"H":return"KeyH";case"i":case"I":return"KeyI";case"j":case"J":return"KeyJ";case"k":case"K":return"KeyK";case"l":case"L":return"KeyL";case"m":case"M":return"KeyM";case"n":case"N":return"KeyN";case"o":case"O":return"KeyO";case"p":case"P":return"KeyP";case"q":case"Q":return"KeyQ";case"r":case"R":return"KeyR";case"s":case"S":return"KeyS";case"t":case"T":return"KeyT";case"u":case"U":return"KeyU";case"v":case"V":return"KeyV";case"w":case"W":return"KeyW";case"x":case"X":return"KeyX";case"y":case"Y":return"KeyY";case"z":case"Z":return"KeyZ";case"-":case"_":return"Minus";case".":return"Period";case"'":case'"':return"Quote";case";":case":":return"Semicolon";case"/":case"?":return"Slash";case"":return"AltLeft";case"":return"AltRight";case"":return"ControlLeft";case"":return"ControlRight";case"":return"Enter";case"":return"Pause";case"":return"MetaLeft";case"":return"MetaRight";case"":return"ShiftLeft";case"":return"ShiftRight";case" ":case"":return"Space";case"":return"Tab";case"":return"Delete";case"":return"End";case"":return"Help";case"":return"Home";case"":return"Insert";case"":return"PageDown";case"":return"PageUp";case"":return"ArrowDown";case"":return"ArrowLeft";case"":return"ArrowRight";case"":return"ArrowUp";case"":return"Escape";case"":return"F1";case"":return"F2";case"":return"F3";case"":return"F4";case"":return"F5";case"":return"F6";case"":return"F7";case"":return"F8";case"":return"F9";case"":return"F10";case"":return"F11";case"":return"F12";case"":return"NumpadEqual";case"":case"":return"Numpad0";case"":case"":return"Numpad1";case"":case"":return"Numpad2";case"":case"":return"Numpad3";case"":case"":return"Numpad4";case"":return"Numpad5";case"":case"":return"Numpad6";case"":case"":return"Numpad7";case"":case"":return"Numpad8";case"":case"":return"Numpad9";case"":return"NumpadAdd";case"":return"NumpadComma";case"":case"":return"NumpadDecimal";case"":return"NumpadDivide";case"":return"NumpadEnter";case"":return"NumpadMultiply";case"":return"NumpadSubtract";default:return}}function t(r){switch(r){case"":case"":case"":case"":case"":return 1;case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":return 3;case"":case"":case"":case"":return 2;default:return 0}}return Wh}var gy={},e5;function Tce(){return e5||(e5=1,Object.defineProperty(gy,"__esModule",{value:!0}),gy.KeyToKeyCode=void 0,gy.KeyToKeyCode={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,Abort:3,Help:6,Backspace:8,Tab:9,Numpad5:12,NumpadEnter:13,Enter:13,"\\r":13,"\\n":13,ShiftLeft:16,ShiftRight:16,ControlLeft:17,ControlRight:17,AltLeft:18,AltRight:18,Pause:19,CapsLock:20,Escape:27,Convert:28,NonConvert:29,Space:32,Numpad9:33,PageUp:33,Numpad3:34,PageDown:34,End:35,Numpad1:35,Home:36,Numpad7:36,ArrowLeft:37,Numpad4:37,Numpad8:38,ArrowUp:38,ArrowRight:39,Numpad6:39,Numpad2:40,ArrowDown:40,Select:41,Open:43,PrintScreen:44,Insert:45,Numpad0:45,Delete:46,NumpadDecimal:46,Digit0:48,Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,MetaLeft:91,MetaRight:92,ContextMenu:93,NumpadMultiply:106,NumpadAdd:107,NumpadSubtract:109,NumpadDivide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,NumLock:144,ScrollLock:145,AudioVolumeMute:173,AudioVolumeDown:174,AudioVolumeUp:175,MediaTrackNext:176,MediaTrackPrevious:177,MediaStop:178,MediaPlayPause:179,Semicolon:186,Equal:187,NumpadEqual:187,Comma:188,Minus:189,Period:190,Slash:191,Backquote:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222,AltGraph:225,Props:247,Cancel:3,Clear:12,Shift:16,Control:17,Alt:18,Accept:30,ModeChange:31," ":32,Print:42,Execute:43,"\\u0000":46,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,Meta:91,"*":106,"+":107,"-":109,"/":111,";":186,"=":187,",":188,".":190,"`":192,"[":219,"\\\\":220,"]":221,"'":222,Attn:246,CrSel:247,ExSel:248,EraseEof:249,Play:250,ZoomOut:251,")":48,"!":49,"@":50,"#":51,$:52,"%":53,"^":54,"&":55,"(":57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,":":186,"<":188,_:189,">":190,"?":191,"~":192,"{":219,"|":220,"}":221,'"':222,Camera:44,EndCall:95,VolumeDown:182,VolumeUp:183}),gy}var t5;function Ice(){var g,y,w,v,b,S,P,k,Wr,u6,l6,d6,h6,f6,fR,p6,m6,g6;if(t5)return py;t5=1,Object.defineProperty(py,"__esModule",{value:!0}),py.ActionDispatcher=void 0;const n=Ht(),e=Hu(),t=Pce(),r=Y4(),s=Ace(),i=Tce(),a=(j=>{const F=j.getClientRects()[0],B=Math.max(0,Math.min(F.x,F.x+F.width)),D=Math.min(window.innerWidth,Math.max(F.x,F.x+F.width)),W=Math.max(0,Math.min(F.y,F.y+F.height)),G=Math.min(window.innerHeight,Math.max(F.y,F.y+F.height));return[B+(D-B>>1),W+(G-W>>1)]}).toString(),o=(()=>navigator.platform.toLowerCase().includes("mac")).toString();async function u(j,F){var te,K,q,se;const D=await(await j.getOrCreateSandbox(void 0)).callFunction(a,!1,{type:"undefined"},[F]);if(D.type==="exception")throw new n.NoSuchElementException(`Origin element ${F.sharedId} was not found`);(0,e.assert)(D.result.type==="array"),(0,e.assert)(((K=(te=D.result.value)==null?void 0:te[0])==null?void 0:K.type)==="number"),(0,e.assert)(((se=(q=D.result.value)==null?void 0:q[1])==null?void 0:se.type)==="number");const{result:{value:[{value:W},{value:G}]}}=D;return{x:W,y:G}}let l=(g=class{constructor(F,B,D,W){_(this,k);_(this,y);_(this,w,0);_(this,v,0);_(this,b);_(this,S);_(this,P);x(this,y,B),x(this,b,F),x(this,S,D),x(this,P,W)}async dispatchActions(F){await c(this,b).queue.run(async()=>{for(const B of F)await this.dispatchTickActions(B)})}async dispatchTickActions(F){x(this,w,performance.now()),x(this,v,0);for(const{action:D}of F)"duration"in D&&D.duration!==void 0&&x(this,v,Math.max(c(this,v),D.duration));const B=[new Promise(D=>setTimeout(D,c(this,v)))];for(const D of F)B.push(A(this,k,u6).call(this,D));await Promise.all(B)}},y=new WeakMap,w=new WeakMap,v=new WeakMap,b=new WeakMap,S=new WeakMap,P=new WeakMap,k=new WeakSet,Wr=function(){return c(this,y).getContext(c(this,S))},u6=async function({id:F,action:B}){const D=c(this,b).get(F),W=c(this,b).getGlobalKeyState();switch(B.type){case"keyDown":{await A(this,k,m6).call(this,D,B),c(this,b).cancelList.push({id:F,action:{...B,type:"keyUp"}});break}case"keyUp":{await A(this,k,g6).call(this,D,B);break}case"pause":break;case"pointerDown":{await A(this,k,l6).call(this,D,W,B),c(this,b).cancelList.push({id:F,action:{...B,type:"pointerUp"}});break}case"pointerMove":{await A(this,k,h6).call(this,D,W,B);break}case"pointerUp":{await A(this,k,d6).call(this,D,W,B);break}case"scroll":{await A(this,k,p6).call(this,D,W,B);break}}},l6=async function(F,B,D){const{button:W}=D;if(F.pressed.has(W))return;F.pressed.add(W);const{x:G,y:te,subtype:K}=F,{width:q,height:se,pressure:ke,twist:he,tangentialPressure:et}=D,{tiltX:fe,tiltY:R}=p(D),{modifiers:$}=B,{radiusX:H,radiusY:V}=m(q??1,se??1);switch(K){case"mouse":case"pen":await c(this,k,Wr).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mousePressed",x:G,y:te,modifiers:$,button:f(W),buttons:F.buttons,clickCount:F.setClickCount(W,new r.PointerSource.ClickContext(G,te,performance.now())),pointerType:K,tangentialPressure:et,tiltX:fe,tiltY:R,twist:he,force:ke});break;case"touch":await c(this,k,Wr).cdpTarget.cdpClient.sendCommand("Input.dispatchTouchEvent",{type:"touchStart",touchPoints:[{x:G,y:te,radiusX:H,radiusY:V,tangentialPressure:et,tiltX:fe,tiltY:R,twist:he,force:ke,id:F.pointerId}],modifiers:$});break}F.radiusX=H,F.radiusY=V,F.force=ke},d6=function(F,B,D){const{button:W}=D;if(!F.pressed.has(W))return;F.pressed.delete(W);const{x:G,y:te,force:K,radiusX:q,radiusY:se,subtype:ke}=F,{modifiers:he}=B;switch(ke){case"mouse":case"pen":return c(this,k,Wr).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseReleased",x:G,y:te,modifiers:he,button:f(W),buttons:F.buttons,clickCount:F.getClickCount(W),pointerType:ke});case"touch":return c(this,k,Wr).cdpTarget.cdpClient.sendCommand("Input.dispatchTouchEvent",{type:"touchEnd",touchPoints:[{x:G,y:te,id:F.pointerId,force:K,radiusX:q,radiusY:se}],modifiers:he})}},h6=async function(F,B,D){const{x:W,y:G,subtype:te}=F,{width:K,height:q,pressure:se,twist:ke,tangentialPressure:he,x:et,y:fe,origin:R="viewport",duration:$=c(this,v)}=D,{tiltX:H,tiltY:V}=p(D),{radiusX:X,radiusY:ne}=m(K??1,q??1),{targetX:ce,targetY:Le}=await A(this,k,fR).call(this,R,et,fe,W,G);if(ce<0||Le<0)throw new n.MoveTargetOutOfBoundsException(`Cannot move beyond viewport (x: ${ce}, y: ${Le})`);let de;do{const De=$>0?(performance.now()-c(this,w))/$:1;de=De>=1;let Pe,z;if(de?(Pe=ce,z=Le):(Pe=Math.round(De*(ce-W)+W),z=Math.round(De*(Le-G)+G)),F.x!==Pe||F.y!==z){const{modifiers:re}=B;switch(te){case"mouse":await c(this,k,Wr).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseMoved",x:Pe,y:z,modifiers:re,clickCount:0,button:f(F.pressed.values().next().value??5),buttons:F.buttons,pointerType:te,tangentialPressure:he,tiltX:H,tiltY:V,twist:ke,force:se});break;case"pen":F.pressed.size!==0&&await c(this,k,Wr).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseMoved",x:Pe,y:z,modifiers:re,clickCount:0,button:f(F.pressed.values().next().value??5),buttons:F.buttons,pointerType:te,tangentialPressure:he,tiltX:H,tiltY:V,twist:ke,force:se??.5});break;case"touch":F.pressed.size!==0&&await c(this,k,Wr).cdpTarget.cdpClient.sendCommand("Input.dispatchTouchEvent",{type:"touchMove",touchPoints:[{x:Pe,y:z,radiusX:X,radiusY:ne,tangentialPressure:he,tiltX:H,tiltY:V,twist:ke,force:se,id:F.pointerId}],modifiers:re});break}F.x=Pe,F.y=z,F.radiusX=X,F.radiusY=ne,F.force=se}}while(!de)},f6=async function(){if(c(this,k,Wr).id===c(this,k,Wr).cdpTarget.id)return{x:0,y:0};const{backendNodeId:F}=await c(this,k,Wr).cdpTarget.cdpClient.sendCommand("DOM.getFrameOwner",{frameId:c(this,k,Wr).id}),{model:B}=await c(this,k,Wr).cdpTarget.cdpClient.sendCommand("DOM.getBoxModel",{backendNodeId:F});return{x:B.content[0],y:B.content[1]}},fR=async function(F,B,D,W,G){let te,K;const q=await A(this,k,f6).call(this);switch(F){case"viewport":te=B+q.x,K=D+q.y;break;case"pointer":te=W+B+q.x,K=G+D+q.y;break;default:{const{x:se,y:ke}=await u(c(this,k,Wr),F.element);te=se+B+q.x,K=ke+D+q.y;break}}return{targetX:te,targetY:K}},p6=async function(F,B,D){const{deltaX:W,deltaY:G,x:te,y:K,origin:q="viewport",duration:se=c(this,v)}=D;if(q==="pointer")throw new n.InvalidArgumentException('"pointer" origin is invalid for scrolling.');const{targetX:ke,targetY:he}=await A(this,k,fR).call(this,q,te,K,0,0);if(ke<0||he<0)throw new n.MoveTargetOutOfBoundsException(`Cannot move beyond viewport (x: ${ke}, y: ${he})`);let et=0,fe=0,R;do{const $=se>0?(performance.now()-c(this,w))/se:1;R=$>=1;let H,V;if(R?(H=W-et,V=G-fe):(H=Math.round($*W-et),V=Math.round($*G-fe)),H!==0||V!==0){const{modifiers:X}=B;await c(this,k,Wr).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseWheel",deltaX:H,deltaY:V,x:ke,y:he,modifiers:X}),et+=H,fe+=V}}while(!R)},m6=async function(F,B){const D=B.value;if(!(0,t.isSingleGrapheme)(D))throw new n.InvalidArgumentException(`Invalid key value: ${D}`);const W=(0,t.isSingleComplexGrapheme)(D),G=(0,s.getNormalizedKey)(D),te=F.pressed.has(G),K=(0,s.getKeyCode)(D),q=(0,s.getKeyLocation)(D);switch(G){case"Alt":F.alt=!0;break;case"Shift":F.shift=!0;break;case"Control":F.ctrl=!0;break;case"Meta":F.meta=!0;break}F.pressed.add(G);const{modifiers:se}=F,ke=d(G,F,W),he=h(K??"",F)??ke;let et;if(c(this,P)&&F.meta)switch(K){case"KeyA":et="SelectAll";break;case"KeyC":et="Copy";break;case"KeyV":et=F.shift?"PasteAndMatchStyle":"Paste";break;case"KeyX":et="Cut";break;case"KeyZ":et=F.shift?"Redo":"Undo";break}const fe=[c(this,k,Wr).cdpTarget.cdpClient.sendCommand("Input.dispatchKeyEvent",{type:he?"keyDown":"rawKeyDown",windowsVirtualKeyCode:i.KeyToKeyCode[G],key:G,code:K,text:he,unmodifiedText:ke,autoRepeat:te,isSystemKey:F.alt||void 0,location:q<3?q:void 0,isKeypad:q===3,modifiers:se,commands:et?[et]:void 0})];G==="Escape"&&!F.alt&&(c(this,P)&&!F.ctrl&&!F.meta||!c(this,P))&&fe.push(c(this,k,Wr).cdpTarget.cdpClient.sendCommand("Input.cancelDragging")),await Promise.all(fe)},g6=function(F,B){const D=B.value;if(!(0,t.isSingleGrapheme)(D))throw new n.InvalidArgumentException(`Invalid key value: ${D}`);const W=(0,t.isSingleComplexGrapheme)(D),G=(0,s.getNormalizedKey)(D);if(!F.pressed.has(G))return;const te=(0,s.getKeyCode)(D),K=(0,s.getKeyLocation)(D);switch(G){case"Alt":F.alt=!1;break;case"Shift":F.shift=!1;break;case"Control":F.ctrl=!1;break;case"Meta":F.meta=!1;break}F.pressed.delete(G);const{modifiers:q}=F,se=d(G,F,W),ke=h(te??"",F)??se;return c(this,k,Wr).cdpTarget.cdpClient.sendCommand("Input.dispatchKeyEvent",{type:"keyUp",windowsVirtualKeyCode:i.KeyToKeyCode[G],key:G,code:te,text:ke,unmodifiedText:se,location:K<3?K:void 0,isSystemKey:F.alt||void 0,isKeypad:K===3,modifiers:q})},J(g,"isMacOS",async F=>{const B=await(await F.getOrCreateSandbox(void 0)).callFunction(o,!1);return(0,e.assert)(B.type!=="exception"),(0,e.assert)(B.result.type==="boolean"),B.result.value}),g);py.ActionDispatcher=l;const d=(j,F,B)=>B?j:j==="Enter"?"\r":[...j].length===1?F.shift?j.toLocaleUpperCase("en-US"):j:void 0,h=(j,F)=>{if(F.ctrl){switch(j){case"Digit2":if(F.shift)return"\0";break;case"KeyA":return"";case"KeyB":return"";case"KeyC":return"";case"KeyD":return"";case"KeyE":return"";case"KeyF":return"";case"KeyG":return"\x07";case"KeyH":return"\b";case"KeyI":return"	";case"KeyJ":return`
`;case"KeyK":return"\v";case"KeyL":return"\f";case"KeyM":return"\r";case"KeyN":return"";case"KeyO":return"";case"KeyP":return"";case"KeyQ":return"";case"KeyR":return"";case"KeyS":return"";case"KeyT":return"";case"KeyU":return"";case"KeyV":return"";case"KeyW":return"";case"KeyX":return"";case"KeyY":return"";case"KeyZ":return"";case"BracketLeft":return"\x1B";case"Backslash":return"";case"BracketRight":return"";case"Digit6":if(F.shift)return"";break;case"Minus":return""}return""}if(F.alt)return""};function f(j){switch(j){case 0:return"left";case 1:return"middle";case 2:return"right";case 3:return"back";case 4:return"forward";default:return"none"}}function p(j){const F=j.altitudeAngle??Math.PI/2,B=j.azimuthAngle??0;let D=0,W=0;if(F===0&&((B===0||B===2*Math.PI)&&(D=Math.PI/2),B===Math.PI/2&&(W=Math.PI/2),B===Math.PI&&(D=-Math.PI/2),B===3*Math.PI/2&&(W=-Math.PI/2),B>0&&B<Math.PI/2&&(D=Math.PI/2,W=Math.PI/2),B>Math.PI/2&&B<Math.PI&&(D=-Math.PI/2,W=Math.PI/2),B>Math.PI&&B<3*Math.PI/2&&(D=-Math.PI/2,W=-Math.PI/2),B>3*Math.PI/2&&B<2*Math.PI&&(D=Math.PI/2,W=-Math.PI/2)),F!==0){const te=Math.tan(F);D=Math.atan(Math.cos(B)/te),W=Math.atan(Math.sin(B)/te)}const G=180/Math.PI;return{tiltX:Math.round(D*G),tiltY:Math.round(W*G)}}function m(j,F){return{radiusX:j?j/2:.5,radiusY:F?F/2:.5}}return py}var yy={},wy={},vy={},r5;function Oce(){var e,t,r,pR,i;if(r5)return vy;r5=1,Object.defineProperty(vy,"__esModule",{value:!0}),vy.Mutex=void 0;let n=(i=class{constructor(){_(this,r);_(this,e,!1);_(this,t,[])}acquire(){const o={resolved:!1};return c(this,e)?new Promise(u=>{c(this,t).push(()=>u(A(this,r,pR).bind(this,o)))}):(x(this,e,!0),Promise.resolve(A(this,r,pR).bind(this,o)))}async run(o){const u=await this.acquire();try{return await o()}finally{u()}}},e=new WeakMap,t=new WeakMap,r=new WeakSet,pR=function(o){if(o.resolved)throw new Error("Cannot release more than once.");o.resolved=!0;const u=c(this,t).shift();if(!u){x(this,e,!1);return}u()},i);return vy.Mutex=n,vy}var n5;function Rce(){var s,i,a;if(n5)return wy;n5=1,Object.defineProperty(wy,"__esModule",{value:!0}),wy.InputState=void 0;const n=Ht(),e=Oce(),t=Y4();let r=(a=class{constructor(){J(this,"cancelList",[]);_(this,s,new Map);_(this,i,new e.Mutex)}getOrCreate(u,l,d){let h=c(this,s).get(u);if(!h){switch(l){case"none":h=new t.NoneSource;break;case"key":h=new t.KeySource;break;case"pointer":{let f=d==="mouse"?0:2;const p=new Set;for(const[,m]of c(this,s))m.type==="pointer"&&p.add(m.pointerId);for(;p.has(f);)++f;h=new t.PointerSource(f,d);break}case"wheel":h=new t.WheelSource;break;default:throw new n.InvalidArgumentException(`Expected "none", "key", "pointer", or "wheel". Found unknown source type ${l}.`)}return c(this,s).set(u,h),h}if(h.type!==l)throw new n.InvalidArgumentException(`Input source type of ${u} is ${h.type}, but received ${l}.`);return h}get(u){const l=c(this,s).get(u);if(!l)throw new n.UnknownErrorException("Internal error.");return l}getGlobalKeyState(){const u=new t.KeySource;for(const[,l]of c(this,s))if(l.type==="key"){for(const d of l.pressed)u.pressed.add(d);u.alt||(u.alt=l.alt),u.ctrl||(u.ctrl=l.ctrl),u.meta||(u.meta=l.meta),u.shift||(u.shift=l.shift)}return u}get queue(){return c(this,i)}},s=new WeakMap,i=new WeakMap,a);return wy.InputState=r,wy}var s5;function Mce(){if(s5)return yy;s5=1,Object.defineProperty(yy,"__esModule",{value:!0}),yy.InputStateManager=void 0;const n=Hu(),e=Rce();let t=class extends WeakMap{get(s){return(0,n.assert)(s.isTopLevelContext()),this.has(s)||this.set(s,new e.InputState),super.get(s)}};return yy.InputStateManager=t,yy}var i5;function $ce(){var i,a,o,y6,l;if(i5)return fy;i5=1,Object.defineProperty(fy,"__esModule",{value:!0}),fy.InputProcessor=void 0;const n=Ht(),e=Hu(),t=Ice(),r=Mce();let s=(l=class{constructor(h){_(this,o);_(this,i);_(this,a,new r.InputStateManager);x(this,i,h)}async performActions(h){const f=c(this,i).getContext(h.context),p=c(this,a).get(f.top),m=A(this,o,y6).call(this,h,p);return await new t.ActionDispatcher(p,c(this,i),h.context,await t.ActionDispatcher.isMacOS(f).catch(()=>!1)).dispatchActions(m),{}}async releaseActions(h){const f=c(this,i).getContext(h.context),p=f.top,m=c(this,a).get(p);return await new t.ActionDispatcher(m,c(this,i),h.context,await t.ActionDispatcher.isMacOS(f).catch(()=>!1)).dispatchTickActions(m.cancelList.reverse()),c(this,a).delete(p),{}}async setFiles(h){const p=await c(this,i).getContext(h.context).getOrCreateSandbox(void 0);let m;try{m=await p.callFunction(String(function(v){if(!(this instanceof HTMLInputElement))return this instanceof Element?1:0;if(this.type!=="file")return 2;if(this.disabled)return 3;if(v>1&&!this.multiple)return 4}),!1,h.element,[{type:"number",value:h.files.length}])}catch{throw new n.NoSuchNodeException(`Could not find element ${h.element.sharedId}`)}if((0,e.assert)(m.type==="success"),m.result.type==="number")switch(m.result.value){case 0:throw new n.NoSuchElementException(`Could not find element ${h.element.sharedId}`);case 1:throw new n.UnableToSetFileInputException(`Element ${h.element.sharedId} is not a input`);case 2:throw new n.UnableToSetFileInputException(`Input element ${h.element.sharedId} is not a file type`);case 3:throw new n.UnableToSetFileInputException(`Input element ${h.element.sharedId} is disabled`);case 4:throw new n.UnableToSetFileInputException("Cannot set multiple files on a non-multiple input element")}if(h.files.length===0)return await p.callFunction(String(function(){var v;if(((v=this.files)==null?void 0:v.length)===0){this.dispatchEvent(new Event("cancel",{bubbles:!0}));return}this.files=new DataTransfer().files,this.dispatchEvent(new Event("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0}))}),!1,h.element),{};const g=[];for(let w=0;w<h.files.length;++w){const v=await p.callFunction(String(function(k){var C;return(C=this.files)==null?void 0:C.item(k)}),!1,h.element,[{type:"number",value:0}],"root");if((0,e.assert)(v.type==="success"),v.result.type!=="object")break;const{handle:b}=v.result;(0,e.assert)(b!==void 0);const{path:S}=await p.cdpClient.sendCommand("DOM.getFileInfo",{objectId:b});g.push(S),p.disown(b).catch(void 0)}g.sort();const y=[...h.files].sort();if(g.length!==h.files.length||y.some((w,v)=>g[v]!==w)){const{objectId:w}=await p.deserializeForCdp(h.element);(0,e.assert)(w!==void 0),await p.cdpClient.sendCommand("DOM.setFileInputFiles",{files:h.files,objectId:w})}else await p.callFunction(String(function(){this.dispatchEvent(new Event("cancel",{bubbles:!0}))}),!1,h.element);return{}}},i=new WeakMap,a=new WeakMap,o=new WeakSet,y6=function(h,f){var m;const p=[];for(const g of h.actions){switch(g.type){case"pointer":{g.parameters??(g.parameters={pointerType:"mouse"}),(m=g.parameters).pointerType??(m.pointerType="mouse");const w=f.getOrCreate(g.id,"pointer",g.parameters.pointerType);if(w.subtype!==g.parameters.pointerType)throw new n.InvalidArgumentException(`Expected input source ${g.id} to be ${w.subtype}; got ${g.parameters.pointerType}.`);break}default:f.getOrCreate(g.id,g.type)}const y=g.actions.map(w=>({id:g.id,action:w}));for(let w=0;w<y.length;w++)p.length===w&&p.push([]),p[w].push(y[w])}return p},l);return fy.InputProcessor=s,fy}var _y={},Tr={},Px={},a5;function Nce(){if(a5)return Px;a5=1,Object.defineProperty(Px,"__esModule",{value:!0}),Px.base64ToString=n;function n(e){return"atob"in globalThis?globalThis.atob(e):Buffer.from(e,"base64").toString("ascii")}return Px}var o5;function Ax(){if(o5)return Tr;o5=1,Object.defineProperty(Tr,"__esModule",{value:!0}),Tr.computeHeadersSize=t,Tr.bidiNetworkHeadersFromCdpNetworkHeaders=r,Tr.bidiNetworkHeadersFromCdpNetworkHeadersEntries=s,Tr.cdpNetworkHeadersFromBidiNetworkHeaders=i,Tr.bidiNetworkHeadersFromCdpFetchHeaders=a,Tr.cdpFetchHeadersFromBidiNetworkHeaders=o,Tr.networkHeaderFromCookieHeaders=u,Tr.cdpAuthChallengeResponseFromBidiAuthContinueWithAuthAction=l,Tr.cdpToBiDiCookie=d,Tr.deserializeByteValue=h,Tr.bidiToCdpCookie=f,Tr.sameSiteBiDiToCdp=m,Tr.isSpecialScheme=g,Tr.matchUrlPattern=w,Tr.bidiBodySizeFromCdpPostDataEntries=v,Tr.getTiming=b;const n=U4(),e=Nce();function t(S){const P=S.reduce((k,C)=>`${k}${C.name}: ${C.value.value}\r
`,"");return new TextEncoder().encode(P).length}function r(S){return S?Object.entries(S).map(([P,k])=>({name:P,value:{type:"string",value:k}})):[]}function s(S){return S?S.map(({name:P,value:k})=>({name:P,value:{type:"string",value:k}})):[]}function i(S){if(S!==void 0)return S.reduce((P,k)=>(P[k.name]=k.value.value,P),{})}function a(S){return S?S.map(({name:P,value:k})=>({name:P,value:{type:"string",value:k}})):[]}function o(S){if(S!==void 0)return S.map(({name:P,value:k})=>({name:P,value:k.value}))}function u(S){return S===void 0?void 0:{name:"Cookie",value:{type:"string",value:S.reduce((k,C,E)=>{E>0&&(k+=";");const M=C.value.type==="base64"?btoa(C.value.value):C.value.value;return k+=`${C.name}=${M}`,k},"")}}}function l(S){switch(S){case"default":return"Default";case"cancel":return"CancelAuth";case"provideCredentials":return"ProvideCredentials"}}function d(S){const P={name:S.name,value:{type:"string",value:S.value},domain:S.domain,path:S.path,size:S.size,httpOnly:S.httpOnly,secure:S.secure,sameSite:S.sameSite===void 0?"none":p(S.sameSite),...S.expires>=0?{expiry:S.expires}:void 0};return P["goog:session"]=S.session,P["goog:priority"]=S.priority,P["goog:sameParty"]=S.sameParty,P["goog:sourceScheme"]=S.sourceScheme,P["goog:sourcePort"]=S.sourcePort,S.partitionKey!==void 0&&(P["goog:partitionKey"]=S.partitionKey),S.partitionKeyOpaque!==void 0&&(P["goog:partitionKeyOpaque"]=S.partitionKeyOpaque),P}function h(S){return S.type==="base64"?(0,e.base64ToString)(S.value):S.value}function f(S,P){const k=h(S.cookie.value),C={name:S.cookie.name,value:k,domain:S.cookie.domain,path:S.cookie.path??"/",secure:S.cookie.secure??!1,httpOnly:S.cookie.httpOnly??!1,...P.sourceOrigin!==void 0&&{partitionKey:{hasCrossSiteAncestor:!1,topLevelSite:P.sourceOrigin}},...S.cookie.expiry!==void 0&&{expires:S.cookie.expiry},...S.cookie.sameSite!==void 0&&{sameSite:m(S.cookie.sameSite)}};return S.cookie["goog:url"]!==void 0&&(C.url=S.cookie["goog:url"]),S.cookie["goog:priority"]!==void 0&&(C.priority=S.cookie["goog:priority"]),S.cookie["goog:sameParty"]!==void 0&&(C.sameParty=S.cookie["goog:sameParty"]),S.cookie["goog:sourceScheme"]!==void 0&&(C.sourceScheme=S.cookie["goog:sourceScheme"]),S.cookie["goog:sourcePort"]!==void 0&&(C.sourcePort=S.cookie["goog:sourcePort"]),C}function p(S){switch(S){case"Strict":return"strict";case"None":return"none";case"Lax":return"lax";default:return"lax"}}function m(S){switch(S){case"strict":return"Strict";case"lax":return"Lax";case"none":return"None"}throw new n.InvalidArgumentException(`Unknown 'sameSite' value ${S}`)}function g(S){return["ftp","file","http","https","ws","wss"].includes(S.replace(/:$/,""))}function y(S){return S.protocol.replace(/:$/,"")}function w(S,P){const k=new URL(P);return!(S.protocol!==void 0&&S.protocol!==y(k)||S.hostname!==void 0&&S.hostname!==k.hostname||S.port!==void 0&&S.port!==k.port||S.pathname!==void 0&&S.pathname!==k.pathname||S.search!==void 0&&S.search!==k.search)}function v(S){let P=0;for(const k of S)P+=atob(k.bytes??"").length;return P}function b(S,P=0){return!S||S<=0||S+P<=0?0:S+P}return Tr}var c5;function u5(){var s,i,a,mR,F_,l;if(c5)return _y;c5=1,Object.defineProperty(_y,"__esModule",{value:!0}),_y.NetworkProcessor=void 0;const n=Ht(),e=Ax();let t=(l=class{constructor(h,f){_(this,a);_(this,s);_(this,i);x(this,s,h),x(this,i,f)}async addIntercept(h){c(this,s).verifyTopLevelContextsList(h.contexts);const f=h.urlPatterns??[],p=l.parseUrlPatterns(f),m=c(this,i).addIntercept({urlPatterns:p,phases:h.phases,contexts:h.contexts});return await Promise.all(c(this,s).getAllContexts().map(g=>g.cdpTarget.toggleNetwork())),{intercept:m}}async continueRequest(h){if(h.url!==void 0&&l.parseUrlString(h.url),h.method!==void 0&&!l.isMethodValid(h.method))throw new n.InvalidArgumentException(`Method '${h.method}' is invalid.`);h.headers&&l.validateHeaders(h.headers);const f=A(this,a,F_).call(this,h.request,["beforeRequestSent"]);try{await f.continueRequest(h)}catch(p){throw l.wrapInterceptionError(p)}return{}}async continueResponse(h){h.headers&&l.validateHeaders(h.headers);const f=A(this,a,F_).call(this,h.request,["authRequired","responseStarted"]);try{await f.continueResponse(h)}catch(p){throw l.wrapInterceptionError(p)}return{}}async continueWithAuth(h){const f=h.request;return await A(this,a,F_).call(this,f,["authRequired"]).continueWithAuth(h),{}}async failRequest({request:h}){const f=A(this,a,mR).call(this,h);if(f.interceptPhase==="authRequired")throw new n.InvalidArgumentException(`Request '${h}' in 'authRequired' phase cannot be failed`);if(!f.interceptPhase)throw new n.NoSuchRequestException(`No blocked request found for network id '${h}'`);return await f.failRequest("Failed"),{}}async provideResponse(h){h.headers&&l.validateHeaders(h.headers);const f=A(this,a,F_).call(this,h.request,["beforeRequestSent","responseStarted","authRequired"]);try{await f.provideResponse(h)}catch(p){throw l.wrapInterceptionError(p)}return{}}async removeIntercept(h){return c(this,i).removeIntercept(h.intercept),await Promise.all(c(this,s).getAllContexts().map(f=>f.cdpTarget.toggleNetwork())),{}}async setCacheBehavior(h){const f=c(this,s).verifyTopLevelContextsList(h.contexts);if(f.size===0)return c(this,i).defaultCacheBehavior=h.cacheBehavior,await Promise.all(c(this,s).getAllContexts().map(m=>m.cdpTarget.toggleSetCacheDisabled())),{};const p=h.cacheBehavior==="bypass";return await Promise.all([...f.values()].map(m=>m.cdpTarget.toggleSetCacheDisabled(p))),{}}static validateHeaders(h){for(const f of h){let p;if(f.value.type==="string"?p=f.value.value:p=atob(f.value.value),p!==p.trim()||p.includes(`
`)||p.includes("\0"))throw new n.InvalidArgumentException(`Header value '${p}' is not acceptable value`)}}static isMethodValid(h){return/^[!#$%&'*+\-.^_`|~a-zA-Z\d]+$/.test(h)}static parseUrlString(h){try{return new URL(h)}catch(f){throw new n.InvalidArgumentException(`Invalid URL '${h}': ${f}`)}}static parseUrlPatterns(h){return h.map(f=>{let p="",m=!0,g=!0,y=!0,w=!0,v=!0;switch(f.type){case"string":{p=r(f.pattern);break}case"pattern":{if(f.protocol===void 0)m=!1,p+="http";else{if(f.protocol==="")throw new n.InvalidArgumentException("URL pattern must specify a protocol");if(f.protocol=r(f.protocol),!f.protocol.match(/^[a-zA-Z+-.]+$/))throw new n.InvalidArgumentException("Forbidden characters");p+=f.protocol}const S=p.toLocaleLowerCase();if(p+=":",(0,e.isSpecialScheme)(S)&&(p+="//"),f.hostname===void 0)S!=="file"&&(p+="placeholder"),g=!1;else{if(f.hostname==="")throw new n.InvalidArgumentException("URL pattern must specify a hostname");if(f.protocol==="file")throw new n.InvalidArgumentException("URL pattern protocol cannot be 'file'");f.hostname=r(f.hostname);let P=!1;for(const k of f.hostname){if(k==="/"||k==="?"||k==="#")throw new n.InvalidArgumentException("'/', '?', '#' are forbidden in hostname");if(!P&&k===":")throw new n.InvalidArgumentException("':' is only allowed inside brackets in hostname");k==="["&&(P=!0),k==="]"&&(P=!1)}p+=f.hostname}if(f.port===void 0)y=!1;else{if(f.port==="")throw new n.InvalidArgumentException("URL pattern must specify a port");if(f.port=r(f.port),p+=":",!f.port.match(/^\d+$/))throw new n.InvalidArgumentException("Forbidden characters");p+=f.port}if(f.pathname===void 0)w=!1;else{if(f.pathname=r(f.pathname),f.pathname[0]!=="/"&&(p+="/"),f.pathname.includes("#")||f.pathname.includes("?"))throw new n.InvalidArgumentException("Forbidden characters");p+=f.pathname}if(f.search===void 0)v=!1;else{if(f.search=r(f.search),f.search[0]!=="?"&&(p+="?"),f.search.includes("#"))throw new n.InvalidArgumentException("Forbidden characters");p+=f.search}break}}const b=S=>{const P={"ftp:":21,"file:":null,"http:":80,"https:":443,"ws:":80,"wss:":443};if((0,e.isSpecialScheme)(S.protocol)&&P[S.protocol]!==null&&(!S.port||String(P[S.protocol])===S.port))return"";if(S.port)return S.port};try{const S=new URL(p);return{protocol:m?S.protocol.replace(/:$/,""):void 0,hostname:g?S.hostname:void 0,port:y?b(S):void 0,pathname:w&&S.pathname?S.pathname:void 0,search:v?S.search:void 0}}catch(S){throw new n.InvalidArgumentException(`${S.message} '${p}'`)}})}static wrapInterceptionError(h){return h!=null&&h.message.includes("Invalid header")?new n.InvalidArgumentException("Invalid header"):h}},s=new WeakMap,i=new WeakMap,a=new WeakSet,mR=function(h){const f=c(this,i).getRequestById(h);if(!f)throw new n.NoSuchRequestException(`Network request with ID '${h}' doesn't exist`);return f},F_=function(h,f){const p=A(this,a,mR).call(this,h);if(!p.interceptPhase)throw new n.NoSuchRequestException(`No blocked request found for network id '${h}'`);if(p.interceptPhase&&!f.includes(p.interceptPhase))throw new n.InvalidArgumentException(`Blocked request for network id '${h}' is in '${p.interceptPhase}' phase`);return p},l);_y.NetworkProcessor=t;function r(d){const h=new Set(["(",")","*","{","}"]);let f="",p=!1;for(const m of d){if(!p){if(h.has(m))throw new n.InvalidArgumentException("Forbidden characters");if(m==="\\"){p=!0;continue}}f+=m,p=!1}return f}return _y}var by={},l5;function Fce(){var t,r;if(l5)return by;l5=1,Object.defineProperty(by,"__esModule",{value:!0}),by.PermissionsProcessor=void 0;const n=Ht();let e=(r=class{constructor(i){_(this,t);x(this,t,i)}async setPermissions(i){try{const a=i["goog:userContext"]||i.userContext;await c(this,t).sendCommand("Browser.setPermission",{origin:i.origin,browserContextId:a&&a!=="default"?a:void 0,permission:{name:i.descriptor.name},setting:i.state})}catch(a){if(a.message==="Permission can't be granted to opaque origins.")return{};throw new n.InvalidArgumentException(a.message)}return{}}},t=new WeakMap,r);return by.PermissionsProcessor=e,by}var Sy={},xy={},Tx={};const Lce=ct(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var d5;function zh(){if(d5)return Tx;d5=1,Object.defineProperty(Tx,"__esModule",{value:!0}),Tx.uuidv4=e;function n(t){return t.reduce((r,s)=>r+s.toString(16).padStart(2,"0"),"")}function e(){if("crypto"in globalThis&&"randomUUID"in globalThis.crypto)return globalThis.crypto.randomUUID();const t=new Uint8Array(16);return"crypto"in globalThis&&"getRandomValues"in globalThis.crypto?globalThis.crypto.getRandomValues(t):Lce.webcrypto.getRandomValues(t),t[6]=t[6]&15|64,t[8]=t[8]&63|128,[n(t.subarray(0,4)),n(t.subarray(4,6)),n(t.subarray(6,8)),n(t.subarray(8,10)),n(t.subarray(10,16))].join("-")}return Tx}var Ey={},h5;function f5(){var s,i,a,o,u,gR,w6,v6,f,yR,_6;if(h5)return Ey;h5=1,Object.defineProperty(Ey,"__esModule",{value:!0}),Ey.ChannelProxy=void 0;const n=Ht(),e=Ws(),t=zh();let r=(u=class{constructor(y,w){_(this,f);_(this,s);_(this,i,(0,t.uuidv4)());_(this,a);x(this,s,y),x(this,a,w)}async init(y,w){var S,P;const v=await A(S=u,o,w6).call(S,y),b=await A(P=u,o,v6).call(P,y,v);return A(this,f,yR).call(this,y,v,w),b}async startListenerFromWindow(y,w){var v;try{const b=await A(this,f,_6).call(this,y);A(this,f,yR).call(this,y,b,w)}catch(b){(v=c(this,a))==null||v.call(this,e.LogType.debugError,b)}}getEvalInWindowStr(){var v;const y=String((b,S)=>{const P=window;return P[b]===void 0?P[b]=S:(P[b](S),delete P[b]),S.sendMessage}),w=A(v=u,o,gR).call(v);return`(${y})('${c(this,i)}',${w})`}},s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakSet,gR=function(){return`(${String(()=>{const w=[];let v=null;return{async getMessage(){return await(w.length>0?Promise.resolve():new Promise(S=>{v=S})),w.shift()},sendMessage(b){w.push(b),v!==null&&(v(),v=null)}}})})()`},w6=async function(y){const w=await y.cdpClient.sendCommand("Runtime.evaluate",{expression:A(this,o,gR).call(this),contextId:y.executionContextId,serializationOptions:{serialization:"idOnly"}});if(w.exceptionDetails||w.result.objectId===void 0)throw new Error("Cannot create channel");return w.result.objectId},v6=async function(y,w){return(await y.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(b=>b.sendMessage),arguments:[{objectId:w}],executionContextId:y.executionContextId,serializationOptions:{serialization:"idOnly"}})).result.objectId},f=new WeakSet,yR=async function(y,w,v){var b,S;for(;;)try{const P=await y.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(async k=>await k.getMessage()),arguments:[{objectId:w}],awaitPromise:!0,executionContextId:y.executionContextId,serializationOptions:{serialization:"deep",maxDepth:((b=c(this,s).serializationOptions)==null?void 0:b.maxObjectDepth)??void 0}});if(P.exceptionDetails)throw new Error("Runtime.callFunctionOn in ChannelProxy",{cause:P.exceptionDetails});for(const k of y.associatedBrowsingContexts)v.registerEvent({type:"event",method:n.ChromiumBidi.Script.EventNames.Message,params:{channel:c(this,s).channel,data:y.cdpToBidiValue(P,c(this,s).ownership??"none"),source:y.source}},k.id)}catch(P){(S=c(this,a))==null||S.call(this,e.LogType.debugError,P);break}},_6=async function(y){const w=await y.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(v=>{const b=window;if(b[v]===void 0)return new Promise(P=>b[v]=P);const S=b[v];return delete b[v],S}),arguments:[{value:c(this,i)}],executionContextId:y.executionContextId,awaitPromise:!0,serializationOptions:{serialization:"idOnly"}});if(w.exceptionDetails!==void 0||w.result.objectId===void 0)throw new Error(`ChannelHandle not found in window["${c(this,i)}"]`);return w.result.objectId},_(u,o),u);return Ey.ChannelProxy=r,Ey}var p5;function jce(){var r,s,i,a,o,u,l,d,b6,f;if(p5)return xy;p5=1,Object.defineProperty(xy,"__esModule",{value:!0}),xy.PreloadScript=void 0;const n=zh(),e=f5();let t=(f=class{constructor(m,g){_(this,d);_(this,r,(0,n.uuidv4)());_(this,s,[]);_(this,i);_(this,a,new Set);_(this,o);_(this,u);_(this,l);var y;x(this,o,((y=m.arguments)==null?void 0:y.map(w=>new e.ChannelProxy(w.value,g)))??[]),x(this,i,m.functionDeclaration),x(this,u,m.sandbox),x(this,l,m.contexts)}get id(){return c(this,r)}get targetIds(){return c(this,a)}get channels(){return c(this,o)}get contexts(){return c(this,l)}async initInTargets(m,g){await Promise.all(Array.from(m).map(y=>this.initInTarget(y,g)))}async initInTarget(m,g){const y=await m.cdpClient.sendCommand("Page.addScriptToEvaluateOnNewDocument",{source:A(this,d,b6).call(this),worldName:c(this,u),runImmediately:g});c(this,s).push({target:m,preloadScriptId:y.identifier}),c(this,a).add(m.id)}async remove(){await Promise.all([c(this,s).map(async m=>{const g=m.target,y=m.preloadScriptId;return await g.cdpClient.sendCommand("Page.removeScriptToEvaluateOnNewDocument",{identifier:y})})])}dispose(m){x(this,s,c(this,s).filter(g=>{var y;return((y=g.target)==null?void 0:y.id)!==m})),c(this,a).delete(m)}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakSet,b6=function(){const m=`[${this.channels.map(g=>g.getEvalInWindowStr()).join(", ")}]`;return`(()=>{(${c(this,i)})(...${m})})()`},f);return xy.PreloadScript=t,xy}var m5;function Dce(){var r,s,i,a,o,u,S6,yE,h;if(m5)return Sy;m5=1,Object.defineProperty(Sy,"__esModule",{value:!0}),Sy.ScriptProcessor=void 0;const n=Ht(),e=jce();let t=(h=class{constructor(p,m,g,y,w){_(this,u);_(this,r);_(this,s);_(this,i);_(this,a);_(this,o);x(this,s,m),x(this,i,g),x(this,a,y),x(this,o,w),x(this,r,p),c(this,r).addSubscribeHook(n.ChromiumBidi.Script.EventNames.RealmCreated,A(this,u,S6).bind(this))}async addPreloadScript(p){const m=c(this,s).verifyTopLevelContextsList(p.contexts),g=new e.PreloadScript(p,c(this,o));c(this,a).add(g);const y=m.size===0?new Set(c(this,s).getTopLevelContexts().map(w=>w.cdpTarget)):new Set([...m.values()].map(w=>w.cdpTarget));return await g.initInTargets(y,!1),{script:g.id}}async removePreloadScript(p){const{script:m}=p,g=c(this,a).find({id:m});if(g.length===0)throw new n.NoSuchScriptException(`No preload script with id '${m}'`);return await Promise.all(g.map(y=>y.remove())),c(this,a).remove({id:m}),{}}async callFunction(p){return await(await A(this,u,yE).call(this,p.target)).callFunction(p.functionDeclaration,p.awaitPromise,p.this,p.arguments,p.resultOwnership,p.serializationOptions,p.userActivation)}async evaluate(p){return await(await A(this,u,yE).call(this,p.target)).evaluate(p.expression,p.awaitPromise,p.resultOwnership,p.serializationOptions,p.userActivation)}async disown(p){const m=await A(this,u,yE).call(this,p.target);return await Promise.all(p.handles.map(async g=>await m.disown(g))),{}}getRealms(p){return p.context!==void 0&&c(this,s).getContext(p.context),{realms:c(this,i).findRealms({browsingContextId:p.context,type:p.type}).map(g=>g.realmInfo)}}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakSet,S6=function(p){const m=c(this,s).getContext(p),g=[m,...c(this,s).getContext(p).allChildren],y=new Set;for(const w of g){const v=c(this,i).findRealms({browsingContextId:w.id});for(const b of v)y.add(b)}for(const w of y)c(this,r).registerEvent({type:"event",method:n.ChromiumBidi.Script.EventNames.RealmCreated,params:w.realmInfo},m.id);return Promise.resolve()},yE=async function(p){return"context"in p?await c(this,s).getContext(p.context).getOrCreateSandbox(p.sandbox):c(this,i).getRealm({realmId:p.realm})},h);return Sy.ScriptProcessor=t,Sy}var ky={},g5;function Bce(){var t,r,s,i,a,x6,E6,l;if(g5)return ky;g5=1,Object.defineProperty(ky,"__esModule",{value:!0}),ky.SessionProcessor=void 0;const n=Ht();let e=(l=class{constructor(h,f,p){_(this,a);_(this,t);_(this,r);_(this,s);_(this,i,!1);x(this,t,h),x(this,r,f),x(this,s,p)}status(){return{ready:!1,message:"already connected"}}async new(h){if(c(this,i))throw new Error("Session has been already created.");x(this,i,!0);const f=A(this,a,x6).call(this,h.capabilities);await c(this,s).call(this,f);const p=await c(this,r).sendCommand("Browser.getVersion");return{sessionId:"unknown",capabilities:{...f,acceptInsecureCerts:f.acceptInsecureCerts??!1,browserName:p.product,browserVersion:p.revision,platformName:"",setWindowRect:!1,webSocketUrl:"",userAgent:p.userAgent}}}async subscribe(h,f={}){return{subscription:await c(this,t).subscribe(h.events,h.contexts??[],f)}}async unsubscribe(h,f={}){return await c(this,t).unsubscribe(h.events,h.contexts??[],f),{}}},t=new WeakMap,r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakSet,x6=function(h){const f=[];for(const m of h.firstMatch??[{}]){const g={...h.alwaysMatch};for(const y of Object.keys(m)){if(g[y]!==void 0)throw new n.InvalidArgumentException(`Capability ${y} in firstMatch is already defined in alwaysMatch`);g[y]=m[y]}f.push(g)}const p=f.find(m=>m.browserName==="chrome")??f[0]??{};return p.unhandledPromptBehavior=A(this,a,E6).call(this,p.unhandledPromptBehavior),p},E6=function(h){if(h!==void 0){if(typeof h=="object")return h;if(typeof h!="string")throw new n.InvalidArgumentException(`Unexpected 'unhandledPromptBehavior' type: ${typeof h}`);switch(h){case"accept":case"accept and notify":return{default:"accept"};case"dismiss":case"dismiss and notify":return{default:"dismiss"};case"ignore":return{default:"ignore"};default:throw new n.InvalidArgumentException(`Unexpected 'unhandledPromptBehavior' value: ${h}`)}}},l);return ky.SessionProcessor=e,ky}var Cy={},y5;function Uce(){var a,o,u,l,wE,L_,k6,C6,vE,wR,y;if(y5)return Cy;y5=1,Object.defineProperty(Cy,"__esModule",{value:!0}),Cy.StorageProcessor=void 0;const n=Ht(),e=Hu(),t=Ws(),r=u5(),s=Ax();let i=(y=class{constructor(v,b,S){_(this,l);_(this,a);_(this,o);_(this,u);x(this,o,b),x(this,a,v),x(this,u,S)}async deleteCookies(v){const b=A(this,l,vE).call(this,v.partition);let S;try{S=await c(this,a).sendCommand("Storage.getCookies",{browserContextId:A(this,l,L_).call(this,b)})}catch(k){throw A(this,l,wE).call(this,k)?new n.NoSuchUserContextException(k.message):k}const P=S.cookies.filter(k=>{var C;return b.sourceOrigin===void 0||((C=k.partitionKey)==null?void 0:C.topLevelSite)===b.sourceOrigin}).filter(k=>{const C=(0,s.cdpToBiDiCookie)(k);return A(this,l,wR).call(this,C,v.filter)}).map(k=>({...k,expires:1}));return await c(this,a).sendCommand("Storage.setCookies",{cookies:P,browserContextId:A(this,l,L_).call(this,b)}),{partitionKey:b}}async getCookies(v){const b=A(this,l,vE).call(this,v.partition);let S;try{S=await c(this,a).sendCommand("Storage.getCookies",{browserContextId:A(this,l,L_).call(this,b)})}catch(k){throw A(this,l,wE).call(this,k)?new n.NoSuchUserContextException(k.message):k}return{cookies:S.cookies.filter(k=>{var C;return b.sourceOrigin===void 0||((C=k.partitionKey)==null?void 0:C.topLevelSite)===b.sourceOrigin}).map(k=>(0,s.cdpToBiDiCookie)(k)).filter(k=>A(this,l,wR).call(this,k,v.filter)),partitionKey:b}}async setCookie(v){var P;const b=A(this,l,vE).call(this,v.partition),S=(0,s.bidiToCdpCookie)(v,b);try{await c(this,a).sendCommand("Storage.setCookies",{cookies:[S],browserContextId:A(this,l,L_).call(this,b)})}catch(k){throw A(this,l,wE).call(this,k)?new n.NoSuchUserContextException(k.message):((P=c(this,u))==null||P.call(this,t.LogType.debugError,k),new n.UnableToSetCookieException(k.toString()))}return{partitionKey:b}}},a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakSet,wE=function(v){var b;return(b=v.message)==null?void 0:b.startsWith("Failed to find browser context for id")},L_=function(v){return v.userContext==="default"?void 0:v.userContext},k6=function(v){const b=v.context;return{userContext:c(this,o).getContext(b).userContext}},C6=function(v){var k;const b=new Map;let S=v.sourceOrigin;if(S!==void 0){const C=r.NetworkProcessor.parseUrlString(S);C.origin==="null"?S=C.origin:S=`${C.protocol}//${C.hostname}`}for(const[C,E]of Object.entries(v))C!==void 0&&E!==void 0&&!["type","sourceOrigin","userContext"].includes(C)&&b.set(C,E);return b.size>0&&((k=c(this,u))==null||k.call(this,t.LogType.debugInfo,`Unsupported partition keys: ${JSON.stringify(Object.fromEntries(b))}`)),{userContext:v.userContext??"default",...S===void 0?{}:{sourceOrigin:S}}},vE=function(v){return v===void 0?{userContext:"default"}:v.type==="context"?A(this,l,k6).call(this,v):((0,e.assert)(v.type==="storageKey","Unknown partition type"),A(this,l,C6).call(this,v))},wR=function(v,b){return b===void 0?!0:(b.domain===void 0||b.domain===v.domain)&&(b.name===void 0||b.name===v.name)&&(b.value===void 0||(0,s.deserializeByteValue)(b.value)===(0,s.deserializeByteValue)(v.value))&&(b.path===void 0||b.path===v.path)&&(b.size===void 0||b.size===v.size)&&(b.httpOnly===void 0||b.httpOnly===v.httpOnly)&&(b.secure===void 0||b.secure===v.secure)&&(b.sameSite===void 0||b.sameSite===v.sameSite)&&(b.expiry===void 0||b.expiry===v.expiry)},y);return Cy.StorageProcessor=i,Cy}var Py={},w5;function kI(){var e,t,r;if(w5)return Py;w5=1,Object.defineProperty(Py,"__esModule",{value:!0}),Py.OutgoingMessage=void 0;let n=(r=class{constructor(i,a){_(this,e);_(this,t);x(this,e,i),x(this,t,a)}static createFromPromise(i,a){return i.then(o=>o.kind==="success"?{kind:"success",value:new r(o.value,a)}:o)}static createResolved(i,a){return Promise.resolve({kind:"success",value:new r(i,a)})}get message(){return c(this,e)}get channel(){return c(this,t)}},e=new WeakMap,t=new WeakMap,r);return Py.OutgoingMessage=n,Py}var v5;function qce(){var g,y,w,v,b,S,P,k,C,E,M,I,N,P6,_E,L;if(v5)return cy;v5=1,Object.defineProperty(cy,"__esModule",{value:!0}),cy.CommandProcessor=void 0;const n=Ht(),e=Kh(),t=Ws(),r=xce(),s=Ece(),i=kce(),a=Cce(),o=$ce(),u=u5(),l=Fce(),d=Dce(),h=Bce(),f=Uce(),p=kI();let m=(L=class extends e.EventEmitter{constructor(j,F,B,D,W,G,te,K,q=new r.BidiNoOpParser,se,ke){super();_(this,N);_(this,g);_(this,y);_(this,w);_(this,v);_(this,b);_(this,S);_(this,P);_(this,k);_(this,C);_(this,E);_(this,M);_(this,I);x(this,M,q),x(this,I,ke),x(this,g,K),x(this,y,new s.BrowserProcessor(F,D)),x(this,w,new a.BrowsingContextProcessor(F,D,B)),x(this,v,new i.CdpProcessor(D,W,j,F)),x(this,b,new o.InputProcessor(D)),x(this,S,new u.NetworkProcessor(D,te)),x(this,P,new l.PermissionsProcessor(F)),x(this,k,new d.ScriptProcessor(B,D,W,G,ke)),x(this,C,new h.SessionProcessor(B,F,se)),x(this,E,new f.StorageProcessor(F,D,ke))}async processCommand(j){var F;try{const B=await A(this,N,P6).call(this,j),D={type:"success",id:j.id,result:B};this.emit("response",{message:p.OutgoingMessage.createResolved(D,j.channel),event:j.method})}catch(B){if(B instanceof n.Exception)this.emit("response",{message:p.OutgoingMessage.createResolved(B.toErrorResponse(j.id),j.channel),event:j.method});else{const D=B;(F=c(this,I))==null||F.call(this,t.LogType.bidi,D),this.emit("response",{message:p.OutgoingMessage.createResolved(new n.UnknownErrorException(D.message,D.stack).toErrorResponse(j.id),j.channel),event:j.method})}}}},g=new WeakMap,y=new WeakMap,w=new WeakMap,v=new WeakMap,b=new WeakMap,S=new WeakMap,P=new WeakMap,k=new WeakMap,C=new WeakMap,E=new WeakMap,M=new WeakMap,I=new WeakMap,N=new WeakSet,P6=async function(j){switch(j.method){case"bluetooth.handleRequestDevicePrompt":return await c(this,g).handleRequestDevicePrompt(c(this,M).parseHandleRequestDevicePromptParams(j.params));case"bluetooth.simulateAdapter":return await c(this,g).simulateAdapter(c(this,M).parseSimulateAdapterParameters(j.params));case"bluetooth.simulateAdvertisement":return await c(this,g).simulateAdvertisement(c(this,M).parseSimulateAdvertisementParameters(j.params));case"bluetooth.simulatePreconnectedPeripheral":return await c(this,g).simulatePreconnectedPeripheral(c(this,M).parseSimulatePreconnectedPeripheralParameters(j.params));case"browser.close":return c(this,y).close();case"browser.createUserContext":return await c(this,y).createUserContext(j.params);case"browser.getClientWindows":return await c(this,y).getClientWindows();case"browser.getUserContexts":return await c(this,y).getUserContexts();case"browser.removeUserContext":return await c(this,y).removeUserContext(c(this,M).parseRemoveUserContextParams(j.params));case"browser.setClientWindowState":throw new n.UnknownErrorException(`Method ${j.method} is not implemented.`);case"browsingContext.activate":return await c(this,w).activate(c(this,M).parseActivateParams(j.params));case"browsingContext.captureScreenshot":return await c(this,w).captureScreenshot(c(this,M).parseCaptureScreenshotParams(j.params));case"browsingContext.close":return await c(this,w).close(c(this,M).parseCloseParams(j.params));case"browsingContext.create":return await c(this,w).create(c(this,M).parseCreateParams(j.params));case"browsingContext.getTree":return c(this,w).getTree(c(this,M).parseGetTreeParams(j.params));case"browsingContext.handleUserPrompt":return await c(this,w).handleUserPrompt(c(this,M).parseHandleUserPromptParams(j.params));case"browsingContext.locateNodes":return await c(this,w).locateNodes(c(this,M).parseLocateNodesParams(j.params));case"browsingContext.navigate":return await c(this,w).navigate(c(this,M).parseNavigateParams(j.params));case"browsingContext.print":return await c(this,w).print(c(this,M).parsePrintParams(j.params));case"browsingContext.reload":return await c(this,w).reload(c(this,M).parseReloadParams(j.params));case"browsingContext.setViewport":return await c(this,w).setViewport(c(this,M).parseSetViewportParams(j.params));case"browsingContext.traverseHistory":return await c(this,w).traverseHistory(c(this,M).parseTraverseHistoryParams(j.params));case"goog:cdp.getSession":return c(this,v).getSession(c(this,M).parseGetSessionParams(j.params));case"goog:cdp.resolveRealm":return c(this,v).resolveRealm(c(this,M).parseResolveRealmParams(j.params));case"goog:cdp.sendCommand":return await c(this,v).sendCommand(c(this,M).parseSendCommandParams(j.params));case"cdp.getSession":return c(this,v).getSession(c(this,M).parseGetSessionParams(j.params));case"cdp.resolveRealm":return c(this,v).resolveRealm(c(this,M).parseResolveRealmParams(j.params));case"cdp.sendCommand":return await c(this,v).sendCommand(c(this,M).parseSendCommandParams(j.params));case"input.performActions":return await c(this,b).performActions(c(this,M).parsePerformActionsParams(j.params));case"input.releaseActions":return await c(this,b).releaseActions(c(this,M).parseReleaseActionsParams(j.params));case"input.setFiles":return await c(this,b).setFiles(c(this,M).parseSetFilesParams(j.params));case"network.addIntercept":return await c(this,S).addIntercept(c(this,M).parseAddInterceptParams(j.params));case"network.continueRequest":return await c(this,S).continueRequest(c(this,M).parseContinueRequestParams(j.params));case"network.continueResponse":return await c(this,S).continueResponse(c(this,M).parseContinueResponseParams(j.params));case"network.continueWithAuth":return await c(this,S).continueWithAuth(c(this,M).parseContinueWithAuthParams(j.params));case"network.failRequest":return await c(this,S).failRequest(c(this,M).parseFailRequestParams(j.params));case"network.provideResponse":return await c(this,S).provideResponse(c(this,M).parseProvideResponseParams(j.params));case"network.removeIntercept":return await c(this,S).removeIntercept(c(this,M).parseRemoveInterceptParams(j.params));case"network.setCacheBehavior":return await c(this,S).setCacheBehavior(c(this,M).parseSetCacheBehavior(j.params));case"permissions.setPermission":return await c(this,P).setPermissions(c(this,M).parseSetPermissionsParams(j.params));case"script.addPreloadScript":return await c(this,k).addPreloadScript(c(this,M).parseAddPreloadScriptParams(j.params));case"script.callFunction":return await c(this,k).callFunction(c(this,M).parseCallFunctionParams(A(this,N,_E).call(this,j.params)));case"script.disown":return await c(this,k).disown(c(this,M).parseDisownParams(A(this,N,_E).call(this,j.params)));case"script.evaluate":return await c(this,k).evaluate(c(this,M).parseEvaluateParams(A(this,N,_E).call(this,j.params)));case"script.getRealms":return c(this,k).getRealms(c(this,M).parseGetRealmsParams(j.params));case"script.removePreloadScript":return await c(this,k).removePreloadScript(c(this,M).parseRemovePreloadScriptParams(j.params));case"session.end":throw new n.UnknownErrorException(`Method ${j.method} is not implemented.`);case"session.new":return await c(this,C).new(j.params);case"session.status":return c(this,C).status();case"session.subscribe":return await c(this,C).subscribe(c(this,M).parseSubscribeParams(j.params),j.channel);case"session.unsubscribe":return await c(this,C).unsubscribe(c(this,M).parseSubscribeParams(j.params),j.channel);case"storage.deleteCookies":return await c(this,E).deleteCookies(c(this,M).parseDeleteCookiesParams(j.params));case"storage.getCookies":return await c(this,E).getCookies(c(this,M).parseGetCookiesParams(j.params));case"storage.setCookie":return await c(this,E).setCookie(c(this,M).parseSetCookieParams(j.params));case"webExtension.install":throw new n.UnknownErrorException(`Method ${j.method} is not implemented.`);case"webExtension.uninstall":throw new n.UnknownErrorException(`Method ${j.method} is not implemented.`)}throw new n.UnknownCommandException(`Unknown command '${j==null?void 0:j.method}'.`)},_E=function(j){return typeof j=="object"&&j&&"target"in j&&typeof j.target=="object"&&j.target&&"context"in j.target&&delete j.target.realm,j},L);return cy.CommandProcessor=m,cy}var Ay={},_5;function Hce(){var e,t,r;if(_5)return Ay;_5=1,Object.defineProperty(Ay,"__esModule",{value:!0}),Ay.BluetoothProcessor=void 0;let n=(r=class{constructor(i,a){_(this,e);_(this,t);x(this,e,i),x(this,t,a)}async simulateAdapter(i){const a=c(this,t).getContext(i.context);return await a.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.disable"),await a.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.enable",{state:i.state}),{}}async simulatePreconnectedPeripheral(i){return await c(this,t).getContext(i.context).cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.simulatePreconnectedPeripheral",{address:i.address,name:i.name,knownServiceUuids:i.knownServiceUuids,manufacturerData:i.manufacturerData}),{}}async simulateAdvertisement(i){return await c(this,t).getContext(i.context).cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.simulateAdvertisement",{entry:i.scanEntry}),{}}onCdpTargetCreated(i){i.cdpClient.on("DeviceAccess.deviceRequestPrompted",a=>{c(this,e).registerEvent({type:"event",method:"bluetooth.requestDevicePromptUpdated",params:{context:i.id,prompt:a.id,devices:a.devices}},i.id)})}async handleRequestDevicePrompt(i){const a=c(this,t).getContext(i.context);return i.accept?await a.cdpTarget.cdpClient.sendCommand("DeviceAccess.selectPrompt",{id:i.prompt,deviceId:i.device}):await a.cdpTarget.cdpClient.sendCommand("DeviceAccess.cancelPrompt",{id:i.prompt}),{}}},e=new WeakMap,t=new WeakMap,r);return Ay.BluetoothProcessor=n,Ay}var Ty={},Vh={},Iy={},b5;function Ix(){var e,t,r,s,i,a,o;if(b5)return Iy;b5=1,Object.defineProperty(Iy,"__esModule",{value:!0}),Iy.Deferred=void 0;let n=(e=Symbol.toStringTag,o=class{constructor(){_(this,t,!1);_(this,r);_(this,s);_(this,i);_(this,a);J(this,e,"Promise");x(this,r,new Promise((l,d)=>{x(this,i,l),x(this,a,d)})),c(this,r).catch(l=>{})}get isFinished(){return c(this,t)}get result(){if(!c(this,t))throw new Error("Deferred is not finished yet");return c(this,s)}then(l,d){return c(this,r).then(l,d)}catch(l){return c(this,r).catch(l)}resolve(l){x(this,s,l),c(this,t)||(x(this,t,!0),c(this,i).call(this,l))}reject(l){c(this,t)||(x(this,t,!0),c(this,a).call(this,l))}finally(l){return c(this,r).finally(l)}},t=new WeakMap,r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,o);return Iy.Deferred=n,Iy}var Ox={},S5;function x5(){if(S5)return Ox;S5=1,Object.defineProperty(Ox,"__esModule",{value:!0}),Ox.getTimestamp=n;function n(){return new Date().getTime()}return Ox}var Rx={},E5;function Kce(){if(E5)return Rx;E5=1,Object.defineProperty(Rx,"__esModule",{value:!0}),Rx.inchesFromCm=n;function n(e){return e/2.54}return Rx}var Oy={},Ry={},k5;function C5(){var i,a,o,u,l,d,h,f,vR,m,A6,_R,bR,T6,SR,xR,I6,O6,ER;if(k5)return Ry;k5=1,Object.defineProperty(Ry,"__esModule",{value:!0}),Ry.Realm=void 0;const n=Ht(),e=Ws(),t=zh(),r=f5(),E=class E{constructor(I,N,O,T,L,U,Z){_(this,f);_(this,i);_(this,a);_(this,o);_(this,u);_(this,l);_(this,d);_(this,h);x(this,i,I),x(this,a,N),x(this,o,O),x(this,u,T),x(this,l,L),x(this,d,U),x(this,h,Z),c(this,h).addRealm(this)}cdpToBidiValue(I,N){const O=this.serializeForBiDi(I.result.deepSerializedValue,new Map);if(I.result.objectId){const T=I.result.objectId;N==="root"?(O.handle=T,c(this,h).knownHandlesToRealmMap.set(T,this.realmId)):A(this,f,ER).call(this,T).catch(L=>{var U;return(U=c(this,u))==null?void 0:U.call(this,e.LogType.debugError,L)})}return O}serializeForBiDi(I,N){if(Object.hasOwn(I,"weakLocalObjectReference")){const T=I.weakLocalObjectReference;N.has(T)||N.set(T,(0,t.uuidv4)()),I.internalId=N.get(T),delete I.weakLocalObjectReference}if(I.type==="node"&&I.value&&Object.hasOwn(I.value,"frameId")&&delete I.value.frameId,I.type==="platformobject")return{type:"object"};const O=I.value;if(O===void 0)return I;if(["array","set","htmlcollection","nodelist"].includes(I.type))for(const T in O)O[T]=this.serializeForBiDi(O[T],N);if(["object","map"].includes(I.type))for(const T in O)O[T]=[this.serializeForBiDi(O[T][0],N),this.serializeForBiDi(O[T][1],N)];return I}get realmId(){return c(this,d)}get executionContextId(){return c(this,o)}get origin(){return c(this,l)}get source(){return{realm:this.realmId}}get cdpClient(){return c(this,i)}get baseInfo(){return{realm:this.realmId,origin:this.origin}}async evaluate(I,N,O="none",T={},L=!1,U=!1){var j;const Z=await this.cdpClient.sendCommand("Runtime.evaluate",{contextId:this.executionContextId,expression:I,awaitPromise:N,serializationOptions:A(j=E,m,xR).call(j,"deep",T),userGesture:L,includeCommandLineAPI:U});return Z.exceptionDetails?await A(this,f,SR).call(this,Z.exceptionDetails,0,O):{realm:this.realmId,result:this.cdpToBidiValue(Z,O),type:"success"}}initialize(){A(this,f,vR).call(this,{type:"event",method:n.ChromiumBidi.Script.EventNames.RealmCreated,params:this.realmInfo})}async serializeCdpObject(I,N){var L;const O=A(L=E,m,A6).call(L,I),T=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(U=>U),awaitPromise:!1,arguments:[O],serializationOptions:{serialization:"deep"},executionContextId:this.executionContextId});return this.cdpToBidiValue(T,N)}async stringifyObject(I){const{result:N}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(O=>String(O)),awaitPromise:!1,arguments:[I],returnByValue:!0,executionContextId:this.executionContextId});return N.value}async callFunction(I,N,O={type:"undefined"},T=[],L="none",U={},Z=!1){var D;const j=`(...args) => {
      function callFunction(f, args) {
        const deserializedThis = args.shift();
        const deserializedArgs = args;
        return f.apply(deserializedThis, deserializedArgs);
      }
      return callFunction((
        ${I}
      ), args);
    }`,F=[await this.deserializeForCdp(O),...await Promise.all(T.map(async W=>await this.deserializeForCdp(W)))];let B;try{B=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:j,awaitPromise:N,arguments:F,serializationOptions:A(D=E,m,xR).call(D,"deep",U),executionContextId:this.executionContextId,userGesture:Z})}catch(W){throw W.code===-32e3&&["Could not find object with given id","Argument should belong to the same JavaScript world as target object","Invalid remote object id"].includes(W.message)?new n.NoSuchHandleException("Handle was not found."):W}return B.exceptionDetails?await A(this,f,SR).call(this,B.exceptionDetails,1,L):{type:"success",result:this.cdpToBidiValue(B,L),realm:this.realmId}}async deserializeForCdp(I){if("handle"in I&&I.handle)return{objectId:I.handle};if("handle"in I||"sharedId"in I)throw new n.NoSuchHandleException("Handle was not found.");switch(I.type){case"undefined":return{unserializableValue:"undefined"};case"null":return{unserializableValue:"null"};case"string":return{value:I.value};case"number":return I.value==="NaN"?{unserializableValue:"NaN"}:I.value==="-0"?{unserializableValue:"-0"}:I.value==="Infinity"?{unserializableValue:"Infinity"}:I.value==="-Infinity"?{unserializableValue:"-Infinity"}:{value:I.value};case"boolean":return{value:!!I.value};case"bigint":return{unserializableValue:`BigInt(${JSON.stringify(I.value)})`};case"date":return{unserializableValue:`new Date(Date.parse(${JSON.stringify(I.value)}))`};case"regexp":return{unserializableValue:`new RegExp(${JSON.stringify(I.value.pattern)}, ${JSON.stringify(I.value.flags)})`};case"map":{const N=await A(this,f,_R).call(this,I.value),{result:O}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...T)=>{const L=new Map;for(let U=0;U<T.length;U+=2)L.set(T[U],T[U+1]);return L}),awaitPromise:!1,arguments:N,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:O.objectId}}case"object":{const N=await A(this,f,_R).call(this,I.value),{result:O}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...T)=>{const L={};for(let U=0;U<T.length;U+=2){const Z=T[U];L[Z]=T[U+1]}return L}),awaitPromise:!1,arguments:N,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:O.objectId}}case"array":{const N=await A(this,f,bR).call(this,I.value),{result:O}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...T)=>T),awaitPromise:!1,arguments:N,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:O.objectId}}case"set":{const N=await A(this,f,bR).call(this,I.value),{result:O}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...T)=>new Set(T)),awaitPromise:!1,arguments:N,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:O.objectId}}case"channel":return{objectId:await new r.ChannelProxy(I.value,c(this,u)).init(this,c(this,a))}}throw new Error(`Value ${JSON.stringify(I)} is not deserializable.`)}async disown(I){c(this,h).knownHandlesToRealmMap.get(I)===this.realmId&&(await A(this,f,ER).call(this,I),c(this,h).knownHandlesToRealmMap.delete(I))}dispose(){A(this,f,vR).call(this,{type:"event",method:n.ChromiumBidi.Script.EventNames.RealmDestroyed,params:{realm:this.realmId}})}};i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakSet,vR=function(I){if(this.associatedBrowsingContexts.length===0)c(this,a).registerGlobalEvent(I);else for(const N of this.associatedBrowsingContexts)c(this,a).registerEvent(I,N.id)},m=new WeakSet,A6=function(I){return I.objectId!==void 0?{objectId:I.objectId}:I.unserializableValue!==void 0?{unserializableValue:I.unserializableValue}:{value:I.value}},_R=async function(I){return(await Promise.all(I.map(async([O,T])=>{let L;typeof O=="string"?L={value:O}:L=await this.deserializeForCdp(O);const U=await this.deserializeForCdp(T);return[L,U]}))).flat()},bR=async function(I){return await Promise.all(I.map(N=>this.deserializeForCdp(N)))},T6=async function(I,N,O){var U;const T=((U=I.stackTrace)==null?void 0:U.callFrames.map(Z=>({url:Z.url,functionName:Z.functionName,lineNumber:Z.lineNumber-N,columnNumber:Z.columnNumber})))??[],L=I.exception;return{exception:await this.serializeCdpObject(L,O),columnNumber:I.columnNumber,lineNumber:I.lineNumber-N,stackTrace:{callFrames:T},text:await this.stringifyObject(L)||I.text}},SR=async function(I,N,O){return{exceptionDetails:await A(this,f,T6).call(this,I,N,O),realm:this.realmId,type:"exception"}},xR=function(I,N){var O,T;return{serialization:I,additionalParameters:A(O=E,m,I6).call(O,N),...A(T=E,m,O6).call(T,N)}},I6=function(I){const N={};return I.maxDomDepth!==void 0&&(N.maxNodeDepth=I.maxDomDepth===null?1e3:I.maxDomDepth),I.includeShadowTree!==void 0&&(N.includeShadowTree=I.includeShadowTree),N},O6=function(I){return I.maxObjectDepth===void 0||I.maxObjectDepth===null?{}:{maxDepth:I.maxObjectDepth}},ER=async function(I){try{await this.cdpClient.sendCommand("Runtime.releaseObject",{objectId:I})}catch(N){if(!(N.code===-32e3&&N.message==="Invalid remote object id"))throw N}},_(E,m);let s=E;return Ry.Realm=s,Ry}var My={},P5;function Wce(){if(P5)return My;P5=1,Object.defineProperty(My,"__esModule",{value:!0}),My.getSharedId=e,My.parseSharedId=r;const n="_element_";function e(s,i,a){return`f.${s}.d.${i}.e.${a}`}function t(s){const i=s.match(new RegExp(`(.*)${n}(.*)`));if(!i)return null;const a=i[1],o=i[2];if(a===void 0||o===void 0)return null;const u=parseInt(o??"");return isNaN(u)?null:{documentId:a,backendNodeId:u}}function r(s){const i=t(s);if(i!==null)return{...i,frameId:void 0};const a=s.match(/f\.(.*)\.d\.(.*)\.e\.([0-9]*)/);if(!a)return null;const o=a[1],u=a[2],l=a[3];if(o===void 0||u===void 0||l===void 0)return null;const d=parseInt(l??"");return isNaN(d)?null:{frameId:o,documentId:u,backendNodeId:d}}return My}var A5;function T5(){var s,i,a,R6;if(A5)return Oy;A5=1,Object.defineProperty(Oy,"__esModule",{value:!0}),Oy.WindowRealm=void 0;const n=Ht(),e=C5(),t=Wce();class r extends e.Realm{constructor(d,h,f,p,m,g,y,w,v,b){super(f,p,m,g,y,w,v);_(this,a);_(this,s);_(this,i);J(this,"sandbox");x(this,s,d),x(this,i,h),this.sandbox=b,this.initialize()}get browsingContext(){return c(this,i).getContext(c(this,s))}get associatedBrowsingContexts(){return[this.browsingContext]}get realmType(){return"window"}get realmInfo(){return{...this.baseInfo,type:this.realmType,context:c(this,s),sandbox:this.sandbox}}get source(){return{realm:this.realmId,context:this.browsingContext.id}}serializeForBiDi(d,h){const f=d.value;if(d.type==="node"&&f!==void 0){if(Object.hasOwn(f,"backendNodeId")){let p=this.browsingContext.navigableId??"UNKNOWN";Object.hasOwn(f,"loaderId")&&(p=f.loaderId,delete f.loaderId),d.sharedId=(0,t.getSharedId)(A(this,a,R6).call(this,p),p,f.backendNodeId),delete f.backendNodeId}if(Object.hasOwn(f,"children"))for(const p in f.children)f.children[p]=this.serializeForBiDi(f.children[p],h);Object.hasOwn(f,"shadowRoot")&&f.shadowRoot!==null&&(f.shadowRoot=this.serializeForBiDi(f.shadowRoot,h)),f.namespaceURI===""&&(f.namespaceURI=null)}return super.serializeForBiDi(d,h)}async deserializeForCdp(d){if("sharedId"in d&&d.sharedId){const h=(0,t.parseSharedId)(d.sharedId);if(h===null)throw new n.NoSuchNodeException(`SharedId "${d.sharedId}" was not found.`);const{documentId:f,backendNodeId:p}=h;if(this.browsingContext.navigableId!==f)throw new n.NoSuchNodeException(`SharedId "${d.sharedId}" belongs to different document. Current document is ${this.browsingContext.navigableId}.`);try{const{object:m}=await this.cdpClient.sendCommand("DOM.resolveNode",{backendNodeId:p,executionContextId:this.executionContextId});return{objectId:m.objectId}}catch(m){throw m.code===-32e3&&m.message==="No node with given id found"?new n.NoSuchNodeException(`SharedId "${d.sharedId}" was not found.`):new n.UnknownErrorException(m.message,m.stack)}}return await super.deserializeForCdp(d)}async evaluate(d,h,f,p,m,g){return await c(this,i).getContext(c(this,s)).targetUnblockedOrThrow(),await super.evaluate(d,h,f,p,m,g)}async callFunction(d,h,f,p,m,g,y){return await c(this,i).getContext(c(this,s)).targetUnblockedOrThrow(),await super.callFunction(d,h,f,p,m,g,y)}}return s=new WeakMap,i=new WeakMap,a=new WeakSet,R6=function(d){const h=c(this,i).getAllContexts().find(f=>f.navigableId===d);return(h==null?void 0:h.id)??"UNKNOWN"},Oy.WindowRealm=r,Oy}var Qa={},Mx={},I5;function zce(){if(I5)return Mx;I5=1,Object.defineProperty(Mx,"__esModule",{value:!0}),Mx.urlMatchesAboutBlank=n;function n(e){if(e==="")return!0;try{const t=new URL(e);return t.protocol.replace(/:$/,"").toLowerCase()==="about"&&t.pathname.toLowerCase()==="blank"&&t.username===""&&t.password===""&&t.host===""}catch(t){if(t instanceof TypeError)return!1;throw t}}return Mx}var O5;function Vce(){var l,d,h,f,p,m,g,bE,w,v,b,S,P,k,C,E,M6,I;if(O5)return Qa;O5=1,Object.defineProperty(Qa,"__esModule",{value:!0}),Qa.NavigationTracker=Qa.NavigationState=Qa.NavigationResult=void 0;const n=Ht(),e=Ix(),t=Ws(),r=x5(),s=zce(),i=zh();class a{constructor(O,T){J(this,"eventName");J(this,"message");this.eventName=O,this.message=T}}Qa.NavigationResult=a;class o{constructor(O,T,L,U){_(this,g);J(this,"navigationId",(0,i.uuidv4)());_(this,l);_(this,d,!1);_(this,h,new e.Deferred);J(this,"url");J(this,"loaderId");_(this,f);_(this,p);_(this,m,!1);J(this,"isFragmentNavigation");x(this,l,T),this.url=O,x(this,f,L),x(this,p,U)}get finished(){return c(this,h)}navigationInfo(){return{context:c(this,l),navigation:this.navigationId,timestamp:(0,r.getTimestamp)(),url:this.url}}start(){!c(this,f)&&!c(this,d)&&c(this,p).registerEvent({type:"event",method:n.ChromiumBidi.BrowsingContext.EventNames.NavigationStarted,params:this.navigationInfo()},c(this,l)),x(this,d,!0)}frameNavigated(){x(this,m,!0)}fragmentNavigated(){x(this,m,!0),A(this,g,bE).call(this,new a("browsingContext.fragmentNavigated"))}load(){A(this,g,bE).call(this,new a("browsingContext.load"))}fail(O){A(this,g,bE).call(this,new a(c(this,m)?"browsingContext.navigationAborted":"browsingContext.navigationFailed",O))}}l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakSet,bE=function(O){x(this,d,!0),!c(this,f)&&!c(this,h).isFinished&&O.eventName!=="browsingContext.load"&&c(this,p).registerEvent({type:"event",method:O.eventName,params:this.navigationInfo()},c(this,l)),c(this,h).resolve(O)},Qa.NavigationState=o;let u=(I=class{constructor(O,T,L,U){_(this,E);_(this,w);_(this,v);_(this,b,new Map);_(this,S);_(this,P);_(this,k);_(this,C,!0);x(this,S,T),x(this,w,L),x(this,v,U),x(this,C,!0),x(this,P,new o(O,T,(0,s.urlMatchesAboutBlank)(O),c(this,w)))}get currentNavigationId(){var O;return((O=c(this,k))==null?void 0:O.loaderId)!==void 0?c(this,k).navigationId:c(this,P).navigationId}get isInitialNavigation(){return c(this,C)}get url(){return c(this,P).url}createPendingNavigation(O,T=!1){var U,Z;(U=c(this,v))==null||U.call(this,t.LogType.debug,"createCommandNavigation"),x(this,C,T&&c(this,C)&&(0,s.urlMatchesAboutBlank)(O)),(Z=c(this,k))==null||Z.fail("navigation canceled by concurrent navigation");const L=new o(O,c(this,S),c(this,C),c(this,w));return x(this,k,L),L}dispose(){var O;(O=c(this,k))==null||O.fail("navigation canceled by context disposal"),c(this,P).fail("navigation canceled by context disposal")}onTargetInfoChanged(O){var T;(T=c(this,v))==null||T.call(this,t.LogType.debug,`onTargetInfoChanged ${O}`),c(this,P).url=O}frameNavigated(O,T,L){var Z;if((Z=c(this,v))==null||Z.call(this,t.LogType.debug,`frameNavigated ${O}`),L!==void 0&&!c(this,b).has(T)){const j=c(this,k)??this.createPendingNavigation(L,!0);j.url=L,j.start(),j.fail("the requested url is unreachable");return}const U=A(this,E,M6).call(this,O,T);U.frameNavigated(),U!==c(this,P)&&c(this,P).fail("navigation canceled by concurrent navigation"),U.url=O,U.loaderId=T,c(this,b).set(T,U),U.start(),x(this,P,U),c(this,k)===U&&x(this,k,void 0)}navigatedWithinDocument(O,T){var U;if((U=c(this,v))==null||U.call(this,t.LogType.debug,`navigatedWithinDocument ${O}, ${T}`),c(this,P).url=O,T!=="fragment")return;const L=c(this,k)!==void 0&&c(this,k).loaderId===void 0?c(this,k):new o(O,c(this,S),!1,c(this,w));L.fragmentNavigated(),L===c(this,k)&&x(this,k,void 0)}frameRequestedNavigation(O){var T;(T=c(this,v))==null||T.call(this,t.LogType.debug,`Page.frameRequestedNavigation ${O}`),this.createPendingNavigation(O,!0)}loadPageEvent(O){var T,L;(T=c(this,v))==null||T.call(this,t.LogType.debug,"loadPageEvent"),x(this,C,!1),(L=c(this,b).get(O))==null||L.load()}failNavigation(O,T){var L;(L=c(this,v))==null||L.call(this,t.LogType.debug,"failCommandNavigation"),O.fail(T)}navigationCommandFinished(O,T){var L;(L=c(this,v))==null||L.call(this,t.LogType.debug,`finishCommandNavigation ${O.navigationId}, ${T}`),T!==void 0&&(O.loaderId=T,c(this,b).set(T,O)),O.isFragmentNavigation=T===void 0,!(T===void 0||c(this,P)===O)&&(c(this,P).fail("navigation canceled by concurrent navigation"),O.start(),x(this,P,O),c(this,k)===O&&x(this,k,void 0))}frameStartedNavigating(O,T){var U;if((U=c(this,v))==null||U.call(this,t.LogType.debug,`frameStartedNavigating ${O}, ${T}`),c(this,b).has(T))return;const L=c(this,k)??this.createPendingNavigation(O,!0);L.url=O,L.start(),L.loaderId=T,c(this,b).set(T,L)}beforeunload(){var O,T;if((O=c(this,v))==null||O.call(this,t.LogType.debug,"beforeunload"),c(this,k)===void 0){(T=c(this,v))==null||T.call(this,t.LogType.debugError,"Unexpectedly no pending navigation on beforeunload");return}c(this,k).start()}networkLoadingFailed(O,T){var L;(L=c(this,b).get(O))==null||L.fail(T)}},w=new WeakMap,v=new WeakMap,b=new WeakMap,S=new WeakMap,P=new WeakMap,k=new WeakMap,C=new WeakMap,E=new WeakSet,M6=function(O,T){var L;return c(this,b).has(T)?c(this,b).get(T):c(this,k)!==void 0&&((L=c(this,k))==null?void 0:L.loaderId)===void 0?c(this,k):this.createPendingNavigation(O,!0)},I);return Qa.NavigationTracker=u,Qa}var R5;function M5(){var y,w,v,b,S,P,k,C,E,M,I,N,O,T,L,U,Z,j,SE,kR,D,$6,N6,xE,CR,F6,PR,L6,j6,D6;if(R5)return Vh;R5=1;var n;Object.defineProperty(Vh,"__esModule",{value:!0}),Vh.BrowsingContextImpl=void 0,Vh.serializeOrigin=d;const e=Ht(),t=Hu(),r=Ix(),s=Ws(),i=x5(),a=Kce(),o=T5(),u=Vce();let l=(y=class{constructor(R,$,H,V,X,ne,ce,Le,de,De,Pe){_(this,j);_(this,w,new Set);_(this,v);J(this,"userContext");_(this,b);_(this,S,null);_(this,P,{width:0,height:0});_(this,k);_(this,C,{DOMContentLoaded:new r.Deferred,load:new r.Deferred});_(this,E);_(this,M,new r.Deferred);_(this,I);_(this,N);_(this,O);_(this,T);_(this,L);_(this,U);_(this,Z);x(this,E,V),x(this,v,R),x(this,S,$),this.userContext=H,x(this,N,X),x(this,I,ne),x(this,L,ce),x(this,U,De),x(this,O,Pe),x(this,k,de),x(this,T,new u.NavigationTracker(Le,R,X,Pe))}static create(R,$,H,V,X,ne,ce,Le,de,De,Pe){var re;const z=new n(R,$,H,V,X,ne,ce,Le,de,De,Pe);return A(re=z,j,kR).call(re),ne.addContext(z),z.isTopLevelContext()||z.parent.addChild(z.id),X.registerPromiseEvent(z.targetUnblockedOrThrow().then(()=>({kind:"success",value:{type:"event",method:e.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,params:{...z.serializeToBidiValue(),url:Le}}}),ue=>({kind:"error",error:ue})),z.id,e.ChromiumBidi.BrowsingContext.EventNames.ContextCreated),z}get navigableId(){return c(this,b)}get navigationId(){return c(this,T).currentNavigationId}dispose(R){c(this,T).dispose(),A(this,j,SE).call(this),c(this,L).deleteRealms({browsingContextId:this.id}),this.isTopLevelContext()||c(this.parent,w).delete(this.id),A(this,j,F6).call(this),R&&c(this,N).registerEvent({type:"event",method:e.ChromiumBidi.BrowsingContext.EventNames.ContextDestroyed,params:this.serializeToBidiValue()},this.id),c(this,N).clearBufferedEvents(this.id),c(this,I).deleteContextById(this.id)}get id(){return c(this,v)}get parentId(){return c(this,S)}set parentId(R){var $;if(c(this,S)!==null){($=c(this,O))==null||$.call(this,s.LogType.debugError,"Parent context already set");return}x(this,S,R),this.isTopLevelContext()||this.parent.addChild(this.id)}get parent(){return this.parentId===null?null:c(this,I).getContext(this.parentId)}get directChildren(){return[...c(this,w)].map(R=>c(this,I).getContext(R))}get allChildren(){const R=this.directChildren;return R.concat(...R.map($=>$.allChildren))}isTopLevelContext(){return c(this,S)===null}get top(){let R=this,$=R.parent;for(;$;)R=$,$=R.parent;return R}addChild(R){c(this,w).add(R)}get cdpTarget(){return c(this,E)}updateCdpTarget(R){x(this,E,R),A(this,j,kR).call(this)}get url(){return c(this,T).url}async lifecycleLoaded(){await c(this,C).load}async targetUnblockedOrThrow(){const R=await c(this,E).unblocked;if(R.kind==="error")throw R.error}async getOrCreateSandbox(R){if(R===void 0||R==="")return await c(this,M);let $=c(this,L).findRealms({browsingContextId:this.id,sandbox:R});return $.length===0&&(await c(this,E).cdpClient.sendCommand("Page.createIsolatedWorld",{frameId:this.id,worldName:R}),$=c(this,L).findRealms({browsingContextId:this.id,sandbox:R}),(0,t.assert)($.length!==0)),$[0]}serializeToBidiValue(R=0,$=!0){return{context:c(this,v),url:this.url,userContext:this.userContext,originalOpener:c(this,k)??null,clientWindow:"",children:R>0?this.directChildren.map(H=>H.serializeToBidiValue(R-1,!1)):null,...$?{parent:c(this,S)}:{}}}onTargetInfoChanged(R){c(this,T).onTargetInfoChanged(R.targetInfo.url)}async navigate(R,$){try{new URL(R)}catch{throw new e.InvalidArgumentException(`Invalid URL: ${R}`)}const H=c(this,T).createPendingNavigation(R),V=(async()=>{const ne=await c(this,E).cdpClient.sendCommand("Page.navigate",{url:R,frameId:this.id});if(ne.errorText)throw c(this,T).failNavigation(H,ne.errorText),new e.UnknownErrorException(ne.errorText);c(this,T).navigationCommandFinished(H,ne.loaderId),A(this,j,xE).call(this,ne.loaderId)})(),X=await Promise.race([A(this,j,PR).call(this,$,V,H),H.finished]);if(X instanceof u.NavigationResult&&(X.eventName==="browsingContext.navigationAborted"||X.eventName==="browsingContext.navigationFailed"))throw new e.UnknownErrorException(X.message??"unknown exception");return{navigation:H.navigationId,url:H.url}}async reload(R,$){await this.targetUnblockedOrThrow(),A(this,j,CR).call(this);const H=c(this,T).createPendingNavigation(c(this,T).url),V=c(this,E).cdpClient.sendCommand("Page.reload",{ignoreCache:R}),X=await Promise.race([A(this,j,PR).call(this,$,V,H),H.finished]);if(X instanceof u.NavigationResult&&(X.eventName==="browsingContext.navigationAborted"||X.eventName==="browsingContext.navigationFailed"))throw new e.UnknownErrorException(X.message??"unknown exception");return{navigation:H.navigationId,url:H.url}}async setViewport(R,$){if(R===null&&$===null)await c(this,E).cdpClient.sendCommand("Emulation.clearDeviceMetricsOverride");else try{let H;R===void 0?H=c(this,P):R===null?H={width:0,height:0}:H=R,x(this,P,H),await c(this,E).cdpClient.sendCommand("Emulation.setDeviceMetricsOverride",{width:c(this,P).width,height:c(this,P).height,deviceScaleFactor:$||0,mobile:!1,dontSetVisibleSize:!0})}catch(H){throw H.message.startsWith("Width and height values must be positive")?new e.UnsupportedOperationException("Provided viewport dimensions are not supported"):H}}async handleUserPrompt(R,$){await c(this,E).cdpClient.sendCommand("Page.handleJavaScriptDialog",{accept:R??!0,promptText:$})}async activate(){await c(this,E).cdpClient.sendCommand("Page.bringToFront")}async captureScreenshot(R){if(!this.isTopLevelContext())throw new e.UnsupportedOperationException(`Non-top-level 'context' (${R.context}) is currently not supported`);const $=h(R);let H=!1,V;switch(R.origin??(R.origin="viewport"),R.origin){case"document":{V=String(()=>{const de=document.documentElement;return{x:0,y:0,width:de.scrollWidth,height:de.scrollHeight}}),H=!0;break}case"viewport":{V=String(()=>{const de=window.visualViewport;return{x:de.pageLeft,y:de.pageTop,width:de.width,height:de.height}});break}}const ne=await(await this.getOrCreateSandbox(void 0)).callFunction(V,!1);(0,t.assert)(ne.type==="success");const ce=f(ne.result);(0,t.assert)(ce);let Le=ce;if(R.clip){const de=R.clip;R.origin==="viewport"&&de.type==="box"&&(de.x+=ce.x,de.y+=ce.y),Le=m(await A(this,j,L6).call(this,de),ce)}if(Le.width===0||Le.height===0)throw new e.UnableToCaptureScreenException(`Unable to capture screenshot with zero dimensions: width=${Le.width}, height=${Le.height}`);return await c(this,E).cdpClient.sendCommand("Page.captureScreenshot",{clip:{...Le,scale:1},...$,captureBeyondViewport:H})}async print(R){var H,V,X,ne,ce,Le;if(!this.isTopLevelContext())throw new e.UnsupportedOperationException("Printing of non-top level contexts is not supported");const $={};if(R.background!==void 0&&($.printBackground=R.background),((H=R.margin)==null?void 0:H.bottom)!==void 0&&($.marginBottom=(0,a.inchesFromCm)(R.margin.bottom)),((V=R.margin)==null?void 0:V.left)!==void 0&&($.marginLeft=(0,a.inchesFromCm)(R.margin.left)),((X=R.margin)==null?void 0:X.right)!==void 0&&($.marginRight=(0,a.inchesFromCm)(R.margin.right)),((ne=R.margin)==null?void 0:ne.top)!==void 0&&($.marginTop=(0,a.inchesFromCm)(R.margin.top)),R.orientation!==void 0&&($.landscape=R.orientation==="landscape"),((ce=R.page)==null?void 0:ce.height)!==void 0&&($.paperHeight=(0,a.inchesFromCm)(R.page.height)),((Le=R.page)==null?void 0:Le.width)!==void 0&&($.paperWidth=(0,a.inchesFromCm)(R.page.width)),R.pageRanges!==void 0){for(const de of R.pageRanges){if(typeof de=="number")continue;const De=de.split("-");if(De.length<1||De.length>2)throw new e.InvalidArgumentException(`Invalid page range: ${de} is not a valid integer range.`);if(De.length===1){g(De[0]??"");continue}let Pe,z;const[re="",ue=""]=De;if(re===""?Pe=1:Pe=g(re),ue===""?z=Number.MAX_SAFE_INTEGER:z=g(ue),Pe>z)throw new e.InvalidArgumentException(`Invalid page range: ${re} > ${ue}`)}$.pageRanges=R.pageRanges.join(",")}R.scale!==void 0&&($.scale=R.scale),R.shrinkToFit!==void 0&&($.preferCSSPageSize=!R.shrinkToFit);try{return{data:(await c(this,E).cdpClient.sendCommand("Page.printToPDF",$)).data}}catch(de){throw de.message==="invalid print parameters: content area is empty"?new e.UnsupportedOperationException(de.message):de}}async close(){await c(this,E).cdpClient.sendCommand("Page.close")}async traverseHistory(R){if(R===0)return;const $=await c(this,E).cdpClient.sendCommand("Page.getNavigationHistory"),H=$.entries[$.currentIndex+R];if(!H)throw new e.NoSuchHistoryEntryException(`No history entry at delta ${R}`);await c(this,E).cdpClient.sendCommand("Page.navigateToHistoryEntry",{entryId:H.id})}async toggleModulesIfNeeded(){await Promise.all([c(this,E).toggleNetworkIfNeeded(),c(this,E).toggleDeviceAccessIfNeeded()])}async locateNodes(R){return await A(this,j,D6).call(this,await c(this,M),R.locator,R.startNodes??[],R.maxNodeCount,R.serializationOptions)}},w=new WeakMap,v=new WeakMap,b=new WeakMap,S=new WeakMap,P=new WeakMap,k=new WeakMap,C=new WeakMap,E=new WeakMap,M=new WeakMap,I=new WeakMap,N=new WeakMap,O=new WeakMap,T=new WeakMap,L=new WeakMap,U=new WeakMap,Z=new WeakMap,j=new WeakSet,SE=function(R=!1){this.directChildren.map($=>$.dispose(R))},kR=function(){c(this,E).cdpClient.on("Network.loadingFailed",R=>{c(this,T).networkLoadingFailed(R.requestId,R.errorText)}),c(this,E).cdpClient.on("Page.frameNavigated",R=>{this.id===R.frame.id&&(c(this,T).frameNavigated(R.frame.url+(R.frame.urlFragment??""),R.frame.loaderId,R.frame.unreachableUrl),A(this,j,SE).call(this),A(this,j,xE).call(this,R.frame.loaderId))}),c(this,E).on("frameStartedNavigating",R=>{var H;(H=c(this,O))==null||H.call(this,s.LogType.debugInfo,"Received frameStartedNavigating event",R),[this.id,...this.cdpTarget.id===this.id?[void 0]:[]].includes(R.frameId)&&c(this,T).frameStartedNavigating(R.url,R.loaderId)}),c(this,E).cdpClient.on("Page.navigatedWithinDocument",R=>{if(this.id===R.frameId&&(c(this,T).navigatedWithinDocument(R.url,R.navigationType),R.navigationType==="historyApi")){c(this,N).registerEvent({type:"event",method:"browsingContext.historyUpdated",params:{context:this.id,url:c(this,T).url}},this.id);return}}),c(this,E).cdpClient.on("Page.frameRequestedNavigation",R=>{this.id===R.frameId&&c(this,T).frameRequestedNavigation(R.url)}),c(this,E).cdpClient.on("Page.lifecycleEvent",R=>{if(this.id===R.frameId){if(R.name==="init"){A(this,j,xE).call(this,R.loaderId);return}if(R.name==="commit"){x(this,b,R.loaderId);return}if(c(this,b)||x(this,b,R.loaderId),R.loaderId===c(this,b))switch(R.name){case"DOMContentLoaded":c(this,T).isInitialNavigation||c(this,N).registerEvent({type:"event",method:e.ChromiumBidi.BrowsingContext.EventNames.DomContentLoaded,params:{context:this.id,navigation:c(this,T).currentNavigationId,timestamp:(0,i.getTimestamp)(),url:c(this,T).url}},this.id),c(this,C).DOMContentLoaded.resolve();break;case"load":c(this,T).isInitialNavigation||c(this,N).registerEvent({type:"event",method:e.ChromiumBidi.BrowsingContext.EventNames.Load,params:{context:this.id,navigation:c(this,T).currentNavigationId,timestamp:(0,i.getTimestamp)(),url:c(this,T).url}},this.id),c(this,T).loadPageEvent(R.loaderId),c(this,C).load.resolve();break}}}),c(this,E).cdpClient.on("Runtime.executionContextCreated",R=>{var de;const{auxData:$,name:H,uniqueId:V,id:X}=R.context;if(!$||$.frameId!==this.id)return;let ne,ce;switch($.type){case"isolated":ce=H,c(this,M).isFinished||(de=c(this,O))==null||de.call(this,s.LogType.debugError,"Unexpectedly, isolated realm created before the default one"),ne=c(this,M).isFinished?c(this,M).result.origin:"";break;case"default":ne=d(R.context.origin);break;default:return}const Le=new o.WindowRealm(this.id,c(this,I),c(this,E).cdpClient,c(this,N),X,c(this,O),ne,V,c(this,L),ce);$.isDefault&&(c(this,M).resolve(Le),Promise.all(c(this,E).getChannels().map(De=>De.startListenerFromWindow(Le,c(this,N)))))}),c(this,E).cdpClient.on("Runtime.executionContextDestroyed",R=>{c(this,M).isFinished&&c(this,M).result.executionContextId===R.executionContextId&&x(this,M,new r.Deferred),c(this,L).deleteRealms({cdpSessionId:c(this,E).cdpSessionId,executionContextId:R.executionContextId})}),c(this,E).cdpClient.on("Runtime.executionContextsCleared",()=>{c(this,M).isFinished||c(this,M).reject(new e.UnknownErrorException("execution contexts cleared")),x(this,M,new r.Deferred),c(this,L).deleteRealms({cdpSessionId:c(this,E).cdpSessionId})}),c(this,E).cdpClient.on("Page.javascriptDialogClosed",R=>{var H;const $=R.result;c(this,Z)===void 0&&((H=c(this,O))==null||H.call(this,s.LogType.debugError,"Unexpectedly no opening prompt event before closing one")),c(this,N).registerEvent({type:"event",method:e.ChromiumBidi.BrowsingContext.EventNames.UserPromptClosed,params:{context:this.id,accepted:$,type:c(this,Z)??"UNKNOWN",userText:$&&R.userInput?R.userInput:void 0}},this.id),x(this,Z,void 0)}),c(this,E).cdpClient.on("Page.javascriptDialogOpening",R=>{var V;const $=A(V=n,D,$6).call(V,R.type);R.type==="beforeunload"&&c(this,T).beforeunload(),x(this,Z,$);const H=A(this,j,N6).call(this,$);switch(c(this,N).registerEvent({type:"event",method:e.ChromiumBidi.BrowsingContext.EventNames.UserPromptOpened,params:{context:this.id,handler:H,type:$,message:R.message,...R.type==="prompt"?{defaultValue:R.defaultPrompt}:{}}},this.id),H){case"accept":this.handleUserPrompt(!0);break;case"dismiss":this.handleUserPrompt(!1);break}})},D=new WeakSet,$6=function(R){switch(R){case"alert":return"alert";case"beforeunload":return"beforeunload";case"confirm":return"confirm";case"prompt":return"prompt"}},N6=function(R){var H,V,X,ne,ce,Le,de,De;const $="dismiss";switch(R){case"alert":return((H=c(this,U))==null?void 0:H.alert)??((V=c(this,U))==null?void 0:V.default)??$;case"beforeunload":return((X=c(this,U))==null?void 0:X.beforeUnload)??((ne=c(this,U))==null?void 0:ne.default)??"accept";case"confirm":return((ce=c(this,U))==null?void 0:ce.confirm)??((Le=c(this,U))==null?void 0:Le.default)??$;case"prompt":return((de=c(this,U))==null?void 0:de.prompt)??((De=c(this,U))==null?void 0:De.default)??$}},xE=function(R){R===void 0||c(this,b)===R||(A(this,j,CR).call(this),x(this,b,R),A(this,j,SE).call(this,!0))},CR=function(){var R,$;c(this,C).DOMContentLoaded.isFinished?c(this,C).DOMContentLoaded=new r.Deferred:(R=c(this,O))==null||R.call(this,n.LOGGER_PREFIX,"Document changed (DOMContentLoaded)"),c(this,C).load.isFinished?c(this,C).load=new r.Deferred:($=c(this,O))==null||$.call(this,n.LOGGER_PREFIX,"Document changed (load)")},F6=function(){c(this,C).DOMContentLoaded.isFinished||c(this,C).DOMContentLoaded.reject(new e.UnknownErrorException("navigation canceled")),c(this,C).load.isFinished||c(this,C).load.reject(new e.UnknownErrorException("navigation canceled"))},PR=async function(R,$,H){if(R!=="none"){if(await $,H.isFragmentNavigation===!0){await H.finished;return}if(R==="interactive"){await c(this,C).DOMContentLoaded;return}if(R==="complete"){await c(this,C).load;return}throw new e.InvalidArgumentException(`Wait condition ${R} is not supported`)}},L6=async function(R){switch(R.type){case"box":return{x:R.x,y:R.y,width:R.width,height:R.height};case"element":{const $=await this.getOrCreateSandbox(void 0),H=await $.callFunction(String(V=>V instanceof Element),!1,{type:"undefined"},[R.element]);if(H.type==="exception")throw new e.NoSuchElementException(`Element '${R.element.sharedId}' was not found`);if((0,t.assert)(H.result.type==="boolean"),!H.result.value)throw new e.NoSuchElementException(`Node '${R.element.sharedId}' is not an Element`);{const V=await $.callFunction(String(ne=>{const ce=ne.getBoundingClientRect();return{x:ce.x,y:ce.y,height:ce.height,width:ce.width}}),!1,{type:"undefined"},[R.element]);(0,t.assert)(V.type==="success");const X=f(V.result);if(!X)throw new e.UnableToCaptureScreenException(`Could not get bounding box for Element '${R.element.sharedId}'`);return X}}}},j6=async function(R,$,H,V){switch($.type){case"context":throw new Error("Unreachable");case"css":return{functionDeclaration:String((X,ne,...ce)=>{const Le=De=>{if(!(De instanceof HTMLElement||De instanceof Document||De instanceof DocumentFragment))throw new Error("startNodes in css selector should be HTMLElement, Document or DocumentFragment");return[...De.querySelectorAll(X)]};ce=ce.length>0?ce:[document];const de=ce.map(De=>Le(De)).flat(1);return ne===0?de:de.slice(0,ne)}),argumentsLocalValues:[{type:"string",value:$.value},{type:"number",value:H??0},...V]};case"xpath":return{functionDeclaration:String((X,ne,...ce)=>{const de=new XPathEvaluator().createExpression(X),De=z=>{const re=de.evaluate(z,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE),ue=[];for(let xe=0;xe<re.snapshotLength;xe++)ue.push(re.snapshotItem(xe));return ue};ce=ce.length>0?ce:[document];const Pe=ce.map(z=>De(z)).flat(1);return ne===0?Pe:Pe.slice(0,ne)}),argumentsLocalValues:[{type:"string",value:$.value},{type:"number",value:H??0},...V]};case"innerText":if($.value==="")throw new e.InvalidSelectorException("innerText locator cannot be empty");return{functionDeclaration:String((X,ne,ce,Le,de,...De)=>{const Pe=ce?X.toUpperCase():X,z=(ue,xe)=>{var is;const Be=[];if(ue instanceof DocumentFragment||ue instanceof Document)return[...ue.children].forEach(Po=>Be.push(...z(Po,xe))),Be;if(!(ue instanceof HTMLElement))return[];const Ye=ue,Dt=ce?(is=Ye.innerText)==null?void 0:is.toUpperCase():Ye.innerText;if(!Dt.includes(Pe))return[];const Bt=[];for(const Kr of Ye.children)Kr instanceof HTMLElement&&Bt.push(Kr);if(Bt.length===0)ne&&Dt===Pe?Be.push(Ye):ne||Be.push(Ye);else{const Kr=xe<=0?[]:Bt.map(Po=>z(Po,xe-1)).flat(1);Kr.length===0?(!ne||Dt===Pe)&&Be.push(Ye):Be.push(...Kr)}return Be};De=De.length>0?De:[document];const re=De.map(ue=>z(ue,de)).flat(1);return Le===0?re:re.slice(0,Le)}),argumentsLocalValues:[{type:"string",value:$.value},{type:"boolean",value:$.matchType!=="partial"},{type:"boolean",value:$.ignoreCase===!0},{type:"number",value:H??0},{type:"number",value:$.maxDepth??1e3},...V]};case"accessibility":{if(!$.value.name&&!$.value.role)throw new e.InvalidSelectorException("Either name or role has to be specified");await Promise.all([c(this,E).cdpClient.sendCommand("Accessibility.enable"),c(this,E).cdpClient.sendCommand("Accessibility.getRootAXNode")]);const X=await R.evaluate("({getAccessibleName, getAccessibleRole})",!1,"root",void 0,!1,!0);if(X.type!=="success")throw new Error("Could not get bindings");if(X.result.type!=="object")throw new Error("Could not get bindings");return{functionDeclaration:String((ne,ce,Le,de,...De)=>{const Pe=[];let z=!1;function re(ue,xe){if(!z)for(const Be of ue){let Ye=!0;if(xe.role){const Bt=Le.getAccessibleRole(Be);xe.role!==Bt&&(Ye=!1)}if(xe.name){const Bt=Le.getAccessibleName(Be);xe.name!==Bt&&(Ye=!1)}if(Ye){if(de!==0&&Pe.length===de){z=!0;break}Pe.push(Be)}const Dt=[];for(const Bt of Be.children)Bt instanceof HTMLElement&&Dt.push(Bt);re(Dt,xe)}}return De=De.length>0?De:Array.from(document.documentElement.children).filter(ue=>ue instanceof HTMLElement),re(De,{role:ce,name:ne}),Pe}),argumentsLocalValues:[{type:"string",value:$.value.name||""},{type:"string",value:$.value.role||""},{handle:X.result.handle},{type:"number",value:H??0},...V]}}}},D6=async function(R,$,H,V,X){var de,De,Pe;if($.type==="context"){if(H.length!==0)throw new e.InvalidArgumentException("Start nodes are not supported");const z=$.value.context;if(!z)throw new e.InvalidSelectorException("Invalid context");const ue=c(this,I).getContext(z).parent;if(!ue)throw new e.InvalidArgumentException("This context has no container");try{const{backendNodeId:xe}=await c(ue,E).cdpClient.sendCommand("DOM.getFrameOwner",{frameId:z}),{object:Be}=await c(ue,E).cdpClient.sendCommand("DOM.resolveNode",{backendNodeId:xe}),Ye=await R.callFunction("function () { return this; }",!1,{handle:Be.objectId},[],"none",X);if(Ye.type==="exception")throw new Error("Unknown exception");return{nodes:[Ye.result]}}catch{throw new e.InvalidArgumentException("Context does not exist")}}const ne=await A(this,j,j6).call(this,R,$,V,H);X={...X,maxObjectDepth:1};const ce=await R.callFunction(ne.functionDeclaration,!1,{type:"undefined"},ne.argumentsLocalValues,"none",X);if(ce.type!=="success")throw(de=c(this,O))==null||de.call(this,n.LOGGER_PREFIX,"Failed locateNodesByLocator",ce),(De=ce.exceptionDetails.text)!=null&&De.endsWith("is not a valid selector.")||(Pe=ce.exceptionDetails.text)!=null&&Pe.endsWith("is not a valid XPath expression.")?new e.InvalidSelectorException(`Not valid selector ${typeof $.value=="string"?$.value:JSON.stringify($.value)}`):ce.exceptionDetails.text==="Error: startNodes in css selector should be HTMLElement, Document or DocumentFragment"?new e.InvalidArgumentException("startNodes in css selector should be HTMLElement, Document or DocumentFragment"):new e.UnknownErrorException(`Unexpected error in selector script: ${ce.exceptionDetails.text}`);if(ce.result.type!=="array")throw new e.UnknownErrorException(`Unexpected selector script result type: ${ce.result.type}`);return{nodes:ce.result.value.map(z=>{if(z.type!=="node")throw new e.UnknownErrorException(`Unexpected selector script result element: ${z.type}`);return z})}},_(y,D),J(y,"LOGGER_PREFIX",`${s.LogType.debug}:browsingContext`),y);Vh.BrowsingContextImpl=l,n=l;function d(fe){return["://",""].includes(fe)&&(fe="null"),fe}function h(fe){const{quality:R,type:$}=fe.format??{type:"image/png"};switch($){case"image/png":return{format:"png"};case"image/jpeg":return{format:"jpeg",...R===void 0?{}:{quality:Math.round(R*100)}};case"image/webp":return{format:"webp",...R===void 0?{}:{quality:Math.round(R*100)}}}throw new e.InvalidArgumentException(`Image format '${$}' is not a supported format`)}function f(fe){var X,ne,ce,Le;if(fe.type!=="object"||fe.value===void 0)return;const R=(X=fe.value.find(([de])=>de==="x"))==null?void 0:X[1],$=(ne=fe.value.find(([de])=>de==="y"))==null?void 0:ne[1],H=(ce=fe.value.find(([de])=>de==="height"))==null?void 0:ce[1],V=(Le=fe.value.find(([de])=>de==="width"))==null?void 0:Le[1];if(!((R==null?void 0:R.type)!=="number"||($==null?void 0:$.type)!=="number"||(H==null?void 0:H.type)!=="number"||(V==null?void 0:V.type)!=="number"))return{x:R.value,y:$.value,width:V.value,height:H.value}}function p(fe){return{...fe.width<0?{x:fe.x+fe.width,width:-fe.width}:{x:fe.x,width:fe.width},...fe.height<0?{y:fe.y+fe.height,height:-fe.height}:{y:fe.y,height:fe.height}}}function m(fe,R){fe=p(fe),R=p(R);const $=Math.max(fe.x,R.x),H=Math.max(fe.y,R.y);return{x:$,y:H,width:Math.max(Math.min(fe.x+fe.width,R.x+R.width)-$,0),height:Math.max(Math.min(fe.y+fe.height,R.y+R.height)-H,0)}}function g(fe){if(fe=fe.trim(),!/^[0-9]+$/.test(fe))throw new e.InvalidArgumentException(`Invalid integer: ${fe}`);return parseInt(fe)}return Vh}var $y={},$5;function Gce(){var t,r,s;if($5)return $y;$5=1,Object.defineProperty($y,"__esModule",{value:!0}),$y.WorkerRealm=void 0;const n=C5();let e=(s=class extends n.Realm{constructor(o,u,l,d,h,f,p,m,g){super(o,u,l,d,h,p,m);_(this,t);_(this,r);x(this,r,f),x(this,t,g),this.initialize()}get associatedBrowsingContexts(){return c(this,r).flatMap(o=>o.associatedBrowsingContexts)}get realmType(){return c(this,t)}get source(){var o;return{realm:this.realmId,context:(o=this.associatedBrowsingContexts[0])==null?void 0:o.id}}get realmInfo(){const o=c(this,r).map(l=>l.realmId),{realmType:u}=this;switch(u){case"dedicated-worker":{const l=o[0];if(l===void 0||o.length!==1)throw new Error("Dedicated worker must have exactly one owner");return{...this.baseInfo,type:u,owners:[l]}}case"service-worker":case"shared-worker":return{...this.baseInfo,type:u}}}},t=new WeakMap,r=new WeakMap,s);return $y.WorkerRealm=e,$y}var Ny={},Fy={},Ly={},N5;function Zce(){if(N5)return Ly;N5=1,Object.defineProperty(Ly,"__esModule",{value:!0}),Ly.logMessageFormatter=r,Ly.getRemoteValuesText=a;const n=Hu(),e=["%s","%d","%i","%f","%o","%O","%c"];function t(o){return e.some(u=>o.includes(u))}function r(o){let u="";const l=o[0].value.toString(),d=o.slice(1,void 0),h=l.split(new RegExp(e.map(f=>`(${f})`).join("|"),"g"));for(const f of h)if(!(f===void 0||f===""))if(t(f)){const p=d.shift();(0,n.assert)(p,`Less value is provided: "${a(o,!1)}"`),f==="%s"?u+=i(p):f==="%d"||f==="%i"?p.type==="bigint"||p.type==="number"||p.type==="string"?u+=parseInt(p.value.toString(),10):u+="NaN":f==="%f"?p.type==="bigint"||p.type==="number"||p.type==="string"?u+=parseFloat(p.value.toString()):u+="NaN":u+=s(p)}else u+=f;if(d.length>0)throw new Error(`More value is provided: "${a(o,!1)}"`);return u}function s(o){var u;if(o.type!=="array"&&o.type!=="bigint"&&o.type!=="date"&&o.type!=="number"&&o.type!=="object"&&o.type!=="string")return i(o);if(o.type==="bigint")return`${o.value.toString()}n`;if(o.type==="number")return o.value.toString();if(["date","string"].includes(o.type))return JSON.stringify(o.value);if(o.type==="object")return`{${o.value.map(l=>`${JSON.stringify(l[0])}:${s(l[1])}`).join(",")}}`;if(o.type==="array")return`[${((u=o.value)==null?void 0:u.map(l=>s(l)).join(","))??""}]`;throw Error(`Invalid value type: ${o}`)}function i(o){var u,l,d,h;if(!Object.hasOwn(o,"value"))return o.type;switch(o.type){case"string":case"number":case"boolean":case"bigint":return String(o.value);case"regexp":return`/${o.value.pattern}/${o.value.flags??""}`;case"date":return new Date(o.value).toString();case"object":return`Object(${((u=o.value)==null?void 0:u.length)??""})`;case"array":return`Array(${((l=o.value)==null?void 0:l.length)??""})`;case"map":return`Map(${(d=o.value)==null?void 0:d.length})`;case"set":return`Set(${(h=o.value)==null?void 0:h.length})`;default:return o.type}}function a(o,u){const l=o[0];return l?l.type==="string"&&t(l.value.toString())&&u?r(o):o.map(d=>i(d)).join(" "):""}return Ly}var F5;function Jce(){var u,l,d,h,f,B6,U6,g,y,q6;if(F5)return Fy;F5=1;var n;Object.defineProperty(Fy,"__esModule",{value:!0}),Fy.LogManager=void 0;const e=Ht(),t=Ws(),r=Zce();function s(v){const b=v==null?void 0:v.callFrames.map(S=>({columnNumber:S.columnNumber,functionName:S.functionName,lineNumber:S.lineNumber,url:S.url}));return b?{callFrames:b}:void 0}function i(v){return["error","assert"].includes(v)?"error":["debug","trace"].includes(v)?"debug":["warn","warning"].includes(v)?"warn":"info"}function a(v){switch(v){case"warning":return"warn";case"startGroup":return"group";case"startGroupCollapsed":return"groupCollapsed";case"endGroup":return"groupEnd"}return v}let o=(y=class{constructor(b,S,P,k){_(this,f);_(this,u);_(this,l);_(this,d);_(this,h);x(this,d,b),x(this,l,S),x(this,u,P),x(this,h,k)}static create(b,S,P,k){var E;const C=new n(b,S,P,k);return A(E=C,f,U6).call(E),C}},u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakSet,B6=async function(b,S){switch(b.type){case"undefined":return{type:"undefined"};case"boolean":return{type:"boolean",value:b.value};case"string":return{type:"string",value:b.value};case"number":return{type:"number",value:b.unserializableValue??b.value};case"bigint":if(b.unserializableValue!==void 0&&b.unserializableValue[b.unserializableValue.length-1]==="n")return{type:b.type,value:b.unserializableValue.slice(0,-1)};break;case"object":if(b.subtype==="null")return{type:"null"};break}return await S.serializeCdpObject(b,"none")},U6=function(){c(this,d).cdpClient.on("Runtime.consoleAPICalled",b=>{var k;const S=c(this,l).findRealm({cdpSessionId:c(this,d).cdpSessionId,executionContextId:b.executionContextId});if(S===void 0){(k=c(this,h))==null||k.call(this,t.LogType.cdp,b);return}const P=Promise.all(b.args.map(C=>A(this,f,B6).call(this,C,S)));for(const C of S.associatedBrowsingContexts)c(this,u).registerPromiseEvent(P.then(E=>({kind:"success",value:{type:"event",method:e.ChromiumBidi.Log.EventNames.LogEntryAdded,params:{level:i(b.type),source:S.source,text:(0,r.getRemoteValuesText)(E,!0),timestamp:Math.round(b.timestamp),stackTrace:s(b.stackTrace),type:"console",method:a(b.type),args:E}}}),E=>({kind:"error",error:E})),C.id,e.ChromiumBidi.Log.EventNames.LogEntryAdded)}),c(this,d).cdpClient.on("Runtime.exceptionThrown",b=>{var P,k;const S=c(this,l).findRealm({cdpSessionId:c(this,d).cdpSessionId,executionContextId:b.exceptionDetails.executionContextId});if(S===void 0){(P=c(this,h))==null||P.call(this,t.LogType.cdp,b);return}for(const C of S.associatedBrowsingContexts)c(this,u).registerPromiseEvent(A(k=n,g,q6).call(k,b,S).then(E=>({kind:"success",value:{type:"event",method:e.ChromiumBidi.Log.EventNames.LogEntryAdded,params:{level:"error",source:S.source,text:E,timestamp:Math.round(b.timestamp),stackTrace:s(b.exceptionDetails.stackTrace),type:"javascript"}}}),E=>({kind:"error",error:E})),C.id,e.ChromiumBidi.Log.EventNames.LogEntryAdded)})},g=new WeakSet,q6=async function(b,S){return b.exceptionDetails.exception?S===void 0?JSON.stringify(b.exceptionDetails.exception):await S.stringifyObject(b.exceptionDetails.exception):b.exceptionDetails.text},_(y,g),y);return Fy.LogManager=o,n=o,Fy}var L5;function Xce(){var o,u,l,d,h,f,p,m,g,y,w,v,b,S,P,k,C,H6,AR,EE,K6,W6,z6,V6,U;if(L5)return Ny;L5=1,Object.defineProperty(Ny,"__esModule",{value:!0}),Ny.CdpTarget=void 0;const n=j4(),e=Ix(),t=Kh(),r=Ws(),s=M5(),i=Jce();let a=(U=class extends t.EventEmitter{constructor(F,B,D,W,G,te,K,q,se,ke,he,et){super();_(this,C);_(this,o);_(this,u);_(this,l);_(this,d);_(this,h);_(this,f);_(this,p);_(this,m);_(this,g);_(this,y);_(this,w,new e.Deferred);_(this,v);_(this,b);_(this,S,!1);_(this,P,!1);_(this,k,{request:!1,response:!1,auth:!1});x(this,o,F),x(this,u,B),x(this,l,D),x(this,d,W),x(this,f,G),x(this,h,te),x(this,p,K),x(this,y,se),x(this,m,q),x(this,g,ke),x(this,v,he),x(this,b,et)}static create(F,B,D,W,G,te,K,q,se,ke,he,et){var R,$;const fe=new U(F,B,D,W,te,G,K,q,se,ke,he,et);return i.LogManager.create(fe,G,te,et),A(R=fe,C,K6).call(R),A($=fe,C,H6).call($),fe}get unblocked(){return c(this,w)}get id(){return c(this,o)}get cdpClient(){return c(this,u)}get parentCdpClient(){return c(this,d)}get browserCdpClient(){return c(this,l)}get cdpSessionId(){return c(this,u).sessionId}async toggleFetchIfNeeded(){const F=c(this,y).getInterceptionStages(this.topLevelId);if(c(this,k).request===F.request&&c(this,k).response===F.response&&c(this,k).auth===F.auth)return;const B=[];if(x(this,k,F),(F.request||F.auth)&&B.push({urlPattern:"*",requestStage:"Request"}),F.response&&B.push({urlPattern:"*",requestStage:"Response"}),B.length)await c(this,u).sendCommand("Fetch.enable",{patterns:B,handleAuthRequests:F.auth});else{const D=c(this,y).getRequestsByTarget(this).filter(W=>W.interceptPhase);Promise.allSettled(D.map(W=>W.waitNextPhase)).then(async()=>c(this,y).getRequestsByTarget(this).filter(G=>G.interceptPhase).length?await this.toggleFetchIfNeeded():await c(this,u).sendCommand("Fetch.disable")).catch(W=>{var G;(G=c(this,b))==null||G.call(this,r.LogType.bidi,"Disable failed",W)})}}async toggleNetworkIfNeeded(){var F;try{await Promise.all([this.toggleSetCacheDisabled(),this.toggleFetchIfNeeded()])}catch(B){if((F=c(this,b))==null||F.call(this,r.LogType.debugError,B),!A(this,C,EE).call(this,B))throw B}}async toggleSetCacheDisabled(F){var W;const B=c(this,y).defaultCacheBehavior==="bypass",D=F??B;if(c(this,P)!==D){x(this,P,D);try{await c(this,u).sendCommand("Network.setCacheDisabled",{cacheDisabled:D})}catch(G){if((W=c(this,b))==null||W.call(this,r.LogType.debugError,G),x(this,P,!D),!A(this,C,EE).call(this,G))throw G}}}async toggleDeviceAccessIfNeeded(){var B;const F=this.isSubscribedTo(n.Bluetooth.EventNames.RequestDevicePromptUpdated);if(c(this,S)!==F){x(this,S,F);try{await c(this,u).sendCommand(F?"DeviceAccess.enable":"DeviceAccess.disable")}catch(D){if((B=c(this,b))==null||B.call(this,r.LogType.debugError,D),x(this,S,!F),!A(this,C,EE).call(this,D))throw D}}}async toggleNetwork(){var W;const F=c(this,y).getInterceptionStages(this.topLevelId),B=Object.values(F).some(G=>G),D=c(this,k).request!==F.request||c(this,k).response!==F.response||c(this,k).auth!==F.auth;(W=c(this,b))==null||W.call(this,r.LogType.debugInfo,"Toggle Network",`Fetch (${B}) ${D}`),B&&D&&await A(this,C,W6).call(this,F),!B&&D&&await A(this,C,z6).call(this)}getChannels(){return c(this,p).find().flatMap(F=>F.channels)}get topLevelId(){return c(this,m).findTopLevelContextId(this.id)??this.id}isSubscribedTo(F){return c(this,f).subscriptionManager.isSubscribedTo(F,this.topLevelId)}},o=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,v=new WeakMap,b=new WeakMap,S=new WeakMap,P=new WeakMap,k=new WeakMap,C=new WeakSet,H6=async function(){var F;try{await Promise.all([c(this,u).sendCommand("Page.enable"),c(this,u).sendCommand("Page.getFrameTree").then(B=>A(this,C,AR).call(this,B.frameTree)),c(this,u).sendCommand("Runtime.enable"),c(this,u).sendCommand("Page.setLifecycleEventsEnabled",{enabled:!0}),c(this,u).sendCommand("Page.setPrerenderingAllowed",{isAllowed:!c(this,g)}).catch(()=>{}),c(this,u).sendCommand("Network.enable").then(()=>this.toggleNetworkIfNeeded()),c(this,u).sendCommand("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0}),A(this,C,V6).call(this),c(this,u).sendCommand("Runtime.runIfWaitingForDebugger"),c(this,d).sendCommand("Runtime.runIfWaitingForDebugger"),this.toggleDeviceAccessIfNeeded()])}catch(B){if((F=c(this,b))==null||F.call(this,r.LogType.debugError,"Failed to unblock target",B),!c(this,u).isCloseError(B)){c(this,w).resolve({kind:"error",error:B});return}}c(this,w).resolve({kind:"success",value:void 0})},AR=function(F){var W;const B=F.frame,D=c(this,m).findContext(B.id);if(D!==void 0&&D.parentId===null&&B.parentId!==null&&B.parentId!==void 0&&(D.parentId=B.parentId),D===void 0&&B.parentId!==void 0){const G=c(this,m).getContext(B.parentId);s.BrowsingContextImpl.create(B.id,B.parentId,G.userContext,G.cdpTarget,c(this,f),c(this,m),c(this,h),B.url,void 0,c(this,v),c(this,b))}(W=F.childFrames)==null||W.map(G=>A(this,C,AR).call(this,G))},EE=function(F){const B=F;return B.code===-32001&&B.message==="Session with given id not found."||c(this,u).isCloseError(F)},K6=function(){c(this,u).on("Network.requestWillBeSent",F=>{F.loaderId===F.requestId&&this.emit("frameStartedNavigating",{loaderId:F.loaderId,url:F.request.url,frameId:F.frameId})}),c(this,u).on("*",(F,B)=>{typeof F=="string"&&(c(this,f).registerEvent({type:"event",method:`goog:cdp.${F}`,params:{event:F,params:B,session:this.cdpSessionId}},this.id),c(this,f).registerEvent({type:"event",method:`cdp.${F}`,params:{event:F,params:B,session:this.cdpSessionId}},this.id))})},W6=async function(F){const B=[];if((F.request||F.auth)&&B.push({urlPattern:"*",requestStage:"Request"}),F.response&&B.push({urlPattern:"*",requestStage:"Response"}),B.length){const D=c(this,k);x(this,k,F);try{await c(this,u).sendCommand("Fetch.enable",{patterns:B,handleAuthRequests:F.auth})}catch{x(this,k,D)}}},z6=async function(){c(this,y).getRequestsByTarget(this).filter(B=>B.interceptPhase).length===0&&(x(this,k,{request:!1,response:!1,auth:!1}),await c(this,u).sendCommand("Fetch.disable"))},V6=async function(){await Promise.all(c(this,p).find({targetId:this.topLevelId,global:!0}).map(F=>F.initInTarget(this,!0)))},U);return Ny.CdpTarget=a,Ny}var j5;function Yce(){var a,o,u,l,d,h,f,p,m,g,y,w,v,b,S,kE,G6,Z6,J6,X6,Y6,CE,O,TR,Q6,e9,t9,j;if(j5)return Ty;j5=1,Object.defineProperty(Ty,"__esModule",{value:!0}),Ty.CdpTargetManager=void 0;const n=Ws(),e=M5(),t=Gce(),r=Xce(),s={service_worker:"service-worker",shared_worker:"shared-worker",worker:"dedicated-worker"};let i=(j=class{constructor(B,D,W,G,te,K,q,se,ke,he,et,fe,R){_(this,S);_(this,a);_(this,o);_(this,u,new Set);_(this,l);_(this,d);_(this,h);_(this,f);_(this,p);_(this,m);_(this,g);_(this,y);_(this,w);_(this,v);_(this,b);_(this,O,new Map);x(this,o,B),x(this,a,D),c(this,u).add(W),x(this,l,W),x(this,d,G),x(this,h,te),x(this,m,ke),x(this,f,q),x(this,p,se),x(this,g,K),x(this,y,he),x(this,b,et),x(this,v,fe),x(this,w,R),A(this,S,kE).call(this,D)}},a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,v=new WeakMap,b=new WeakMap,S=new WeakSet,kE=function(B){B.on("Target.attachedToTarget",D=>{A(this,S,X6).call(this,D,B)}),B.on("Target.detachedFromTarget",A(this,S,Q6).bind(this)),B.on("Target.targetInfoChanged",A(this,S,e9).bind(this)),B.on("Inspector.targetCrashed",()=>{A(this,S,t9).call(this,B)}),B.on("Page.frameAttached",A(this,S,G6).bind(this)),B.on("Page.frameDetached",A(this,S,Z6).bind(this)),B.on("Page.frameSubtreeWillBeDetached",A(this,S,J6).bind(this))},G6=function(B){const D=c(this,h).findContext(B.parentFrameId);D!==void 0&&e.BrowsingContextImpl.create(B.frameId,B.parentFrameId,D.userContext,D.cdpTarget,c(this,d),c(this,h),c(this,g),"about:blank",void 0,c(this,v),c(this,w))},Z6=function(B){var D;B.reason!=="swap"&&((D=c(this,h).findContext(B.frameId))==null||D.dispose(!0))},J6=function(B){var D;(D=c(this,h).findContext(B.frameId))==null||D.dispose(!0)},X6=function(B,D){const{sessionId:W,targetInfo:G}=B,te=c(this,o).getCdpClient(W),K=async()=>{await te.sendCommand("Runtime.runIfWaitingForDebugger").then(()=>D.sendCommand("Target.detachFromTarget",B)).catch(se=>{var ke;return(ke=c(this,w))==null?void 0:ke.call(this,n.LogType.debugError,se)})};if(c(this,l)===G.targetId){K();return}const q=G.type==="service_worker"?`${D.sessionId}_${G.targetId}`:G.targetId;if(!c(this,u).has(q)){switch(c(this,u).add(q),G.type){case"tab":A(this,S,kE).call(this,te),(async()=>await te.sendCommand("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0}))();return;case"page":case"iframe":{const se=A(this,S,CE).call(this,te,D,G),ke=c(this,h).findContext(G.targetId);if(ke&&G.type==="iframe")ke.updateCdpTarget(se);else{const he=A(this,S,Y6).call(this,G,D.sessionId),et=G.browserContextId&&G.browserContextId!==c(this,y)?G.browserContextId:"default";e.BrowsingContextImpl.create(G.targetId,he,et,se,c(this,d),c(this,h),c(this,g),G.url===""?"about:blank":G.url,G.openerFrameId??G.openerId,c(this,v),c(this,w))}return}case"service_worker":case"worker":{const se=c(this,g).findRealm({cdpSessionId:D.sessionId});if(!se){K();return}const ke=A(this,S,CE).call(this,te,D,G);A(this,S,TR).call(this,s[G.type],ke,se);return}case"shared_worker":{const se=A(this,S,CE).call(this,te,D,G);A(this,S,TR).call(this,s[G.type],se);return}}K()}},Y6=function(B,D){var G;if(B.type!=="iframe")return null;const W=B.openerFrameId??B.openerId;return W!==void 0?W:D!==void 0?((G=c(this,h).findContextBySession(D))==null?void 0:G.id)??null:null},CE=function(B,D,W){A(this,S,kE).call(this,B);const G=r.CdpTarget.create(W.targetId,B,c(this,a),D,c(this,g),c(this,d),c(this,m),c(this,h),c(this,f),c(this,b),c(this,v),c(this,w));return c(this,f).onCdpTargetCreated(G),c(this,p).onCdpTargetCreated(G),G},O=new WeakMap,TR=function(B,D,W){D.cdpClient.on("Runtime.executionContextCreated",G=>{const{uniqueId:te,id:K,origin:q}=G.context,se=new t.WorkerRealm(D.cdpClient,c(this,d),K,c(this,w),(0,e.serializeOrigin)(q),W?[W]:[],te,c(this,g),B);c(this,O).set(D.cdpSessionId,se)})},Q6=function({sessionId:B,targetId:D}){D&&c(this,m).find({targetId:D}).map(te=>{te.dispose(D)});const W=c(this,h).findContextBySession(B);if(W){W.dispose(!0);return}const G=c(this,O).get(B);G&&c(this,g).deleteRealms({cdpSessionId:G.cdpClient.sessionId})},e9=function(B){const D=c(this,h).findContext(B.targetInfo.targetId);D&&D.onTargetInfoChanged(B)},t9=function(B){const D=c(this,g).findRealms({cdpSessionId:B.sessionId});for(const W of D)W.dispose()},j);return Ty.CdpTargetManager=i,Ty}var jy={},D5;function Qce(){var r,s,i;if(D5)return jy;D5=1,Object.defineProperty(jy,"__esModule",{value:!0}),jy.BrowsingContextStorage=void 0;const n=Ht(),e=Kh();let t=(i=class{constructor(){_(this,r,new Map);_(this,s,new e.EventEmitter)}getTopLevelContexts(){return this.getAllContexts().filter(o=>o.isTopLevelContext())}getAllContexts(){return Array.from(c(this,r).values())}deleteContextById(o){c(this,r).delete(o)}deleteContext(o){c(this,r).delete(o.id)}addContext(o){c(this,r).set(o.id,o),c(this,s).emit("added",{browsingContext:o})}waitForContext(o){return c(this,r).has(o)?Promise.resolve(this.getContext(o)):new Promise(u=>{const l=d=>{d.browsingContext.id===o&&(c(this,s).off("added",l),u(d.browsingContext))};c(this,s).on("added",l)})}hasContext(o){return c(this,r).has(o)}findContext(o){return c(this,r).get(o)}findTopLevelContextId(o){if(o===null)return null;const u=this.findContext(o);if(!u)return null;const l=u.parentId??null;return l===null?o:this.findTopLevelContextId(l)}findContextBySession(o){for(const u of c(this,r).values())if(u.cdpTarget.cdpSessionId===o)return u}getContext(o){const u=this.findContext(o);if(u===void 0)throw new n.NoSuchFrameException(`Context ${o} not found`);return u}verifyTopLevelContextsList(o){const u=new Set;if(!o)return u;for(const l of o){const d=this.getContext(l);if(d.isTopLevelContext())u.add(d);else throw new n.InvalidArgumentException(`Non top-level context '${l}' given.`)}return u}},r=new WeakMap,s=new WeakMap,i);return jy.BrowsingContextStorage=t,jy}var Dy={},By={},Uy={},B5;function U5(){var e,t;if(B5)return Uy;B5=1,Object.defineProperty(Uy,"__esModule",{value:!0}),Uy.DefaultMap=void 0;let n=(t=class extends Map{constructor(i,a){super(a);_(this,e);x(this,e,i)}get(i){return this.has(i)||this.set(i,c(this,e).call(this,i)),super.get(i)}},e=new WeakMap,t);return Uy.DefaultMap=n,Uy}var q5;function eue(){var h,f,p,m,g,y,w,v,b,S,P,k,C,E,M,I,IR,r9,n9,s9,i9,j_,Rp,OR,a9,o9,c9,RR,Mp,Ao,PE,MR,$p,Np,Fp,AE,u9,l9,d9,h9,f9,p9,m9,TE,de,g9;if(q5)return By;q5=1;var n;Object.defineProperty(By,"__esModule",{value:!0}),By.NetworkRequest=void 0;const e=Ht(),t=Hu(),r=U5(),s=Ix(),i=Ws(),a=Ax(),o=new RegExp('(?<=realm=").*(?=")');let u=(h=class{constructor(z,re,ue,xe,Be=0,Ye){_(this,I);_(this,f);_(this,p);_(this,m);_(this,g,!1);_(this,y);_(this,w,{});_(this,v);_(this,b);_(this,S,{});_(this,P);_(this,k);_(this,C);_(this,E);_(this,M,{[e.ChromiumBidi.Network.EventNames.AuthRequired]:!1,[e.ChromiumBidi.Network.EventNames.BeforeRequestSent]:!1,[e.ChromiumBidi.Network.EventNames.FetchError]:!1,[e.ChromiumBidi.Network.EventNames.ResponseCompleted]:!1,[e.ChromiumBidi.Network.EventNames.ResponseStarted]:!1});J(this,"waitNextPhase",new s.Deferred);x(this,f,z),x(this,P,re),x(this,k,ue),x(this,C,xe),x(this,y,Be),x(this,E,Ye)}get id(){return c(this,f)}get fetchId(){return c(this,p)}get interceptPhase(){return c(this,m)}get url(){var ue,xe,Be,Ye,Dt,Bt,is,Kr;const z=((ue=c(this,w).info)==null?void 0:ue.request.urlFragment)??((xe=c(this,w).paused)==null?void 0:xe.request.urlFragment)??"";return`${((Be=c(this,S).paused)==null?void 0:Be.request.url)??((Ye=c(this,v))==null?void 0:Ye.url)??((Dt=c(this,S).info)==null?void 0:Dt.url)??((Bt=c(this,w).auth)==null?void 0:Bt.request.url)??((is=c(this,w).info)==null?void 0:is.request.url)??((Kr=c(this,w).paused)==null?void 0:Kr.request.url)??n.unknownParameter}${z}`}get redirectCount(){return c(this,y)}get cdpTarget(){return c(this,C)}get cdpClient(){return c(this,C).cdpClient}isRedirecting(){return!!c(this,w).info}handleRedirect(z){c(this,S).hasExtraInfo=!1,c(this,S).info=z.redirectResponse,A(this,I,Ao).call(this,{wasRedirected:!0})}onRequestWillBeSentEvent(z){c(this,w).info=z,A(this,I,Ao).call(this)}onRequestWillBeSentExtraInfoEvent(z){c(this,w).extraInfo=z,A(this,I,Ao).call(this)}onResponseReceivedExtraInfoEvent(z){z.statusCode>=300&&z.statusCode<=399&&c(this,w).info&&z.headers.location===c(this,w).info.request.url||(c(this,S).extraInfo=z,A(this,I,Ao).call(this))}onResponseReceivedEvent(z){c(this,S).hasExtraInfo=z.hasExtraInfo,c(this,S).info=z.response,A(this,I,Ao).call(this)}onServedFromCache(){x(this,g,!0),A(this,I,Ao).call(this)}onLoadingFailedEvent(z){A(this,I,Ao).call(this,{hasFailed:!0}),A(this,I,Np).call(this,()=>({method:e.ChromiumBidi.Network.EventNames.FetchError,params:{...A(this,I,Fp).call(this),errorText:z.errorText}}))}async failRequest(z){(0,t.assert)(c(this,p),"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.failRequest",{requestId:c(this,p),errorReason:z}),x(this,m,void 0)}onRequestPaused(z){x(this,p,z.requestId),z.responseStatusCode||z.responseErrorReason?(c(this,S).paused=z,A(this,I,Mp).call(this,"responseStarted")&&!c(this,M)[e.ChromiumBidi.Network.EventNames.ResponseStarted]&&c(this,p)!==this.id?x(this,m,"responseStarted"):A(this,I,MR).call(this)):(c(this,w).paused=z,A(this,I,Mp).call(this,"beforeRequestSent")&&!c(this,M)[e.ChromiumBidi.Network.EventNames.BeforeRequestSent]&&c(this,p)!==this.id?x(this,m,"beforeRequestSent"):A(this,I,PE).call(this)),A(this,I,Ao).call(this)}onAuthRequired(z){x(this,p,z.requestId),c(this,w).auth=z,A(this,I,Mp).call(this,"authRequired")&&c(this,p)!==this.id?x(this,m,"authRequired"):A(this,I,$p).call(this,{response:"Default"}),A(this,I,Np).call(this,()=>({method:e.ChromiumBidi.Network.EventNames.AuthRequired,params:{...A(this,I,Fp).call(this,"authRequired"),response:A(this,I,AE).call(this)}}))}async continueRequest(z={}){const re=A(this,I,TE).call(this,z.headers,z.cookies),ue=(0,a.cdpFetchHeadersFromBidiNetworkHeaders)(re),xe=l(z.body);await A(this,I,PE).call(this,{url:z.url,method:z.method,headers:ue,postData:xe}),x(this,v,{url:z.url,method:z.method,headers:z.headers,cookies:z.cookies,bodySize:d(z.body)})}async continueResponse(z={}){var re,ue,xe;if(this.interceptPhase==="authRequired")if(z.credentials)await Promise.all([this.waitNextPhase,await A(this,I,$p).call(this,{response:"ProvideCredentials",username:z.credentials.username,password:z.credentials.password})]);else return await A(this,I,$p).call(this,{response:"ProvideCredentials"});if(c(this,m)==="responseStarted"){const Be=A(this,I,TE).call(this,z.headers,z.cookies),Ye=(0,a.cdpFetchHeadersFromBidiNetworkHeaders)(Be);await A(this,I,MR).call(this,{responseCode:z.statusCode??((re=c(this,S).paused)==null?void 0:re.responseStatusCode),responsePhrase:z.reasonPhrase??((ue=c(this,S).paused)==null?void 0:ue.responseStatusText),responseHeaders:Ye??((xe=c(this,S).paused)==null?void 0:xe.responseHeaders)}),x(this,b,{statusCode:z.statusCode,headers:Be})}}async continueWithAuth(z){let re,ue;if(z.action==="provideCredentials"){const{credentials:Be}=z;re=Be.username,ue=Be.password}const xe=(0,a.cdpAuthChallengeResponseFromBidiAuthContinueWithAuthAction)(z.action);await A(this,I,$p).call(this,{response:xe,username:re,password:ue})}async provideResponse(z){if((0,t.assert)(c(this,p),"Network Interception not set-up."),this.interceptPhase==="authRequired")return await A(this,I,$p).call(this,{response:"ProvideCredentials"});if(!z.body&&!z.headers)return await A(this,I,PE).call(this);const re=A(this,I,TE).call(this,z.headers,z.cookies),ue=(0,a.cdpFetchHeadersFromBidiNetworkHeaders)(re),xe=z.statusCode??c(this,I,Rp)??200;await this.cdpClient.sendCommand("Fetch.fulfillRequest",{requestId:c(this,p),responseCode:xe,responsePhrase:z.reasonPhrase,responseHeaders:ue,body:l(z.body)}),x(this,m,void 0)}dispose(){this.waitNextPhase.reject(new Error("waitNextPhase disposed"))}},f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,v=new WeakMap,b=new WeakMap,S=new WeakMap,P=new WeakMap,k=new WeakMap,C=new WeakMap,E=new WeakMap,M=new WeakMap,I=new WeakSet,IR=function(){return this.url.startsWith("data:")},r9=function(){var z,re,ue,xe,Be;return((z=c(this,v))==null?void 0:z.method)??((re=c(this,w).info)==null?void 0:re.request.method)??((ue=c(this,w).paused)==null?void 0:ue.request.method)??((xe=c(this,w).auth)==null?void 0:xe.request.method)??((Be=c(this,S).paused)==null?void 0:Be.request.method)},n9=function(){return!c(this,w).info||!c(this,w).info.loaderId||c(this,w).info.loaderId!==c(this,w).info.requestId?null:c(this,k).getNavigationId(c(this,I,j_)??void 0)},s9=function(){let z=[];return c(this,w).extraInfo&&(z=c(this,w).extraInfo.associatedCookies.filter(({blockedReasons:re})=>!Array.isArray(re)||re.length===0).map(({cookie:re})=>(0,a.cdpToBiDiCookie)(re))),z},i9=function(){var re,ue;let z=0;return typeof((re=c(this,v))==null?void 0:re.bodySize)=="number"?z=c(this,v).bodySize:z=(0,a.bidiBodySizeFromCdpPostDataEntries)(((ue=c(this,w).info)==null?void 0:ue.request.postDataEntries)??[]),z},j_=function(){var z,re,ue,xe;return((z=c(this,S).paused)==null?void 0:z.frameId)??((re=c(this,w).info)==null?void 0:re.frameId)??((ue=c(this,w).paused)==null?void 0:ue.frameId)??((xe=c(this,w).auth)==null?void 0:xe.frameId)??null},Rp=function(){var z,re,ue,xe;return((z=c(this,b))==null?void 0:z.statusCode)??((re=c(this,S).paused)==null?void 0:re.responseStatusCode)??((ue=c(this,S).extraInfo)==null?void 0:ue.statusCode)??((xe=c(this,S).info)==null?void 0:xe.status)},OR=function(){var re,ue,xe;let z=[];if((re=c(this,v))!=null&&re.headers){const Be=new r.DefaultMap(()=>[]);for(const Ye of c(this,v).headers)Be.get(Ye.name).push(Ye.value.value);for(const[Ye,Dt]of Be.entries())z.push({name:Ye,value:{type:"string",value:Dt.join(`
`).trimEnd()}})}else z=[...(0,a.bidiNetworkHeadersFromCdpNetworkHeaders)((ue=c(this,w).info)==null?void 0:ue.request.headers),...(0,a.bidiNetworkHeadersFromCdpNetworkHeaders)((xe=c(this,w).extraInfo)==null?void 0:xe.headers)];return z},a9=function(){var ue;if(!c(this,S).info||!(c(this,I,Rp)===401||c(this,I,Rp)===407))return;const z=c(this,I,Rp)===401?"WWW-Authenticate":"Proxy-Authenticate",re=[];for(const[xe,Be]of Object.entries(c(this,S).info.headers))xe.localeCompare(z,void 0,{sensitivity:"base"})===0&&re.push({scheme:Be.split(" ").at(0)??"",realm:((ue=Be.match(o))==null?void 0:ue.at(0))??""});return re},o9=function(){var re,ue,xe,Be,Ye,Dt,Bt,is,Kr,Po,k_,C_,P_,A_,RH,MH,$H,NH,FH,LH,jH,DH;const z=(0,a.getTiming)((0,a.getTiming)((ue=(re=c(this,S).info)==null?void 0:re.timing)==null?void 0:ue.requestTime)-(0,a.getTiming)((xe=c(this,w).info)==null?void 0:xe.timestamp));return{timeOrigin:Math.round((0,a.getTiming)((Be=c(this,w).info)==null?void 0:Be.wallTime)*1e3),requestTime:0,redirectStart:0,redirectEnd:0,fetchStart:(0,a.getTiming)((Dt=(Ye=c(this,S).info)==null?void 0:Ye.timing)==null?void 0:Dt.workerFetchStart,z),dnsStart:(0,a.getTiming)((is=(Bt=c(this,S).info)==null?void 0:Bt.timing)==null?void 0:is.dnsStart,z),dnsEnd:(0,a.getTiming)((Po=(Kr=c(this,S).info)==null?void 0:Kr.timing)==null?void 0:Po.dnsEnd,z),connectStart:(0,a.getTiming)((C_=(k_=c(this,S).info)==null?void 0:k_.timing)==null?void 0:C_.connectStart,z),connectEnd:(0,a.getTiming)((A_=(P_=c(this,S).info)==null?void 0:P_.timing)==null?void 0:A_.connectEnd,z),tlsStart:(0,a.getTiming)((MH=(RH=c(this,S).info)==null?void 0:RH.timing)==null?void 0:MH.sslStart,z),requestStart:(0,a.getTiming)((NH=($H=c(this,S).info)==null?void 0:$H.timing)==null?void 0:NH.sendStart,z),responseStart:(0,a.getTiming)((LH=(FH=c(this,S).info)==null?void 0:FH.timing)==null?void 0:LH.receiveHeadersStart,z),responseEnd:(0,a.getTiming)((DH=(jH=c(this,S).info)==null?void 0:jH.timing)==null?void 0:DH.receiveHeadersEnd,z)}},c9=function(){this.waitNextPhase.resolve(),this.waitNextPhase=new s.Deferred},RR=function(z){return c(this,C).isSubscribedTo(`network.${z}`)?c(this,k).getInterceptsForPhase(this,z):new Set},Mp=function(z){return A(this,I,RR).call(this,z).size>0},Ao=function(z={}){const re=z.wasRedirected||z.hasFailed||A(this,I,IR).call(this)||!!c(this,w).extraInfo||c(this,g)||!!(c(this,S).info&&!c(this,S).hasExtraInfo),ue=A(this,I,IR).call(this)||c(this,g),xe=!ue&&A(this,I,Mp).call(this,"beforeRequestSent"),Be=!xe||xe&&!!c(this,w).paused;c(this,w).info&&(xe?Be:re)&&A(this,I,Np).call(this,A(this,I,h9).bind(this));const Ye=!!c(this,S).extraInfo||c(this,g)||!!(c(this,S).info&&!c(this,S).hasExtraInfo),Dt=!ue&&A(this,I,Mp).call(this,"responseStarted");(c(this,S).info||Dt&&c(this,S).paused)&&A(this,I,Np).call(this,A(this,I,f9).bind(this));const Bt=!Dt||Dt&&!!c(this,S).paused;c(this,S).info&&Ye&&Bt&&(A(this,I,Np).call(this,A(this,I,p9).bind(this)),c(this,k).deleteRequest(this.id))},PE=async function(z={}){(0,t.assert)(c(this,p),"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.continueRequest",{requestId:c(this,p),url:z.url,method:z.method,headers:z.headers,postData:z.postData}),x(this,m,void 0)},MR=async function({responseCode:z,responsePhrase:re,responseHeaders:ue}={}){(0,t.assert)(c(this,p),"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.continueResponse",{requestId:c(this,p),responseCode:z,responsePhrase:re,responseHeaders:ue}),x(this,m,void 0)},$p=async function(z){(0,t.assert)(c(this,p),"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.continueWithAuth",{requestId:c(this,p),authChallengeResponse:z}),x(this,m,void 0)},Np=function(z){var ue;let re;try{re=z()}catch(xe){(ue=c(this,E))==null||ue.call(this,i.LogType.debugError,xe);return}A(this,I,m9).call(this)||c(this,M)[re.method]&&re.method!==e.ChromiumBidi.Network.EventNames.AuthRequired||(A(this,I,c9).call(this),c(this,M)[re.method]=!0,c(this,I,j_)?c(this,P).registerEvent(Object.assign(re,{type:"event"}),c(this,I,j_)):c(this,P).registerGlobalEvent(Object.assign(re,{type:"event"})))},Fp=function(z){var ue;const re={isBlocked:!1};if(z){const xe=A(this,I,RR).call(this,z);re.isBlocked=xe.size>0,re.isBlocked&&(re.intercepts=[...xe])}return{context:c(this,I,j_),navigation:c(this,I,n9),redirectCount:c(this,y),request:A(this,I,u9).call(this),timestamp:Math.round((0,a.getTiming)((ue=c(this,w).info)==null?void 0:ue.wallTime)*1e3),...re}},AE=function(){var xe,Be,Ye,Dt,Bt,is,Kr,Po,k_,C_,P_,A_;(xe=c(this,S).info)!=null&&xe.fromDiskCache&&(c(this,S).extraInfo=void 0);const z=[...(0,a.bidiNetworkHeadersFromCdpNetworkHeaders)((Be=c(this,S).info)==null?void 0:Be.headers),...(0,a.bidiNetworkHeadersFromCdpNetworkHeaders)((Ye=c(this,S).extraInfo)==null?void 0:Ye.headers)],re=c(this,I,a9);return{...{url:this.url,protocol:((Dt=c(this,S).info)==null?void 0:Dt.protocol)??"",status:c(this,I,Rp)??-1,statusText:((Bt=c(this,S).info)==null?void 0:Bt.statusText)||((is=c(this,S).paused)==null?void 0:is.responseStatusText)||"",fromCache:((Kr=c(this,S).info)==null?void 0:Kr.fromDiskCache)||((Po=c(this,S).info)==null?void 0:Po.fromPrefetchCache)||c(this,g),headers:((k_=c(this,b))==null?void 0:k_.headers)??z,mimeType:((C_=c(this,S).info)==null?void 0:C_.mimeType)||"",bytesReceived:((P_=c(this,S).info)==null?void 0:P_.encodedDataLength)||0,headersSize:(0,a.computeHeadersSize)(z),bodySize:0,content:{size:0},...re?{authChallenges:re}:{}},"goog:securityDetails":(A_=c(this,S).info)==null?void 0:A_.securityDetails}},u9=function(){var ue,xe,Be,Ye,Dt,Bt;const z=c(this,I,OR);return{...{request:c(this,f),url:this.url,method:c(this,I,r9)??n.unknownParameter,headers:z,cookies:c(this,I,s9),headersSize:(0,a.computeHeadersSize)(z),bodySize:c(this,I,i9),destination:A(this,I,l9).call(this),initiatorType:A(this,I,d9).call(this),timings:c(this,I,o9)},"goog:postData":(xe=(ue=c(this,w).info)==null?void 0:ue.request)==null?void 0:xe.postData,"goog:hasPostData":(Ye=(Be=c(this,w).info)==null?void 0:Be.request)==null?void 0:Ye.hasPostData,"goog:resourceType":(Dt=c(this,w).info)==null?void 0:Dt.type,"goog:resourceInitiator":(Bt=c(this,w).info)==null?void 0:Bt.initiator}},l9=function(){var z,re;switch((z=c(this,w).info)==null?void 0:z.type){case"Script":return"script";case"Stylesheet":return"style";case"Image":return"image";case"Document":return((re=c(this,w).info)==null?void 0:re.initiator.type)==="parser"?"iframe":"";default:return""}},d9=function(){var z,re,ue,xe,Be,Ye,Dt,Bt,is,Kr;if(((z=c(this,w).info)==null?void 0:z.initiator.type)==="parser")switch((re=c(this,w).info)==null?void 0:re.type){case"Document":return"iframe";case"Font":return((xe=(ue=c(this,w).info)==null?void 0:ue.initiator)==null?void 0:xe.url)===((Be=c(this,w).info)==null?void 0:Be.documentURL)?"font":"css";case"Image":return((Dt=(Ye=c(this,w).info)==null?void 0:Ye.initiator)==null?void 0:Dt.url)===((Bt=c(this,w).info)==null?void 0:Bt.documentURL)?"img":"css";case"Script":return"script";case"Stylesheet":return"link";default:return null}return((Kr=(is=c(this,w))==null?void 0:is.info)==null?void 0:Kr.type)==="Fetch"?"fetch":null},h9=function(){var z;return(0,t.assert)(c(this,w).info,"RequestWillBeSentEvent is not set"),{method:e.ChromiumBidi.Network.EventNames.BeforeRequestSent,params:{...A(this,I,Fp).call(this,"beforeRequestSent"),initiator:{type:A(z=n,de,g9).call(z,c(this,w).info.initiator.type),columnNumber:c(this,w).info.initiator.columnNumber,lineNumber:c(this,w).info.initiator.lineNumber,stackTrace:c(this,w).info.initiator.stack,request:c(this,w).info.initiator.requestId}}}},f9=function(){return{method:e.ChromiumBidi.Network.EventNames.ResponseStarted,params:{...A(this,I,Fp).call(this,"responseStarted"),response:A(this,I,AE).call(this)}}},p9=function(){return{method:e.ChromiumBidi.Network.EventNames.ResponseCompleted,params:{...A(this,I,Fp).call(this),response:A(this,I,AE).call(this)}}},m9=function(){var re,ue;const z="/favicon.ico";return((re=c(this,w).paused)==null?void 0:re.request.url.endsWith(z))??((ue=c(this,w).info)==null?void 0:ue.request.url.endsWith(z))??!1},TE=function(z,re){if(!z&&!re)return;let ue=z;const xe=(0,a.networkHeaderFromCookieHeaders)(re);return xe&&!ue&&(ue=c(this,I,OR)),xe&&ue&&(ue.filter(Be=>Be.name.localeCompare("cookie",void 0,{sensitivity:"base"})!==0),ue.push(xe)),ue},de=new WeakSet,g9=function(z){switch(z){case"parser":case"script":case"preflight":return z;default:return"other"}},_(h,de),J(h,"unknownParameter","UNKNOWN"),h);By.NetworkRequest=u,n=u;function l(Pe){let z;return(Pe==null?void 0:Pe.type)==="string"?z=btoa(Pe.value):(Pe==null?void 0:Pe.type)==="base64"&&(z=Pe.value),z}function d(Pe){return(Pe==null?void 0:Pe.type)==="string"?Pe.value.length:(Pe==null?void 0:Pe.type)==="base64"?atob(Pe.value).length:0}return By}var H5;function tue(){var i,a,o,u,l,d,h,xa,p;if(H5)return Dy;H5=1,Object.defineProperty(Dy,"__esModule",{value:!0}),Dy.NetworkStorage=void 0;const n=Ht(),e=zh(),t=eue(),r=Ax();let s=(p=class{constructor(g,y,w,v){_(this,h);_(this,i);_(this,a);_(this,o);_(this,u,new Map);_(this,l,new Map);_(this,d,"default");x(this,i,y),x(this,a,g),w.on("Target.detachedFromTarget",({sessionId:b})=>{this.disposeRequestMap(b)}),x(this,o,v)}onCdpTargetCreated(g){const y=g.cdpClient,w=[["Network.requestWillBeSent",v=>{const b=this.getRequestById(v.requestId);b&&b.isRedirecting()?(b.handleRedirect(v),this.deleteRequest(v.requestId),A(this,h,xa).call(this,v.requestId,g,b.redirectCount+1).onRequestWillBeSentEvent(v)):A(this,h,xa).call(this,v.requestId,g).onRequestWillBeSentEvent(v)}],["Network.requestWillBeSentExtraInfo",v=>{A(this,h,xa).call(this,v.requestId,g).onRequestWillBeSentExtraInfoEvent(v)}],["Network.responseReceived",v=>{A(this,h,xa).call(this,v.requestId,g).onResponseReceivedEvent(v)}],["Network.responseReceivedExtraInfo",v=>{A(this,h,xa).call(this,v.requestId,g).onResponseReceivedExtraInfoEvent(v)}],["Network.requestServedFromCache",v=>{A(this,h,xa).call(this,v.requestId,g).onServedFromCache()}],["Network.loadingFailed",v=>{A(this,h,xa).call(this,v.requestId,g).onLoadingFailedEvent(v)}],["Fetch.requestPaused",v=>{A(this,h,xa).call(this,v.networkId??v.requestId,g).onRequestPaused(v)}],["Fetch.authRequired",v=>{let b=this.getRequestByFetchId(v.requestId);b||(b=A(this,h,xa).call(this,v.requestId,g)),b.onAuthRequired(v)}]];for(const[v,b]of w)y.on(v,b)}getInterceptionStages(g){const y={request:!1,response:!1,auth:!1};for(const w of c(this,l).values())w.contexts&&!w.contexts.includes(g)||(y.request||(y.request=w.phases.includes("beforeRequestSent")),y.response||(y.response=w.phases.includes("responseStarted")),y.auth||(y.auth=w.phases.includes("authRequired")));return y}getInterceptsForPhase(g,y){if(g.url===t.NetworkRequest.unknownParameter)return new Set;const w=new Set;for(const[v,b]of c(this,l).entries())if(!(!b.phases.includes(y)||b.contexts&&!b.contexts.includes(g.cdpTarget.topLevelId))){if(b.urlPatterns.length===0){w.add(v);continue}for(const S of b.urlPatterns)if((0,r.matchUrlPattern)(S,g.url)){w.add(v);break}}return w}disposeRequestMap(g){for(const y of c(this,u).values())y.cdpClient.sessionId===g&&(c(this,u).delete(y.id),y.dispose())}addIntercept(g){const y=(0,e.uuidv4)();return c(this,l).set(y,g),y}removeIntercept(g){if(!c(this,l).has(g))throw new n.NoSuchInterceptException(`Intercept '${g}' does not exist.`);c(this,l).delete(g)}getRequestsByTarget(g){const y=[];for(const w of c(this,u).values())w.cdpTarget===g&&y.push(w);return y}getRequestById(g){return c(this,u).get(g)}getRequestByFetchId(g){for(const y of c(this,u).values())if(y.fetchId===g)return y}addRequest(g){c(this,u).set(g.id,g)}deleteRequest(g){c(this,u).delete(g)}getNavigationId(g){var y;return g===void 0?null:((y=c(this,i).findContext(g))==null?void 0:y.navigationId)??null}set defaultCacheBehavior(g){x(this,d,g)}get defaultCacheBehavior(){return c(this,d)}},i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakSet,xa=function(g,y,w){let v=this.getRequestById(g);return v||(v=new t.NetworkRequest(g,c(this,a),this,y,w,c(this,o)),this.addRequest(v),v)},p);return Dy.NetworkStorage=s,Dy}var qy={},K5;function rue(){var e,t;if(K5)return qy;K5=1,Object.defineProperty(qy,"__esModule",{value:!0}),qy.PreloadScriptStorage=void 0;let n=(t=class{constructor(){_(this,e,new Set)}find(s){return s?[...c(this,e)].filter(i=>!!(s.id!==void 0&&s.id===i.id||s.targetId!==void 0&&i.targetIds.has(s.targetId)||s.global!==void 0&&(s.global&&i.contexts===void 0||!s.global&&i.contexts!==void 0))):[...c(this,e)]}add(s){c(this,e).add(s)}remove(s){for(const i of this.find(s))c(this,e).delete(i)}},e=new WeakMap,t);return qy.PreloadScriptStorage=n,qy}var Hy={},W5;function nue(){var r,s,i;if(W5)return Hy;W5=1,Object.defineProperty(Hy,"__esModule",{value:!0}),Hy.RealmStorage=void 0;const n=Ht(),e=T5();let t=(i=class{constructor(){_(this,r,new Map);_(this,s,new Map)}get knownHandlesToRealmMap(){return c(this,r)}addRealm(o){c(this,s).set(o.realmId,o)}findRealms(o){return Array.from(c(this,s).values()).filter(u=>!(o.realmId!==void 0&&o.realmId!==u.realmId||o.browsingContextId!==void 0&&!u.associatedBrowsingContexts.map(l=>l.id).includes(o.browsingContextId)||o.sandbox!==void 0&&(!(u instanceof e.WindowRealm)||o.sandbox!==u.sandbox)||o.executionContextId!==void 0&&o.executionContextId!==u.executionContextId||o.origin!==void 0&&o.origin!==u.origin||o.type!==void 0&&o.type!==u.realmType||o.cdpSessionId!==void 0&&o.cdpSessionId!==u.cdpClient.sessionId))}findRealm(o){const u=this.findRealms(o);if(u.length===1)return u[0]}getRealm(o){const u=this.findRealm(o);if(u===void 0)throw new n.NoSuchFrameException(`Realm ${JSON.stringify(o)} not found`);return u}deleteRealms(o){this.findRealms(o).map(u=>{u.dispose(),c(this,s).delete(u.realmId),Array.from(this.knownHandlesToRealmMap.entries()).filter(([,l])=>l===u.realmId).map(([l])=>this.knownHandlesToRealmMap.delete(l))})}},r=new WeakMap,s=new WeakMap,i);return Hy.RealmStorage=t,Hy}var Ky={},Wy={},z5;function sue(){var e,t,r;if(z5)return Wy;z5=1,Object.defineProperty(Wy,"__esModule",{value:!0}),Wy.Buffer=void 0;class n{constructor(i,a){_(this,e);_(this,t,[]);_(this,r);x(this,e,i),x(this,r,a)}get(){return c(this,t)}add(i){var a;for(c(this,t).push(i);c(this,t).length>c(this,e);){const o=c(this,t).shift();o!==void 0&&((a=c(this,r))==null||a.call(this,o))}}}return e=new WeakMap,t=new WeakMap,r=new WeakMap,Wy.Buffer=n,Wy}var zy={},V5;function iue(){var e,t,r;if(V5)return zy;V5=1,Object.defineProperty(zy,"__esModule",{value:!0}),zy.IdWrapper=void 0;let n=(e=class{constructor(){_(this,r);x(this,r,++Ap(e,t)._)}get id(){return c(this,r)}},t=new WeakMap,r=new WeakMap,_(e,t,0),e);return zy.IdWrapper=n,zy}var Gh={},G5;function aue(){if(G5)return Gh;G5=1,Object.defineProperty(Gh,"__esModule",{value:!0}),Gh.isCdpEvent=e,Gh.isDeprecatedCdpEvent=t,Gh.assertSupportedEvent=r;const n=Ht();function e(s){var i;return((i=s.split(".").at(0))==null?void 0:i.startsWith(n.ChromiumBidi.BiDiModule.Cdp))??!1}function t(s){var i;return((i=s.split(".").at(0))==null?void 0:i.startsWith(n.ChromiumBidi.BiDiModule.DeprecatedCdp))??!1}function r(s){if(!n.ChromiumBidi.EVENT_NAMES.has(s)&&!e(s)&&!t(s))throw new n.InvalidArgumentException(`Unknown event: ${s}`)}return Gh}var uc={},Z5;function oue(){var u,l,d,IE,f;if(Z5)return uc;Z5=1,Object.defineProperty(uc,"__esModule",{value:!0}),uc.SubscriptionManager=void 0,uc.cartesianProduct=t,uc.unrollEvents=r,uc.difference=a;const n=Ht(),e=zh();function t(...p){return p.reduce((m,g)=>m.flatMap(y=>g.map(w=>[y,w].flat())))}function r(p){const m=new Set;function g(y){for(const w of y)m.add(w)}for(const y of p)switch(y){case n.ChromiumBidi.BiDiModule.Bluetooth:g(Object.values(n.ChromiumBidi.Bluetooth.EventNames));break;case n.ChromiumBidi.BiDiModule.BrowsingContext:g(Object.values(n.ChromiumBidi.BrowsingContext.EventNames));break;case n.ChromiumBidi.BiDiModule.Log:g(Object.values(n.ChromiumBidi.Log.EventNames));break;case n.ChromiumBidi.BiDiModule.Network:g(Object.values(n.ChromiumBidi.Network.EventNames));break;case n.ChromiumBidi.BiDiModule.Script:g(Object.values(n.ChromiumBidi.Script.EventNames));break;default:m.add(y)}return[...m.values()]}let s=(f=class{constructor(m){_(this,d);_(this,u,[]);_(this,l);x(this,l,m)}getChannelsSubscribedToEvent(m,g){const y=new Map;for(const w of c(this,u))A(this,d,IE).call(this,w,m,g)&&y.set(JSON.stringify(w.channel),w.channel);return Array.from(y.values())}getChannelsSubscribedToEventGlobally(m){const g=new Map;for(const y of c(this,u))A(this,d,IE).call(this,y,m)&&g.set(JSON.stringify(y.channel),y.channel);return Array.from(g.values())}isSubscribedTo(m,g){for(const y of c(this,u))if(A(this,d,IE).call(this,y,m,g))return!0;return!1}subscribe(m,g,y){const w={id:(0,e.uuidv4)(),eventNames:new Set(r(m)),topLevelTraversableIds:new Set(g.map(v=>{const b=c(this,l).findTopLevelContextId(v);if(!b)throw new n.NoSuchFrameException(`Top-level navigable not found for context id ${v}`);return b})),channel:y};return c(this,u).push(w),w}unsubscribe(m,g,y){const w=new Set(r(m));for(const C of g)c(this,l).getContext(C);const v=new Set(g.map(C=>{const E=c(this,l).findTopLevelContextId(C);if(!E)throw new n.NoSuchFrameException(`Top-level navigable not found for context id ${C}`);return E})),b=v.size===0,S=[],P=new Set,k=new Set;for(const C of c(this,u)){if(JSON.stringify(C.channel)!==JSON.stringify(y)){S.push(C);continue}if(i(C.eventNames,w).size===0){S.push(C);continue}if(b){if(C.topLevelTraversableIds.size!==0){S.push(C);continue}const E=new Set(C.eventNames);for(const M of w)E.has(M)&&(P.add(M),E.delete(M));E.size!==0&&S.push({...C,eventNames:E})}else{if(C.topLevelTraversableIds.size===0){S.push(C);continue}const E=new Map;for(const M of C.eventNames)E.set(M,new Set(C.topLevelTraversableIds));for(const M of w){const I=E.get(M);if(I){for(const N of v)I.has(N)&&(k.add(N),P.add(M),I.delete(N));I.size===0&&E.delete(M)}}for(const[M,I]of E){const N={id:C.id,channel:C.channel,eventNames:new Set([M]),topLevelTraversableIds:I};S.push(N)}}}if(!o(P,w))throw new n.InvalidArgumentException("No subscription found");if(!b&&!o(k,v))throw new n.InvalidArgumentException("No subscription found");x(this,u,S)}unsubscribeById(m){}},u=new WeakMap,l=new WeakMap,d=new WeakSet,IE=function(m,g,y){let w=!1;for(const b of m.eventNames)if(b===g||b===g.split(".").at(0)||b.split(".").at(0)===g){w=!0;break}if(!w)return!1;if(m.topLevelTraversableIds.size===0)return!0;const v=y?c(this,l).findTopLevelContextId(y):null;return!!(v!==null&&m.topLevelTraversableIds.has(v))},f);uc.SubscriptionManager=s;function i(p,m){const g=new Set;for(const y of p)m.has(y)&&g.add(y);return g}function a(p,m){const g=new Set;for(const y of p)m.has(y)||g.add(y);return g}function o(p,m){if(p.size!==m.size)return!1;for(const g of p)if(!m.has(g))return!1;return!0}return uc}var J5;function cue(){var f,p,m,g,y,w,v,b,S,P,k,D_,E,$R,OE,NR;if(J5)return Ky;J5=1;var n;Object.defineProperty(Ky,"__esModule",{value:!0}),Ky.EventManager=void 0;const e=Ht(),t=sue(),r=U5(),s=Kh(),i=iue(),a=kI(),o=aue(),u=oue();class l{constructor(T,L){_(this,f,new i.IdWrapper);_(this,p);_(this,m);x(this,m,T),x(this,p,L)}get id(){return c(this,f).id}get contextId(){return c(this,p)}get event(){return c(this,m)}}f=new WeakMap,p=new WeakMap,m=new WeakMap;const d=new Map([[e.ChromiumBidi.Log.EventNames.LogEntryAdded,100]]);let h=(k=class extends s.EventEmitter{constructor(L){super();_(this,E);_(this,g,new r.DefaultMap(()=>new Set));_(this,y,new Map);_(this,w,new Map);_(this,v);_(this,b);_(this,S);x(this,b,L),x(this,v,new u.SubscriptionManager(L)),x(this,S,new r.DefaultMap(()=>[]))}get subscriptionManager(){return c(this,v)}addSubscribeHook(L,U){c(this,S).get(L).push(U)}registerEvent(L,U){this.registerPromiseEvent(Promise.resolve({kind:"success",value:L}),U,L.method)}registerGlobalEvent(L){this.registerGlobalPromiseEvent(Promise.resolve({kind:"success",value:L}),L.method)}registerPromiseEvent(L,U,Z){const j=new l(L,U),F=c(this,v).getChannelsSubscribedToEvent(Z,U);A(this,E,$R).call(this,j,Z);for(const B of F)this.emit("event",{message:a.OutgoingMessage.createFromPromise(L,B),event:Z}),A(this,E,OE).call(this,j,B,Z)}registerGlobalPromiseEvent(L,U){const Z=new l(L,null),j=c(this,v).getChannelsSubscribedToEventGlobally(U);A(this,E,$R).call(this,Z,U);for(const F of j)this.emit("event",{message:a.OutgoingMessage.createFromPromise(L,F),event:U}),A(this,E,OE).call(this,Z,F,U)}async subscribe(L,U,Z){for(const W of L)(0,o.assertSupportedEvent)(W);for(const W of U)W!==null&&c(this,b).getContext(W);const j=new Set((0,u.unrollEvents)(L)),F=new Map,B=new Set(U.length?U.map(W=>{const G=c(this,b).findTopLevelContextId(W);if(!G)throw new e.InvalidArgumentException("Invalid context id");return G}):c(this,b).getTopLevelContexts().map(W=>W.id));for(const W of j){const G=new Set(c(this,b).getTopLevelContexts().map(te=>te.id).filter(te=>c(this,v).isSubscribedTo(W,te)));F.set(W,(0,u.difference)(B,G))}const D=c(this,v).subscribe(L,U,Z);for(const W of D.eventNames)for(const G of B)for(const te of A(this,E,NR).call(this,W,G,Z))this.emit("event",{message:a.OutgoingMessage.createFromPromise(te.event,Z),event:W}),A(this,E,OE).call(this,te,Z,W);for(const[W,G]of F)for(const te of G)c(this,S).get(W).forEach(K=>K(te));return await this.toggleModulesIfNeeded(),D.id}async unsubscribe(L,U,Z){for(const j of L)(0,o.assertSupportedEvent)(j);c(this,v).unsubscribe(L,U,Z),await this.toggleModulesIfNeeded()}async toggleModulesIfNeeded(){await Promise.all(c(this,b).getAllContexts().map(async L=>await L.toggleModulesIfNeeded()))}clearBufferedEvents(L){var U;for(const Z of d.keys()){const j=A(U=n,P,D_).call(U,Z,L);c(this,y).delete(j)}}},g=new WeakMap,y=new WeakMap,w=new WeakMap,v=new WeakMap,b=new WeakMap,S=new WeakMap,P=new WeakSet,D_=function(L,U){return JSON.stringify({eventName:L,browsingContext:U})},E=new WeakSet,$R=function(L,U){var j;if(!d.has(U))return;const Z=A(j=n,P,D_).call(j,U,L.contextId);c(this,y).has(Z)||c(this,y).set(Z,new t.Buffer(d.get(U))),c(this,y).get(Z).add(L),c(this,g).get(U).add(L.contextId)},OE=function(L,U,Z){var D,W;if(!d.has(Z))return;const j=A(D=n,P,D_).call(D,Z,L.contextId),F=Math.max(((W=c(this,w).get(j))==null?void 0:W.get(JSON.stringify(U)))??0,L.id),B=c(this,w).get(j);B?B.set(JSON.stringify(U),F):c(this,w).set(j,new Map([[JSON.stringify(U),F]]))},NR=function(L,U,Z){var D,W,G;const j=A(D=n,P,D_).call(D,L,U),F=((W=c(this,w).get(j))==null?void 0:W.get(JSON.stringify(Z)))??-1/0,B=((G=c(this,y).get(j))==null?void 0:G.get().filter(te=>te.id>F))??[];return U===null&&Array.from(c(this,g).get(L).keys()).filter(te=>te!==null&&c(this,b).hasContext(te)).map(te=>A(this,E,NR).call(this,L,te,Z)).forEach(te=>B.push(...te)),B.sort((te,K)=>te.id-K.id)},_(k,P),k);return Ky.EventManager=h,n=h,Ky}var X5;function uue(){var f,p,m,g,y,w,v,b,S,P,k,C,y9,M;if(X5)return iy;X5=1,Object.defineProperty(iy,"__esModule",{value:!0}),iy.BidiServer=void 0;const n=Kh(),e=Ws(),t=wce(),r=qce(),s=Hce(),i=Yce(),a=Qce(),o=tue(),u=rue(),l=nue(),d=cue();let h=(M=class extends n.EventEmitter{constructor(O,T,L,U,Z,j,F){super();_(this,C);_(this,f);_(this,p);_(this,m);_(this,g);_(this,y,new a.BrowsingContextStorage);_(this,w,new l.RealmStorage);_(this,v,new u.PreloadScriptStorage);_(this,b);_(this,S);_(this,P,O=>{c(this,m).processCommand(O).catch(T=>{var L;(L=c(this,S))==null||L.call(this,e.LogType.debugError,T)})});_(this,k,async O=>{const T={...O.message,...O.channel};await c(this,p).sendMessage(T)});x(this,S,F),x(this,f,new t.ProcessingQueue(c(this,k),c(this,S))),x(this,p,O),c(this,p).setOnMessage(c(this,P)),x(this,g,new d.EventManager(c(this,y)));const B=new o.NetworkStorage(c(this,g),c(this,y),L,F);x(this,b,new s.BluetoothProcessor(c(this,g),c(this,y))),x(this,m,new r.CommandProcessor(T,L,c(this,g),c(this,y),c(this,w),c(this,v),B,c(this,b),j,async D=>{await L.sendCommand("Security.setIgnoreCertificateErrors",{ignore:D.acceptInsecureCerts??!1}),new i.CdpTargetManager(T,L,U,c(this,g),c(this,y),c(this,w),B,c(this,b),c(this,v),Z,(D==null?void 0:D["goog:prerenderingDisabled"])??!1,D==null?void 0:D.unhandledPromptBehavior,F),await L.sendCommand("Target.setDiscoverTargets",{discover:!0}),await L.sendCommand("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0,filter:[{type:"page",exclude:!0},{}]}),await A(this,C,y9).call(this)},c(this,S))),c(this,g).on("event",({message:D,event:W})=>{this.emitOutgoingMessage(D,W)}),c(this,m).on("response",({message:D,event:W})=>{this.emitOutgoingMessage(D,W)})}static async createAndStart(O,T,L,U,Z,j){const[{browserContextIds:F},{targetInfos:B}]=await Promise.all([L.sendCommand("Target.getBrowserContexts"),L.sendCommand("Target.getTargets")]);let D="default";for(const G of B)if(G.browserContextId&&!F.includes(G.browserContextId)){D=G.browserContextId;break}return new M(O,T,L,U,D,Z,j)}emitOutgoingMessage(O,T){c(this,f).add(O,T)}close(){c(this,p).close()}},f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,v=new WeakMap,b=new WeakMap,S=new WeakMap,P=new WeakMap,k=new WeakMap,C=new WeakSet,y9=async function(){await Promise.all(c(this,y).getTopLevelContexts().map(O=>O.lifecycleLoaded()))},M);return iy.BidiServer=h,iy}var Y5;function lue(){return Y5||(Y5=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.OutgoingMessage=n.EventEmitter=n.BidiServer=void 0;var e=uue();Object.defineProperty(n,"BidiServer",{enumerable:!0,get:function(){return e.BidiServer}});var t=Kh();Object.defineProperty(n,"EventEmitter",{enumerable:!0,get:function(){return t.EventEmitter}});var r=kI();Object.defineProperty(n,"OutgoingMessage",{enumerable:!0,get:function(){return r.OutgoingMessage}})}(_I)),_I}var CI=lue();const Kl=class Kl extends Kp{constructor(t,r){super();_(this,pp,!1);_(this,Zc);_(this,bo,qt.create());J(this,"frame");J(this,"onClose",()=>{Kl.sessions.delete(this.id()),x(this,pp,!0)});if(this.frame=t,!this.frame.page().browser().cdpSupported)return;const s=this.frame.page().browser().connection;x(this,Zc,s),r?(c(this,bo).resolve(r),Kl.sessions.set(r,this)):(async()=>{try{const{result:i}=await s.send("goog:cdp.getSession",{context:t._id});c(this,bo).resolve(i.session),Kl.sessions.set(i.session,this)}catch(i){c(this,bo).reject(i)}})(),Kl.sessions.set(c(this,bo).value(),this)}connection(){}async send(t,r,s){if(c(this,Zc)===void 0)throw new He("CDP support is required for this feature. The current browser does not support CDP.");if(c(this,pp))throw new Zs(`Protocol error (${t}): Session closed. Most likely the page has been closed.`);const i=await c(this,bo).valueOrThrow(),{result:a}=await c(this,Zc).send("goog:cdp.sendCommand",{method:t,params:r,session:i},s==null?void 0:s.timeout);return a.result}async detach(){if(!(c(this,Zc)===void 0||c(this,Zc).closed||c(this,pp)))try{await this.frame.client.send("Target.detachFromTarget",{sessionId:this.id()})}finally{this.onClose()}}id(){const t=c(this,bo).value();return typeof t=="string"?t:""}};pp=new WeakMap,Zc=new WeakMap,bo=new WeakMap,J(Kl,"sessions",new Map);let Vy=Kl;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const due=fd("puppeteer:webDriverBiDi:SEND "),hue=fd("puppeteer:webDriverBiDi:RECV ");class Q5 extends Ae{constructor(t,r,s=0,i){super();_(this,t_);_(this,va);_(this,mp);_(this,r_,0);_(this,Wl,!1);_(this,So,new vk);_(this,n_,[]);x(this,t_,t),x(this,mp,s),x(this,r_,i??18e4),x(this,va,r),c(this,va).onmessage=this.onMessage.bind(this),c(this,va).onclose=this.unbind.bind(this)}get closed(){return c(this,Wl)}get url(){return c(this,t_)}pipeTo(t){c(this,n_).push(t)}emit(t,r){for(const s of c(this,n_))s.emit(t,r);return super.emit(t,r)}send(t,r,s){return ae(!c(this,Wl),"Protocol error: Connection closed."),c(this,So).create(t,s??c(this,r_),i=>{const a=JSON.stringify({id:i,method:t,params:r});due(a),c(this,va).send(a)})}async onMessage(t){var s;c(this,mp)&&await new Promise(i=>setTimeout(i,c(this,mp))),hue(t);const r=JSON.parse(t);if("type"in r)switch(r.type){case"success":c(this,So).resolve(r.id,r);return;case"error":if(r.id===null)break;c(this,So).reject(r.id,fue(r),`${r.error}: ${r.message}`);return;case"event":if(pue(r)){(s=Vy.sessions.get(r.params.session))==null||s.emit(r.params.event,r.params.params);return}this.emit(r.method,r.params);return}"id"in r&&c(this,So).reject(r.id,`Protocol Error. Message is not in BiDi protocol format: '${t}'`,r.message),Ee(r)}unbind(){c(this,Wl)||(x(this,Wl,!0),c(this,va).onmessage=()=>{},c(this,va).onclose=()=>{},c(this,So).clear())}dispose(){this.unbind(),c(this,va).close()}getPendingProtocolErrors(){return c(this,So).getPendingProtocolErrors()}}t_=new WeakMap,va=new WeakMap,mp=new WeakMap,r_=new WeakMap,Wl=new WeakMap,So=new WeakMap,n_=new WeakMap;function fue(n){let e=`${n.error} ${n.message}`;return n.stacktrace&&(e+=` ${n.stacktrace}`),e}function pue(n){return n.method.startsWith("goog:cdp.")}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const mue=(n,...e)=>{fd(`bidi:${n}`)(e)};async function gue(n){const e=new wue,t=new yue(n),r={send(a){e.emitMessage(JSON.parse(a))},close(){i.close(),t.close(),n.dispose()},onmessage(a){}};e.on("bidiResponse",a=>{r.onmessage(JSON.stringify(a))});const s=new Q5(n.url(),r,n.delay,n.timeout),i=await CI.BidiServer.createAndStart(e,t,t.browserClient(),"",void 0,mue);return s}class yue{constructor(e){_(this,s_);_(this,zl,new Map);_(this,Vl);x(this,s_,e),x(this,Vl,new eH(e))}browserClient(){return c(this,Vl)}getCdpClient(e){const t=c(this,s_).session(e);if(!t)throw new Error(`Unknown CDP session with id ${e}`);if(!c(this,zl).has(t)){const r=new eH(t,e,c(this,Vl));return c(this,zl).set(t,r),r}return c(this,zl).get(t)}close(){c(this,Vl).close();for(const e of c(this,zl).values())e.close()}}s_=new WeakMap,zl=new WeakMap,Vl=new WeakMap;class eH extends CI.EventEmitter{constructor(t,r,s){super();_(this,gp,!1);_(this,Gl);J(this,"sessionId");_(this,i_);_(this,a_,(t,r)=>{this.emit(t,r)});x(this,Gl,t),this.sessionId=r,x(this,i_,s),c(this,Gl).on("*",c(this,a_))}browserClient(){return c(this,i_)}async sendCommand(t,...r){if(!c(this,gp))try{return await c(this,Gl).send(t,...r)}catch(s){if(c(this,gp))return;throw s}}close(){c(this,Gl).off("*",c(this,a_)),x(this,gp,!0)}isCloseError(t){return t instanceof Zs}}gp=new WeakMap,Gl=new WeakMap,i_=new WeakMap,a_=new WeakMap;class wue extends CI.EventEmitter{constructor(){super(...arguments);_(this,yp,async t=>{})}emitMessage(t){c(this,yp).call(this,t)}setOnMessage(t){x(this,yp,t)}async sendMessage(t){this.emit("bidiResponse",t)}close(){x(this,yp,async t=>{})}}yp=new WeakMap;/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var vue=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},_ue=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let bue=(()=>{var r,s,i,a,o,u,w9,RE,v9,f;let n=Ae,e=[],t;return f=class extends n{constructor(g){super();_(this,u);_(this,r,vue(this,e));_(this,s);_(this,i);_(this,a,new lr);_(this,o);x(this,i,g)}static from(g){var w;const y=new f(g);return A(w=y,u,w9).call(w),y}get disposed(){return c(this,a).disposed}get request(){return c(this,r)}get navigation(){return c(this,s)}dispose(){this[je]()}[(t=[Ro],je)](){c(this,a).dispose(),super[je]()}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakSet,w9=function(){const g=c(this,a).use(new Ae(c(this,i)));g.once("closed",()=>{this.emit("failed",{url:c(this,i).url,timestamp:new Date}),this.dispose()}),g.on("request",({request:w})=>{if(w.navigation===void 0||!A(this,u,RE).call(this,w.navigation))return;x(this,r,w),this.emit("request",w),c(this,a).use(new Ae(c(this,r))).on("redirect",b=>{x(this,r,b)})});const y=c(this,a).use(new Ae(c(this,u,v9)));y.on("browsingContext.navigationStarted",w=>{w.context!==c(this,i).id||c(this,s)!==void 0||x(this,s,f.from(c(this,i)))});for(const w of["browsingContext.domContentLoaded","browsingContext.load"])y.on(w,v=>{v.context!==c(this,i).id||v.navigation===null||!A(this,u,RE).call(this,v.navigation)||this.dispose()});for(const[w,v]of[["browsingContext.fragmentNavigated","fragment"],["browsingContext.navigationFailed","failed"],["browsingContext.navigationAborted","aborted"]])y.on(w,b=>{b.context!==c(this,i).id||!A(this,u,RE).call(this,b.navigation)||(this.emit(v,{url:b.url,timestamp:new Date(b.timestamp)}),this.dispose())})},RE=function(g){return c(this,s)!==void 0&&!c(this,s).disposed?!1:c(this,o)===void 0?(x(this,o,g),!0):c(this,o)===g},v9=function(){return c(this,i).userContext.browser.session},(()=>{const g=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;_ue(f,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:y=>"dispose"in y,get:y=>y.dispose},metadata:g},null,e),g&&Object.defineProperty(f,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:g})})(),f})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Sue=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Gy=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},PI;let AI=(()=>{var o,u;let n=Ae,e=[],t,r,s,i,a;return u=class extends n{constructor(h,f){super();_(this,o,Sue(this,e));J(this,"disposables",new lr);J(this,"id");J(this,"origin");J(this,"executionContextId");this.id=h,this.origin=f}get disposed(){return c(this,o)!==void 0}get target(){return{realm:this.id}}dispose(h){x(this,o,h),this[je]()}async disown(h){await this.session.send("script.disown",{target:this.target,handles:h})}async callFunction(h,f,p={}){const{result:m}=await this.session.send("script.callFunction",{functionDeclaration:h,awaitPromise:f,target:this.target,...p});return m}async evaluate(h,f,p={}){const{result:m}=await this.session.send("script.evaluate",{expression:h,awaitPromise:f,target:this.target,...p});return m}async resolveExecutionContextId(){if(!this.executionContextId){const{result:h}=await this.session.connection.send("goog:cdp.resolveRealm",{realm:this.id});this.executionContextId=h.executionContextId}return this.executionContextId}[(t=[Ro],r=[le(h=>c(h,o))],s=[le(h=>c(h,o))],i=[le(h=>c(h,o))],a=[le(h=>c(h,o))],je)](){c(this,o)??x(this,o,"Realm already destroyed, probably because all associated browsing contexts closed."),this.emit("destroyed",{reason:c(this,o)}),this.disposables.dispose(),super[je]()}},o=new WeakMap,(()=>{const h=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;Gy(u,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:f=>"dispose"in f,get:f=>f.dispose},metadata:h},null,e),Gy(u,null,r,{kind:"method",name:"disown",static:!1,private:!1,access:{has:f=>"disown"in f,get:f=>f.disown},metadata:h},null,e),Gy(u,null,s,{kind:"method",name:"callFunction",static:!1,private:!1,access:{has:f=>"callFunction"in f,get:f=>f.callFunction},metadata:h},null,e),Gy(u,null,i,{kind:"method",name:"evaluate",static:!1,private:!1,access:{has:f=>"evaluate"in f,get:f=>f.evaluate},metadata:h},null,e),Gy(u,null,a,{kind:"method",name:"resolveExecutionContextId",static:!1,private:!1,access:{has:f=>"resolveExecutionContextId"in f,get:f=>f.resolveExecutionContextId},metadata:h},null,e),h&&Object.defineProperty(u,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h})})(),u})();const nO=class nO extends AI{constructor(t,r){super("","");_(this,Qx);J(this,"browsingContext");J(this,"sandbox");_(this,o_,new Map);this.browsingContext=t,this.sandbox=r}static from(t,r){var i;const s=new nO(t,r);return A(i=s,Qx,_9).call(i),s}get session(){return this.browsingContext.userContext.browser.session}get target(){return{context:this.browsingContext.id,sandbox:this.sandbox}}};o_=new WeakMap,Qx=new WeakSet,_9=function(){this.disposables.use(new Ae(this.browsingContext)).on("closed",({reason:s})=>{this.dispose(s)});const r=this.disposables.use(new Ae(this.session));r.on("script.realmCreated",s=>{s.type!=="window"||s.context!==this.browsingContext.id||s.sandbox!==this.sandbox||(this.id=s.realm,this.origin=s.origin,this.executionContextId=void 0,this.emit("updated",this))}),r.on("script.realmCreated",s=>{if(s.type!=="dedicated-worker"||!s.owners.includes(this.id))return;const i=II.from(this,s.realm,s.origin);c(this,o_).set(i.id,i);const a=this.disposables.use(new Ae(i));a.once("destroyed",()=>{a.removeAllListeners(),c(this,o_).delete(i.id)}),this.emit("worker",i)})};let TI=nO;class II extends AI{constructor(t,r,s){super(r,s);_(this,eE);_(this,c_,new Map);J(this,"owners");this.owners=new Set([t])}static from(t,r,s){var a;const i=new PI(t,r,s);return A(a=i,eE,b9).call(a),i}get session(){return this.owners.values().next().value.session}}c_=new WeakMap,eE=new WeakSet,b9=function(){const t=this.disposables.use(new Ae(this.session));t.on("script.realmDestroyed",r=>{r.realm===this.id&&this.dispose("Realm already destroyed.")}),t.on("script.realmCreated",r=>{if(r.type!=="dedicated-worker"||!r.owners.includes(this.id))return;const s=PI.from(this,r.realm,r.origin);c(this,c_).set(s.id,s),this.disposables.use(new Ae(s)).once("destroyed",()=>{c(this,c_).delete(s.id)}),this.emit("worker",s)})},PI=II;const sO=class sO extends AI{constructor(t,r,s){super(r,s);_(this,tE);_(this,u_,new Map);J(this,"browser");this.browser=t}static from(t,r,s){var a;const i=new sO(t,r,s);return A(a=i,tE,S9).call(a),i}get session(){return this.browser.session}};u_=new WeakMap,tE=new WeakSet,S9=function(){const t=this.disposables.use(new Ae(this.session));t.on("script.realmDestroyed",r=>{r.realm===this.id&&this.dispose("Realm already destroyed.")}),t.on("script.realmCreated",r=>{if(r.type!=="dedicated-worker"||!r.owners.includes(this.id))return;const s=II.from(this,r.realm,r.origin);c(this,u_).set(s.id,s),this.disposables.use(new Ae(s)).once("destroyed",()=>{c(this,u_).delete(s.id)}),this.emit("worker",s)})};let OI=sO;/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var xue=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Eue=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let kue=(()=>{var r,s,i,a,o,u,l,x9,td,f;let n=Ae,e=[],t;return f=class extends n{constructor(g,y){super();_(this,l);_(this,r,xue(this,e));_(this,s);_(this,i);_(this,a);_(this,o,new lr);_(this,u);x(this,a,g),x(this,u,y)}static from(g,y){var v;const w=new f(g,y);return A(v=w,l,x9).call(v),w}get disposed(){return c(this,o).disposed}get error(){return c(this,r)}get headers(){return c(this,u).request.headers}get id(){return c(this,u).request.request}get initiator(){return c(this,u).initiator}get method(){return c(this,u).request.method}get navigation(){return c(this,u).navigation??void 0}get redirect(){return c(this,s)}get lastRedirect(){let g=c(this,s);for(;g;){if(g&&!c(g,s))return g;g=c(g,s)}return g}get response(){return c(this,i)}get url(){return c(this,u).request.url}get isBlocked(){return c(this,u).isBlocked}get resourceType(){return c(this,u).request["goog:resourceType"]??void 0}get postData(){return c(this,u).request["goog:postData"]??void 0}get hasPostData(){return c(this,u).request["goog:hasPostData"]??!1}async continueRequest({url:g,method:y,headers:w,cookies:v,body:b}){await c(this,l,td).send("network.continueRequest",{request:this.id,url:g,method:y,headers:w,body:b,cookies:v})}async failRequest(){await c(this,l,td).send("network.failRequest",{request:this.id})}async provideResponse({statusCode:g,reasonPhrase:y,headers:w,body:v}){await c(this,l,td).send("network.provideResponse",{request:this.id,statusCode:g,reasonPhrase:y,headers:w,body:v})}async continueWithAuth(g){g.action==="provideCredentials"?await c(this,l,td).send("network.continueWithAuth",{request:this.id,action:g.action,credentials:g.credentials}):await c(this,l,td).send("network.continueWithAuth",{request:this.id,action:g.action})}dispose(){this[je]()}[(t=[Ro],je)](){c(this,o).dispose(),super[je]()}timing(){return c(this,u).request.timings}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakSet,x9=function(){c(this,o).use(new Ae(c(this,a))).once("closed",({reason:w})=>{x(this,r,w),this.emit("error",c(this,r)),this.dispose()});const y=c(this,o).use(new Ae(c(this,l,td)));y.on("network.beforeRequestSent",w=>{w.context!==c(this,a).id||w.request.request!==this.id||w.redirectCount!==c(this,u).redirectCount+1||(x(this,s,f.from(c(this,a),w)),this.emit("redirect",c(this,s)),this.dispose())}),y.on("network.authRequired",w=>{w.context!==c(this,a).id||w.request.request!==this.id||!w.isBlocked||this.emit("authenticate",void 0)}),y.on("network.fetchError",w=>{w.context!==c(this,a).id||w.request.request!==this.id||c(this,u).redirectCount!==w.redirectCount||(x(this,r,w.errorText),this.emit("error",c(this,r)),this.dispose())}),y.on("network.responseCompleted",w=>{w.context!==c(this,a).id||w.request.request!==this.id||c(this,u).redirectCount!==w.redirectCount||(x(this,i,w.response),c(this,u).request.timings=w.request.timings,this.emit("success",c(this,i)),!(c(this,i).status>=300&&c(this,i).status<400)&&this.dispose())})},td=function(){return c(this,a).userContext.browser.session},(()=>{const g=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;Eue(f,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:y=>"dispose"in y,get:y=>y.dispose},metadata:g},null,e),g&&Object.defineProperty(f,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:g})})(),f})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Cue=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},tH=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let Pue=(()=>{var s,i,a,o,E9,FR,d;let n=Ae,e=[],t,r;return d=class extends n{constructor(p,m){super();_(this,o);_(this,s,Cue(this,e));_(this,i);_(this,a,new lr);J(this,"browsingContext");J(this,"info");this.browsingContext=p,this.info=m}static from(p,m){var y;const g=new d(p,m);return A(y=g,o,E9).call(y),g}get closed(){return c(this,s)!==void 0}get disposed(){return this.closed}get handled(){return this.info.handler==="accept"||this.info.handler==="dismiss"?!0:c(this,i)!==void 0}get result(){return c(this,i)}dispose(p){x(this,s,p),this[je]()}async handle(p={}){return await c(this,o,FR).send("browsingContext.handleUserPrompt",{...p,context:this.info.context}),c(this,i)}[(t=[Ro],r=[le(p=>c(p,s))],je)](){c(this,s)??x(this,s,"User prompt already closed, probably because the associated browsing context was destroyed."),this.emit("closed",{reason:c(this,s)}),c(this,a).dispose(),super[je]()}},s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakSet,E9=function(){c(this,a).use(new Ae(this.browsingContext)).once("closed",({reason:g})=>{this.dispose(`User prompt already closed: ${g}`)}),c(this,a).use(new Ae(c(this,o,FR))).on("browsingContext.userPromptClosed",g=>{g.context===this.browsingContext.id&&(x(this,i,g),this.emit("handled",g),this.dispose("User prompt already handled."))})},FR=function(){return this.browsingContext.userContext.browser.session},(()=>{const p=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;tH(d,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:m=>"dispose"in m,get:m=>m.dispose},metadata:p},null,e),tH(d,null,r,{kind:"method",name:"handle",static:!1,private:!1,access:{has:m=>"handle"in m,get:m=>m.handle},metadata:p},null,e),p&&Object.defineProperty(d,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:p})})(),d})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Aue=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Yt=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let Tue=(()=>{var I,N,O,T,L,U,Z,j,k9,cr,LR,W;let n=Ae,e=[],t,r,s,i,a,o,u,l,d,h,f,p,m,g,y,w,v,b,S,P,k,C,E,M;return W=class extends n{constructor(K,q,se,ke,he){super();_(this,j);_(this,I,Aue(this,e));_(this,N);_(this,O);_(this,T,new Map);_(this,L,new lr);_(this,U,new Map);_(this,Z,new Map);J(this,"defaultRealm");J(this,"id");J(this,"parent");J(this,"userContext");J(this,"originalOpener");x(this,O,ke),this.id=se,this.parent=q,this.userContext=K,this.originalOpener=he,this.defaultRealm=A(this,j,LR).call(this)}static from(K,q,se,ke,he){var fe;const et=new W(K,q,se,ke,he);return A(fe=et,j,k9).call(fe),et}get children(){return c(this,T).values()}get closed(){return c(this,N)!==void 0}get disposed(){return this.closed}get realms(){const K=this;return function*(){yield K.defaultRealm,yield*c(K,U).values()}()}get top(){let K=this;for(let{parent:q}=K;q;{parent:q}=K)K=q;return K}get url(){return c(this,O)}dispose(K){x(this,N,K);for(const q of c(this,T).values())q.dispose("Parent browsing context was disposed");this[je]()}async activate(){await c(this,j,cr).send("browsingContext.activate",{context:this.id})}async captureScreenshot(K={}){const{result:{data:q}}=await c(this,j,cr).send("browsingContext.captureScreenshot",{context:this.id,...K});return q}async close(K){await Promise.all([...c(this,T).values()].map(async q=>{await q.close(K)})),await c(this,j,cr).send("browsingContext.close",{context:this.id,promptUnload:K})}async traverseHistory(K){await c(this,j,cr).send("browsingContext.traverseHistory",{context:this.id,delta:K})}async navigate(K,q){await c(this,j,cr).send("browsingContext.navigate",{context:this.id,url:K,wait:q})}async reload(K={}){await c(this,j,cr).send("browsingContext.reload",{context:this.id,...K})}async setCacheBehavior(K){await c(this,j,cr).send("network.setCacheBehavior",{contexts:[this.id],cacheBehavior:K})}async print(K={}){const{result:{data:q}}=await c(this,j,cr).send("browsingContext.print",{context:this.id,...K});return q}async handleUserPrompt(K={}){await c(this,j,cr).send("browsingContext.handleUserPrompt",{context:this.id,...K})}async setViewport(K={}){await c(this,j,cr).send("browsingContext.setViewport",{context:this.id,...K})}async performActions(K){await c(this,j,cr).send("input.performActions",{context:this.id,actions:K})}async releaseActions(){await c(this,j,cr).send("input.releaseActions",{context:this.id})}createWindowRealm(K){return A(this,j,LR).call(this,K)}async addPreloadScript(K,q={}){return await this.userContext.browser.addPreloadScript(K,{...q,contexts:[this]})}async addIntercept(K){const{result:{intercept:q}}=await this.userContext.browser.session.send("network.addIntercept",{...K,contexts:[this.id]});return q}async removePreloadScript(K){await this.userContext.browser.removePreloadScript(K)}async getCookies(K={}){const{result:{cookies:q}}=await c(this,j,cr).send("storage.getCookies",{...K,partition:{type:"context",context:this.id}});return q}async setCookie(K){await c(this,j,cr).send("storage.setCookie",{cookie:K,partition:{type:"context",context:this.id}})}async setFiles(K,q){await c(this,j,cr).send("input.setFiles",{context:this.id,element:K,files:q})}async subscribe(K){await c(this,j,cr).subscribe(K,[this.id])}async addInterception(K){await c(this,j,cr).subscribe(K,[this.id])}[(t=[Ro],r=[le(K=>c(K,N))],s=[le(K=>c(K,N))],i=[le(K=>c(K,N))],a=[le(K=>c(K,N))],o=[le(K=>c(K,N))],u=[le(K=>c(K,N))],l=[le(K=>c(K,N))],d=[le(K=>c(K,N))],h=[le(K=>c(K,N))],f=[le(K=>c(K,N))],p=[le(K=>c(K,N))],m=[le(K=>c(K,N))],g=[le(K=>c(K,N))],y=[le(K=>c(K,N))],w=[le(K=>c(K,N))],v=[le(K=>c(K,N))],b=[le(K=>c(K,N))],S=[le(K=>c(K,N))],P=[le(K=>c(K,N))],k=[le(K=>c(K,N))],C=[le(K=>c(K,N))],je)](){c(this,N)??x(this,N,"Browsing context already closed, probably because the user context closed."),this.emit("closed",{reason:c(this,N)}),c(this,L).dispose(),super[je]()}async deleteCookie(...K){await Promise.all(K.map(async q=>{await c(this,j,cr).send("storage.deleteCookies",{filter:q,partition:{type:"context",context:this.id}})}))}async locateNodes(K,q){return(await c(this,j,cr).send("browsingContext.locateNodes",{context:this.id,locator:K,startNodes:q.length?q:void 0})).result.nodes}},I=new WeakMap,N=new WeakMap,O=new WeakMap,T=new WeakMap,L=new WeakMap,U=new WeakMap,Z=new WeakMap,j=new WeakSet,k9=function(){c(this,L).use(new Ae(this.userContext)).once("closed",({reason:se})=>{this.dispose(`Browsing context already closed: ${se}`)});const q=c(this,L).use(new Ae(c(this,j,cr)));q.on("browsingContext.contextCreated",se=>{if(se.parent!==this.id)return;const ke=W.from(this.userContext,this,se.context,se.url,se.originalOpener);c(this,T).set(se.context,ke);const he=c(this,L).use(new Ae(ke));he.once("closed",()=>{he.removeAllListeners(),c(this,T).delete(ke.id)}),this.emit("browsingcontext",{browsingContext:ke})}),q.on("browsingContext.contextDestroyed",se=>{se.context===this.id&&this.dispose("Browsing context already closed.")}),q.on("browsingContext.historyUpdated",se=>{se.context===this.id&&(x(this,O,se.url),this.emit("historyUpdated",void 0))}),q.on("browsingContext.domContentLoaded",se=>{se.context===this.id&&(x(this,O,se.url),this.emit("DOMContentLoaded",void 0))}),q.on("browsingContext.load",se=>{se.context===this.id&&(x(this,O,se.url),this.emit("load",void 0))}),q.on("browsingContext.navigationStarted",se=>{if(se.context!==this.id)return;for(const[he,et]of c(this,Z))et.disposed&&c(this,Z).delete(he);if(c(this,I)!==void 0&&!c(this,I).disposed)return;x(this,I,bue.from(this));const ke=c(this,L).use(new Ae(c(this,I)));for(const he of["fragment","failed","aborted"])ke.once(he,({url:et})=>{ke[je](),x(this,O,et)});this.emit("navigation",{navigation:c(this,I)})}),q.on("network.beforeRequestSent",se=>{if(se.context!==this.id||c(this,Z).has(se.request.request))return;const ke=kue.from(this,se);c(this,Z).set(ke.id,ke),this.emit("request",{request:ke})}),q.on("log.entryAdded",se=>{se.source.context===this.id&&this.emit("log",{entry:se})}),q.on("browsingContext.userPromptOpened",se=>{if(se.context!==this.id)return;const ke=Pue.from(this,se);this.emit("userprompt",{userPrompt:ke})})},cr=function(){return this.userContext.browser.session},LR=function(K){const q=TI.from(this,K);return q.on("worker",se=>{this.emit("worker",{realm:se})}),q},(()=>{const K=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;E=[le(q=>c(q,N))],M=[le(q=>c(q,N))],Yt(W,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:q=>"dispose"in q,get:q=>q.dispose},metadata:K},null,e),Yt(W,null,r,{kind:"method",name:"activate",static:!1,private:!1,access:{has:q=>"activate"in q,get:q=>q.activate},metadata:K},null,e),Yt(W,null,s,{kind:"method",name:"captureScreenshot",static:!1,private:!1,access:{has:q=>"captureScreenshot"in q,get:q=>q.captureScreenshot},metadata:K},null,e),Yt(W,null,i,{kind:"method",name:"close",static:!1,private:!1,access:{has:q=>"close"in q,get:q=>q.close},metadata:K},null,e),Yt(W,null,a,{kind:"method",name:"traverseHistory",static:!1,private:!1,access:{has:q=>"traverseHistory"in q,get:q=>q.traverseHistory},metadata:K},null,e),Yt(W,null,o,{kind:"method",name:"navigate",static:!1,private:!1,access:{has:q=>"navigate"in q,get:q=>q.navigate},metadata:K},null,e),Yt(W,null,u,{kind:"method",name:"reload",static:!1,private:!1,access:{has:q=>"reload"in q,get:q=>q.reload},metadata:K},null,e),Yt(W,null,l,{kind:"method",name:"setCacheBehavior",static:!1,private:!1,access:{has:q=>"setCacheBehavior"in q,get:q=>q.setCacheBehavior},metadata:K},null,e),Yt(W,null,d,{kind:"method",name:"print",static:!1,private:!1,access:{has:q=>"print"in q,get:q=>q.print},metadata:K},null,e),Yt(W,null,h,{kind:"method",name:"handleUserPrompt",static:!1,private:!1,access:{has:q=>"handleUserPrompt"in q,get:q=>q.handleUserPrompt},metadata:K},null,e),Yt(W,null,f,{kind:"method",name:"setViewport",static:!1,private:!1,access:{has:q=>"setViewport"in q,get:q=>q.setViewport},metadata:K},null,e),Yt(W,null,p,{kind:"method",name:"performActions",static:!1,private:!1,access:{has:q=>"performActions"in q,get:q=>q.performActions},metadata:K},null,e),Yt(W,null,m,{kind:"method",name:"releaseActions",static:!1,private:!1,access:{has:q=>"releaseActions"in q,get:q=>q.releaseActions},metadata:K},null,e),Yt(W,null,g,{kind:"method",name:"createWindowRealm",static:!1,private:!1,access:{has:q=>"createWindowRealm"in q,get:q=>q.createWindowRealm},metadata:K},null,e),Yt(W,null,y,{kind:"method",name:"addPreloadScript",static:!1,private:!1,access:{has:q=>"addPreloadScript"in q,get:q=>q.addPreloadScript},metadata:K},null,e),Yt(W,null,w,{kind:"method",name:"addIntercept",static:!1,private:!1,access:{has:q=>"addIntercept"in q,get:q=>q.addIntercept},metadata:K},null,e),Yt(W,null,v,{kind:"method",name:"removePreloadScript",static:!1,private:!1,access:{has:q=>"removePreloadScript"in q,get:q=>q.removePreloadScript},metadata:K},null,e),Yt(W,null,b,{kind:"method",name:"getCookies",static:!1,private:!1,access:{has:q=>"getCookies"in q,get:q=>q.getCookies},metadata:K},null,e),Yt(W,null,S,{kind:"method",name:"setCookie",static:!1,private:!1,access:{has:q=>"setCookie"in q,get:q=>q.setCookie},metadata:K},null,e),Yt(W,null,P,{kind:"method",name:"setFiles",static:!1,private:!1,access:{has:q=>"setFiles"in q,get:q=>q.setFiles},metadata:K},null,e),Yt(W,null,k,{kind:"method",name:"subscribe",static:!1,private:!1,access:{has:q=>"subscribe"in q,get:q=>q.subscribe},metadata:K},null,e),Yt(W,null,C,{kind:"method",name:"addInterception",static:!1,private:!1,access:{has:q=>"addInterception"in q,get:q=>q.addInterception},metadata:K},null,e),Yt(W,null,E,{kind:"method",name:"deleteCookie",static:!1,private:!1,access:{has:q=>"deleteCookie"in q,get:q=>q.deleteCookie},metadata:K},null,e),Yt(W,null,M,{kind:"method",name:"locateNodes",static:!1,private:!1,access:{has:q=>"locateNodes"in q,get:q=>q.locateNodes},metadata:K},null,e),K&&Object.defineProperty(W,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:K})})(),W})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Iue=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Zh=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let $x=(()=>{var u,l,d,h,f,p,C9,rd;let n=Ae,e=[],t,r,s,i,a,o;return u=class extends n{constructor(v,b){super();_(this,p);_(this,l,Iue(this,e));_(this,d,new Map);_(this,h,new lr);_(this,f);J(this,"browser");x(this,f,b),this.browser=v}static create(v,b){var P;const S=new u(v,b);return A(P=S,p,C9).call(P),S}get browsingContexts(){return c(this,d).values()}get closed(){return c(this,l)!==void 0}get disposed(){return this.closed}get id(){return c(this,f)}dispose(v){x(this,l,v),this[je]()}async createBrowsingContext(v,b={}){var k;const{result:{context:S}}=await c(this,p,rd).send("browsingContext.create",{type:v,...b,referenceContext:(k=b.referenceContext)==null?void 0:k.id,userContext:c(this,f)}),P=c(this,d).get(S);return ae(P,"The WebDriver BiDi implementation is failing to create a browsing context correctly."),P}async remove(){try{await c(this,p,rd).send("browser.removeUserContext",{userContext:c(this,f)})}finally{this.dispose("User context already closed.")}}async getCookies(v={},b=void 0){const{result:{cookies:S}}=await c(this,p,rd).send("storage.getCookies",{...v,partition:{type:"storageKey",userContext:c(this,f),sourceOrigin:b}});return S}async setCookie(v,b){await c(this,p,rd).send("storage.setCookie",{cookie:v,partition:{type:"storageKey",sourceOrigin:b,userContext:this.id}})}async setPermissions(v,b,S){await c(this,p,rd).send("permissions.setPermission",{origin:v,descriptor:b,state:S,userContext:c(this,f)})}[(t=[Ro],r=[le(v=>c(v,l))],s=[le(v=>c(v,l))],i=[le(v=>c(v,l))],a=[le(v=>c(v,l))],o=[le(v=>c(v,l))],je)](){c(this,l)??x(this,l,"User context already closed, probably because the browser disconnected/closed."),this.emit("closed",{reason:c(this,l)}),c(this,h).dispose(),super[je]()}},l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakSet,C9=function(){const v=c(this,h).use(new Ae(this.browser));v.once("closed",({reason:S})=>{this.dispose(`User context was closed: ${S}`)}),v.once("disconnected",({reason:S})=>{this.dispose(`User context was closed: ${S}`)}),c(this,h).use(new Ae(c(this,p,rd))).on("browsingContext.contextCreated",S=>{if(S.parent||S.userContext!==c(this,f))return;const P=Tue.from(this,void 0,S.context,S.url,S.originalOpener);c(this,d).set(P.id,P);const k=c(this,h).use(new Ae(P));k.on("closed",()=>{k.removeAllListeners(),c(this,d).delete(P.id)}),this.emit("browsingcontext",{browsingContext:P})})},rd=function(){return this.browser.session},(()=>{const v=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;Zh(u,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:b=>"dispose"in b,get:b=>b.dispose},metadata:v},null,e),Zh(u,null,r,{kind:"method",name:"createBrowsingContext",static:!1,private:!1,access:{has:b=>"createBrowsingContext"in b,get:b=>b.createBrowsingContext},metadata:v},null,e),Zh(u,null,s,{kind:"method",name:"remove",static:!1,private:!1,access:{has:b=>"remove"in b,get:b=>b.remove},metadata:v},null,e),Zh(u,null,i,{kind:"method",name:"getCookies",static:!1,private:!1,access:{has:b=>"getCookies"in b,get:b=>b.getCookies},metadata:v},null,e),Zh(u,null,a,{kind:"method",name:"setCookie",static:!1,private:!1,access:{has:b=>"setCookie"in b,get:b=>b.setCookie},metadata:v},null,e),Zh(u,null,o,{kind:"method",name:"setPermissions",static:!1,private:!1,access:{has:b=>"setPermissions"in b,get:b=>b.setPermissions},metadata:v},null,e),v&&Object.defineProperty(u,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:v})})(),J(u,"DEFAULT","default"),u})();/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class Zy{static deserialize(e){var t,r,s,i;if(!e){Ee("Service did not produce a result.");return}switch(e.type){case"array":return(t=e.value)==null?void 0:t.map(a=>this.deserialize(a));case"set":return(r=e.value)==null?void 0:r.reduce((a,o)=>a.add(this.deserialize(o)),new Set);case"object":return(s=e.value)==null?void 0:s.reduce((a,o)=>{const{key:u,value:l}=A(this,Zl,jR).call(this,o);return a[u]=l,a},{});case"map":return(i=e.value)==null?void 0:i.reduce((a,o)=>{const{key:u,value:l}=A(this,Zl,jR).call(this,o);return a.set(u,l)},new Map);case"promise":return{};case"regexp":return new RegExp(e.value.pattern,e.value.flags);case"date":return new Date(e.value);case"undefined":return;case"null":return null;case"number":return A(this,Zl,P9).call(this,e.value);case"bigint":return BigInt(e.value);case"boolean":return!!e.value;case"string":return e.value}Ee(`Deserialization of type ${e.type} not supported.`)}}Zl=new WeakSet,P9=function(e){switch(e){case"-0":return-0;case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:return e}},jR=function([e,t]){const r=typeof e=="string"?e:this.deserialize(e),s=this.deserialize(t);return{key:r,value:s}},_(Zy,Zl);/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const iO=class iO extends r${constructor(t){super(t.info.type,t.info.message,t.info.defaultValue);_(this,l_);x(this,l_,t),this.handled=t.handled}static from(t){return new iO(t)}async handle(t){await c(this,l_).handle({accept:t.accept,userText:t.text})}};l_=new WeakMap;let RI=iO;var Oue=Ht();/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const aO=class aO extends ou{constructor(t,r){super();_(this,_a);J(this,"realm");_(this,wp,!1);x(this,_a,t),this.realm=r}static from(t,r){return new aO(t,r)}get disposed(){return c(this,wp)}async jsonValue(){return await this.evaluate(t=>t)}asElement(){return null}async dispose(){c(this,wp)||(x(this,wp,!0),await this.realm.destroyHandles([this]))}get isPrimitiveValue(){switch(c(this,_a).type){case"string":case"number":case"bigint":case"boolean":case"undefined":case"null":return!0;default:return!1}}toString(){return this.isPrimitiveValue?"JSHandle:"+Zy.deserialize(c(this,_a)):"JSHandle@"+c(this,_a).type}get id(){return"handle"in c(this,_a)?c(this,_a).handle:void 0}remoteValue(){return c(this,_a)}remoteObject(){throw new He("Not available in WebDriver BiDi")}};_a=new WeakMap,wp=new WeakMap;let lc=aO;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Rue=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},rH=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},Mue=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},$ue=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});let Jy=(()=>{var s,i;let n=l$,e=[],t,r;return i=class extends n{constructor(u,l){super(lc.from(u,l));_(this,s,Rue(this,e))}static from(u,l){return new i(u,l)}get realm(){return this.handle.realm}get frame(){return this.realm.environment}remoteValue(){return this.handle.remoteValue()}async autofill(u){const l=this.frame.client,h=(await l.send("DOM.describeNode",{objectId:this.handle.id})).node.backendNodeId,f=this.frame._id;await l.send("Autofill.trigger",{fieldId:h,frameId:f,card:u.creditCard})}async contentFrame(){const u={stack:[],error:void 0,hasError:!1};try{const d=Mue(u,await this.evaluateHandle(h=>{if(h instanceof HTMLIFrameElement||h instanceof HTMLFrameElement)return h.contentWindow}),!1).remoteValue();return d.type==="window"?this.frame.page().frames().find(h=>h._id===d.value.context)??null:null}catch(l){u.error=l,u.hasError=!0}finally{$ue(u)}}async uploadFile(...u){const l=Oo.value.path;l&&(u=u.map(d=>l.win32.isAbsolute(d)||l.posix.isAbsolute(d)?d:l.resolve(d))),await this.frame.setFiles(this,u)}async*queryAXTree(u,l){const d=await this.frame.locateNodes(this,{type:"accessibility",value:{role:l,name:u}});return yield*gd.map(d,h=>Promise.resolve(i.from(h,this.realm)))}async backendNodeId(){if(!this.frame.page().browser().cdpSupported)throw new He;if(c(this,s))return c(this,s);const{node:u}=await this.frame.client.send("DOM.describeNode",{objectId:this.handle.id});return x(this,s,u.backendNodeId),c(this,s)}},s=new WeakMap,(()=>{const u=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[le()],r=[le(),mt],rH(i,null,t,{kind:"method",name:"autofill",static:!1,private:!1,access:{has:l=>"autofill"in l,get:l=>l.autofill},metadata:u},null,e),rH(i,null,r,{kind:"method",name:"contentFrame",static:!1,private:!1,access:{has:l=>"contentFrame"in l,get:l=>l.contentFrame},metadata:u},null,e),u&&Object.defineProperty(i,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u})})(),i})();/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var MI=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},Nue=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});const oO=class oO{constructor(e,t,r,s=!1){_(this,ba);_(this,Jc);J(this,"name");_(this,d_);_(this,vp);_(this,_p);_(this,h_,[]);_(this,f_,new lr);_(this,rE,async e=>{const t={stack:[],error:void 0,hasError:!1};try{if(e.channel!==c(this,_p))return;const r=A(this,ba,I9).call(this,e.source);if(!r)return;const s=MI(t,lc.from(e.data,r),!1),i=MI(t,await s.evaluateHandle(([,,l])=>l),!1),a=MI(t,new lr,!1),o=[];for(const[l,d]of await i.getProperties()){if(a.use(d),d instanceof Jy){o[+l]=d,a.use(d);continue}o[+l]=d.jsonValue()}let u;try{u=await c(this,d_).call(this,...await Promise.all(o))}catch(l){try{l instanceof Error?await s.evaluate(([,d],h,f,p)=>{const m=new Error(f);m.name=h,p&&(m.stack=p),d(m)},l.name,l.message,l.stack):await s.evaluate(([,d],h)=>{d(h)},l)}catch(d){Ee(d)}return}try{await s.evaluate(([l],d)=>{l(d)},u)}catch(l){Ee(l)}}catch(r){t.error=r,t.hasError=!0}finally{Nue(t)}});x(this,Jc,e),this.name=t,x(this,d_,r),x(this,vp,s),x(this,_p,`__puppeteer__${c(this,Jc)._id}_page_exposeFunction_${this.name}`)}static async from(e,t,r,s=!1){var a;const i=new oO(e,t,r,s);return await A(a=i,ba,A9).call(a),i}[Symbol.dispose](){this[Symbol.asyncDispose]().catch(Ee)}async[Symbol.asyncDispose](){c(this,f_).dispose(),await Promise.all(c(this,h_).map(async([e,t])=>{const r=c(this,vp)?e.isolatedRealm():e.mainRealm();try{await Promise.all([r.evaluate(s=>{delete globalThis[s]},this.name),...e.childFrames().map(s=>s.evaluate(i=>{delete globalThis[i]},this.name)),e.browsingContext.removePreloadScript(t)])}catch(s){Ee(s)}}))}};Jc=new WeakMap,d_=new WeakMap,vp=new WeakMap,_p=new WeakMap,h_=new WeakMap,f_=new WeakMap,ba=new WeakSet,A9=async function(){const e=c(this,ba,T9),t={type:"channel",value:{channel:c(this,_p),ownership:"root"}};c(this,f_).use(new Ae(e)).on(Oue.ChromiumBidi.Script.EventNames.Message,c(this,rE));const s=ji(md(a=>{Object.assign(globalThis,{[PLACEHOLDER("name")]:function(...o){return new Promise((u,l)=>{a([u,l,o])})}})},{name:JSON.stringify(this.name)})),i=[c(this,Jc)];for(const a of i)i.push(...a.childFrames());await Promise.all(i.map(async a=>{const o=c(this,vp)?a.isolatedRealm():a.mainRealm();try{const[u]=await Promise.all([a.browsingContext.addPreloadScript(s,{arguments:[t],sandbox:o.sandbox}),o.realm.callFunction(s,!1,{arguments:[t]})]);c(this,h_).push([a,u])}catch(u){Ee(u)}}))},T9=function(){return c(this,Jc).page().browser().connection},rE=new WeakMap,I9=function(e){const t=A(this,ba,O9).call(this,e.context);if(t)return t.realm(e.realm)},O9=function(e){const t=[c(this,Jc)];for(const r of t){if(r._id===e)return r;t.push(...r.childFrames())}};let Xy=oO;var Fue=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Lue=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let nH=(()=>{var r,s,i,a,o,R9,l;let n=m$,e=[],t;return l=class extends n{constructor(f,p,m){super();_(this,o);_(this,r,Fue(this,e));_(this,s);_(this,i);_(this,a,!1);x(this,r,f),x(this,s,p),x(this,a,m);const g=f["goog:securityDetails"];m&&g&&x(this,i,new B$(g))}static from(f,p,m){var y;const g=new l(f,p,m);return A(y=g,o,R9).call(y),g}remoteAddress(){return{ip:"",port:-1}}url(){return c(this,r).url}status(){return c(this,r).status}statusText(){return c(this,r).statusText}headers(){const f={};for(const p of c(this,r).headers)p.value.type==="string"&&(f[p.name.toLowerCase()]=p.value.value);return f}request(){return c(this,s)}fromCache(){return c(this,r).fromCache}timing(){const f=c(this,s).timing();return{requestTime:f.requestTime,proxyStart:-1,proxyEnd:-1,dnsStart:f.dnsStart,dnsEnd:f.dnsEnd,connectStart:f.connectStart,connectEnd:f.connectEnd,sslStart:f.tlsStart,sslEnd:-1,workerStart:-1,workerReady:-1,workerFetchStart:-1,workerRespondWithSettled:-1,workerRouterEvaluationStart:-1,workerCacheLookupStart:-1,sendStart:f.requestStart,sendEnd:-1,pushStart:-1,pushEnd:-1,receiveHeadersStart:f.responseStart,receiveHeadersEnd:f.responseEnd}}frame(){return c(this,s).frame()}fromServiceWorker(){return!1}securityDetails(){if(!c(this,a))throw new He;return c(this,i)??null}content(){throw new He}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakSet,R9=function(){var f,p;c(this,r).fromCache&&(c(this,s)._fromMemoryCache=!0,(f=c(this,s).frame())==null||f.page().trustedEmitter.emit("requestservedfromcache",c(this,s))),(p=c(this,s).frame())==null||p.page().trustedEmitter.emit("response",this)},(()=>{const f=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[Js],Lue(l,null,t,{kind:"method",name:"remoteAddress",static:!1,private:!1,access:{has:p=>"remoteAddress"in p,get:p=>p.remoteAddress},metadata:f},null,e),f&&Object.defineProperty(l,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f})})(),l})();var $I;const NI=new WeakMap;class FI extends _b{constructor(t,r,s){super();_(this,Cs);_(this,Jl);_(this,p_,null);J(this,"id");_(this,Hr);_(this,Qt);_(this,m_,!1);_(this,nE,async()=>{if(!c(this,Hr))return;const t=c(this,Hr).page()._credentials;t&&!c(this,m_)?(x(this,m_,!0),c(this,Qt).continueWithAuth({action:"provideCredentials",credentials:{type:"password",username:t.username,password:t.password}})):c(this,Qt).continueWithAuth({action:"cancel"})});NI.set(t,this),this.interception.enabled=t.isBlocked,x(this,Qt,t),x(this,Hr,r),x(this,Jl,s?c(s,Jl):[]),this.id=t.id}static from(t,r,s){var a;const i=new $I(t,r,s);return A(a=i,Cs,M9).call(a),i}get client(){return c(this,Hr).client}url(){return c(this,Qt).url}resourceType(){if(!c(this,Hr).page().browser().cdpSupported)throw new He;return(c(this,Qt).resourceType||"other").toLowerCase()}method(){return c(this,Qt).method}postData(){if(!c(this,Hr).page().browser().cdpSupported)throw new He;return c(this,Qt).postData}hasPostData(){if(!c(this,Hr).page().browser().cdpSupported)throw new He;return c(this,Qt).hasPostData}async fetchPostData(){throw new He}headers(){const t={};for(const r of c(this,Qt).headers)t[r.name.toLowerCase()]=r.value.value;return{...t,...c(this,Cs,BR),...c(this,Cs,UR)}}response(){return c(this,p_)}failure(){return c(this,Qt).error===void 0?null:{errorText:c(this,Qt).error}}isNavigationRequest(){return c(this,Qt).navigation!==void 0}initiator(){var t;return{...c(this,Qt).initiator,type:((t=c(this,Qt).initiator)==null?void 0:t.type)??"other"}}redirectChain(){return c(this,Jl).slice()}frame(){return c(this,Hr)}async continue(t,r){return await super.continue({headers:c(this,Cs,DR)?this.headers():void 0,...t},r)}async _continue(t={}){const r=sH(t.headers);return this.interception.handled=!0,await c(this,Qt).continueRequest({url:t.url,method:t.method,body:t.postData?{type:"base64",value:WM(t.postData)}:void 0,headers:r.length>0?r:void 0}).catch(s=>(this.interception.handled=!1,bb(s)))}async _abort(){return this.interception.handled=!0,await c(this,Qt).failRequest().catch(t=>{throw this.interception.handled=!1,t})}async _respond(t,r){this.interception.handled=!0;let s;t.body&&(s=_b.getResponse(t.body));const i=sH(t.headers),a=i.some(u=>u.name==="content-length");t.contentType&&i.push({name:"content-type",value:{type:"string",value:t.contentType}}),s!=null&&s.contentLength&&!a&&i.push({name:"content-length",value:{type:"string",value:String(s.contentLength)}});const o=t.status||200;return await c(this,Qt).provideResponse({statusCode:o,headers:i.length>0?i:void 0,reasonPhrase:p$[o],body:s!=null&&s.base64?{type:"base64",value:s==null?void 0:s.base64}:void 0}).catch(u=>{throw this.interception.handled=!1,u})}timing(){return c(this,Qt).timing()}}Jl=new WeakMap,p_=new WeakMap,Hr=new WeakMap,Qt=new WeakMap,Cs=new WeakSet,M9=function(){c(this,Qt).on("redirect",t=>{const r=$I.from(t,c(this,Hr),this);c(this,Jl).push(this),t.once("success",()=>{c(this,Hr).page().trustedEmitter.emit("requestfinished",r)}),t.once("error",()=>{c(this,Hr).page().trustedEmitter.emit("requestfailed",r)}),r.finalizeInterceptions()}),c(this,Qt).once("success",t=>{x(this,p_,nH.from(t,this,c(this,Hr).page().browser().cdpSupported))}),c(this,Qt).on("authenticate",c(this,nE)),c(this,Hr).page().trustedEmitter.emit("request",this),c(this,Cs,DR)&&this.interception.handlers.push(async()=>{await this.continue({headers:this.headers()},0)})},DR=function(){return!!(Object.keys(c(this,Cs,BR)).length||Object.keys(c(this,Cs,UR)).length)},BR=function(){var t;return((t=c(this,Hr))==null?void 0:t.page()._extraHTTPHeaders)??{}},UR=function(){var t;return((t=c(this,Hr))==null?void 0:t.page()._userAgentHeaders)??{}},m_=new WeakMap,nE=new WeakMap,$I=FI;function sH(n){const e=[];for(const[t,r]of Object.entries(n??[]))if(!Object.is(r,void 0)){const s=Array.isArray(r)?r:[r];for(const i of s)e.push({name:t.toLowerCase(),value:{type:"string",value:String(i)}})}return e}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class iH extends Error{}class aH{static serialize(e){switch(typeof e){case"symbol":case"function":throw new iH(`Unable to serializable ${typeof e}`);case"object":return A(this,bp,N9).call(this,e);case"undefined":return{type:"undefined"};case"number":return A(this,bp,$9).call(this,e);case"bigint":return{type:"bigint",value:e.toString()};case"string":return{type:"string",value:e};case"boolean":return{type:"boolean",value:e}}}}bp=new WeakSet,$9=function(e){let t;return Object.is(e,-0)?t="-0":Object.is(e,1/0)?t="Infinity":Object.is(e,-1/0)?t="-Infinity":Object.is(e,NaN)?t="NaN":t=e,{type:"number",value:t}},N9=function(e){if(e===null)return{type:"null"};if(Array.isArray(e))return{type:"array",value:e.map(r=>this.serialize(r))};if(Pz(e)){try{JSON.stringify(e)}catch(r){throw r instanceof TypeError&&r.message.startsWith("Converting circular structure to JSON")&&(r.message+=" Recursive objects are not allowed."),r}const t=[];for(const r in e)t.push([this.serialize(r),this.serialize(e[r])]);return{type:"object",value:t}}else{if(Az(e))return{type:"regexp",value:{pattern:e.source,flags:e.flags}};if(Tz(e))return{type:"date",value:e.toISOString()}}throw new iH("Custom object serialization not possible. Use plain objects instead.")},_(aH,bp);/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */function jue(n){if(n.exception.type!=="error")return Zy.deserialize(n.exception);const[e="",...t]=n.text.split(": "),r=t.join(": "),s=new Error(r);s.name=e;const i=[];if(n.stackTrace&&i.length<Error.stackTraceLimit)for(const a of n.stackTrace.callFrames.reverse()){if(as.isPuppeteerURL(a.url)&&a.url!==as.INTERNAL_URL){const o=as.parse(a.url);i.unshift(`    at ${a.functionName||o.functionName} (${o.functionName} at ${o.siteString}, <anonymous>:${a.lineNumber}:${a.columnNumber})`)}else i.push(`    at ${a.functionName||"<anonymous>"} (${a.url}:${a.lineNumber}:${a.columnNumber})`);if(i.length>=Error.stackTraceLimit)break}return s.stack=[n.text,...i].join(`
`),s}function oH(n,e){return t=>{throw t instanceof su?t.message+=` at ${n}`:t instanceof nb&&(t.message=`Navigation timeout of ${e} ms exceeded`),t}}var Due=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},Bue=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});class LI extends k${constructor(t,r){super(r);_(this,g_);J(this,"realm");J(this,"internalPuppeteerUtil");this.realm=t}initialize(){this.realm.on("destroyed",({reason:t})=>{this.taskManager.terminateAll(new Error(t)),this.dispose()}),this.realm.on("updated",()=>{this.internalPuppeteerUtil=void 0,this.taskManager.rerunAll()})}get puppeteerUtil(){const t=Promise.resolve();return Wp.inject(r=>{this.internalPuppeteerUtil&&this.internalPuppeteerUtil.then(s=>{s.dispose()}),this.internalPuppeteerUtil=t.then(()=>this.evaluateHandle(r))},!this.internalPuppeteerUtil),this.internalPuppeteerUtil}async evaluateHandle(t,...r){return await A(this,g_,qR).call(this,!1,t,...r)}async evaluate(t,...r){return await A(this,g_,qR).call(this,!0,t,...r)}createHandle(t){return(t.type==="node"||t.type==="window")&&this instanceof dc?Jy.from(t,this):lc.from(t,this)}async serializeAsync(t){return t instanceof os&&(t=await t.get(this)),this.serialize(t)}serialize(t){if(t instanceof lc||t instanceof Jy){if(t.realm!==this){if(!(t.realm instanceof dc)||!(this instanceof dc))throw new Error("Trying to evaluate JSHandle from different global types. Usually this means you're using a handle from a worker in a page or vice versa.");if(t.realm.environment!==this.environment)throw new Error("Trying to evaluate JSHandle from different frames. Usually this means you're using a handle from a page on a different page.")}if(t.disposed)throw new Error("JSHandle is disposed!");return t.remoteValue()}return aH.serialize(t)}async destroyHandles(t){if(this.disposed)return;const r=t.map(({id:s})=>s).filter(s=>s!==void 0);r.length!==0&&await this.realm.disown(r).catch(s=>{Ee(s)})}async adoptHandle(t){return await this.evaluateHandle(r=>r,t)}async transferHandle(t){if(t.realm===this)return t;const r=this.adoptHandle(t);return await t.dispose(),await r}}g_=new WeakSet,qR=async function(t,r,...s){var d;const i=YM(((d=GM(r))==null?void 0:d.toString())??as.INTERNAL_URL);let a;const o=t?"none":"root",u=t?{}:{maxObjectDepth:0,maxDomDepth:0};if(Pa(r)){const h=ab.test(r)?r:`${r}
${i}
`;a=this.realm.evaluate(h,!0,{resultOwnership:o,userActivation:!0,serializationOptions:u})}else{let h=ji(r);h=ab.test(h)?h:`${h}
${i}
`,a=this.realm.callFunction(h,!0,{arguments:s.some(f=>f instanceof os)?await Promise.all(s.map(f=>this.serializeAsync(f))):s.map(f=>this.serialize(f)),resultOwnership:o,userActivation:!0,serializationOptions:u})}const l=await a;if("type"in l&&l.type==="exception")throw jue(l.exceptionDetails);return t?Zy.deserialize(l.result):this.createHandle(l.result)};const iE=class iE extends LI{constructor(t,r){super(t,r.timeoutSettings);_(this,sE);_(this,Sp);_(this,xp,!1);x(this,Sp,r)}static from(t,r){var i;const s=new iE(t,r);return A(i=s,sE,F9).call(i),s}get puppeteerUtil(){let t=Promise.resolve();return c(this,xp)||(t=Promise.all([Xy.from(this.environment,"__ariaQuerySelector",au.queryOne,!!this.sandbox),Xy.from(this.environment,"__ariaQuerySelectorAll",async(r,s)=>{const i=au.queryAll(r,s);return await r.realm.evaluateHandle((...a)=>a,...await gd.collect(i))},!!this.sandbox)]),x(this,xp,!0)),t.then(()=>super.puppeteerUtil)}get sandbox(){return this.realm.sandbox}get environment(){return c(this,Sp)}async adoptBackendNode(t){const r={stack:[],error:void 0,hasError:!1};try{const{object:s}=await c(this,Sp).client.send("DOM.resolveNode",{backendNodeId:t,executionContextId:await this.realm.resolveExecutionContextId()});return await Due(r,Jy.from({handle:s.objectId,type:"node"},this),!1).evaluateHandle(a=>a)}catch(s){r.error=s,r.hasError=!0}finally{Bue(r)}}};Sp=new WeakMap,sE=new WeakSet,F9=function(){BH(iE.prototype,this,"initialize").call(this),this.realm.on("updated",()=>{this.environment.clearDocumentHandle(),x(this,xp,!1)})},xp=new WeakMap;let dc=iE;const cO=class cO extends LI{constructor(t,r){super(t,r.timeoutSettings);_(this,y_);x(this,y_,r)}static from(t,r){const s=new cO(t,r);return s.initialize(),s}get environment(){return c(this,y_)}async adoptBackendNode(){throw new Error("Cannot adopt DOM nodes into a worker.")}};y_=new WeakMap;let Nx=cO;/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const uO=class uO extends C${constructor(t,r){super(r.origin);_(this,w_);_(this,v_);x(this,w_,t),x(this,v_,Nx.from(r,this))}static from(t,r){return new uO(t,r)}get frame(){return c(this,w_)}mainRealm(){return c(this,v_)}get client(){throw new He}};w_=new WeakMap,v_=new WeakMap;let jI=uO;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Uue=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Ku=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},cH=function(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})};function que(n){switch(n){case"group":return"startGroup";case"groupCollapsed":return"startGroupCollapsed";case"groupEnd":return"endGroup";default:return n}}let uH=(()=>{var h,f,p,L9,HR,ME,w,$E,NE,S;let n=h$,e=[],t,r,s,i,a,o,u,l,d;return S=class extends n{constructor(C,E){super();_(this,p);_(this,h,Uue(this,e));J(this,"browsingContext");_(this,f,new WeakMap);J(this,"realms");J(this,"_id");J(this,"client");J(this,"accessibility");_(this,w,new Map);x(this,h,C),this.browsingContext=E,this._id=E.id,this.client=new Vy(this),this.realms={default:dc.from(this.browsingContext.defaultRealm,this),internal:dc.from(this.browsingContext.createWindowRealm(`__puppeteer_internal_${Math.ceil(Math.random()*1e4)}`),this)},this.accessibility=new P$(this.realms.default,this._id)}static from(C,E){var I;const M=new S(C,E);return A(I=M,p,L9).call(I),M}get timeoutSettings(){return this.page()._timeoutSettings}mainRealm(){return this.realms.default}isolatedRealm(){return this.realms.internal}realm(C){for(const E of Object.values(this.realms))if(E.realm.id===C)return E}page(){let C=c(this,h);for(;C instanceof S;)C=c(C,h);return C}url(){return this.browsingContext.url}parentFrame(){return c(this,h)instanceof S?c(this,h):null}childFrames(){return[...this.browsingContext.children].map(C=>c(this,f).get(C))}async goto(C,E={}){const[M]=await Promise.all([this.waitForNavigation(E),this.browsingContext.navigate(C,"interactive").catch(I=>{if(!(Ts(I)&&I.message.includes("net::ERR_HTTP_RESPONSE_CODE_FAILURE"))&&!I.message.includes("navigation canceled")&&!I.message.includes("Navigation was aborted by another navigation"))throw I})]).catch(oH(C,E.timeout??this.timeoutSettings.navigationTimeout()));return M}async setContent(C,E={}){await Promise.all([this.setFrameContent(C),Or(Z_([c(this,p,$E).call(this,E),c(this,p,NE).call(this,E)]))])}async waitForNavigation(C={}){const{timeout:E=this.timeoutSettings.navigationTimeout(),signal:M}=C,I=this.childFrames().map(N=>{var O;return A(O=N,p,ME).call(O)});return await Or(Z_([BM(It(this.browsingContext,"navigation"),It(this.browsingContext,"historyUpdated").pipe(ar(()=>({navigation:null})))).pipe(hd()).pipe(Q_(({navigation:N})=>N===null?Li(null):c(this,p,$E).call(this,C).pipe(yz(()=>I.length===0?Li(void 0):Z_(I)),Vr(It(N,"fragment"),It(N,"failed"),It(N,"aborted").pipe(ar(({url:O})=>{throw new Error(`Navigation aborted: ${O}`)}))),Q_(()=>{if(N.request){let O=function(T){return N===null?Li(null):T.response||T.error?Li(N):T.redirect?O(T.redirect):It(T,"success").pipe(Vr(It(T,"error")),Vr(It(T,"redirect"))).pipe(Q_(()=>O(T)))};return O(N.request)}return Li(N)})))),c(this,p,NE).call(this,C)]).pipe(ar(([N])=>{if(!N)return null;const O=N.request;if(!O)return null;const T=O.lastRedirect??O;return NI.get(T).response()}),Vr(Fn(E),iu(M),A(this,p,ME).call(this).pipe(ar(()=>{throw new Zs("Frame detached.")})))))}waitForDevicePrompt(){throw new He}get detached(){return this.browsingContext.closed}async exposeFunction(C,E){if(c(this,w).has(C))throw new Error(`Failed to add page binding with name ${C}: globalThis['${C}'] already exists!`);const M=await Xy.from(this,C,E);c(this,w).set(C,M)}async removeExposedFunction(C){const E=c(this,w).get(C);if(!E)throw new Error(`Failed to remove page binding with name ${C}: window['${C}'] does not exists!`);c(this,w).delete(C),await E[Symbol.asyncDispose]()}async createCDPSession(){if(!this.page().browser().cdpSupported)throw new He;return await this.page().browser().cdpConnection._createSession({targetId:this._id})}async setFiles(C,E){await this.browsingContext.setFiles(C.remoteValue(),E)}async locateNodes(C,E){return await this.browsingContext.locateNodes(E,[C.remoteValue()])}},h=new WeakMap,f=new WeakMap,p=new WeakSet,L9=function(){for(const C of this.browsingContext.children)A(this,p,HR).call(this,C);this.browsingContext.on("browsingcontext",({browsingContext:C})=>{A(this,p,HR).call(this,C)}),this.browsingContext.on("closed",()=>{for(const C of Vy.sessions.values())C.frame===this&&C.onClose();this.page().trustedEmitter.emit("framedetached",this)}),this.browsingContext.on("request",({request:C})=>{const E=FI.from(C,this);C.once("success",()=>{this.page().trustedEmitter.emit("requestfinished",E)}),C.once("error",()=>{this.page().trustedEmitter.emit("requestfailed",E)}),E.finalizeInterceptions()}),this.browsingContext.on("navigation",({navigation:C})=>{C.once("fragment",()=>{this.page().trustedEmitter.emit("framenavigated",this)})}),this.browsingContext.on("load",()=>{this.page().trustedEmitter.emit("load",void 0)}),this.browsingContext.on("DOMContentLoaded",()=>{this._hasStartedLoading=!0,this.page().trustedEmitter.emit("domcontentloaded",void 0),this.page().trustedEmitter.emit("framenavigated",this)}),this.browsingContext.on("userprompt",({userPrompt:C})=>{this.page().trustedEmitter.emit("dialog",RI.from(C))}),this.browsingContext.on("log",({entry:C})=>{if(this._id===C.source.context)if(Hue(C)){const E=C.args.map(I=>this.mainRealm().createHandle(I)),M=E.reduce((I,N)=>{const O=N instanceof lc&&N.isPrimitiveValue?Zy.deserialize(N.remoteValue()):N.toString();return`${I} ${O}`},"").slice(1);this.page().trustedEmitter.emit("console",new wk(que(C.method),M,E,Wue(C.stackTrace),this))}else if(Kue(C)){const E=new Error(C.text??""),M=E.message.split(`
`).length,I=E.stack.split(`
`).splice(0,M),N=[];if(C.stackTrace){for(const O of C.stackTrace.callFrames)if(N.push(`    at ${O.functionName||"<anonymous>"} (${O.url}:${O.lineNumber+1}:${O.columnNumber+1})`),N.length>=Error.stackTraceLimit)break}E.stack=[...I,...N].join(`
`),this.page().trustedEmitter.emit("pageerror",E)}else Ee(`Unhandled LogEntry with type "${C.type}", text "${C.text}" and level "${C.level}"`)}),this.browsingContext.on("worker",({realm:C})=>{const E=jI.from(this,C);C.on("destroyed",()=>{this.page().trustedEmitter.emit("workerdestroyed",E)}),this.page().trustedEmitter.emit("workercreated",E)})},HR=function(C){const E=S.from(this,C);return c(this,f).set(C,E),this.page().trustedEmitter.emit("frameattached",E),C.on("closed",()=>{c(this,f).delete(C)}),E},ME=function(){return ru(()=>this.detached?Li(this):It(this.page().trustedEmitter,"framedetached").pipe(nu(C=>C===this)))},w=new WeakMap,$E=function(){return a.value},NE=function(){return u.value},(()=>{const C=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[ut],r=[ut],s=[ut],i=[ut],o=[ut],l=[ut],d=[ut],Ku(S,null,t,{kind:"method",name:"goto",static:!1,private:!1,access:{has:E=>"goto"in E,get:E=>E.goto},metadata:C},null,e),Ku(S,null,r,{kind:"method",name:"setContent",static:!1,private:!1,access:{has:E=>"setContent"in E,get:E=>E.setContent},metadata:C},null,e),Ku(S,null,s,{kind:"method",name:"waitForNavigation",static:!1,private:!1,access:{has:E=>"waitForNavigation"in E,get:E=>E.waitForNavigation},metadata:C},null,e),Ku(S,a={value:cH(function(E={}){let{waitUntil:M="load"}=E;const{timeout:I=this.timeoutSettings.navigationTimeout()}=E;Array.isArray(M)||(M=[M]);const N=new Set;for(const O of M)switch(O){case"load":{N.add("load");break}case"domcontentloaded":{N.add("DOMContentLoaded");break}}return N.size===0?Li(void 0):Z_([...N].map(O=>It(this.browsingContext,O))).pipe(ar(()=>{}),hd(),Vr(Fn(I),A(this,p,ME).call(this).pipe(ar(()=>{throw new Error("Frame detached.")}))))},"#waitForLoad$")},i,{kind:"method",name:"#waitForLoad$",static:!1,private:!0,access:{has:E=>Nn(p,E),get:E=>c(E,p,$E)},metadata:C},null,e),Ku(S,u={value:cH(function(E={}){let{waitUntil:M="load"}=E;Array.isArray(M)||(M=[M]);let I=1/0;for(const N of M)switch(N){case"networkidle0":{I=Math.min(0,I);break}case"networkidle2":{I=Math.min(2,I);break}}return I===1/0?Li(void 0):this.page().waitForNetworkIdle$({idleTime:500,timeout:E.timeout??this.timeoutSettings.timeout(),concurrency:I})},"#waitForNetworkIdle$")},o,{kind:"method",name:"#waitForNetworkIdle$",static:!1,private:!0,access:{has:E=>Nn(p,E),get:E=>c(E,p,NE)},metadata:C},null,e),Ku(S,null,l,{kind:"method",name:"setFiles",static:!1,private:!1,access:{has:E=>"setFiles"in E,get:E=>E.setFiles},metadata:C},null,e),Ku(S,null,d,{kind:"method",name:"locateNodes",static:!1,private:!1,access:{has:E=>"locateNodes"in E,get:E=>E.locateNodes},metadata:C},null,e),C&&Object.defineProperty(S,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:C})})(),S})();function Hue(n){return n.type==="console"}function Kue(n){return n.type==="javascript"}function Wue(n){const e=[];if(n)for(const t of n.callFrames)e.push({url:t.url,lineNumber:t.lineNumber,columnNumber:t.columnNumber});return e}/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var ts;(function(n){n.None="none",n.Key="key",n.Pointer="pointer",n.Wheel="wheel"})(ts||(ts={}));var Gt;(function(n){n.Pause="pause",n.KeyDown="keyDown",n.KeyUp="keyUp",n.PointerUp="pointerUp",n.PointerDown="pointerDown",n.PointerMove="pointerMove",n.Scroll="scroll"})(Gt||(Gt={}));const Yy=n=>{switch(n){case"\r":case`
`:n="Enter";break}if([...n].length===1)return n;switch(n){case"Cancel":return"";case"Help":return"";case"Backspace":return"";case"Tab":return"";case"Clear":return"";case"Enter":return"";case"Shift":case"ShiftLeft":return"";case"Control":case"ControlLeft":return"";case"Alt":case"AltLeft":return"";case"Pause":return"";case"Escape":return"";case"PageUp":return"";case"PageDown":return"";case"End":return"";case"Home":return"";case"ArrowLeft":return"";case"ArrowUp":return"";case"ArrowRight":return"";case"ArrowDown":return"";case"Insert":return"";case"Delete":return"";case"NumpadEqual":return"";case"Numpad0":return"";case"Numpad1":return"";case"Numpad2":return"";case"Numpad3":return"";case"Numpad4":return"";case"Numpad5":return"";case"Numpad6":return"";case"Numpad7":return"";case"Numpad8":return"";case"Numpad9":return"";case"NumpadMultiply":return"";case"NumpadAdd":return"";case"NumpadSubtract":return"";case"NumpadDecimal":return"";case"NumpadDivide":return"";case"F1":return"";case"F2":return"";case"F3":return"";case"F4":return"";case"F5":return"";case"F6":return"";case"F7":return"";case"F8":return"";case"F9":return"";case"F10":return"";case"F11":return"";case"F12":return"";case"Meta":case"MetaLeft":return"";case"ShiftRight":return"";case"ControlRight":return"";case"AltRight":return"";case"MetaRight":return"";case"Digit0":return"0";case"Digit1":return"1";case"Digit2":return"2";case"Digit3":return"3";case"Digit4":return"4";case"Digit5":return"5";case"Digit6":return"6";case"Digit7":return"7";case"Digit8":return"8";case"Digit9":return"9";case"KeyA":return"a";case"KeyB":return"b";case"KeyC":return"c";case"KeyD":return"d";case"KeyE":return"e";case"KeyF":return"f";case"KeyG":return"g";case"KeyH":return"h";case"KeyI":return"i";case"KeyJ":return"j";case"KeyK":return"k";case"KeyL":return"l";case"KeyM":return"m";case"KeyN":return"n";case"KeyO":return"o";case"KeyP":return"p";case"KeyQ":return"q";case"KeyR":return"r";case"KeyS":return"s";case"KeyT":return"t";case"KeyU":return"u";case"KeyV":return"v";case"KeyW":return"w";case"KeyX":return"x";case"KeyY":return"y";case"KeyZ":return"z";case"Semicolon":return";";case"Equal":return"=";case"Comma":return",";case"Minus":return"-";case"Period":return".";case"Slash":return"/";case"Backquote":return"`";case"BracketLeft":return"[";case"Backslash":return"\\";case"BracketRight":return"]";case"Quote":return'"';default:throw new Error(`Unknown key: "${n}"`)}};class lH extends y${constructor(t){super();_(this,xo);x(this,xo,t)}async down(t,r){await c(this,xo).mainFrame().browsingContext.performActions([{type:ts.Key,id:"__puppeteer_keyboard",actions:[{type:Gt.KeyDown,value:Yy(t)}]}])}async up(t){await c(this,xo).mainFrame().browsingContext.performActions([{type:ts.Key,id:"__puppeteer_keyboard",actions:[{type:Gt.KeyUp,value:Yy(t)}]}])}async press(t,r={}){const{delay:s=0}=r,i=[{type:Gt.KeyDown,value:Yy(t)}];s>0&&i.push({type:Gt.Pause,duration:s}),i.push({type:Gt.KeyUp,value:Yy(t)}),await c(this,xo).mainFrame().browsingContext.performActions([{type:ts.Key,id:"__puppeteer_keyboard",actions:i}])}async type(t,r={}){const{delay:s=0}=r,i=[...t].map(Yy),a=[];if(s<=0)for(const o of i)a.push({type:Gt.KeyDown,value:o},{type:Gt.KeyUp,value:o});else for(const o of i)a.push({type:Gt.KeyDown,value:o},{type:Gt.Pause,duration:s},{type:Gt.KeyUp,value:o});await c(this,xo).mainFrame().browsingContext.performActions([{type:ts.Key,id:"__puppeteer_keyboard",actions:a}])}async sendCharacter(t){if([...t].length>1)throw new Error("Cannot send more than 1 character.");await(await c(this,xo).focusedFrame()).isolatedRealm().evaluate(async s=>{document.execCommand("insertText",!1,s)},t)}}xo=new WeakMap;const DI=n=>{switch(n){case zt.Left:return 0;case zt.Middle:return 1;case zt.Right:return 2;case zt.Back:return 3;case zt.Forward:return 4}};class dH extends w${constructor(t){super();_(this,Sa);_(this,Xl,{x:0,y:0});x(this,Sa,t)}async reset(){x(this,Xl,{x:0,y:0}),await c(this,Sa).mainFrame().browsingContext.releaseActions()}async move(t,r,s={}){const i=c(this,Xl),a={x:Math.round(t),y:Math.round(r)},o=[],u=s.steps??0;for(let l=0;l<u;++l)o.push({type:Gt.PointerMove,x:i.x+(a.x-i.x)*(l/u),y:i.y+(a.y-i.y)*(l/u),origin:s.origin});o.push({type:Gt.PointerMove,...a,origin:s.origin}),x(this,Xl,a),await c(this,Sa).mainFrame().browsingContext.performActions([{type:ts.Pointer,id:"__puppeteer_mouse",actions:o}])}async down(t={}){await c(this,Sa).mainFrame().browsingContext.performActions([{type:ts.Pointer,id:"__puppeteer_mouse",actions:[{type:Gt.PointerDown,button:DI(t.button??zt.Left)}]}])}async up(t={}){await c(this,Sa).mainFrame().browsingContext.performActions([{type:ts.Pointer,id:"__puppeteer_mouse",actions:[{type:Gt.PointerUp,button:DI(t.button??zt.Left)}]}])}async click(t,r,s={}){const i=[{type:Gt.PointerMove,x:Math.round(t),y:Math.round(r),origin:s.origin}],a={type:Gt.PointerDown,button:DI(s.button??zt.Left)},o={type:Gt.PointerUp,button:a.button};for(let u=1;u<(s.count??1);++u)i.push(a,o);i.push(a),s.delay&&i.push({type:Gt.Pause,duration:s.delay}),i.push(o),await c(this,Sa).mainFrame().browsingContext.performActions([{type:ts.Pointer,id:"__puppeteer_mouse",actions:i}])}async wheel(t={}){await c(this,Sa).mainFrame().browsingContext.performActions([{type:ts.Wheel,id:"__puppeteer_wheel",actions:[{type:Gt.Scroll,...c(this,Xl)??{x:0,y:0},deltaX:t.deltaX??0,deltaY:t.deltaY??0}]}])}drag(){throw new He}dragOver(){throw new He}dragEnter(){throw new He}drop(){throw new He}dragAndDrop(){throw new He}}Sa=new WeakMap,Xl=new WeakMap;class zue{constructor(e,t,r,s,i,a){_(this,__,!1);_(this,b_);_(this,S_);_(this,Yl);_(this,Ql);_(this,x_);_(this,Ep);x(this,Ql,e),x(this,x_,t),x(this,b_,Math.round(s)),x(this,S_,Math.round(i)),x(this,Ep,a),x(this,Yl,`__puppeteer_finger_${r}`)}async start(e={}){if(c(this,__))throw new sb("Touch has already started");await c(this,Ql).mainFrame().browsingContext.performActions([{type:ts.Pointer,id:c(this,Yl),parameters:{pointerType:"touch"},actions:[{type:Gt.PointerMove,x:c(this,b_),y:c(this,S_),origin:e.origin},{...c(this,Ep),type:Gt.PointerDown,button:0}]}]),x(this,__,!0)}move(e,t){const r=Math.round(e),s=Math.round(t);return c(this,Ql).mainFrame().browsingContext.performActions([{type:ts.Pointer,id:c(this,Yl),parameters:{pointerType:"touch"},actions:[{...c(this,Ep),type:Gt.PointerMove,x:r,y:s}]}])}async end(){await c(this,Ql).mainFrame().browsingContext.performActions([{type:ts.Pointer,id:c(this,Yl),parameters:{pointerType:"touch"},actions:[{type:Gt.PointerUp,button:0}]}]),c(this,x_).removeHandle(this)}}__=new WeakMap,b_=new WeakMap,S_=new WeakMap,Yl=new WeakMap,Ql=new WeakMap,x_=new WeakMap,Ep=new WeakMap;class hH extends v${constructor(t){super();_(this,E_);x(this,E_,t)}async touchStart(t,r,s={}){const i=this.idGenerator(),a={width:.5*2,height:.5*2,pressure:.5,altitudeAngle:Math.PI/2},o=new zue(c(this,E_),this,i,t,r,a);return await o.start(s),this.touches.push(o),o}}E_=new WeakMap;/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Vue=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},fH=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},pH=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},mH=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});let Qy=(()=>{var s,i,a,o,u,l,d,h,j9,p,m,g,y,w,B_,KR,WR,P;let n=S$,e,t=[],r=[];return P=class extends n{constructor(E,M){super();_(this,h);_(this,s,fH(this,t,new Ae));_(this,i,fH(this,r));_(this,a);_(this,o,null);_(this,u,new Set);J(this,"keyboard");J(this,"mouse");J(this,"touchscreen");J(this,"tracing");J(this,"coverage");_(this,l);_(this,d);J(this,"_userAgentHeaders",{});_(this,p);_(this,m);_(this,g);J(this,"_extraHTTPHeaders",{});_(this,y);J(this,"_credentials",null);_(this,w);x(this,i,E),x(this,a,uH.from(this,M)),x(this,l,new O$(c(this,a).client)),this.tracing=new K$(c(this,a).client),this.coverage=new T$(c(this,a).client),this.keyboard=new lH(this),this.mouse=new dH(this),this.touchscreen=new hH(this)}static from(E,M){var N;const I=new P(E,M);return A(N=I,h,j9).call(N),I}get trustedEmitter(){return c(this,s)}set trustedEmitter(E){x(this,s,E)}_client(){return c(this,a).client}async setUserAgent(E,M){if(!c(this,i).browser().cdpSupported&&M)throw new He("Current Browser does not support `userAgentMetadata`");if(c(this,i).browser().cdpSupported&&M)return await this._client().send("Network.setUserAgentOverride",{userAgent:E,userAgentMetadata:M});const I=E!=="";E=E??await c(this,i).browser().userAgent(),this._userAgentHeaders=I?{"User-Agent":E}:{},x(this,p,await A(this,h,B_).call(this,["beforeRequestSent"],c(this,p),I));const N=L=>{Object.defineProperty(navigator,"userAgent",{value:L})},O=[c(this,a)];for(const L of O)O.push(...L.childFrames());c(this,m)&&await this.removeScriptToEvaluateOnNewDocument(c(this,m));const[T]=await Promise.all([I?this.evaluateOnNewDocument(N,E):void 0,O.map(L=>L.evaluate(N,E))]);x(this,m,T==null?void 0:T.identifier)}async setBypassCSP(E){await this._client().send("Page.setBypassCSP",{enabled:E})}async queryObjects(E){ae(!E.disposed,"Prototype JSHandle is disposed!"),ae(E.id,"Prototype JSHandle must not be referencing primitive value");const M=await c(this,a).client.send("Runtime.queryObjects",{prototypeObjectId:E.id});return c(this,a).mainRealm().createHandle({type:"array",handle:M.objects.objectId})}browser(){return this.browserContext().browser()}browserContext(){return c(this,i)}mainFrame(){return c(this,a)}async focusedFrame(){const E={stack:[],error:void 0,hasError:!1};try{const I=pH(E,await this.mainFrame().isolatedRealm().evaluateHandle(()=>{let O=window;for(;(O.document.activeElement instanceof O.HTMLIFrameElement||O.document.activeElement instanceof O.HTMLFrameElement)&&O.document.activeElement.contentWindow!==null;)O=O.document.activeElement.contentWindow;return O}),!1).remoteValue();ae(I.type==="window");const N=this.frames().find(O=>O._id===I.value.context);return ae(N),N}catch(M){E.error=M,E.hasError=!0}finally{mH(E)}}frames(){const E=[c(this,a)];for(const M of E)E.push(...M.childFrames());return E}isClosed(){return c(this,a).detached}async close(E){const M={stack:[],error:void 0,hasError:!1};try{const I=pH(M,await c(this,i).waitForScreenshotOperations(),!1);try{await c(this,a).browsingContext.close(E==null?void 0:E.runBeforeUnload)}catch{return}}catch(I){M.error=I,M.hasError=!0}finally{mH(M)}}async reload(E={}){const[M]=await Promise.all([c(this,a).waitForNavigation(E),c(this,a).browsingContext.reload()]).catch(oH(this.url(),E.timeout??this._timeoutSettings.navigationTimeout()));return M}setDefaultNavigationTimeout(E){this._timeoutSettings.setDefaultNavigationTimeout(E)}setDefaultTimeout(E){this._timeoutSettings.setDefaultTimeout(E)}getDefaultTimeout(){return this._timeoutSettings.timeout()}getDefaultNavigationTimeout(){return this._timeoutSettings.navigationTimeout()}isJavaScriptEnabled(){return c(this,l).javascriptEnabled}async setGeolocation(E){return await c(this,l).setGeolocation(E)}async setJavaScriptEnabled(E){return await c(this,l).setJavaScriptEnabled(E)}async emulateMediaType(E){return await c(this,l).emulateMediaType(E)}async emulateCPUThrottling(E){return await c(this,l).emulateCPUThrottling(E)}async emulateMediaFeatures(E){return await c(this,l).emulateMediaFeatures(E)}async emulateTimezone(E){return await c(this,l).emulateTimezone(E)}async emulateIdleState(E){return await c(this,l).emulateIdleState(E)}async emulateVisionDeficiency(E){return await c(this,l).emulateVisionDeficiency(E)}async setViewport(E){if(!this.browser().cdpSupported){await c(this,a).browsingContext.setViewport({viewport:E!=null&&E.width&&(E!=null&&E.height)?{width:E.width,height:E.height}:null,devicePixelRatio:E!=null&&E.deviceScaleFactor?E.deviceScaleFactor:null}),x(this,o,E);return}const M=await c(this,l).emulateViewport(E);x(this,o,E),M&&await this.reload()}viewport(){return c(this,o)}async pdf(E={}){const{timeout:M=this._timeoutSettings.timeout(),path:I=void 0}=E,{printBackground:N,margin:O,landscape:T,width:L,height:U,pageRanges:Z,scale:j,preferCSSPageSize:F}=QM(E,"cm"),B=Z?Z.split(", "):[];await Or(pt(this.mainFrame().isolatedRealm().evaluate(()=>document.fonts.ready)).pipe(Vr(Fn(M))));const D=await Or(pt(c(this,a).browsingContext.print({background:N,margin:O,orientation:T?"landscape":"portrait",page:{width:L,height:U},pageRanges:B,scale:j,shrinkToFit:!F})).pipe(Vr(Fn(M)))),W=rk(D,!0);return await this._maybeWriteTypedArrayToFile(I,W),W}async createPDFStream(E){const M=await this.pdf(E);return new ReadableStream({start(I){I.enqueue(M),I.close()}})}async _screenshot(E){const{clip:M,type:I,captureBeyondViewport:N,quality:O}=E;if(E.omitBackground!==void 0&&E.omitBackground)throw new He("BiDi does not support 'omitBackground'.");if(E.optimizeForSpeed!==void 0&&E.optimizeForSpeed)throw new He("BiDi does not support 'optimizeForSpeed'.");if(E.fromSurface!==void 0&&!E.fromSurface)throw new He("BiDi does not support 'fromSurface'.");if(M!==void 0&&M.scale!==void 0&&M.scale!==1)throw new He("BiDi does not support 'scale' in 'clip'.");let T;if(M)if(N)T=M;else{const[U,Z]=await this.evaluate(()=>{if(!window.visualViewport)throw new Error("window.visualViewport is not supported.");return[window.visualViewport.pageLeft,window.visualViewport.pageTop]});T={...M,x:M.x-U,y:M.y-Z}}return await c(this,a).browsingContext.captureScreenshot({origin:N?"document":"viewport",format:{type:`image/${I}`,...O!==void 0?{quality:O/100}:{}},...T?{clip:{type:"box",...T}}:{}})}async createCDPSession(){return await c(this,a).createCDPSession()}async bringToFront(){await c(this,a).browsingContext.activate()}async evaluateOnNewDocument(E,...M){const I=Gue(E,...M);return{identifier:await c(this,a).browsingContext.addPreloadScript(I)}}async removeScriptToEvaluateOnNewDocument(E){await c(this,a).browsingContext.removePreloadScript(E)}async exposeFunction(E,M){return await this.mainFrame().exposeFunction(E,"default"in M?M.default:M)}isDragInterceptionEnabled(){return!1}async setCacheEnabled(E){if(!c(this,i).browser().cdpSupported){await c(this,a).browsingContext.setCacheBehavior(E?"default":"bypass");return}await this._client().send("Network.setCacheDisabled",{cacheDisabled:!E})}async cookies(...E){const M=(E.length?E:[this.url()]).map(N=>new URL(N));return(await c(this,a).browsingContext.getCookies()).map(N=>BI(N)).filter(N=>M.some(O=>Xue(N,O)))}isServiceWorkerBypassed(){throw new He}target(){throw new He}waitForFileChooser(){throw new He}workers(){return[...c(this,u)]}async setRequestInterception(E){x(this,g,await A(this,h,B_).call(this,["beforeRequestSent"],c(this,g),E))}async setExtraHTTPHeaders(E){const M={};for(const[I,N]of Object.entries(E))ae(Pa(N),`Expected value of header "${I}" to be String, but "${typeof N}" is found.`),M[I.toLowerCase()]=N;this._extraHTTPHeaders=M,x(this,y,await A(this,h,B_).call(this,["beforeRequestSent"],c(this,y),!!Object.keys(this._extraHTTPHeaders).length))}async authenticate(E){x(this,w,await A(this,h,B_).call(this,["authRequired"],c(this,w),!!E)),this._credentials=E}setDragInterception(){throw new He}setBypassServiceWorker(){throw new He}async setOfflineMode(E){if(!c(this,i).browser().cdpSupported)throw new He;return c(this,d)||x(this,d,{offline:!1,upload:-1,download:-1,latency:0}),c(this,d).offline=E,await A(this,h,KR).call(this)}async emulateNetworkConditions(E){if(!c(this,i).browser().cdpSupported)throw new He;return c(this,d)||x(this,d,{offline:!1,upload:-1,download:-1,latency:0}),c(this,d).upload=E?E.upload:-1,c(this,d).download=E?E.download:-1,c(this,d).latency=E?E.latency:0,await A(this,h,KR).call(this)}async setCookie(...E){const M=this.url(),I=M.startsWith("http");for(const N of E){let O=N.url||"";!O&&I&&(O=M),ae(O!=="about:blank",`Blank page can not have cookie "${N.name}"`),ae(!String.prototype.startsWith.call(O||"","data:"),`Data URL page can not have cookie "${N.name}"`),ae(N.partitionKey===void 0||typeof N.partitionKey=="string","BiDi only allows domain partition keys");const T=URL.canParse(O)?new URL(O):void 0,L=N.domain??(T==null?void 0:T.hostname);ae(L!==void 0,"At least one of the url and domain needs to be specified");const U={domain:L,name:N.name,value:{type:"string",value:N.value},...N.path!==void 0?{path:N.path}:{},...N.httpOnly!==void 0?{httpOnly:N.httpOnly}:{},...N.secure!==void 0?{secure:N.secure}:{},...N.sameSite!==void 0?{sameSite:qI(N.sameSite)}:{},expiry:HI(N.expires),...UI(N,"sameParty","sourceScheme","priority","url")};N.partitionKey!==void 0?await this.browserContext().userContext.setCookie(U,N.partitionKey):await c(this,a).browsingContext.setCookie(U)}}async deleteCookie(...E){await Promise.all(E.map(async M=>{const I=M.url??this.url(),N=URL.canParse(I)?new URL(I):void 0,O=M.domain??(N==null?void 0:N.hostname);ae(O!==void 0,"At least one of the url and domain needs to be specified");const T={domain:O,name:M.name,...M.path!==void 0?{path:M.path}:{}};await c(this,a).browsingContext.deleteCookie(T)}))}async removeExposedFunction(E){await c(this,a).removeExposedFunction(E)}metrics(){throw new He}async goBack(E={}){return await A(this,h,WR).call(this,-1,E)}async goForward(E={}){return await A(this,h,WR).call(this,1,E)}waitForDevicePrompt(){throw new He}},s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakSet,j9=function(){c(this,a).browsingContext.on("closed",()=>{this.trustedEmitter.emit("close",void 0),this.trustedEmitter.removeAllListeners()}),this.trustedEmitter.on("workercreated",E=>{c(this,u).add(E)}),this.trustedEmitter.on("workerdestroyed",E=>{c(this,u).delete(E)})},p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,B_=async function(E,M,I){if(I&&!M)return await c(this,a).browsingContext.addIntercept({phases:E});if(!I&&M){await c(this,a).browsingContext.userContext.browser.removeIntercept(M);return}return M},KR=async function(){c(this,d)&&await this._client().send("Network.emulateNetworkConditions",{offline:c(this,d).offline,latency:c(this,d).latency,uploadThroughput:c(this,d).upload,downloadThroughput:c(this,d).download})},WR=async function(E,M){const I=new AbortController;try{const[N]=await Promise.all([this.waitForNavigation({...M,signal:I.signal}),c(this,a).browsingContext.traverseHistory(E)]);return N}catch(N){if(I.abort(),Ts(N)&&N.message.includes("no such history entry"))return null;throw N}},(()=>{const E=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;e=[pb()],Vue(P,null,e,{kind:"accessor",name:"trustedEmitter",static:!1,private:!1,access:{has:M=>"trustedEmitter"in M,get:M=>M.trustedEmitter,set:(M,I)=>{M.trustedEmitter=I}},metadata:E},t,r),E&&Object.defineProperty(P,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:E})})(),P})();function Gue(n,...e){return`() => {${sk(n,...e)}}`}function Zue(n,e){const t=n.domain.toLowerCase(),r=e.hostname.toLowerCase();return t===r?!0:t.startsWith(".")&&r.endsWith(t)}function Jue(n,e){const t=e.pathname,r=n.path;return!!(t===r||t.startsWith(r)&&(r.endsWith("/")||t[r.length]==="/"))}function Xue(n,e){const t=new URL(e);return ae(n!==void 0),Zue(n,t)?Jue(n,t):!1}function BI(n,e=!1){const t=n[Fx+"partitionKey"];function r(){return typeof t=="string"?{partitionKey:t}:typeof t=="object"&&t!==null?e?{partitionKey:{sourceOrigin:t.topLevelSite,hasCrossSiteAncestor:t.hasCrossSiteAncestor??!1}}:{partitionKey:t.topLevelSite}:{}}return{name:n.name,value:n.value.value,domain:n.domain,path:n.path,size:n.size,httpOnly:n.httpOnly,secure:n.secure,sameSite:Que(n.sameSite),expires:n.expiry??-1,session:n.expiry===void 0||n.expiry<=0,...Yue(n,"sameParty","sourceScheme","partitionKeyOpaque","priority"),...r()}}const Fx="goog:";function Yue(n,...e){const t={};for(const r of e)n[Fx+r]!==void 0&&(t[r]=n[Fx+r]);return t}function UI(n,...e){const t={};for(const r of e)n[r]!==void 0&&(t[Fx+r]=n[r]);return t}function Que(n){return n==="strict"?"Strict":n==="lax"?"Lax":"None"}function qI(n){return n==="Strict"?"strict":n==="Lax"?"lax":"none"}function HI(n){return[void 0,-1].includes(n)?void 0:n}function gH(n){if(n===void 0||typeof n=="string")return n;if(n.hasCrossSiteAncestor)throw new He("WebDriver BiDi does not support `hasCrossSiteAncestor` yet.");return n.sourceOrigin}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class ele extends Zp{constructor(t){super();_(this,kp);x(this,kp,t)}asPage(){throw new He}url(){return""}createCDPSession(){throw new He}type(){return Zr.BROWSER}browser(){return c(this,kp)}browserContext(){return c(this,kp).defaultBrowserContext()}opener(){throw new He}}kp=new WeakMap;class tle extends Zp{constructor(t){super();_(this,Eo);x(this,Eo,t)}async page(){return c(this,Eo)}async asPage(){return Qy.from(this.browserContext(),c(this,Eo).mainFrame().browsingContext)}url(){return c(this,Eo).url()}createCDPSession(){return c(this,Eo).createCDPSession()}type(){return Zr.PAGE}browser(){return this.browserContext().browser()}browserContext(){return c(this,Eo).browserContext()}opener(){throw new He}}Eo=new WeakMap;class rle extends Zp{constructor(t){super();_(this,ko);_(this,Cp);x(this,ko,t)}async page(){return c(this,Cp)===void 0&&x(this,Cp,Qy.from(this.browserContext(),c(this,ko).browsingContext)),c(this,Cp)}async asPage(){return Qy.from(this.browserContext(),c(this,ko).browsingContext)}url(){return c(this,ko).url()}createCDPSession(){return c(this,ko).createCDPSession()}type(){return Zr.PAGE}browser(){return this.browserContext().browser()}browserContext(){return c(this,ko).page().browserContext()}opener(){throw new He}}ko=new WeakMap,Cp=new WeakMap;class nle extends Zp{constructor(t){super();_(this,Pp);x(this,Pp,t)}async page(){throw new He}async asPage(){throw new He}url(){return c(this,Pp).url()}createCDPSession(){throw new He}type(){return Zr.OTHER}browser(){return this.browserContext().browser()}browserContext(){return c(this,Pp).frame.page().browserContext()}opener(){throw new He}}Pp=new WeakMap;/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var sle=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},yH=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},ile=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},ale=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});let wH=(()=>{var s,i,a,o,u,l,d,D9,zR,p;let n=t$,e,t=[],r=[];return p=class extends n{constructor(y,w,v){super();_(this,d);_(this,s,yH(this,t,new Ae));_(this,i,yH(this,r));_(this,a);J(this,"userContext");_(this,o,new WeakMap);_(this,u,new Map);_(this,l,[]);x(this,i,y),this.userContext=w,x(this,a,v.defaultViewport)}static from(y,w,v){var S;const b=new p(y,w,v);return A(S=b,d,D9).call(S),b}get trustedEmitter(){return c(this,s)}set trustedEmitter(y){x(this,s,y)}targets(){return[...c(this,u).values()].flatMap(([y,w])=>[y,...w.values()])}async newPage(){const y={stack:[],error:void 0,hasError:!1};try{const w=ile(y,await this.waitForScreenshotOperations(),!1),v=await this.userContext.createBrowsingContext("tab"),b=c(this,o).get(v);if(!b)throw new Error("Page is not found");if(c(this,a))try{await b.setViewport(c(this,a))}catch{}return b}catch(w){y.error=w,y.hasError=!0}finally{ale(y)}}async close(){ae(this.userContext.id!==$x.DEFAULT,"Default BrowserContext cannot be closed!");try{await this.userContext.remove()}catch(y){Ee(y)}c(this,u).clear()}browser(){return c(this,i)}async pages(){return[...this.userContext.browsingContexts].map(y=>c(this,o).get(y))}async overridePermissions(y,w){const v=new Set(w.map(b=>{if(!ak.get(b))throw new Error("Unknown permission: "+b);return b}));await Promise.all(Array.from(ak.keys()).map(b=>{const S=this.userContext.setPermissions(y,{name:b},v.has(b)?"granted":"denied");return c(this,l).push({origin:y,permission:b}),v.has(b)?S:S.catch(Ee)}))}async clearPermissionOverrides(){const y=c(this,l).map(({permission:w,origin:v})=>this.userContext.setPermissions(v,{name:w},"prompt").catch(Ee));x(this,l,[]),await Promise.all(y)}get id(){if(this.userContext.id!==$x.DEFAULT)return this.userContext.id}async cookies(){return(await this.userContext.getCookies()).map(w=>BI(w,!0))}async setCookie(...y){await Promise.all(y.map(async w=>{const v={domain:w.domain,name:w.name,value:{type:"string",value:w.value},...w.path!==void 0?{path:w.path}:{},...w.httpOnly!==void 0?{httpOnly:w.httpOnly}:{},...w.secure!==void 0?{secure:w.secure}:{},...w.sameSite!==void 0?{sameSite:qI(w.sameSite)}:{},expiry:HI(w.expires),...UI(w,"sameParty","sourceScheme","priority","url")};return await this.userContext.setCookie(v,gH(w.partitionKey))}))}},s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakSet,D9=function(){for(const y of this.userContext.browsingContexts)A(this,d,zR).call(this,y);this.userContext.on("browsingcontext",({browsingContext:y})=>{const w=A(this,d,zR).call(this,y);if(y.originalOpener)for(const v of this.userContext.browsingContexts)v.id===y.originalOpener&&c(this,o).get(v).trustedEmitter.emit("popup",w)}),this.userContext.on("closed",()=>{this.trustedEmitter.removeAllListeners()})},zR=function(y){const w=Qy.from(this,y);c(this,o).set(y,w),w.trustedEmitter.on("close",()=>{c(this,o).delete(y)});const v=new tle(w),b=new Map;return c(this,u).set(w,[v,b]),w.trustedEmitter.on("frameattached",S=>{const P=S,k=new rle(P);b.set(P,k),this.trustedEmitter.emit("targetcreated",k)}),w.trustedEmitter.on("framenavigated",S=>{const P=S,k=b.get(P);k===void 0?this.trustedEmitter.emit("targetchanged",v):this.trustedEmitter.emit("targetchanged",k)}),w.trustedEmitter.on("framedetached",S=>{const P=S,k=b.get(P);k!==void 0&&(b.delete(P),this.trustedEmitter.emit("targetdestroyed",k))}),w.trustedEmitter.on("workercreated",S=>{const P=S,k=new nle(P);b.set(P,k),this.trustedEmitter.emit("targetcreated",k)}),w.trustedEmitter.on("workerdestroyed",S=>{const P=S,k=b.get(P);k!==void 0&&(b.delete(S),this.trustedEmitter.emit("targetdestroyed",k))}),w.trustedEmitter.on("close",()=>{c(this,u).delete(w),this.trustedEmitter.emit("targetdestroyed",v)}),this.trustedEmitter.emit("targetcreated",v),w},(()=>{const y=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;e=[pb()],sle(p,null,e,{kind:"accessor",name:"trustedEmitter",static:!1,private:!1,access:{has:w=>"trustedEmitter"in w,get:w=>w.trustedEmitter,set:(w,v)=>{w.trustedEmitter=v}},metadata:y},t,r),y&&Object.defineProperty(p,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:y})})(),p})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var ole=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Jh=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},cle=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},ule=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});let lle=(()=>{var u,l,d,h,f,p,B9,U9,q9,VR,v;let n=Ae,e=[],t,r,s,i,a,o;return v=class extends n{constructor(P){super();_(this,p);_(this,u,(ole(this,e),!1));_(this,l);_(this,d,new lr);_(this,h,new Map);J(this,"session");_(this,f,new Map);this.session=P}static async from(P){var C;const k=new v(P);return await A(C=k,p,B9).call(C),k}get closed(){return c(this,u)}get defaultUserContext(){return c(this,h).get($x.DEFAULT)}get disconnected(){return c(this,l)!==void 0}get disposed(){return this.disconnected}get userContexts(){return c(this,h).values()}dispose(P,k=!1){x(this,u,k),x(this,l,P),this[je]()}async close(){try{await this.session.send("browser.close",{})}finally{this.dispose("Browser already closed.",!0)}}async addPreloadScript(P,k={}){var E;const{result:{script:C}}=await this.session.send("script.addPreloadScript",{functionDeclaration:P,...k,contexts:(E=k.contexts)==null?void 0:E.map(M=>M.id)});return C}async removeIntercept(P){await this.session.send("network.removeIntercept",{intercept:P})}async removePreloadScript(P){await this.session.send("script.removePreloadScript",{script:P})}async createUserContext(){const{result:{userContext:P}}=await this.session.send("browser.createUserContext",{});return A(this,p,VR).call(this,P)}[(t=[Ro],r=[le(P=>c(P,l))],s=[le(P=>c(P,l))],i=[le(P=>c(P,l))],a=[le(P=>c(P,l))],o=[le(P=>c(P,l))],je)](){c(this,l)??x(this,l,"Browser was disconnected, probably because the session ended."),this.closed&&this.emit("closed",{reason:c(this,l)}),this.emit("disconnected",{reason:c(this,l)}),c(this,d).dispose(),super[je]()}},u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakSet,B9=async function(){const P=c(this,d).use(new Ae(this.session));P.once("ended",({reason:k})=>{this.dispose(k)}),P.on("script.realmCreated",k=>{k.type==="shared-worker"&&c(this,f).set(k.realm,OI.from(this,k.realm,k.origin))}),await A(this,p,U9).call(this),await A(this,p,q9).call(this)},U9=async function(){const{result:{userContexts:P}}=await this.session.send("browser.getUserContexts",{});for(const k of P)A(this,p,VR).call(this,k.userContext)},q9=async function(){const P=new Set;let k;{const C={stack:[],error:void 0,hasError:!1};try{cle(C,new Ae(this.session),!1).on("browsingContext.contextCreated",I=>{P.add(I.context)});const{result:M}=await this.session.send("browsingContext.getTree",{});k=M.contexts}catch(E){C.error=E,C.hasError=!0}finally{ule(C)}}for(const C of k)P.has(C.context)||this.session.emit("browsingContext.contextCreated",C),C.children&&k.push(...C.children)},VR=function(P){const k=$x.create(this,P);c(this,h).set(k.id,k);const C=c(this,d).use(new Ae(k));return C.once("closed",()=>{C.removeAllListeners(),c(this,h).delete(k.id)}),k},(()=>{const P=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;Jh(v,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:k=>"dispose"in k,get:k=>k.dispose},metadata:P},null,e),Jh(v,null,r,{kind:"method",name:"close",static:!1,private:!1,access:{has:k=>"close"in k,get:k=>k.close},metadata:P},null,e),Jh(v,null,s,{kind:"method",name:"addPreloadScript",static:!1,private:!1,access:{has:k=>"addPreloadScript"in k,get:k=>k.addPreloadScript},metadata:P},null,e),Jh(v,null,i,{kind:"method",name:"removeIntercept",static:!1,private:!1,access:{has:k=>"removeIntercept"in k,get:k=>k.removeIntercept},metadata:P},null,e),Jh(v,null,a,{kind:"method",name:"removePreloadScript",static:!1,private:!1,access:{has:k=>"removePreloadScript"in k,get:k=>k.removePreloadScript},metadata:P},null,e),Jh(v,null,o,{kind:"method",name:"createUserContext",static:!1,private:!1,access:{has:k=>"createUserContext"in k,get:k=>k.createUserContext},metadata:P},null,e),P&&Object.defineProperty(v,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:P})})(),v})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var KI=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Xh=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let dle=(()=>{var d,h,f,p,m,H9,y;let n=Ae,e=[],t,r=[],s=[],i,a,o,u,l;return y=class extends n{constructor(b,S){super();_(this,m);_(this,d,KI(this,e));_(this,h,new lr);_(this,f);J(this,"browser");_(this,p,KI(this,r,void 0));KI(this,s),x(this,f,S),this.connection=b}static async from(b,S){var C;const{result:P}=await b.send("session.new",{capabilities:S}),k=new y(b,P);return await A(C=k,m,H9).call(C),k}get connection(){return c(this,p)}set connection(b){x(this,p,b)}get capabilities(){return c(this,f).capabilities}get disposed(){return this.ended}get ended(){return c(this,d)!==void 0}get id(){return c(this,f).sessionId}dispose(b){x(this,d,b),this[je]()}async send(b,S){return await this.connection.send(b,S)}async subscribe(b,S){await this.send("session.subscribe",{events:b,contexts:S})}async addIntercepts(b,S){await this.send("session.subscribe",{events:b,contexts:S})}async end(){try{await this.send("session.end",{})}finally{this.dispose("Session already ended.")}}[(t=[pb()],i=[Ro],a=[le(b=>c(b,d))],o=[le(b=>c(b,d))],u=[le(b=>c(b,d))],l=[le(b=>c(b,d))],je)](){c(this,d)??x(this,d,"Session already destroyed, probably because the connection broke."),this.emit("ended",{reason:c(this,d)}),c(this,h).dispose(),super[je]()}},d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakSet,H9=async function(){this.browser=await lle.from(this),c(this,h).use(this.browser).once("closed",({reason:P})=>{this.dispose(P)});const S=new WeakSet;this.on("browsingContext.fragmentNavigated",P=>{S.has(P)||(S.add(P),this.emit("browsingContext.navigationStarted",P),this.emit("browsingContext.fragmentNavigated",P))})},(()=>{const b=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;Xh(y,null,t,{kind:"accessor",name:"connection",static:!1,private:!1,access:{has:S=>"connection"in S,get:S=>S.connection,set:(S,P)=>{S.connection=P}},metadata:b},r,s),Xh(y,null,i,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:S=>"dispose"in S,get:S=>S.dispose},metadata:b},null,e),Xh(y,null,a,{kind:"method",name:"send",static:!1,private:!1,access:{has:S=>"send"in S,get:S=>S.send},metadata:b},null,e),Xh(y,null,o,{kind:"method",name:"subscribe",static:!1,private:!1,access:{has:S=>"subscribe"in S,get:S=>S.subscribe},metadata:b},null,e),Xh(y,null,u,{kind:"method",name:"addIntercepts",static:!1,private:!1,access:{has:S=>"addIntercepts"in S,get:S=>S.addIntercepts},metadata:b},null,e),Xh(y,null,l,{kind:"method",name:"end",static:!1,private:!1,access:{has:S=>"end"in S,get:S=>S.end},metadata:b},null,e),b&&Object.defineProperty(y,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:b})})(),y})();/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var hle=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},vH=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},_H=function(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})};let fle=(()=>{var i,a,o,nd,K9,d,h,f,p,m,g,y,W9,z9,V9,GR;let n=e$,e,t=[],r=[],s;return i=class extends n{constructor(C,E){super();_(this,o);J(this,"protocol","webDriverBiDi");_(this,a,vH(this,t,new Ae));_(this,d,vH(this,r));_(this,h);_(this,f);_(this,p);_(this,m,new WeakMap);_(this,g,new ele(this));_(this,y);x(this,d,E.process),x(this,h,E.closeCallback),x(this,f,C),x(this,p,E.defaultViewport),x(this,y,E.cdpConnection)}static async create(C){var I,N,O;const E=await dle.from(C.connection,{firstMatch:(I=C.capabilities)==null?void 0:I.firstMatch,alwaysMatch:{...(N=C.capabilities)==null?void 0:N.alwaysMatch,acceptInsecureCerts:C.acceptInsecureCerts,unhandledPromptBehavior:{default:"ignore"},webSocketUrl:!0,"goog:prerenderingDisabled":!0}});await E.subscribe(E.capabilities.browserName.toLocaleLowerCase().includes("firefox")?i.subscribeModules:[...i.subscribeModules,...i.subscribeCdpEvents]);const M=new i(E.browser,C);return A(O=M,o,W9).call(O),M}get cdpSupported(){return c(this,y)!==void 0}get cdpConnection(){return c(this,y)}async userAgent(){return c(this,f).session.capabilities.userAgent}get connection(){return c(this,f).session.connection}wsEndpoint(){return this.connection.url}async close(){var C;if(!this.connection.closed)try{await c(this,f).close(),await((C=c(this,h))==null?void 0:C.call(null))}catch(E){Ee(E)}finally{this.connection.dispose()}}get connected(){return!c(this,f).disconnected}process(){return c(this,d)??null}async createBrowserContext(C){const E=await c(this,f).createUserContext();return A(this,o,GR).call(this,E)}async version(){return`${c(this,o,z9)}/${c(this,o,V9)}`}browserContexts(){return[...c(this,f).userContexts].map(C=>c(this,m).get(C))}defaultBrowserContext(){return c(this,m).get(c(this,f).defaultUserContext)}newPage(){return this.defaultBrowserContext().newPage()}targets(){return[c(this,g),...this.browserContexts().flatMap(C=>C.targets())]}target(){return c(this,g)}async disconnect(){try{await c(this,f).session.end()}catch(C){Ee(C)}finally{this.connection.dispose()}}get debugInfo(){return{pendingProtocolErrors:this.connection.getPendingProtocolErrors()}}},a=new WeakMap,o=new WeakSet,nd=function(){return s.get.call(this)},K9=function(C){return s.set.call(this,C)},d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,W9=function(){var C;for(const E of c(this,f).userContexts)A(this,o,GR).call(this,E);c(this,f).once("disconnected",()=>{c(this,o,nd).emit("disconnected",void 0),c(this,o,nd).removeAllListeners()}),(C=c(this,d))==null||C.once("close",()=>{c(this,f).dispose("Browser process exited.",!0),this.connection.dispose()})},z9=function(){return c(this,f).session.capabilities.browserName},V9=function(){return c(this,f).session.capabilities.browserVersion},GR=function(C){const E=wH.from(this,C,{defaultViewport:c(this,p)});return c(this,m).set(C,E),E.trustedEmitter.on("targetcreated",M=>{c(this,o,nd).emit("targetcreated",M)}),E.trustedEmitter.on("targetchanged",M=>{c(this,o,nd).emit("targetchanged",M)}),E.trustedEmitter.on("targetdestroyed",M=>{c(this,o,nd).emit("targetdestroyed",M)}),E},(()=>{const C=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;e=[pb()],hle(i,s={get:_H(function(){return c(this,a)},"#trustedEmitter","get"),set:_H(function(E){x(this,a,E)},"#trustedEmitter","set")},e,{kind:"accessor",name:"#trustedEmitter",static:!1,private:!0,access:{has:E=>Nn(o,E),get:E=>c(E,o,nd),set:(E,M)=>{x(E,o,M,K9)}},metadata:C},t,r),C&&Object.defineProperty(i,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:C})})(),J(i,"subscribeModules",["browsingContext","network","log","script"]),J(i,"subscribeCdpEvents",["goog:cdp.Debugger.scriptParsed","goog:cdp.CSS.styleSheetAdded","goog:cdp.Runtime.executionContextsCleared","goog:cdp.Tracing.tracingComplete","goog:cdp.Network.requestWillBeSent","goog:cdp.Debugger.scriptParsed","goog:cdp.Page.screencastFrame"]),i})();/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const bH=Object.freeze(Object.defineProperty({__proto__:null,BidiBrowser:fle,BidiBrowserContext:wH,BidiConnection:Q5,BidiElementHandle:Jy,BidiFrame:uH,BidiFrameRealm:dc,BidiHTTPRequest:FI,BidiHTTPResponse:nH,BidiJSHandle:lc,BidiKeyboard:lH,BidiMouse:dH,BidiPage:Qy,BidiRealm:LI,BidiTouchscreen:hH,BidiWorkerRealm:Nx,bidiToPuppeteerCookie:BI,cdpSpecificCookiePropertiesFromPuppeteerToBidi:UI,connectBidiOverCdp:gue,convertCookiesExpiryCdpToBiDi:HI,convertCookiesPartitionKeyFromPuppeteerToBiDi:gH,convertCookiesSameSiteCdpToBiDi:qI,requests:NI},Symbol.toStringTag,{value:"Module"}));var WI,SH;function ple(){return SH||(SH=1,WI=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}),WI}var mle=ple();const gle=Qe(mle);/**
 * @license
 * Copyright 2018 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const lO=class lO{constructor(e){_(this,Co);J(this,"onmessage");J(this,"onclose");x(this,Co,e),c(this,Co).addEventListener("message",t=>{this.onmessage&&this.onmessage.call(null,t.data)}),c(this,Co).addEventListener("close",()=>{this.onclose&&this.onclose.call(null)}),c(this,Co).addEventListener("error",()=>{})}static create(e,t){return new Promise((r,s)=>{const i=new gle(e,[],{followRedirects:!0,perMessageDeflate:!1,allowSynchronousEvents:!1,maxPayload:268435456,headers:{"User-Agent":`Puppeteer ${KM}`,...t}});i.addEventListener("open",()=>r(new lO(i))),i.addEventListener("error",s)})}send(e){c(this,Co).send(e)}close(){c(this,Co).close()}};Co=new WeakMap;let zI=lO;const yle=Object.freeze(Object.defineProperty({__proto__:null,NodeWebSocketTransport:zI},Symbol.toStringTag,{value:"Module"}))})();
