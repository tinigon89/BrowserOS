var yre=Object.defineProperty;var wre=Object.getPrototypeOf;var bre=Reflect.get;var KA=Ve=>{throw TypeError(Ve)};var _re=(Ve,tt,Rt)=>tt in Ve?yre(Ve,tt,{enumerable:!0,configurable:!0,writable:!0,value:Rt}):Ve[tt]=Rt;var Z=(Ve,tt,Rt)=>_re(Ve,typeof tt!="symbol"?tt+"":tt,Rt),HA=(Ve,tt,Rt)=>tt.has(Ve)||KA("Cannot "+Rt),dn=(Ve,tt)=>Object(tt)!==tt?KA('Cannot use the "in" operator on this value'):Ve.has(tt),c=(Ve,tt,Rt)=>(HA(Ve,tt,"read from private field"),Rt?Rt.call(Ve):tt.get(Ve)),b=(Ve,tt,Rt)=>tt.has(Ve)?KA("Cannot add the same private member more than once"):tt instanceof WeakSet?tt.add(Ve):tt.set(Ve,Rt),x=(Ve,tt,Rt,Gu)=>(HA(Ve,tt,"write to private field"),Gu?Gu.call(Ve,Rt):tt.set(Ve,Rt),Rt),P=(Ve,tt,Rt)=>(HA(Ve,tt,"access private method"),Rt);var of=(Ve,tt,Rt,Gu)=>({set _(rb){x(Ve,tt,rb,Rt)},get _(){return c(Ve,tt,Gu)}}),YB=(Ve,tt,Rt)=>bre(wre(Ve),Rt,tt);(function(){"use strict";var $B,jB,ho,ca,LB,FB,fo,ua,la,Ei,DB,mg,gg,$c,jc,po,mo,Fc,yg,b0,Od,wg,bg,WA,Rd,Dc,_g,vg,BB,go,Md,Sg,Bc,Nd,UB,xg,Eg,kg,Cg,$d,jd,Uc,zA,QB,zs,qc,Kc,Hc,Ag,Wc,zc,ki,sU,iU,aU,oU,Ld,Fd,zr,Dd,Bd,Ud,qd,S0,Kd,Hd,q0,da,Vc,ha,Wd,Tg,yo,Gc,Ig,Og,Zc,Wn,Jc,zd,Rg,wo,Mg,qB,Ng,bo,$g,Vd,jg,Xc,Lg,Yc,zn,Fg,Qc,Dg,fa,uU,lU,YA,pa,Bg,Ug,qg,Kg,Hg,Gd,Zd,Jd,Wg,eu,fs,k0,zg,Vg,tu,Xd,Gg,ru,Yd,ma,Vs,Qd,eh,Zg,Jg,Ci,nu,th,on,su,rh,Pi,nh,Xg,QA,iu,au,cn,ou,cu,uu,sh,Yg,ih,ah,oh,dU,hU,Vn,lu,_o,du,ch,Qg,uh,fU,pU,ey,hu,lh,ty,ry,ny,dh,Gn,sy,fu,pu,hh,fh,iy,lT,Gs,ph,ga,C0,mU,mh,An,gh,vo,mu,Zs,yh,ay,gu,P0,Tn,yU,wU,bU,oy,So,dT,hT,Ai,Js,xo,Vr,_U,vU,SU,K0,H0,cy,Eo,wh,ko,yu,uy,Co,ly,dy,hy,fy,py,ya,Dt,xU,EU,kU,CU,PU,AU,W0,Hu,wu,bh,Po,_h,vh,my,Ti,gy,yy,wy,by,_y,vy,Sy,xy,Ey,ky,Cy,Py,Ay,Ty,Iy,Ii,Sh,xh,Oy,Ry,My,Ny,$y,jy,Ly,Fy,A0,RU,Ao,To,Io,Oo,bu,_u,Eh,dt,vu,Ro,kh,Oi,wa,Mo,Gr,Ch,Dy,T0,No,he,MU,fT,Xo,z0,pT,V0,Ww,NU,$U,jU,mT,LU,cf,FU,DU,gT,BU,UU,G0,qU,yT,KU,wT,bT,By,$o,Ph,Uy,ps,Su,Ah,xu,qy,un,at,_T,HU,WU,zU,vT,ST,xT,VU,GU,ZU,JU,uf,jo,Th,Lo,ET,kT,Zn,Xs,Ih,Gt,Yn,Eu,XU,Z0,Ky,Hy,ba,Fo,ku,Oh,Wy,_a,Rh,zy,Ri,va,Vy,Gy,Zy,Do,pt,Ys,Bo,Cu,Uo,Mh,Nh,$t,er,$h,qo,jh,Lh,Fh,Pu,Sa,I0,Jy,Xy,We,YU,QU,e3,CT,Yy,Dh,t3,r3,n3,s3,i3,PT,AT,a3,o3,TT,c3,IT,xa,Ea,Jn,Ko,Ho,Mi,Bh,Wo,Uh,KB,Qy,qh,xr,zo,Er,Au,ew,Vo,Tu,Iu,Go,tw,Ou,rw,Kh,O0,In,OT,RT,nw,sw,iw,aw,R0,lf,M0,Hh,ow,kr,cw,uw,Wh,ka,Ca,tr,lw,Ru,u3,N0,dw,hw,fw,pw,MT,Mu,mw,ln,Qn,Pa,zh,Zo,Aa,gw,Ni,Vh,yw,$u,Ta,ww,bw,ju,Lu,Gh,Fu,_w,vw,Zh,Sw,$0,R4,xw,j0,M4,Ew,L0,N4,Du,D4,g1,kw,$i,Jh,Jo,Cw,Xh,Yh,Pw,Aw,ji,B4,U4,F0,q4,K4,Bu,Tw,Cr,Kt,Xn,W4,y1,w1,b1,Iw,D0,Qh,z4,V4,Ow,_1,ef,B0,G4,tf,Rw,Mw,Nw,Ia,Li,Uu,$w,jw,Lw,qu,Ku,Fw,rf,Dw,nf,Oa,Ra,sf,af,Ma;function Ve(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function tt(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var Rt={exports:{}},Gu=Rt.exports,rb;function aq(){return rb||(rb=1,function(n,e){(function(t,r){r(n)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Gu,function(t){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const r="The message port closed before a response was received.",s=i=>{const a={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(a).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(C,E=void 0){super(E),this.createItem=C}get(C){return this.has(C)||this.set(C,this.createItem(C)),super.get(C)}}const u=k=>k&&typeof k=="object"&&typeof k.then=="function",l=(k,C)=>(...E)=>{i.runtime.lastError?k.reject(new Error(i.runtime.lastError.message)):C.singleCallbackArg||E.length<=1&&C.singleCallbackArg!==!1?k.resolve(E[0]):k.resolve(E)},d=k=>k==1?"argument":"arguments",h=(k,C)=>function(N,...I){if(I.length<C.minArgs)throw new Error(`Expected at least ${C.minArgs} ${d(C.minArgs)} for ${k}(), got ${I.length}`);if(I.length>C.maxArgs)throw new Error(`Expected at most ${C.maxArgs} ${d(C.maxArgs)} for ${k}(), got ${I.length}`);return new Promise(($,O)=>{if(C.fallbackToNoCallback)try{N[k](...I,l({resolve:$,reject:O},C))}catch(T){console.warn(`${k} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,T),N[k](...I),C.fallbackToNoCallback=!1,C.noCallback=!0,$()}else C.noCallback?(N[k](...I),$()):N[k](...I,l({resolve:$,reject:O},C))})},f=(k,C,E)=>new Proxy(C,{apply(N,I,$){return E.call(I,k,...$)}});let p=Function.call.bind(Object.prototype.hasOwnProperty);const m=(k,C={},E={})=>{let N=Object.create(null),I={has(O,T){return T in k||T in N},get(O,T,L){if(T in N)return N[T];if(!(T in k))return;let U=k[T];if(typeof U=="function")if(typeof C[T]=="function")U=f(k,k[T],C[T]);else if(p(E,T)){let J=h(T,E[T]);U=f(k,k[T],J)}else U=U.bind(k);else if(typeof U=="object"&&U!==null&&(p(C,T)||p(E,T)))U=m(U,C[T],E[T]);else if(p(E,"*"))U=m(U,C[T],E["*"]);else return Object.defineProperty(N,T,{configurable:!0,enumerable:!0,get(){return k[T]},set(J){k[T]=J}}),U;return N[T]=U,U},set(O,T,L,U){return T in N?N[T]=L:k[T]=L,!0},defineProperty(O,T,L){return Reflect.defineProperty(N,T,L)},deleteProperty(O,T){return Reflect.deleteProperty(N,T)}},$=Object.create(k);return new Proxy($,I)},g=k=>({addListener(C,E,...N){C.addListener(k.get(E),...N)},hasListener(C,E){return C.hasListener(k.get(E))},removeListener(C,E){C.removeListener(k.get(E))}}),y=new o(k=>typeof k!="function"?k:function(E){const N=m(E,{},{getContent:{minArgs:0,maxArgs:0}});k(N)}),w=new o(k=>typeof k!="function"?k:function(E,N,I){let $=!1,O,T=new Promise(F=>{O=function(j){$=!0,F(j)}}),L;try{L=k(E,N,O)}catch(F){L=Promise.reject(F)}const U=L!==!0&&u(L);if(L!==!0&&!U&&!$)return!1;const J=F=>{F.then(j=>{I(j)},j=>{let B;j&&(j instanceof Error||typeof j.message=="string")?B=j.message:B="An unexpected error occurred",I({__mozWebExtensionPolyfillReject__:!0,message:B})}).catch(j=>{console.error("Failed to send onMessage rejected reply",j)})};return J(U?L:T),!0}),S=({reject:k,resolve:C},E)=>{i.runtime.lastError?i.runtime.lastError.message===r?C():k(new Error(i.runtime.lastError.message)):E&&E.__mozWebExtensionPolyfillReject__?k(new Error(E.message)):C(E)},_=(k,C,E,...N)=>{if(N.length<C.minArgs)throw new Error(`Expected at least ${C.minArgs} ${d(C.minArgs)} for ${k}(), got ${N.length}`);if(N.length>C.maxArgs)throw new Error(`Expected at most ${C.maxArgs} ${d(C.maxArgs)} for ${k}(), got ${N.length}`);return new Promise((I,$)=>{const O=S.bind(null,{resolve:I,reject:$});N.push(O),E.sendMessage(...N)})},v={devtools:{network:{onRequestFinished:g(y)}},runtime:{onMessage:g(w),onMessageExternal:g(w),sendMessage:_.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:_.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},A={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return a.privacy={network:{"*":A},services:{"*":A},websites:{"*":A}},m(i,v,a)};t.exports=s(chrome)}})}(Rt)),Rt.exports}aq();var Di=(n=>(n.Planner="planner",n.Navigator="navigator",n.Validator="validator",n))(Di||{}),Jt=(n=>(n.OpenAI="openai",n.Anthropic="anthropic",n.DeepSeek="deepseek",n.Gemini="gemini",n.Grok="grok",n.Ollama="ollama",n.CustomOpenAI="custom_openai",n))(Jt||{});const oq={openai:["gpt-4o","gpt-4o-mini","o1","o3-mini"],anthropic:["claude-3-7-sonnet-latest","claude-3-5-sonnet-latest","claude-3-5-haiku-latest"],deepseek:["deepseek-chat","deepseek-reasoner"],gemini:["gemini-2.0-flash","gemini-2.0-flash-lite","gemini-2.5-pro-exp-03-25"],grok:["grok-2","grok-2-vision"],ollama:[]},cq={openai:{planner:{temperature:.01,topP:.001},navigator:{temperature:0,topP:.001},validator:{temperature:0,topP:.001}},anthropic:{planner:{temperature:.1,topP:.1},navigator:{temperature:.1,topP:.1},validator:{temperature:.05,topP:.1}},gemini:{planner:{temperature:.01,topP:.1},navigator:{temperature:.01,topP:.1},validator:{temperature:.1,topP:.1}},grok:{planner:{temperature:.7,topP:.9},navigator:{temperature:.7,topP:.9},validator:{temperature:.7,topP:.9}},ollama:{planner:{temperature:0,topP:.001},navigator:{temperature:.01,topP:.001},validator:{temperature:0,topP:.001}}};var Zu=(n=>(n.Local="local",n.Sync="sync",n.Managed="managed",n.Session="session",n))(Zu||{}),P1=(n=>(n.ExtensionPagesOnly="TRUSTED_CONTEXTS",n.ExtensionPagesAndContentScripts="TRUSTED_AND_UNTRUSTED_CONTEXTS",n))(P1||{}),nb=(n,e,t)=>new Promise((r,s)=>{var i=u=>{try{o(t.next(u))}catch(l){s(l)}},a=u=>{try{o(t.throw(u))}catch(l){s(l)}},o=u=>u.done?r(u.value):Promise.resolve(u.value).then(i,a);o((t=t.apply(n,e)).next())});const ei=globalThis.chrome;function A1(n,e){return nb(this,null,function*(){function t(s){return typeof s=="function"}function r(s){return s instanceof Promise}return t(n)?(r(n),n(e)):n})}let T1=!1;function I1(n){if(ei&&ei.storage[n]===void 0)throw new Error(`Check your storage permission in manifest.json: ${n} is not defined`)}function wS(n,e,t){var r,s,i,a,o,u;let l=null,d=!1,h=[];const f=(r=t==null?void 0:t.storageEnum)!=null?r:Zu.Local,p=(s=t==null?void 0:t.liveUpdate)!=null?s:!1,m=(a=(i=t==null?void 0:t.serialization)==null?void 0:i.serialize)!=null?a:k=>k,g=(u=(o=t==null?void 0:t.serialization)==null?void 0:o.deserialize)!=null?u:k=>k;T1===!1&&f===Zu.Session&&(t==null?void 0:t.sessionAccessForContentScripts)===!0&&(I1(f),ei==null||ei.storage[f].setAccessLevel({accessLevel:P1.ExtensionPagesAndContentScripts}).catch(k=>{console.warn(k),console.warn("Please call setAccessLevel into different context, like a background script.")}),T1=!0);const y=()=>nb(this,null,function*(){var k;I1(f);const C=yield ei==null?void 0:ei.storage[f].get([n]);return C&&(k=g(C[n]))!=null?k:e}),w=()=>{h.forEach(k=>k())},S=k=>nb(this,null,function*(){d||(l=yield y()),l=yield A1(k,l),yield ei==null?void 0:ei.storage[f].set({[n]:m(l)}),w()}),_=k=>(h=[...h,k],()=>{h=h.filter(C=>C!==k)}),v=()=>l;y().then(k=>{l=k,d=!0,w()});function A(k){return nb(this,null,function*(){if(k[n]===void 0)return;const C=g(k[n].newValue);l!==C&&(l=yield A1(C,l),w())})}return p&&(ei==null||ei.storage[f].onChanged.addListener(A)),{get:y,set:S,getSnapshot:v,subscribe:_}}var uq=Object.defineProperty,lq=Object.defineProperties,dq=Object.getOwnPropertyDescriptors,O1=Object.getOwnPropertySymbols,hq=Object.prototype.hasOwnProperty,fq=Object.prototype.propertyIsEnumerable,R1=(n,e,t)=>e in n?uq(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ju=(n,e)=>{for(var t in e||(e={}))hq.call(e,t)&&R1(n,t,e[t]);if(O1)for(var t of O1(e))fq.call(e,t)&&R1(n,t,e[t]);return n},bS=(n,e)=>lq(n,dq(e)),gf=(n,e,t)=>new Promise((r,s)=>{var i=u=>{try{o(t.next(u))}catch(l){s(l)}},a=u=>{try{o(t.throw(u))}catch(l){s(l)}},o=u=>u.done?r(u.value):Promise.resolve(u.value).then(i,a);o((t=t.apply(n,e)).next())});const ja=wS("llm-api-keys",{providers:{}},{storageEnum:Zu.Local,liveUpdate:!0});function M1(n){switch(n){case Jt.OpenAI:case Jt.Anthropic:case Jt.DeepSeek:case Jt.Gemini:case Jt.Grok:case Jt.Ollama:return n;default:return Jt.CustomOpenAI}}function N1(n){switch(n){case Jt.OpenAI:return"OpenAI";case Jt.Anthropic:return"Anthropic";case Jt.DeepSeek:return"DeepSeek";case Jt.Gemini:return"Gemini";case Jt.Grok:return"Grok";case Jt.Ollama:return"Ollama";default:return n}}function $1(n,e){const t=Ju({},e);return t.name||(t.name=N1(n)),t.type||(t.type=M1(n)),t.modelNames||(t.modelNames=oq[n]||[]),t.createdAt||(t.createdAt=new Date("03/04/2025").getTime()),t}const _S=bS(Ju({},ja),{setProvider(n,e){return gf(this,null,function*(){if(!n)throw new Error("Provider id cannot be empty");if(e.apiKey===void 0)throw new Error("API key must be provided (can be empty for local models)");if(!e.modelNames)throw new Error("Model names must be provided");const t=bS(Ju({},e),{name:e.name||N1(n),type:e.type||M1(n),modelNames:e.modelNames,createdAt:e.createdAt||Date.now()}),r=(yield ja.get())||{providers:{}};yield ja.set({providers:bS(Ju({},r.providers),{[n]:t})})})},getProvider(n){return gf(this,null,function*(){const t=((yield ja.get())||{providers:{}}).providers[n];return t?$1(n,t):void 0})},removeProvider(n){return gf(this,null,function*(){const e=(yield ja.get())||{providers:{}},t=Ju({},e.providers);delete t[n],yield ja.set({providers:t})})},hasProvider(n){return gf(this,null,function*(){const e=(yield ja.get())||{providers:{}};return n in e.providers})},getAllProviders(){return gf(this,null,function*(){const n=yield ja.get(),e=Ju({},n.providers);for(const[t,r]of Object.entries(e))e[t]=$1(t,r);return e})}});var pq=Object.defineProperty,mq=Object.defineProperties,gq=Object.getOwnPropertyDescriptors,j1=Object.getOwnPropertySymbols,yq=Object.prototype.hasOwnProperty,wq=Object.prototype.propertyIsEnumerable,L1=(n,e,t)=>e in n?pq(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Bi=(n,e)=>{for(var t in e||(e={}))yq.call(e,t)&&L1(n,t,e[t]);if(j1)for(var t of j1(e))wq.call(e,t)&&L1(n,t,e[t]);return n},sb=(n,e)=>mq(n,gq(e)),Xu=(n,e,t)=>new Promise((r,s)=>{var i=u=>{try{o(t.next(u))}catch(l){s(l)}},a=u=>{try{o(t.throw(u))}catch(l){s(l)}},o=u=>u.done?r(u.value):Promise.resolve(u.value).then(i,a);o((t=t.apply(n,e)).next())});const Yo=wS("agent-models",{agents:{}},{storageEnum:Zu.Local,liveUpdate:!0});function bq(n){if(!n.provider||!n.modelName)throw new Error("Provider and model name must be specified")}function F1(n,e){var t;const r=(t=cq[e])==null?void 0:t[n];return r??{temperature:.1,topP:.1}}const Qo=sb(Bi({},Yo),{setAgentModel:(n,e)=>Xu(void 0,null,function*(){bq(e);const t=F1(n,e.provider),r=sb(Bi({},e),{parameters:Bi(Bi({},t),e.parameters)});yield Yo.set(s=>({agents:sb(Bi({},s.agents),{[n]:r})}))}),getAgentModel:n=>Xu(void 0,null,function*(){const t=(yield Yo.get()).agents[n];if(!t)return;const r=F1(n,t.provider);return sb(Bi({},t),{parameters:Bi(Bi({},r),t.parameters)})}),resetAgentModel:n=>Xu(void 0,null,function*(){yield Yo.set(e=>{const t=Bi({},e.agents);return delete t[n],{agents:t}})}),hasAgentModel:n=>Xu(void 0,null,function*(){const e=yield Yo.get();return n in e.agents}),getConfiguredAgents:()=>Xu(void 0,null,function*(){const n=yield Yo.get();return Object.keys(n.agents)}),getAllAgentModels:()=>Xu(void 0,null,function*(){return(yield Yo.get()).agents})});var _q=Object.defineProperty,vq=Object.defineProperties,Sq=Object.getOwnPropertyDescriptors,D1=Object.getOwnPropertySymbols,xq=Object.prototype.hasOwnProperty,Eq=Object.prototype.propertyIsEnumerable,B1=(n,e,t)=>e in n?_q(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,vS=(n,e)=>{for(var t in e||(e={}))xq.call(e,t)&&B1(n,t,e[t]);if(D1)for(var t of D1(e))Eq.call(e,t)&&B1(n,t,e[t]);return n},kq=(n,e)=>vq(n,Sq(e)),SS=(n,e,t)=>new Promise((r,s)=>{var i=u=>{try{o(t.next(u))}catch(l){s(l)}},a=u=>{try{o(t.throw(u))}catch(l){s(l)}},o=u=>u.done?r(u.value):Promise.resolve(u.value).then(i,a);o((t=t.apply(n,e)).next())});const ib={maxSteps:100,maxActionsPerStep:5,maxFailures:3,useVision:!0,useVisionForPlanner:!0,planningInterval:3},yf=wS("general-settings",ib,{storageEnum:Zu.Local,liveUpdate:!0}),xS=kq(vS({},yf),{updateSettings(n){return SS(this,null,function*(){const e=(yield yf.get())||ib;yield yf.set(vS(vS({},e),n))})},getSettings(){return SS(this,null,function*(){return(yield yf.get())||ib})},resetToDefaults(){return SS(this,null,function*(){yield yf.set(ib)})}}),U1={minimumWaitPageLoadTime:.5,waitForNetworkIdlePageLoadTime:1,maximumWaitPageLoadTime:5,waitBetweenActions:1,browserWindowSize:{width:1280,height:1100},highlightElements:!0,viewportExpansion:500,includeDynamicAttributes:!0,homePageUrl:"https://www.google.com"};var ES=function(n,e){return ES=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])},ES(n,e)};function Ui(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ES(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Cq(n,e,t,r){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(d){try{l(r.next(d))}catch(h){a(h)}}function u(d){try{l(r.throw(d))}catch(h){a(h)}}function l(d){d.done?i(d.value):s(d.value).then(o,u)}l((r=r.apply(n,[])).next())})}function q1(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(l){return function(d){return u([l,d])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(t=0)),t;)try{if(r=1,s&&(i=l[0]&2?s.return:l[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,l[1])).done)return i;switch(s=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(d){l=[6,d],s=0}finally{r=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Yu(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ec(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),s,i=[],a;try{for(;(e===void 0||e-- >0)&&!(s=r.next()).done;)i.push(s.value)}catch(o){a={error:o}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return i}function Qu(n,e,t){if(arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}function el(n){return this instanceof el?(this.v=n,this):new el(n)}function Pq(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(f){r[f]&&(s[f]=function(p){return new Promise(function(m,g){i.push([f,p,m,g])>1||o(f,p)})})}function o(f,p){try{u(r[f](p))}catch(m){h(i[0][3],m)}}function u(f){f.value instanceof el?Promise.resolve(f.value.v).then(l,d):h(i[0][2],f)}function l(f){o("next",f)}function d(f){o("throw",f)}function h(f,p){f(p),i.shift(),i.length&&o(i[0][0],i[0][1])}}function Aq(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Yu=="function"?Yu(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(a){return new Promise(function(o,u){a=n[i](a),s(o,u,a.done,a.value)})}}function s(i,a,o,u){Promise.resolve(u).then(function(l){i({value:l,done:o})},a)}}function Pt(n){return typeof n=="function"}function kS(n){var e=function(r){Error.call(r),r.stack=new Error().stack},t=n(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var CS=kS(function(n){return function(t){n(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,s){return s+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function ab(n,e){if(n){var t=n.indexOf(e);0<=t&&n.splice(t,1)}}var wf=function(){function n(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return n.prototype.unsubscribe=function(){var e,t,r,s,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=Yu(a),u=o.next();!u.done;u=o.next()){var l=u.value;l.remove(this)}}catch(g){e={error:g}}finally{try{u&&!u.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else a.remove(this);var d=this.initialTeardown;if(Pt(d))try{d()}catch(g){i=g instanceof CS?g.errors:[g]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var f=Yu(h),p=f.next();!p.done;p=f.next()){var m=p.value;try{W1(m)}catch(g){i=i??[],g instanceof CS?i=Qu(Qu([],ec(i)),ec(g.errors)):i.push(g)}}}catch(g){r={error:g}}finally{try{p&&!p.done&&(s=f.return)&&s.call(f)}finally{if(r)throw r.error}}}if(i)throw new CS(i)}},n.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)W1(e);else{if(e instanceof n){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},n.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},n.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},n.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ab(t,e)},n.prototype.remove=function(e){var t=this._finalizers;t&&ab(t,e),e instanceof n&&e._removeParent(this)},n.EMPTY=function(){var e=new n;return e.closed=!0,e}(),n}(),K1=wf.EMPTY;function H1(n){return n instanceof wf||n&&"closed"in n&&Pt(n.remove)&&Pt(n.add)&&Pt(n.unsubscribe)}function W1(n){Pt(n)?n():n.unsubscribe()}var z1={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Tq={setTimeout:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return setTimeout.apply(void 0,Qu([n,e],ec(t)))},clearTimeout:function(n){return clearTimeout(n)},delegate:void 0};function V1(n){Tq.setTimeout(function(){throw n})}function tl(){}function ob(n){n()}var PS=function(n){Ui(e,n);function e(t){var r=n.call(this)||this;return r.isStopped=!1,t?(r.destination=t,H1(t)&&t.add(r)):r.destination=Mq,r}return e.create=function(t,r,s){return new cb(t,r,s)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,n.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(wf),Iq=Function.prototype.bind;function AS(n,e){return Iq.call(n,e)}var Oq=function(){function n(e){this.partialObserver=e}return n.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(r){ub(r)}},n.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(r){ub(r)}else ub(e)},n.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){ub(t)}},n}(),cb=function(n){Ui(e,n);function e(t,r,s){var i=n.call(this)||this,a;if(Pt(t)||!t)a={next:t??void 0,error:r??void 0,complete:s??void 0};else{var o;i&&z1.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=function(){return i.unsubscribe()},a={next:t.next&&AS(t.next,o),error:t.error&&AS(t.error,o),complete:t.complete&&AS(t.complete,o)}):a=t}return i.destination=new Oq(a),i}return e}(PS);function ub(n){V1(n)}function Rq(n){throw n}var Mq={closed:!0,next:tl,error:Rq,complete:tl},TS=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function ti(n){return n}function Nq(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return G1(n)}function G1(n){return n.length===0?ti:n.length===1?n[0]:function(t){return n.reduce(function(r,s){return s(r)},t)}}var rr=function(){function n(e){e&&(this._subscribe=e)}return n.prototype.lift=function(e){var t=new n;return t.source=this,t.operator=e,t},n.prototype.subscribe=function(e,t,r){var s=this,i=jq(e)?e:new cb(e,t,r);return ob(function(){var a=s,o=a.operator,u=a.source;i.add(o?o.call(i,u):u?s._subscribe(i):s._trySubscribe(i))}),i},n.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},n.prototype.forEach=function(e,t){var r=this;return t=Z1(t),new t(function(s,i){var a=new cb({next:function(o){try{e(o)}catch(u){i(u),a.unsubscribe()}},error:i,complete:s});r.subscribe(a)})},n.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},n.prototype[TS]=function(){return this},n.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return G1(e)(this)},n.prototype.toPromise=function(e){var t=this;return e=Z1(e),new e(function(r,s){var i;t.subscribe(function(a){return i=a},function(a){return s(a)},function(){return r(i)})})},n.create=function(e){return new n(e)},n}();function Z1(n){var e;return(e=n??z1.Promise)!==null&&e!==void 0?e:Promise}function $q(n){return n&&Pt(n.next)&&Pt(n.error)&&Pt(n.complete)}function jq(n){return n&&n instanceof PS||$q(n)&&H1(n)}function Lq(n){return Pt(n==null?void 0:n.lift)}function Tr(n){return function(e){if(Lq(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function fr(n,e,t,r,s){return new Fq(n,e,t,r,s)}var Fq=function(n){Ui(e,n);function e(t,r,s,i,a,o){var u=n.call(this,t)||this;return u.onFinalize=a,u.shouldUnsubscribe=o,u._next=r?function(l){try{r(l)}catch(d){t.error(d)}}:n.prototype._next,u._error=i?function(l){try{i(l)}catch(d){t.error(d)}finally{this.unsubscribe()}}:n.prototype._error,u._complete=s?function(){try{s()}catch(l){t.error(l)}finally{this.unsubscribe()}}:n.prototype._complete,u}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;n.prototype.unsubscribe.call(this),!r&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e}(PS),Dq=kS(function(n){return function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),J1=function(n){Ui(e,n);function e(){var t=n.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return e.prototype.lift=function(t){var r=new X1(this,this);return r.operator=t,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new Dq},e.prototype.next=function(t){var r=this;ob(function(){var s,i;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var a=Yu(r.currentObservers),o=a.next();!o.done;o=a.next()){var u=o.value;u.next(t)}}catch(l){s={error:l}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(s)throw s.error}}}})},e.prototype.error=function(t){var r=this;ob(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=t;for(var s=r.observers;s.length;)s.shift().error(t)}})},e.prototype.complete=function(){var t=this;ob(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var r=t.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(t){return this._throwIfClosed(),n.prototype._trySubscribe.call(this,t)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var r=this,s=this,i=s.hasError,a=s.isStopped,o=s.observers;return i||a?K1:(this.currentObservers=null,o.push(t),new wf(function(){r.currentObservers=null,ab(o,t)}))},e.prototype._checkFinalizedStatuses=function(t){var r=this,s=r.hasError,i=r.thrownError,a=r.isStopped;s?t.error(i):a&&t.complete()},e.prototype.asObservable=function(){var t=new rr;return t.source=this,t},e.create=function(t,r){return new X1(t,r)},e}(rr),X1=function(n){Ui(e,n);function e(t,r){var s=n.call(this)||this;return s.destination=t,s.source=r,s}return e.prototype.next=function(t){var r,s;(s=(r=this.destination)===null||r===void 0?void 0:r.next)===null||s===void 0||s.call(r,t)},e.prototype.error=function(t){var r,s;(s=(r=this.destination)===null||r===void 0?void 0:r.error)===null||s===void 0||s.call(r,t)},e.prototype.complete=function(){var t,r;(r=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||r===void 0||r.call(t)},e.prototype._subscribe=function(t){var r,s;return(s=(r=this.source)===null||r===void 0?void 0:r.subscribe(t))!==null&&s!==void 0?s:K1},e}(J1),IS={now:function(){return(IS.delegate||Date).now()},delegate:void 0},Bq=function(n){Ui(e,n);function e(t,r,s){t===void 0&&(t=1/0),r===void 0&&(r=1/0),s===void 0&&(s=IS);var i=n.call(this)||this;return i._bufferSize=t,i._windowTime=r,i._timestampProvider=s,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=r===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,r),i}return e.prototype.next=function(t){var r=this,s=r.isStopped,i=r._buffer,a=r._infiniteTimeWindow,o=r._timestampProvider,u=r._windowTime;s||(i.push(t),!a&&i.push(o.now()+u)),this._trimBuffer(),n.prototype.next.call(this,t)},e.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(t),s=this,i=s._infiniteTimeWindow,a=s._buffer,o=a.slice(),u=0;u<o.length&&!t.closed;u+=i?1:2)t.next(o[u]);return this._checkFinalizedStatuses(t),r},e.prototype._trimBuffer=function(){var t=this,r=t._bufferSize,s=t._timestampProvider,i=t._buffer,a=t._infiniteTimeWindow,o=(a?1:2)*r;if(r<1/0&&o<i.length&&i.splice(0,i.length-o),!a){for(var u=s.now(),l=0,d=1;d<i.length&&i[d]<=u;d+=2)l=d;l&&i.splice(0,l+1)}},e}(J1),Uq=function(n){Ui(e,n);function e(t,r){return n.call(this)||this}return e.prototype.schedule=function(t,r){return this},e}(wf),Y1={setInterval:function(n,e){for(var t=[],r=2;r<arguments.length;r++)t[r-2]=arguments[r];return setInterval.apply(void 0,Qu([n,e],ec(t)))},clearInterval:function(n){return clearInterval(n)},delegate:void 0},qq=function(n){Ui(e,n);function e(t,r){var s=n.call(this,t,r)||this;return s.scheduler=t,s.work=r,s.pending=!1,s}return e.prototype.schedule=function(t,r){var s;if(r===void 0&&(r=0),this.closed)return this;this.state=t;var i=this.id,a=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(a,i,r)),this.pending=!0,this.delay=r,this.id=(s=this.id)!==null&&s!==void 0?s:this.requestAsyncId(a,this.id,r),this},e.prototype.requestAsyncId=function(t,r,s){return s===void 0&&(s=0),Y1.setInterval(t.flush.bind(t,this),s)},e.prototype.recycleAsyncId=function(t,r,s){if(s===void 0&&(s=0),s!=null&&this.delay===s&&this.pending===!1)return r;r!=null&&Y1.clearInterval(r)},e.prototype.execute=function(t,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var s=this._execute(t,r);if(s)return s;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,r){var s=!1,i;try{this.work(t)}catch(a){s=!0,i=a||new Error("Scheduled action threw falsy error")}if(s)return this.unsubscribe(),i},e.prototype.unsubscribe=function(){if(!this.closed){var t=this,r=t.id,s=t.scheduler,i=s.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ab(i,this),r!=null&&(this.id=this.recycleAsyncId(s,r,null)),this.delay=null,n.prototype.unsubscribe.call(this)}},e}(Uq),Q1=function(){function n(e,t){t===void 0&&(t=n.now),this.schedulerActionCtor=e,this.now=t}return n.prototype.schedule=function(e,t,r){return t===void 0&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},n.now=IS.now,n}(),Kq=function(n){Ui(e,n);function e(t,r){r===void 0&&(r=Q1.now);var s=n.call(this,t,r)||this;return s.actions=[],s._active=!1,s}return e.prototype.flush=function(t){var r=this.actions;if(this._active){r.push(t);return}var s;this._active=!0;do if(s=t.execute(t.state,t.delay))break;while(t=r.shift());if(this._active=!1,s){for(;t=r.shift();)t.unsubscribe();throw s}},e}(Q1),Hq=new Kq(qq),Wq=Hq,tc=new rr(function(n){return n.complete()});function zq(n){return n&&Pt(n.schedule)}function OS(n){return n[n.length-1]}function Vq(n){return Pt(OS(n))?n.pop():void 0}function bf(n){return zq(OS(n))?n.pop():void 0}function Gq(n,e){return typeof OS(n)=="number"?n.pop():e}var RS=function(n){return n&&typeof n.length=="number"&&typeof n!="function"};function eI(n){return Pt(n==null?void 0:n.then)}function tI(n){return Pt(n[TS])}function rI(n){return Symbol.asyncIterator&&Pt(n==null?void 0:n[Symbol.asyncIterator])}function nI(n){return new TypeError("You provided "+(n!==null&&typeof n=="object"?"an invalid object":"'"+n+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Zq(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var sI=Zq();function iI(n){return Pt(n==null?void 0:n[sI])}function aI(n){return Pq(this,arguments,function(){var t,r,s,i;return q1(this,function(a){switch(a.label){case 0:t=n.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,el(t.read())];case 3:return r=a.sent(),s=r.value,i=r.done,i?[4,el(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,el(s)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function oI(n){return Pt(n==null?void 0:n.getReader)}function Zr(n){if(n instanceof rr)return n;if(n!=null){if(tI(n))return Jq(n);if(RS(n))return Xq(n);if(eI(n))return Yq(n);if(rI(n))return cI(n);if(iI(n))return Qq(n);if(oI(n))return e5(n)}throw nI(n)}function Jq(n){return new rr(function(e){var t=n[TS]();if(Pt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Xq(n){return new rr(function(e){for(var t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}function Yq(n){return new rr(function(e){n.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,V1)})}function Qq(n){return new rr(function(e){var t,r;try{for(var s=Yu(n),i=s.next();!i.done;i=s.next()){var a=i.value;if(e.next(a),e.closed)return}}catch(o){t={error:o}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}e.complete()})}function cI(n){return new rr(function(e){t5(n,e).catch(function(t){return e.error(t)})})}function e5(n){return cI(aI(n))}function t5(n,e){var t,r,s,i;return Cq(this,void 0,void 0,function(){var a,o;return q1(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),t=Aq(n),u.label=1;case 1:return[4,t.next()];case 2:if(r=u.sent(),!!r.done)return[3,4];if(a=r.value,e.next(a),e.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=u.sent(),s={error:o},[3,11];case 6:return u.trys.push([6,,9,10]),r&&!r.done&&(i=t.return)?[4,i.call(t)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function La(n,e,t,r,s){r===void 0&&(r=0),s===void 0&&(s=!1);var i=e.schedule(function(){t(),s?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(i),!s)return i}function uI(n,e){return e===void 0&&(e=0),Tr(function(t,r){t.subscribe(fr(r,function(s){return La(r,n,function(){return r.next(s)},e)},function(){return La(r,n,function(){return r.complete()},e)},function(s){return La(r,n,function(){return r.error(s)},e)}))})}function lI(n,e){return e===void 0&&(e=0),Tr(function(t,r){r.add(n.schedule(function(){return t.subscribe(r)},e))})}function r5(n,e){return Zr(n).pipe(lI(e),uI(e))}function n5(n,e){return Zr(n).pipe(lI(e),uI(e))}function s5(n,e){return new rr(function(t){var r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}function i5(n,e){return new rr(function(t){var r;return La(t,e,function(){r=n[sI](),La(t,e,function(){var s,i,a;try{s=r.next(),i=s.value,a=s.done}catch(o){t.error(o);return}a?t.complete():t.next(i)},0,!0)}),function(){return Pt(r==null?void 0:r.return)&&r.return()}})}function dI(n,e){if(!n)throw new Error("Iterable cannot be null");return new rr(function(t){La(t,e,function(){var r=n[Symbol.asyncIterator]();La(t,e,function(){r.next().then(function(s){s.done?t.complete():t.next(s.value)})},0,!0)})})}function a5(n,e){return dI(aI(n),e)}function o5(n,e){if(n!=null){if(tI(n))return r5(n,e);if(RS(n))return s5(n,e);if(eI(n))return n5(n,e);if(rI(n))return dI(n,e);if(iI(n))return i5(n,e);if(oI(n))return a5(n,e)}throw nI(n)}function ot(n,e){return e?o5(n,e):Zr(n)}function ri(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=bf(n);return ot(n,t)}var MS=kS(function(n){return function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}});function pr(n,e){return new Promise(function(t,r){var s=new cb({next:function(i){t(i),s.unsubscribe()},error:r,complete:function(){r(new MS)}});n.subscribe(s)})}function c5(n){return n instanceof Date&&!isNaN(n)}function Vt(n,e){return Tr(function(t,r){var s=0;t.subscribe(fr(r,function(i){r.next(n.call(e,i,s++))}))})}var u5=Array.isArray;function l5(n,e){return u5(e)?n.apply(void 0,Qu([],ec(e))):n(e)}function hI(n){return Vt(function(e){return l5(n,e)})}var d5=Array.isArray,h5=Object.getPrototypeOf,f5=Object.prototype,p5=Object.keys;function m5(n){if(n.length===1){var e=n[0];if(d5(e))return{args:e,keys:null};if(g5(e)){var t=p5(e);return{args:t.map(function(r){return e[r]}),keys:t}}}return{args:n,keys:null}}function g5(n){return n&&typeof n=="object"&&h5(n)===f5}function y5(n,e){return n.reduce(function(t,r,s){return t[r]=e[s],t},{})}function lb(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=bf(n),r=Vq(n),s=m5(n),i=s.args,a=s.keys;if(i.length===0)return ot([],t);var o=new rr(w5(i,t,a?function(u){return y5(a,u)}:ti));return r?o.pipe(hI(r)):o}function w5(n,e,t){return t===void 0&&(t=ti),function(r){fI(e,function(){for(var s=n.length,i=new Array(s),a=s,o=s,u=function(d){fI(e,function(){var h=ot(n[d],e),f=!1;h.subscribe(fr(r,function(p){i[d]=p,f||(f=!0,o--),o||r.next(t(i.slice()))},function(){--a||r.complete()}))},r)},l=0;l<s;l++)u(l)},r)}}function fI(n,e,t){n?La(t,n,e):e()}function pI(n,e,t,r,s,i,a,o){var u=[],l=0,d=0,h=!1,f=function(){h&&!u.length&&!l&&e.complete()},p=function(g){return l<r?m(g):u.push(g)},m=function(g){i&&e.next(g),l++;var y=!1;Zr(t(g,d++)).subscribe(fr(e,function(w){s==null||s(w),i?p(w):e.next(w)},function(){y=!0},void 0,function(){if(y)try{l--;for(var w=function(){var S=u.shift();a||m(S)};u.length&&l<r;)w();f()}catch(S){e.error(S)}}))};return n.subscribe(fr(e,p,function(){h=!0,f()})),function(){o==null||o()}}function mr(n,e,t){return t===void 0&&(t=1/0),Pt(e)?mr(function(r,s){return Vt(function(i,a){return e(r,i,s,a)})(Zr(n(r,s)))},t):(typeof e=="number"&&(t=e),Tr(function(r,s){return pI(r,s,n,t)}))}function mI(n){return n===void 0&&(n=1/0),mr(ti,n)}function b5(){return mI(1)}function NS(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return b5()(ot(n,bf(n)))}function rc(n){return new rr(function(e){Zr(n()).subscribe(e)})}var _5=["addListener","removeListener"],v5=["addEventListener","removeEventListener"],S5=["on","off"];function $S(n,e,t,r){if(Pt(t)&&(r=t,t=void 0),r)return $S(n,e,t).pipe(hI(r));var s=ec(k5(n)?v5.map(function(o){return function(u){return n[o](e,u,t)}}):x5(n)?_5.map(gI(n,e)):E5(n)?S5.map(gI(n,e)):[],2),i=s[0],a=s[1];if(!i&&RS(n))return mr(function(o){return $S(o,e,t)})(Zr(n));if(!i)throw new TypeError("Invalid event target");return new rr(function(o){var u=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];return o.next(1<l.length?l:l[0])};return i(u),function(){return a(u)}})}function gI(n,e){return function(t){return function(r){return n[t](e,r)}}}function x5(n){return Pt(n.addListener)&&Pt(n.removeListener)}function E5(n){return Pt(n.on)&&Pt(n.off)}function k5(n){return Pt(n.addEventListener)&&Pt(n.removeEventListener)}function jS(n,e,t){return n===void 0&&(n=0),t===void 0&&(t=Wq),new rr(function(r){var s=c5(n)?+n-t.now():n;s<0&&(s=0);var i=0;return t.schedule(function(){r.closed||(r.next(i++),r.complete())},s)})}function _f(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=bf(n),r=Gq(n,1/0),s=n;return s.length?s.length===1?Zr(s[0]):mI(r)(ot(s,t)):tc}var yI=new rr(tl),C5=Array.isArray;function P5(n){return n.length===1&&C5(n[0])?n[0]:n}function nc(n,e){return Tr(function(t,r){var s=0;t.subscribe(fr(r,function(i){return n.call(e,i,s++)&&r.next(i)}))})}function wI(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n=P5(n),n.length===1?Zr(n[0]):new rr(bI(n))}function bI(n){return function(e){for(var t=[],r=function(i){t.push(Zr(n[i]).subscribe(fr(e,function(a){if(t){for(var o=0;o<t.length;o++)o!==i&&t[o].unsubscribe();t=null}e.next(a)})))},s=0;t&&!e.closed&&s<n.length;s++)r(s)}}function vf(n){return Tr(function(e,t){var r=null,s=!1,i;r=e.subscribe(fr(t,void 0,void 0,function(a){i=Zr(n(a,vf(n)(e))),r?(r.unsubscribe(),r=null,i.subscribe(t)):s=!0})),s&&(r.unsubscribe(),r=null,i.subscribe(t))})}function _I(n){return Tr(function(e,t){var r=!1;e.subscribe(fr(t,function(s){r=!0,t.next(s)},function(){r||t.next(n),t.complete()}))})}function LS(n){return n<=0?function(){return tc}:Tr(function(e,t){var r=0;e.subscribe(fr(t,function(s){++r<=n&&(t.next(s),n<=r&&t.complete())}))})}function db(){return Tr(function(n,e){n.subscribe(fr(e,tl))})}function A5(n){return Vt(function(){return n})}function T5(n,e){return mr(function(t,r){return Zr(n(t,r)).pipe(LS(1),A5(t))})}function hb(n){return n===void 0&&(n=I5),Tr(function(e,t){var r=!1;e.subscribe(fr(t,function(s){r=!0,t.next(s)},function(){return r?t.complete():t.error(n())}))})}function I5(){return new MS}function rl(n,e){var t=arguments.length>=2;return function(r){return r.pipe(n?nc(function(s,i){return n(s,i,r)}):ti,LS(1),t?_I(e):hb(function(){return new MS}))}}function O5(n,e,t){return t===void 0&&(t=1/0),Tr(function(r,s){var i=e;return pI(r,s,function(a,o){return n(i,a,o)},t,function(a){i=a},!1,void 0,function(){return i=null})})}function Ir(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return n.length?Tr(function(t,r){bI(Qu([t],ec(n)))(r)}):ti}function fb(n){n===void 0&&(n=1/0);var e;n&&typeof n=="object"?e=n:e={count:n};var t=e.count,r=t===void 0?1/0:t,s=e.delay,i=e.resetOnSuccess,a=i===void 0?!1:i;return r<=0?ti:Tr(function(o,u){var l=0,d,h=function(){var f=!1;d=o.subscribe(fr(u,function(p){a&&(l=0),u.next(p)},void 0,function(p){if(l++<r){var m=function(){d?(d.unsubscribe(),d=null,h()):f=!0};if(s!=null){var g=typeof s=="number"?jS(s):Zr(s(p,l)),y=fr(u,function(){y.unsubscribe(),m()},function(){u.complete()});g.subscribe(y)}else m()}else u.error(p)})),f&&(d.unsubscribe(),d=null,h())};h()})}function R5(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=bf(n);return Tr(function(r,s){(t?NS(n,r,t):NS(n,r)).subscribe(s)})}function pb(n,e){return Tr(function(t,r){var s=null,i=0,a=!1,o=function(){return a&&!s&&r.complete()};t.subscribe(fr(r,function(u){s==null||s.unsubscribe();var l=0,d=i++;Zr(n(u,d)).subscribe(s=fr(r,function(h){return r.next(e?e(u,h,d,l++):h)},function(){s=null,o()}))},function(){a=!0,o()}))})}function M5(n){return Tr(function(e,t){Zr(n).subscribe(fr(t,function(){return t.complete()},tl)),!t.closed&&e.subscribe(t)})}function mb(n,e,t){var r=Pt(n)||e||t?{next:n,error:e,complete:t}:n;return r?Tr(function(s,i){var a;(a=r.subscribe)===null||a===void 0||a.call(r);var o=!0;s.subscribe(fr(i,function(u){var l;(l=r.next)===null||l===void 0||l.call(r,u),i.next(u)},function(){var u;o=!1,(u=r.complete)===null||u===void 0||u.call(r),i.complete()},function(u){var l;o=!1,(l=r.error)===null||l===void 0||l.call(r,u),i.error(u)},function(){var u,l;o&&((u=r.unsubscribe)===null||u===void 0||u.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):ti}function N5(n){return{all:n=n||new Map,on:function(e,t){var r=n.get(e);r?r.push(t):n.set(e,[t])},off:function(e,t){var r=n.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):n.set(e,[]))},emit:function(e,t){var r=n.get(e);r&&r.slice().map(function(s){s(t)}),(r=n.get("*"))&&r.slice().map(function(s){s(e,t)})}}}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */Symbol.dispose??(Symbol.dispose=Symbol("dispose")),Symbol.asyncDispose??(Symbol.asyncDispose=Symbol("asyncDispose"));const Me=Symbol.dispose,ms=Symbol.asyncDispose;jB=Me,$B=Symbol.toStringTag;const kA=class kA{constructor(){b(this,ho,!1);b(this,ca,[]);Z(this,jB,this.dispose);Z(this,$B,"DisposableStack")}get disposed(){return c(this,ho)}dispose(){if(!c(this,ho)){x(this,ho,!0);for(const e of c(this,ca).reverse())e[Me]()}}use(e){return e&&c(this,ca).push(e),e}adopt(e,t){return c(this,ca).push({[Me](){t(e)}}),e}defer(e){c(this,ca).push({[Me](){e()}})}move(){if(c(this,ho))throw new ReferenceError("a disposed stack can not use anything new");const e=new kA;return x(e,ca,c(this,ca)),x(this,ho,!0),e}};ho=new WeakMap,ca=new WeakMap;let Xt=kA;FB=ms,LB=Symbol.toStringTag;const CA=class CA{constructor(){b(this,fo,!1);b(this,ua,[]);Z(this,FB,this.dispose);Z(this,LB,"AsyncDisposableStack")}get disposed(){return c(this,fo)}async dispose(){if(!c(this,fo)){x(this,fo,!0);for(const e of c(this,ua).reverse())await e[ms]()}}use(e){return e&&c(this,ua).push(e),e}adopt(e,t){return c(this,ua).push({[ms](){return t(e)}}),e}defer(e){c(this,ua).push({[ms](){return e()}})}move(){if(c(this,fo))throw new ReferenceError("a disposed stack can not use anything new");const e=new CA;return x(e,ua,c(this,ua)),x(this,fo,!0),e}};fo=new WeakMap,ua=new WeakMap;let gb=CA;/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */let xe=(DB=class{constructor(e=N5(new Map)){b(this,la);b(this,Ei,new Map);x(this,la,e)}on(e,t){const r=c(this,Ei).get(e);return r===void 0?c(this,Ei).set(e,[t]):r.push(t),c(this,la).on(e,t),this}off(e,t){const r=c(this,Ei).get(e)??[];if(t===void 0){for(const i of r)c(this,la).off(e,i);return c(this,Ei).delete(e),this}const s=r.lastIndexOf(t);return s>-1&&c(this,la).off(e,...r.splice(s,1)),this}emit(e,t){return c(this,la).emit(e,t),this.listenerCount(e)>0}once(e,t){const r=s=>{t(s),this.off(e,r)};return this.on(e,r)}listenerCount(e){var t;return((t=c(this,Ei).get(e))==null?void 0:t.length)||0}removeAllListeners(e){return e!==void 0?this.off(e):(this[Me](),this)}[Me](){for(const[e,t]of c(this,Ei))for(const r of t)c(this,la).off(e,r);c(this,Ei).clear()}},la=new WeakMap,Ei=new WeakMap,DB);/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const vI=!!(typeof process<"u"&&process.version),Fa={value:{get fs(){throw new Error("fs is not available in this environment")},get ScreenRecorder(){throw new Error("ScreenRecorder is not available in this environment")}}},SI="24.1.1";/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const se=(n,e)=>{if(!n)throw new Error(e)};/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */function FS(n,e=!1){if(e){const t=atob(n);return Uint8Array.from(t,r=>r.codePointAt(0))}return new TextEncoder().encode(n)}function xI(n){return EI(new TextEncoder().encode(n))}function EI(n){const t=[];for(let s=0;s<n.length;s+=65534){const i=n.subarray(s,s+65534);t.push(String.fromCodePoint.apply(null,i))}const r=t.join("");return btoa(r)}function $5(n){let e=0;for(const s of n)e+=s.length;const t=new Uint8Array(e);let r=0;for(const s of n)t.set(s,r),r+=s.length;return t}/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */let DS=null;async function j5(){return DS||(DS=(await Promise.resolve().then(()=>pee)).default),DS}const nl=n=>vI?async(...e)=>{(await j5())(n)(e)}:(...e)=>{const t=globalThis.__PUPPETEER_DEBUG;!t||!(t==="*"||(t.endsWith("*")?n.startsWith(t):n===t))||console.log(`${n}:`,...e)};/**
 * @license
 * Copyright 2018 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class yb extends Error{constructor(e,t){super(e,t),this.name=this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}class wb extends yb{}class bb extends yb{}class sc extends yb{constructor(){super(...arguments);b(this,mg);b(this,gg,"")}set code(t){x(this,mg,t)}get code(){return c(this,mg)}set originalMessage(t){x(this,gg,t)}get originalMessage(){return c(this,gg)}}mg=new WeakMap,gg=new WeakMap;class Fe extends yb{}class gs extends sc{}/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const L5={letter:{cm:{width:21.59,height:27.94},in:{width:8.5,height:11}},legal:{cm:{width:21.59,height:35.56},in:{width:8.5,height:14}},tabloid:{cm:{width:27.94,height:43.18},in:{width:11,height:17}},ledger:{cm:{width:43.18,height:27.94},in:{width:17,height:11}},a0:{cm:{width:84.1,height:118.9},in:{width:33.1102,height:46.811}},a1:{cm:{width:59.4,height:84.1},in:{width:23.3858,height:33.1102}},a2:{cm:{width:42,height:59.4},in:{width:16.5354,height:23.3858}},a3:{cm:{width:29.7,height:42},in:{width:11.6929,height:16.5354}},a4:{cm:{width:21,height:29.7},in:{width:8.2677,height:11.6929}},a5:{cm:{width:14.8,height:21},in:{width:5.8268,height:8.2677}},a6:{cm:{width:10.5,height:14.8},in:{width:4.1339,height:5.8268}}};/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const _e=nl("puppeteer:error"),kI=Object.freeze({width:800,height:600}),_b=Symbol("Source URL for Puppeteer evaluation scripts"),Lc=class Lc{constructor(){b(this,$c);b(this,jc)}static fromCallSite(e,t){const r=new Lc;return x(r,$c,e),x(r,jc,t.toString()),r}get functionName(){return c(this,$c)}get siteString(){return c(this,jc)}toString(){return`pptr:${[c(this,$c),encodeURIComponent(c(this,jc))].join(";")}`}};$c=new WeakMap,jc=new WeakMap,Z(Lc,"INTERNAL_URL","pptr:internal"),Z(Lc,"parse",e=>{e=e.slice(5);const[t="",r=""]=e.split(";"),s=new Lc;return x(s,$c,t),x(s,jc,decodeURIComponent(r)),s}),Z(Lc,"isPuppeteerURL",e=>e.startsWith("pptr:"));let Rn=Lc;const gr=(n,e)=>{if(Object.prototype.hasOwnProperty.call(e,_b))return e;const t=Error.prepareStackTrace;Error.prepareStackTrace=(s,i)=>i[2];const r=new Error().stack;return Error.prepareStackTrace=t,Object.assign(e,{[_b]:Rn.fromCallSite(n,r)})},CI=n=>{if(Object.prototype.hasOwnProperty.call(n,_b))return n[_b]},qi=n=>typeof n=="string"||n instanceof String,F5=n=>typeof n=="number"||n instanceof Number,D5=n=>typeof n=="object"&&(n==null?void 0:n.constructor)===Object,B5=n=>typeof n=="object"&&(n==null?void 0:n.constructor)===RegExp,U5=n=>typeof n=="object"&&(n==null?void 0:n.constructor)===Date;function BS(n,...e){if(qi(n))return se(e.length===0,"Cannot evaluate a string with arguments"),n;function t(r){return Object.is(r,void 0)?"undefined":JSON.stringify(r)}return`(${n})(${e.map(t).join(",")})`}async function PI(n,e){const t=[],r=n.getReader();if(e){const s=await Fa.value.fs.promises.open(e,"w+");try{for(;;){const{done:i,value:a}=await r.read();if(i)break;t.push(a),await s.writeFile(a)}}finally{await s.close()}}else for(;;){const{done:s,value:i}=await r.read();if(s)break;t.push(i)}try{const s=$5(t);return s.length===0?null:s}catch(s){return _e(s),null}}async function AI(n,e){return new ReadableStream({async pull(t){function r(o,u){return u?Uint8Array.from(atob(o),d=>d.codePointAt(0)):new TextEncoder().encode(o)}const{data:s,base64Encoded:i,eof:a}=await n.send("IO.read",{handle:e});t.enqueue(r(s,i??!1)),a&&(await n.send("IO.close",{handle:e}),t.close())}})}function q5(n){let e=null;return new Set(["alert","confirm","prompt","beforeunload"]).has(n)&&(e=n),se(e,`Unknown javascript dialog type: ${n}`),e}function hn(n,e){return n===0?yI:jS(n).pipe(Vt(()=>{throw new wb(`Timed out after waiting ${n}ms`,{cause:e})}))}const TI="__puppeteer_utility_world__"+SI,vb=/^[\x20\t]*\/\/[@#] sourceURL=\s{0,10}(\S*?)\s{0,10}$/m;function II(n){return`//# sourceURL=${n}`}const K5=500;function OI(n={},e="in"){var a,o,u,l;const t={scale:1,displayHeaderFooter:!1,headerTemplate:"",footerTemplate:"",printBackground:!1,landscape:!1,pageRanges:"",preferCSSPageSize:!1,omitBackground:!1,outline:!1,tagged:!0,waitForFonts:!0};let r=8.5,s=11;if(n.format){const d=L5[n.format.toLowerCase()][e];se(d,"Unknown paper format: "+n.format),r=d.width,s=d.height}else r=sl(n.width,e)??r,s=sl(n.height,e)??s;const i={top:sl((a=n.margin)==null?void 0:a.top,e)||0,left:sl((o=n.margin)==null?void 0:o.left,e)||0,bottom:sl((u=n.margin)==null?void 0:u.bottom,e)||0,right:sl((l=n.margin)==null?void 0:l.right,e)||0};return n.outline&&(n.tagged=!0),{...t,...n,width:r,height:s,margin:i}}const US={px:1,in:96,cm:37.8,mm:3.78};function sl(n,e="in"){if(typeof n>"u")return;let t;if(F5(n))t=n;else if(qi(n)){const r=n;let s=r.substring(r.length-2).toLowerCase(),i="";s in US?i=r.substring(0,r.length-2):(s="px",i=r);const a=Number(i);se(!isNaN(a),"Failed to parse parameter value: "+r),t=a*US[s]}else throw new Error("page.pdf() Cannot handle parameter type: "+typeof n);return t/US[e]}function St(n,e){return new rr(t=>{const r=s=>{t.next(s)};return n.on(e,r),()=>{n.off(e,r)}})}function ic(n,e){return n?$S(n,"abort").pipe(Vt(()=>{throw n.reason instanceof Error?(n.reason.cause=e,n.reason):new Error(n.reason,{cause:e})})):yI}function Sf(n){return mr(e=>ot(Promise.resolve(n(e))).pipe(nc(t=>t),Vt(()=>e)))}const qS=new Map([["geolocation","geolocation"],["midi","midi"],["notifications","notifications"],["camera","videoCapture"],["microphone","audioCapture"],["background-sync","backgroundSync"],["ambient-light-sensor","sensors"],["accelerometer","sensors"],["gyroscope","sensors"],["magnetometer","sensors"],["accessibility-events","accessibilityEvents"],["clipboard-read","clipboardReadWrite"],["clipboard-write","clipboardReadWrite"],["clipboard-sanitized-write","clipboardSanitizedWrite"],["payment-handler","paymentHandler"],["persistent-storage","durableStorage"],["idle-detection","idleDetection"],["midi-sysex","midiSysex"]]);let RI=class extends xe{constructor(){super()}async waitForTarget(e,t={}){const{timeout:r=3e4,signal:s}=t;return await pr(_f(St(this,"targetcreated"),St(this,"targetchanged"),ot(this.targets())).pipe(Sf(e),Ir(ic(s),hn(r))))}async pages(){return(await Promise.all(this.browserContexts().map(t=>t.pages()))).reduce((t,r)=>t.concat(r),[])}async cookies(){return await this.defaultBrowserContext().cookies()}async setCookie(...e){return await this.defaultBrowserContext().setCookie(...e)}async deleteCookie(...e){return await this.defaultBrowserContext().deleteCookie(...e)}isConnected(){return this.connected}[Me](){return this.process()?void this.close().catch(_e):void this.disconnect().catch(_e)}[ms](){return this.process()?this.close():this.disconnect()}};/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */let Mt=(Dc=class{constructor(e){b(this,bg);b(this,po,!1);b(this,mo,!1);b(this,Fc);b(this,yg);b(this,b0,new Promise(e=>{x(this,yg,e)}));b(this,Od);b(this,wg);b(this,Rd);e&&e.timeout>0&&(x(this,wg,new wb(e.message)),x(this,Od,setTimeout(()=>{this.reject(c(this,wg))},e.timeout)))}static create(e){return new Dc(e)}static async race(e){const t=new Set;try{const r=e.map(s=>s instanceof Dc?(c(s,Od)&&t.add(s),s.valueOrThrow()):s);return await Promise.race(r)}finally{for(const r of t)r.reject(new Error("Timeout cleared"))}}resolve(e){c(this,mo)||c(this,po)||(x(this,po,!0),P(this,bg,WA).call(this,e))}reject(e){c(this,mo)||c(this,po)||(x(this,mo,!0),P(this,bg,WA).call(this,e))}resolved(){return c(this,po)}finished(){return c(this,po)||c(this,mo)}value(){return c(this,Fc)}valueOrThrow(){return c(this,Rd)||x(this,Rd,(async()=>{if(await c(this,b0),c(this,mo))throw c(this,Fc);return c(this,Fc)})()),c(this,Rd)}},po=new WeakMap,mo=new WeakMap,Fc=new WeakMap,yg=new WeakMap,b0=new WeakMap,Od=new WeakMap,wg=new WeakMap,bg=new WeakSet,WA=function(e){clearTimeout(c(this,Od)),x(this,Fc,e),c(this,yg).call(this)},Rd=new WeakMap,Dc);/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */let KS=(go=class{constructor(){b(this,Md,!1);b(this,Sg,[])}async acquire(e){if(!c(this,Md))return x(this,Md,!0),new go.Guard(this);const t=Mt.create();return c(this,Sg).push(t.resolve.bind(t)),await t.valueOrThrow(),new go.Guard(this,e)}release(){const e=c(this,Sg).shift();if(!e){x(this,Md,!1);return}e()}},Md=new WeakMap,Sg=new WeakMap,Z(go,"Guard",(BB=class{constructor(t,r){b(this,_g);b(this,vg);x(this,_g,t),x(this,vg,r)}[Me](){var t;return(t=c(this,vg))==null||t.call(this),c(this,_g).release()}},_g=new WeakMap,vg=new WeakMap,BB)),go);/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */let MI=(UB=class extends xe{constructor(){super();b(this,Bc);b(this,Nd,0)}startScreenshot(){const t=c(this,Bc)||new KS;return x(this,Bc,t),of(this,Nd)._++,t.acquire(()=>{of(this,Nd)._--,c(this,Nd)===0&&x(this,Bc,void 0)})}waitForScreenshotOperations(){var t;return(t=c(this,Bc))==null?void 0:t.acquire()}async waitForTarget(t,r={}){const{timeout:s=3e4}=r;return await pr(_f(St(this,"targetcreated"),St(this,"targetchanged"),ot(this.targets())).pipe(Sf(t),Ir(hn(s))))}async deleteCookie(...t){return await this.setCookie(...t.map(r=>({...r,expires:1})))}get closed(){return!this.browser().browserContexts().includes(this)}get id(){}[Me](){return void this.close().catch(_e)}[ms](){return this.close()}},Bc=new WeakMap,Nd=new WeakMap,UB);var jt;(function(n){n.Disconnected=Symbol("CDPSession.Disconnected"),n.Swapped=Symbol("CDPSession.Swapped"),n.Ready=Symbol("CDPSession.Ready"),n.SessionAttached="sessionattached",n.SessionDetached="sessiondetached"})(jt||(jt={}));class xf extends xe{constructor(){super()}parentSession(){}}/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class NI{constructor(e,t,r=""){b(this,xg);b(this,Eg);b(this,kg);Z(this,"handled",!1);x(this,xg,e),x(this,Eg,t),x(this,kg,r)}type(){return c(this,xg)}message(){return c(this,Eg)}defaultValue(){return c(this,kg)}async accept(e){se(!this.handled,"Cannot accept dialog which is already handled!"),this.handled=!0,await this.handle({accept:!0,text:e})}async dismiss(){se(!this.handled,"Cannot dismiss dialog which is already handled!"),this.handled=!0,await this.handle({accept:!1})}}xg=new WeakMap,Eg=new WeakMap,kg=new WeakMap;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const Sb=Symbol("_isElementHandle");/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */function es(n){return typeof n=="object"&&n!==null&&"name"in n&&"message"in n}function $I(n,e,t){return n.message=e,n.originalMessage=t??n.originalMessage,n}function jI(n){let e=n.error.message;return n.error&&typeof n.error=="object"&&"data"in n.error&&(e+=` ${n.error.data}`),e}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const LI=new Map,H5=n=>{let e=LI.get(n);return e||(e=new Function(`return ${n}`)(),LI.set(n,e),e)};function ni(n){let e=n.toString();try{new Function(`(${e})`)}catch(t){if(t.message.includes("Refused to evaluate a string as JavaScript because 'unsafe-eval' is not an allowed source of script in the following Content Security Policy directive"))return e;let r="function ";e.startsWith("async ")&&(r=`async ${r}`,e=e.substring(6)),e=`${r}${e}`;try{new Function(`(${e})`)}catch{throw new Error("Passed function cannot be serialized!")}}return e}const il=(n,e)=>{let t=ni(n);for(const[r,s]of Object.entries(e))t=t.replace(new RegExp(`PLACEHOLDER\\(\\s*(?:'${r}'|"${r}")\\s*\\)`,"g"),`(${s})`);return H5(t)};/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var xb=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},HS=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});const W5=20;async function*z5(n,e){const t={stack:[],error:void 0,hasError:!1};try{const s=await xb(t,await n.evaluateHandle(async(o,u)=>{const l=[];for(;l.length<u;){const d=await o.next();if(d.done)break;l.push(d.value)}return l},e),!1).getProperties(),i=s.values();return xb(t,new Xt,!1).defer(()=>{for(const o of i){const u={stack:[],error:void 0,hasError:!1};try{xb(u,o,!1)[Me]()}catch(l){u.error=l,u.hasError=!0}finally{HS(u)}}}),yield*i,s.size===0}catch(r){t.error=r,t.hasError=!0}finally{HS(t)}}async function*V5(n){let e=W5;for(;!(yield*z5(n,e));)e<<=1}async function*FI(n){const e={stack:[],error:void 0,hasError:!1};try{const t=xb(e,await n.evaluateHandle(r=>async function*(){yield*r}()),!1);yield*V5(t)}catch(t){e.error=t,e.hasError=!0}finally{HS(e)}}/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const _0=class _0{constructor(e){b(this,Cg);x(this,Cg,e)}async get(e){return await c(this,Cg).call(this,e)}};Cg=new WeakMap,Z(_0,"create",e=>new _0(e));let Mn=_0;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Eb=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},kb=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});class Ki{static get _querySelector(){if(this.querySelector)return this.querySelector;if(!this.querySelectorAll)throw new Error("Cannot create default `querySelector`.");return this.querySelector=il(async(e,t,r)=>{const i=PLACEHOLDER("querySelectorAll")(e,t,r);for await(const a of i)return a;return null},{querySelectorAll:ni(this.querySelectorAll)})}static get _querySelectorAll(){if(this.querySelectorAll)return this.querySelectorAll;if(!this.querySelector)throw new Error("Cannot create default `querySelectorAll`.");return this.querySelectorAll=il(async function*(e,t,r){const i=await PLACEHOLDER("querySelector")(e,t,r);i&&(yield i)},{querySelector:ni(this.querySelector)})}static async*queryAll(e,t){const r={stack:[],error:void 0,hasError:!1};try{const s=Eb(r,await e.evaluateHandle(this._querySelectorAll,t,Mn.create(i=>i.puppeteerUtil)),!1);yield*FI(s)}catch(s){r.error=s,r.hasError=!0}finally{kb(r)}}static async queryOne(e,t){const r={stack:[],error:void 0,hasError:!1};try{const s=Eb(r,await e.evaluateHandle(this._querySelector,t,Mn.create(i=>i.puppeteerUtil)),!1);return Sb in s?s.move():null}catch(s){r.error=s,r.hasError=!0}finally{kb(r)}}static async waitFor(e,t,r){const s={stack:[],error:void 0,hasError:!1};try{let i;const a=Eb(s,await(async()=>{if(!(Sb in e)){i=e;return}return i=e.frame,await i.isolatedRealm().adoptHandle(e)})(),!1),{visible:o=!1,hidden:u=!1,timeout:l,signal:d}=r,h=o||u?"raf":r.polling;try{const f={stack:[],error:void 0,hasError:!1};try{d==null||d.throwIfAborted();const p=Eb(f,await i.isolatedRealm().waitForFunction(async(m,g,y,w,S)=>{const v=await m.createFunction(g)(w??document,y,m);return m.checkVisibility(v,S)},{polling:h,root:a,timeout:l,signal:d},Mn.create(m=>m.puppeteerUtil),ni(this._querySelector),t,a,o?!0:u?!1:void 0),!1);if(d!=null&&d.aborted)throw d.reason;return Sb in p?await i.mainRealm().transferHandle(p):null}catch(p){f.error=p,f.hasError=!0}finally{kb(f)}}catch(f){throw!es(f)||f.name==="AbortError"||(f.message=`Waiting for selector \`${t}\` failed: ${f.message}`),f}}catch(i){s.error=i,s.hasError=!0}finally{kb(s)}}}Z(Ki,"querySelectorAll"),Z(Ki,"querySelector");class al{static async*map(e,t){for await(const r of e)yield await t(r)}static async*flatMap(e,t){for await(const r of e)yield*t(r)}static async collect(e){const t=[];for await(const r of e)t.push(r);return t}static async first(e){for await(const t of e)return t}}/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const G5=n=>["name","role"].includes(n),Z5=/\[\s*(?<attribute>\w+)\s*=\s*(?<quote>"|')(?<value>\\.|.*?(?=\k<quote>))\k<quote>\s*\]/g,J5=n=>{if(n.length>1e4)throw new Error(`Selector ${n} is too long`);const e={},t=n.replace(Z5,(r,s,i,a)=>(se(G5(s),`Unknown aria attribute "${s}" in selector`),e[s]=a,""));return t&&!e.name&&(e.name=t),e},Pg=class Pg extends Ki{static async*queryAll(e,t){const{name:r,role:s}=J5(t);yield*e.queryAXTree(r,s)}};Z(Pg,"querySelector",async(e,t,{ariaQuerySelector:r})=>await r(e,t)),Z(Pg,"queryOne",async(e,t)=>await al.first(Pg.queryAll(e,t))??null);let ac=Pg;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class Cb extends Ki{}Z(Cb,"querySelector",(e,t,{cssQuerySelector:r})=>r(e,t)),Z(Cb,"querySelectorAll",(e,t,{cssQuerySelectorAll:r})=>r(e,t));const X5='"use strict";var g=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var l=(t,e)=>{for(var r in e)g(t,r,{get:e[r],enumerable:!0})},J=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of B(e))!Y.call(t,n)&&n!==r&&g(t,n,{get:()=>e[n],enumerable:!(o=X(e,n))||o.enumerable});return t};var z=t=>J(g({},"__esModule",{value:!0}),t);var pe={};l(pe,{default:()=>he});module.exports=z(pe);var N=class extends Error{constructor(e,r){super(e,r),this.name=this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}},p=class extends N{};var c=class t{static create(e){return new t(e)}static async race(e){let r=new Set;try{let o=e.map(n=>n instanceof t?(n.#n&&r.add(n),n.valueOrThrow()):n);return await Promise.race(o)}finally{for(let o of r)o.reject(new Error("Timeout cleared"))}}#e=!1;#r=!1;#o;#t;#a=new Promise(e=>{this.#t=e});#n;#i;constructor(e){e&&e.timeout>0&&(this.#i=new p(e.message),this.#n=setTimeout(()=>{this.reject(this.#i)},e.timeout))}#l(e){clearTimeout(this.#n),this.#o=e,this.#t()}resolve(e){this.#r||this.#e||(this.#e=!0,this.#l(e))}reject(e){this.#r||this.#e||(this.#r=!0,this.#l(e))}resolved(){return this.#e}finished(){return this.#e||this.#r}value(){return this.#o}#s;valueOrThrow(){return this.#s||(this.#s=(async()=>{if(await this.#a,this.#r)throw this.#o;return this.#o})()),this.#s}};var L=new Map,F=t=>{let e=L.get(t);return e||(e=new Function(`return ${t}`)(),L.set(t,e),e)};var x={};l(x,{ariaQuerySelector:()=>G,ariaQuerySelectorAll:()=>b});var G=(t,e)=>globalThis.__ariaQuerySelector(t,e),b=async function*(t,e){yield*await globalThis.__ariaQuerySelectorAll(t,e)};var E={};l(E,{cssQuerySelector:()=>K,cssQuerySelectorAll:()=>Z});var K=(t,e)=>t.querySelector(e),Z=function(t,e){return t.querySelectorAll(e)};var A={};l(A,{customQuerySelectors:()=>P});var v=class{#e=new Map;register(e,r){if(!r.queryOne&&r.queryAll){let o=r.queryAll;r.queryOne=(n,i)=>{for(let s of o(n,i))return s;return null}}else if(r.queryOne&&!r.queryAll){let o=r.queryOne;r.queryAll=(n,i)=>{let s=o(n,i);return s?[s]:[]}}else if(!r.queryOne||!r.queryAll)throw new Error("At least one query method must be defined.");this.#e.set(e,{querySelector:r.queryOne,querySelectorAll:r.queryAll})}unregister(e){this.#e.delete(e)}get(e){return this.#e.get(e)}clear(){this.#e.clear()}},P=new v;var R={};l(R,{pierceQuerySelector:()=>ee,pierceQuerySelectorAll:()=>te});var ee=(t,e)=>{let r=null,o=n=>{let i=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT);do{let s=i.currentNode;s.shadowRoot&&o(s.shadowRoot),!(s instanceof ShadowRoot)&&s!==n&&!r&&s.matches(e)&&(r=s)}while(!r&&i.nextNode())};return t instanceof Document&&(t=t.documentElement),o(t),r},te=(t,e)=>{let r=[],o=n=>{let i=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT);do{let s=i.currentNode;s.shadowRoot&&o(s.shadowRoot),!(s instanceof ShadowRoot)&&s!==n&&s.matches(e)&&r.push(s)}while(i.nextNode())};return t instanceof Document&&(t=t.documentElement),o(t),r};var u=(t,e)=>{if(!t)throw new Error(e)};var y=class{#e;#r;#o;#t;constructor(e,r){this.#e=e,this.#r=r}async start(){let e=this.#t=c.create(),r=await this.#e();if(r){e.resolve(r);return}this.#o=new MutationObserver(async()=>{let o=await this.#e();o&&(e.resolve(o),await this.stop())}),this.#o.observe(this.#r,{childList:!0,subtree:!0,attributes:!0})}async stop(){u(this.#t,"Polling never started."),this.#t.finished()||this.#t.reject(new Error("Polling stopped")),this.#o&&(this.#o.disconnect(),this.#o=void 0)}result(){return u(this.#t,"Polling never started."),this.#t.valueOrThrow()}},w=class{#e;#r;constructor(e){this.#e=e}async start(){let e=this.#r=c.create(),r=await this.#e();if(r){e.resolve(r);return}let o=async()=>{if(e.finished())return;let n=await this.#e();if(!n){window.requestAnimationFrame(o);return}e.resolve(n),await this.stop()};window.requestAnimationFrame(o)}async stop(){u(this.#r,"Polling never started."),this.#r.finished()||this.#r.reject(new Error("Polling stopped"))}result(){return u(this.#r,"Polling never started."),this.#r.valueOrThrow()}},S=class{#e;#r;#o;#t;constructor(e,r){this.#e=e,this.#r=r}async start(){let e=this.#t=c.create(),r=await this.#e();if(r){e.resolve(r);return}this.#o=setInterval(async()=>{let o=await this.#e();o&&(e.resolve(o),await this.stop())},this.#r)}async stop(){u(this.#t,"Polling never started."),this.#t.finished()||this.#t.reject(new Error("Polling stopped")),this.#o&&(clearInterval(this.#o),this.#o=void 0)}result(){return u(this.#t,"Polling never started."),this.#t.valueOrThrow()}};var _={};l(_,{PCombinator:()=>H,pQuerySelector:()=>fe,pQuerySelectorAll:()=>$});var a=class{static async*map(e,r){for await(let o of e)yield await r(o)}static async*flatMap(e,r){for await(let o of e)yield*r(o)}static async collect(e){let r=[];for await(let o of e)r.push(o);return r}static async first(e){for await(let r of e)return r}};var C={};l(C,{textQuerySelectorAll:()=>m});var re=new Set(["checkbox","image","radio"]),oe=t=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLInputElement&&!re.has(t.type),ne=new Set(["SCRIPT","STYLE"]),f=t=>!ne.has(t.nodeName)&&!document.head?.contains(t),I=new WeakMap,j=t=>{for(;t;)I.delete(t),t instanceof ShadowRoot?t=t.host:t=t.parentNode},W=new WeakSet,se=new MutationObserver(t=>{for(let e of t)j(e.target)}),d=t=>{let e=I.get(t);if(e||(e={full:"",immediate:[]},!f(t)))return e;let r="";if(oe(t))e.full=t.value,e.immediate.push(t.value),t.addEventListener("input",o=>{j(o.target)},{once:!0,capture:!0});else{for(let o=t.firstChild;o;o=o.nextSibling){if(o.nodeType===Node.TEXT_NODE){e.full+=o.nodeValue??"",r+=o.nodeValue??"";continue}r&&e.immediate.push(r),r="",o.nodeType===Node.ELEMENT_NODE&&(e.full+=d(o).full)}r&&e.immediate.push(r),t instanceof Element&&t.shadowRoot&&(e.full+=d(t.shadowRoot).full),W.has(t)||(se.observe(t,{childList:!0,characterData:!0,subtree:!0}),W.add(t))}return I.set(t,e),e};var m=function*(t,e){let r=!1;for(let o of t.childNodes)if(o instanceof Element&&f(o)){let n;o.shadowRoot?n=m(o.shadowRoot,e):n=m(o,e);for(let i of n)yield i,r=!0}r||t instanceof Element&&f(t)&&d(t).full.includes(e)&&(yield t)};var k={};l(k,{checkVisibility:()=>le,pierce:()=>T,pierceAll:()=>O});var ie=["hidden","collapse"],le=(t,e)=>{if(!t)return e===!1;if(e===void 0)return t;let r=t.nodeType===Node.TEXT_NODE?t.parentElement:t,o=window.getComputedStyle(r),n=o&&!ie.includes(o.visibility)&&!ae(r);return e===n?t:!1};function ae(t){let e=t.getBoundingClientRect();return e.width===0||e.height===0}var ce=t=>"shadowRoot"in t&&t.shadowRoot instanceof ShadowRoot;function*T(t){ce(t)?yield t.shadowRoot:yield t}function*O(t){t=T(t).next().value,yield t;let e=[document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT)];for(let r of e){let o;for(;o=r.nextNode();)o.shadowRoot&&(yield o.shadowRoot,e.push(document.createTreeWalker(o.shadowRoot,NodeFilter.SHOW_ELEMENT)))}}var Q={};l(Q,{xpathQuerySelectorAll:()=>q});var q=function*(t,e,r=-1){let n=(t.ownerDocument||document).evaluate(e,t,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE),i=[],s;for(;(s=n.iterateNext())&&(i.push(s),!(r&&i.length===r)););for(let h=0;h<i.length;h++)s=i[h],yield s,delete i[h]};var ue=/[-\\w\\P{ASCII}*]/u,H=(r=>(r.Descendent=">>>",r.Child=">>>>",r))(H||{}),V=t=>"querySelectorAll"in t,M=class{#e;#r=[];#o=void 0;elements;constructor(e,r){this.elements=[e],this.#e=r,this.#t()}async run(){if(typeof this.#o=="string")switch(this.#o.trimStart()){case":scope":this.#t();break}for(;this.#o!==void 0;this.#t()){let e=this.#o;typeof e=="string"?e[0]&&ue.test(e[0])?this.elements=a.flatMap(this.elements,async function*(r){V(r)&&(yield*r.querySelectorAll(e))}):this.elements=a.flatMap(this.elements,async function*(r){if(!r.parentElement){if(!V(r))return;yield*r.querySelectorAll(e);return}let o=0;for(let n of r.parentElement.children)if(++o,n===r)break;yield*r.parentElement.querySelectorAll(`:scope>:nth-child(${o})${e}`)}):this.elements=a.flatMap(this.elements,async function*(r){switch(e.name){case"text":yield*m(r,e.value);break;case"xpath":yield*q(r,e.value);break;case"aria":yield*b(r,e.value);break;default:let o=P.get(e.name);if(!o)throw new Error(`Unknown selector type: ${e.name}`);yield*o.querySelectorAll(r,e.value)}})}}#t(){if(this.#r.length!==0){this.#o=this.#r.shift();return}if(this.#e.length===0){this.#o=void 0;return}let e=this.#e.shift();switch(e){case">>>>":{this.elements=a.flatMap(this.elements,T),this.#t();break}case">>>":{this.elements=a.flatMap(this.elements,O),this.#t();break}default:this.#r=e,this.#t();break}}},D=class{#e=new WeakMap;calculate(e,r=[]){if(e===null)return r;e instanceof ShadowRoot&&(e=e.host);let o=this.#e.get(e);if(o)return[...o,...r];let n=0;for(let s=e.previousSibling;s;s=s.previousSibling)++n;let i=this.calculate(e.parentNode,[n]);return this.#e.set(e,i),[...i,...r]}},U=(t,e)=>{if(t.length+e.length===0)return 0;let[r=-1,...o]=t,[n=-1,...i]=e;return r===n?U(o,i):r<n?-1:1},de=async function*(t){let e=new Set;for await(let o of t)e.add(o);let r=new D;yield*[...e.values()].map(o=>[o,r.calculate(o)]).sort(([,o],[,n])=>U(o,n)).map(([o])=>o)},$=function(t,e){let r=JSON.parse(e);if(r.some(o=>{let n=0;return o.some(i=>(typeof i=="string"?++n:n=0,n>1))}))throw new Error("Multiple deep combinators found in sequence.");return de(a.flatMap(r,o=>{let n=new M(t,o);return n.run(),n.elements}))},fe=async function(t,e){for await(let r of $(t,e))return r;return null};var me=Object.freeze({...x,...A,...R,..._,...C,...k,...Q,...E,Deferred:c,createFunction:F,createTextContent:d,IntervalPoller:S,isSuitableNodeForTextMatching:f,MutationPoller:y,RAFPoller:w}),he=me;\n';/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class Y5{constructor(){b(this,Uc);b(this,$d,!1);b(this,jd,new Set)}append(e){P(this,Uc,zA).call(this,()=>{c(this,jd).add(e)})}pop(e){P(this,Uc,zA).call(this,()=>{c(this,jd).delete(e)})}inject(e,t=!1){(c(this,$d)||t)&&e(P(this,Uc,QB).call(this)),x(this,$d,!1)}}$d=new WeakMap,jd=new WeakMap,Uc=new WeakSet,zA=function(e){e(),x(this,$d,!0)},QB=function(){return`(() => {
      const module = {};
      ${X5}
      ${[...c(this,jd)].map(e=>`(${e})(module.exports.default);`).join("")}
      return module.exports.default;
    })()`};const Ef=new Y5;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class Q5{constructor(){b(this,zs,new Map)}get(e){const t=c(this,zs).get(e);return t?t[1]:void 0}register(e,t){var i;se(!c(this,zs).has(e),`Cannot register over existing handler: ${e}`),se(/^[a-zA-Z]+$/.test(e),"Custom query handler names may only contain [a-zA-Z]"),se(t.queryAll||t.queryOne,"At least one query method must be implemented.");const r=(i=class extends Ki{},Z(i,"querySelectorAll",il((a,o,u)=>u.customQuerySelectors.get(PLACEHOLDER("name")).querySelectorAll(a,o),{name:JSON.stringify(e)})),Z(i,"querySelector",il((a,o,u)=>u.customQuerySelectors.get(PLACEHOLDER("name")).querySelector(a,o),{name:JSON.stringify(e)})),i),s=il(a=>{a.customQuerySelectors.register(PLACEHOLDER("name"),{queryAll:PLACEHOLDER("queryAll"),queryOne:PLACEHOLDER("queryOne")})},{name:JSON.stringify(e),queryAll:t.queryAll?ni(t.queryAll):String(void 0),queryOne:t.queryOne?ni(t.queryOne):String(void 0)}).toString();c(this,zs).set(e,[s,r]),Ef.append(s)}unregister(e){const t=c(this,zs).get(e);if(!t)throw new Error(`Cannot unregister unknown handler: ${e}`);Ef.pop(t[0]),c(this,zs).delete(e)}names(){return[...c(this,zs).keys()]}clear(){for(const[e]of c(this,zs))Ef.pop(e);c(this,zs).clear()}}zs=new WeakMap;const WS=new Q5;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class zS extends Ki{}Z(zS,"querySelector",(e,t,{pierceQuerySelector:r})=>r(e,t)),Z(zS,"querySelectorAll",(e,t,{pierceQuerySelectorAll:r})=>r(e,t));/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class VS extends Ki{}Z(VS,"querySelectorAll",(e,t,{pQuerySelectorAll:r})=>r(e,t)),Z(VS,"querySelector",(e,t,{pQuerySelector:r})=>r(e,t));var ol={attribute:/\[\s*(?:(?<namespace>\*|[-\w\P{ASCII}]*)\|)?(?<name>[-\w\P{ASCII}]+)\s*(?:(?<operator>\W?=)\s*(?<value>.+?)\s*(\s(?<caseSensitive>[iIsS]))?\s*)?\]/gu,id:/#(?<name>[-\w\P{ASCII}]+)/gu,class:/\.(?<name>[-\w\P{ASCII}]+)/gu,comma:/\s*,\s*/g,combinator:/\s*[\s>+~]\s*/g,"pseudo-element":/::(?<name>[-\w\P{ASCII}]+)(?:\((?<argument>*)\))?/gu,"pseudo-class":/:(?<name>[-\w\P{ASCII}]+)(?:\((?<argument>*)\))?/gu,universal:/(?:(?<namespace>\*|[-\w\P{ASCII}]*)\|)?\*/gu,type:/(?:(?<namespace>\*|[-\w\P{ASCII}]*)\|)?(?<name>[-\w\P{ASCII}]+)/gu},eK=new Set(["combinator","comma"]),tK=n=>{switch(n){case"pseudo-element":case"pseudo-class":return new RegExp(ol[n].source.replace("(?<argument>*)","(?<argument>.*)"),"gu");default:return ol[n]}};function rK(n,e){let t=0,r="";for(;e<n.length;e++){const s=n[e];switch(s){case"(":++t;break;case")":--t;break}if(r+=s,t===0)return r}return r}function nK(n,e=ol){if(!n)return[];const t=[n];for(const[s,i]of Object.entries(e))for(let a=0;a<t.length;a++){const o=t[a];if(typeof o!="string")continue;i.lastIndex=0;const u=i.exec(o);if(!u)continue;const l=u.index-1,d=[],h=u[0],f=o.slice(0,l+1);f&&d.push(f),d.push({...u.groups,type:s,content:h});const p=o.slice(l+h.length+1);p&&d.push(p),t.splice(a,1,...d)}let r=0;for(const s of t)switch(typeof s){case"string":throw new Error(`Unexpected sequence ${s} found at index ${r}`);case"object":r+=s.content.length,s.pos=[r-s.content.length,r],eK.has(s.type)&&(s.content=s.content.trim()||" ");break}return t}var sK=/(['"])([^\\\n]+?)\1/g,iK=/\\./g;function aK(n,e=ol){if(n=n.trim(),n==="")return[];const t=[];n=n.replace(iK,(i,a)=>(t.push({value:i,offset:a}),"".repeat(i.length))),n=n.replace(sK,(i,a,o,u)=>(t.push({value:i,offset:u}),`${a}${"".repeat(o.length)}${a}`));{let i=0,a;for(;(a=n.indexOf("(",i))>-1;){const o=rK(n,a);t.push({value:o,offset:a}),n=`${n.substring(0,a)}(${"".repeat(o.length-2)})${n.substring(a+o.length)}`,i=a+o.length}}const r=nK(n,e),s=new Set;for(const i of t.reverse())for(const a of r){const{offset:o,value:u}=i;if(!(a.pos[0]<=o&&o+u.length<=a.pos[1]))continue;const{content:l}=a,d=o-a.pos[0];a.content=l.slice(0,d)+u+l.slice(d+u.length),a.content!==l&&s.add(a)}for(const i of s){const a=tK(i.type);if(!a)throw new Error(`Unknown token type: ${i.type}`);a.lastIndex=0;const o=a.exec(i.content);if(!o)throw new Error(`Unable to parse content for ${i.type}: ${i.content}`);Object.assign(i,o.groups)}return r}function si(n){if(Array.isArray(n))return n.map(e=>e.content).join("");switch(n.type){case"list":return n.list.map(si).join(",");case"relative":return n.combinator+si(n.right);case"complex":return si(n.left)+n.combinator+si(n.right);case"compound":return n.list.map(si).join("");default:return n.content}}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */ol.nesting=/&/g,ol.combinator=/\s*(>>>>?|[\s>+~])\s*/g;const oK=/\\[\s\S]/g,cK=n=>n.length<=1?n:((n[0]==='"'||n[0]==="'")&&n.endsWith(n[0])&&(n=n.slice(1,-1)),n.replace(oK,e=>e[1]));function uK(n){let e=!0,t=!1,r=!1;const s=aK(n);if(s.length===0)return[[],e,r,!1];let i=[],a=[i];const o=[a],u=[];for(const l of s){switch(l.type){case"combinator":switch(l.content){case">>>":e=!1,u.length&&(i.push(si(u)),u.splice(0)),i=[],a.push(">>>"),a.push(i);continue;case">>>>":e=!1,u.length&&(i.push(si(u)),u.splice(0)),i=[],a.push(">>>>"),a.push(i);continue}break;case"pseudo-element":if(!l.name.startsWith("-p-"))break;e=!1,u.length&&(i.push(si(u)),u.splice(0));const d=l.name.slice(3);d==="aria"&&(t=!0),i.push({name:d,value:cK(l.argument??"")});continue;case"pseudo-class":r=!0;break;case"comma":u.length&&(i.push(si(u)),u.splice(0)),i=[],a=[i],o.push(a);continue}u.push(l)}return u.length&&i.push(si(u)),[o,e,r,t]}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class DI extends Ki{}Z(DI,"querySelectorAll",(e,t,{textQuerySelectorAll:r})=>r(e,t));/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class GS extends Ki{}Z(GS,"querySelectorAll",(e,t,{xpathQuerySelectorAll:r})=>r(e,t)),Z(GS,"querySelector",(e,t,{xpathQuerySelectorAll:r})=>{for(const s of r(e,t,1))return s;return null});/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const lK={aria:ac,pierce:zS,xpath:GS,text:DI},dK=["=","/"];function Pb(n){for(const e of[WS.names().map(t=>[t,WS.get(t)]),Object.entries(lK)])for(const[t,r]of e)for(const s of dK){const i=`${t}${s}`;if(n.startsWith(i))return n=n.slice(i.length),{updatedSelector:n,polling:t==="aria"?"raf":"mutation",QueryHandler:r}}try{const[e,t,r,s]=uK(n);return t?{updatedSelector:n,polling:r?"raf":"mutation",QueryHandler:Cb}:{updatedSelector:JSON.stringify(e),polling:s?"raf":"mutation",QueryHandler:VS}}catch{return{updatedSelector:n,polling:"mutation",QueryHandler:Cb}}}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var hK=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},fK=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});const kf=new WeakSet;function pK(n,e){let t=!1;if(n.prototype[Me]){const r=n.prototype[Me];n.prototype[Me]=function(){if(kf.has(this)){kf.delete(this);return}return r.call(this)},t=!0}if(n.prototype[ms]){const r=n.prototype[ms];n.prototype[ms]=function(){if(kf.has(this)){kf.delete(this);return}return r.call(this)},t=!0}return t&&(n.prototype.move=function(){return kf.add(this),this}),n}function ue(n=e=>`Attempted to use disposed ${e.constructor.name}.`){return(e,t)=>function(...r){if(this.disposed)throw new Error(n(this));return e.call(this,...r)}}function Da(n,e){return function(...t){if(!this.disposed)return n.call(this,...t)}}function ys(n,e){const t=new WeakMap;let r=-1;return function(...s){if(r===-1&&(r=s.length),r!==s.length)throw new Error("Memoized method was called with the wrong number of arguments");let i=!1,a=t;for(const o of s)a.has(o)||(i=!0,a.set(o,new WeakMap)),a=a.get(o);if(i)return n.call(this,...s)}}function mK(n=function(){return this}){return(e,t)=>{const r=new WeakMap;return async function(...s){const i={stack:[],error:void 0,hasError:!1};try{const a=n.call(this);let o=r.get(a);o||(o=new KS,r.set(a,o));const u=hK(i,await o.acquire(),!0);return await e.call(this,...s)}catch(a){i.error=a,i.hasError=!0}finally{const a=fK(i);a&&await a}}}}const Ab=new WeakMap,BI=function(n){const e=Ab.get(this)??new Map;if(e.has(n))return;const t=n!==void 0?(r,s)=>{n.includes(r)&&this.emit(r,s)}:(r,s)=>{this.emit(r,s)};e.set(n,t),Ab.set(this,e)};function Tb(n){return({set:e,get:t},r)=>(r.addInitializer(function(){return BI.apply(this,[n])}),{set(s){const i=Ab.get(this).get(n),a=t.call(this);a!==void 0&&a.off("*",i),s!==void 0&&(s.on("*",i),e.call(this,s))},init(s){if(s===void 0)return s;BI.apply(this,[n]);const i=Ab.get(this).get(n);return s.on("*",i),s}})}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var UI=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},ZS=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},gK=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},yK=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});let oc=(()=>{var o;let n=[pK],e,t=[],r,s=[],i,a;return o=class{constructor(){UI(this,s)}async evaluate(l,...d){return l=gr(this.evaluate.name,l),await this.realm.evaluate(l,this,...d)}async evaluateHandle(l,...d){return l=gr(this.evaluateHandle.name,l),await this.realm.evaluateHandle(l,this,...d)}async getProperty(l){return await this.evaluateHandle((d,h)=>d[h],l)}async getProperties(){const l=await this.evaluate(f=>{var g;const p=[],m=Object.getOwnPropertyDescriptors(f);for(const y in m)(g=m[y])!=null&&g.enumerable&&p.push(y);return p}),d=new Map,h=await Promise.all(l.map(f=>this.getProperty(f)));for(const[f,p]of Object.entries(l)){const m={stack:[],error:void 0,hasError:!1};try{const g=gK(m,h[f],!1);g&&d.set(p,g.move())}catch(g){m.error=g,m.hasError=!0}finally{yK(m)}}return d}[(i=[ue()],a=[ue()],Me)](){return void this.dispose().catch(_e)}[ms](){return this.dispose()}},r=o,(()=>{const l=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;ZS(o,null,i,{kind:"method",name:"getProperty",static:!1,private:!1,access:{has:d=>"getProperty"in d,get:d=>d.getProperty},metadata:l},null,s),ZS(o,null,a,{kind:"method",name:"getProperties",static:!1,private:!1,access:{has:d=>"getProperties"in d,get:d=>d.getProperties},metadata:l},null,s),ZS(null,e={value:r},n,{kind:"class",name:r.name,metadata:l},null,t),r=e.value,l&&Object.defineProperty(r,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:l}),UI(r,t)})(),r})();/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var wK=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},mt=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},Cf=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},Pf=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r}),bK=function(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})};function ct(n,e){return async function(...t){if(this.realm===this.frame.isolatedRealm())return await n.call(this,...t);let r;this.isolatedHandle?r=this.isolatedHandle:this.isolatedHandle=r=await this.frame.isolatedRealm().adoptHandle(this);const s=await n.call(r,...t);return s===r?this:s instanceof oc?await this.realm.transferHandle(s):(Array.isArray(s)&&await Promise.all(s.map(async(i,a,o)=>{i instanceof oc&&(o[a]=await this.realm.transferHandle(i))})),s instanceof Map&&await Promise.all([...s.entries()].map(async([i,a])=>{a instanceof oc&&s.set(i,await this.realm.transferHandle(a))})),s)}}let qI=(()=>{var j,VA,GA,ZA,eU,JA,XA,tU,rU,nU,de;let n=oc,e=[],t,r,s,i,a,o,u,l,d,h,f,p,m,g,y,w,S,_,v,A,k,C,E,N,I,$,O,T,L,U,J,F;return de=class extends n{constructor(R){super();b(this,j);Z(this,"isolatedHandle",wK(this,e));Z(this,"handle");this.handle=R,this[Sb]=!0}get id(){return this.handle.id}get disposed(){return this.handle.disposed}async getProperty(R){return await this.handle.getProperty(R)}async getProperties(){return await this.handle.getProperties()}async evaluate(R,...M){return R=gr(this.evaluate.name,R),await this.handle.evaluate(R,...M)}async evaluateHandle(R,...M){return R=gr(this.evaluateHandle.name,R),await this.handle.evaluateHandle(R,...M)}async jsonValue(){return await this.handle.jsonValue()}toString(){return this.handle.toString()}remoteObject(){return this.handle.remoteObject()}async dispose(){var R;await Promise.all([this.handle.dispose(),(R=this.isolatedHandle)==null?void 0:R.dispose()])}asElement(){return this}async $(R){const{updatedSelector:M,QueryHandler:q}=Pb(R);return await q.queryOne(this,M)}async $$(R,M){return(M==null?void 0:M.isolate)===!1?await P(this,j,GA).call(this,R):await c(this,j,VA).call(this,R)}async $eval(R,M,...q){const W={stack:[],error:void 0,hasError:!1};try{M=gr(this.$eval.name,M);const X=Cf(W,await this.$(R),!1);if(!X)throw new Error(`Error: failed to find element matching selector "${R}"`);return await X.evaluate(M,...q)}catch(X){W.error=X,W.hasError=!0}finally{Pf(W)}}async $$eval(R,M,...q){const W={stack:[],error:void 0,hasError:!1};try{M=gr(this.$$eval.name,M);const X=await this.$$(R),re=Cf(W,await this.evaluateHandle((Re,...le)=>le,...X),!1),[ce]=await Promise.all([re.evaluate(M,...q),...X.map(Re=>Re.dispose())]);return ce}catch(X){W.error=X,W.hasError=!0}finally{Pf(W)}}async waitForSelector(R,M={}){const{updatedSelector:q,QueryHandler:W,polling:X}=Pb(R);return await W.waitFor(this,q,{polling:X,...M})}async isVisible(){return await P(this,j,ZA).call(this,!0)}async isHidden(){return await P(this,j,ZA).call(this,!1)}async toElement(R){if(!await this.evaluate((q,W)=>q.nodeName===W.toUpperCase(),R))throw new Error(`Element is not a(n) \`${R}\` element`);return this}async clickablePoint(R){const M=await P(this,j,eU).call(this);if(!M)throw new Error("Node is either not clickable or not an Element");return R!==void 0?{x:M.x+R.x,y:M.y+R.y}:{x:M.x+M.width/2,y:M.y+M.height/2}}async hover(){await this.scrollIntoViewIfNeeded();const{x:R,y:M}=await this.clickablePoint();await this.frame.page().mouse.move(R,M)}async click(R={}){await this.scrollIntoViewIfNeeded();const{x:M,y:q}=await this.clickablePoint(R.offset);await this.frame.page().mouse.click(M,q,R)}async drag(R){await this.scrollIntoViewIfNeeded();const M=this.frame.page();if(M.isDragInterceptionEnabled()){const q=await this.clickablePoint();return R instanceof de&&(R=await R.clickablePoint()),await M.mouse.drag(q,R)}try{M._isDragging||(M._isDragging=!0,await this.hover(),await M.mouse.down()),R instanceof de?await R.hover():await M.mouse.move(R.x,R.y)}catch(q){throw M._isDragging=!1,q}}async dragEnter(R={items:[],dragOperationsMask:1}){const M=this.frame.page();await this.scrollIntoViewIfNeeded();const q=await this.clickablePoint();await M.mouse.dragEnter(q,R)}async dragOver(R={items:[],dragOperationsMask:1}){const M=this.frame.page();await this.scrollIntoViewIfNeeded();const q=await this.clickablePoint();await M.mouse.dragOver(q,R)}async drop(R={items:[],dragOperationsMask:1}){const M=this.frame.page();if("items"in R){await this.scrollIntoViewIfNeeded();const q=await this.clickablePoint();await M.mouse.drop(q,R)}else await R.drag(this),M._isDragging=!1,await M.mouse.up()}async dragAndDrop(R,M){const q=this.frame.page();se(q.isDragInterceptionEnabled(),"Drag Interception is not enabled!"),await this.scrollIntoViewIfNeeded();const W=await this.clickablePoint(),X=await R.clickablePoint();await q.mouse.dragAndDrop(W,X,M)}async select(...R){for(const M of R)se(qi(M),'Values must be strings. Found value "'+M+'" of type "'+typeof M+'"');return await this.evaluate((M,q)=>{const W=new Set(q);if(!(M instanceof HTMLSelectElement))throw new Error("Element is not a <select> element.");const X=new Set;if(M.multiple)for(const re of M.options)re.selected=W.has(re.value),re.selected&&X.add(re.value);else{for(const re of M.options)re.selected=!1;for(const re of M.options)if(W.has(re.value)){re.selected=!0,X.add(re.value);break}}return M.dispatchEvent(new Event("input",{bubbles:!0})),M.dispatchEvent(new Event("change",{bubbles:!0})),[...X.values()]},R)}async tap(){await this.scrollIntoViewIfNeeded();const{x:R,y:M}=await this.clickablePoint();await this.frame.page().touchscreen.tap(R,M)}async touchStart(){await this.scrollIntoViewIfNeeded();const{x:R,y:M}=await this.clickablePoint();return await this.frame.page().touchscreen.touchStart(R,M)}async touchMove(R){await this.scrollIntoViewIfNeeded();const{x:M,y:q}=await this.clickablePoint();if(R)return await R.move(M,q);await this.frame.page().touchscreen.touchMove(M,q)}async touchEnd(){await this.scrollIntoViewIfNeeded(),await this.frame.page().touchscreen.touchEnd()}async focus(){await this.evaluate(R=>{if(!(R instanceof HTMLElement))throw new Error("Cannot focus non-HTMLElement");return R.focus()})}async type(R,M){await this.focus(),await this.frame.page().keyboard.type(R,M)}async press(R,M){await this.focus(),await this.frame.page().keyboard.press(R,M)}async boundingBox(){const R=await this.evaluate(q=>{if(!(q instanceof Element)||q.getClientRects().length===0)return null;const W=q.getBoundingClientRect();return{x:W.x,y:W.y,width:W.width,height:W.height}});if(!R)return null;const M=await P(this,j,XA).call(this);return M?{x:R.x+M.x,y:R.y+M.y,height:R.height,width:R.width}:null}async boxModel(){const R=await this.evaluate(q=>{if(!(q instanceof Element)||q.getClientRects().length===0)return null;const W=q.getBoundingClientRect(),X=window.getComputedStyle(q),re={padding:{left:parseInt(X.paddingLeft,10),top:parseInt(X.paddingTop,10),right:parseInt(X.paddingRight,10),bottom:parseInt(X.paddingBottom,10)},margin:{left:-parseInt(X.marginLeft,10),top:-parseInt(X.marginTop,10),right:-parseInt(X.marginRight,10),bottom:-parseInt(X.marginBottom,10)},border:{left:parseInt(X.borderLeft,10),top:parseInt(X.borderTop,10),right:parseInt(X.borderRight,10),bottom:parseInt(X.borderBottom,10)}},ce=[{x:W.left,y:W.top},{x:W.left+W.width,y:W.top},{x:W.left+W.width,y:W.top+W.height},{x:W.left,y:W.top+W.height}],Re=Se(ce,re.border),le=Se(Re,re.padding),Ne=Se(ce,re.margin);return{content:le,padding:Re,border:ce,margin:Ne,width:W.width,height:W.height};function Se(H,ee){return[{x:H[0].x+ee.left,y:H[0].y+ee.top},{x:H[1].x-ee.right,y:H[1].y+ee.top},{x:H[2].x-ee.right,y:H[2].y-ee.bottom},{x:H[3].x+ee.left,y:H[3].y-ee.bottom}]}});if(!R)return null;const M=await P(this,j,XA).call(this);if(!M)return null;for(const q of["content","padding","border","margin"])for(const W of R[q])W.x+=M.x,W.y+=M.y;return R}async screenshot(R={}){const{scrollIntoView:M=!0,clip:q}=R,W=this.frame.page();M&&await this.scrollIntoViewIfNeeded();const X=await P(this,j,tU).call(this),[re,ce]=await this.evaluate(()=>{if(!window.visualViewport)throw new Error("window.visualViewport is not supported.");return[window.visualViewport.pageLeft,window.visualViewport.pageTop]});return X.x+=re,X.y+=ce,q&&(X.x+=q.x,X.y+=q.y,X.height=q.height,X.width=q.width),await W.screenshot({...R,clip:X})}async assertConnectedElement(){const R=await this.evaluate(async M=>{if(!M.isConnected)return"Node is detached from document";if(M.nodeType!==Node.ELEMENT_NODE)return"Node is not of type HTMLElement"});if(R)throw new Error(R)}async scrollIntoViewIfNeeded(){await this.isIntersectingViewport({threshold:1})||await this.scrollIntoView()}async isIntersectingViewport(R={}){var q;const M={stack:[],error:void 0,hasError:!1};try{await this.assertConnectedElement();const W=await P(this,j,rU).call(this);return await(Cf(M,W&&await P(q=W,j,nU).call(q),!1)??this).evaluate(async(re,ce)=>{const Re=await new Promise(le=>{const Ne=new IntersectionObserver(Se=>{le(Se[0].intersectionRatio),Ne.disconnect()});Ne.observe(re)});return ce===1?Re===1:Re>ce},R.threshold??0)}catch(W){M.error=W,M.hasError=!0}finally{Pf(M)}}async scrollIntoView(){await this.assertConnectedElement(),await this.evaluate(async R=>{R.scrollIntoView({block:"center",inline:"center",behavior:"instant"})})}},j=new WeakSet,VA=function(){return u.value},GA=async function(R){const{updatedSelector:M,QueryHandler:q}=Pb(R);return await al.collect(q.queryAll(this,M))},ZA=async function(R){return await this.evaluate(async(M,q,W)=>!!q.checkVisibility(M,W),Mn.create(M=>M.puppeteerUtil),R)},eU=async function(){var X;const R=await this.evaluate(re=>re instanceof Element?[...re.getClientRects()].map(ce=>({x:ce.x,y:ce.y,width:ce.width,height:ce.height})):null);if(!(R!=null&&R.length))return null;await P(this,j,JA).call(this,R);let M=this.frame,q;for(;q=M==null?void 0:M.parentFrame();){const re={stack:[],error:void 0,hasError:!1};try{const ce=Cf(re,await M.frameElement(),!1);if(!ce)throw new Error("Unsupported frame type");const Re=await ce.evaluate(le=>{if(le.getClientRects().length===0)return null;const Ne=le.getBoundingClientRect(),Se=window.getComputedStyle(le);return{left:Ne.left+parseInt(Se.paddingLeft,10)+parseInt(Se.borderLeftWidth,10),top:Ne.top+parseInt(Se.paddingTop,10)+parseInt(Se.borderTopWidth,10)}});if(!Re)return null;for(const le of R)le.x+=Re.left,le.y+=Re.top;await P(X=ce,j,JA).call(X,R),M=q}catch(ce){re.error=ce,re.hasError=!0}finally{Pf(re)}}const W=R.find(re=>re.width>=1&&re.height>=1);return W?{x:W.x,y:W.y,height:W.height,width:W.width}:null},JA=async function(R){const{documentWidth:M,documentHeight:q}=await this.frame.isolatedRealm().evaluate(()=>({documentWidth:document.documentElement.clientWidth,documentHeight:document.documentElement.clientHeight}));for(const W of R)_K(W,M,q)},XA=async function(){const R={x:0,y:0};let M=this.frame,q;for(;q=M==null?void 0:M.parentFrame();){const W={stack:[],error:void 0,hasError:!1};try{const X=Cf(W,await M.frameElement(),!1);if(!X)throw new Error("Unsupported frame type");const re=await X.evaluate(ce=>{if(ce.getClientRects().length===0)return null;const Re=ce.getBoundingClientRect(),le=window.getComputedStyle(ce);return{left:Re.left+parseInt(le.paddingLeft,10)+parseInt(le.borderLeftWidth,10),top:Re.top+parseInt(le.paddingTop,10)+parseInt(le.borderTopWidth,10)}});if(!re)return null;R.x+=re.left,R.y+=re.top,M=q}catch(X){W.error=X,W.hasError=!0}finally{Pf(W)}}return R},tU=async function(){const R=await this.boundingBox();return se(R,"Node is either not visible or not an HTMLElement"),se(R.width!==0,"Node has 0 width."),se(R.height!==0,"Node has 0 height."),R},rU=async function(){return await this.evaluate(R=>R instanceof SVGElement)?this:null},nU=async function(){return await this.evaluateHandle(R=>R instanceof SVGSVGElement?R:R.ownerSVGElement)},(()=>{const R=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[ue(),ct],r=[ue(),ct],s=[ue(),ct],i=[ue(),ct],a=[ue()],o=[ct],l=[ue(),ct],d=[ue(),ct],h=[ue(),ct],f=[ue(),ct],p=[ue(),ct],m=[ue(),ct],g=[ue(),ct],y=[ue(),ct],w=[ue(),ct],S=[ue(),ct],_=[ue(),ct],v=[ue(),ct],A=[ue(),ct],k=[ue(),ct],C=[ue(),ct],E=[ue(),ct],N=[ue(),ct],I=[ue(),ct],$=[ue(),ct],O=[ue(),ct],T=[ue(),ct],L=[ue(),ct],U=[ue(),ct],J=[ue(),ct],F=[ue(),ct],mt(de,null,t,{kind:"method",name:"getProperty",static:!1,private:!1,access:{has:M=>"getProperty"in M,get:M=>M.getProperty},metadata:R},null,e),mt(de,null,r,{kind:"method",name:"getProperties",static:!1,private:!1,access:{has:M=>"getProperties"in M,get:M=>M.getProperties},metadata:R},null,e),mt(de,null,s,{kind:"method",name:"jsonValue",static:!1,private:!1,access:{has:M=>"jsonValue"in M,get:M=>M.jsonValue},metadata:R},null,e),mt(de,null,i,{kind:"method",name:"$",static:!1,private:!1,access:{has:M=>"$"in M,get:M=>M.$},metadata:R},null,e),mt(de,null,a,{kind:"method",name:"$$",static:!1,private:!1,access:{has:M=>"$$"in M,get:M=>M.$$},metadata:R},null,e),mt(de,u={value:bK(async function(M){return await P(this,j,GA).call(this,M)},"#$$")},o,{kind:"method",name:"#$$",static:!1,private:!0,access:{has:M=>dn(j,M),get:M=>c(M,j,VA)},metadata:R},null,e),mt(de,null,l,{kind:"method",name:"waitForSelector",static:!1,private:!1,access:{has:M=>"waitForSelector"in M,get:M=>M.waitForSelector},metadata:R},null,e),mt(de,null,d,{kind:"method",name:"isVisible",static:!1,private:!1,access:{has:M=>"isVisible"in M,get:M=>M.isVisible},metadata:R},null,e),mt(de,null,h,{kind:"method",name:"isHidden",static:!1,private:!1,access:{has:M=>"isHidden"in M,get:M=>M.isHidden},metadata:R},null,e),mt(de,null,f,{kind:"method",name:"toElement",static:!1,private:!1,access:{has:M=>"toElement"in M,get:M=>M.toElement},metadata:R},null,e),mt(de,null,p,{kind:"method",name:"clickablePoint",static:!1,private:!1,access:{has:M=>"clickablePoint"in M,get:M=>M.clickablePoint},metadata:R},null,e),mt(de,null,m,{kind:"method",name:"hover",static:!1,private:!1,access:{has:M=>"hover"in M,get:M=>M.hover},metadata:R},null,e),mt(de,null,g,{kind:"method",name:"click",static:!1,private:!1,access:{has:M=>"click"in M,get:M=>M.click},metadata:R},null,e),mt(de,null,y,{kind:"method",name:"drag",static:!1,private:!1,access:{has:M=>"drag"in M,get:M=>M.drag},metadata:R},null,e),mt(de,null,w,{kind:"method",name:"dragEnter",static:!1,private:!1,access:{has:M=>"dragEnter"in M,get:M=>M.dragEnter},metadata:R},null,e),mt(de,null,S,{kind:"method",name:"dragOver",static:!1,private:!1,access:{has:M=>"dragOver"in M,get:M=>M.dragOver},metadata:R},null,e),mt(de,null,_,{kind:"method",name:"drop",static:!1,private:!1,access:{has:M=>"drop"in M,get:M=>M.drop},metadata:R},null,e),mt(de,null,v,{kind:"method",name:"dragAndDrop",static:!1,private:!1,access:{has:M=>"dragAndDrop"in M,get:M=>M.dragAndDrop},metadata:R},null,e),mt(de,null,A,{kind:"method",name:"select",static:!1,private:!1,access:{has:M=>"select"in M,get:M=>M.select},metadata:R},null,e),mt(de,null,k,{kind:"method",name:"tap",static:!1,private:!1,access:{has:M=>"tap"in M,get:M=>M.tap},metadata:R},null,e),mt(de,null,C,{kind:"method",name:"touchStart",static:!1,private:!1,access:{has:M=>"touchStart"in M,get:M=>M.touchStart},metadata:R},null,e),mt(de,null,E,{kind:"method",name:"touchMove",static:!1,private:!1,access:{has:M=>"touchMove"in M,get:M=>M.touchMove},metadata:R},null,e),mt(de,null,N,{kind:"method",name:"touchEnd",static:!1,private:!1,access:{has:M=>"touchEnd"in M,get:M=>M.touchEnd},metadata:R},null,e),mt(de,null,I,{kind:"method",name:"focus",static:!1,private:!1,access:{has:M=>"focus"in M,get:M=>M.focus},metadata:R},null,e),mt(de,null,$,{kind:"method",name:"type",static:!1,private:!1,access:{has:M=>"type"in M,get:M=>M.type},metadata:R},null,e),mt(de,null,O,{kind:"method",name:"press",static:!1,private:!1,access:{has:M=>"press"in M,get:M=>M.press},metadata:R},null,e),mt(de,null,T,{kind:"method",name:"boundingBox",static:!1,private:!1,access:{has:M=>"boundingBox"in M,get:M=>M.boundingBox},metadata:R},null,e),mt(de,null,L,{kind:"method",name:"boxModel",static:!1,private:!1,access:{has:M=>"boxModel"in M,get:M=>M.boxModel},metadata:R},null,e),mt(de,null,U,{kind:"method",name:"screenshot",static:!1,private:!1,access:{has:M=>"screenshot"in M,get:M=>M.screenshot},metadata:R},null,e),mt(de,null,J,{kind:"method",name:"isIntersectingViewport",static:!1,private:!1,access:{has:M=>"isIntersectingViewport"in M,get:M=>M.isIntersectingViewport},metadata:R},null,e),mt(de,null,F,{kind:"method",name:"scrollIntoView",static:!1,private:!1,access:{has:M=>"scrollIntoView"in M,get:M=>M.scrollIntoView},metadata:R},null,e),R&&Object.defineProperty(de,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:R})})(),de})();function _K(n,e,t){n.width=Math.max(n.x>=0?Math.min(e-n.x,n.width):Math.min(e,n.width+n.x),0),n.height=Math.max(n.y>=0?Math.min(t-n.y,n.height):Math.min(t,n.height+n.y),0)}var vK=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},SK=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r}),cl;(function(n){n.Action="action"})(cl||(cl={}));class ul extends xe{constructor(){super(...arguments);b(this,ki);Z(this,"visibility",null);Z(this,"_timeout",3e4);b(this,qc,!0);b(this,Kc,!0);b(this,Hc,!0);Z(this,"operators",{conditions:(t,r)=>mr(s=>_f(...t.map(i=>i(s,r))).pipe(_I(s))),retryAndRaceWithSignalAndTimer:(t,r)=>{const s=[];return t&&s.push(ic(t,r)),s.push(hn(this._timeout,r)),Nq(fb({delay:Nb}),Ir(...s))}});b(this,Ag,(t,r)=>c(this,Kc)?ot(t.frame.waitForFunction(s=>s instanceof HTMLElement?!["BUTTON","INPUT","SELECT","TEXTAREA","OPTION","OPTGROUP"].includes(s.nodeName)||!s.hasAttribute("disabled"):!0,{timeout:this._timeout,signal:r},t)).pipe(db()):tc);b(this,Wc,t=>c(this,Hc)?rc(()=>ot(t.evaluate(r=>new Promise(s=>{window.requestAnimationFrame(()=>{const i=r.getBoundingClientRect();window.requestAnimationFrame(()=>{const a=r.getBoundingClientRect();s([{x:i.x,y:i.y,width:i.width,height:i.height},{x:a.x,y:a.y,width:a.width,height:a.height}])})})})))).pipe(rl(([r,s])=>r.x===s.x&&r.y===s.y&&r.width===s.width&&r.height===s.height),fb({delay:Nb}),db()):tc);b(this,zc,t=>c(this,qc)?ot(t.isIntersectingViewport({threshold:0})).pipe(nc(r=>!r),mr(()=>ot(t.scrollIntoView())),mr(()=>rc(()=>ot(t.isIntersectingViewport({threshold:0}))).pipe(rl(ti),fb({delay:Nb}),db()))):tc)}static race(t){return JS.create(t)}get timeout(){return this._timeout}setTimeout(t){const r=this._clone();return r._timeout=t,r}setVisibility(t){const r=this._clone();return r.visibility=t,r}setWaitForEnabled(t){const r=this._clone();return x(r,Kc,t),r}setEnsureElementIsInTheViewport(t){const r=this._clone();return x(r,qc,t),r}setWaitForStableBoundingBox(t){const r=this._clone();return x(r,Hc,t),r}copyOptions(t){return this._timeout=t._timeout,this.visibility=t.visibility,x(this,Kc,c(t,Kc)),x(this,qc,c(t,qc)),x(this,Hc,c(t,Hc)),this}clone(){return this._clone()}async waitHandle(t){const r=new Error("Locator.waitHandle");return await pr(this._wait(t).pipe(this.operators.retryAndRaceWithSignalAndTimer(t==null?void 0:t.signal,r)))}async wait(t){const r={stack:[],error:void 0,hasError:!1};try{return await vK(r,await this.waitHandle(t),!1).jsonValue()}catch(s){r.error=s,r.hasError=!0}finally{SK(r)}}map(t){return new Rb(this._clone(),r=>r.evaluateHandle(t))}filter(t){return new Ob(this._clone(),async(r,s)=>(await r.frame.waitForFunction(t,{signal:s,timeout:this._timeout},r),!0))}filterHandle(t){return new Ob(this._clone(),t)}mapHandle(t){return new Rb(this._clone(),t)}click(t){return pr(P(this,ki,sU).call(this,t))}fill(t,r){return pr(P(this,ki,iU).call(this,t,r))}hover(t){return pr(P(this,ki,aU).call(this,t))}scroll(t){return pr(P(this,ki,oU).call(this,t))}}qc=new WeakMap,Kc=new WeakMap,Hc=new WeakMap,Ag=new WeakMap,Wc=new WeakMap,zc=new WeakMap,ki=new WeakSet,sU=function(t){const r=t==null?void 0:t.signal,s=new Error("Locator.click");return this._wait(t).pipe(this.operators.conditions([c(this,zc),c(this,Wc),c(this,Ag)],r),mb(()=>this.emit(cl.Action,void 0)),mr(i=>ot(i.click(t)).pipe(vf(a=>{throw i.dispose().catch(_e),a}))),this.operators.retryAndRaceWithSignalAndTimer(r,s))},iU=function(t,r){const s=r==null?void 0:r.signal,i=new Error("Locator.fill");return this._wait(r).pipe(this.operators.conditions([c(this,zc),c(this,Wc),c(this,Ag)],s),mb(()=>this.emit(cl.Action,void 0)),mr(a=>ot(a.evaluate(o=>o instanceof HTMLSelectElement?"select":o instanceof HTMLTextAreaElement?"typeable-input":o instanceof HTMLInputElement?new Set(["textarea","text","url","tel","search","password","number","email"]).has(o.type)?"typeable-input":"other-input":o.isContentEditable?"contenteditable":"unknown")).pipe(mr(o=>{switch(o){case"select":return ot(a.select(t).then(tl));case"contenteditable":case"typeable-input":return ot(a.evaluate((u,l)=>{const d=u.isContentEditable?u.innerText:u.value;if(l.length<=d.length||!l.startsWith(u.value))return u.isContentEditable?u.innerText="":u.value="",l;const h=u.isContentEditable?u.innerText:u.value;return u.isContentEditable?(u.innerText="",u.innerText=h):(u.value="",u.value=h),l.substring(h.length)},t)).pipe(mr(u=>ot(a.type(u))));case"other-input":return ot(a.focus()).pipe(mr(()=>ot(a.evaluate((u,l)=>{u.value=l,u.dispatchEvent(new Event("input",{bubbles:!0})),u.dispatchEvent(new Event("change",{bubbles:!0}))},t))));case"unknown":throw new Error("Element cannot be filled out.")}})).pipe(vf(o=>{throw a.dispose().catch(_e),o}))),this.operators.retryAndRaceWithSignalAndTimer(s,i))},aU=function(t){const r=t==null?void 0:t.signal,s=new Error("Locator.hover");return this._wait(t).pipe(this.operators.conditions([c(this,zc),c(this,Wc)],r),mb(()=>this.emit(cl.Action,void 0)),mr(i=>ot(i.hover()).pipe(vf(a=>{throw i.dispose().catch(_e),a}))),this.operators.retryAndRaceWithSignalAndTimer(r,s))},oU=function(t){const r=t==null?void 0:t.signal,s=new Error("Locator.scroll");return this._wait(t).pipe(this.operators.conditions([c(this,zc),c(this,Wc)],r),mb(()=>this.emit(cl.Action,void 0)),mr(i=>ot(i.evaluate((a,o,u)=>{o!==void 0&&(a.scrollTop=o),u!==void 0&&(a.scrollLeft=u)},t==null?void 0:t.scrollTop,t==null?void 0:t.scrollLeft)).pipe(vf(a=>{throw i.dispose().catch(_e),a}))),this.operators.retryAndRaceWithSignalAndTimer(r,s))};const v0=class v0 extends ul{constructor(t,r){super();b(this,Ld);b(this,Fd);x(this,Ld,t),x(this,Fd,r)}static create(t,r){return new v0(t,r).setTimeout("getDefaultTimeout"in t?t.getDefaultTimeout():t.page().getDefaultTimeout())}_clone(){return new v0(c(this,Ld),c(this,Fd))}_wait(t){const r=t==null?void 0:t.signal;return rc(()=>ot(c(this,Ld).waitForFunction(c(this,Fd),{timeout:this.timeout,signal:r}))).pipe(hb())}};Ld=new WeakMap,Fd=new WeakMap;let Ib=v0;class KI extends ul{constructor(t){super();b(this,zr);x(this,zr,t),this.copyOptions(c(this,zr))}get delegate(){return c(this,zr)}setTimeout(t){const r=super.setTimeout(t);return x(r,zr,c(this,zr).setTimeout(t)),r}setVisibility(t){const r=super.setVisibility(t);return x(r,zr,c(r,zr).setVisibility(t)),r}setWaitForEnabled(t){const r=super.setWaitForEnabled(t);return x(r,zr,c(this,zr).setWaitForEnabled(t)),r}setEnsureElementIsInTheViewport(t){const r=super.setEnsureElementIsInTheViewport(t);return x(r,zr,c(this,zr).setEnsureElementIsInTheViewport(t)),r}setWaitForStableBoundingBox(t){const r=super.setWaitForStableBoundingBox(t);return x(r,zr,c(this,zr).setWaitForStableBoundingBox(t)),r}}zr=new WeakMap;const PA=class PA extends KI{constructor(t,r){super(t);b(this,Dd);x(this,Dd,r)}_clone(){return new PA(this.delegate.clone(),c(this,Dd)).copyOptions(this)}_wait(t){return this.delegate._wait(t).pipe(mr(r=>ot(Promise.resolve(c(this,Dd).call(this,r,t==null?void 0:t.signal))).pipe(nc(s=>s),Vt(()=>r))),hb())}};Dd=new WeakMap;let Ob=PA;const AA=class AA extends KI{constructor(t,r){super(t);b(this,Bd);x(this,Bd,r)}_clone(){return new AA(this.delegate.clone(),c(this,Bd)).copyOptions(this)}_wait(t){return this.delegate._wait(t).pipe(mr(r=>ot(Promise.resolve(c(this,Bd).call(this,r,t==null?void 0:t.signal)))))}};Bd=new WeakMap;let Rb=AA;const x0=class x0 extends ul{constructor(t,r){super();b(this,Ud);b(this,qd);b(this,S0,t=>this.visibility?(()=>{switch(this.visibility){case"hidden":return rc(()=>ot(t.isHidden()));case"visible":return rc(()=>ot(t.isVisible()))}})().pipe(rl(ti),fb({delay:Nb}),db()):tc);x(this,Ud,t),x(this,qd,r)}static create(t,r){return new x0(t,r).setTimeout("getDefaultTimeout"in t?t.getDefaultTimeout():t.page().getDefaultTimeout())}_clone(){return new x0(c(this,Ud),c(this,qd)).copyOptions(this)}_wait(t){const r=t==null?void 0:t.signal;return rc(()=>ot(c(this,Ud).waitForSelector(c(this,qd),{visible:!1,timeout:this._timeout,signal:r}))).pipe(nc(s=>s!==null),hb(),this.operators.conditions([c(this,S0)],r))}};Ud=new WeakMap,qd=new WeakMap,S0=new WeakMap;let Mb=x0;function xK(n){for(const e of n)if(!(e instanceof ul))throw new Error("Unknown locator for race candidate");return n}const E0=class E0 extends ul{constructor(t){super();b(this,Kd);x(this,Kd,t)}static create(t){const r=xK(t);return new E0(r)}_clone(){return new E0(c(this,Kd).map(t=>t.clone())).copyOptions(this)}_wait(t){return wI(...c(this,Kd).map(r=>r._wait(t)))}};Kd=new WeakMap;let JS=E0;const Nb=100;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var EK=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Yt=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},Ba=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},Ua=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r}),Or;(function(n){n.FrameNavigated=Symbol("Frame.FrameNavigated"),n.FrameSwapped=Symbol("Frame.FrameSwapped"),n.LifecycleEvent=Symbol("Frame.LifecycleEvent"),n.FrameNavigatedWithinDocument=Symbol("Frame.FrameNavigatedWithinDocument"),n.FrameDetached=Symbol("Frame.FrameDetached"),n.FrameSwappedByActivation=Symbol("Frame.FrameSwappedByActivation")})(Or||(Or={}));const rt=ue(n=>`Attempted to use detached Frame '${n._id}'.`);let HI=(()=>{var k,C,Hw,N;let n=xe,e=[],t,r,s,i,a,o,u,l,d,h,f,p,m,g,y,w,S,_,v,A;return N=class extends n{constructor(){super();b(this,C);Z(this,"_id",EK(this,e));Z(this,"_parentId");Z(this,"_name");Z(this,"_hasStartedLoading",!1);b(this,k)}clearDocumentHandle(){x(this,k,void 0)}async frameElement(){const O={stack:[],error:void 0,hasError:!1};try{const T=this.parentFrame();if(!T)return null;const L=Ba(O,await T.isolatedRealm().evaluateHandle(()=>document.querySelectorAll("iframe,frame")),!1);for await(const U of FI(L)){const J={stack:[],error:void 0,hasError:!1};try{const F=Ba(J,U,!1),j=await F.contentFrame();if((j==null?void 0:j._id)===this._id)return await T.mainRealm().adoptHandle(F)}catch(F){J.error=F,J.hasError=!0}finally{Ua(J)}}return null}catch(T){O.error=T,O.hasError=!0}finally{Ua(O)}}async evaluateHandle(O,...T){return O=gr(this.evaluateHandle.name,O),await this.mainRealm().evaluateHandle(O,...T)}async evaluate(O,...T){return O=gr(this.evaluate.name,O),await this.mainRealm().evaluate(O,...T)}locator(O){return typeof O=="string"?Mb.create(this,O):Ib.create(this,O)}async $(O){return await(await P(this,C,Hw).call(this)).$(O)}async $$(O,T){return await(await P(this,C,Hw).call(this)).$$(O,T)}async $eval(O,T,...L){return T=gr(this.$eval.name,T),await(await P(this,C,Hw).call(this)).$eval(O,T,...L)}async $$eval(O,T,...L){return T=gr(this.$$eval.name,T),await(await P(this,C,Hw).call(this)).$$eval(O,T,...L)}async waitForSelector(O,T={}){const{updatedSelector:L,QueryHandler:U,polling:J}=Pb(O);return await U.waitFor(this,L,{polling:J,...T})}async waitForFunction(O,T={},...L){return await this.mainRealm().waitForFunction(O,T,...L)}async content(){return await this.evaluate(()=>{let O="";for(const T of document.childNodes)switch(T){case document.documentElement:O+=document.documentElement.outerHTML;break;default:O+=new XMLSerializer().serializeToString(T);break}return O})}async setFrameContent(O){return await this.evaluate(T=>{document.open(),document.write(T),document.close()},O)}name(){return this._name||""}isDetached(){return this.detached}get disposed(){return this.detached}async addScriptTag(O){let{content:T="",type:L}=O;const{path:U}=O;if(+!!O.url+ +!!U+ +!!T!=1)throw new Error("Exactly one of `url`, `path`, or `content` must be specified.");return U&&(T=await Fa.value.fs.promises.readFile(U,"utf8"),T+=`//# sourceURL=${U.replace(/\n/g,"")}`),L=L??"text/javascript",await this.mainRealm().transferHandle(await this.isolatedRealm().evaluateHandle(async({url:J,id:F,type:j,content:B})=>await new Promise((D,z)=>{const G=document.createElement("script");G.type=j,G.text=B,G.addEventListener("error",te=>{z(new Error(te.message??"Could not load script"))},{once:!0}),F&&(G.id=F),J?(G.src=J,G.addEventListener("load",()=>{D(G)},{once:!0}),document.head.appendChild(G)):(document.head.appendChild(G),D(G))}),{...O,type:L,content:T}))}async addStyleTag(O){let{content:T=""}=O;const{path:L}=O;if(+!!O.url+ +!!L+ +!!T!=1)throw new Error("Exactly one of `url`, `path`, or `content` must be specified.");return L&&(T=await Fa.value.fs.promises.readFile(L,"utf8"),T+="/*# sourceURL="+L.replace(/\n/g,"")+"*/",O.content=T),await this.mainRealm().transferHandle(await this.isolatedRealm().evaluateHandle(async({url:U,content:J})=>await new Promise((F,j)=>{let B;if(!U)B=document.createElement("style"),B.appendChild(document.createTextNode(J));else{const D=document.createElement("link");D.rel="stylesheet",D.href=U,B=D}return B.addEventListener("load",()=>{F(B)},{once:!0}),B.addEventListener("error",D=>{j(new Error(D.message??"Could not load style"))},{once:!0}),document.head.appendChild(B),B}),O))}async click(O,T={}){const L={stack:[],error:void 0,hasError:!1};try{const U=Ba(L,await this.$(O),!1);se(U,`No element found for selector: ${O}`),await U.click(T),await U.dispose()}catch(U){L.error=U,L.hasError=!0}finally{Ua(L)}}async focus(O){const T={stack:[],error:void 0,hasError:!1};try{const L=Ba(T,await this.$(O),!1);se(L,`No element found for selector: ${O}`),await L.focus()}catch(L){T.error=L,T.hasError=!0}finally{Ua(T)}}async hover(O){const T={stack:[],error:void 0,hasError:!1};try{const L=Ba(T,await this.$(O),!1);se(L,`No element found for selector: ${O}`),await L.hover()}catch(L){T.error=L,T.hasError=!0}finally{Ua(T)}}async select(O,...T){const L={stack:[],error:void 0,hasError:!1};try{const U=Ba(L,await this.$(O),!1);return se(U,`No element found for selector: ${O}`),await U.select(...T)}catch(U){L.error=U,L.hasError=!0}finally{Ua(L)}}async tap(O){const T={stack:[],error:void 0,hasError:!1};try{const L=Ba(T,await this.$(O),!1);se(L,`No element found for selector: ${O}`),await L.tap()}catch(L){T.error=L,T.hasError=!0}finally{Ua(T)}}async type(O,T,L){const U={stack:[],error:void 0,hasError:!1};try{const J=Ba(U,await this.$(O),!1);se(J,`No element found for selector: ${O}`),await J.type(T,L)}catch(J){U.error=J,U.hasError=!0}finally{Ua(U)}}async title(){return await this.isolatedRealm().evaluate(()=>document.title)}},k=new WeakMap,C=new WeakSet,Hw=function(){return c(this,k)||x(this,k,this.mainRealm().evaluateHandle(()=>document)),c(this,k)},(()=>{const O=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[rt],r=[rt],s=[rt],i=[rt],a=[rt],o=[rt],u=[rt],l=[rt],d=[rt],h=[rt],f=[rt],p=[rt],m=[rt],g=[rt],y=[rt],w=[rt],S=[rt],_=[rt],v=[rt],A=[rt],Yt(N,null,t,{kind:"method",name:"frameElement",static:!1,private:!1,access:{has:T=>"frameElement"in T,get:T=>T.frameElement},metadata:O},null,e),Yt(N,null,r,{kind:"method",name:"evaluateHandle",static:!1,private:!1,access:{has:T=>"evaluateHandle"in T,get:T=>T.evaluateHandle},metadata:O},null,e),Yt(N,null,s,{kind:"method",name:"evaluate",static:!1,private:!1,access:{has:T=>"evaluate"in T,get:T=>T.evaluate},metadata:O},null,e),Yt(N,null,i,{kind:"method",name:"locator",static:!1,private:!1,access:{has:T=>"locator"in T,get:T=>T.locator},metadata:O},null,e),Yt(N,null,a,{kind:"method",name:"$",static:!1,private:!1,access:{has:T=>"$"in T,get:T=>T.$},metadata:O},null,e),Yt(N,null,o,{kind:"method",name:"$$",static:!1,private:!1,access:{has:T=>"$$"in T,get:T=>T.$$},metadata:O},null,e),Yt(N,null,u,{kind:"method",name:"$eval",static:!1,private:!1,access:{has:T=>"$eval"in T,get:T=>T.$eval},metadata:O},null,e),Yt(N,null,l,{kind:"method",name:"$$eval",static:!1,private:!1,access:{has:T=>"$$eval"in T,get:T=>T.$$eval},metadata:O},null,e),Yt(N,null,d,{kind:"method",name:"waitForSelector",static:!1,private:!1,access:{has:T=>"waitForSelector"in T,get:T=>T.waitForSelector},metadata:O},null,e),Yt(N,null,h,{kind:"method",name:"waitForFunction",static:!1,private:!1,access:{has:T=>"waitForFunction"in T,get:T=>T.waitForFunction},metadata:O},null,e),Yt(N,null,f,{kind:"method",name:"content",static:!1,private:!1,access:{has:T=>"content"in T,get:T=>T.content},metadata:O},null,e),Yt(N,null,p,{kind:"method",name:"addScriptTag",static:!1,private:!1,access:{has:T=>"addScriptTag"in T,get:T=>T.addScriptTag},metadata:O},null,e),Yt(N,null,m,{kind:"method",name:"addStyleTag",static:!1,private:!1,access:{has:T=>"addStyleTag"in T,get:T=>T.addStyleTag},metadata:O},null,e),Yt(N,null,g,{kind:"method",name:"click",static:!1,private:!1,access:{has:T=>"click"in T,get:T=>T.click},metadata:O},null,e),Yt(N,null,y,{kind:"method",name:"focus",static:!1,private:!1,access:{has:T=>"focus"in T,get:T=>T.focus},metadata:O},null,e),Yt(N,null,w,{kind:"method",name:"hover",static:!1,private:!1,access:{has:T=>"hover"in T,get:T=>T.hover},metadata:O},null,e),Yt(N,null,S,{kind:"method",name:"select",static:!1,private:!1,access:{has:T=>"select"in T,get:T=>T.select},metadata:O},null,e),Yt(N,null,_,{kind:"method",name:"tap",static:!1,private:!1,access:{has:T=>"tap"in T,get:T=>T.tap},metadata:O},null,e),Yt(N,null,v,{kind:"method",name:"type",static:!1,private:!1,access:{has:T=>"type"in T,get:T=>T.type},metadata:O},null,e),Yt(N,null,A,{kind:"method",name:"title",static:!1,private:!1,access:{has:T=>"title"in T,get:T=>T.title},metadata:O},null,e),O&&Object.defineProperty(N,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:O})})(),N})();class $b{constructor(){b(this,Hd);Z(this,"_interceptionId");Z(this,"_failureText",null);Z(this,"_response",null);Z(this,"_fromMemoryCache",!1);Z(this,"_redirectChain",[]);Z(this,"interception",{enabled:!1,handled:!1,handlers:[],resolutionState:{action:ii.None},requestOverrides:{},response:null,abortReason:null})}continueRequestOverrides(){return se(this.interception.enabled,"Request Interception is not enabled!"),this.interception.requestOverrides}responseForRequest(){return se(this.interception.enabled,"Request Interception is not enabled!"),this.interception.response}abortErrorReason(){return se(this.interception.enabled,"Request Interception is not enabled!"),this.interception.abortReason}interceptResolutionState(){return this.interception.enabled?this.interception.handled?{action:ii.AlreadyHandled}:{...this.interception.resolutionState}:{action:ii.Disabled}}isInterceptResolutionHandled(){return this.interception.handled}enqueueInterceptAction(e){this.interception.handlers.push(e)}async finalizeInterceptions(){await this.interception.handlers.reduce((t,r)=>t.then(r),Promise.resolve()),this.interception.handlers=[];const{action:e}=this.interceptResolutionState();switch(e){case"abort":return await this._abort(this.interception.abortReason);case"respond":if(this.interception.response===null)throw new Error("Response is missing for the interception");return await this._respond(this.interception.response);case"continue":return await this._continue(this.interception.requestOverrides)}}async continue(e={},t){if(P(this,Hd,q0).call(this)){if(se(this.interception.enabled,"Request Interception is not enabled!"),se(!this.interception.handled,"Request is already handled!"),t===void 0)return await this._continue(e);if(this.interception.requestOverrides=e,this.interception.resolutionState.priority===void 0||t>this.interception.resolutionState.priority){this.interception.resolutionState={action:ii.Continue,priority:t};return}if(t===this.interception.resolutionState.priority){if(this.interception.resolutionState.action==="abort"||this.interception.resolutionState.action==="respond")return;this.interception.resolutionState.action=ii.Continue}}}async respond(e,t){if(P(this,Hd,q0).call(this)){if(se(this.interception.enabled,"Request Interception is not enabled!"),se(!this.interception.handled,"Request is already handled!"),t===void 0)return await this._respond(e);if(this.interception.response=e,this.interception.resolutionState.priority===void 0||t>this.interception.resolutionState.priority){this.interception.resolutionState={action:ii.Respond,priority:t};return}if(t===this.interception.resolutionState.priority){if(this.interception.resolutionState.action==="abort")return;this.interception.resolutionState.action=ii.Respond}}}async abort(e="failed",t){if(!P(this,Hd,q0).call(this))return;const r=kK[e];if(se(r,"Unknown error code: "+e),se(this.interception.enabled,"Request Interception is not enabled!"),se(!this.interception.handled,"Request is already handled!"),t===void 0)return await this._abort(r);if(this.interception.abortReason=r,this.interception.resolutionState.priority===void 0||t>=this.interception.resolutionState.priority){this.interception.resolutionState={action:ii.Abort,priority:t};return}}static getResponse(e){const t=qi(e)?new TextEncoder().encode(e):e;return{contentLength:t.byteLength,base64:EI(t)}}}Hd=new WeakSet,q0=function(){return!this.url().startsWith("data:")&&!this._fromMemoryCache};var ii;(function(n){n.Abort="abort",n.Respond="respond",n.Continue="continue",n.Disabled="disabled",n.None="none",n.AlreadyHandled="already-handled"})(ii||(ii={}));function WI(n){const e=[];for(const t in n){const r=n[t];if(!Object.is(r,void 0)){const s=Array.isArray(r)?r:[r];e.push(...s.map(i=>({name:t,value:i+""})))}}return e}const zI={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Switch Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",510:"Not Extended",511:"Network Authentication Required"},kK={aborted:"Aborted",accessdenied:"AccessDenied",addressunreachable:"AddressUnreachable",blockedbyclient:"BlockedByClient",blockedbyresponse:"BlockedByResponse",connectionaborted:"ConnectionAborted",connectionclosed:"ConnectionClosed",connectionfailed:"ConnectionFailed",connectionrefused:"ConnectionRefused",connectionreset:"ConnectionReset",internetdisconnected:"InternetDisconnected",namenotresolved:"NameNotResolved",timedout:"TimedOut",failed:"Failed"};function jb(n){if(n.originalMessage.includes("Invalid header")||n.originalMessage.includes('Expected "header"')||n.originalMessage.includes("invalid argument"))throw n;_e(n)}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class VI{constructor(){}ok(){const e=this.status();return e===0||e>=200&&e<=299}async buffer(){const e=await this.content();return Buffer.from(e)}async text(){const e=await this.content();return new TextDecoder().decode(e)}async json(){const e=await this.text();return JSON.parse(e)}}/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */function GI(){let n=0;return()=>++n}/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class ZI{constructor(){}}const Lt=Object.freeze({Left:"left",Right:"right",Middle:"middle",Back:"back",Forward:"forward"});class JI{constructor(){}}class XI{constructor(){Z(this,"idGenerator",GI());Z(this,"touches",[])}removeHandle(e){const t=this.touches.indexOf(e);t!==-1&&this.touches.splice(t,1)}async tap(e,t){await(await this.touchStart(e,t)).end()}async touchMove(e,t){const r=this.touches[0];if(!r)throw new bb("Must start a new Touch first");return await r.move(e,t)}async touchEnd(){const e=this.touches.shift();if(!e)throw new bb("Must start a new Touch first");await e.end()}}/**
 * @license
 * Copyright 2019 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const YI=3e4;class XS{constructor(){b(this,da);b(this,Vc);x(this,da,null),x(this,Vc,null)}setDefaultTimeout(e){x(this,da,e)}setDefaultNavigationTimeout(e){x(this,Vc,e)}navigationTimeout(){return c(this,Vc)!==null?c(this,Vc):c(this,da)!==null?c(this,da):YI}timeout(){return c(this,da)!==null?c(this,da):YI}}da=new WeakMap,Vc=new WeakMap;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var CK=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},PK=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},YS=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},QI=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});function AK(n){n.optimizeForSpeed??(n.optimizeForSpeed=!1),n.type??(n.type="png"),n.fromSurface??(n.fromSurface=!0),n.fullPage??(n.fullPage=!1),n.omitBackground??(n.omitBackground=!1),n.encoding??(n.encoding="binary"),n.captureBeyondViewport??(n.captureBeyondViewport=!0)}let eO=(()=>{var r,s,i,a,o,cU,l;let n=xe,e=[],t;return l=class extends n{constructor(){super();b(this,o);Z(this,"_isDragging",(CK(this,e),!1));Z(this,"_timeoutSettings",new XS);b(this,r,new WeakMap);b(this,s,new Bq(1));b(this,i,0);b(this,a);St(this,"request").pipe(mr(f=>NS(ri(1),_f(St(this,"requestfailed"),St(this,"requestfinished"),St(this,"response").pipe(Vt(p=>p.request()))).pipe(nc(p=>p.id===f.id),LS(1),Vt(()=>-1)))),O5((f,p)=>ri(f+p),0),M5(St(this,"close")),R5(0)).subscribe(c(this,s))}on(f,p){if(f!=="request")return super.on(f,p);let m=c(this,r).get(p);return m===void 0&&(m=g=>{g.enqueueInterceptAction(()=>p(g))},c(this,r).set(p,m)),super.on(f,m)}off(f,p){return f==="request"&&(p=c(this,r).get(p)||p),super.off(f,p)}get accessibility(){return this.mainFrame().accessibility}locator(f){return typeof f=="string"?Mb.create(this,f):Ib.create(this,f)}locatorRace(f){return ul.race(f)}async $(f){return await this.mainFrame().$(f)}async $$(f,p){return await this.mainFrame().$$(f,p)}async evaluateHandle(f,...p){return f=gr(this.evaluateHandle.name,f),await this.mainFrame().evaluateHandle(f,...p)}async $eval(f,p,...m){return p=gr(this.$eval.name,p),await this.mainFrame().$eval(f,p,...m)}async $$eval(f,p,...m){return p=gr(this.$$eval.name,p),await this.mainFrame().$$eval(f,p,...m)}async addScriptTag(f){return await this.mainFrame().addScriptTag(f)}async addStyleTag(f){return await this.mainFrame().addStyleTag(f)}url(){return this.mainFrame().url()}async content(){return await this.mainFrame().content()}async setContent(f,p){await this.mainFrame().setContent(f,p)}async goto(f,p){return await this.mainFrame().goto(f,p)}async waitForNavigation(f={}){return await this.mainFrame().waitForNavigation(f)}waitForRequest(f,p={}){const{timeout:m=this._timeoutSettings.timeout(),signal:g}=p;if(typeof f=="string"){const w=f;f=S=>S.url()===w}const y=St(this,"request").pipe(Sf(f),Ir(hn(m),ic(g),St(this,"close").pipe(Vt(()=>{throw new gs("Page closed!")}))));return pr(y)}waitForResponse(f,p={}){const{timeout:m=this._timeoutSettings.timeout(),signal:g}=p;if(typeof f=="string"){const w=f;f=S=>S.url()===w}const y=St(this,"response").pipe(Sf(f),Ir(hn(m),ic(g),St(this,"close").pipe(Vt(()=>{throw new gs("Page closed!")}))));return pr(y)}waitForNetworkIdle(f={}){return pr(this.waitForNetworkIdle$(f))}waitForNetworkIdle$(f={}){const{timeout:p=this._timeoutSettings.timeout(),idleTime:m=K5,concurrency:g=0,signal:y}=f;return c(this,s).pipe(pb(w=>w>g?tc:jS(m)),Vt(()=>{}),Ir(hn(p),ic(y),St(this,"close").pipe(Vt(()=>{throw new gs("Page closed!")}))))}async waitForFrame(f,p={}){const{timeout:m=this.getDefaultTimeout(),signal:g}=p,y=qi(f)?w=>f===w.url():f;return await pr(_f(St(this,"frameattached"),St(this,"framenavigated"),ot(this.frames())).pipe(Sf(y),rl(),Ir(hn(m),ic(g),St(this,"close").pipe(Vt(()=>{throw new gs("Page closed.")})))))}async emulate(f){await Promise.all([this.setUserAgent(f.userAgent),this.setViewport(f.viewport)])}async evaluate(f,...p){return f=gr(this.evaluate.name,f),await this.mainFrame().evaluate(f,...p)}async _maybeWriteTypedArrayToFile(f,p){f&&await Fa.value.fs.promises.writeFile(f,p)}async screencast(f={}){const p=Fa.value.ScreenRecorder,[m,g,y]=await P(this,o,cU).call(this);let w;if(f.crop){const{x:_,y:v,width:A,height:k}=rO(tO(f.crop));if(_<0||v<0)throw new Error("`crop.x` and `crop.y` must be greater than or equal to 0.");if(A<=0||k<=0)throw new Error("`crop.height` and `crop.width` must be greater than or equal to 0.");const C=m/y,E=g/y;if(_+A>C)throw new Error(`\`crop.width\` cannot be larger than the viewport width (${C}).`);if(v+k>E)throw new Error(`\`crop.height\` cannot be larger than the viewport height (${E}).`);w={x:_*y,y:v*y,width:A*y,height:k*y}}if(f.speed!==void 0&&f.speed<=0)throw new Error("`speed` must be greater than 0.");if(f.scale!==void 0&&f.scale<=0)throw new Error("`scale` must be greater than 0.");const S=new p(this,m,g,{...f,path:f.ffmpegPath,crop:w});try{await this._startScreencast()}catch(_){throw S.stop(),_}if(f.path){const{createWriteStream:_}=Fa.value.fs,v=_(f.path,"binary");S.pipe(v)}return S}async _startScreencast(){++of(this,i)._,c(this,a)||x(this,a,this.mainFrame().client.send("Page.startScreencast",{format:"png"}).then(()=>new Promise(f=>this.mainFrame().client.once("Page.screencastFrame",()=>f())))),await c(this,a)}async _stopScreencast(){--of(this,i)._,c(this,a)&&(x(this,a,void 0),c(this,i)===0&&await this.mainFrame().client.send("Page.stopScreencast"))}async screenshot(f={}){const p={stack:[],error:void 0,hasError:!1};try{const m=YS(p,await this.browserContext().startScreenshot(),!1),g={...f,clip:f.clip?{...f.clip}:void 0};if(g.type===void 0&&g.path!==void 0){const _=g.path;switch(_.slice(_.lastIndexOf(".")+1).toLowerCase()){case"png":g.type="png";break;case"jpeg":case"jpg":g.type="jpeg";break;case"webp":g.type="webp";break}}if(g.quality!==void 0){if(g.quality<0||g.quality>100)throw new Error(`Expected 'quality' (${g.quality}) to be between 0 and 100, inclusive.`);if(g.type===void 0||!["jpeg","webp"].includes(g.type))throw new Error(`${g.type??"png"} screenshots do not support 'quality'.`)}if(g.clip){if(g.clip.width<=0)throw new Error("'width' in 'clip' must be positive.");if(g.clip.height<=0)throw new Error("'height' in 'clip' must be positive.")}AK(g);const y=YS(p,new gb,!0);if(g.clip){if(g.fullPage)throw new Error("'clip' and 'fullPage' are mutually exclusive");g.clip=rO(tO(g.clip))}else if(g.fullPage){if(!g.captureBeyondViewport){const _=await this.mainFrame().isolatedRealm().evaluate(()=>{const A=document.documentElement;return{width:A.scrollWidth,height:A.scrollHeight}}),v=this.viewport();await this.setViewport({...v,..._}),y.defer(async()=>{await this.setViewport(v).catch(_e)})}}else g.captureBeyondViewport=!1;const w=await this._screenshot(g);if(g.encoding==="base64")return w;const S=FS(w,!0);return await this._maybeWriteTypedArrayToFile(g.path,S),S}catch(m){p.error=m,p.hasError=!0}finally{const m=QI(p);m&&await m}}async title(){return await this.mainFrame().title()}click(f,p){return this.mainFrame().click(f,p)}focus(f){return this.mainFrame().focus(f)}hover(f){return this.mainFrame().hover(f)}select(f,...p){return this.mainFrame().select(f,...p)}tap(f){return this.mainFrame().tap(f)}type(f,p,m){return this.mainFrame().type(f,p,m)}async waitForSelector(f,p={}){return await this.mainFrame().waitForSelector(f,p)}waitForFunction(f,p,...m){return this.mainFrame().waitForFunction(f,p,...m)}[(t=[mK(function(){return this.browser()})],Me)](){return void this.close().catch(_e)}[ms](){return this.close()}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakSet,cU=async function(){const f={stack:[],error:void 0,hasError:!1};try{const p=this.viewport(),m=YS(f,new Xt,!1);return p&&p.deviceScaleFactor!==0&&(await this.setViewport({...p,deviceScaleFactor:0}),m.defer(()=>{this.setViewport(p).catch(_e)})),await this.mainFrame().isolatedRealm().evaluate(()=>[window.visualViewport.width*window.devicePixelRatio,window.visualViewport.height*window.devicePixelRatio,window.devicePixelRatio])}catch(p){f.error=p,f.hasError=!0}finally{QI(f)}},(()=>{const f=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;PK(l,null,t,{kind:"method",name:"screenshot",static:!1,private:!1,access:{has:p=>"screenshot"in p,get:p=>p.screenshot},metadata:f},null,e),f&&Object.defineProperty(l,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f})})(),l})();function tO(n){return{...n,...n.width<0?{x:n.x+n.width,width:-n.width}:{x:n.x,width:n.width},...n.height<0?{y:n.y+n.height,height:-n.height}:{y:n.y,height:n.height}}}function rO(n){const e=Math.round(n.x),t=Math.round(n.y),r=Math.round(n.width+n.x-e),s=Math.round(n.height+n.y-t);return{...n,x:e,y:t,width:r,height:s}}/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class TK{constructor(e,t,r,...s){b(this,ha);b(this,Wd);b(this,Tg);b(this,yo);b(this,Gc);b(this,Ig);b(this,Og);b(this,Zc,Mt.create());b(this,Wn);b(this,Jc);b(this,zd,[]);b(this,Rg,()=>{var e;this.terminate((e=c(this,Jc))==null?void 0:e.reason)});var i;switch(x(this,ha,e),x(this,Wd,t.polling),x(this,Tg,t.root),x(this,Jc,t.signal),(i=c(this,Jc))==null||i.addEventListener("abort",c(this,Rg),{once:!0}),typeof r){case"string":x(this,yo,`() => {return (${r});}`);break;default:x(this,yo,ni(r));break}x(this,Gc,s),c(this,ha).taskManager.add(this),t.timeout&&(x(this,Og,new wb(`Waiting failed: ${t.timeout}ms exceeded`)),x(this,Ig,setTimeout(()=>{this.terminate(c(this,Og))},t.timeout))),this.rerun()}get result(){return c(this,Zc).valueOrThrow()}async rerun(){for(const t of c(this,zd))t.abort();c(this,zd).length=0;const e=new AbortController;c(this,zd).push(e);try{switch(c(this,Wd)){case"raf":x(this,Wn,await c(this,ha).evaluateHandle(({RAFPoller:r,createFunction:s},i,...a)=>{const o=s(i);return new r(()=>o(...a))},Mn.create(r=>r.puppeteerUtil),c(this,yo),...c(this,Gc)));break;case"mutation":x(this,Wn,await c(this,ha).evaluateHandle(({MutationPoller:r,createFunction:s},i,a,...o)=>{const u=s(a);return new r(()=>u(...o),i||document)},Mn.create(r=>r.puppeteerUtil),c(this,Tg),c(this,yo),...c(this,Gc)));break;default:x(this,Wn,await c(this,ha).evaluateHandle(({IntervalPoller:r,createFunction:s},i,a,...o)=>{const u=s(a);return new r(()=>u(...o),i)},Mn.create(r=>r.puppeteerUtil),c(this,Wd),c(this,yo),...c(this,Gc)));break}await c(this,Wn).evaluate(r=>{r.start()});const t=await c(this,Wn).evaluateHandle(r=>r.result());c(this,Zc).resolve(t),await this.terminate()}catch(t){if(e.signal.aborted)return;const r=this.getBadError(t);r&&await this.terminate(r)}}async terminate(e){var t;if(c(this,ha).taskManager.delete(this),(t=c(this,Jc))==null||t.removeEventListener("abort",c(this,Rg)),clearTimeout(c(this,Ig)),e&&!c(this,Zc).finished()&&c(this,Zc).reject(e),c(this,Wn))try{await c(this,Wn).evaluate(async r=>{await r.stop()}),c(this,Wn)&&(await c(this,Wn).dispose(),x(this,Wn,void 0))}catch{}}getBadError(e){return es(e)?e.message.includes("Execution context is not available in detached frame")?new Error("Waiting failed: Frame detached"):e.message.includes("Execution context was destroyed")||e.message.includes("Cannot find context with specified id")||e.message.includes("DiscardedBrowsingContextError")?void 0:e:new Error("WaitTask failed with an error",{cause:e})}}ha=new WeakMap,Wd=new WeakMap,Tg=new WeakMap,yo=new WeakMap,Gc=new WeakMap,Ig=new WeakMap,Og=new WeakMap,Zc=new WeakMap,Wn=new WeakMap,Jc=new WeakMap,zd=new WeakMap,Rg=new WeakMap;class IK{constructor(){b(this,wo,new Set)}add(e){c(this,wo).add(e)}delete(e){c(this,wo).delete(e)}terminateAll(e){for(const t of c(this,wo))t.terminate(e);c(this,wo).clear()}async rerunAll(){await Promise.all([...c(this,wo)].map(e=>e.rerun()))}}wo=new WeakMap;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */let nO=(qB=class{constructor(e){Z(this,"timeoutSettings");Z(this,"taskManager",new IK);b(this,Mg,!1);this.timeoutSettings=e}async waitForFunction(e,t={},...r){const{polling:s="raf",timeout:i=this.timeoutSettings.timeout(),root:a,signal:o}=t;if(typeof s=="number"&&s<0)throw new Error("Cannot poll with non-positive interval");return await new TK(this,{polling:s,root:a,timeout:i,signal:o},e,...r).result}get disposed(){return c(this,Mg)}dispose(){x(this,Mg,!0),this.taskManager.terminateAll(new Error("waitForFunction failed: frame got detached."))}[Me](){this.dispose()}},Mg=new WeakMap,qB);/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Rr;(function(n){n.PAGE="page",n.BACKGROUND_PAGE="background_page",n.SERVICE_WORKER="service_worker",n.SHARED_WORKER="shared_worker",n.BROWSER="browser",n.WEBVIEW="webview",n.OTHER="other",n.TAB="tab"})(Rr||(Rr={}));class Af{constructor(){}async worker(){return null}async page(){return null}}/**
 * @license
 * Copyright 2018 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class sO extends xe{constructor(t){super();Z(this,"timeoutSettings",new XS);b(this,Ng);x(this,Ng,t)}url(){return c(this,Ng)}async evaluate(t,...r){return t=gr(this.evaluate.name,t),await this.mainRealm().evaluate(t,...r)}async evaluateHandle(t,...r){return t=gr(this.evaluateHandle.name,t),await this.mainRealm().evaluateHandle(t,...r)}async close(){throw new Fe("WebWorker.close() is not supported")}}Ng=new WeakMap;/**
 * @license
 * Copyright 2018 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var OK=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},RK=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});class iO{constructor(e,t=""){b(this,bo);b(this,$g);x(this,bo,e),x(this,$g,t)}async snapshot(e={}){const{interestingOnly:t=!0,root:r=null,includeIframes:s=!1}=e,{nodes:i}=await c(this,bo).environment.client.send("Accessibility.getFullAXTree",{frameId:c(this,$g)});let a;if(r){const{node:h}=await c(this,bo).environment.client.send("DOM.describeNode",{objectId:r.id});a=h.backendNodeId}const o=QS.createTree(c(this,bo),i),u=async h=>{var f;if(((f=h.payload.role)==null?void 0:f.value)==="Iframe"){const p={stack:[],error:void 0,hasError:!1};try{if(!h.payload.backendDOMNodeId)return;const m=OK(p,await c(this,bo).adoptBackendNode(h.payload.backendDOMNodeId),!1);if(!m||!("contentFrame"in m))return;const g=await m.contentFrame();if(!g)return;const y=await g.accessibility.snapshot(e);h.iframeSnapshot=y??void 0}catch(m){p.error=m,p.hasError=!0}finally{RK(p)}}for(const p of h.children)await u(p)};let l=o;if(!o||(s&&await u(o),a&&(l=o.find(h=>h.payload.backendDOMNodeId===a)),!l))return null;if(!t)return this.serializeTree(l)[0]??null;const d=new Set;return this.collectInterestingNodes(d,o,!1),d.has(l)?this.serializeTree(l,d)[0]??null:null}serializeTree(e,t){const r=[];for(const i of e.children)r.push(...this.serializeTree(i,t));if(t&&!t.has(e))return r;const s=e.serialize();return r.length&&(s.children=r),e.iframeSnapshot&&(s.children||(s.children=[]),s.children.push(e.iframeSnapshot)),[s]}collectInterestingNodes(e,t,r){if((t.isInteresting(r)||t.iframeSnapshot)&&e.add(t),!t.isLeafNode()){r=r||t.isControl();for(const s of t.children)this.collectInterestingNodes(e,s,r)}}}bo=new WeakMap,$g=new WeakMap;const TA=class TA{constructor(e,t){b(this,fa);Z(this,"payload");Z(this,"children",[]);Z(this,"iframeSnapshot");b(this,Vd,!1);b(this,jg,!1);b(this,Xc,!1);b(this,Lg,!1);b(this,Yc);b(this,zn);b(this,Fg);b(this,Qc);b(this,Dg);this.payload=t,x(this,Yc,this.payload.name?this.payload.name.value:""),x(this,zn,this.payload.role?this.payload.role.value:"Unknown"),x(this,Fg,this.payload.ignored),x(this,Dg,e);for(const r of this.payload.properties||[])r.name==="editable"&&(x(this,Vd,r.value.value==="richtext"),x(this,jg,!0)),r.name==="focusable"&&x(this,Xc,r.value.value),r.name==="hidden"&&x(this,Lg,r.value.value)}find(e){if(e(this))return this;for(const t of this.children){const r=t.find(e);if(r)return r}return null}isLeafNode(){if(!this.children.length||P(this,fa,uU).call(this)||P(this,fa,lU).call(this))return!0;switch(c(this,zn)){case"doc-cover":case"graphics-symbol":case"img":case"image":case"Meter":case"scrollbar":case"slider":case"separator":case"progressbar":return!0}return P(this,fa,YA).call(this)?!1:!!(c(this,Xc)&&c(this,Yc)||c(this,zn)==="heading"&&c(this,Yc))}isControl(){switch(c(this,zn)){case"button":case"checkbox":case"ColorWell":case"combobox":case"DisclosureTriangle":case"listbox":case"menu":case"menubar":case"menuitem":case"menuitemcheckbox":case"menuitemradio":case"radio":case"scrollbar":case"searchbox":case"slider":case"spinbutton":case"switch":case"tab":case"textbox":case"tree":case"treeitem":return!0;default:return!1}}isInteresting(e){return c(this,zn)==="Ignored"||c(this,Lg)||c(this,Fg)?!1:c(this,Xc)||c(this,Vd)||this.isControl()?!0:e?!1:this.isLeafNode()&&!!c(this,Yc)}serialize(){const e=new Map;for(const f of this.payload.properties||[])e.set(f.name.toLowerCase(),f.value.value);this.payload.name&&e.set("name",this.payload.name.value),this.payload.value&&e.set("value",this.payload.value.value),this.payload.description&&e.set("description",this.payload.description.value);const t={role:c(this,zn),elementHandle:async()=>this.payload.backendDOMNodeId?await c(this,Dg).adoptBackendNode(this.payload.backendDOMNodeId):null},r=["name","value","description","keyshortcuts","roledescription","valuetext"],s=f=>e.get(f);for(const f of r)e.has(f)&&(t[f]=s(f));const i=["disabled","expanded","focused","modal","multiline","multiselectable","readonly","required","selected"],a=f=>e.get(f);for(const f of i)f==="focused"&&c(this,zn)==="RootWebArea"||!a(f)||(t[f]=a(f));const o=["checked","pressed"];for(const f of o){if(!e.has(f))continue;const p=e.get(f);t[f]=p==="mixed"?"mixed":p==="true"}const u=["level","valuemax","valuemin"],l=f=>e.get(f);for(const f of u)e.has(f)&&(t[f]=l(f));const d=["autocomplete","haspopup","invalid","orientation"],h=f=>e.get(f);for(const f of d){const p=h(f);!p||p==="false"||(t[f]=h(f))}return t}static createTree(e,t){const r=new Map;for(const s of t)r.set(s.nodeId,new TA(e,s));for(const s of r.values())for(const i of s.payload.childIds||[]){const a=r.get(i);a&&s.children.push(a)}return r.values().next().value??null}};Vd=new WeakMap,jg=new WeakMap,Xc=new WeakMap,Lg=new WeakMap,Yc=new WeakMap,zn=new WeakMap,Fg=new WeakMap,Qc=new WeakMap,Dg=new WeakMap,fa=new WeakSet,uU=function(){return c(this,Vd)?!1:c(this,jg)?!0:c(this,zn)==="textbox"||c(this,zn)==="searchbox"},lU=function(){const e=c(this,zn);return e==="LineBreak"||e==="text"||e==="InlineTextBox"||e==="StaticText"},YA=function(){var e;if(c(this,Qc)===void 0){x(this,Qc,!1);for(const t of this.children)if(c(t,Xc)||P(e=t,fa,YA).call(e)){x(this,Qc,!0);break}}return c(this,Qc)};let QS=TA;var MK=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},NK=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});class Lb{constructor(e,t,r){b(this,pa);b(this,Bg);b(this,Ug);x(this,pa,e),x(this,Bg,t),x(this,Ug,r)}get name(){return c(this,pa)}get initSource(){return c(this,Ug)}async run(e,t,r,s){const i=new Xt;try{if(!s){const a={stack:[],error:void 0,hasError:!1};try{const u=await MK(a,await e.evaluateHandle((l,d)=>globalThis[l].args.get(d),c(this,pa),t),!1).getProperties();for(const[l,d]of u)if(l in r)switch(d.remoteObject().subtype){case"node":r[+l]=d;break;default:i.use(d)}else i.use(d)}catch(o){a.error=o,a.hasError=!0}finally{NK(a)}}await e.evaluate((a,o,u)=>{const l=globalThis[a].callbacks;l.get(o).resolve(u),l.delete(o)},c(this,pa),t,await c(this,Bg).call(this,...r));for(const a of r)a instanceof oc&&i.use(a)}catch(a){es(a)?await e.evaluate((o,u,l,d)=>{const h=new Error(l);h.stack=d;const f=globalThis[o].callbacks;f.get(u).reject(h),f.delete(u)},c(this,pa),t,a.message,a.stack).catch(_e):await e.evaluate((o,u,l)=>{const d=globalThis[o].callbacks;d.get(u).reject(l),d.delete(u)},c(this,pa),t,a).catch(_e)}}}pa=new WeakMap,Bg=new WeakMap,Ug=new WeakMap;/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class ex{constructor(e,t,r,s,i){b(this,qg);b(this,Kg);b(this,Hg);b(this,Gd);b(this,Zd);x(this,qg,e),x(this,Kg,t),x(this,Hg,r),x(this,Gd,s),x(this,Zd,i)}type(){return c(this,qg)}text(){return c(this,Kg)}args(){return c(this,Hg)}location(){return c(this,Gd)[0]??(c(this,Zd)?{url:c(this,Zd).url()}:{})}stackTrace(){return c(this,Gd)}}qg=new WeakMap,Kg=new WeakMap,Hg=new WeakMap,Gd=new WeakMap,Zd=new WeakMap;/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class $K{constructor(e,t){b(this,Jd);b(this,Wg);b(this,eu,!1);x(this,Jd,e),x(this,Wg,t.mode!=="selectSingle")}isMultiple(){return c(this,Wg)}async accept(e){se(!c(this,eu),"Cannot accept FileChooser which is already handled!"),x(this,eu,!0),await c(this,Jd).uploadFile(...e)}async cancel(){se(!c(this,eu),"Cannot cancel FileChooser which is already handled!"),x(this,eu,!0),await c(this,Jd).evaluate(e=>{e.dispatchEvent(new Event("cancel",{bubbles:!0}))})}}Jd=new WeakMap,Wg=new WeakMap,eu=new WeakMap;/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var yr;(function(n){n.Request=Symbol("NetworkManager.Request"),n.RequestServedFromCache=Symbol("NetworkManager.RequestServedFromCache"),n.Response=Symbol("NetworkManager.Response"),n.RequestFailed=Symbol("NetworkManager.RequestFailed"),n.RequestFinished=Symbol("NetworkManager.RequestFinished")})(yr||(yr={}));/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class tx{constructor(){b(this,fs,new Map);b(this,k0,GI())}create(e,t,r){const s=new jK(c(this,k0).call(this),e,t);c(this,fs).set(s.id,s);try{r(s.id)}catch(i){throw s.promise.catch(_e).finally(()=>{c(this,fs).delete(s.id)}),s.reject(i),i}return s.promise.finally(()=>{c(this,fs).delete(s.id)})}reject(e,t,r){const s=c(this,fs).get(e);s&&this._reject(s,t,r)}rejectRaw(e,t){const r=c(this,fs).get(e);r&&r.reject(t)}_reject(e,t,r){let s,i;t instanceof sc?(s=t,s.cause=e.error,i=t.message):(s=e.error,i=t),e.reject($I(s,`Protocol error (${e.label}): ${i}`,r))}resolve(e,t){const r=c(this,fs).get(e);r&&r.resolve(t)}clear(){for(const e of c(this,fs).values())this._reject(e,new gs("Target closed"));c(this,fs).clear()}getPendingProtocolErrors(){const e=[];for(const t of c(this,fs).values())e.push(new Error(`${t.label} timed out. Trace: ${t.error.stack}`));return e}}fs=new WeakMap,k0=new WeakMap;class jK{constructor(e,t,r){b(this,zg);b(this,Vg,new sc);b(this,tu,Mt.create());b(this,Xd);b(this,Gg);x(this,zg,e),x(this,Gg,t),r&&x(this,Xd,setTimeout(()=>{c(this,tu).reject($I(c(this,Vg),`${t} timed out. Increase the 'protocolTimeout' setting in launch/connect calls for a higher timeout if needed.`))},r))}resolve(e){clearTimeout(c(this,Xd)),c(this,tu).resolve(e)}reject(e){clearTimeout(c(this,Xd)),c(this,tu).reject(e)}get id(){return c(this,zg)}get promise(){return c(this,tu).valueOrThrow()}get error(){return c(this,Vg)}get label(){return c(this,Gg)}}zg=new WeakMap,Vg=new WeakMap,tu=new WeakMap,Xd=new WeakMap,Gg=new WeakMap;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class ll extends xf{constructor(t,r,s,i,a){super();b(this,ru);b(this,Yd);b(this,ma,new tx);b(this,Vs);b(this,Qd);b(this,eh);b(this,Zg,!1);x(this,Vs,t),x(this,Yd,r),x(this,ru,s),x(this,Qd,i),x(this,Zg,a)}_setTarget(t){x(this,eh,t)}_target(){return se(c(this,eh),"Target must exist"),c(this,eh)}connection(){return c(this,Vs)}parentSession(){var r;return c(this,Qd)?((r=c(this,Vs))==null?void 0:r.session(c(this,Qd)))??void 0:this}send(t,r,s){return c(this,Vs)?c(this,Vs)._rawSend(c(this,ma),t,r,c(this,ru),s):Promise.reject(new gs(`Protocol error (${t}): Session closed. Most likely the ${c(this,Yd)} has been closed.`))}_onMessage(t){t.id?t.error?c(this,Zg)?c(this,ma).rejectRaw(t.id,t.error):c(this,ma).reject(t.id,jI(t),t.error.message):c(this,ma).resolve(t.id,t.result):(se(!t.id),this.emit(t.method,t.params))}async detach(){if(!c(this,Vs))throw new Error(`Session already detached. Most likely the ${c(this,Yd)} has been closed.`);await c(this,Vs).send("Target.detachFromTarget",{sessionId:c(this,ru)})}_onClosed(){c(this,ma).clear(),x(this,Vs,void 0),this.emit(jt.Disconnected,void 0)}id(){return c(this,ru)}getPendingProtocolErrors(){return c(this,ma).getPendingProtocolErrors()}}ru=new WeakMap,Yd=new WeakMap,ma=new WeakMap,Vs=new WeakMap,Qd=new WeakMap,eh=new WeakMap,Zg=new WeakMap;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const LK=nl("puppeteer:protocol:SEND "),FK=nl("puppeteer:protocol:RECV ");class aO extends xe{constructor(t,r,s=0,i,a=!1){super();b(this,Xg);b(this,Jg);b(this,Ci);b(this,nu);b(this,th);b(this,on,new Map);b(this,su,!1);b(this,rh,new Set);b(this,Pi);b(this,nh,!1);x(this,nh,a),x(this,Pi,new tx),x(this,Jg,t),x(this,nu,s),x(this,th,i??18e4),x(this,Ci,r),c(this,Ci).onmessage=this.onMessage.bind(this),c(this,Ci).onclose=P(this,Xg,QA).bind(this)}static fromSession(t){return t.connection()}get delay(){return c(this,nu)}get timeout(){return c(this,th)}get _closed(){return c(this,su)}get _sessions(){return c(this,on)}session(t){return c(this,on).get(t)||null}url(){return c(this,Jg)}send(t,r,s){return this._rawSend(c(this,Pi),t,r,void 0,s)}_rawSend(t,r,s,i,a){return c(this,su)?Promise.reject(new Error("Protocol error: Connection closed.")):t.create(r,(a==null?void 0:a.timeout)??c(this,th),o=>{const u=JSON.stringify({method:r,params:s,id:o,sessionId:i});LK(u),c(this,Ci).send(u)})}async closeBrowser(){await this.send("Browser.close")}async onMessage(t){c(this,nu)&&await new Promise(s=>setTimeout(s,c(this,nu))),FK(t);const r=JSON.parse(t);if(r.method==="Target.attachedToTarget"){const s=r.params.sessionId,i=new ll(this,r.params.targetInfo.type,s,r.sessionId,c(this,nh));c(this,on).set(s,i),this.emit(jt.SessionAttached,i);const a=c(this,on).get(r.sessionId);a&&a.emit(jt.SessionAttached,i)}else if(r.method==="Target.detachedFromTarget"){const s=c(this,on).get(r.params.sessionId);if(s){s._onClosed(),c(this,on).delete(r.params.sessionId),this.emit(jt.SessionDetached,s);const i=c(this,on).get(r.sessionId);i&&i.emit(jt.SessionDetached,s)}}if(r.sessionId){const s=c(this,on).get(r.sessionId);s&&s._onMessage(r)}else r.id?r.error?c(this,nh)?c(this,Pi).rejectRaw(r.id,r.error):c(this,Pi).reject(r.id,jI(r),r.error.message):c(this,Pi).resolve(r.id,r.result):this.emit(r.method,r.params)}dispose(){P(this,Xg,QA).call(this),c(this,Ci).close()}isAutoAttached(t){return!c(this,rh).has(t)}async _createSession(t,r=!0){r||c(this,rh).add(t.targetId);const{sessionId:s}=await this.send("Target.attachToTarget",{targetId:t.targetId,flatten:!0});c(this,rh).delete(t.targetId);const i=c(this,on).get(s);if(!i)throw new Error("CDPSession creation failed.");return i}async createSession(t){return await this._createSession(t,!1)}getPendingProtocolErrors(){const t=[];t.push(...c(this,Pi).getPendingProtocolErrors());for(const r of c(this,on).values())t.push(...r.getPendingProtocolErrors());return t}}Jg=new WeakMap,Ci=new WeakMap,nu=new WeakMap,th=new WeakMap,on=new WeakMap,su=new WeakMap,rh=new WeakMap,Pi=new WeakMap,nh=new WeakMap,Xg=new WeakSet,QA=function(){if(!c(this,su)){x(this,su,!0),c(this,Ci).onmessage=void 0,c(this,Ci).onclose=void 0,c(this,Pi).clear();for(const t of c(this,on).values())t._onClosed();c(this,on).clear(),this.emit(jt.Disconnected,void 0)}};function rx(n){return n instanceof gs}/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class oO{constructor(e){b(this,iu);b(this,au);x(this,iu,new DK(e)),x(this,au,new BK(e))}updateClient(e){c(this,iu).updateClient(e),c(this,au).updateClient(e)}async startJSCoverage(e={}){return await c(this,iu).start(e)}async stopJSCoverage(){return await c(this,iu).stop()}async startCSSCoverage(e={}){return await c(this,au).start(e)}async stopCSSCoverage(){return await c(this,au).stop()}}iu=new WeakMap,au=new WeakMap;class DK{constructor(e){b(this,oh);b(this,cn);b(this,ou,!1);b(this,cu,new Map);b(this,uu,new Map);b(this,sh);b(this,Yg,!1);b(this,ih,!1);b(this,ah,!1);x(this,cn,e)}updateClient(e){x(this,cn,e)}async start(e={}){se(!c(this,ou),"JSCoverage is already enabled");const{resetOnNavigation:t=!0,reportAnonymousScripts:r=!1,includeRawScriptCoverage:s=!1,useBlockCoverage:i=!0}=e;x(this,Yg,t),x(this,ih,r),x(this,ah,s),x(this,ou,!0),c(this,cu).clear(),c(this,uu).clear(),x(this,sh,new Xt);const a=c(this,sh).use(new xe(c(this,cn)));a.on("Debugger.scriptParsed",P(this,oh,hU).bind(this)),a.on("Runtime.executionContextsCleared",P(this,oh,dU).bind(this)),await Promise.all([c(this,cn).send("Profiler.enable"),c(this,cn).send("Profiler.startPreciseCoverage",{callCount:c(this,ah),detailed:i}),c(this,cn).send("Debugger.enable"),c(this,cn).send("Debugger.setSkipAllPauses",{skip:!0})])}async stop(){var s;se(c(this,ou),"JSCoverage is not enabled"),x(this,ou,!1);const e=await Promise.all([c(this,cn).send("Profiler.takePreciseCoverage"),c(this,cn).send("Profiler.stopPreciseCoverage"),c(this,cn).send("Profiler.disable"),c(this,cn).send("Debugger.disable")]);(s=c(this,sh))==null||s.dispose();const t=[],r=e[0];for(const i of r.result){let a=c(this,cu).get(i.scriptId);!a&&c(this,ih)&&(a="debugger://VM"+i.scriptId);const o=c(this,uu).get(i.scriptId);if(o===void 0||a===void 0)continue;const u=[];for(const d of i.functions)u.push(...d.ranges);const l=cO(u);c(this,ah)?t.push({url:a,ranges:l,text:o,rawScriptCoverage:i}):t.push({url:a,ranges:l,text:o})}return t}}cn=new WeakMap,ou=new WeakMap,cu=new WeakMap,uu=new WeakMap,sh=new WeakMap,Yg=new WeakMap,ih=new WeakMap,ah=new WeakMap,oh=new WeakSet,dU=function(){c(this,Yg)&&(c(this,cu).clear(),c(this,uu).clear())},hU=async function(e){if(!Rn.isPuppeteerURL(e.url)&&!(!e.url&&!c(this,ih)))try{const t=await c(this,cn).send("Debugger.getScriptSource",{scriptId:e.scriptId});c(this,cu).set(e.scriptId,e.url),c(this,uu).set(e.scriptId,t.scriptSource)}catch(t){_e(t)}};class BK{constructor(e){b(this,uh);b(this,Vn);b(this,lu,!1);b(this,_o,new Map);b(this,du,new Map);b(this,ch);b(this,Qg,!1);x(this,Vn,e)}updateClient(e){x(this,Vn,e)}async start(e={}){se(!c(this,lu),"CSSCoverage is already enabled");const{resetOnNavigation:t=!0}=e;x(this,Qg,t),x(this,lu,!0),c(this,_o).clear(),c(this,du).clear(),x(this,ch,new Xt);const r=c(this,ch).use(new xe(c(this,Vn)));r.on("CSS.styleSheetAdded",P(this,uh,pU).bind(this)),r.on("Runtime.executionContextsCleared",P(this,uh,fU).bind(this)),await Promise.all([c(this,Vn).send("DOM.enable"),c(this,Vn).send("CSS.enable"),c(this,Vn).send("CSS.startRuleUsageTracking")])}async stop(){var s;se(c(this,lu),"CSSCoverage is not enabled"),x(this,lu,!1);const e=await c(this,Vn).send("CSS.stopRuleUsageTracking");await Promise.all([c(this,Vn).send("CSS.disable"),c(this,Vn).send("DOM.disable")]),(s=c(this,ch))==null||s.dispose();const t=new Map;for(const i of e.ruleUsage){let a=t.get(i.styleSheetId);a||(a=[],t.set(i.styleSheetId,a)),a.push({startOffset:i.startOffset,endOffset:i.endOffset,count:i.used?1:0})}const r=[];for(const i of c(this,_o).keys()){const a=c(this,_o).get(i);se(typeof a<"u",`Stylesheet URL is undefined (styleSheetId=${i})`);const o=c(this,du).get(i);se(typeof o<"u",`Stylesheet text is undefined (styleSheetId=${i})`);const u=cO(t.get(i)||[]);r.push({url:a,ranges:u,text:o})}return r}}Vn=new WeakMap,lu=new WeakMap,_o=new WeakMap,du=new WeakMap,ch=new WeakMap,Qg=new WeakMap,uh=new WeakSet,fU=function(){c(this,Qg)&&(c(this,_o).clear(),c(this,du).clear())},pU=async function(e){const t=e.header;if(t.sourceURL)try{const r=await c(this,Vn).send("CSS.getStyleSheetText",{styleSheetId:t.styleSheetId});c(this,_o).set(t.styleSheetId,t.sourceURL),c(this,du).set(t.styleSheetId,r.text)}catch(r){_e(r)}};function cO(n){const e=[];for(const i of n)e.push({offset:i.startOffset,type:0,range:i}),e.push({offset:i.endOffset,type:1,range:i});e.sort((i,a)=>{if(i.offset!==a.offset)return i.offset-a.offset;if(i.type!==a.type)return a.type-i.type;const o=i.range.endOffset-i.range.startOffset,u=a.range.endOffset-a.range.startOffset;return i.type===0?u-o:o-u});const t=[],r=[];let s=0;for(const i of e){if(t.length&&s<i.offset&&t[t.length-1]>0){const a=r[r.length-1];a&&a.end===s?a.end=i.offset:r.push({start:s,end:i.offset})}s=i.offset,i.type===0?t.push(i.range.count):t.pop()}return r.filter(i=>i.end-i.start>0)}/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class UK extends NI{constructor(t,r,s,i=""){super(r,s,i);b(this,ey);x(this,ey,t)}async handle(t){await c(this,ey).send("Page.handleJavaScriptDialog",{accept:t.accept,promptText:t.text})}}ey=new WeakMap;var qK=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},ai=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},oi=function(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})};class ci{constructor(e,t,r){b(this,hu);b(this,lh);b(this,ty);x(this,hu,e),x(this,lh,t),x(this,ty,r),c(this,lh).registerState(this)}async setState(e){x(this,hu,e),await this.sync()}get state(){return c(this,hu)}async sync(){await Promise.all(c(this,lh).clients().map(e=>c(this,ty).call(this,e,c(this,hu))))}}hu=new WeakMap,lh=new WeakMap,ty=new WeakMap;let uO=(()=>{var A,k,C,E,N,I,$,O,T,L,U,J,F,j,B,D,eT,tT,rT,nT,sT,iT,aT,oT,cT,uT,R;let n=[],e,t,r,s,i,a,o,u,l,d,h,f,p,m,g,y,w,S,_,v;return R=class{constructor(q){b(this,D);b(this,A,qK(this,n));b(this,k,!1);b(this,C,!1);b(this,E,[]);b(this,N,new ci({active:!1},this,c(this,D,eT)));b(this,I,new ci({active:!1},this,c(this,D,tT)));b(this,$,new ci({active:!1},this,c(this,D,rT)));b(this,O,new ci({active:!1},this,c(this,D,nT)));b(this,T,new ci({active:!1},this,c(this,D,sT)));b(this,L,new ci({active:!1},this,c(this,D,iT)));b(this,U,new ci({active:!1},this,c(this,D,aT)));b(this,J,new ci({active:!1},this,c(this,D,oT)));b(this,F,new ci({active:!1},this,c(this,D,cT)));b(this,j,new ci({javaScriptEnabled:!0,active:!1},this,c(this,D,uT)));b(this,B,new Set);x(this,A,q)}updateClient(q){x(this,A,q),c(this,B).delete(q)}registerState(q){c(this,E).push(q)}clients(){return[c(this,A),...Array.from(c(this,B))]}async registerSpeculativeSession(q){c(this,B).add(q),q.once(jt.Disconnected,()=>{c(this,B).delete(q)}),Promise.all(c(this,E).map(W=>W.sync().catch(_e)))}get javascriptEnabled(){return c(this,j).state.javaScriptEnabled}async emulateViewport(q){const W=c(this,N).state;if(!q&&!W.active)return!1;await c(this,N).setState(q?{viewport:q,active:!0}:{active:!1});const X=(q==null?void 0:q.isMobile)||!1,re=(q==null?void 0:q.hasTouch)||!1,ce=c(this,k)!==X||c(this,C)!==re;return x(this,k,X),x(this,C,re),ce}async emulateIdleState(q){await c(this,I).setState({active:!0,overrides:q})}async emulateTimezone(q){await c(this,$).setState({timezoneId:q,active:!0})}async emulateVisionDeficiency(q){se(!q||new Set(["none","achromatopsia","blurredVision","deuteranopia","protanopia","reducedContrast","tritanopia"]).has(q),`Unsupported vision deficiency: ${q}`),await c(this,O).setState({active:!0,visionDeficiency:q})}async emulateCPUThrottling(q){se(q===null||q>=1,"Throttling rate should be greater or equal to 1"),await c(this,T).setState({active:!0,factor:q??void 0})}async emulateMediaFeatures(q){if(Array.isArray(q))for(const W of q){const X=W.name;se(/^(?:prefers-(?:color-scheme|reduced-motion)|color-gamut)$/.test(X),"Unsupported media feature: "+X)}await c(this,L).setState({active:!0,mediaFeatures:q})}async emulateMediaType(q){se(q==="screen"||q==="print"||(q??void 0)===void 0,"Unsupported media type: "+q),await c(this,U).setState({type:q,active:!0})}async setGeolocation(q){const{longitude:W,latitude:X,accuracy:re=0}=q;if(W<-180||W>180)throw new Error(`Invalid longitude "${W}": precondition -180 <= LONGITUDE <= 180 failed.`);if(X<-90||X>90)throw new Error(`Invalid latitude "${X}": precondition -90 <= LATITUDE <= 90 failed.`);if(re<0)throw new Error(`Invalid accuracy "${re}": precondition 0 <= ACCURACY failed.`);await c(this,J).setState({active:!0,geoLocation:{longitude:W,latitude:X,accuracy:re}})}async resetDefaultBackgroundColor(){await c(this,F).setState({active:!0,color:void 0})}async setTransparentBackgroundColor(){await c(this,F).setState({active:!0,color:{r:0,g:0,b:0,a:0}})}async setJavaScriptEnabled(q){await c(this,j).setState({active:!0,javaScriptEnabled:q})}},A=new WeakMap,k=new WeakMap,C=new WeakMap,E=new WeakMap,N=new WeakMap,I=new WeakMap,$=new WeakMap,O=new WeakMap,T=new WeakMap,L=new WeakMap,U=new WeakMap,J=new WeakMap,F=new WeakMap,j=new WeakMap,B=new WeakMap,D=new WeakSet,eT=function(){return t.value},tT=function(){return s.value},rT=function(){return a.value},nT=function(){return u.value},sT=function(){return d.value},iT=function(){return f.value},aT=function(){return m.value},oT=function(){return y.value},cT=function(){return S.value},uT=function(){return v.value},(()=>{const q=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;e=[ys],r=[ys],i=[ys],o=[ys],l=[ys],h=[ys],p=[ys],g=[ys],w=[ys],_=[ys],ai(R,t={value:oi(async function(W,X){if(!X.viewport){await Promise.all([W.send("Emulation.clearDeviceMetricsOverride"),W.send("Emulation.setTouchEmulationEnabled",{enabled:!1})]).catch(_e);return}const{viewport:re}=X,ce=re.isMobile||!1,Re=re.width,le=re.height,Ne=re.deviceScaleFactor??1,Se=re.isLandscape?{angle:90,type:"landscapePrimary"}:{angle:0,type:"portraitPrimary"},H=re.hasTouch||!1;await Promise.all([W.send("Emulation.setDeviceMetricsOverride",{mobile:ce,width:Re,height:le,deviceScaleFactor:Ne,screenOrientation:Se}).catch(ee=>{if(ee.message.includes("Target does not support metrics override")){_e(ee);return}throw ee}),W.send("Emulation.setTouchEmulationEnabled",{enabled:H})])},"#applyViewport")},e,{kind:"method",name:"#applyViewport",static:!1,private:!0,access:{has:W=>dn(D,W),get:W=>c(W,D,eT)},metadata:q},null,n),ai(R,s={value:oi(async function(W,X){X.active&&(X.overrides?await W.send("Emulation.setIdleOverride",{isUserActive:X.overrides.isUserActive,isScreenUnlocked:X.overrides.isScreenUnlocked}):await W.send("Emulation.clearIdleOverride"))},"#emulateIdleState")},r,{kind:"method",name:"#emulateIdleState",static:!1,private:!0,access:{has:W=>dn(D,W),get:W=>c(W,D,tT)},metadata:q},null,n),ai(R,a={value:oi(async function(W,X){if(X.active)try{await W.send("Emulation.setTimezoneOverride",{timezoneId:X.timezoneId||""})}catch(re){throw es(re)&&re.message.includes("Invalid timezone")?new Error(`Invalid timezone ID: ${X.timezoneId}`):re}},"#emulateTimezone")},i,{kind:"method",name:"#emulateTimezone",static:!1,private:!0,access:{has:W=>dn(D,W),get:W=>c(W,D,rT)},metadata:q},null,n),ai(R,u={value:oi(async function(W,X){X.active&&await W.send("Emulation.setEmulatedVisionDeficiency",{type:X.visionDeficiency||"none"})},"#emulateVisionDeficiency")},o,{kind:"method",name:"#emulateVisionDeficiency",static:!1,private:!0,access:{has:W=>dn(D,W),get:W=>c(W,D,nT)},metadata:q},null,n),ai(R,d={value:oi(async function(W,X){X.active&&await W.send("Emulation.setCPUThrottlingRate",{rate:X.factor??1})},"#emulateCpuThrottling")},l,{kind:"method",name:"#emulateCpuThrottling",static:!1,private:!0,access:{has:W=>dn(D,W),get:W=>c(W,D,sT)},metadata:q},null,n),ai(R,f={value:oi(async function(W,X){X.active&&await W.send("Emulation.setEmulatedMedia",{features:X.mediaFeatures})},"#emulateMediaFeatures")},h,{kind:"method",name:"#emulateMediaFeatures",static:!1,private:!0,access:{has:W=>dn(D,W),get:W=>c(W,D,iT)},metadata:q},null,n),ai(R,m={value:oi(async function(W,X){X.active&&await W.send("Emulation.setEmulatedMedia",{media:X.type||""})},"#emulateMediaType")},p,{kind:"method",name:"#emulateMediaType",static:!1,private:!0,access:{has:W=>dn(D,W),get:W=>c(W,D,aT)},metadata:q},null,n),ai(R,y={value:oi(async function(W,X){X.active&&await W.send("Emulation.setGeolocationOverride",X.geoLocation?{longitude:X.geoLocation.longitude,latitude:X.geoLocation.latitude,accuracy:X.geoLocation.accuracy}:void 0)},"#setGeolocation")},g,{kind:"method",name:"#setGeolocation",static:!1,private:!0,access:{has:W=>dn(D,W),get:W=>c(W,D,oT)},metadata:q},null,n),ai(R,S={value:oi(async function(W,X){X.active&&await W.send("Emulation.setDefaultBackgroundColorOverride",{color:X.color})},"#setDefaultBackgroundColor")},w,{kind:"method",name:"#setDefaultBackgroundColor",static:!1,private:!0,access:{has:W=>dn(D,W),get:W=>c(W,D,cT)},metadata:q},null,n),ai(R,v={value:oi(async function(W,X){X.active&&await W.send("Emulation.setScriptExecutionDisabled",{value:!X.javaScriptEnabled})},"#setJavaScriptEnabled")},_,{kind:"method",name:"#setJavaScriptEnabled",static:!1,private:!0,access:{has:W=>dn(D,W),get:W=>c(W,D,uT)},metadata:q},null,n),q&&Object.defineProperty(R,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:q})})(),R})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class KK{constructor(e,t,r){b(this,ry);b(this,ny);b(this,dh,new WeakMap);x(this,ry,t),x(this,ny,r),c(this,dh).set(e,t)}get id(){return c(this,ry)}get source(){return c(this,ny)}getIdForFrame(e){return c(this,dh).get(e)}setIdForFrame(e,t){c(this,dh).set(e,t)}}ry=new WeakMap,ny=new WeakMap,dh=new WeakMap;/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class HK{constructor(e,t){Z(this,"id");Z(this,"name");this.id=e,this.name=t}}class WK{constructor(e,t,r){b(this,iy);b(this,Gn);b(this,sy);b(this,fu);b(this,pu,!1);b(this,hh,P(this,iy,lT).bind(this));b(this,fh,new Set);Z(this,"devices",[]);x(this,Gn,e),x(this,sy,t),x(this,fu,r.id),c(this,Gn).on("DeviceAccess.deviceRequestPrompted",c(this,hh)),c(this,Gn).on("Target.detachedFromTarget",()=>{x(this,Gn,null)}),P(this,iy,lT).call(this,r)}async waitForDevice(e,t={}){for(const a of this.devices)if(e(a))return a;const{timeout:r=c(this,sy).timeout()}=t,s=Mt.create({message:`Waiting for \`DeviceRequestPromptDevice\` failed: ${r}ms exceeded`,timeout:r});t.signal&&t.signal.addEventListener("abort",()=>{var a;s.reject((a=t.signal)==null?void 0:a.reason)},{once:!0});const i={filter:e,promise:s};c(this,fh).add(i);try{return await s.valueOrThrow()}finally{c(this,fh).delete(i)}}async select(e){return se(c(this,Gn)!==null,"Cannot select device through detached session!"),se(this.devices.includes(e),"Cannot select unknown device!"),se(!c(this,pu),"Cannot select DeviceRequestPrompt which is already handled!"),c(this,Gn).off("DeviceAccess.deviceRequestPrompted",c(this,hh)),x(this,pu,!0),await c(this,Gn).send("DeviceAccess.selectPrompt",{id:c(this,fu),deviceId:e.id})}async cancel(){return se(c(this,Gn)!==null,"Cannot cancel prompt through detached session!"),se(!c(this,pu),"Cannot cancel DeviceRequestPrompt which is already handled!"),c(this,Gn).off("DeviceAccess.deviceRequestPrompted",c(this,hh)),x(this,pu,!0),await c(this,Gn).send("DeviceAccess.cancelPrompt",{id:c(this,fu)})}}Gn=new WeakMap,sy=new WeakMap,fu=new WeakMap,pu=new WeakMap,hh=new WeakMap,fh=new WeakMap,iy=new WeakSet,lT=function(e){if(e.id===c(this,fu))for(const t of e.devices){if(this.devices.some(s=>s.id===t.id))continue;const r=new HK(t.id,t.name);this.devices.push(r);for(const s of c(this,fh))s.filter(r)&&s.promise.resolve(r)}};class zK{constructor(e,t){b(this,C0);b(this,Gs);b(this,ph);b(this,ga,new Set);x(this,Gs,e),x(this,ph,t),c(this,Gs).on("DeviceAccess.deviceRequestPrompted",r=>{P(this,C0,mU).call(this,r)}),c(this,Gs).on("Target.detachedFromTarget",()=>{x(this,Gs,null)})}async waitForDevicePrompt(e={}){se(c(this,Gs)!==null,"Cannot wait for device prompt through detached session!");const t=c(this,ga).size===0;let r;t&&(r=c(this,Gs).send("DeviceAccess.enable"));const{timeout:s=c(this,ph).timeout()}=e,i=Mt.create({message:`Waiting for \`DeviceRequestPrompt\` failed: ${s}ms exceeded`,timeout:s});e.signal&&e.signal.addEventListener("abort",()=>{var a;i.reject((a=e.signal)==null?void 0:a.reason)},{once:!0}),c(this,ga).add(i);try{const[a]=await Promise.all([i.valueOrThrow(),r]);return a}finally{c(this,ga).delete(i)}}}Gs=new WeakMap,ph=new WeakMap,ga=new WeakMap,C0=new WeakSet,mU=function(e){if(!c(this,ga).size)return;se(c(this,Gs)!==null);const t=new WK(c(this,Gs),c(this,ph),e);for(const r of c(this,ga))r.resolve(t);c(this,ga).clear()};/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */function lO(n){let e,t;if(!n.exception)e="Error",t=n.text;else{if((n.exception.type!=="object"||n.exception.subtype!=="error")&&!n.exception.objectId)return cc(n.exception);{const o=dO(n);e=o.name,t=o.message}}const r=t.split(`
`).length,s=new Error(t);s.name=e;const i=s.stack.split(`
`),a=i.splice(0,r);if(i.shift(),n.stackTrace&&i.length<Error.stackTraceLimit)for(const o of n.stackTrace.callFrames.reverse()){if(Rn.isPuppeteerURL(o.url)&&o.url!==Rn.INTERNAL_URL){const u=Rn.parse(o.url);i.unshift(`    at ${o.functionName||u.functionName} (${u.functionName} at ${u.siteString}, <anonymous>:${o.lineNumber}:${o.columnNumber})`)}else i.push(`    at ${o.functionName||"<anonymous>"} (${o.url}:${o.lineNumber}:${o.columnNumber})`);if(i.length>=Error.stackTraceLimit)break}return s.stack=[...a,...i].join(`
`),s}const dO=n=>{var i,a,o,u;let e="",t;const r=((a=(i=n.exception)==null?void 0:i.description)==null?void 0:a.split(`
    at `))??[],s=Math.min(((o=n.stackTrace)==null?void 0:o.callFrames.length)??0,r.length-1);return r.splice(-s,s),(u=n.exception)!=null&&u.className&&(e=n.exception.className),t=r.join(`
`),e&&t.startsWith(`${e}: `)&&(t=t.slice(e.length+2)),{message:t,name:e}};function VK(n){let e,t;if(!n.exception)e="Error",t=n.text;else{if((n.exception.type!=="object"||n.exception.subtype!=="error")&&!n.exception.objectId)return cc(n.exception);{const o=dO(n);e=o.name,t=o.message}}const r=new Error(t);r.name=e;const s=r.message.split(`
`).length,i=r.stack.split(`
`).splice(0,s),a=[];if(n.stackTrace){for(const o of n.stackTrace.callFrames)if(a.push(`    at ${o.functionName||"<anonymous>"} (${o.url}:${o.lineNumber+1}:${o.columnNumber+1})`),a.length>=Error.stackTraceLimit)break}return r.stack=[...i,...a].join(`
`),r}function cc(n){if(se(!n.objectId,"Cannot extract value when objectId is given"),n.unserializableValue){if(n.type==="bigint")return BigInt(n.unserializableValue.replace("n",""));switch(n.unserializableValue){case"-0":return-0;case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:throw new Error("Unsupported unserializable value: "+n.unserializableValue)}}return n.value}function hO(n,e,t){globalThis[e]||Object.assign(globalThis,{[e](...r){const s=globalThis[e];s.args??(s.args=new Map),s.callbacks??(s.callbacks=new Map);const i=(s.lastSeq??0)+1;return s.lastSeq=i,s.args.set(i,r),globalThis[t+e](JSON.stringify({type:n,name:e,seq:i,args:r,isTrivial:!r.some(a=>a instanceof Node)})),new Promise((a,o)=>{s.callbacks.set(i,{resolve(u){s.args.delete(i),a(u)},reject(u){s.args.delete(i),o(u)}})})}})}const dl="puppeteer_";function GK(n,e){return BS(hO,n,e,dl)}/**
 * @license
 * Copyright 2019 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class Fb extends oc{constructor(t,r){super();b(this,mh,!1);b(this,An);b(this,gh);x(this,gh,t),x(this,An,r)}get disposed(){return c(this,mh)}get realm(){return c(this,gh)}get client(){return this.realm.environment.client}async jsonValue(){if(!c(this,An).objectId)return cc(c(this,An));const t=await this.evaluate(r=>r);if(t===void 0)throw new Error("Could not serialize referenced object");return t}asElement(){return null}async dispose(){c(this,mh)||(x(this,mh,!0),await fO(this.client,c(this,An)))}toString(){return c(this,An).objectId?"JSHandle@"+(c(this,An).subtype||c(this,An).type):"JSHandle:"+cc(c(this,An))}get id(){return c(this,An).objectId}remoteObject(){return c(this,An)}async getProperties(){const t=await this.client.send("Runtime.getProperties",{objectId:c(this,An).objectId,ownProperties:!0}),r=new Map;for(const s of t.result)!s.enumerable||!s.value||r.set(s.name,c(this,gh).createCdpHandle(s.value));return r}}mh=new WeakMap,An=new WeakMap,gh=new WeakMap;async function fO(n,e){e.objectId&&await n.send("Runtime.releaseObject",{objectId:e.objectId}).catch(t=>{_e(t)})}/**
 * @license
 * Copyright 2019 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var ZK=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Db=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};const JK=new Set(["StaticText","InlineTextBox"]);let pO=(()=>{var a,o,gU,l;let n=qI,e=[],t,r,s,i;return l=class extends n{constructor(f,p){super(new Fb(f,p));b(this,o);b(this,a,ZK(this,e))}get realm(){return this.handle.realm}get client(){return this.handle.client}remoteObject(){return this.handle.remoteObject()}get frame(){return this.realm.environment}async contentFrame(){const f=await this.client.send("DOM.describeNode",{objectId:this.id});return typeof f.node.frameId!="string"?null:c(this,o,gU).frame(f.node.frameId)}async scrollIntoView(){await this.assertConnectedElement();try{await this.client.send("DOM.scrollIntoViewIfNeeded",{objectId:this.id})}catch(f){_e(f),await super.scrollIntoView()}}async uploadFile(...f){const p=await this.evaluate(y=>y.multiple);se(f.length<=1||p,"Multiple file uploads only work with <input type=file multiple>");const m=Fa.value.path;if(m&&(f=f.map(y=>m.win32.isAbsolute(y)||m.posix.isAbsolute(y)?y:m.resolve(y))),f.length===0){await this.evaluate(y=>{y.files=new DataTransfer().files,y.dispatchEvent(new Event("input",{bubbles:!0,composed:!0})),y.dispatchEvent(new Event("change",{bubbles:!0}))});return}const{node:{backendNodeId:g}}=await this.client.send("DOM.describeNode",{objectId:this.id});await this.client.send("DOM.setFileInputFiles",{objectId:this.id,files:f,backendNodeId:g})}async autofill(f){const m=(await this.client.send("DOM.describeNode",{objectId:this.handle.id})).node.backendNodeId,g=this.frame._id;await this.client.send("Autofill.trigger",{fieldId:m,frameId:g,card:f.creditCard})}async*queryAXTree(f,p){const{nodes:m}=await this.client.send("Accessibility.queryAXTree",{objectId:this.id,accessibleName:f,role:p}),g=m.filter(y=>!(y.ignored||!y.role||JK.has(y.role.value)));return yield*al.map(g,y=>this.realm.adoptBackendNode(y.backendDOMNodeId))}async backendNodeId(){if(c(this,a))return c(this,a);const{node:f}=await this.client.send("DOM.describeNode",{objectId:this.handle.id});return x(this,a,f.backendNodeId),c(this,a)}},a=new WeakMap,o=new WeakSet,gU=function(){return this.frame._frameManager},(()=>{const f=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[ue()],r=[ue(),ct],s=[ue(),ct],i=[ue()],Db(l,null,t,{kind:"method",name:"contentFrame",static:!1,private:!1,access:{has:p=>"contentFrame"in p,get:p=>p.contentFrame},metadata:f},null,e),Db(l,null,r,{kind:"method",name:"scrollIntoView",static:!1,private:!1,access:{has:p=>"scrollIntoView"in p,get:p=>p.scrollIntoView},metadata:f},null,e),Db(l,null,s,{kind:"method",name:"uploadFile",static:!1,private:!1,access:{has:p=>"uploadFile"in p,get:p=>p.uploadFile},metadata:f},null,e),Db(l,null,i,{kind:"method",name:"autofill",static:!1,private:!1,access:{has:p=>"autofill"in p,get:p=>p.autofill},metadata:f},null,e),f&&Object.defineProperty(l,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f})})(),l})();/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var XK=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},YK=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});const QK=new Lb("__ariaQuerySelector",ac.queryOne,""),eH=new Lb("__ariaQuerySelectorAll",async(n,e)=>{const t=ac.queryAll(n,e);return await n.realm.evaluateHandle((...r)=>r,...await al.collect(t))},"");class mO extends xe{constructor(t,r,s){super();b(this,Tn);b(this,vo);b(this,mu);b(this,Zs);b(this,yh);b(this,ay,new Xt);b(this,gu,new Map);b(this,P0,new KS);b(this,oy,!1);b(this,So);x(this,vo,t),x(this,mu,s),x(this,Zs,r.id),r.name&&x(this,yh,r.name);const i=c(this,ay).use(new xe(c(this,vo)));i.on("Runtime.bindingCalled",P(this,Tn,wU).bind(this)),i.on("Runtime.executionContextDestroyed",async a=>{a.executionContextId===c(this,Zs)&&this[Me]()}),i.on("Runtime.executionContextsCleared",async()=>{this[Me]()}),i.on("Runtime.consoleAPICalled",P(this,Tn,bU).bind(this)),i.on(jt.Disconnected,()=>{this[Me]()})}get id(){return c(this,Zs)}get puppeteerUtil(){let t=Promise.resolve();return c(this,oy)||(t=Promise.all([P(this,Tn,dT).call(this,QK),P(this,Tn,dT).call(this,eH)]),x(this,oy,!0)),Ef.inject(r=>{c(this,So)&&c(this,So).then(s=>{s.dispose()}),x(this,So,t.then(()=>this.evaluateHandle(r)))},!c(this,So)),c(this,So)}async evaluate(t,...r){return await P(this,Tn,hT).call(this,!0,t,...r)}async evaluateHandle(t,...r){return await P(this,Tn,hT).call(this,!1,t,...r)}[Me](){c(this,ay).dispose(),this.emit("disposed",void 0)}}vo=new WeakMap,mu=new WeakMap,Zs=new WeakMap,yh=new WeakMap,ay=new WeakMap,gu=new WeakMap,P0=new WeakMap,Tn=new WeakSet,yU=async function(t){const r={stack:[],error:void 0,hasError:!1};try{if(c(this,gu).has(t.name))return;const s=XK(r,await c(this,P0).acquire(),!1);try{await c(this,vo).send("Runtime.addBinding",c(this,yh)?{name:dl+t.name,executionContextName:c(this,yh)}:{name:dl+t.name,executionContextId:c(this,Zs)}),await this.evaluate(hO,"internal",t.name,dl),c(this,gu).set(t.name,t)}catch(i){if(i instanceof Error&&(i.message.includes("Execution context was destroyed")||i.message.includes("Cannot find context with specified id")))return;_e(i)}}catch(s){r.error=s,r.hasError=!0}finally{YK(r)}},wU=async function(t){if(t.executionContextId!==c(this,Zs))return;let r;try{r=JSON.parse(t.payload)}catch{return}const{type:s,name:i,seq:a,args:o,isTrivial:u}=r;if(s!=="internal"){this.emit("bindingcalled",t);return}if(!c(this,gu).has(i)){this.emit("bindingcalled",t);return}try{const l=c(this,gu).get(i);await(l==null?void 0:l.run(this,a,o,u))}catch(l){_e(l)}},bU=function(t){t.executionContextId===c(this,Zs)&&this.emit("consoleapicalled",t)},oy=new WeakMap,So=new WeakMap,dT=async function(t){try{await P(this,Tn,yU).call(this,t)}catch(r){_e(r)}},hT=async function(t,r,...s){var p;const i=II(((p=CI(r))==null?void 0:p.toString())??Rn.INTERNAL_URL);if(qi(r)){const m=c(this,Zs),g=r,y=vb.test(g)?g:`${g}
${i}
`,{exceptionDetails:w,result:S}=await c(this,vo).send("Runtime.evaluate",{expression:y,contextId:m,returnByValue:t,awaitPromise:!0,userGesture:!0}).catch(gO);if(w)throw lO(w);return t?cc(S):c(this,mu).createCdpHandle(S)}const a=ni(r),o=vb.test(a)?a:`${a}
${i}
`;let u;try{u=c(this,vo).send("Runtime.callFunctionOn",{functionDeclaration:o,executionContextId:c(this,Zs),arguments:s.some(m=>m instanceof Mn)?await Promise.all(s.map(m=>h(this,m))):s.map(m=>f(this,m)),returnByValue:t,awaitPromise:!0,userGesture:!0})}catch(m){throw m instanceof TypeError&&m.message.startsWith("Converting circular structure to JSON")&&(m.message+=" Recursive objects are not allowed."),m}const{exceptionDetails:l,result:d}=await u.catch(gO);if(l)throw lO(l);return t?cc(d):c(this,mu).createCdpHandle(d);async function h(m,g){return g instanceof Mn&&(g=await g.get(m)),f(m,g)}function f(m,g){if(typeof g=="bigint")return{unserializableValue:`${g.toString()}n`};if(Object.is(g,-0))return{unserializableValue:"-0"};if(Object.is(g,1/0))return{unserializableValue:"Infinity"};if(Object.is(g,-1/0))return{unserializableValue:"-Infinity"};if(Object.is(g,NaN))return{unserializableValue:"NaN"};const y=g&&(g instanceof Fb||g instanceof pO)?g:null;if(y){if(y.realm!==c(m,mu))throw new Error("JSHandles can be evaluated only in the context they were created!");if(y.disposed)throw new Error("JSHandle is disposed!");return y.remoteObject().unserializableValue?{unserializableValue:y.remoteObject().unserializableValue}:y.remoteObject().objectId?{objectId:y.remoteObject().objectId}:{value:y.remoteObject().value}}return{value:g}}};const gO=n=>{if(n.message.includes("Object reference chain is too long"))return{result:{type:"undefined"}};if(n.message.includes("Object couldn't be returned by value"))return{result:{type:"undefined"}};throw n.message.endsWith("Cannot find context with specified id")||n.message.endsWith("Inspected target navigated or closed")?new Error("Execution context was destroyed, most likely because of a navigation."):n};/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var wr;(function(n){n.FrameAttached=Symbol("FrameManager.FrameAttached"),n.FrameNavigated=Symbol("FrameManager.FrameNavigated"),n.FrameDetached=Symbol("FrameManager.FrameDetached"),n.FrameSwapped=Symbol("FrameManager.FrameSwapped"),n.LifecycleEvent=Symbol("FrameManager.LifecycleEvent"),n.FrameNavigatedWithinDocument=Symbol("FrameManager.FrameNavigatedWithinDocument"),n.ConsoleApiCalled=Symbol("FrameManager.ConsoleApiCalled"),n.BindingCalled=Symbol("FrameManager.BindingCalled")})(wr||(wr={}));/**
 * @license
 * Copyright 2019 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class nx extends nO{constructor(t,r){super(r);b(this,Vr);b(this,Ai);b(this,Js,new xe);b(this,xo);x(this,xo,t)}get environment(){return c(this,xo)}get client(){return c(this,xo).client}get emitter(){return c(this,Js)}setContext(t){var r;(r=c(this,Ai))==null||r[Me](),t.once("disposed",P(this,Vr,_U).bind(this)),t.on("consoleapicalled",P(this,Vr,vU).bind(this)),t.on("bindingcalled",P(this,Vr,SU).bind(this)),x(this,Ai,t),c(this,Js).emit("context",t),this.taskManager.rerunAll()}hasContext(){return!!c(this,Ai)}get context(){return c(this,Ai)}async evaluateHandle(t,...r){t=gr(this.evaluateHandle.name,t);let s=P(this,Vr,K0).call(this);return s||(s=await P(this,Vr,H0).call(this)),await s.evaluateHandle(t,...r)}async evaluate(t,...r){t=gr(this.evaluate.name,t);let s=P(this,Vr,K0).call(this);return s||(s=await P(this,Vr,H0).call(this)),await s.evaluate(t,...r)}async adoptBackendNode(t){let r=P(this,Vr,K0).call(this);r||(r=await P(this,Vr,H0).call(this));const{object:s}=await this.client.send("DOM.resolveNode",{backendNodeId:t,executionContextId:r.id});return this.createCdpHandle(s)}async adoptHandle(t){if(t.realm===this)return await t.evaluateHandle(s=>s);const r=await this.client.send("DOM.describeNode",{objectId:t.id});return await this.adoptBackendNode(r.node.backendNodeId)}async transferHandle(t){if(t.realm===this||t.remoteObject().objectId===void 0)return t;const r=await this.client.send("DOM.describeNode",{objectId:t.remoteObject().objectId}),s=await this.adoptBackendNode(r.node.backendNodeId);return await t.dispose(),s}createCdpHandle(t){return t.subtype==="node"?new pO(this,t):new Fb(this,t)}[Me](){var t;(t=c(this,Ai))==null||t[Me](),c(this,Js).emit("disposed",void 0),super[Me](),c(this,Js).removeAllListeners()}}Ai=new WeakMap,Js=new WeakMap,xo=new WeakMap,Vr=new WeakSet,_U=function(){x(this,Ai,void 0),"clearDocumentHandle"in c(this,xo)&&c(this,xo).clearDocumentHandle()},vU=function(t){c(this,Js).emit("consoleapicalled",t)},SU=function(t){c(this,Js).emit("bindingcalled",t)},K0=function(){if(this.disposed)throw new Error(`Execution context is not available in detached frame or worker "${this.environment.url()}" (are you trying to evaluate?)`);return c(this,Ai)},H0=async function(){const t=new Error("Execution context was destroyed");return await pr(St(c(this,Js),"context").pipe(Ir(St(c(this,Js),"disposed").pipe(Vt(()=>{throw t})),hn(this.timeoutSettings.timeout()))))};/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const ui=Symbol("mainWorld"),Bb=Symbol("puppeteerWorld");/**
 * @license
 * Copyright 2019 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const tH=new Map([["load","load"],["domcontentloaded","DOMContentLoaded"],["networkidle0","networkIdle"],["networkidle2","networkAlmostIdle"]]);class sx{constructor(e,t,r,s,i){b(this,Dt);b(this,cy);b(this,Eo);b(this,wh);b(this,ko,null);b(this,yu,new Xt);b(this,uy);b(this,Co);b(this,ly,Mt.create());b(this,dy,Mt.create());b(this,hy,Mt.create());b(this,fy);b(this,py);b(this,ya);Array.isArray(r)?r=r.slice():typeof r=="string"&&(r=[r]),x(this,uy,t._loaderId),x(this,cy,r.map(l=>{const d=tH.get(l);return se(d,"Unknown value for options.waitUntil: "+l),d})),i==null||i.addEventListener("abort",()=>{c(this,Co).reject(i.reason)}),x(this,Eo,t),x(this,wh,s),c(this,yu).use(new xe(t._frameManager)).on(wr.LifecycleEvent,P(this,Dt,Hu).bind(this));const o=c(this,yu).use(new xe(t));o.on(Or.FrameNavigatedWithinDocument,P(this,Dt,PU).bind(this)),o.on(Or.FrameNavigated,P(this,Dt,AU).bind(this)),o.on(Or.FrameSwapped,P(this,Dt,W0).bind(this)),o.on(Or.FrameSwappedByActivation,P(this,Dt,W0).bind(this)),o.on(Or.FrameDetached,P(this,Dt,CU).bind(this));const u=c(this,yu).use(new xe(e));u.on(yr.Request,P(this,Dt,xU).bind(this)),u.on(yr.Response,P(this,Dt,kU).bind(this)),u.on(yr.RequestFailed,P(this,Dt,EU).bind(this)),x(this,Co,Mt.create({timeout:c(this,wh),message:`Navigation timeout of ${c(this,wh)} ms exceeded`})),P(this,Dt,Hu).call(this)}async navigationResponse(){var e;return await((e=c(this,ya))==null?void 0:e.valueOrThrow()),c(this,ko)?c(this,ko).response():null}sameDocumentNavigationPromise(){return c(this,ly).valueOrThrow()}newDocumentNavigationPromise(){return c(this,hy).valueOrThrow()}lifecyclePromise(){return c(this,dy).valueOrThrow()}terminationPromise(){return c(this,Co).valueOrThrow()}dispose(){c(this,yu).dispose(),c(this,Co).resolve(new Error("LifecycleWatcher disposed"))}}cy=new WeakMap,Eo=new WeakMap,wh=new WeakMap,ko=new WeakMap,yu=new WeakMap,uy=new WeakMap,Co=new WeakMap,ly=new WeakMap,dy=new WeakMap,hy=new WeakMap,fy=new WeakMap,py=new WeakMap,ya=new WeakMap,Dt=new WeakSet,xU=function(e){var t,r;e.frame()!==c(this,Eo)||!e.isNavigationRequest()||(x(this,ko,e),(t=c(this,ya))==null||t.resolve(),x(this,ya,Mt.create()),e.response()!==null&&((r=c(this,ya))==null||r.resolve()))},EU=function(e){var t,r;((t=c(this,ko))==null?void 0:t.id)===e.id&&((r=c(this,ya))==null||r.resolve())},kU=function(e){var t,r;((t=c(this,ko))==null?void 0:t.id)===e.request().id&&((r=c(this,ya))==null||r.resolve())},CU=function(e){if(c(this,Eo)===e){c(this,Co).resolve(new Error("Navigating frame was detached"));return}P(this,Dt,Hu).call(this)},PU=function(){x(this,fy,!0),P(this,Dt,Hu).call(this)},AU=function(e){if(e==="BackForwardCacheRestore")return P(this,Dt,W0).call(this);P(this,Dt,Hu).call(this)},W0=function(){x(this,py,!0),P(this,Dt,Hu).call(this)},Hu=function(){if(!e(c(this,Eo),c(this,cy)))return;c(this,dy).resolve(),c(this,fy)&&c(this,ly).resolve(void 0),(c(this,py)||c(this,Eo)._loaderId!==c(this,uy))&&c(this,hy).resolve(void 0);function e(t,r){for(const s of r)if(!t._lifecycleEvents.has(s))return!1;for(const s of t.childFrames())if(s._hasStartedLoading&&!e(s,r))return!1;return!0}};/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var rH=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},uc=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let yO=(()=>{var l,d,h,f,TU,IU,OU,y;let n=HI,e=[],t,r,s,i,a,o,u;return y=class extends n{constructor(_,v,A,k){super();b(this,f);b(this,l,(rH(this,e),""));b(this,d,!1);b(this,h);Z(this,"_frameManager");Z(this,"_loaderId","");Z(this,"_lifecycleEvents",new Set);Z(this,"_id");Z(this,"_parentId");Z(this,"accessibility");Z(this,"worlds");this._frameManager=_,x(this,l,""),this._id=v,this._parentId=A,x(this,d,!1),x(this,h,k),this._loaderId="",this.worlds={[ui]:new nx(this,this._frameManager.timeoutSettings),[Bb]:new nx(this,this._frameManager.timeoutSettings)},this.accessibility=new iO(this.worlds[ui],v),this.on(Or.FrameSwappedByActivation,()=>{this._onLoadingStarted(),this._onLoadingStopped()}),this.worlds[ui].emitter.on("consoleapicalled",P(this,f,TU).bind(this)),this.worlds[ui].emitter.on("bindingcalled",P(this,f,IU).bind(this))}_client(){return c(this,h)}updateId(_){this._id=_}updateClient(_){x(this,h,_)}page(){return this._frameManager.page()}async goto(_,v={}){const{referer:A=this._frameManager.networkManager.extraHTTPHeaders().referer,referrerPolicy:k=this._frameManager.networkManager.extraHTTPHeaders()["referer-policy"],waitUntil:C=["load"],timeout:E=this._frameManager.timeoutSettings.navigationTimeout()}=v;let N=!1;const I=new sx(this._frameManager.networkManager,this,C,E);let $=await Mt.race([O(c(this,h),_,A,k,this._id),I.terminationPromise()]);$||($=await Mt.race([I.terminationPromise(),N?I.newDocumentNavigationPromise():I.sameDocumentNavigationPromise()]));try{if($)throw $;return await I.navigationResponse()}finally{I.dispose()}async function O(T,L,U,J,F){try{const j=await T.send("Page.navigate",{url:L,referrer:U,frameId:F,referrerPolicy:J});return N=!!j.loaderId,j.errorText==="net::ERR_HTTP_RESPONSE_CODE_FAILURE"?null:j.errorText?new Error(`${j.errorText} at ${L}`):null}catch(j){if(es(j))return j;throw j}}}async waitForNavigation(_={}){const{waitUntil:v=["load"],timeout:A=this._frameManager.timeoutSettings.navigationTimeout(),signal:k}=_,C=new sx(this._frameManager.networkManager,this,v,A,k),E=await Mt.race([C.terminationPromise(),..._.ignoreSameDocumentNavigation?[]:[C.sameDocumentNavigationPromise()],C.newDocumentNavigationPromise()]);try{if(E)throw E;const N=await Mt.race([C.terminationPromise(),C.navigationResponse()]);if(N instanceof Error)throw E;return N||null}finally{C.dispose()}}get client(){return c(this,h)}mainRealm(){return this.worlds[ui]}isolatedRealm(){return this.worlds[Bb]}async setContent(_,v={}){const{waitUntil:A=["load"],timeout:k=this._frameManager.timeoutSettings.navigationTimeout()}=v;await this.setFrameContent(_);const C=new sx(this._frameManager.networkManager,this,A,k),E=await Mt.race([C.terminationPromise(),C.lifecyclePromise()]);if(C.dispose(),E)throw E}url(){return c(this,l)}parentFrame(){return this._frameManager._frameTree.parentFrame(this._id)||null}childFrames(){return this._frameManager._frameTree.childFrames(this._id)}async addPreloadScript(_){const v=this.parentFrame();if(v&&c(this,h)===v.client||_.getIdForFrame(this))return;const{identifier:A}=await c(this,h).send("Page.addScriptToEvaluateOnNewDocument",{source:_.source});_.setIdForFrame(this,A)}async addExposedFunctionBinding(_){this!==this._frameManager.mainFrame()&&!this._hasStartedLoading||await Promise.all([c(this,h).send("Runtime.addBinding",{name:dl+_.name}),this.evaluate(_.initSource).catch(_e)])}async removeExposedFunctionBinding(_){this!==this._frameManager.mainFrame()&&!this._hasStartedLoading||await Promise.all([c(this,h).send("Runtime.removeBinding",{name:dl+_.name}),this.evaluate(v=>{globalThis[v]=void 0},_.name).catch(_e)])}async waitForDevicePrompt(_={}){return await P(this,f,OU).call(this).waitForDevicePrompt(_)}_navigated(_){this._name=_.name,x(this,l,`${_.url}${_.urlFragment||""}`)}_navigatedWithinDocument(_){x(this,l,_)}_onLifecycleEvent(_,v){v==="init"&&(this._loaderId=_,this._lifecycleEvents.clear()),this._lifecycleEvents.add(v)}_onLoadingStopped(){this._lifecycleEvents.add("DOMContentLoaded"),this._lifecycleEvents.add("load")}_onLoadingStarted(){this._hasStartedLoading=!0}get detached(){return c(this,d)}[(t=[rt],r=[rt],s=[rt],i=[rt],a=[rt],o=[rt],u=[rt],Me)](){c(this,d)||(x(this,d,!0),this.worlds[ui][Me](),this.worlds[Bb][Me]())}exposeFunction(){throw new Fe}async frameElement(){const _=this.parentFrame();if(!_)return null;const{backendNodeId:v}=await _.client.send("DOM.getFrameOwner",{frameId:this._id});return await _.mainRealm().adoptBackendNode(v)}},l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakSet,TU=function(_){this._frameManager.emit(wr.ConsoleApiCalled,[this.worlds[ui],_])},IU=function(_){this._frameManager.emit(wr.BindingCalled,[this.worlds[ui],_])},OU=function(){return this._frameManager._deviceRequestPromptManager(c(this,h))},(()=>{const _=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;uc(y,null,t,{kind:"method",name:"goto",static:!1,private:!1,access:{has:v=>"goto"in v,get:v=>v.goto},metadata:_},null,e),uc(y,null,r,{kind:"method",name:"waitForNavigation",static:!1,private:!1,access:{has:v=>"waitForNavigation"in v,get:v=>v.waitForNavigation},metadata:_},null,e),uc(y,null,s,{kind:"method",name:"setContent",static:!1,private:!1,access:{has:v=>"setContent"in v,get:v=>v.setContent},metadata:_},null,e),uc(y,null,i,{kind:"method",name:"addPreloadScript",static:!1,private:!1,access:{has:v=>"addPreloadScript"in v,get:v=>v.addPreloadScript},metadata:_},null,e),uc(y,null,a,{kind:"method",name:"addExposedFunctionBinding",static:!1,private:!1,access:{has:v=>"addExposedFunctionBinding"in v,get:v=>v.addExposedFunctionBinding},metadata:_},null,e),uc(y,null,o,{kind:"method",name:"removeExposedFunctionBinding",static:!1,private:!1,access:{has:v=>"removeExposedFunctionBinding"in v,get:v=>v.removeExposedFunctionBinding},metadata:_},null,e),uc(y,null,u,{kind:"method",name:"waitForDevicePrompt",static:!1,private:!1,access:{has:v=>"waitForDevicePrompt"in v,get:v=>v.waitForDevicePrompt},metadata:_},null,e),_&&Object.defineProperty(y,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_})})(),y})();/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class nH{constructor(){b(this,wu,new Map);b(this,bh,new Map);b(this,Po,new Map);b(this,_h);b(this,vh,!1);b(this,my,new Map)}getMainFrame(){return c(this,_h)}getById(e){return c(this,wu).get(e)}waitForFrame(e){const t=this.getById(e);if(t)return Promise.resolve(t);const r=Mt.create();return(c(this,my).get(e)||new Set).add(r),r.valueOrThrow()}frames(){return Array.from(c(this,wu).values())}addFrame(e){var t;c(this,wu).set(e._id,e),e._parentId?(c(this,bh).set(e._id,e._parentId),c(this,Po).has(e._parentId)||c(this,Po).set(e._parentId,new Set),c(this,Po).get(e._parentId).add(e._id)):(!c(this,_h)||c(this,vh))&&(x(this,_h,e),x(this,vh,!1)),(t=c(this,my).get(e._id))==null||t.forEach(r=>r.resolve(e))}removeFrame(e){var t;c(this,wu).delete(e._id),c(this,bh).delete(e._id),e._parentId?(t=c(this,Po).get(e._parentId))==null||t.delete(e._id):x(this,vh,!0)}childFrames(e){const t=c(this,Po).get(e);return t?Array.from(t).map(r=>this.getById(r)).filter(r=>r!==void 0):[]}parentFrame(e){const t=c(this,bh).get(e);return t?this.getById(t):void 0}}wu=new WeakMap,bh=new WeakMap,Po=new WeakMap,_h=new WeakMap,vh=new WeakMap,my=new WeakMap;class ix extends $b{constructor(t,r,s,i,a,o){super();Z(this,"id");b(this,Ti);b(this,gy);b(this,yy);b(this,wy);b(this,by);b(this,_y,!1);b(this,vy);b(this,Sy,{});b(this,xy);b(this,Ey);x(this,Ti,t),this.id=a.requestId,x(this,gy,a.requestId===a.loaderId&&a.type==="Document"),this._interceptionId=s,x(this,yy,a.request.url+(a.request.urlFragment??"")),x(this,wy,(a.type||"other").toLowerCase()),x(this,by,a.request.method),x(this,vy,a.request.postData),x(this,_y,a.request.hasPostData??!1),x(this,xy,r),this._redirectChain=o,x(this,Ey,a.initiator),this.interception.enabled=i;for(const[u,l]of Object.entries(a.request.headers))c(this,Sy)[u.toLowerCase()]=l}get client(){return c(this,Ti)}set client(t){x(this,Ti,t)}url(){return c(this,yy)}resourceType(){return c(this,wy)}method(){return c(this,by)}postData(){return c(this,vy)}hasPostData(){return c(this,_y)}async fetchPostData(){try{return(await c(this,Ti).send("Network.getRequestPostData",{requestId:this.id})).postData}catch(t){_e(t);return}}headers(){return c(this,Sy)}response(){return this._response}frame(){return c(this,xy)}isNavigationRequest(){return c(this,gy)}initiator(){return c(this,Ey)}redirectChain(){return this._redirectChain.slice()}failure(){return this._failureText?{errorText:this._failureText}:null}async _continue(t={}){const{url:r,method:s,postData:i,headers:a}=t;this.interception.handled=!0;const o=i?xI(i):void 0;if(this._interceptionId===void 0)throw new Error("HTTPRequest is missing _interceptionId needed for Fetch.continueRequest");await c(this,Ti).send("Fetch.continueRequest",{requestId:this._interceptionId,url:r,method:s,postData:o,headers:a?WI(a):void 0}).catch(u=>(this.interception.handled=!1,jb(u)))}async _respond(t){this.interception.handled=!0;let r;t.body&&(r=$b.getResponse(t.body));const s={};if(t.headers)for(const a of Object.keys(t.headers)){const o=t.headers[a];s[a.toLowerCase()]=Array.isArray(o)?o.map(u=>String(u)):String(o)}t.contentType&&(s["content-type"]=t.contentType),r!=null&&r.contentLength&&!("content-length"in s)&&(s["content-length"]=String(r.contentLength));const i=t.status||200;if(this._interceptionId===void 0)throw new Error("HTTPRequest is missing _interceptionId needed for Fetch.fulfillRequest");await c(this,Ti).send("Fetch.fulfillRequest",{requestId:this._interceptionId,responseCode:i,responsePhrase:zI[i],responseHeaders:WI(s),body:r==null?void 0:r.base64}).catch(a=>(this.interception.handled=!1,jb(a)))}async _abort(t){if(this.interception.handled=!0,this._interceptionId===void 0)throw new Error("HTTPRequest is missing _interceptionId needed for Fetch.failRequest");await c(this,Ti).send("Fetch.failRequest",{requestId:this._interceptionId,errorReason:t||"Failed"}).catch(jb)}}Ti=new WeakMap,gy=new WeakMap,yy=new WeakMap,wy=new WeakMap,by=new WeakMap,_y=new WeakMap,vy=new WeakMap,Sy=new WeakMap,xy=new WeakMap,Ey=new WeakMap;/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class wO{constructor(e){b(this,ky);b(this,Cy);b(this,Py);b(this,Ay);b(this,Ty);b(this,Iy);x(this,ky,e.subjectName),x(this,Cy,e.issuer),x(this,Py,e.validFrom),x(this,Ay,e.validTo),x(this,Ty,e.protocol),x(this,Iy,e.sanList)}issuer(){return c(this,Cy)}validFrom(){return c(this,Py)}validTo(){return c(this,Ay)}protocol(){return c(this,Ty)}subjectName(){return c(this,ky)}subjectAlternativeNames(){return c(this,Iy)}}ky=new WeakMap,Cy=new WeakMap,Py=new WeakMap,Ay=new WeakMap,Ty=new WeakMap,Iy=new WeakMap;class bO extends VI{constructor(t,r,s){super();b(this,A0);b(this,Ii);b(this,Sh,null);b(this,xh,Mt.create());b(this,Oy);b(this,Ry);b(this,My);b(this,Ny);b(this,$y);b(this,jy,{});b(this,Ly);b(this,Fy);x(this,Ii,t),x(this,Oy,{ip:r.remoteIPAddress,port:r.remotePort}),x(this,My,P(this,A0,RU).call(this,s)||r.statusText),x(this,Ny,!!r.fromDiskCache),x(this,$y,!!r.fromServiceWorker),x(this,Ry,s?s.statusCode:r.status);const i=s?s.headers:r.headers;for(const[a,o]of Object.entries(i))c(this,jy)[a.toLowerCase()]=o;x(this,Ly,r.securityDetails?new wO(r.securityDetails):null),x(this,Fy,r.timing||null)}_resolveBody(t){return t?c(this,xh).reject(t):c(this,xh).resolve()}remoteAddress(){return c(this,Oy)}url(){return c(this,Ii).url()}status(){return c(this,Ry)}statusText(){return c(this,My)}headers(){return c(this,jy)}securityDetails(){return c(this,Ly)}timing(){return c(this,Fy)}content(){return c(this,Sh)||x(this,Sh,c(this,xh).valueOrThrow().then(async()=>{try{const t=await c(this,Ii).client.send("Network.getResponseBody",{requestId:c(this,Ii).id});return FS(t.body,t.base64Encoded)}catch(t){throw t instanceof sc&&t.originalMessage==="No resource with given identifier found"?new sc("Could not load body for this request. This might happen if the request is a preflight request."):t}})),c(this,Sh)}request(){return c(this,Ii)}fromCache(){return c(this,Ny)||c(this,Ii)._fromMemoryCache}fromServiceWorker(){return c(this,$y)}frame(){return c(this,Ii).frame()}}Ii=new WeakMap,Sh=new WeakMap,xh=new WeakMap,Oy=new WeakMap,Ry=new WeakMap,My=new WeakMap,Ny=new WeakMap,$y=new WeakMap,jy=new WeakMap,Ly=new WeakMap,Fy=new WeakMap,A0=new WeakSet,RU=function(t){if(!t||!t.headersText)return;const r=t.headersText.split("\r",1)[0];if(!r||r.length>1e3)return;const s=r.match(/[^ ]* [^ ]* (.*)/);if(!s)return;const i=s[1];if(i)return i};/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class sH{constructor(){b(this,Ao,new Map);b(this,To,new Map);b(this,Io,new Map);b(this,Oo,new Map);b(this,bu,new Map);b(this,_u,new Map)}forget(e){c(this,Ao).delete(e),c(this,To).delete(e),c(this,_u).delete(e),c(this,bu).delete(e),c(this,Oo).delete(e)}responseExtraInfo(e){return c(this,Oo).has(e)||c(this,Oo).set(e,[]),c(this,Oo).get(e)}queuedRedirectInfo(e){return c(this,bu).has(e)||c(this,bu).set(e,[]),c(this,bu).get(e)}queueRedirectInfo(e,t){this.queuedRedirectInfo(e).push(t)}takeQueuedRedirectInfo(e){return this.queuedRedirectInfo(e).shift()}inFlightRequestsCount(){let e=0;for(const t of c(this,Io).values())t.response()||e++;return e}storeRequestWillBeSent(e,t){c(this,Ao).set(e,t)}getRequestWillBeSent(e){return c(this,Ao).get(e)}forgetRequestWillBeSent(e){c(this,Ao).delete(e)}getRequestPaused(e){return c(this,To).get(e)}forgetRequestPaused(e){c(this,To).delete(e)}storeRequestPaused(e,t){c(this,To).set(e,t)}getRequest(e){return c(this,Io).get(e)}storeRequest(e,t){c(this,Io).set(e,t)}forgetRequest(e){c(this,Io).delete(e)}getQueuedEventGroup(e){return c(this,_u).get(e)}queueEventGroup(e,t){c(this,_u).set(e,t)}forgetQueuedEventGroup(e){c(this,_u).delete(e)}printState(){function e(t,r){return r instanceof Map?{dataType:"Map",value:Array.from(r.entries())}:r instanceof ix?{dataType:"CdpHTTPRequest",value:`${r.id}: ${r.url()}`}:r}console.log("httpRequestsMap",JSON.stringify(c(this,Io),e,2)),console.log("requestWillBeSentMap",JSON.stringify(c(this,Ao),e,2)),console.log("requestWillBeSentMap",JSON.stringify(c(this,Oo),e,2)),console.log("requestWillBeSentMap",JSON.stringify(c(this,To),e,2))}}Ao=new WeakMap,To=new WeakMap,Io=new WeakMap,Oo=new WeakMap,bu=new WeakMap,_u=new WeakMap;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class iH extends xe{constructor(t){super();b(this,he);b(this,Eh);b(this,dt,new sH);b(this,vu);b(this,Ro,null);b(this,kh,new Set);b(this,Oi,!1);b(this,wa,!1);b(this,Mo);b(this,Gr);b(this,Ch);b(this,Dy);b(this,T0,[["Fetch.requestPaused",P(this,he,jU)],["Fetch.authRequired",P(this,he,$U)],["Network.requestWillBeSent",P(this,he,NU)],["Network.requestServedFromCache",P(this,he,FU)],["Network.responseReceived",P(this,he,BU)],["Network.loadingFinished",P(this,he,qU)],["Network.loadingFailed",P(this,he,KU)],["Network.responseReceivedExtraInfo",P(this,he,UU)],[jt.Disconnected,P(this,he,MU)]]);b(this,No,new Map);x(this,Eh,t)}async addClient(t){if(c(this,No).has(t))return;const r=new Xt;c(this,No).set(t,r);const s=r.use(new xe(t));for(const[i,a]of c(this,T0))s.on(i,o=>a.bind(this)(t,o));await Promise.all([t.send("Network.enable"),P(this,he,fT).call(this,t),P(this,he,z0).call(this,t),P(this,he,Ww).call(this,t),P(this,he,V0).call(this,t),P(this,he,pT).call(this,t)])}async authenticate(t){x(this,Ro,t);const r=c(this,Oi)||!!c(this,Ro);r!==c(this,wa)&&(x(this,wa,r),await P(this,he,Xo).call(this,P(this,he,V0).bind(this)))}async setExtraHTTPHeaders(t){const r={};for(const[s,i]of Object.entries(t))se(qi(i),`Expected value of header "${s}" to be String, but "${typeof i}" is found.`),r[s.toLowerCase()]=i;x(this,vu,r),await P(this,he,Xo).call(this,P(this,he,fT).bind(this))}extraHTTPHeaders(){return Object.assign({},c(this,vu))}inFlightRequestsCount(){return c(this,dt).inFlightRequestsCount()}async setOfflineMode(t){c(this,Gr)||x(this,Gr,{offline:!1,upload:-1,download:-1,latency:0}),c(this,Gr).offline=t,await P(this,he,Xo).call(this,P(this,he,z0).bind(this))}async emulateNetworkConditions(t){c(this,Gr)||x(this,Gr,{offline:!1,upload:-1,download:-1,latency:0}),c(this,Gr).upload=t?t.upload:-1,c(this,Gr).download=t?t.download:-1,c(this,Gr).latency=t?t.latency:0,await P(this,he,Xo).call(this,P(this,he,z0).bind(this))}async setUserAgent(t,r){x(this,Ch,t),x(this,Dy,r),await P(this,he,Xo).call(this,P(this,he,pT).bind(this))}async setCacheEnabled(t){x(this,Mo,!t),await P(this,he,Xo).call(this,P(this,he,Ww).bind(this))}async setRequestInterception(t){x(this,Oi,t);const r=c(this,Oi)||!!c(this,Ro);r!==c(this,wa)&&(x(this,wa,r),await P(this,he,Xo).call(this,P(this,he,V0).bind(this)))}}Eh=new WeakMap,dt=new WeakMap,vu=new WeakMap,Ro=new WeakMap,kh=new WeakMap,Oi=new WeakMap,wa=new WeakMap,Mo=new WeakMap,Gr=new WeakMap,Ch=new WeakMap,Dy=new WeakMap,T0=new WeakMap,No=new WeakMap,he=new WeakSet,MU=async function(t){var r;(r=c(this,No).get(t))==null||r.dispose(),c(this,No).delete(t)},fT=async function(t){c(this,vu)!==void 0&&await t.send("Network.setExtraHTTPHeaders",{headers:c(this,vu)})},Xo=async function(t){await Promise.all(Array.from(c(this,No).keys()).map(r=>t(r)))},z0=async function(t){c(this,Gr)!==void 0&&await t.send("Network.emulateNetworkConditions",{offline:c(this,Gr).offline,latency:c(this,Gr).latency,uploadThroughput:c(this,Gr).upload,downloadThroughput:c(this,Gr).download})},pT=async function(t){c(this,Ch)!==void 0&&await t.send("Network.setUserAgentOverride",{userAgent:c(this,Ch),userAgentMetadata:c(this,Dy)})},V0=async function(t){c(this,Mo)===void 0&&x(this,Mo,!1),c(this,wa)?await Promise.all([P(this,he,Ww).call(this,t),t.send("Fetch.enable",{handleAuthRequests:!0,patterns:[{urlPattern:"*"}]})]):await Promise.all([P(this,he,Ww).call(this,t),t.send("Fetch.disable")])},Ww=async function(t){c(this,Mo)!==void 0&&await t.send("Network.setCacheDisabled",{cacheDisabled:c(this,Mo)})},NU=function(t,r){if(c(this,Oi)&&!r.request.url.startsWith("data:")){const{requestId:s}=r;c(this,dt).storeRequestWillBeSent(s,r);const i=c(this,dt).getRequestPaused(s);if(i){const{requestId:a}=i;P(this,he,mT).call(this,r,i),P(this,he,cf).call(this,t,r,a),c(this,dt).forgetRequestPaused(s)}return}P(this,he,cf).call(this,t,r,void 0)},$U=function(t,r){let s="Default";c(this,kh).has(r.requestId)?s="CancelAuth":c(this,Ro)&&(s="ProvideCredentials",c(this,kh).add(r.requestId));const{username:i,password:a}=c(this,Ro)||{username:void 0,password:void 0};t.send("Fetch.continueWithAuth",{requestId:r.requestId,authChallengeResponse:{response:s,username:i,password:a}}).catch(_e)},jU=function(t,r){!c(this,Oi)&&c(this,wa)&&t.send("Fetch.continueRequest",{requestId:r.requestId}).catch(_e);const{networkId:s,requestId:i}=r;if(!s){P(this,he,LU).call(this,t,r);return}const a=(()=>{const o=c(this,dt).getRequestWillBeSent(s);if(o&&(o.request.url!==r.request.url||o.request.method!==r.request.method)){c(this,dt).forgetRequestWillBeSent(s);return}return o})();a?(P(this,he,mT).call(this,a,r),P(this,he,cf).call(this,t,a,i)):c(this,dt).storeRequestPaused(s,r)},mT=function(t,r){t.request.headers={...t.request.headers,...r.request.headers}},LU=function(t,r){const s=r.frameId?c(this,Eh).frame(r.frameId):null,i=new ix(t,s,r.requestId,c(this,Oi),r,[]);this.emit(yr.Request,i),i.finalizeInterceptions()},cf=function(t,r,s,i=!1){let a=[];if(r.redirectResponse){let l=null;if(r.redirectHasExtraInfo&&(l=c(this,dt).responseExtraInfo(r.requestId).shift(),!l)){c(this,dt).queueRedirectInfo(r.requestId,{event:r,fetchRequestId:s});return}const d=c(this,dt).getRequest(r.requestId);d&&(P(this,he,DU).call(this,t,d,r.redirectResponse,l),a=d._redirectChain)}const o=r.frameId?c(this,Eh).frame(r.frameId):null,u=new ix(t,o,s,c(this,Oi),r,a);u._fromMemoryCache=i,c(this,dt).storeRequest(r.requestId,u),this.emit(yr.Request,u),u.finalizeInterceptions()},FU=function(t,r){const s=c(this,dt).getRequestWillBeSent(r.requestId);let i=c(this,dt).getRequest(r.requestId);if(i&&(i._fromMemoryCache=!0),!i&&s&&(P(this,he,cf).call(this,t,s,void 0,!0),i=c(this,dt).getRequest(r.requestId)),!i){_e(new Error(`Request ${r.requestId} was served from cache but we could not find the corresponding request object`));return}this.emit(yr.RequestServedFromCache,i)},DU=function(t,r,s,i){const a=new bO(r,s,i);r._response=a,r._redirectChain.push(r),a._resolveBody(new Error("Response body is unavailable for redirect responses")),P(this,he,G0).call(this,r,!1),this.emit(yr.Response,a),this.emit(yr.RequestFinished,r)},gT=function(t,r,s){const i=c(this,dt).getRequest(r.requestId);if(!i)return;c(this,dt).responseExtraInfo(r.requestId).length&&_e(new Error("Unexpected extraInfo events for request "+r.requestId)),r.response.fromDiskCache&&(s=null);const o=new bO(i,r.response,s);i._response=o,this.emit(yr.Response,o)},BU=function(t,r){const s=c(this,dt).getRequest(r.requestId);let i=null;if(s&&!s._fromMemoryCache&&r.hasExtraInfo&&(i=c(this,dt).responseExtraInfo(r.requestId).shift(),!i)){c(this,dt).queueEventGroup(r.requestId,{responseReceivedEvent:r});return}P(this,he,gT).call(this,t,r,i)},UU=function(t,r){const s=c(this,dt).takeQueuedRedirectInfo(r.requestId);if(s){c(this,dt).responseExtraInfo(r.requestId).push(r),P(this,he,cf).call(this,t,s.event,s.fetchRequestId);return}const i=c(this,dt).getQueuedEventGroup(r.requestId);if(i){c(this,dt).forgetQueuedEventGroup(r.requestId),P(this,he,gT).call(this,t,i.responseReceivedEvent,r),i.loadingFinishedEvent&&P(this,he,yT).call(this,t,i.loadingFinishedEvent),i.loadingFailedEvent&&P(this,he,wT).call(this,t,i.loadingFailedEvent);return}c(this,dt).responseExtraInfo(r.requestId).push(r)},G0=function(t,r){const s=t.id,i=t._interceptionId;c(this,dt).forgetRequest(s),i!==void 0&&c(this,kh).delete(i),r&&c(this,dt).forget(s)},qU=function(t,r){const s=c(this,dt).getQueuedEventGroup(r.requestId);s?s.loadingFinishedEvent=r:P(this,he,yT).call(this,t,r)},yT=function(t,r){var i;const s=c(this,dt).getRequest(r.requestId);s&&(P(this,he,bT).call(this,t,s),s.response()&&((i=s.response())==null||i._resolveBody()),P(this,he,G0).call(this,s,!0),this.emit(yr.RequestFinished,s))},KU=function(t,r){const s=c(this,dt).getQueuedEventGroup(r.requestId);s?s.loadingFailedEvent=r:P(this,he,wT).call(this,t,r)},wT=function(t,r){const s=c(this,dt).getRequest(r.requestId);if(!s)return;P(this,he,bT).call(this,t,s),s._failureText=r.errorText;const i=s.response();i&&i._resolveBody(),P(this,he,G0).call(this,s,!0),this.emit(yr.RequestFailed,s)},bT=function(t,r){t!==r.client&&r.isNavigationRequest()&&(r.client=t)};/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const aH=100;class oH extends xe{constructor(t,r,s){super();b(this,at);b(this,By);b(this,$o);b(this,Ph);b(this,Uy,new Set);b(this,ps);b(this,Su,new Map);b(this,Ah,new Set);Z(this,"_frameTree",new nH);b(this,xu,new Set);b(this,qy,new WeakMap);b(this,un);x(this,ps,t),x(this,By,r),x(this,$o,new iH(this)),x(this,Ph,s),this.setupEventListeners(c(this,ps)),t.once(jt.Disconnected,()=>{P(this,at,_T).call(this).catch(_e)})}get timeoutSettings(){return c(this,Ph)}get networkManager(){return c(this,$o)}get client(){return c(this,ps)}async swapFrameTree(t){x(this,ps,t),se(c(this,ps)instanceof ll,"CDPSession is not an instance of CDPSessionImpl.");const r=this._frameTree.getMainFrame();r&&(c(this,xu).add(c(this,ps)._target()._targetId),this._frameTree.removeFrame(r),r.updateId(c(this,ps)._target()._targetId),this._frameTree.addFrame(r),r.updateClient(t)),this.setupEventListeners(t),t.once(jt.Disconnected,()=>{P(this,at,_T).call(this).catch(_e)}),await this.initialize(t,r),await c(this,$o).addClient(t),r&&r.emit(Or.FrameSwappedByActivation,void 0)}async registerSpeculativeSession(t){await c(this,$o).addClient(t)}setupEventListeners(t){t.on("Page.frameAttached",async r=>{var s;await((s=c(this,un))==null?void 0:s.valueOrThrow()),P(this,at,ST).call(this,t,r.frameId,r.parentFrameId)}),t.on("Page.frameNavigated",async r=>{var s;c(this,xu).add(r.frame.id),await((s=c(this,un))==null?void 0:s.valueOrThrow()),P(this,at,xT).call(this,r.frame,r.type)}),t.on("Page.navigatedWithinDocument",async r=>{var s;await((s=c(this,un))==null?void 0:s.valueOrThrow()),P(this,at,GU).call(this,r.frameId,r.url)}),t.on("Page.frameDetached",async r=>{var s;await((s=c(this,un))==null?void 0:s.valueOrThrow()),P(this,at,ZU).call(this,r.frameId,r.reason)}),t.on("Page.frameStartedLoading",async r=>{var s;await((s=c(this,un))==null?void 0:s.valueOrThrow()),P(this,at,WU).call(this,r.frameId)}),t.on("Page.frameStoppedLoading",async r=>{var s;await((s=c(this,un))==null?void 0:s.valueOrThrow()),P(this,at,zU).call(this,r.frameId)}),t.on("Runtime.executionContextCreated",async r=>{var s;await((s=c(this,un))==null?void 0:s.valueOrThrow()),P(this,at,JU).call(this,r.context,t)}),t.on("Page.lifecycleEvent",async r=>{var s;await((s=c(this,un))==null?void 0:s.valueOrThrow()),P(this,at,HU).call(this,r)})}async initialize(t,r){var s,i;try{(s=c(this,un))==null||s.resolve(),x(this,un,Mt.create()),await Promise.all([c(this,$o).addClient(t),t.send("Page.enable"),t.send("Page.getFrameTree").then(({frameTree:a})=>{var o;P(this,at,vT).call(this,t,a),(o=c(this,un))==null||o.resolve()}),t.send("Page.setLifecycleEventsEnabled",{enabled:!0}),t.send("Runtime.enable").then(()=>P(this,at,VU).call(this,t,TI)),...(r?Array.from(c(this,Su).values()):[]).map(a=>r==null?void 0:r.addPreloadScript(a)),...(r?Array.from(c(this,Ah).values()):[]).map(a=>r==null?void 0:r.addExposedFunctionBinding(a))])}catch(a){if((i=c(this,un))==null||i.resolve(),es(a)&&rx(a))return;throw a}}page(){return c(this,By)}mainFrame(){const t=this._frameTree.getMainFrame();return se(t,"Requesting main frame too early!"),t}frames(){return Array.from(this._frameTree.frames())}frame(t){return this._frameTree.getById(t)||null}async addExposedFunctionBinding(t){c(this,Ah).add(t),await Promise.all(this.frames().map(async r=>await r.addExposedFunctionBinding(t)))}async removeExposedFunctionBinding(t){c(this,Ah).delete(t),await Promise.all(this.frames().map(async r=>await r.removeExposedFunctionBinding(t)))}async evaluateOnNewDocument(t){const{identifier:r}=await this.mainFrame()._client().send("Page.addScriptToEvaluateOnNewDocument",{source:t}),s=new KK(this.mainFrame(),r,t);return c(this,Su).set(r,s),await Promise.all(this.frames().map(async i=>await i.addPreloadScript(s))),{identifier:r}}async removeScriptToEvaluateOnNewDocument(t){const r=c(this,Su).get(t);if(!r)throw new Error(`Script to evaluate on new document with id ${t} not found`);c(this,Su).delete(t),await Promise.all(this.frames().map(s=>{const i=r.getIdForFrame(s);if(i)return s._client().send("Page.removeScriptToEvaluateOnNewDocument",{identifier:i}).catch(_e)}))}onAttachedToTarget(t){if(t._getTargetInfo().type!=="iframe")return;const r=this.frame(t._getTargetInfo().targetId);r&&r.updateClient(t._session()),this.setupEventListeners(t._session()),this.initialize(t._session(),r)}_deviceRequestPromptManager(t){let r=c(this,qy).get(t);return r===void 0&&(r=new zK(t,c(this,Ph)),c(this,qy).set(t,r)),r}}By=new WeakMap,$o=new WeakMap,Ph=new WeakMap,Uy=new WeakMap,ps=new WeakMap,Su=new WeakMap,Ah=new WeakMap,xu=new WeakMap,qy=new WeakMap,un=new WeakMap,at=new WeakSet,_T=async function(){const t=this._frameTree.getMainFrame();if(!t)return;for(const s of t.childFrames())P(this,at,uf).call(this,s);const r=Mt.create({timeout:aH,message:"Frame was not swapped"});t.once(Or.FrameSwappedByActivation,()=>{r.resolve()});try{await r.valueOrThrow()}catch{P(this,at,uf).call(this,t)}},HU=function(t){const r=this.frame(t.frameId);r&&(r._onLifecycleEvent(t.loaderId,t.name),this.emit(wr.LifecycleEvent,r),r.emit(Or.LifecycleEvent,void 0))},WU=function(t){const r=this.frame(t);r&&r._onLoadingStarted()},zU=function(t){const r=this.frame(t);r&&(r._onLoadingStopped(),this.emit(wr.LifecycleEvent,r),r.emit(Or.LifecycleEvent,void 0))},vT=function(t,r){if(r.frame.parentId&&P(this,at,ST).call(this,t,r.frame.id,r.frame.parentId),c(this,xu).has(r.frame.id)?c(this,xu).delete(r.frame.id):P(this,at,xT).call(this,r.frame,"Navigation"),!!r.childFrames)for(const s of r.childFrames)P(this,at,vT).call(this,t,s)},ST=function(t,r,s){let i=this.frame(r);if(i){const a=this.frame(s);t&&a&&i.client!==(a==null?void 0:a.client)&&i.updateClient(t);return}i=new yO(this,r,s,t),this._frameTree.addFrame(i),this.emit(wr.FrameAttached,i)},xT=async function(t,r){const s=t.id,i=!t.parentId;let a=this._frameTree.getById(s);if(a)for(const o of a.childFrames())P(this,at,uf).call(this,o);i&&(a?(this._frameTree.removeFrame(a),a._id=s):a=new yO(this,s,void 0,c(this,ps)),this._frameTree.addFrame(a)),a=await this._frameTree.waitForFrame(s),a._navigated(t),this.emit(wr.FrameNavigated,a),a.emit(Or.FrameNavigated,r)},VU=async function(t,r){const s=`${t.id()}:${r}`;c(this,Uy).has(s)||(await t.send("Page.addScriptToEvaluateOnNewDocument",{source:`//# sourceURL=${Rn.INTERNAL_URL}`,worldName:r}),await Promise.all(this.frames().filter(i=>i.client===t).map(i=>t.send("Page.createIsolatedWorld",{frameId:i._id,worldName:r,grantUniveralAccess:!0}).catch(_e))),c(this,Uy).add(s))},GU=function(t,r){const s=this.frame(t);s&&(s._navigatedWithinDocument(r),this.emit(wr.FrameNavigatedWithinDocument,s),s.emit(Or.FrameNavigatedWithinDocument,void 0),this.emit(wr.FrameNavigated,s),s.emit(Or.FrameNavigated,"Navigation"))},ZU=function(t,r){const s=this.frame(t);if(s)switch(r){case"remove":P(this,at,uf).call(this,s);break;case"swap":this.emit(wr.FrameSwapped,s),s.emit(Or.FrameSwapped,void 0);break}},JU=function(t,r){const s=t.auxData,i=s&&s.frameId,a=typeof i=="string"?this.frame(i):void 0;let o;if(a){if(a.client!==r)return;t.auxData&&t.auxData.isDefault?o=a.worlds[ui]:t.name===TI&&(o=a.worlds[Bb])}if(!o)return;const u=new mO((a==null?void 0:a.client)||c(this,ps),t,o);o.setContext(u)},uf=function(t){for(const r of t.childFrames())P(this,at,uf).call(this,r);t[Me](),this._frameTree.removeFrame(t),this.emit(wr.FrameDetached,t),t.emit(Or.FrameDetached,t)};/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const _O={0:{keyCode:48,key:"0",code:"Digit0"},1:{keyCode:49,key:"1",code:"Digit1"},2:{keyCode:50,key:"2",code:"Digit2"},3:{keyCode:51,key:"3",code:"Digit3"},4:{keyCode:52,key:"4",code:"Digit4"},5:{keyCode:53,key:"5",code:"Digit5"},6:{keyCode:54,key:"6",code:"Digit6"},7:{keyCode:55,key:"7",code:"Digit7"},8:{keyCode:56,key:"8",code:"Digit8"},9:{keyCode:57,key:"9",code:"Digit9"},Power:{key:"Power",code:"Power"},Eject:{key:"Eject",code:"Eject"},Abort:{keyCode:3,code:"Abort",key:"Cancel"},Help:{keyCode:6,code:"Help",key:"Help"},Backspace:{keyCode:8,code:"Backspace",key:"Backspace"},Tab:{keyCode:9,code:"Tab",key:"Tab"},Numpad5:{keyCode:12,shiftKeyCode:101,key:"Clear",code:"Numpad5",shiftKey:"5",location:3},NumpadEnter:{keyCode:13,code:"NumpadEnter",key:"Enter",text:"\r",location:3},Enter:{keyCode:13,code:"Enter",key:"Enter",text:"\r"},"\r":{keyCode:13,code:"Enter",key:"Enter",text:"\r"},"\n":{keyCode:13,code:"Enter",key:"Enter",text:"\r"},ShiftLeft:{keyCode:16,code:"ShiftLeft",key:"Shift",location:1},ShiftRight:{keyCode:16,code:"ShiftRight",key:"Shift",location:2},ControlLeft:{keyCode:17,code:"ControlLeft",key:"Control",location:1},ControlRight:{keyCode:17,code:"ControlRight",key:"Control",location:2},AltLeft:{keyCode:18,code:"AltLeft",key:"Alt",location:1},AltRight:{keyCode:18,code:"AltRight",key:"Alt",location:2},Pause:{keyCode:19,code:"Pause",key:"Pause"},CapsLock:{keyCode:20,code:"CapsLock",key:"CapsLock"},Escape:{keyCode:27,code:"Escape",key:"Escape"},Convert:{keyCode:28,code:"Convert",key:"Convert"},NonConvert:{keyCode:29,code:"NonConvert",key:"NonConvert"},Space:{keyCode:32,code:"Space",key:" "},Numpad9:{keyCode:33,shiftKeyCode:105,key:"PageUp",code:"Numpad9",shiftKey:"9",location:3},PageUp:{keyCode:33,code:"PageUp",key:"PageUp"},Numpad3:{keyCode:34,shiftKeyCode:99,key:"PageDown",code:"Numpad3",shiftKey:"3",location:3},PageDown:{keyCode:34,code:"PageDown",key:"PageDown"},End:{keyCode:35,code:"End",key:"End"},Numpad1:{keyCode:35,shiftKeyCode:97,key:"End",code:"Numpad1",shiftKey:"1",location:3},Home:{keyCode:36,code:"Home",key:"Home"},Numpad7:{keyCode:36,shiftKeyCode:103,key:"Home",code:"Numpad7",shiftKey:"7",location:3},ArrowLeft:{keyCode:37,code:"ArrowLeft",key:"ArrowLeft"},Numpad4:{keyCode:37,shiftKeyCode:100,key:"ArrowLeft",code:"Numpad4",shiftKey:"4",location:3},Numpad8:{keyCode:38,shiftKeyCode:104,key:"ArrowUp",code:"Numpad8",shiftKey:"8",location:3},ArrowUp:{keyCode:38,code:"ArrowUp",key:"ArrowUp"},ArrowRight:{keyCode:39,code:"ArrowRight",key:"ArrowRight"},Numpad6:{keyCode:39,shiftKeyCode:102,key:"ArrowRight",code:"Numpad6",shiftKey:"6",location:3},Numpad2:{keyCode:40,shiftKeyCode:98,key:"ArrowDown",code:"Numpad2",shiftKey:"2",location:3},ArrowDown:{keyCode:40,code:"ArrowDown",key:"ArrowDown"},Select:{keyCode:41,code:"Select",key:"Select"},Open:{keyCode:43,code:"Open",key:"Execute"},PrintScreen:{keyCode:44,code:"PrintScreen",key:"PrintScreen"},Insert:{keyCode:45,code:"Insert",key:"Insert"},Numpad0:{keyCode:45,shiftKeyCode:96,key:"Insert",code:"Numpad0",shiftKey:"0",location:3},Delete:{keyCode:46,code:"Delete",key:"Delete"},NumpadDecimal:{keyCode:46,shiftKeyCode:110,code:"NumpadDecimal",key:"\0",shiftKey:".",location:3},Digit0:{keyCode:48,code:"Digit0",shiftKey:")",key:"0"},Digit1:{keyCode:49,code:"Digit1",shiftKey:"!",key:"1"},Digit2:{keyCode:50,code:"Digit2",shiftKey:"@",key:"2"},Digit3:{keyCode:51,code:"Digit3",shiftKey:"#",key:"3"},Digit4:{keyCode:52,code:"Digit4",shiftKey:"$",key:"4"},Digit5:{keyCode:53,code:"Digit5",shiftKey:"%",key:"5"},Digit6:{keyCode:54,code:"Digit6",shiftKey:"^",key:"6"},Digit7:{keyCode:55,code:"Digit7",shiftKey:"&",key:"7"},Digit8:{keyCode:56,code:"Digit8",shiftKey:"*",key:"8"},Digit9:{keyCode:57,code:"Digit9",shiftKey:"(",key:"9"},KeyA:{keyCode:65,code:"KeyA",shiftKey:"A",key:"a"},KeyB:{keyCode:66,code:"KeyB",shiftKey:"B",key:"b"},KeyC:{keyCode:67,code:"KeyC",shiftKey:"C",key:"c"},KeyD:{keyCode:68,code:"KeyD",shiftKey:"D",key:"d"},KeyE:{keyCode:69,code:"KeyE",shiftKey:"E",key:"e"},KeyF:{keyCode:70,code:"KeyF",shiftKey:"F",key:"f"},KeyG:{keyCode:71,code:"KeyG",shiftKey:"G",key:"g"},KeyH:{keyCode:72,code:"KeyH",shiftKey:"H",key:"h"},KeyI:{keyCode:73,code:"KeyI",shiftKey:"I",key:"i"},KeyJ:{keyCode:74,code:"KeyJ",shiftKey:"J",key:"j"},KeyK:{keyCode:75,code:"KeyK",shiftKey:"K",key:"k"},KeyL:{keyCode:76,code:"KeyL",shiftKey:"L",key:"l"},KeyM:{keyCode:77,code:"KeyM",shiftKey:"M",key:"m"},KeyN:{keyCode:78,code:"KeyN",shiftKey:"N",key:"n"},KeyO:{keyCode:79,code:"KeyO",shiftKey:"O",key:"o"},KeyP:{keyCode:80,code:"KeyP",shiftKey:"P",key:"p"},KeyQ:{keyCode:81,code:"KeyQ",shiftKey:"Q",key:"q"},KeyR:{keyCode:82,code:"KeyR",shiftKey:"R",key:"r"},KeyS:{keyCode:83,code:"KeyS",shiftKey:"S",key:"s"},KeyT:{keyCode:84,code:"KeyT",shiftKey:"T",key:"t"},KeyU:{keyCode:85,code:"KeyU",shiftKey:"U",key:"u"},KeyV:{keyCode:86,code:"KeyV",shiftKey:"V",key:"v"},KeyW:{keyCode:87,code:"KeyW",shiftKey:"W",key:"w"},KeyX:{keyCode:88,code:"KeyX",shiftKey:"X",key:"x"},KeyY:{keyCode:89,code:"KeyY",shiftKey:"Y",key:"y"},KeyZ:{keyCode:90,code:"KeyZ",shiftKey:"Z",key:"z"},MetaLeft:{keyCode:91,code:"MetaLeft",key:"Meta",location:1},MetaRight:{keyCode:92,code:"MetaRight",key:"Meta",location:2},ContextMenu:{keyCode:93,code:"ContextMenu",key:"ContextMenu"},NumpadMultiply:{keyCode:106,code:"NumpadMultiply",key:"*",location:3},NumpadAdd:{keyCode:107,code:"NumpadAdd",key:"+",location:3},NumpadSubtract:{keyCode:109,code:"NumpadSubtract",key:"-",location:3},NumpadDivide:{keyCode:111,code:"NumpadDivide",key:"/",location:3},F1:{keyCode:112,code:"F1",key:"F1"},F2:{keyCode:113,code:"F2",key:"F2"},F3:{keyCode:114,code:"F3",key:"F3"},F4:{keyCode:115,code:"F4",key:"F4"},F5:{keyCode:116,code:"F5",key:"F5"},F6:{keyCode:117,code:"F6",key:"F6"},F7:{keyCode:118,code:"F7",key:"F7"},F8:{keyCode:119,code:"F8",key:"F8"},F9:{keyCode:120,code:"F9",key:"F9"},F10:{keyCode:121,code:"F10",key:"F10"},F11:{keyCode:122,code:"F11",key:"F11"},F12:{keyCode:123,code:"F12",key:"F12"},F13:{keyCode:124,code:"F13",key:"F13"},F14:{keyCode:125,code:"F14",key:"F14"},F15:{keyCode:126,code:"F15",key:"F15"},F16:{keyCode:127,code:"F16",key:"F16"},F17:{keyCode:128,code:"F17",key:"F17"},F18:{keyCode:129,code:"F18",key:"F18"},F19:{keyCode:130,code:"F19",key:"F19"},F20:{keyCode:131,code:"F20",key:"F20"},F21:{keyCode:132,code:"F21",key:"F21"},F22:{keyCode:133,code:"F22",key:"F22"},F23:{keyCode:134,code:"F23",key:"F23"},F24:{keyCode:135,code:"F24",key:"F24"},NumLock:{keyCode:144,code:"NumLock",key:"NumLock"},ScrollLock:{keyCode:145,code:"ScrollLock",key:"ScrollLock"},AudioVolumeMute:{keyCode:173,code:"AudioVolumeMute",key:"AudioVolumeMute"},AudioVolumeDown:{keyCode:174,code:"AudioVolumeDown",key:"AudioVolumeDown"},AudioVolumeUp:{keyCode:175,code:"AudioVolumeUp",key:"AudioVolumeUp"},MediaTrackNext:{keyCode:176,code:"MediaTrackNext",key:"MediaTrackNext"},MediaTrackPrevious:{keyCode:177,code:"MediaTrackPrevious",key:"MediaTrackPrevious"},MediaStop:{keyCode:178,code:"MediaStop",key:"MediaStop"},MediaPlayPause:{keyCode:179,code:"MediaPlayPause",key:"MediaPlayPause"},Semicolon:{keyCode:186,code:"Semicolon",shiftKey:":",key:";"},Equal:{keyCode:187,code:"Equal",shiftKey:"+",key:"="},NumpadEqual:{keyCode:187,code:"NumpadEqual",key:"=",location:3},Comma:{keyCode:188,code:"Comma",shiftKey:"<",key:","},Minus:{keyCode:189,code:"Minus",shiftKey:"_",key:"-"},Period:{keyCode:190,code:"Period",shiftKey:">",key:"."},Slash:{keyCode:191,code:"Slash",shiftKey:"?",key:"/"},Backquote:{keyCode:192,code:"Backquote",shiftKey:"~",key:"`"},BracketLeft:{keyCode:219,code:"BracketLeft",shiftKey:"{",key:"["},Backslash:{keyCode:220,code:"Backslash",shiftKey:"|",key:"\\"},BracketRight:{keyCode:221,code:"BracketRight",shiftKey:"}",key:"]"},Quote:{keyCode:222,code:"Quote",shiftKey:'"',key:"'"},AltGraph:{keyCode:225,code:"AltGraph",key:"AltGraph"},Props:{keyCode:247,code:"Props",key:"CrSel"},Cancel:{keyCode:3,key:"Cancel",code:"Abort"},Clear:{keyCode:12,key:"Clear",code:"Numpad5",location:3},Shift:{keyCode:16,key:"Shift",code:"ShiftLeft",location:1},Control:{keyCode:17,key:"Control",code:"ControlLeft",location:1},Alt:{keyCode:18,key:"Alt",code:"AltLeft",location:1},Accept:{keyCode:30,key:"Accept"},ModeChange:{keyCode:31,key:"ModeChange"}," ":{keyCode:32,key:" ",code:"Space"},Print:{keyCode:42,key:"Print"},Execute:{keyCode:43,key:"Execute",code:"Open"},"\0":{keyCode:46,key:"\0",code:"NumpadDecimal",location:3},a:{keyCode:65,key:"a",code:"KeyA"},b:{keyCode:66,key:"b",code:"KeyB"},c:{keyCode:67,key:"c",code:"KeyC"},d:{keyCode:68,key:"d",code:"KeyD"},e:{keyCode:69,key:"e",code:"KeyE"},f:{keyCode:70,key:"f",code:"KeyF"},g:{keyCode:71,key:"g",code:"KeyG"},h:{keyCode:72,key:"h",code:"KeyH"},i:{keyCode:73,key:"i",code:"KeyI"},j:{keyCode:74,key:"j",code:"KeyJ"},k:{keyCode:75,key:"k",code:"KeyK"},l:{keyCode:76,key:"l",code:"KeyL"},m:{keyCode:77,key:"m",code:"KeyM"},n:{keyCode:78,key:"n",code:"KeyN"},o:{keyCode:79,key:"o",code:"KeyO"},p:{keyCode:80,key:"p",code:"KeyP"},q:{keyCode:81,key:"q",code:"KeyQ"},r:{keyCode:82,key:"r",code:"KeyR"},s:{keyCode:83,key:"s",code:"KeyS"},t:{keyCode:84,key:"t",code:"KeyT"},u:{keyCode:85,key:"u",code:"KeyU"},v:{keyCode:86,key:"v",code:"KeyV"},w:{keyCode:87,key:"w",code:"KeyW"},x:{keyCode:88,key:"x",code:"KeyX"},y:{keyCode:89,key:"y",code:"KeyY"},z:{keyCode:90,key:"z",code:"KeyZ"},Meta:{keyCode:91,key:"Meta",code:"MetaLeft",location:1},"*":{keyCode:106,key:"*",code:"NumpadMultiply",location:3},"+":{keyCode:107,key:"+",code:"NumpadAdd",location:3},"-":{keyCode:109,key:"-",code:"NumpadSubtract",location:3},"/":{keyCode:111,key:"/",code:"NumpadDivide",location:3},";":{keyCode:186,key:";",code:"Semicolon"},"=":{keyCode:187,key:"=",code:"Equal"},",":{keyCode:188,key:",",code:"Comma"},".":{keyCode:190,key:".",code:"Period"},"`":{keyCode:192,key:"`",code:"Backquote"},"[":{keyCode:219,key:"[",code:"BracketLeft"},"\\":{keyCode:220,key:"\\",code:"Backslash"},"]":{keyCode:221,key:"]",code:"BracketRight"},"'":{keyCode:222,key:"'",code:"Quote"},Attn:{keyCode:246,key:"Attn"},CrSel:{keyCode:247,key:"CrSel",code:"Props"},ExSel:{keyCode:248,key:"ExSel"},EraseEof:{keyCode:249,key:"EraseEof"},Play:{keyCode:250,key:"Play"},ZoomOut:{keyCode:251,key:"ZoomOut"},")":{keyCode:48,key:")",code:"Digit0"},"!":{keyCode:49,key:"!",code:"Digit1"},"@":{keyCode:50,key:"@",code:"Digit2"},"#":{keyCode:51,key:"#",code:"Digit3"},$:{keyCode:52,key:"$",code:"Digit4"},"%":{keyCode:53,key:"%",code:"Digit5"},"^":{keyCode:54,key:"^",code:"Digit6"},"&":{keyCode:55,key:"&",code:"Digit7"},"(":{keyCode:57,key:"(",code:"Digit9"},A:{keyCode:65,key:"A",code:"KeyA"},B:{keyCode:66,key:"B",code:"KeyB"},C:{keyCode:67,key:"C",code:"KeyC"},D:{keyCode:68,key:"D",code:"KeyD"},E:{keyCode:69,key:"E",code:"KeyE"},F:{keyCode:70,key:"F",code:"KeyF"},G:{keyCode:71,key:"G",code:"KeyG"},H:{keyCode:72,key:"H",code:"KeyH"},I:{keyCode:73,key:"I",code:"KeyI"},J:{keyCode:74,key:"J",code:"KeyJ"},K:{keyCode:75,key:"K",code:"KeyK"},L:{keyCode:76,key:"L",code:"KeyL"},M:{keyCode:77,key:"M",code:"KeyM"},N:{keyCode:78,key:"N",code:"KeyN"},O:{keyCode:79,key:"O",code:"KeyO"},P:{keyCode:80,key:"P",code:"KeyP"},Q:{keyCode:81,key:"Q",code:"KeyQ"},R:{keyCode:82,key:"R",code:"KeyR"},S:{keyCode:83,key:"S",code:"KeyS"},T:{keyCode:84,key:"T",code:"KeyT"},U:{keyCode:85,key:"U",code:"KeyU"},V:{keyCode:86,key:"V",code:"KeyV"},W:{keyCode:87,key:"W",code:"KeyW"},X:{keyCode:88,key:"X",code:"KeyX"},Y:{keyCode:89,key:"Y",code:"KeyY"},Z:{keyCode:90,key:"Z",code:"KeyZ"},":":{keyCode:186,key:":",code:"Semicolon"},"<":{keyCode:188,key:"<",code:"Comma"},_:{keyCode:189,key:"_",code:"Minus"},">":{keyCode:190,key:">",code:"Period"},"?":{keyCode:191,key:"?",code:"Slash"},"~":{keyCode:192,key:"~",code:"Backquote"},"{":{keyCode:219,key:"{",code:"BracketLeft"},"|":{keyCode:220,key:"|",code:"Backslash"},"}":{keyCode:221,key:"}",code:"BracketRight"},'"':{keyCode:222,key:'"',code:"Quote"},SoftLeft:{key:"SoftLeft",code:"SoftLeft",location:4},SoftRight:{key:"SoftRight",code:"SoftRight",location:4},Camera:{keyCode:44,key:"Camera",code:"Camera",location:4},Call:{key:"Call",code:"Call",location:4},EndCall:{keyCode:95,key:"EndCall",code:"EndCall",location:4},VolumeDown:{keyCode:182,key:"VolumeDown",code:"VolumeDown",location:4},VolumeUp:{keyCode:183,key:"VolumeUp",code:"VolumeUp",location:4}};/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class cH extends ZI{constructor(t){super();b(this,Lo);b(this,jo);b(this,Th,new Set);Z(this,"_modifiers",0);x(this,jo,t)}updateClient(t){x(this,jo,t)}async down(t,r={text:void 0,commands:[]}){const s=P(this,Lo,kT).call(this,t),i=c(this,Th).has(s.code);c(this,Th).add(s.code),this._modifiers|=P(this,Lo,ET).call(this,s.key);const a=r.text===void 0?s.text:r.text;await c(this,jo).send("Input.dispatchKeyEvent",{type:a?"keyDown":"rawKeyDown",modifiers:this._modifiers,windowsVirtualKeyCode:s.keyCode,code:s.code,key:s.key,text:a,unmodifiedText:a,autoRepeat:i,location:s.location,isKeypad:s.location===3,commands:r.commands})}async up(t){const r=P(this,Lo,kT).call(this,t);this._modifiers&=~P(this,Lo,ET).call(this,r.key),c(this,Th).delete(r.code),await c(this,jo).send("Input.dispatchKeyEvent",{type:"keyUp",modifiers:this._modifiers,key:r.key,windowsVirtualKeyCode:r.keyCode,code:r.code,location:r.location})}async sendCharacter(t){await c(this,jo).send("Input.insertText",{text:t})}charIsKey(t){return!!_O[t]}async type(t,r={}){const s=r.delay||void 0;for(const i of t)this.charIsKey(i)?await this.press(i,{delay:s}):(s&&await new Promise(a=>setTimeout(a,s)),await this.sendCharacter(i))}async press(t,r={}){const{delay:s=null}=r;await this.down(t,r),s&&await new Promise(i=>setTimeout(i,r.delay)),await this.up(t)}}jo=new WeakMap,Th=new WeakMap,Lo=new WeakSet,ET=function(t){return t==="Alt"?1:t==="Control"?2:t==="Meta"?4:t==="Shift"?8:0},kT=function(t){const r=this._modifiers&8,s={key:"",keyCode:0,code:"",text:"",location:0},i=_O[t];return se(i,`Unknown key: "${t}"`),i.key&&(s.key=i.key),r&&i.shiftKey&&(s.key=i.shiftKey),i.keyCode&&(s.keyCode=i.keyCode),r&&i.shiftKeyCode&&(s.keyCode=i.shiftKeyCode),i.code&&(s.code=i.code),i.location&&(s.location=i.location),s.key.length===1&&(s.text=s.key),i.text&&(s.text=i.text),r&&i.shiftText&&(s.text=i.shiftText),this._modifiers&-9&&(s.text=""),s};const vO=n=>{switch(n){case Lt.Left:return 1;case Lt.Right:return 2;case Lt.Middle:return 4;case Lt.Back:return 8;case Lt.Forward:return 16}},uH=n=>n&1?Lt.Left:n&2?Lt.Right:n&4?Lt.Middle:n&8?Lt.Back:n&16?Lt.Forward:"none";class lH extends JI{constructor(t,r){super();b(this,Gt);b(this,Zn);b(this,Xs);b(this,Ih,{position:{x:0,y:0},buttons:0});b(this,Eu,[]);x(this,Zn,t),x(this,Xs,r)}updateClient(t){x(this,Zn,t)}async reset(){const t=[];for(const[r,s]of[[1,Lt.Left],[4,Lt.Middle],[2,Lt.Right],[16,Lt.Forward],[8,Lt.Back]])c(this,Gt,Yn).buttons&r&&t.push(this.up({button:s}));(c(this,Gt,Yn).position.x!==0||c(this,Gt,Yn).position.y!==0)&&t.push(this.move(0,0)),await Promise.all(t)}async move(t,r,s={}){const{steps:i=1}=s,a=c(this,Gt,Yn).position,o={x:t,y:r};for(let u=1;u<=i;u++)await P(this,Gt,Z0).call(this,l=>{l({position:{x:a.x+(o.x-a.x)*(u/i),y:a.y+(o.y-a.y)*(u/i)}});const{buttons:d,position:h}=c(this,Gt,Yn);return c(this,Zn).send("Input.dispatchMouseEvent",{type:"mouseMoved",modifiers:c(this,Xs)._modifiers,buttons:d,button:uH(d),...h})})}async down(t={}){const{button:r=Lt.Left,clickCount:s=1}=t,i=vO(r);if(!i)throw new Error(`Unsupported mouse button: ${r}`);if(c(this,Gt,Yn).buttons&i)throw new Error(`'${r}' is already pressed.`);await P(this,Gt,Z0).call(this,a=>{a({buttons:c(this,Gt,Yn).buttons|i});const{buttons:o,position:u}=c(this,Gt,Yn);return c(this,Zn).send("Input.dispatchMouseEvent",{type:"mousePressed",modifiers:c(this,Xs)._modifiers,clickCount:s,buttons:o,button:r,...u})})}async up(t={}){const{button:r=Lt.Left,clickCount:s=1}=t,i=vO(r);if(!i)throw new Error(`Unsupported mouse button: ${r}`);if(!(c(this,Gt,Yn).buttons&i))throw new Error(`'${r}' is not pressed.`);await P(this,Gt,Z0).call(this,a=>{a({buttons:c(this,Gt,Yn).buttons&~i});const{buttons:o,position:u}=c(this,Gt,Yn);return c(this,Zn).send("Input.dispatchMouseEvent",{type:"mouseReleased",modifiers:c(this,Xs)._modifiers,clickCount:s,buttons:o,button:r,...u})})}async click(t,r,s={}){const{delay:i,count:a=1,clickCount:o=a}=s;if(a<1)throw new Error("Click must occur a positive number of times.");const u=[this.move(t,r)];if(o===a)for(let l=1;l<a;++l)u.push(this.down({...s,clickCount:l}),this.up({...s,clickCount:l}));u.push(this.down({...s,clickCount:o})),typeof i=="number"&&(await Promise.all(u),u.length=0,await new Promise(l=>{setTimeout(l,i)})),u.push(this.up({...s,clickCount:o})),await Promise.all(u)}async wheel(t={}){const{deltaX:r=0,deltaY:s=0}=t,{position:i,buttons:a}=c(this,Gt,Yn);await c(this,Zn).send("Input.dispatchMouseEvent",{type:"mouseWheel",pointerType:"mouse",modifiers:c(this,Xs)._modifiers,deltaY:s,deltaX:r,buttons:a,...i})}async drag(t,r){const s=new Promise(i=>{c(this,Zn).once("Input.dragIntercepted",a=>i(a.data))});return await this.move(t.x,t.y),await this.down(),await this.move(r.x,r.y),await s}async dragEnter(t,r){await c(this,Zn).send("Input.dispatchDragEvent",{type:"dragEnter",x:t.x,y:t.y,modifiers:c(this,Xs)._modifiers,data:r})}async dragOver(t,r){await c(this,Zn).send("Input.dispatchDragEvent",{type:"dragOver",x:t.x,y:t.y,modifiers:c(this,Xs)._modifiers,data:r})}async drop(t,r){await c(this,Zn).send("Input.dispatchDragEvent",{type:"drop",x:t.x,y:t.y,modifiers:c(this,Xs)._modifiers,data:r})}async dragAndDrop(t,r,s={}){const{delay:i=null}=s,a=await this.drag(t,r);await this.dragEnter(r,a),await this.dragOver(r,a),i&&await new Promise(o=>setTimeout(o,i)),await this.drop(r,a),await this.up()}}Zn=new WeakMap,Xs=new WeakMap,Ih=new WeakMap,Gt=new WeakSet,Yn=function(){return Object.assign({...c(this,Ih)},...c(this,Eu))},Eu=new WeakMap,XU=function(){const t={};c(this,Eu).push(t);const r=()=>{c(this,Eu).splice(c(this,Eu).indexOf(t),1)};return{update:s=>{Object.assign(t,s)},commit:()=>{x(this,Ih,{...c(this,Ih),...t}),r()},rollback:r}},Z0=async function(t){const{update:r,commit:s,rollback:i}=P(this,Gt,XU).call(this);try{await t(r),s()}catch(a){throw i(),a}};class dH{constructor(e,t,r,s){b(this,Ky,!1);b(this,Hy);b(this,ba);b(this,Fo);b(this,ku);x(this,Fo,e),x(this,Hy,t),x(this,ku,r),x(this,ba,s)}updateClient(e){x(this,Fo,e)}async start(){if(c(this,Ky))throw new bb("Touch has already started");await c(this,Fo).send("Input.dispatchTouchEvent",{type:"touchStart",touchPoints:[c(this,ba)],modifiers:c(this,ku)._modifiers}),x(this,Ky,!0)}move(e,t){return c(this,ba).x=Math.round(e),c(this,ba).y=Math.round(t),c(this,Fo).send("Input.dispatchTouchEvent",{type:"touchMove",touchPoints:[c(this,ba)],modifiers:c(this,ku)._modifiers})}async end(){await c(this,Fo).send("Input.dispatchTouchEvent",{type:"touchEnd",touchPoints:[c(this,ba)],modifiers:c(this,ku)._modifiers}),c(this,Hy).removeHandle(this)}}Ky=new WeakMap,Hy=new WeakMap,ba=new WeakMap,Fo=new WeakMap,ku=new WeakMap;class hH extends XI{constructor(t,r){super();b(this,Oh);b(this,Wy);x(this,Oh,t),x(this,Wy,r)}updateClient(t){x(this,Oh,t),this.touches.forEach(r=>{r.updateClient(t)})}async touchStart(t,r){const s=this.idGenerator(),i={x:Math.round(t),y:Math.round(r),radiusX:.5,radiusY:.5,force:.5,id:s},a=new dH(c(this,Oh),this,c(this,Wy),i);return await a.start(),this.touches.push(a),a}}Oh=new WeakMap,Wy=new WeakMap;class SO{constructor(e){b(this,_a);b(this,Rh,!1);b(this,zy);x(this,_a,e)}updateClient(e){x(this,_a,e)}async start(e={}){se(!c(this,Rh),"Cannot start recording trace while already recording trace.");const t=["-*","devtools.timeline","v8.execute","disabled-by-default-devtools.timeline","disabled-by-default-devtools.timeline.frame","toplevel","blink.console","blink.user_timing","latencyInfo","disabled-by-default-devtools.timeline.stack","disabled-by-default-v8.cpu_profiler"],{path:r,screenshots:s=!1,categories:i=t}=e;s&&i.push("disabled-by-default-devtools.screenshot");const a=i.filter(u=>u.startsWith("-")).map(u=>u.slice(1)),o=i.filter(u=>!u.startsWith("-"));x(this,zy,r),x(this,Rh,!0),await c(this,_a).send("Tracing.start",{transferMode:"ReturnAsStream",traceConfig:{excludedCategories:a,includedCategories:o}})}async stop(){const e=Mt.create();return c(this,_a).once("Tracing.tracingComplete",async t=>{try{se(t.stream,'Missing "stream"');const r=await AI(c(this,_a),t.stream),s=await PI(r,c(this,zy));e.resolve(s??void 0)}catch(r){es(r)?e.reject(r):e.reject(new Error(`Unknown error: ${r}`))}}),await c(this,_a).send("Tracing.end"),x(this,Rh,!1),await e.valueOrThrow()}}_a=new WeakMap,Rh=new WeakMap,zy=new WeakMap;class xO extends sO{constructor(t,r,s,i,a,o){super(r);b(this,Ri);b(this,va);b(this,Vy);b(this,Gy);x(this,Vy,s),x(this,va,t),x(this,Gy,i),x(this,Ri,new nx(this,new XS)),c(this,va).once("Runtime.executionContextCreated",async u=>{c(this,Ri).setContext(new mO(t,u.context,c(this,Ri)))}),c(this,Ri).emitter.on("consoleapicalled",async u=>{try{return a(u.type,u.args.map(l=>new Fb(c(this,Ri),l)),u.stackTrace)}catch(l){_e(l)}}),c(this,va).on("Runtime.exceptionThrown",o),c(this,va).once(jt.Disconnected,()=>{c(this,Ri).dispose()}),c(this,va).send("Runtime.enable").catch(_e)}mainRealm(){return c(this,Ri)}get client(){return c(this,va)}async close(){var t,r;switch(c(this,Gy)){case Rr.SERVICE_WORKER:case Rr.SHARED_WORKER:{await((t=this.client.connection())==null?void 0:t.send("Target.closeTarget",{targetId:c(this,Vy)})),await((r=this.client.connection())==null?void 0:r.send("Target.detachFromTarget",{sessionId:this.client.id()}));break}default:await this.evaluate(()=>{self.close()})}}}Ri=new WeakMap,va=new WeakMap,Vy=new WeakMap,Gy=new WeakMap;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var ax=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},ox=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});function cx(n){switch(n){case"warning":return"warn";default:return n}}const IA=class IA extends eO{constructor(t,r){super();b(this,We);b(this,Zy,!1);b(this,Do);b(this,pt);b(this,Ys);b(this,Bo);b(this,Cu);b(this,Uo);b(this,Mh);b(this,Nh);b(this,$t);b(this,er);b(this,$h);b(this,qo,new Map);b(this,jh,new Map);b(this,Lh);b(this,Fh);b(this,Pu,new Map);b(this,Sa,new Set);b(this,I0,Mt.create());b(this,Jy,!1);b(this,Xy,!1);b(this,Yy,t=>{var i;const r=(i=t._session())==null?void 0:i.id(),s=c(this,Pu).get(r);s&&(c(this,Pu).delete(r),this.emit("workerdestroyed",s))});b(this,Dh,t=>{if(se(t instanceof ll),c(this,$t).onAttachedToTarget(t._target()),t._target()._getTargetInfo().type==="worker"){const r=new xO(t,t._target().url(),t._target()._targetId,t._target().type(),P(this,We,TT).bind(this),P(this,We,AT).bind(this));c(this,Pu).set(t.id(),r),this.emit("workercreated",r)}t.on(jt.Ready,c(this,Dh))});x(this,pt,t),x(this,Bo,t.parentSession()),se(c(this,Bo),"Tab target session is not defined."),x(this,Cu,c(this,Bo)._target()),se(c(this,Cu),"Tab target is not defined."),x(this,Ys,r),x(this,Do,r._targetManager()),x(this,Uo,new cH(t)),x(this,Mh,new lH(t,c(this,Uo))),x(this,Nh,new hH(t,c(this,Uo))),x(this,$t,new oH(t,this,this._timeoutSettings)),x(this,er,new uO(t)),x(this,$h,new SO(t)),x(this,Lh,new oO(t)),x(this,Fh,null);const s=new xe(c(this,$t));s.on(wr.FrameAttached,a=>{this.emit("frameattached",a)}),s.on(wr.FrameDetached,a=>{this.emit("framedetached",a)}),s.on(wr.FrameNavigated,a=>{this.emit("framenavigated",a)}),s.on(wr.ConsoleApiCalled,([a,o])=>{P(this,We,a3).call(this,a,o)}),s.on(wr.BindingCalled,([a,o])=>{P(this,We,o3).call(this,a,o)});const i=new xe(c(this,$t).networkManager);i.on(yr.Request,a=>{this.emit("request",a)}),i.on(yr.RequestServedFromCache,a=>{this.emit("requestservedfromcache",a)}),i.on(yr.Response,a=>{this.emit("response",a)}),i.on(yr.RequestFailed,a=>{this.emit("requestfailed",a)}),i.on(yr.RequestFinished,a=>{this.emit("requestfinished",a)}),c(this,Bo).on(jt.Swapped,P(this,We,QU).bind(this)),c(this,Bo).on(jt.Ready,P(this,We,e3).bind(this)),c(this,Do).on("targetGone",c(this,Yy)),c(this,Cu)._isClosedDeferred.valueOrThrow().then(()=>{c(this,Do).off("targetGone",c(this,Yy)),this.emit("close",void 0),x(this,Zy,!0)}).catch(_e),P(this,We,CT).call(this),P(this,We,YU).call(this)}static async _create(t,r,s){var a;const i=new IA(t,r);if(await P(a=i,We,t3).call(a),s)try{await i.setViewport(s)}catch(o){if(es(o)&&rx(o))_e(o);else throw o}return i}_client(){return c(this,pt)}isServiceWorkerBypassed(){return c(this,Jy)}isDragInterceptionEnabled(){return c(this,Xy)}isJavaScriptEnabled(){return c(this,er).javascriptEnabled}async waitForFileChooser(t={}){const r=c(this,Sa).size===0,{timeout:s=this._timeoutSettings.timeout()}=t,i=Mt.create({message:`Waiting for \`FileChooser\` failed: ${s}ms exceeded`,timeout:s});t.signal&&t.signal.addEventListener("abort",()=>{var o;i.reject((o=t.signal)==null?void 0:o.reason)},{once:!0}),c(this,Sa).add(i);let a;r&&(a=c(this,pt).send("Page.setInterceptFileChooserDialog",{enabled:!0}));try{const[o]=await Promise.all([i.valueOrThrow(),a]);return o}catch(o){throw c(this,Sa).delete(i),o}}async setGeolocation(t){return await c(this,er).setGeolocation(t)}target(){return c(this,Ys)}browser(){return c(this,Ys).browser()}browserContext(){return c(this,Ys).browserContext()}mainFrame(){return c(this,$t).mainFrame()}get keyboard(){return c(this,Uo)}get touchscreen(){return c(this,Nh)}get coverage(){return c(this,Lh)}get tracing(){return c(this,$h)}frames(){return c(this,$t).frames()}workers(){return Array.from(c(this,Pu).values())}async setRequestInterception(t){return await c(this,$t).networkManager.setRequestInterception(t)}async setBypassServiceWorker(t){return x(this,Jy,t),await c(this,pt).send("Network.setBypassServiceWorker",{bypass:t})}async setDragInterception(t){return x(this,Xy,t),await c(this,pt).send("Input.setInterceptDrags",{enabled:t})}async setOfflineMode(t){return await c(this,$t).networkManager.setOfflineMode(t)}async emulateNetworkConditions(t){return await c(this,$t).networkManager.emulateNetworkConditions(t)}setDefaultNavigationTimeout(t){this._timeoutSettings.setDefaultNavigationTimeout(t)}setDefaultTimeout(t){this._timeoutSettings.setDefaultTimeout(t)}getDefaultTimeout(){return this._timeoutSettings.timeout()}getDefaultNavigationTimeout(){return this._timeoutSettings.navigationTimeout()}async queryObjects(t){se(!t.disposed,"Prototype JSHandle is disposed!"),se(t.id,"Prototype JSHandle must not be referencing primitive value");const r=await this.mainFrame().client.send("Runtime.queryObjects",{prototypeObjectId:t.id});return this.mainFrame().mainRealm().createCdpHandle(r.objects)}async cookies(...t){const r=(await c(this,pt).send("Network.getCookies",{urls:t.length?t:[this.url()]})).cookies,s=["sourcePort"],i=a=>{for(const o of s)delete a[o];return a};return r.map(i).map(a=>({...a,partitionKey:a.partitionKey?a.partitionKey.topLevelSite:void 0}))}async deleteCookie(...t){const r=this.url();for(const s of t){const i={...s,partitionKey:ux(s.partitionKey)};if(!s.url&&r.startsWith("http")&&(i.url=r),await c(this,pt).send("Network.deleteCookies",i),r.startsWith("http")&&!i.partitionKey){const a=new URL(r);await c(this,pt).send("Network.deleteCookies",{...i,partitionKey:{topLevelSite:a.origin.replace(`:${a.port}`,""),hasCrossSiteAncestor:!1}})}}}async setCookie(...t){const r=this.url(),s=r.startsWith("http"),i=t.map(a=>{const o=Object.assign({},a);return!o.url&&s&&(o.url=r),se(o.url!=="about:blank",`Blank page can not have cookie "${o.name}"`),se(!String.prototype.startsWith.call(o.url||"","data:"),`Data URL page can not have cookie "${o.name}"`),o});await this.deleteCookie(...i),i.length&&await c(this,pt).send("Network.setCookies",{cookies:i.map(a=>({...a,partitionKey:ux(a.partitionKey)}))})}async exposeFunction(t,r){if(c(this,qo).has(t))throw new Error(`Failed to add page binding with name ${t}: window['${t}'] already exists!`);const s=GK("exposedFun",t);let i;switch(typeof r){case"function":i=new Lb(t,r,s);break;default:i=new Lb(t,r.default,s);break}c(this,qo).set(t,i);const[{identifier:a}]=await Promise.all([c(this,$t).evaluateOnNewDocument(s),c(this,$t).addExposedFunctionBinding(i)]);c(this,jh).set(t,a)}async removeExposedFunction(t){const r=c(this,jh).get(t);if(!r)throw new Error(`Function with name "${t}" does not exist`);const s=c(this,qo).get(t);c(this,jh).delete(t),c(this,qo).delete(t),await Promise.all([c(this,$t).removeScriptToEvaluateOnNewDocument(r),c(this,$t).removeExposedFunctionBinding(s)])}async authenticate(t){return await c(this,$t).networkManager.authenticate(t)}async setExtraHTTPHeaders(t){return await c(this,$t).networkManager.setExtraHTTPHeaders(t)}async setUserAgent(t,r){return await c(this,$t).networkManager.setUserAgent(t,r)}async metrics(){const t=await c(this,pt).send("Performance.getMetrics");return P(this,We,PT).call(this,t.metrics)}async reload(t){const[r]=await Promise.all([this.waitForNavigation({...t,ignoreSameDocumentNavigation:!0}),c(this,pt).send("Page.reload")]);return r}async createCDPSession(){return await this.target().createCDPSession()}async goBack(t={}){return await P(this,We,IT).call(this,-1,t)}async goForward(t={}){return await P(this,We,IT).call(this,1,t)}async bringToFront(){await c(this,pt).send("Page.bringToFront")}async setJavaScriptEnabled(t){return await c(this,er).setJavaScriptEnabled(t)}async setBypassCSP(t){await c(this,pt).send("Page.setBypassCSP",{enabled:t})}async emulateMediaType(t){return await c(this,er).emulateMediaType(t)}async emulateCPUThrottling(t){return await c(this,er).emulateCPUThrottling(t)}async emulateMediaFeatures(t){return await c(this,er).emulateMediaFeatures(t)}async emulateTimezone(t){return await c(this,er).emulateTimezone(t)}async emulateIdleState(t){return await c(this,er).emulateIdleState(t)}async emulateVisionDeficiency(t){return await c(this,er).emulateVisionDeficiency(t)}async setViewport(t){const r=await c(this,er).emulateViewport(t);x(this,Fh,t),r&&await this.reload()}viewport(){return c(this,Fh)}async evaluateOnNewDocument(t,...r){const s=BS(t,...r);return await c(this,$t).evaluateOnNewDocument(s)}async removeScriptToEvaluateOnNewDocument(t){return await c(this,$t).removeScriptToEvaluateOnNewDocument(t)}async setCacheEnabled(t=!0){await c(this,$t).networkManager.setCacheEnabled(t)}async _screenshot(t){const r={stack:[],error:void 0,hasError:!1};try{const{fromSurface:s,omitBackground:i,optimizeForSpeed:a,quality:o,clip:u,type:l,captureBeyondViewport:d}=t,h=ax(r,new gb,!0);i&&(l==="png"||l==="webp")&&(await c(this,er).setTransparentBackgroundColor(),h.defer(async()=>{await c(this,er).resetDefaultBackgroundColor().catch(_e)}));let f=u;if(f&&!d){const m=await this.mainFrame().isolatedRealm().evaluate(()=>{const{height:g,pageLeft:y,pageTop:w,width:S}=window.visualViewport;return{x:y,y:w,height:g,width:S}});f=pH(f,m)}const{data:p}=await c(this,pt).send("Page.captureScreenshot",{format:l,optimizeForSpeed:a,fromSurface:s,...o!==void 0?{quality:Math.round(o)}:{},...f?{clip:{...f,scale:f.scale??1}}:{},captureBeyondViewport:d});return p}catch(s){r.error=s,r.hasError=!0}finally{const s=ox(r);s&&await s}}async createPDFStream(t={}){const{timeout:r=this._timeoutSettings.timeout()}=t,{landscape:s,displayHeaderFooter:i,headerTemplate:a,footerTemplate:o,printBackground:u,scale:l,width:d,height:h,margin:f,pageRanges:p,preferCSSPageSize:m,omitBackground:g,tagged:y,outline:w,waitForFonts:S}=OI(t);g&&await c(this,er).setTransparentBackgroundColor(),S&&await pr(ot(this.mainFrame().isolatedRealm().evaluate(()=>document.fonts.ready)).pipe(Ir(hn(r))));const _=c(this,pt).send("Page.printToPDF",{transferMode:"ReturnAsStream",landscape:s,displayHeaderFooter:i,headerTemplate:a,footerTemplate:o,printBackground:u,scale:l,paperWidth:d,paperHeight:h,marginTop:f.top,marginBottom:f.bottom,marginLeft:f.left,marginRight:f.right,pageRanges:p,preferCSSPageSize:m,generateTaggedPDF:y,generateDocumentOutline:w}),v=await pr(ot(_).pipe(Ir(hn(r))));return g&&await c(this,er).resetDefaultBackgroundColor(),se(v.stream,"`stream` is missing from `Page.printToPDF"),await AI(c(this,pt),v.stream)}async pdf(t={}){const{path:r=void 0}=t,s=await this.createPDFStream(t),i=await PI(s,r);return se(i,"Could not create typed array"),i}async close(t={runBeforeUnload:void 0}){const r={stack:[],error:void 0,hasError:!1};try{const s=ax(r,await this.browserContext().waitForScreenshotOperations(),!1),i=c(this,pt).connection();se(i,"Protocol error: Connection closed. Most likely the page has been closed."),!!t.runBeforeUnload?await c(this,pt).send("Page.close"):(await i.send("Target.closeTarget",{targetId:c(this,Ys)._targetId}),await c(this,Cu)._isClosedDeferred.valueOrThrow())}catch(s){r.error=s,r.hasError=!0}finally{ox(r)}}isClosed(){return c(this,Zy)}get mouse(){return c(this,Mh)}async waitForDevicePrompt(t={}){return await this.mainFrame().waitForDevicePrompt(t)}};Zy=new WeakMap,Do=new WeakMap,pt=new WeakMap,Ys=new WeakMap,Bo=new WeakMap,Cu=new WeakMap,Uo=new WeakMap,Mh=new WeakMap,Nh=new WeakMap,$t=new WeakMap,er=new WeakMap,$h=new WeakMap,qo=new WeakMap,jh=new WeakMap,Lh=new WeakMap,Fh=new WeakMap,Pu=new WeakMap,Sa=new WeakMap,I0=new WeakMap,Jy=new WeakMap,Xy=new WeakMap,We=new WeakSet,YU=function(){const t=[];for(const s of c(this,Do).getChildTargets(c(this,Ys)))t.push(s);let r=0;for(;r<t.length;){const s=t[r];r++;const i=s._session();i&&c(this,Dh).call(this,i);for(const a of c(this,Do).getChildTargets(s))t.push(a)}},QU=async function(t){x(this,pt,t),se(c(this,pt)instanceof ll,"CDPSession is not instance of CDPSessionImpl"),x(this,Ys,c(this,pt)._target()),se(c(this,Ys),"Missing target on swap"),c(this,Uo).updateClient(t),c(this,Mh).updateClient(t),c(this,Nh).updateClient(t),c(this,er).updateClient(t),c(this,$h).updateClient(t),c(this,Lh).updateClient(t),await c(this,$t).swapFrameTree(t),P(this,We,CT).call(this)},e3=async function(t){se(t instanceof ll),t._target()._subtype()==="prerender"&&(c(this,$t).registerSpeculativeSession(t).catch(_e),c(this,er).registerSpeculativeSession(t).catch(_e))},CT=function(){const t=new xe(c(this,pt));t.on(jt.Ready,c(this,Dh)),t.on(jt.Disconnected,()=>{c(this,I0).reject(new gs("Target closed"))}),t.on("Page.domContentEventFired",()=>{this.emit("domcontentloaded",void 0)}),t.on("Page.loadEventFired",()=>{this.emit("load",void 0)}),t.on("Page.javascriptDialogOpening",P(this,We,c3).bind(this)),t.on("Runtime.exceptionThrown",P(this,We,AT).bind(this)),t.on("Inspector.targetCrashed",P(this,We,n3).bind(this)),t.on("Performance.metrics",P(this,We,i3).bind(this)),t.on("Log.entryAdded",P(this,We,s3).bind(this)),t.on("Page.fileChooserOpened",P(this,We,r3).bind(this))},Yy=new WeakMap,Dh=new WeakMap,t3=async function(){try{await Promise.all([c(this,$t).initialize(c(this,pt)),c(this,pt).send("Performance.enable"),c(this,pt).send("Log.enable")])}catch(t){if(es(t)&&rx(t))_e(t);else throw t}},r3=async function(t){const r={stack:[],error:void 0,hasError:!1};try{if(!c(this,Sa).size)return;const s=c(this,$t).frame(t.frameId);se(s,"This should never happen.");const i=ax(r,await s.worlds[ui].adoptBackendNode(t.backendNodeId),!1),a=new $K(i.move(),t);for(const o of c(this,Sa))o.resolve(a);c(this,Sa).clear()}catch(s){r.error=s,r.hasError=!0}finally{ox(r)}},n3=function(){this.emit("error",new Error("Page crashed!"))},s3=function(t){const{level:r,text:s,args:i,source:a,url:o,lineNumber:u}=t.entry;i&&i.map(l=>{fO(c(this,pt),l)}),a!=="worker"&&this.emit("console",new ex(cx(r),s,[],[{url:o,lineNumber:u}]))},i3=function(t){this.emit("metrics",{title:t.title,metrics:P(this,We,PT).call(this,t.metrics)})},PT=function(t){const r={};for(const s of t||[])fH.has(s.name)&&(r[s.name]=s.value);return r},AT=function(t){this.emit("pageerror",VK(t.exceptionDetails))},a3=function(t,r){const s=r.args.map(i=>t.createCdpHandle(i));P(this,We,TT).call(this,cx(r.type),s,r.stackTrace)},o3=async function(t,r){let s;try{s=JSON.parse(r.payload)}catch{return}const{type:i,name:a,seq:o,args:u,isTrivial:l}=s;if(i!=="exposedFun")return;const d=t.context;if(!d)return;const h=c(this,qo).get(a);await(h==null?void 0:h.run(d,o,u,l))},TT=function(t,r,s){if(!this.listenerCount("console")){r.forEach(u=>u.dispose());return}const i=[];for(const u of r){const l=u.remoteObject();l.objectId?i.push(u.toString()):i.push(cc(l))}const a=[];if(s)for(const u of s.callFrames)a.push({url:u.url,lineNumber:u.lineNumber,columnNumber:u.columnNumber});const o=new ex(cx(t),i.join(" "),r,a);this.emit("console",o)},c3=function(t){const r=q5(t.type),s=new UK(c(this,pt),r,t.message,t.defaultPrompt);this.emit("dialog",s)},IT=async function(t,r){const s=await c(this,pt).send("Page.getNavigationHistory"),i=s.entries[s.currentIndex+t];return i?(await Promise.all([this.waitForNavigation(r),c(this,pt).send("Page.navigateToHistoryEntry",{entryId:i.id})]))[0]:null};let Tf=IA;const fH=new Set(["Timestamp","Documents","Frames","JSEventListeners","Nodes","LayoutCount","RecalcStyleCount","LayoutDuration","RecalcStyleDuration","ScriptDuration","TaskDuration","JSHeapUsedSize","JSHeapTotalSize"]);function pH(n,e){const t=Math.max(n.x,e.x),r=Math.max(n.y,e.y);return{x:t,y:r,width:Math.max(Math.min(n.x+n.width,e.x+e.width)-t,0),height:Math.max(Math.min(n.y+n.height,e.y+e.height)-r,0)}}function ux(n){if(n!==void 0)return typeof n=="string"?{topLevelSite:n,hasCrossSiteAncestor:!1}:{topLevelSite:n.sourceOrigin,hasCrossSiteAncestor:n.hasCrossSiteAncestor??!1}}/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var mH=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},gH=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});class lx extends MI{constructor(t,r,s){super();b(this,xa);b(this,Ea);b(this,Jn);x(this,xa,t),x(this,Ea,r),x(this,Jn,s)}get id(){return c(this,Jn)}targets(){return c(this,Ea).targets().filter(t=>t.browserContext()===this)}async pages(){return(await Promise.all(this.targets().filter(r=>{var s;return r.type()==="page"||r.type()==="other"&&((s=c(this,Ea)._getIsPageTargetCallback())==null?void 0:s(r))}).map(r=>r.page()))).filter(r=>!!r)}async overridePermissions(t,r){const s=r.map(i=>{const a=qS.get(i);if(!a)throw new Error("Unknown permission: "+i);return a});await c(this,xa).send("Browser.grantPermissions",{origin:t,browserContextId:c(this,Jn)||void 0,permissions:s})}async clearPermissionOverrides(){await c(this,xa).send("Browser.resetPermissions",{browserContextId:c(this,Jn)||void 0})}async newPage(){const t={stack:[],error:void 0,hasError:!1};try{const r=mH(t,await this.waitForScreenshotOperations(),!1);return await c(this,Ea)._createPageInContext(c(this,Jn))}catch(r){t.error=r,t.hasError=!0}finally{gH(t)}}browser(){return c(this,Ea)}async close(){se(c(this,Jn),"Default BrowserContext cannot be closed!"),await c(this,Ea)._disposeContext(c(this,Jn))}async cookies(){const{cookies:t}=await c(this,xa).send("Storage.getCookies",{browserContextId:c(this,Jn)});return t.map(r=>({...r,partitionKey:r.partitionKey?{sourceOrigin:r.partitionKey.topLevelSite,hasCrossSiteAncestor:r.partitionKey.hasCrossSiteAncestor}:void 0}))}async setCookie(...t){return await c(this,xa).send("Storage.setCookies",{browserContextId:c(this,Jn),cookies:t.map(r=>({...r,partitionKey:ux(r.partitionKey)}))})}async setDownloadBehavior(t){await c(this,xa).send("Browser.setDownloadBehavior",{behavior:t.policy,downloadPath:t.downloadPath,browserContextId:c(this,Jn)})}}xa=new WeakMap,Ea=new WeakMap,Jn=new WeakMap;/**
 * @license
 * Copyright 2019 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var ts;(function(n){n.SUCCESS="success",n.ABORTED="aborted"})(ts||(ts={}));let Ub=(KB=class extends Af{constructor(t,r,s,i,a){super();b(this,Ko);b(this,Ho);b(this,Mi);b(this,Bh);b(this,Wo);b(this,Uh,new Set);Z(this,"_initializedDeferred",Mt.create());Z(this,"_isClosedDeferred",Mt.create());Z(this,"_targetId");x(this,Ho,r),x(this,Bh,i),x(this,Mi,t),x(this,Ko,s),this._targetId=t.targetId,x(this,Wo,a),c(this,Ho)&&c(this,Ho)instanceof ll&&c(this,Ho)._setTarget(this)}async asPage(){const t=this._session();return t?await Tf._create(t,this,null):await this.createCDPSession().then(r=>Tf._create(r,this,null))}_subtype(){return c(this,Mi).subtype}_session(){return c(this,Ho)}_addChildTarget(t){c(this,Uh).add(t)}_removeChildTarget(t){c(this,Uh).delete(t)}_childTargets(){return c(this,Uh)}_sessionFactory(){if(!c(this,Wo))throw new Error("sessionFactory is not initialized");return c(this,Wo)}createCDPSession(){if(!c(this,Wo))throw new Error("sessionFactory is not initialized");return c(this,Wo).call(this,!1).then(t=>(t._setTarget(this),t))}url(){return c(this,Mi).url}type(){switch(c(this,Mi).type){case"page":return Rr.PAGE;case"background_page":return Rr.BACKGROUND_PAGE;case"service_worker":return Rr.SERVICE_WORKER;case"shared_worker":return Rr.SHARED_WORKER;case"browser":return Rr.BROWSER;case"webview":return Rr.WEBVIEW;case"tab":return Rr.TAB;default:return Rr.OTHER}}_targetManager(){if(!c(this,Bh))throw new Error("targetManager is not initialized");return c(this,Bh)}_getTargetInfo(){return c(this,Mi)}browser(){if(!c(this,Ko))throw new Error("browserContext is not initialized");return c(this,Ko).browser()}browserContext(){if(!c(this,Ko))throw new Error("browserContext is not initialized");return c(this,Ko)}opener(){const{openerId:t}=c(this,Mi);if(t)return this.browser().targets().find(r=>r._targetId===t)}_targetInfoChanged(t){x(this,Mi,t),this._checkIfInitialized()}_initialize(){this._initializedDeferred.resolve(ts.SUCCESS)}_isTargetExposed(){return this.type()!==Rr.TAB&&!this._subtype()}_checkIfInitialized(){this._initializedDeferred.resolved()||this._initializedDeferred.resolve(ts.SUCCESS)}},Ko=new WeakMap,Ho=new WeakMap,Mi=new WeakMap,Bh=new WeakMap,Wo=new WeakMap,Uh=new WeakMap,KB);const OA=class OA extends Ub{constructor(t,r,s,i,a,o){super(t,r,s,i,a);b(this,Qy);Z(this,"pagePromise");x(this,Qy,o??void 0)}_initialize(){this._initializedDeferred.valueOrThrow().then(async t=>{if(t===ts.ABORTED)return;const r=this.opener();if(!(r instanceof OA))return;if(!r||!r.pagePromise||this.type()!=="page")return!0;const s=await r.pagePromise;if(!s.listenerCount("popup"))return!0;const i=await this.page();return s.emit("popup",i),!0}).catch(_e),this._checkIfInitialized()}async page(){if(!this.pagePromise){const t=this._session();this.pagePromise=(t?Promise.resolve(t):this._sessionFactory()(!1)).then(r=>Tf._create(r,this,c(this,Qy)??null))}return await this.pagePromise??null}_checkIfInitialized(){this._initializedDeferred.resolved()||this._getTargetInfo().url!==""&&this._initializedDeferred.resolve(ts.SUCCESS)}};Qy=new WeakMap;let qb=OA;class yH extends qb{}class wH extends Ub{constructor(){super(...arguments);b(this,qh)}async worker(){if(!c(this,qh)){const t=this._session();x(this,qh,(t?Promise.resolve(t):this._sessionFactory()(!1)).then(r=>new xO(r,this._getTargetInfo().url,this._targetId,this.type(),()=>{},()=>{})))}return await c(this,qh)}}qh=new WeakMap;class bH extends Ub{}/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */function _H(n,e){return!!n._subtype()&&!e.subtype}class vH extends xe{constructor(t,r,s,i=!0){super();b(this,In);b(this,xr);b(this,zo,new Map);b(this,Er,new Map);b(this,Au,new Map);b(this,ew,new Set);b(this,Vo);b(this,Tu);b(this,Iu,new WeakMap);b(this,Go,new WeakMap);b(this,tw,Mt.create());b(this,Ou,new Set);b(this,rw,!0);b(this,Kh,[{}]);b(this,O0,()=>{if(c(this,rw))for(const[t,r]of c(this,zo).entries()){const s=new Ub(r,void 0,void 0,this,void 0),i=r.type==="page"||r.type==="iframe",a=r.url.startsWith("chrome-extension://");(!c(this,Vo)||c(this,Vo).call(this,s))&&i&&!a&&c(this,Ou).add(t)}});b(this,nw,t=>{P(this,In,RT).call(this,t)});b(this,sw,async t=>{if(c(this,zo).set(t.targetInfo.targetId,t.targetInfo),this.emit("targetDiscovered",t.targetInfo),t.targetInfo.type==="browser"&&t.targetInfo.attached){if(c(this,Er).has(t.targetInfo.targetId))return;const r=c(this,Tu).call(this,t.targetInfo,void 0);r._initialize(),c(this,Er).set(t.targetInfo.targetId,r)}});b(this,iw,t=>{const r=c(this,zo).get(t.targetId);if(c(this,zo).delete(t.targetId),P(this,In,lf).call(this,t.targetId),(r==null?void 0:r.type)==="service_worker"&&c(this,Er).has(t.targetId)){const s=c(this,Er).get(t.targetId);s&&(this.emit("targetGone",s),c(this,Er).delete(t.targetId))}});b(this,aw,t=>{var a;if(c(this,zo).set(t.targetInfo.targetId,t.targetInfo),c(this,ew).has(t.targetInfo.targetId)||!c(this,Er).has(t.targetInfo.targetId)||!t.targetInfo.attached)return;const r=c(this,Er).get(t.targetInfo.targetId);if(!r)return;const s=r.url(),i=r._initializedDeferred.value()===ts.SUCCESS;if(_H(r,t.targetInfo)){const o=r==null?void 0:r._session();se(o,"Target that is being activated is missing a CDPSession."),(a=o.parentSession())==null||a.emit(jt.Swapped,o)}r._targetInfoChanged(t.targetInfo),i&&s!==r.url()&&this.emit("targetChanged",{target:r,wasInitialized:i,previousURL:s})});b(this,R0,async(t,r)=>{const s=r.targetInfo,i=c(this,xr).session(r.sessionId);if(!i)throw new Error(`Session ${r.sessionId} was not created.`);const a=async()=>{await i.send("Runtime.runIfWaitingForDebugger").catch(_e),await t.send("Target.detachFromTarget",{sessionId:i.id()}).catch(_e)};if(!c(this,xr).isAutoAttached(s.targetId))return;if(s.type==="service_worker"){if(P(this,In,lf).call(this,s.targetId),await a(),c(this,Er).has(s.targetId))return;const d=c(this,Tu).call(this,s);d._initialize(),c(this,Er).set(s.targetId,d),this.emit("targetAvailable",d);return}const o=c(this,Er).has(s.targetId),u=o?c(this,Er).get(s.targetId):c(this,Tu).call(this,s,i,t instanceof xf?t:void 0);if(c(this,Vo)&&!c(this,Vo).call(this,u)){c(this,ew).add(s.targetId),P(this,In,lf).call(this,s.targetId),await a();return}P(this,In,OT).call(this,i),o?(i._setTarget(u),c(this,Au).set(i.id(),c(this,Er).get(s.targetId))):(u._initialize(),c(this,Er).set(s.targetId,u),c(this,Au).set(i.id(),u));const l=t instanceof xf?t._target():null;l==null||l._addChildTarget(u),t.emit(jt.Ready,i),c(this,Ou).delete(u._targetId),o||this.emit("targetAvailable",u),P(this,In,lf).call(this),await Promise.all([i.send("Target.setAutoAttach",{waitForDebuggerOnStart:!0,flatten:!0,autoAttach:!0,filter:c(this,Kh)}),i.send("Runtime.runIfWaitingForDebugger")]).catch(_e)});b(this,M0,(t,r)=>{const s=c(this,Au).get(r.sessionId);c(this,Au).delete(r.sessionId),s&&(t instanceof xf&&t._target()._removeChildTarget(s),c(this,Er).delete(s._targetId),this.emit("targetGone",s))});x(this,xr,t),x(this,Vo,s),x(this,Tu,r),x(this,rw,i),c(this,xr).on("Target.targetCreated",c(this,sw)),c(this,xr).on("Target.targetDestroyed",c(this,iw)),c(this,xr).on("Target.targetInfoChanged",c(this,aw)),c(this,xr).on(jt.SessionDetached,c(this,nw)),P(this,In,OT).call(this,c(this,xr))}async initialize(){await c(this,xr).send("Target.setDiscoverTargets",{discover:!0,filter:c(this,Kh)}),c(this,O0).call(this),await c(this,xr).send("Target.setAutoAttach",{waitForDebuggerOnStart:!0,flatten:!0,autoAttach:!0,filter:[{type:"page",exclude:!0},...c(this,Kh)]}),P(this,In,lf).call(this),await c(this,tw).valueOrThrow()}getChildTargets(t){return t._childTargets()}dispose(){c(this,xr).off("Target.targetCreated",c(this,sw)),c(this,xr).off("Target.targetDestroyed",c(this,iw)),c(this,xr).off("Target.targetInfoChanged",c(this,aw)),c(this,xr).off(jt.SessionDetached,c(this,nw)),P(this,In,RT).call(this,c(this,xr))}getAvailableTargets(){return c(this,Er)}}xr=new WeakMap,zo=new WeakMap,Er=new WeakMap,Au=new WeakMap,ew=new WeakMap,Vo=new WeakMap,Tu=new WeakMap,Iu=new WeakMap,Go=new WeakMap,tw=new WeakMap,Ou=new WeakMap,rw=new WeakMap,Kh=new WeakMap,O0=new WeakMap,In=new WeakSet,OT=function(t){const r=i=>{c(this,R0).call(this,t,i)};se(!c(this,Iu).has(t)),c(this,Iu).set(t,r),t.on("Target.attachedToTarget",r);const s=i=>c(this,M0).call(this,t,i);se(!c(this,Go).has(t)),c(this,Go).set(t,s),t.on("Target.detachedFromTarget",s)},RT=function(t){const r=c(this,Iu).get(t);r&&(t.off("Target.attachedToTarget",r),c(this,Iu).delete(t)),c(this,Go).has(t)&&(t.off("Target.detachedFromTarget",c(this,Go).get(t)),c(this,Go).delete(t))},nw=new WeakMap,sw=new WeakMap,iw=new WeakMap,aw=new WeakMap,R0=new WeakMap,lf=function(t){t!==void 0&&c(this,Ou).delete(t),c(this,Ou).size===0&&c(this,tw).resolve()},M0=new WeakMap;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const RA=class RA extends RI{constructor(t,r,s,i,a,o,u,l=!0){super();b(this,Ru);Z(this,"protocol","cdp");b(this,Hh);b(this,ow);b(this,kr);b(this,cw);b(this,uw);b(this,Wh);b(this,ka);b(this,Ca,new Map);b(this,tr);b(this,lw,()=>{this.emit("disconnected",void 0)});b(this,N0,(t,r)=>{var u;const{browserContextId:s}=t,i=s&&c(this,Ca).has(s)?c(this,Ca).get(s):c(this,ka);if(!i)throw new Error("Missing browser context");const a=l=>c(this,kr)._createSession(t,l),o=new bH(t,r,i,c(this,tr),a);return(u=t.url)!=null&&u.startsWith("devtools://")?new yH(t,r,i,c(this,tr),a,c(this,Hh)??null):c(this,Wh).call(this,o)?new qb(t,r,i,c(this,tr),a,c(this,Hh)??null):t.type==="service_worker"||t.type==="shared_worker"?new wH(t,r,i,c(this,tr),a):o});b(this,dw,async t=>{t._isTargetExposed()&&await t._initializedDeferred.valueOrThrow()===ts.SUCCESS&&(this.emit("targetcreated",t),t.browserContext().emit("targetcreated",t))});b(this,hw,async t=>{t._initializedDeferred.resolve(ts.ABORTED),t._isClosedDeferred.resolve(),t._isTargetExposed()&&await t._initializedDeferred.valueOrThrow()===ts.SUCCESS&&(this.emit("targetdestroyed",t),t.browserContext().emit("targetdestroyed",t))});b(this,fw,({target:t})=>{this.emit("targetchanged",t),t.browserContext().emit("targetchanged",t)});b(this,pw,t=>{this.emit("targetdiscovered",t)});x(this,Hh,s),x(this,ow,i),x(this,kr,t),x(this,cw,a||(()=>{})),x(this,uw,o||(()=>!0)),P(this,Ru,u3).call(this,u),x(this,tr,new vH(t,c(this,N0),c(this,uw),l)),x(this,ka,new lx(c(this,kr),this));for(const d of r)c(this,Ca).set(d,new lx(c(this,kr),this,d))}static async _create(t,r,s,i,a,o,u,l,d,h=!0){const f=new RA(t,r,i,o,u,l,d,h);return s&&await t.send("Security.setIgnoreCertificateErrors",{ignore:!0}),await f._attach(a),f}async _attach(t){c(this,kr).on(jt.Disconnected,c(this,lw)),t&&await c(this,ka).setDownloadBehavior(t),c(this,tr).on("targetAvailable",c(this,dw)),c(this,tr).on("targetGone",c(this,hw)),c(this,tr).on("targetChanged",c(this,fw)),c(this,tr).on("targetDiscovered",c(this,pw)),await c(this,tr).initialize()}_detach(){c(this,kr).off(jt.Disconnected,c(this,lw)),c(this,tr).off("targetAvailable",c(this,dw)),c(this,tr).off("targetGone",c(this,hw)),c(this,tr).off("targetChanged",c(this,fw)),c(this,tr).off("targetDiscovered",c(this,pw))}process(){return c(this,ow)??null}_targetManager(){return c(this,tr)}_getIsPageTargetCallback(){return c(this,Wh)}async createBrowserContext(t={}){const{proxyServer:r,proxyBypassList:s,downloadBehavior:i}=t,{browserContextId:a}=await c(this,kr).send("Target.createBrowserContext",{proxyServer:r,proxyBypassList:s&&s.join(",")}),o=new lx(c(this,kr),this,a);return i&&await o.setDownloadBehavior(i),c(this,Ca).set(a,o),o}browserContexts(){return[c(this,ka),...Array.from(c(this,Ca).values())]}defaultBrowserContext(){return c(this,ka)}async _disposeContext(t){t&&(await c(this,kr).send("Target.disposeBrowserContext",{browserContextId:t}),c(this,Ca).delete(t))}wsEndpoint(){return c(this,kr).url()}async newPage(){return await c(this,ka).newPage()}async _createPageInContext(t){const{targetId:r}=await c(this,kr).send("Target.createTarget",{url:"about:blank",browserContextId:t||void 0}),s=await this.waitForTarget(o=>o._targetId===r);if(!s)throw new Error(`Missing target for page (id = ${r})`);if(!(await s._initializedDeferred.valueOrThrow()===ts.SUCCESS))throw new Error(`Failed to create target for page (id = ${r})`);const a=await s.page();if(!a)throw new Error(`Failed to create a page for context (id = ${t})`);return a}targets(){return Array.from(c(this,tr).getAvailableTargets().values()).filter(t=>t._isTargetExposed()&&t._initializedDeferred.value()===ts.SUCCESS)}target(){const t=this.targets().find(r=>r.type()==="browser");if(!t)throw new Error("Browser target is not found");return t}async version(){return(await P(this,Ru,MT).call(this)).product}async userAgent(){return(await P(this,Ru,MT).call(this)).userAgent}async close(){await c(this,cw).call(null),await this.disconnect()}disconnect(){return c(this,tr).dispose(),c(this,kr).dispose(),this._detach(),Promise.resolve()}get connected(){return!c(this,kr)._closed}get debugInfo(){return{pendingProtocolErrors:c(this,kr).getPendingProtocolErrors()}}};Hh=new WeakMap,ow=new WeakMap,kr=new WeakMap,cw=new WeakMap,uw=new WeakMap,Wh=new WeakMap,ka=new WeakMap,Ca=new WeakMap,tr=new WeakMap,lw=new WeakMap,Ru=new WeakSet,u3=function(t){x(this,Wh,t||(r=>r.type()==="page"||r.type()==="background_page"||r.type()==="webview"))},N0=new WeakMap,dw=new WeakMap,hw=new WeakMap,fw=new WeakMap,pw=new WeakMap,MT=function(){return c(this,kr).send("Browser.getVersion")};let dx=RA;/**
 * @license
 * Copyright 2020 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */async function SH(n,e,t){const{acceptInsecureCerts:r=!1,defaultViewport:s=kI,downloadBehavior:i,targetFilter:a,_isPageTarget:o,slowMo:u=0,protocolTimeout:l}=t,d=new aO(e,n,u,l),{browserContextIds:h}=await d.send("Target.getBrowserContexts");return await dx._create(d,h,r,s,i,void 0,()=>d.send("Browser.close").catch(_e),a,o)}const EO={targetId:"tabTargetId",type:"tab",title:"tab",url:"about:blank",attached:!1,canAccessOpener:!1},kO={targetId:"pageTargetId",type:"page",title:"page",url:"about:blank",attached:!1,canAccessOpener:!1},MA=class MA{constructor(e){b(this,ln);Z(this,"onmessage");Z(this,"onclose");b(this,Mu);b(this,mw,(e,t,r)=>{e.tabId===c(this,Mu)&&P(this,ln,Qn).call(this,{sessionId:e.sessionId??"pageTargetSessionId",method:t,params:r})});x(this,Mu,e),chrome.debugger.onEvent.addListener(c(this,mw))}static async connectTab(e){return await chrome.debugger.attach({tabId:e},"1.3"),new MA(e)}send(e){const t=JSON.parse(e);switch(t.method){case"Browser.getVersion":{P(this,ln,Qn).call(this,{id:t.id,sessionId:t.sessionId,method:t.method,result:{protocolVersion:"1.3",product:"chrome",revision:"unknown",userAgent:"chrome",jsVersion:"unknown"}});return}case"Target.getBrowserContexts":{P(this,ln,Qn).call(this,{id:t.id,sessionId:t.sessionId,method:t.method,result:{browserContextIds:[]}});return}case"Target.setDiscoverTargets":{P(this,ln,Qn).call(this,{method:"Target.targetCreated",params:{targetInfo:EO}}),P(this,ln,Qn).call(this,{method:"Target.targetCreated",params:{targetInfo:kO}}),P(this,ln,Qn).call(this,{id:t.id,sessionId:t.sessionId,method:t.method,result:{}});return}case"Target.setAutoAttach":if(t.sessionId==="tabTargetSessionId"){P(this,ln,Qn).call(this,{method:"Target.attachedToTarget",params:{targetInfo:kO,sessionId:"pageTargetSessionId"}}),P(this,ln,Qn).call(this,{id:t.id,sessionId:t.sessionId,method:t.method,result:{}});return}else if(!t.sessionId){P(this,ln,Qn).call(this,{method:"Target.attachedToTarget",params:{targetInfo:EO,sessionId:"tabTargetSessionId"}}),P(this,ln,Qn).call(this,{id:t.id,sessionId:t.sessionId,method:t.method,result:{}});return}}t.sessionId==="pageTargetSessionId"&&delete t.sessionId,chrome.debugger.sendCommand({tabId:c(this,Mu),sessionId:t.sessionId},t.method,t.params).then(r=>{P(this,ln,Qn).call(this,{id:t.id,sessionId:t.sessionId??"pageTargetSessionId",method:t.method,result:r})}).catch(r=>{P(this,ln,Qn).call(this,{id:t.id,sessionId:t.sessionId??"pageTargetSessionId",method:t.method,error:{code:r==null?void 0:r.code,data:r==null?void 0:r.data,message:(r==null?void 0:r.message)??"CDP error had no message"}})})}close(){chrome.debugger.onEvent.removeListener(c(this,mw)),chrome.debugger.detach({tabId:c(this,Mu)})}};Mu=new WeakMap,mw=new WeakMap,ln=new WeakSet,Qn=function(e){var t;(t=this.onmessage)==null||t.call(this,JSON.stringify(e))};let hx=MA;const NA=class NA{constructor(e){b(this,Pa);Z(this,"onmessage");Z(this,"onclose");x(this,Pa,e),c(this,Pa).addEventListener("message",t=>{this.onmessage&&this.onmessage.call(null,t.data)}),c(this,Pa).addEventListener("close",()=>{this.onclose&&this.onclose.call(null)}),c(this,Pa).addEventListener("error",()=>{})}static create(e){return new Promise((t,r)=>{const s=new WebSocket(e);s.addEventListener("open",()=>t(new NA(s))),s.addEventListener("error",r)})}send(e){c(this,Pa).send(e)}close(){c(this,Pa).close()}};Pa=new WeakMap;let fx=NA;const xH=Object.freeze(Object.defineProperty({__proto__:null,BrowserWebSocketTransport:fx},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const EH=[{name:"Blackberry PlayBook",userAgent:"Mozilla/5.0 (PlayBook; U; RIM Tablet OS 2.1.0; en-US) AppleWebKit/536.2+ (KHTML like Gecko) Version/7.2.1.0 Safari/536.2+",viewport:{width:600,height:1024,deviceScaleFactor:1,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Blackberry PlayBook landscape",userAgent:"Mozilla/5.0 (PlayBook; U; RIM Tablet OS 2.1.0; en-US) AppleWebKit/536.2+ (KHTML like Gecko) Version/7.2.1.0 Safari/536.2+",viewport:{width:1024,height:600,deviceScaleFactor:1,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"BlackBerry Z30",userAgent:"Mozilla/5.0 (BB10; Touch) AppleWebKit/537.10+ (KHTML, like Gecko) Version/10.0.9.2372 Mobile Safari/537.10+",viewport:{width:360,height:640,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"BlackBerry Z30 landscape",userAgent:"Mozilla/5.0 (BB10; Touch) AppleWebKit/537.10+ (KHTML, like Gecko) Version/10.0.9.2372 Mobile Safari/537.10+",viewport:{width:640,height:360,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Galaxy Note 3",userAgent:"Mozilla/5.0 (Linux; U; Android 4.3; en-us; SM-N900T Build/JSS15J) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",viewport:{width:360,height:640,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Galaxy Note 3 landscape",userAgent:"Mozilla/5.0 (Linux; U; Android 4.3; en-us; SM-N900T Build/JSS15J) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",viewport:{width:640,height:360,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Galaxy Note II",userAgent:"Mozilla/5.0 (Linux; U; Android 4.1; en-us; GT-N7100 Build/JRO03C) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",viewport:{width:360,height:640,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Galaxy Note II landscape",userAgent:"Mozilla/5.0 (Linux; U; Android 4.1; en-us; GT-N7100 Build/JRO03C) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",viewport:{width:640,height:360,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Galaxy S III",userAgent:"Mozilla/5.0 (Linux; U; Android 4.0; en-us; GT-I9300 Build/IMM76D) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",viewport:{width:360,height:640,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Galaxy S III landscape",userAgent:"Mozilla/5.0 (Linux; U; Android 4.0; en-us; GT-I9300 Build/IMM76D) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",viewport:{width:640,height:360,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Galaxy S5",userAgent:"Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:360,height:640,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Galaxy S5 landscape",userAgent:"Mozilla/5.0 (Linux; Android 5.0; SM-G900P Build/LRX21T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:640,height:360,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Galaxy S8",userAgent:"Mozilla/5.0 (Linux; Android 7.0; SM-G950U Build/NRD90M) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.84 Mobile Safari/537.36",viewport:{width:360,height:740,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Galaxy S8 landscape",userAgent:"Mozilla/5.0 (Linux; Android 7.0; SM-G950U Build/NRD90M) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.84 Mobile Safari/537.36",viewport:{width:740,height:360,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Galaxy S9+",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; SM-G965U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.111 Mobile Safari/537.36",viewport:{width:320,height:658,deviceScaleFactor:4.5,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Galaxy S9+ landscape",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; SM-G965U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.111 Mobile Safari/537.36",viewport:{width:658,height:320,deviceScaleFactor:4.5,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Galaxy Tab S4",userAgent:"Mozilla/5.0 (Linux; Android 8.1.0; SM-T837A) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.80 Safari/537.36",viewport:{width:712,height:1138,deviceScaleFactor:2.25,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Galaxy Tab S4 landscape",userAgent:"Mozilla/5.0 (Linux; Android 8.1.0; SM-T837A) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.80 Safari/537.36",viewport:{width:1138,height:712,deviceScaleFactor:2.25,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPad",userAgent:"Mozilla/5.0 (iPad; CPU OS 11_0 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) Version/11.0 Mobile/15A5341f Safari/604.1",viewport:{width:768,height:1024,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPad landscape",userAgent:"Mozilla/5.0 (iPad; CPU OS 11_0 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) Version/11.0 Mobile/15A5341f Safari/604.1",viewport:{width:1024,height:768,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPad (gen 6)",userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:768,height:1024,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPad (gen 6) landscape",userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:1024,height:768,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPad (gen 7)",userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:810,height:1080,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPad (gen 7) landscape",userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:1080,height:810,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPad Mini",userAgent:"Mozilla/5.0 (iPad; CPU OS 11_0 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) Version/11.0 Mobile/15A5341f Safari/604.1",viewport:{width:768,height:1024,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPad Mini landscape",userAgent:"Mozilla/5.0 (iPad; CPU OS 11_0 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) Version/11.0 Mobile/15A5341f Safari/604.1",viewport:{width:1024,height:768,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPad Pro",userAgent:"Mozilla/5.0 (iPad; CPU OS 11_0 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) Version/11.0 Mobile/15A5341f Safari/604.1",viewport:{width:1024,height:1366,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPad Pro landscape",userAgent:"Mozilla/5.0 (iPad; CPU OS 11_0 like Mac OS X) AppleWebKit/604.1.34 (KHTML, like Gecko) Version/11.0 Mobile/15A5341f Safari/604.1",viewport:{width:1366,height:1024,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPad Pro 11",userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:834,height:1194,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPad Pro 11 landscape",userAgent:"Mozilla/5.0 (iPad; CPU OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:1194,height:834,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 4",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 7_1_2 like Mac OS X) AppleWebKit/537.51.2 (KHTML, like Gecko) Version/7.0 Mobile/11D257 Safari/9537.53",viewport:{width:320,height:480,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 4 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 7_1_2 like Mac OS X) AppleWebKit/537.51.2 (KHTML, like Gecko) Version/7.0 Mobile/11D257 Safari/9537.53",viewport:{width:480,height:320,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 5",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.0 Mobile/14E304 Safari/602.1",viewport:{width:320,height:568,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 5 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.0 Mobile/14E304 Safari/602.1",viewport:{width:568,height:320,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 6",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:375,height:667,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 6 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:667,height:375,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 6 Plus",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:414,height:736,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 6 Plus landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:736,height:414,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 7",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:375,height:667,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 7 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:667,height:375,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 7 Plus",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:414,height:736,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 7 Plus landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:736,height:414,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 8",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:375,height:667,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 8 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:667,height:375,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 8 Plus",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:414,height:736,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 8 Plus landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:736,height:414,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone SE",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.0 Mobile/14E304 Safari/602.1",viewport:{width:320,height:568,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone SE landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.0 Mobile/14E304 Safari/602.1",viewport:{width:568,height:320,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone X",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:375,height:812,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone X landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1",viewport:{width:812,height:375,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone XR",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 12_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0 Mobile/15E148 Safari/604.1",viewport:{width:414,height:896,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone XR landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 12_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0 Mobile/15E148 Safari/604.1",viewport:{width:896,height:414,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 11",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1 Mobile/15E148 Safari/604.1",viewport:{width:414,height:828,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 11 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1 Mobile/15E148 Safari/604.1",viewport:{width:828,height:414,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 11 Pro",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1 Mobile/15E148 Safari/604.1",viewport:{width:375,height:812,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 11 Pro landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1 Mobile/15E148 Safari/604.1",viewport:{width:812,height:375,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 11 Pro Max",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1 Mobile/15E148 Safari/604.1",viewport:{width:414,height:896,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 11 Pro Max landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 13_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1 Mobile/15E148 Safari/604.1",viewport:{width:896,height:414,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 12",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:390,height:844,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 12 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:844,height:390,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 12 Pro",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:390,height:844,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 12 Pro landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:844,height:390,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 12 Pro Max",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:428,height:926,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 12 Pro Max landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:926,height:428,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 12 Mini",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:375,height:812,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 12 Mini landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:812,height:375,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 13",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:390,height:844,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 13 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:844,height:390,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 13 Pro",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:390,height:844,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 13 Pro landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:844,height:390,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 13 Pro Max",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:428,height:926,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 13 Pro Max landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:926,height:428,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 13 Mini",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:375,height:812,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 13 Mini landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.4 Mobile/15E148 Safari/604.1",viewport:{width:812,height:375,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 14",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:390,height:663,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 14 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:750,height:340,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 14 Plus",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:428,height:745,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 14 Plus landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:832,height:378,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 14 Pro",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:393,height:659,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 14 Pro landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:734,height:343,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 14 Pro Max",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:430,height:739,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 14 Pro Max landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1",viewport:{width:814,height:380,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 15",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:393,height:659,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 15 landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:734,height:343,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 15 Plus",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:430,height:739,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 15 Plus landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:814,height:380,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 15 Pro",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:393,height:659,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 15 Pro landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:734,height:343,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"iPhone 15 Pro Max",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:430,height:739,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"iPhone 15 Pro Max landscape",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 17_5 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.5 Mobile/15E148 Safari/604.1",viewport:{width:814,height:380,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"JioPhone 2",userAgent:"Mozilla/5.0 (Mobile; LYF/F300B/LYF-F300B-001-01-15-130718-i;Android; rv:48.0) Gecko/48.0 Firefox/48.0 KAIOS/2.5",viewport:{width:240,height:320,deviceScaleFactor:1,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"JioPhone 2 landscape",userAgent:"Mozilla/5.0 (Mobile; LYF/F300B/LYF-F300B-001-01-15-130718-i;Android; rv:48.0) Gecko/48.0 Firefox/48.0 KAIOS/2.5",viewport:{width:320,height:240,deviceScaleFactor:1,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Kindle Fire HDX",userAgent:"Mozilla/5.0 (Linux; U; en-us; KFAPWI Build/JDQ39) AppleWebKit/535.19 (KHTML, like Gecko) Silk/3.13 Safari/535.19 Silk-Accelerated=true",viewport:{width:800,height:1280,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Kindle Fire HDX landscape",userAgent:"Mozilla/5.0 (Linux; U; en-us; KFAPWI Build/JDQ39) AppleWebKit/535.19 (KHTML, like Gecko) Silk/3.13 Safari/535.19 Silk-Accelerated=true",viewport:{width:1280,height:800,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"LG Optimus L70",userAgent:"Mozilla/5.0 (Linux; U; Android 4.4.2; en-us; LGMS323 Build/KOT49I.MS32310c) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:384,height:640,deviceScaleFactor:1.25,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"LG Optimus L70 landscape",userAgent:"Mozilla/5.0 (Linux; U; Android 4.4.2; en-us; LGMS323 Build/KOT49I.MS32310c) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:640,height:384,deviceScaleFactor:1.25,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Microsoft Lumia 550",userAgent:"Mozilla/5.0 (Windows Phone 10.0; Android 4.2.1; Microsoft; Lumia 550) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Mobile Safari/537.36 Edge/14.14263",viewport:{width:640,height:360,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Microsoft Lumia 950",userAgent:"Mozilla/5.0 (Windows Phone 10.0; Android 4.2.1; Microsoft; Lumia 950) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Mobile Safari/537.36 Edge/14.14263",viewport:{width:360,height:640,deviceScaleFactor:4,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Microsoft Lumia 950 landscape",userAgent:"Mozilla/5.0 (Windows Phone 10.0; Android 4.2.1; Microsoft; Lumia 950) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2486.0 Mobile Safari/537.36 Edge/14.14263",viewport:{width:640,height:360,deviceScaleFactor:4,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nexus 10",userAgent:"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 10 Build/MOB31T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Safari/537.36",viewport:{width:800,height:1280,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nexus 10 landscape",userAgent:"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 10 Build/MOB31T) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Safari/537.36",viewport:{width:1280,height:800,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nexus 4",userAgent:"Mozilla/5.0 (Linux; Android 4.4.2; Nexus 4 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:384,height:640,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nexus 4 landscape",userAgent:"Mozilla/5.0 (Linux; Android 4.4.2; Nexus 4 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:640,height:384,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nexus 5",userAgent:"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:360,height:640,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nexus 5 landscape",userAgent:"Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:640,height:360,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nexus 5X",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Nexus 5X Build/OPR4.170623.006) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:412,height:732,deviceScaleFactor:2.625,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nexus 5X landscape",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Nexus 5X Build/OPR4.170623.006) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:732,height:412,deviceScaleFactor:2.625,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nexus 6",userAgent:"Mozilla/5.0 (Linux; Android 7.1.1; Nexus 6 Build/N6F26U) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:412,height:732,deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nexus 6 landscape",userAgent:"Mozilla/5.0 (Linux; Android 7.1.1; Nexus 6 Build/N6F26U) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:732,height:412,deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nexus 6P",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Nexus 6P Build/OPP3.170518.006) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:412,height:732,deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nexus 6P landscape",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Nexus 6P Build/OPP3.170518.006) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:732,height:412,deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nexus 7",userAgent:"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 7 Build/MOB30X) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Safari/537.36",viewport:{width:600,height:960,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nexus 7 landscape",userAgent:"Mozilla/5.0 (Linux; Android 6.0.1; Nexus 7 Build/MOB30X) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Safari/537.36",viewport:{width:960,height:600,deviceScaleFactor:2,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nokia Lumia 520",userAgent:"Mozilla/5.0 (compatible; MSIE 10.0; Windows Phone 8.0; Trident/6.0; IEMobile/10.0; ARM; Touch; NOKIA; Lumia 520)",viewport:{width:320,height:533,deviceScaleFactor:1.5,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nokia Lumia 520 landscape",userAgent:"Mozilla/5.0 (compatible; MSIE 10.0; Windows Phone 8.0; Trident/6.0; IEMobile/10.0; ARM; Touch; NOKIA; Lumia 520)",viewport:{width:533,height:320,deviceScaleFactor:1.5,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Nokia N9",userAgent:"Mozilla/5.0 (MeeGo; NokiaN9) AppleWebKit/534.13 (KHTML, like Gecko) NokiaBrowser/8.5.0 Mobile Safari/534.13",viewport:{width:480,height:854,deviceScaleFactor:1,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Nokia N9 landscape",userAgent:"Mozilla/5.0 (MeeGo; NokiaN9) AppleWebKit/534.13 (KHTML, like Gecko) NokiaBrowser/8.5.0 Mobile Safari/534.13",viewport:{width:854,height:480,deviceScaleFactor:1,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Pixel 2",userAgent:"Mozilla/5.0 (Linux; Android 8.0; Pixel 2 Build/OPD3.170816.012) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:411,height:731,deviceScaleFactor:2.625,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Pixel 2 landscape",userAgent:"Mozilla/5.0 (Linux; Android 8.0; Pixel 2 Build/OPD3.170816.012) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:731,height:411,deviceScaleFactor:2.625,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Pixel 2 XL",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Pixel 2 XL Build/OPD1.170816.004) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:411,height:823,deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Pixel 2 XL landscape",userAgent:"Mozilla/5.0 (Linux; Android 8.0.0; Pixel 2 XL Build/OPD1.170816.004) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3765.0 Mobile Safari/537.36",viewport:{width:823,height:411,deviceScaleFactor:3.5,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Pixel 3",userAgent:"Mozilla/5.0 (Linux; Android 9; Pixel 3 Build/PQ1A.181105.017.A1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.158 Mobile Safari/537.36",viewport:{width:393,height:786,deviceScaleFactor:2.75,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Pixel 3 landscape",userAgent:"Mozilla/5.0 (Linux; Android 9; Pixel 3 Build/PQ1A.181105.017.A1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.158 Mobile Safari/537.36",viewport:{width:786,height:393,deviceScaleFactor:2.75,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Pixel 4",userAgent:"Mozilla/5.0 (Linux; Android 10; Pixel 4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Mobile Safari/537.36",viewport:{width:353,height:745,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Pixel 4 landscape",userAgent:"Mozilla/5.0 (Linux; Android 10; Pixel 4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.138 Mobile Safari/537.36",viewport:{width:745,height:353,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Pixel 4a (5G)",userAgent:"Mozilla/5.0 (Linux; Android 11; Pixel 4a (5G)) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4812.0 Mobile Safari/537.36",viewport:{width:353,height:745,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Pixel 4a (5G) landscape",userAgent:"Mozilla/5.0 (Linux; Android 11; Pixel 4a (5G)) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4812.0 Mobile Safari/537.36",viewport:{width:745,height:353,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Pixel 5",userAgent:"Mozilla/5.0 (Linux; Android 11; Pixel 5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4812.0 Mobile Safari/537.36",viewport:{width:393,height:851,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Pixel 5 landscape",userAgent:"Mozilla/5.0 (Linux; Android 11; Pixel 5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4812.0 Mobile Safari/537.36",viewport:{width:851,height:393,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}},{name:"Moto G4",userAgent:"Mozilla/5.0 (Linux; Android 7.0; Moto G (4)) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4812.0 Mobile Safari/537.36",viewport:{width:360,height:640,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!1}},{name:"Moto G4 landscape",userAgent:"Mozilla/5.0 (Linux; Android 7.0; Moto G (4)) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4812.0 Mobile Safari/537.36",viewport:{width:640,height:360,deviceScaleFactor:3,isMobile:!0,hasTouch:!0,isLandscape:!0}}],CO={};for(const n of EH)CO[n.name]=n;Object.freeze(CO);/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */async function kH(n,e,t){const{acceptInsecureCerts:r=!1,defaultViewport:s=kI}=t,{bidiConnection:i,cdpConnection:a,closeCallback:o}=await CH(n,e,t);return await(await Promise.resolve().then(()=>MB)).BidiBrowser.create({connection:i,cdpConnection:a,closeCallback:o,process:void 0,defaultViewport:s,acceptInsecureCerts:r,capabilities:t.capabilities})}async function CH(n,e,t){const r=await Promise.resolve().then(()=>MB),{slowMo:s=0,protocolTimeout:i}=t,a=new r.BidiConnection(e,n,s,i);try{const d=await a.send("session.status",{});if("type"in d&&d.type==="success")return{bidiConnection:a,closeCallback:async()=>{await a.send("browser.close",{}).catch(_e)}}}catch(d){if(!(d instanceof sc))throw d}a.unbind();const o=new aO(e,n,s,i,!0);if((await o.send("Browser.getVersion")).product.toLowerCase().includes("firefox"))throw new Fe("Firefox is not supported in BiDi over CDP mode.");const l=await r.connectBidiOverCdp(o);return{cdpConnection:o,bidiConnection:l,closeCallback:async()=>{await o.send("Browser.close").catch(_e)}}}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const PO=async()=>vI?(await Promise.resolve().then(()=>gre)).NodeWebSocketTransport:(await Promise.resolve().then(()=>xH)).BrowserWebSocketTransport;async function PH(n){const{connectionTransport:e,endpointUrl:t}=await AH(n);return n.protocol==="webDriverBiDi"?await kH(e,t,n):await SH(e,t,n)}async function AH(n){const{browserWSEndpoint:e,browserURL:t,transport:r,headers:s={}}=n;if(se(+!!e+ +!!t+ +!!r==1,"Exactly one of browserWSEndpoint, browserURL or transport must be passed to puppeteer.connect"),r)return{connectionTransport:r,endpointUrl:""};if(e)return{connectionTransport:await(await PO()).create(e,s),endpointUrl:e};if(t){const i=await TH(t);return{connectionTransport:await(await PO()).create(i),endpointUrl:i}}throw new Error("Invalid connection options")}async function TH(n){const e=new URL("/json/version",n);try{const t=await globalThis.fetch(e.toString(),{method:"GET"});if(!t.ok)throw new Error(`HTTP ${t.statusText}`);return(await t.json()).webSocketDebuggerUrl}catch(t){throw es(t)&&(t.message=`Failed to fetch browser webSocket URL from ${e}: `+t.message),t}}/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class AO{constructor(e){Z(this,"_isPuppeteerCore");Z(this,"_changedBrowsers",!1);this._isPuppeteerCore=e.isPuppeteerCore,this.connect=this.connect.bind(this)}static registerCustomQueryHandler(e,t){return this.customQueryHandlers.register(e,t)}static unregisterCustomQueryHandler(e){return this.customQueryHandlers.unregister(e)}static customQueryHandlerNames(){return this.customQueryHandlers.names()}static clearCustomQueryHandlers(){return this.customQueryHandlers.clear()}connect(e){return PH(e)}}Z(AO,"customQueryHandlers",WS);/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const IH=new AO({isPuppeteerCore:!0}),{connect:OH}=IH,ws=n=>{const e=`[${n}]`;return{debug:(...t)=>{},info:(...t)=>console.info(e,...t),warning:(...t)=>console.warn(e,...t),error:(...t)=>console.error(e,...t),group:t=>console.group(`${e} ${t}`),groupEnd:()=>console.groupEnd()}};class TO{constructor(e,t,r){this.branchPathHash=e,this.attributesHash=t,this.xpathHash=r}}class RH{constructor(e,t,r,s,i,a=!1,o=null,u=null,l=null,d=null){this.tagName=e,this.xpath=t,this.highlightIndex=r,this.entireParentBranchPath=s,this.attributes=i,this.shadowRoot=a,this.cssSelector=o,this.pageCoordinates=u,this.viewportCoordinates=l,this.viewportInfo=d}toDict(){return{tagName:this.tagName,xpath:this.xpath,highlightIndex:this.highlightIndex,entireParentBranchPath:this.entireParentBranchPath,attributes:this.attributes,shadowRoot:this.shadowRoot,cssSelector:this.cssSelector,pageCoordinates:this.pageCoordinates,viewportCoordinates:this.viewportCoordinates,viewportInfo:this.viewportInfo}}}var px;(n=>{function e(h){const f=a(h),p=h.getAdvancedCssSelector();return new RH(h.tagName??"",h.xpath??"",h.highlightIndex??null,f,h.attributes,h.shadowRoot,p,h.pageCoordinates??null,h.viewportCoordinates??null,h.viewportInfo??null)}n.convertDomElementToHistoryElement=e;async function t(h,f){const p=await s(h),m=async g=>{if(g.highlightIndex!==void 0){const y=await i(g);if(y.branchPathHash===p.branchPathHash&&y.attributesHash===p.attributesHash&&y.xpathHash===p.xpathHash)return g}for(const y of g.children)if(y instanceof bs){const w=await m(y);if(w!==null)return w}return null};return m(f)}n.findHistoryElementInTree=t;async function r(h,f){const[p,m]=await Promise.all([s(h),i(f)]);return p.branchPathHash===m.branchPathHash&&p.attributesHash===m.attributesHash&&p.xpathHash===m.xpathHash}n.compareHistoryElementAndDomElement=r;async function s(h){const[f,p,m]=await Promise.all([o(h.entireParentBranchPath),u(h.attributes),l(h.xpath??"")]);return new TO(f,p,m)}async function i(h){const f=a(h),[p,m,g]=await Promise.all([o(f),u(h.attributes),l(h.xpath??"")]);return new TO(p,m,g)}n.hashDomElement=i;function a(h){const f=[];let p=h;for(;p.parent!==null&&p.parent!==void 0;)f.push(p),p=p.parent;return f.reverse(),f.map(m=>m.tagName??"")}n.getParentBranchPath=a;async function o(h){return h.length===0?"":d(h.join("/"))}n.parentBranchPathHash=o;async function u(h){const f=Object.entries(h).map(([p,m])=>`${p}=${m}`).join("");return d(f)}n.hashAttributes=u;async function l(h){return d(h)}n.hashXPath=l;async function d(h){const p=new TextEncoder().encode(h),m=await crypto.subtle.digest("SHA-256",p);return Array.from(new Uint8Array(m)).map(y=>y.toString(16).padStart(2,"0")).join("")}n.createSHA256Hash=d})(px||(px={}));class IO{constructor(e,t){this.isVisible=e,this.parent=t}}class mx extends IO{constructor(e,t,r){super(t,r),this.type="TEXT_NODE",this.text=e}hasParentWithHighlightIndex(){let e=this.parent;for(;e!=null;){if(e.highlightIndex!==void 0)return!0;e=e.parent}return!1}}class bs extends IO{constructor(e){super(e.isVisible,e.parent),this.tagName=e.tagName,this.xpath=e.xpath,this.attributes=e.attributes,this.children=e.children,this.isInteractive=e.isInteractive??!1,this.isTopElement=e.isTopElement??!1,this.shadowRoot=e.shadowRoot??!1,this.highlightIndex=e.highlightIndex,this.viewportCoordinates=e.viewportCoordinates,this.pageCoordinates=e.pageCoordinates,this.viewportInfo=e.viewportInfo}async hash(){return this._hashedValue?this._hashedValue:(this._hashPromise||(this._hashPromise=px.hashDomElement(this).then(e=>(this._hashedValue=e,this._hashPromise=void 0,e)).catch(e=>{this._hashPromise=void 0,console.error("Error computing DOM element hash:",e);const t=new Error(`Failed to hash DOM element (${this.tagName||"unknown"}): ${e.message}`);throw e.stack&&(t.stack=e.stack),t})),this._hashPromise)}clearHashCache(){this._hashedValue=void 0,this._hashPromise=void 0}getAllTextTillNextClickableElement(e=-1){const t=[],r=(s,i)=>{if(!(e!==-1&&i>e)&&!(s instanceof bs&&s!==this&&s.highlightIndex!==void 0)){if(s instanceof mx)t.push(s.text);else if(s instanceof bs)for(const a of s.children)r(a,i+1)}};return r(this,0),t.join(`
`).trim()}clickableElementsToString(e=[]){const t=[],r=(s,i)=>{if(s instanceof bs){if(s.highlightIndex!==void 0){let a="";e.length&&(a=` ${e.map(o=>s.attributes[o]?`${o}="${s.attributes[o]}"`:"").filter(Boolean).join(" ")}`),t.push(`[${s.highlightIndex}]<${s.tagName}${a}>${s.getAllTextTillNextClickableElement()}</${s.tagName}>`)}for(const a of s.children)r(a)}else s instanceof mx&&(s.hasParentWithHighlightIndex()||t.push(`[]${s.text}`))};return r(this),t.join(`
`)}getFileUploadElement(e=!0){if(this.tagName==="input"&&this.attributes.type==="file")return this;for(const t of this.children)if(t instanceof bs){const r=t.getFileUploadElement(!1);if(r)return r}if(e&&this.parent){for(const t of this.parent.children)if(t!==this&&t instanceof bs){const r=t.getFileUploadElement(!1);if(r)return r}}return null}getAdvancedCssSelector(){return this.enhancedCssSelectorForElement()}convertSimpleXPathToCssSelector(e){if(!e)return"";const r=e.replace(/^\//,"").split("/"),s=[];for(const a of r)if(a)if(a.includes("[")){const o=a.indexOf("[");let u=a.substring(0,o);const d=a.substring(o).split("]").slice(0,-1).map(h=>h.replace("[",""));for(const h of d)if(/^\d+$/.test(h))try{const f=Number.parseInt(h,10)-1;u+=`:nth-of-type(${f+1})`}catch{}else h==="last()"?u+=":last-of-type":h.includes("position()")&&h.includes(">1")&&(u+=":nth-of-type(n+2)");s.push(u)}else s.push(a);return s.join(" > ")}enhancedCssSelectorForElement(e=!0){try{if(!this.xpath)return"";let t=this.convertSimpleXPathToCssSelector(this.xpath);if(this.attributes.class&&e){const s=/^[a-zA-Z_][a-zA-Z0-9_-]*$/,i=this.attributes.class.split(/\s+/);for(const a of i)a.trim()&&s.test(a)&&(t+=`.${a}`)}const r=new Set(["id","name","type","value","placeholder","aria-label","aria-labelledby","aria-describedby","role","for","autocomplete","required","readonly","alt","title","src","href","target"]);e&&(r.add("data-id"),r.add("data-qa"),r.add("data-cy"),r.add("data-testid"));for(const[s,i]of Object.entries(this.attributes)){if(s==="class"||!s.trim()||!r.has(s))continue;const a=s.replace(":","\\:");if(i==="")t+=`[${a}]`;else if(/["'<>`\n\r\t]/.test(i)){const u=i.replace(/\s+/g," ").trim().replace(/"/g,'\\"');t+=`[${a}*="${u}"]`}else t+=`[${a}="${i}"]`}return t}catch{return`${this.tagName||"*"}[highlight-index='${this.highlightIndex}']`}}}async function OO(n){return new Set(await Promise.all(Array.from(n.selectorMap.values()).map(async t=>(await t.hash()).branchPathHash)))}const RO=ws("DOMService");async function MH(n){var r;const t=(r=(await chrome.scripting.executeScript({target:{tabId:n},func:()=>{const s=window.scrollY,i=window.innerHeight,a=document.documentElement.scrollHeight;return{pixels_above:s,pixels_below:a-(s+i)}}}))[0])==null?void 0:r.result;if(!t)throw new Error("Failed to get scroll information");return[t.pixels_above,t.pixels_below]}async function NH(n,e){var s;const r=(s=(await chrome.scripting.executeScript({target:{tabId:n},func:i=>window.turn2Markdown(i),args:[e||""]}))[0])==null?void 0:s.result;if(!r)throw new Error("Failed to get markdown content");return r}async function $H(n){var r;const t=(r=(await chrome.scripting.executeScript({target:{tabId:n},func:()=>window.parserReadability()}))[0])==null?void 0:r.result;if(!t)throw new Error("Failed to get readability content");return t}async function jH(n,e=!0,t=-1,r=0){try{const s=await FH(n,e,t,r),i=LH(s);return{elementTree:s,selectorMap:i}}catch(s){return RO.error("Failed to build DOM tree:",s),null}}function LH(n){const e=new Map;function t(r){r instanceof bs&&(r.highlightIndex!=null&&e.set(r.highlightIndex,r),r.children.forEach(t))}return t(n),e}async function FH(n,e=!0,t=-1,r=0){const i=(await chrome.scripting.executeScript({target:{tabId:n},func:a=>window.buildDomTree(a),args:[{doHighlightElements:e,focusHighlightIndex:t,viewportExpansion:r}]}))[0].result;if(i!==null){const a=MO(i);if(a!==null&&a instanceof bs)return a}throw new Error("Failed to build DOM tree: Invalid or empty tree structure")}function MO(n,e=null){if(!n)return null;if("type"in n)return new mx(n.text,n.isVisible,e);const t=n.tagName,r=n.viewportCoordinates,s=n.pageCoordinates,i=n.viewportInfo,a=new bs({tagName:t,xpath:n.xpath,attributes:n.attributes??{},children:[],isVisible:n.isVisible??!1,isInteractive:n.isInteractive??!1,isTopElement:n.isTopElement??!1,highlightIndex:n.highlightIndex,viewportCoordinates:r??void 0,pageCoordinates:s??void 0,viewportInfo:i??void 0,shadowRoot:n.shadowRoot??!1,parent:e}),o=[];for(const u of n.children||[])if(u!==null){const l=MO(u,a);l!==null&&o.push(l)}return a.children=o,a}async function DH(n){try{await chrome.scripting.executeScript({target:{tabId:n},func:()=>{const e=document.getElementById("playwright-highlight-container");e&&e.remove();const t=document.querySelectorAll('[browser-user-highlight-id^="playwright-highlight-"]');for(const r of Array.from(t))r.removeAttribute("browser-user-highlight-id")}})}catch(e){RO.error("Failed to remove highlights:",e)}}const Ge=ws("Page");function Kb(n,e,t){return{elementTree:new bs({tagName:"root",isVisible:!0,parent:null,xpath:"",attributes:{},children:[]}),selectorMap:new Map,tabId:n||0,url:e||"",title:t||"",screenshot:null,pixelsAbove:0,pixelsBelow:0}}let BH=class{constructor(e,t,r,s={}){this._browser=null,this._puppeteerPage=null,this._validWebPage=!1,this._tabId=e,this._config={...U1,...s},this._state=Kb(e,t,r),this._validWebPage=e&&t&&t.startsWith("http")||!1}get tabId(){return this._tabId}get validWebPage(){return this._validWebPage}get attached(){return this._validWebPage&&this._puppeteerPage!==null}async attachPuppeteer(){if(!this._validWebPage)return!1;if(this._puppeteerPage)return!0;Ge.info("attaching puppeteer",this._tabId);const e=await OH({transport:await hx.connectTab(this._tabId),defaultViewport:null,protocol:"cdp"});this._browser=e;const[t]=await e.pages();return this._puppeteerPage=t,await this._addAntiDetectionScripts(),!0}async _addAntiDetectionScripts(){this._puppeteerPage&&await this._puppeteerPage.evaluateOnNewDocument(`
      // Webdriver property
      Object.defineProperty(navigator, 'webdriver', {
        get: () => undefined
      });

      // Languages
      // Object.defineProperty(navigator, 'languages', {
      //   get: () => ['en-US']
      // });

      // Plugins
      // Object.defineProperty(navigator, 'plugins', {
      //   get: () => [1, 2, 3, 4, 5]
      // });

      // Chrome runtime
      window.chrome = { runtime: {} };

      // Permissions
      const originalQuery = window.navigator.permissions.query;
      window.navigator.permissions.query = (parameters) => (
        parameters.name === 'notifications' ?
          Promise.resolve({ state: Notification.permission }) :
          originalQuery(parameters)
      );

      // Shadow DOM
      (function () {
        const originalAttachShadow = Element.prototype.attachShadow;
        Element.prototype.attachShadow = function attachShadow(options) {
          return originalAttachShadow.call(this, { ...options, mode: "open" });
        };
      })();
    `)}async detachPuppeteer(){this._browser&&(await this._browser.disconnect(),this._browser=null,this._puppeteerPage=null,this._state=Kb(this._tabId))}async removeHighlight(){this._config.highlightElements&&this._validWebPage&&await DH(this._tabId)}async getClickableElements(e){return this._validWebPage?jH(this._tabId,this._config.highlightElements,e,this._config.viewportExpansion):null}async getScrollInfo(){return this._validWebPage?MH(this._tabId):[0,0]}async getContent(){if(!this._puppeteerPage)throw new Error("Puppeteer page is not connected");return await this._puppeteerPage.content()}async getMarkdownContent(e){return this._validWebPage?NH(this._tabId,e):""}async getReadabilityContent(){return this._validWebPage?$H(this._tabId):""}async getState(){return this._validWebPage?(await this.waitForPageAndFramesLoad(),await this._updateState()):Kb(this._tabId)}async _updateState(e=!0,t=-1){var r,s,i;try{await this._puppeteerPage.evaluate("1")}catch(a){if(Ge.warning("Current page is no longer accessible:",a),this._browser){const o=await this._browser.pages();if(o.length>0)this._puppeteerPage=o[0];else throw new Error("Browser closed: no valid pages available")}}try{await this.removeHighlight();const a=await this.getClickableElements(t);if(!a)return Ge.warning("Failed to get clickable elements"),this._state;"selectorMap"in a?Ge.debug("content.selectorMap:",a.selectorMap.size):Ge.debug("content.selectorMap: not found"),"elementTree"in a?Ge.debug("content.elementTree:",(r=a.elementTree)==null?void 0:r.tagName):Ge.debug("content.elementTree: not found");const o=e?await this.takeScreenshot():null,[u,l]=await this.getScrollInfo();return this._state.elementTree=a.elementTree,this._state.selectorMap=a.selectorMap,this._state.url=((s=this._puppeteerPage)==null?void 0:s.url())||"",this._state.title=await((i=this._puppeteerPage)==null?void 0:i.title())||"",this._state.screenshot=o,this._state.pixelsAbove=u,this._state.pixelsBelow=l,this._state}catch(a){return Ge.error("Failed to update state:",a),this._state}}async takeScreenshot(e=!1){if(!this._puppeteerPage)throw new Error("Puppeteer page is not connected");try{await this._puppeteerPage.evaluate(()=>{const r="puppeteer-disable-animations";if(!document.getElementById(r)){const s=document.createElement("style");s.id=r,s.textContent=`
            *, *::before, *::after {
              animation: none !important;
              transition: none !important;
            }
          `,document.head.appendChild(s)}});const t=await this._puppeteerPage.screenshot({fullPage:e,encoding:"base64",type:"jpeg",quality:80});return await this._puppeteerPage.evaluate(()=>{const r=document.getElementById("puppeteer-disable-animations");r&&r.remove()}),t}catch(t){throw Ge.error("Failed to take screenshot:",t),t}}url(){return this._puppeteerPage?this._puppeteerPage.url():this._state.url}async title(){return this._puppeteerPage?await this._puppeteerPage.title():this._state.title}async navigateTo(e){if(this._puppeteerPage){Ge.info("navigateTo",e);try{await Promise.all([this.waitForPageAndFramesLoad(),this._puppeteerPage.goto(e)]),Ge.info("navigateTo complete")}catch(t){if(t instanceof Error&&t.message.includes("timeout"))Ge.warning("Navigation timeout, but page might still be usable:",t);else throw Ge.error("Navigation failed:",t),t}}}async refreshPage(){if(this._puppeteerPage)try{await Promise.all([this.waitForPageAndFramesLoad(),this._puppeteerPage.reload()]),Ge.info("Page refresh complete")}catch(e){if(e instanceof Error&&e.message.includes("timeout"))Ge.warning("Refresh timeout, but page might still be usable:",e);else throw Ge.error("Page refresh failed:",e),e}}async goBack(){if(this._puppeteerPage)try{await Promise.all([this.waitForPageAndFramesLoad(),this._puppeteerPage.goBack()]),Ge.info("Navigation back completed")}catch(e){if(e instanceof Error&&e.message.includes("timeout"))Ge.warning("Back navigation timeout, but page might still be usable:",e);else throw Ge.error("Could not navigate back:",e),e}}async goForward(){if(this._puppeteerPage)try{await Promise.all([this.waitForPageAndFramesLoad(),this._puppeteerPage.goForward()]),Ge.info("Navigation forward completed")}catch(e){if(e instanceof Error&&e.message.includes("timeout"))Ge.warning("Forward navigation timeout, but page might still be usable:",e);else throw Ge.error("Could not navigate forward:",e),e}}async scrollDown(e){var t,r;this._puppeteerPage&&(e?await((t=this._puppeteerPage)==null?void 0:t.evaluate(`window.scrollBy(0, ${e});`)):await((r=this._puppeteerPage)==null?void 0:r.evaluate("window.scrollBy(0, window.innerHeight);")))}async scrollUp(e){var t,r;this._puppeteerPage&&(e?await((t=this._puppeteerPage)==null?void 0:t.evaluate(`window.scrollBy(0, -${e});`)):await((r=this._puppeteerPage)==null?void 0:r.evaluate("window.scrollBy(0, -window.innerHeight);")))}async sendKeys(e){if(!this._puppeteerPage)throw new Error("Puppeteer page is not connected");const t=e.split("+"),r=t.slice(0,-1),s=t[t.length-1];try{for(const i of r)await this._puppeteerPage.keyboard.down(this._convertKey(i));await Promise.all([this._puppeteerPage.keyboard.press(this._convertKey(s)),this.waitForPageAndFramesLoad()]),Ge.info("sendKeys complete",e)}catch(i){throw Ge.error("Failed to send keys:",i),new Error(`Failed to send keys: ${i instanceof Error?i.message:String(i)}`)}finally{for(const i of[...r].reverse())try{await this._puppeteerPage.keyboard.up(this._convertKey(i))}catch(a){Ge.error("Failed to release modifier:",i,a)}}}_convertKey(e){const t=e.trim().toLowerCase();if(navigator.userAgent.toLowerCase().includes("mac os x")){if(t==="control"||t==="ctrl"||t==="command"||t==="cmd")return"Meta";if(t==="option"||t==="opt")return"Alt"}const i={a:"KeyA",b:"KeyB",c:"KeyC",d:"KeyD",e:"KeyE",f:"KeyF",g:"KeyG",h:"KeyH",i:"KeyI",j:"KeyJ",k:"KeyK",l:"KeyL",m:"KeyM",n:"KeyN",o:"KeyO",p:"KeyP",q:"KeyQ",r:"KeyR",s:"KeyS",t:"KeyT",u:"KeyU",v:"KeyV",w:"KeyW",x:"KeyX",y:"KeyY",z:"KeyZ",0:"Digit0",1:"Digit1",2:"Digit2",3:"Digit3",4:"Digit4",5:"Digit5",6:"Digit6",7:"Digit7",8:"Digit8",9:"Digit9",control:"Control",shift:"Shift",alt:"Alt",meta:"Meta",enter:"Enter",backspace:"Backspace",delete:"Delete",arrowleft:"ArrowLeft",arrowright:"ArrowRight",arrowup:"ArrowUp",arrowdown:"ArrowDown",escape:"Escape",tab:"Tab",space:"Space"}[t]||e;return Ge.info("convertedKey",i),i}async scrollToText(e){if(!this._puppeteerPage)throw new Error("Puppeteer is not connected");try{const t=[`::-p-text(${e})`,`::-p-xpath(//*[contains(translate(text(), 'ABCDEFGHIJKLMNOPQRSTUVWXYZ', 'abcdefghijklmnopqrstuvwxyz'), '${e.toLowerCase()}')])`];for(const r of t)try{const s=await this._puppeteerPage.$(r);if(s&&await s.evaluate(a=>{const o=window.getComputedStyle(a);return o.display!=="none"&&o.visibility!=="hidden"&&o.opacity!=="0"}))return await this._scrollIntoViewIfNeeded(s),await new Promise(a=>setTimeout(a,500)),!0}catch(s){Ge.debug(`Locator attempt failed: ${s}`)}return!1}catch(t){throw new Error(t instanceof Error?t.message:String(t))}}async getDropdownOptions(e){const t=this.getSelectorMap(),r=t==null?void 0:t.get(e);if(!r||!this._puppeteerPage)throw new Error("Element not found or puppeteer is not connected");try{const s=await this.locateElement(r);if(!s)throw new Error("Dropdown element not found");const i=await s.evaluate(a=>{if(!(a instanceof HTMLSelectElement))throw new Error("Element is not a select element");return Array.from(a.options).map(o=>({index:o.index,text:o.text,value:o.value}))});if(!i.length)throw new Error("No options found in dropdown");return i}catch(s){throw new Error(`Failed to get dropdown options: ${s instanceof Error?s.message:String(s)}`)}}async selectDropdownOption(e,t){var i;const r=this.getSelectorMap(),s=r==null?void 0:r.get(e);if(!s||!this._puppeteerPage)throw new Error("Element not found or puppeteer is not connected");if(Ge.debug(`Element attributes: ${JSON.stringify(s.attributes)}`),Ge.debug(`Element tag: ${s.tagName}`),((i=s.tagName)==null?void 0:i.toLowerCase())!=="select"){const a=`Cannot select option: Element with index ${e} is a ${s.tagName}, not a SELECT`;throw Ge.error(a),new Error(a)}try{const a=await this.locateElement(s);if(!a)throw new Error(`Dropdown element with index ${e} not found`);const o=await a.evaluate((u,l,d)=>{if(!(u instanceof HTMLSelectElement))return{found:!1,message:`Element with index ${d} is not a SELECT`};const h=Array.from(u.options),f=h.find(m=>m.text.trim()===l);if(!f){const m=h.map(g=>g.text.trim()).join('", "');return{found:!1,message:`Option "${l}" not found in dropdown element with index ${d}. Available options: "${m}"`}}const p=u.value;return u.value=f.value,p!==f.value&&(u.dispatchEvent(new Event("change",{bubbles:!0})),u.dispatchEvent(new Event("input",{bubbles:!0}))),{found:!0,message:`Selected option "${l}" with value "${f.value}"`}},t,e);return Ge.debug("Selection result:",o),o.message}catch(a){const o=`${a instanceof Error?a.message:String(a)}`;throw Ge.error(o),new Error(o)}}async locateElement(e){if(!this._puppeteerPage)return Ge.warning("Puppeteer is not connected"),null;let t=this._puppeteerPage;const r=[];let s=e;for(;s.parent;)r.push(s.parent),s=s.parent;const i=r.reverse().filter(o=>o.tagName==="iframe");for(const o of i){const u=o.enhancedCssSelectorForElement(this._config.includeDynamicAttributes),l=await t.$(u);if(!l)return Ge.warning(`Could not find iframe with selector: ${u}`),null;const d=await l.contentFrame();if(!d)return Ge.warning(`Could not access frame content for selector: ${u}`),null;t=d}const a=e.enhancedCssSelectorForElement(this._config.includeDynamicAttributes);try{const o=await t.$(a);if(o)return await this._scrollIntoViewIfNeeded(o),o}catch(o){Ge.error("Failed to locate element:",o)}return null}async inputTextElementNode(e,t,r){if(!this._puppeteerPage)throw new Error("Puppeteer is not connected");try{t.highlightIndex!==void 0&&await this._updateState(e,t.highlightIndex);const s=await this.locateElement(t);if(!s)throw new Error(`Element: ${t} not found`);await this._scrollIntoViewIfNeeded(s),await s.evaluate(i=>{(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement)&&(i.value="",i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0})))}),await s.type(r)}catch(s){throw new Error(`Failed to input text into element: ${t}. Error: ${s instanceof Error?s.message:String(s)}`)}}async _scrollIntoViewIfNeeded(e,t=2500){const r=Date.now();for(;!await e.evaluate(i=>{const a=i.getBoundingClientRect();if(a.width===0||a.height===0)return!1;const o=window.getComputedStyle(i);return o.visibility==="hidden"||o.display==="none"||o.opacity==="0"?!1:a.top>=0&&a.left>=0&&a.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&a.right<=(window.innerWidth||document.documentElement.clientWidth)?!0:(i.scrollIntoView({behavior:"auto",block:"center",inline:"center"}),!1)});){if(Date.now()-r>t)throw new Error("Timed out while trying to scroll element into view");await new Promise(i=>setTimeout(i,100))}}async clickElementNode(e,t){if(!this._puppeteerPage)throw new Error("Puppeteer is not connected");try{t.highlightIndex!==void 0&&await this._updateState(e,t.highlightIndex);const r=await this.locateElement(t);if(!r)throw new Error(`Element: ${t} not found`);await this._scrollIntoViewIfNeeded(r);try{await Promise.race([r.click(),new Promise((s,i)=>setTimeout(()=>i(new Error("Click timeout")),2e3))])}catch(s){Ge.info("Failed to click element, trying again",s);try{await r.evaluate(i=>i.click())}catch(i){throw new Error(`Failed to click element: ${i instanceof Error?i.message:String(i)}`)}}}catch(r){throw new Error(`Failed to click element: ${t}. Error: ${r instanceof Error?r.message:String(r)}`)}}getSelectorMap(){return this._state.selectorMap}async getElementByIndex(e){const r=this.getSelectorMap().get(e);return r?await this.locateElement(r):null}getDomElementByIndex(e){return this.getSelectorMap().get(e)||null}isFileUploader(e,t=3,r=0){var s;if(r>t)return!1;if(e.tagName==="input"){const i=e.attributes;if(((s=i.type)==null?void 0:s.toLowerCase())==="file"||i.accept)return!0}if(e.children&&r<t){for(const i of e.children)if("tagName"in i&&this.isFileUploader(i,t,r+1))return!0}return!1}async waitForPageLoadState(e){var r;const t=e||8e3;await((r=this._puppeteerPage)==null?void 0:r.waitForNavigation({timeout:t}))}async _waitForStableNetwork(){if(!this._puppeteerPage)throw new Error("Puppeteer page is not connected");const e=new Set(["document","stylesheet","image","font","script","iframe"]),t=new Set(["text/html","text/css","application/javascript","image/","font/","application/json"]),r=new Set(["analytics","tracking","telemetry","beacon","metrics","doubleclick","adsystem","adserver","advertising","facebook.com/plugins","platform.twitter","linkedin.com/embed","livechat","zendesk","intercom","crisp.chat","hotjar","push-notifications","onesignal","pushwoosh","heartbeat","ping","alive","webrtc","rtmp://","wss://","cloudfront.net","fastly.net"]),s=new Set;let i=Date.now();const a=u=>{const l=u.resourceType();if(!e.has(l)||["websocket","media","eventsource","manifest","other"].includes(l))return;const d=u.url().toLowerCase();if(Array.from(r).some(f=>d.includes(f))||d.startsWith("data:")||d.startsWith("blob:"))return;const h=u.headers();h.purpose==="prefetch"||h["sec-fetch-dest"]==="video"||h["sec-fetch-dest"]==="audio"||(s.add(u),i=Date.now())},o=u=>{var f;const l=u.request();if(!s.has(l))return;const d=((f=u.headers()["content-type"])==null?void 0:f.toLowerCase())||"";if(["streaming","video","audio","webm","mp4","event-stream","websocket","protobuf"].some(p=>d.includes(p))){s.delete(l);return}if(!Array.from(t).some(p=>d.includes(p))){s.delete(l);return}const h=u.headers()["content-length"];if(h&&Number.parseInt(h)>5*1024*1024){s.delete(l);return}s.delete(l),i=Date.now()};this._puppeteerPage.on("request",a),this._puppeteerPage.on("response",o);try{const u=Date.now();for(;;){await new Promise(f=>setTimeout(f,100));const l=Date.now(),d=(l-i)/1e3;if(s.size===0&&d>=this._config.waitForNetworkIdlePageLoadTime)break;if((l-u)/1e3>this._config.maximumWaitPageLoadTime){console.debug(`Network timeout after ${this._config.maximumWaitPageLoadTime}s with ${s.size} pending requests:`,Array.from(s).map(f=>f.url()));break}}}finally{this._puppeteerPage.off("request",a),this._puppeteerPage.off("response",o)}console.debug(`Network stabilized for ${this._config.waitForNetworkIdlePageLoadTime} seconds`)}async waitForPageAndFramesLoad(e){const t=Date.now();try{await this._waitForStableNetwork()}catch{console.warn("Page load failed, continuing...")}const r=(Date.now()-t)/1e3,s=e||this._config.minimumWaitPageLoadTime,i=Math.max(s-r,0);console.debug(`--Page loaded in ${r.toFixed(2)} seconds, waiting for additional ${i.toFixed(2)} seconds`),i>0&&await new Promise(a=>setTimeout(a,i*1e3))}};const hl=ws("BrowserContext");class UH{constructor(e){this._currentTabId=null,this._attachedPages=new Map,this._config={...U1,...e}}getConfig(){return this._config}updateCurrentTabId(e){this._currentTabId=e}async _getOrCreatePage(e,t=!1){if(!e.id)throw new Error("Tab ID is not available");const r=this._attachedPages.get(e.id);if(r){if(hl.info("getOrCreatePage",e.id,"already attached"),!t)return r;await r.detachPuppeteer(),this._attachedPages.delete(e.id)}return hl.info("getOrCreatePage",e.id,"creating new page"),new BH(e.id,e.url||"",e.title||"",this._config)}async cleanup(){const e=await this.getCurrentPage();e==null||e.removeHighlight();for(const t of this._attachedPages.values())await t.detachPuppeteer();this._attachedPages.clear(),this._currentTabId=null}async attachPage(e){return this._attachedPages.has(e.tabId)?(hl.info("attachPage",e.tabId,"already attached"),!0):await e.attachPuppeteer()?(hl.info("attachPage",e.tabId,"attached"),this._attachedPages.set(e.tabId,e),!0):!1}async detachPage(e){const t=this._attachedPages.get(e);t&&(await t.detachPuppeteer(),this._attachedPages.delete(e))}async getCurrentPage(){if(!this._currentTabId){let t;const[r]=await chrome.tabs.query({active:!0,currentWindow:!0});if(r!=null&&r.id)t=r;else{const i=await chrome.tabs.create({url:this._config.homePageUrl});if(!i.id)throw new Error("No tab ID available");t=i}hl.info("active tab",t.id,t.url,t.title);const s=await this._getOrCreatePage(t);return await this.attachPage(s),this._currentTabId=t.id||null,s}const e=this._attachedPages.get(this._currentTabId);if(!e){const t=await chrome.tabs.get(this._currentTabId),r=await this._getOrCreatePage(t);return await this.attachPage(r),r}return e}async getAllTabIds(){const e=await chrome.tabs.query({currentWindow:!0});return new Set(e.map(t=>t.id).filter(t=>t!==void 0))}async waitForTabEvents(e,t={}){const{waitForUpdate:r=!0,waitForActivation:s=!0,timeoutMs:i=5e3}=t,a=[];if(r){const u=new Promise(l=>{let d=!1,h=!1,f=!1;const p=(m,g)=>{m===e&&(g.url&&(d=!0),g.title&&(h=!0),g.status==="complete"&&(f=!0),d&&h&&f&&(chrome.tabs.onUpdated.removeListener(p),l()))};chrome.tabs.onUpdated.addListener(p),chrome.tabs.get(e).then(m=>{m.url&&(d=!0),m.title&&(h=!0),m.status==="complete"&&(f=!0),d&&h&&f&&(chrome.tabs.onUpdated.removeListener(p),l())})});a.push(u)}if(s){const u=new Promise(l=>{const d=h=>{h.tabId===e&&(chrome.tabs.onActivated.removeListener(d),l())};chrome.tabs.onActivated.addListener(d),chrome.tabs.get(e).then(h=>{h.active&&(chrome.tabs.onActivated.removeListener(d),l())})});a.push(u)}const o=new Promise((u,l)=>setTimeout(()=>l(new Error(`Tab operation timed out after ${i} ms`)),i));await Promise.race([Promise.all(a),o])}async switchTab(e){hl.info("switchTab",e),await chrome.tabs.update(e,{active:!0}),await this.waitForTabEvents(e,{waitForUpdate:!1});const t=await this._getOrCreatePage(await chrome.tabs.get(e));return await this.attachPage(t),this._currentTabId=e,t}async navigateTo(e){const t=await this.getCurrentPage();if(!t){await this.openTab(e);return}if(t.attached){await t.navigateTo(e);return}const r=t.tabId;await chrome.tabs.update(r,{url:e,active:!0}),await this.waitForTabEvents(r);const s=await this._getOrCreatePage(await chrome.tabs.get(r),!0);await this.attachPage(s),this._currentTabId=r}async openTab(e){const t=await chrome.tabs.create({url:e,active:!0});if(!t.id)throw new Error("No tab ID available");await this.waitForTabEvents(t.id);const r=await chrome.tabs.get(t.id),s=await this._getOrCreatePage(r);return await this.attachPage(s),this._currentTabId=t.id,s}async closeTab(e){await this.detachPage(e),await chrome.tabs.remove(e),this._currentTabId===e&&(this._currentTabId=null)}removeAttachedPage(e){this._attachedPages.delete(e),this._currentTabId===e&&(this._currentTabId=null)}async getTabInfos(){const e=await chrome.tabs.query({}),t=[];for(const r of e)r.id&&r.url&&r.title&&t.push({id:r.id,url:r.url,title:r.title});return t}async getState(){const e=await this.getCurrentPage(),t=e?await e.getState():Kb(),r=await this.getTabInfos();return{...t,tabs:r}}async removeHighlight(){const e=await this.getCurrentPage();e&&await e.removeHighlight()}}var nt;(function(n){n.assertEqual=s=>s;function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},n.getValidEnumValues=s=>{const i=n.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(const o of i)a[o]=s[o];return n.objectValues(a)},n.objectValues=s=>n.objectKeys(s).map(function(i){return s[i]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},n.find=(s,i)=>{for(const a of s)if(i(a))return a},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(nt||(nt={}));var gx;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(gx||(gx={}));const ge=nt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Hi=n=>{switch(typeof n){case"undefined":return ge.undefined;case"string":return ge.string;case"number":return isNaN(n)?ge.nan:ge.number;case"boolean":return ge.boolean;case"function":return ge.function;case"bigint":return ge.bigint;case"symbol":return ge.symbol;case"object":return Array.isArray(n)?ge.array:n===null?ge.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?ge.promise:typeof Map<"u"&&n instanceof Map?ge.map:typeof Set<"u"&&n instanceof Set?ge.set:typeof Date<"u"&&n instanceof Date?ge.date:ge.object;default:return ge.unknown}},ne=nt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),qH=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");let _s=class l3 extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)r._errors.push(t(a));else{let o=r,u=0;for(;u<a.path.length;){const l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return s(this),r}static assert(e){if(!(e instanceof l3))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,nt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}};_s.create=n=>new _s(n);const fl=(n,e)=>{let t;switch(n.code){case ne.invalid_type:n.received===ge.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case ne.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,nt.jsonStringifyReplacer)}`;break;case ne.unrecognized_keys:t=`Unrecognized key(s) in object: ${nt.joinValues(n.keys,", ")}`;break;case ne.invalid_union:t="Invalid input";break;case ne.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${nt.joinValues(n.options)}`;break;case ne.invalid_enum_value:t=`Invalid enum value. Expected ${nt.joinValues(n.options)}, received '${n.received}'`;break;case ne.invalid_arguments:t="Invalid function arguments";break;case ne.invalid_return_type:t="Invalid function return type";break;case ne.invalid_date:t="Invalid date";break;case ne.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:nt.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case ne.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case ne.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case ne.custom:t="Invalid input";break;case ne.invalid_intersection_types:t="Intersection results could not be merged";break;case ne.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case ne.not_finite:t="Number must be finite";break;default:t=e.defaultError,nt.assertNever(n)}return{message:t}};let NO=fl;function KH(n){NO=n}function Hb(){return NO}const Wb=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,i=[...t,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="";const u=r.filter(l=>!!l).slice().reverse();for(const l of u)o=l(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}},HH=[];function fe(n,e){const t=Hb(),r=Wb({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===fl?void 0:fl].filter(s=>!!s)});n.common.issues.push(r)}let fn=class d3{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return je;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t){const i=await s.key,a=await s.value;r.push({key:i,value:a})}return d3.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return je;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(r[i.value]=a.value)}return{status:e.value,value:r}}};const je=Object.freeze({status:"aborted"}),pl=n=>({status:"dirty",value:n}),Jr=n=>({status:"valid",value:n}),yx=n=>n.status==="aborted",wx=n=>n.status==="dirty",lc=n=>n.status==="valid",If=n=>typeof Promise<"u"&&n instanceof Promise;function zb(n,e,t,r){if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function $O(n,e,t,r,s){if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}typeof SuppressedError=="function"&&SuppressedError;var Ee;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(Ee||(Ee={}));var Of,Rf;let li=class{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};const jO=(n,e)=>{if(lc(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new _s(n.common.issues);return this._error=t,this._error}}};function De(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{var u,l;const{message:d}=n;return a.code==="invalid_enum_value"?{message:d??o.defaultError}:typeof o.data>"u"?{message:(u=d??r)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=d??t)!==null&&l!==void 0?l:o.defaultError}},description:s}}let Ke=class{get description(){return this._def.description}_getType(e){return Hi(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Hi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new fn,ctx:{common:e.parent.common,data:e.data,parsedType:Hi(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(If(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Hi(e)},i=this._parseSync({data:e,path:s.path,parent:s});return jO(s,i)}"~validate"(e){var t,r;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Hi(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:s});return lc(i)?{value:i.value}:{issues:s.common.issues}}catch(i){!((r=(t=i==null?void 0:i.message)===null||t===void 0?void 0:t.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(i=>lc(i)?{value:i.value}:{issues:s.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Hi(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(If(s)?s:Promise.resolve(s));return jO(r,i)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const a=e(s),o=()=>i.addIssue({code:ne.custom,...r(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new vs({schema:this,typeName:Y.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Ss.create(this,this._def)}nullable(){return Ka.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return hc.create(this)}promise(){return wl.create(this,this._def)}or(e){return Df.create([this,e],this._def)}and(e){return Bf.create(this,e,this._def)}transform(e){return new vs({...De(this._def),schema:this,typeName:Y.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Wf({...De(this._def),innerType:this,defaultValue:t,typeName:Y.ZodDefault})}brand(){return new vx({typeName:Y.ZodBranded,type:this,...De(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new zf({...De(this._def),innerType:this,catchValue:t,typeName:Y.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Sx.create(this,e)}readonly(){return Vf.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};const WH=/^c[^\s-]{8,}$/i,zH=/^[0-9a-z]+$/,VH=/^[0-9A-HJKMNP-TV-Z]{26}$/i,GH=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ZH=/^[a-z0-9_-]{21}$/i,JH=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,XH=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,YH=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,QH="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let bx;const e9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,t9=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,r9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,n9=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,s9=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,i9=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,LO="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",a9=new RegExp(`^${LO}$`);function FO(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function o9(n){return new RegExp(`^${FO(n)}$`)}function DO(n){let e=`${LO}T${FO(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function c9(n,e){return!!((e==="v4"||!e)&&e9.test(n)||(e==="v6"||!e)&&r9.test(n))}function u9(n,e){if(!JH.test(n))return!1;try{const[t]=n.split("."),r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function l9(n,e){return!!((e==="v4"||!e)&&t9.test(n)||(e==="v6"||!e)&&n9.test(n))}let ml=class zw extends Ke{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ge.string){const i=this._getOrReturnCtx(e);return fe(i,{code:ne.invalid_type,expected:ge.string,received:i.parsedType}),je}const r=new fn;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),fe(s,{code:ne.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),fe(s,{code:ne.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?fe(s,{code:ne.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&fe(s,{code:ne.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")YH.test(e.data)||(s=this._getOrReturnCtx(e,s),fe(s,{validation:"email",code:ne.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")bx||(bx=new RegExp(QH,"u")),bx.test(e.data)||(s=this._getOrReturnCtx(e,s),fe(s,{validation:"emoji",code:ne.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")GH.test(e.data)||(s=this._getOrReturnCtx(e,s),fe(s,{validation:"uuid",code:ne.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")ZH.test(e.data)||(s=this._getOrReturnCtx(e,s),fe(s,{validation:"nanoid",code:ne.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")WH.test(e.data)||(s=this._getOrReturnCtx(e,s),fe(s,{validation:"cuid",code:ne.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")zH.test(e.data)||(s=this._getOrReturnCtx(e,s),fe(s,{validation:"cuid2",code:ne.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")VH.test(e.data)||(s=this._getOrReturnCtx(e,s),fe(s,{validation:"ulid",code:ne.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),fe(s,{validation:"url",code:ne.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),fe(s,{validation:"regex",code:ne.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),fe(s,{code:ne.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),fe(s,{code:ne.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),fe(s,{code:ne.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?DO(i).test(e.data)||(s=this._getOrReturnCtx(e,s),fe(s,{code:ne.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?a9.test(e.data)||(s=this._getOrReturnCtx(e,s),fe(s,{code:ne.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?o9(i).test(e.data)||(s=this._getOrReturnCtx(e,s),fe(s,{code:ne.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?XH.test(e.data)||(s=this._getOrReturnCtx(e,s),fe(s,{validation:"duration",code:ne.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?c9(e.data,i.version)||(s=this._getOrReturnCtx(e,s),fe(s,{validation:"ip",code:ne.invalid_string,message:i.message}),r.dirty()):i.kind==="jwt"?u9(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),fe(s,{validation:"jwt",code:ne.invalid_string,message:i.message}),r.dirty()):i.kind==="cidr"?l9(e.data,i.version)||(s=this._getOrReturnCtx(e,s),fe(s,{validation:"cidr",code:ne.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?s9.test(e.data)||(s=this._getOrReturnCtx(e,s),fe(s,{validation:"base64",code:ne.invalid_string,message:i.message}),r.dirty()):i.kind==="base64url"?i9.test(e.data)||(s=this._getOrReturnCtx(e,s),fe(s,{validation:"base64url",code:ne.invalid_string,message:i.message}),r.dirty()):nt.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:ne.invalid_string,...Ee.errToObj(r)})}_addCheck(e){return new zw({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Ee.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Ee.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Ee.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Ee.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Ee.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Ee.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Ee.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Ee.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Ee.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Ee.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Ee.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Ee.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Ee.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...Ee.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...Ee.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Ee.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Ee.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...Ee.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Ee.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Ee.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Ee.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Ee.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Ee.errToObj(t)})}nonempty(e){return this.min(1,Ee.errToObj(e))}trim(){return new zw({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new zw({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new zw({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};ml.create=n=>{var e;return new ml({checks:[],typeName:Y.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...De(n)})};function d9(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,i=parseInt(n.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}let Mf=class NT extends Ke{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ge.number){const i=this._getOrReturnCtx(e);return fe(i,{code:ne.invalid_type,expected:ge.number,received:i.parsedType}),je}let r;const s=new fn;for(const i of this._def.checks)i.kind==="int"?nt.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),fe(r,{code:ne.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),fe(r,{code:ne.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),fe(r,{code:ne.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?d9(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),fe(r,{code:ne.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),fe(r,{code:ne.not_finite,message:i.message}),s.dirty()):nt.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Ee.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Ee.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Ee.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Ee.toString(t))}setLimit(e,t,r,s){return new NT({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Ee.toString(s)}]})}_addCheck(e){return new NT({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Ee.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Ee.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Ee.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Ee.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Ee.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Ee.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Ee.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Ee.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Ee.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&nt.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}};Mf.create=n=>new Mf({checks:[],typeName:Y.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...De(n)});let Nf=class $T extends Ke{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ge.bigint)return this._getInvalidInput(e);let r;const s=new fn;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),fe(r,{code:ne.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),fe(r,{code:ne.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),fe(r,{code:ne.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):nt.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return fe(t,{code:ne.invalid_type,expected:ge.bigint,received:t.parsedType}),je}gte(e,t){return this.setLimit("min",e,!0,Ee.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Ee.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Ee.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Ee.toString(t))}setLimit(e,t,r,s){return new $T({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Ee.toString(s)}]})}_addCheck(e){return new $T({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Ee.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Ee.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Ee.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Ee.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Ee.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Nf.create=n=>{var e;return new Nf({checks:[],typeName:Y.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...De(n)})};let $f=class extends Ke{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ge.boolean){const r=this._getOrReturnCtx(e);return fe(r,{code:ne.invalid_type,expected:ge.boolean,received:r.parsedType}),je}return Jr(e.data)}};$f.create=n=>new $f({typeName:Y.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...De(n)});let jf=class h3 extends Ke{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ge.date){const i=this._getOrReturnCtx(e);return fe(i,{code:ne.invalid_type,expected:ge.date,received:i.parsedType}),je}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return fe(i,{code:ne.invalid_date}),je}const r=new fn;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),fe(s,{code:ne.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),fe(s,{code:ne.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):nt.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new h3({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Ee.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Ee.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};jf.create=n=>new jf({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:Y.ZodDate,...De(n)});let Vb=class extends Ke{_parse(e){if(this._getType(e)!==ge.symbol){const r=this._getOrReturnCtx(e);return fe(r,{code:ne.invalid_type,expected:ge.symbol,received:r.parsedType}),je}return Jr(e.data)}};Vb.create=n=>new Vb({typeName:Y.ZodSymbol,...De(n)});let Lf=class extends Ke{_parse(e){if(this._getType(e)!==ge.undefined){const r=this._getOrReturnCtx(e);return fe(r,{code:ne.invalid_type,expected:ge.undefined,received:r.parsedType}),je}return Jr(e.data)}};Lf.create=n=>new Lf({typeName:Y.ZodUndefined,...De(n)});let Ff=class extends Ke{_parse(e){if(this._getType(e)!==ge.null){const r=this._getOrReturnCtx(e);return fe(r,{code:ne.invalid_type,expected:ge.null,received:r.parsedType}),je}return Jr(e.data)}};Ff.create=n=>new Ff({typeName:Y.ZodNull,...De(n)});let gl=class extends Ke{constructor(){super(...arguments),this._any=!0}_parse(e){return Jr(e.data)}};gl.create=n=>new gl({typeName:Y.ZodAny,...De(n)});let dc=class extends Ke{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Jr(e.data)}};dc.create=n=>new dc({typeName:Y.ZodUnknown,...De(n)});let Wi=class extends Ke{_parse(e){const t=this._getOrReturnCtx(e);return fe(t,{code:ne.invalid_type,expected:ge.never,received:t.parsedType}),je}};Wi.create=n=>new Wi({typeName:Y.ZodNever,...De(n)});let Gb=class extends Ke{_parse(e){if(this._getType(e)!==ge.undefined){const r=this._getOrReturnCtx(e);return fe(r,{code:ne.invalid_type,expected:ge.void,received:r.parsedType}),je}return Jr(e.data)}};Gb.create=n=>new Gb({typeName:Y.ZodVoid,...De(n)});let hc=class J0 extends Ke{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==ge.array)return fe(t,{code:ne.invalid_type,expected:ge.array,received:t.parsedType}),je;if(s.exactLength!==null){const a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(fe(t,{code:a?ne.too_big:ne.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(fe(t,{code:ne.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(fe(t,{code:ne.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new li(t,a,t.path,o)))).then(a=>fn.mergeArray(r,a));const i=[...t.data].map((a,o)=>s.type._parseSync(new li(t,a,t.path,o)));return fn.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new J0({...this._def,minLength:{value:e,message:Ee.toString(t)}})}max(e,t){return new J0({...this._def,maxLength:{value:e,message:Ee.toString(t)}})}length(e,t){return new J0({...this._def,exactLength:{value:e,message:Ee.toString(t)}})}nonempty(e){return this.min(1,e)}};hc.create=(n,e)=>new hc({type:n,minLength:null,maxLength:null,exactLength:null,typeName:Y.ZodArray,...De(e)});function yl(n){if(n instanceof rs){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=Ss.create(yl(r))}return new rs({...n._def,shape:()=>e})}else return n instanceof hc?new hc({...n._def,type:yl(n.element)}):n instanceof Ss?Ss.create(yl(n.unwrap())):n instanceof Ka?Ka.create(yl(n.unwrap())):n instanceof qa?qa.create(n.items.map(e=>yl(e))):n}let rs=class Qs extends Ke{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=nt.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==ge.object){const l=this._getOrReturnCtx(e);return fe(l,{code:ne.invalid_type,expected:ge.object,received:l.parsedType}),je}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Wi&&this._def.unknownKeys==="strip"))for(const l in s.data)a.includes(l)||o.push(l);const u=[];for(const l of a){const d=i[l],h=s.data[l];u.push({key:{status:"valid",value:l},value:d._parse(new li(s,h,s.path,l)),alwaysSet:l in s.data})}if(this._def.catchall instanceof Wi){const l=this._def.unknownKeys;if(l==="passthrough")for(const d of o)u.push({key:{status:"valid",value:d},value:{status:"valid",value:s.data[d]}});else if(l==="strict")o.length>0&&(fe(s,{code:ne.unrecognized_keys,keys:o}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const d of o){const h=s.data[d];u.push({key:{status:"valid",value:d},value:l._parse(new li(s,h,s.path,d)),alwaysSet:d in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const l=[];for(const d of u){const h=await d.key,f=await d.value;l.push({key:h,value:f,alwaysSet:d.alwaysSet})}return l}).then(l=>fn.mergeObjectSync(r,l)):fn.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return Ee.errToObj,new Qs({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var s,i,a,o;const u=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,r).message)!==null&&a!==void 0?a:r.defaultError;return t.code==="unrecognized_keys"?{message:(o=Ee.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new Qs({...this._def,unknownKeys:"strip"})}passthrough(){return new Qs({...this._def,unknownKeys:"passthrough"})}extend(e){return new Qs({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Qs({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Y.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Qs({...this._def,catchall:e})}pick(e){const t={};return nt.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new Qs({...this._def,shape:()=>t})}omit(e){const t={};return nt.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new Qs({...this._def,shape:()=>t})}deepPartial(){return yl(this)}partial(e){const t={};return nt.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}),new Qs({...this._def,shape:()=>t})}required(e){const t={};return nt.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof Ss;)i=i._def.innerType;t[r]=i}}),new Qs({...this._def,shape:()=>t})}keyof(){return KO(nt.objectKeys(this.shape))}};rs.create=(n,e)=>new rs({shape:()=>n,unknownKeys:"strip",catchall:Wi.create(),typeName:Y.ZodObject,...De(e)}),rs.strictCreate=(n,e)=>new rs({shape:()=>n,unknownKeys:"strict",catchall:Wi.create(),typeName:Y.ZodObject,...De(e)}),rs.lazycreate=(n,e)=>new rs({shape:n,unknownKeys:"strip",catchall:Wi.create(),typeName:Y.ZodObject,...De(e)});let Df=class extends Ke{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new _s(o.ctx.common.issues));return fe(t,{code:ne.invalid_union,unionErrors:a}),je}if(t.common.async)return Promise.all(r.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const u of r){const l={...t,common:{...t.common,issues:[]},parent:null},d=u._parseSync({data:t.data,path:t.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!i&&(i={result:d,ctx:l}),l.common.issues.length&&a.push(l.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(u=>new _s(u));return fe(t,{code:ne.invalid_union,unionErrors:o}),je}}get options(){return this._def.options}};Df.create=(n,e)=>new Df({options:n,typeName:Y.ZodUnion,...De(e)});const zi=n=>n instanceof Uf?zi(n.schema):n instanceof vs?zi(n.innerType()):n instanceof qf?[n.value]:n instanceof Kf?n.options:n instanceof Hf?nt.objectValues(n.enum):n instanceof Wf?zi(n._def.innerType):n instanceof Lf?[void 0]:n instanceof Ff?[null]:n instanceof Ss?[void 0,...zi(n.unwrap())]:n instanceof Ka?[null,...zi(n.unwrap())]:n instanceof vx||n instanceof Vf?zi(n.unwrap()):n instanceof zf?zi(n._def.innerType):[];let BO=class f3 extends Ke{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ge.object)return fe(t,{code:ne.invalid_type,expected:ge.object,received:t.parsedType}),je;const r=this.discriminator,s=t.data[r],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(fe(t,{code:ne.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),je)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const s=new Map;for(const i of t){const a=zi(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new f3({typeName:Y.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...De(r)})}};function _x(n,e){const t=Hi(n),r=Hi(e);if(n===e)return{valid:!0,data:n};if(t===ge.object&&r===ge.object){const s=nt.objectKeys(e),i=nt.objectKeys(n).filter(o=>s.indexOf(o)!==-1),a={...n,...e};for(const o of i){const u=_x(n[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===ge.array&&r===ge.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<n.length;i++){const a=n[i],o=e[i],u=_x(a,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===ge.date&&r===ge.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}let Bf=class extends Ke{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(i,a)=>{if(yx(i)||yx(a))return je;const o=_x(i.value,a.value);return o.valid?((wx(i)||wx(a))&&t.dirty(),{status:t.value,value:o.data}):(fe(r,{code:ne.invalid_intersection_types}),je)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};Bf.create=(n,e,t)=>new Bf({left:n,right:e,typeName:Y.ZodIntersection,...De(t)});let qa=class p3 extends Ke{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ge.array)return fe(r,{code:ne.invalid_type,expected:ge.array,received:r.parsedType}),je;if(r.data.length<this._def.items.length)return fe(r,{code:ne.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),je;!this._def.rest&&r.data.length>this._def.items.length&&(fe(r,{code:ne.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((a,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new li(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(i).then(a=>fn.mergeArray(t,a)):fn.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new p3({...this._def,rest:e})}};qa.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new qa({items:n,typeName:Y.ZodTuple,rest:null,...De(e)})};let UO=class jT extends Ke{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ge.object)return fe(r,{code:ne.invalid_type,expected:ge.object,received:r.parsedType}),je;const s=[],i=this._def.keyType,a=this._def.valueType;for(const o in r.data)s.push({key:i._parse(new li(r,o,r.path,o)),value:a._parse(new li(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?fn.mergeObjectAsync(t,s):fn.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof Ke?new jT({keyType:e,valueType:t,typeName:Y.ZodRecord,...De(r)}):new jT({keyType:ml.create(),valueType:e,typeName:Y.ZodRecord,...De(t)})}},Zb=class extends Ke{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ge.map)return fe(r,{code:ne.invalid_type,expected:ge.map,received:r.parsedType}),je;const s=this._def.keyType,i=this._def.valueType,a=[...r.data.entries()].map(([o,u],l)=>({key:s._parse(new li(r,o,r.path,[l,"key"])),value:i._parse(new li(r,u,r.path,[l,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of a){const l=await u.key,d=await u.value;if(l.status==="aborted"||d.status==="aborted")return je;(l.status==="dirty"||d.status==="dirty")&&t.dirty(),o.set(l.value,d.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const u of a){const l=u.key,d=u.value;if(l.status==="aborted"||d.status==="aborted")return je;(l.status==="dirty"||d.status==="dirty")&&t.dirty(),o.set(l.value,d.value)}return{status:t.value,value:o}}}};Zb.create=(n,e,t)=>new Zb({valueType:e,keyType:n,typeName:Y.ZodMap,...De(t)});let Jb=class LT extends Ke{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ge.set)return fe(r,{code:ne.invalid_type,expected:ge.set,received:r.parsedType}),je;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(fe(r,{code:ne.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(fe(r,{code:ne.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function a(u){const l=new Set;for(const d of u){if(d.status==="aborted")return je;d.status==="dirty"&&t.dirty(),l.add(d.value)}return{status:t.value,value:l}}const o=[...r.data.values()].map((u,l)=>i._parse(new li(r,u,r.path,l)));return r.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new LT({...this._def,minSize:{value:e,message:Ee.toString(t)}})}max(e,t){return new LT({...this._def,maxSize:{value:e,message:Ee.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Jb.create=(n,e)=>new Jb({valueType:n,minSize:null,maxSize:null,typeName:Y.ZodSet,...De(e)});let qO=class X0 extends Ke{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ge.function)return fe(t,{code:ne.invalid_type,expected:ge.function,received:t.parsedType}),je;function r(o,u){return Wb({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Hb(),fl].filter(l=>!!l),issueData:{code:ne.invalid_arguments,argumentsError:u}})}function s(o,u){return Wb({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Hb(),fl].filter(l=>!!l),issueData:{code:ne.invalid_return_type,returnTypeError:u}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof wl){const o=this;return Jr(async function(...u){const l=new _s([]),d=await o._def.args.parseAsync(u,i).catch(p=>{throw l.addIssue(r(u,p)),l}),h=await Reflect.apply(a,this,d);return await o._def.returns._def.type.parseAsync(h,i).catch(p=>{throw l.addIssue(s(h,p)),l})})}else{const o=this;return Jr(function(...u){const l=o._def.args.safeParse(u,i);if(!l.success)throw new _s([r(u,l.error)]);const d=Reflect.apply(a,this,l.data),h=o._def.returns.safeParse(d,i);if(!h.success)throw new _s([s(d,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new X0({...this._def,args:qa.create(e).rest(dc.create())})}returns(e){return new X0({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new X0({args:e||qa.create([]).rest(dc.create()),returns:t||dc.create(),typeName:Y.ZodFunction,...De(r)})}},Uf=class extends Ke{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Uf.create=(n,e)=>new Uf({getter:n,typeName:Y.ZodLazy,...De(e)});let qf=class extends Ke{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return fe(t,{received:t.data,code:ne.invalid_literal,expected:this._def.value}),je}return{status:"valid",value:e.data}}get value(){return this._def.value}};qf.create=(n,e)=>new qf({value:n,typeName:Y.ZodLiteral,...De(e)});function KO(n,e){return new Kf({values:n,typeName:Y.ZodEnum,...De(e)})}let Kf=class FT extends Ke{constructor(){super(...arguments),Of.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return fe(t,{expected:nt.joinValues(r),received:t.parsedType,code:ne.invalid_type}),je}if(zb(this,Of)||$O(this,Of,new Set(this._def.values)),!zb(this,Of).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return fe(t,{received:t.data,code:ne.invalid_enum_value,options:r}),je}return Jr(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return FT.create(e,{...this._def,...t})}exclude(e,t=this._def){return FT.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}};Of=new WeakMap,Kf.create=KO;let Hf=class extends Ke{constructor(){super(...arguments),Rf.set(this,void 0)}_parse(e){const t=nt.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==ge.string&&r.parsedType!==ge.number){const s=nt.objectValues(t);return fe(r,{expected:nt.joinValues(s),received:r.parsedType,code:ne.invalid_type}),je}if(zb(this,Rf)||$O(this,Rf,new Set(nt.getValidEnumValues(this._def.values))),!zb(this,Rf).has(e.data)){const s=nt.objectValues(t);return fe(r,{received:r.data,code:ne.invalid_enum_value,options:s}),je}return Jr(e.data)}get enum(){return this._def.values}};Rf=new WeakMap,Hf.create=(n,e)=>new Hf({values:n,typeName:Y.ZodNativeEnum,...De(e)});let wl=class extends Ke{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ge.promise&&t.common.async===!1)return fe(t,{code:ne.invalid_type,expected:ge.promise,received:t.parsedType}),je;const r=t.parsedType===ge.promise?t.data:Promise.resolve(t.data);return Jr(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};wl.create=(n,e)=>new wl({type:n,typeName:Y.ZodPromise,...De(e)});let vs=class extends Ke{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Y.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{fe(r,a),a.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const a=s.transform(r.data,i);if(r.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return je;const u=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return u.status==="aborted"?je:u.status==="dirty"||t.value==="dirty"?pl(u.value):u});{if(t.value==="aborted")return je;const o=this._def.schema._parseSync({data:a,path:r.path,parent:r});return o.status==="aborted"?je:o.status==="dirty"||t.value==="dirty"?pl(o.value):o}}if(s.type==="refinement"){const a=o=>{const u=s.refinement(o,i);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?je:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?je:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!lc(a))return a;const o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>lc(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);nt.assertNever(s)}};vs.create=(n,e,t)=>new vs({schema:n,typeName:Y.ZodEffects,effect:e,...De(t)}),vs.createWithPreprocess=(n,e,t)=>new vs({schema:e,effect:{type:"preprocess",transform:n},typeName:Y.ZodEffects,...De(t)});let Ss=class extends Ke{_parse(e){return this._getType(e)===ge.undefined?Jr(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ss.create=(n,e)=>new Ss({innerType:n,typeName:Y.ZodOptional,...De(e)});let Ka=class extends Ke{_parse(e){return this._getType(e)===ge.null?Jr(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ka.create=(n,e)=>new Ka({innerType:n,typeName:Y.ZodNullable,...De(e)});let Wf=class extends Ke{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===ge.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Wf.create=(n,e)=>new Wf({innerType:n,typeName:Y.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...De(e)});let zf=class extends Ke{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return If(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new _s(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new _s(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};zf.create=(n,e)=>new zf({innerType:n,typeName:Y.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...De(e)});let Xb=class extends Ke{_parse(e){if(this._getType(e)!==ge.nan){const r=this._getOrReturnCtx(e);return fe(r,{code:ne.invalid_type,expected:ge.nan,received:r.parsedType}),je}return{status:"valid",value:e.data}}};Xb.create=n=>new Xb({typeName:Y.ZodNaN,...De(n)});const h9=Symbol("zod_brand");let vx=class extends Ke{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}},Sx=class m3 extends Ke{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?je:i.status==="dirty"?(t.dirty(),pl(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?je:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new m3({in:e,out:t,typeName:Y.ZodPipeline})}},Vf=class extends Ke{_parse(e){const t=this._def.innerType._parse(e),r=s=>(lc(s)&&(s.value=Object.freeze(s.value)),s);return If(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}};Vf.create=(n,e)=>new Vf({innerType:n,typeName:Y.ZodReadonly,...De(e)});function HO(n,e={},t){return n?gl.create().superRefine((r,s)=>{var i,a;if(!n(r)){const o=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,u=(a=(i=o.fatal)!==null&&i!==void 0?i:t)!==null&&a!==void 0?a:!0,l=typeof o=="string"?{message:o}:o;s.addIssue({code:"custom",...l,fatal:u})}}):gl.create()}const f9={object:rs.lazycreate};var Y;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(Y||(Y={}));const p9=(n,e={message:`Input not instance of ${n.name}`})=>HO(t=>t instanceof n,e),WO=ml.create,zO=Mf.create,m9=Xb.create,g9=Nf.create,VO=$f.create,y9=jf.create,w9=Vb.create,b9=Lf.create,_9=Ff.create,v9=gl.create,S9=dc.create,x9=Wi.create,E9=Gb.create,k9=hc.create,C9=rs.create,P9=rs.strictCreate,A9=Df.create,T9=BO.create,I9=Bf.create,O9=qa.create,R9=UO.create,M9=Zb.create,N9=Jb.create,$9=qO.create,j9=Uf.create,L9=qf.create,F9=Kf.create,D9=Hf.create,B9=wl.create,GO=vs.create,U9=Ss.create,q9=Ka.create,K9=vs.createWithPreprocess,H9=Sx.create;var pe=Object.freeze({__proto__:null,defaultErrorMap:fl,setErrorMap:KH,getErrorMap:Hb,makeIssue:Wb,EMPTY_PATH:HH,addIssueToContext:fe,ParseStatus:fn,INVALID:je,DIRTY:pl,OK:Jr,isAborted:yx,isDirty:wx,isValid:lc,isAsync:If,get util(){return nt},get objectUtil(){return gx},ZodParsedType:ge,getParsedType:Hi,ZodType:Ke,datetimeRegex:DO,ZodString:ml,ZodNumber:Mf,ZodBigInt:Nf,ZodBoolean:$f,ZodDate:jf,ZodSymbol:Vb,ZodUndefined:Lf,ZodNull:Ff,ZodAny:gl,ZodUnknown:dc,ZodNever:Wi,ZodVoid:Gb,ZodArray:hc,ZodObject:rs,ZodUnion:Df,ZodDiscriminatedUnion:BO,ZodIntersection:Bf,ZodTuple:qa,ZodRecord:UO,ZodMap:Zb,ZodSet:Jb,ZodFunction:qO,ZodLazy:Uf,ZodLiteral:qf,ZodEnum:Kf,ZodNativeEnum:Hf,ZodPromise:wl,ZodEffects:vs,ZodTransformer:vs,ZodOptional:Ss,ZodNullable:Ka,ZodDefault:Wf,ZodCatch:zf,ZodNaN:Xb,BRAND:h9,ZodBranded:vx,ZodPipeline:Sx,ZodReadonly:Vf,custom:HO,Schema:Ke,ZodSchema:Ke,late:f9,get ZodFirstPartyTypeKind(){return Y},coerce:{string:n=>ml.create({...n,coerce:!0}),number:n=>Mf.create({...n,coerce:!0}),boolean:n=>$f.create({...n,coerce:!0}),bigint:n=>Nf.create({...n,coerce:!0}),date:n=>jf.create({...n,coerce:!0})},any:v9,array:k9,bigint:g9,boolean:VO,date:y9,discriminatedUnion:T9,effect:GO,enum:F9,function:$9,instanceof:p9,intersection:I9,lazy:j9,literal:L9,map:M9,nan:m9,nativeEnum:D9,never:x9,null:_9,nullable:q9,number:zO,object:C9,oboolean:()=>VO().optional(),onumber:()=>zO().optional(),optional:U9,ostring:()=>WO().optional(),pipeline:H9,preprocess:K9,promise:B9,record:R9,set:N9,strictObject:P9,string:WO,symbol:w9,transformer:GO,tuple:O9,undefined:b9,union:A9,unknown:S9,void:E9,NEVER:je,ZodIssueCode:ne,quotelessJson:qH,ZodError:_s}),Ae=(n=>(n.SYSTEM="system",n.USER="user",n.PLANNER="planner",n.NAVIGATOR="navigator",n.VALIDATOR="validator",n))(Ae||{}),xx=(n=>(n.EXECUTION="execution",n))(xx||{}),ke=(n=>(n.TASK_START="task.start",n.TASK_OK="task.ok",n.TASK_FAIL="task.fail",n.TASK_PAUSE="task.pause",n.TASK_RESUME="task.resume",n.TASK_CANCEL="task.cancel",n.STEP_START="step.start",n.STEP_OK="step.ok",n.STEP_FAIL="step.fail",n.STEP_CANCEL="step.cancel",n.ACT_START="act.start",n.ACT_OK="act.ok",n.ACT_FAIL="act.fail",n))(ke||{});class W9{constructor(e,t,r,s=Date.now(),i="execution"){this.actor=e,this.state=t,this.data=r,this.timestamp=s,this.type=i}}const z9={maxSteps:100,maxActionsPerStep:10,maxFailures:3,maxValidatorFailures:3,retryDelay:10,maxInputTokens:128e3,maxErrorLength:400,useVision:!1,useVisionForPlanner:!1,validateOutput:!0,includeAttributes:["title","type","name","role","tabindex","aria-label","placeholder","value","alt","aria-expanded"],planningInterval:3};class V9{constructor(e,t,r,s,i){this.taskId=e,this.browserContext=t,this.messageManager=r,this.eventManager=s,this.options={...z9,...i},this.paused=!1,this.stopped=!1,this.nSteps=0,this.consecutiveFailures=0,this.consecutiveValidatorFailures=0,this.stepInfo=null,this.actionResults=[],this.stateMessageAdded=!1}async emitEvent(e,t,r){const s=new W9(e,t,{taskId:this.taskId,step:this.nSteps,maxSteps:this.options.maxSteps,details:r});await this.eventManager.emit(s)}async pause(){this.paused=!0}async resume(){this.paused=!1}async stop(){this.stopped=!0}}class wt{constructor(e={}){this.isDone=e.isDone??!1,this.extractedContent=e.extractedContent??null,this.error=e.error??null,this.includeInMemory=e.includeInMemory??!1}}const G9=pe.object({page_summary:pe.string(),evaluation_previous_goal:pe.string(),memory:pe.string(),next_goal:pe.string()});function ZO(n,e=Ex){n=n.trim();const t=/```(json)?(.*)```/s.exec(n);return e(t?t[2]:n)}function Ex(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="";const t=[];let r=!1,s=!1;for(let i of n){if(r)i==='"'&&!s?r=!1:i===`
`&&!s?i="\\n":i==="\\"?s=!s:s=!1;else if(i==='"')r=!0,s=!1;else if(i==="{")t.push("}");else if(i==="[")t.push("]");else if(i==="}"||i==="]")if(t&&t[t.length-1]===i)t.pop();else return null;e+=i}r&&(e+='"');for(let i=t.length-1;i>=0;i-=1)e+=t[i];try{return JSON.parse(e)}catch{return null}}var kx,JO;function Z9(){return JO||(JO=1,kx=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),kx}var J9=Z9();const X9=Ve(J9);var Yb={exports:{}},XO;function Y9(){if(XO)return Yb.exports;XO=1;const n=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,r=/([\p{Alpha}\p{N}_]|$)/u,s=/[_.\- ]+/,i=new RegExp("^"+s.source),a=new RegExp(s.source+r.source,"gu"),o=new RegExp("\\d+"+r.source,"gu"),u=(f,p,m)=>{let g=!1,y=!1,w=!1;for(let S=0;S<f.length;S++){const _=f[S];g&&n.test(_)?(f=f.slice(0,S)+"-"+f.slice(S),g=!1,w=y,y=!0,S++):y&&w&&e.test(_)?(f=f.slice(0,S-1)+"-"+f.slice(S-1),w=y,y=!1,g=!0):(g=p(_)===_&&m(_)!==_,w=y,y=m(_)===_&&p(_)!==_)}return f},l=(f,p)=>(t.lastIndex=0,f.replace(t,m=>p(m))),d=(f,p)=>(a.lastIndex=0,o.lastIndex=0,f.replace(a,(m,g)=>p(g)).replace(o,m=>p(m))),h=(f,p)=>{if(!(typeof f=="string"||Array.isArray(f)))throw new TypeError("Expected the input to be `string | string[]`");if(p={pascalCase:!1,preserveConsecutiveUppercase:!1,...p},Array.isArray(f)?f=f.map(w=>w.trim()).filter(w=>w.length).join("-"):f=f.trim(),f.length===0)return"";const m=p.locale===!1?w=>w.toLowerCase():w=>w.toLocaleLowerCase(p.locale),g=p.locale===!1?w=>w.toUpperCase():w=>w.toLocaleUpperCase(p.locale);return f.length===1?p.pascalCase?g(f):m(f):(f!==m(f)&&(f=u(f,m,g)),f=f.replace(i,""),p.preserveConsecutiveUppercase?f=l(f,m):f=m(f),p.pascalCase&&(f=g(f.charAt(0))+f.slice(1)),d(f,g))};return Yb.exports=h,Yb.exports.default=h,Yb.exports}Y9();function Q9(n,e){return(e==null?void 0:e[n])||X9(n)}function e6(n,e,t){const r={};for(const s in n)Object.hasOwn(n,s)&&(r[e(s,t)]=n[s]);return r}function YO(n){return Array.isArray(n)?[...n]:{...n}}function t6(n,e){const t=YO(n);for(const[r,s]of Object.entries(e)){const[i,...a]=r.split(".").reverse();let o=t;for(const u of a.reverse()){if(o[u]===void 0)break;o[u]=YO(o[u]),o=o[u]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[s]})}return t}function QO(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}class fc{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,QO(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof fc||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((s,i)=>(s[i]=i in this?this[i]:this.lc_kwargs[i],s),{});for(let s=Object.getPrototypeOf(this);s;s=Object.getPrototypeOf(s))Object.assign(e,Reflect.get(s,"lc_aliases",this)),Object.assign(t,Reflect.get(s,"lc_secrets",this)),Object.assign(r,Reflect.get(s,"lc_attributes",this));return Object.keys(t).forEach(s=>{let i=this,a=r;const[o,...u]=s.split(".").reverse();for(const l of u.reverse()){if(!(l in i)||i[l]===void 0)return;(!(l in a)||a[l]===void 0)&&(typeof i[l]=="object"&&i[l]!=null?a[l]={}:Array.isArray(i[l])&&(a[l]=[])),i=i[l],a=a[l]}o in i&&i[o]!==void 0&&(a[o]=a[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:e6(Object.keys(t).length?t6(r,t):r,Q9,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function bl(n,e){return typeof n=="string"?typeof e=="string"?n+e:[{type:"text",text:n},...e]:Array.isArray(e)?Qb(n,e)??[...n,...e]:[...n,{type:"text",text:e}]}function r6(n,e){return n==="error"||e==="error"?"error":"success"}function n6(n,e){function t(r,s){if(typeof r!="object"||r===null||r===void 0)return r;if(s>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(a=>t(a,s+1));const i={};for(const a of Object.keys(r))i[a]=t(r[a],s+1);return i}return JSON.stringify(t(n,0),null,2)}class _l extends fc{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=n6(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function Xr(n,e){const t={...n};for(const[r,s]of Object.entries(e))if(t[r]==null)t[r]=s;else{if(s==null)continue;if(typeof t[r]!=typeof s||Array.isArray(t[r])!==Array.isArray(s))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;t[r]+=s}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=Xr(t[r],s);else if(Array.isArray(t[r]))t[r]=Qb(t[r],s);else{if(t[r]===s)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function Qb(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{const t=[...n];for(const r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){const s=t.findIndex(i=>i.index===r.index);s!==-1?t[s]=Xr(t[s],r):t.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}function s6(n,e){if(!n&&!e)throw new Error("Cannot merge two undefined objects.");if(!n||!e)return n||e;if(typeof n!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof n}
Right ${typeof e}`);if(typeof n=="string"&&typeof e=="string")return n+e;if(Array.isArray(n)&&Array.isArray(e))return Qb(n,e);if(typeof n=="object"&&typeof e=="object")return Xr(n,e);if(n===e)return n;throw new Error(`Can not merge objects of different types.
Left ${n}
Right ${e}`)}class vl extends _l{}function i6(n){return typeof n.role=="string"}function Gf(n){return typeof(n==null?void 0:n._getType)=="function"}function a6(n){return Gf(n)&&typeof n.concat=="function"}class e_ extends _l{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class t_ extends vl{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new t_({content:bl(this.content,e.content),additional_kwargs:Xr(this.additional_kwargs,e.additional_kwargs),response_metadata:Xr(this.response_metadata,e.response_metadata),artifact:s6(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:r6(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function o6(n){const e=[],t=[];for(const r of n)if(r.function){const s=r.function.name;try{const i=JSON.parse(r.function.arguments),a={name:s||"",args:i||{},id:r.id};e.push(a)}catch{t.push({name:s,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,t]}class Dr extends _l{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var s;let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;const i=(s=r.additional_kwargs)==null?void 0:s.tool_calls,a=r.tool_calls;i!=null&&i.length>0&&(a===void 0||a.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(i!=null&&a===void 0){const[o,u]=o6(i);r.tool_calls=o??[],r.invalid_tool_calls=u??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function pc(n){return n._getType()==="ai"}function eR(n){return n._getType()==="ai"}class nr extends vl{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const r=[],s=[];for(const i of e.tool_call_chunks){let a={};try{if(a=Ex(i.args||"{}"),a===null||typeof a!="object"||Array.isArray(a))throw new Error("Malformed tool call chunk args.");r.push({name:i.name??"",args:a,id:i.id,type:"tool_call"})}catch{s.push({name:i.name,args:i.args,id:i.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:s,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var r,s,i,a,o,u,l,d,h,f,p,m,g,y,w,S,_,v,A,k,C,E,N,I,$,O,T,L,U,J,F,j,B,D,z,G,te,V,K,ae;const t={content:bl(this.content,e.content),additional_kwargs:Xr(this.additional_kwargs,e.additional_kwargs),response_metadata:Xr(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const ve=Qb(this.tool_call_chunks,e.tool_call_chunks);ve!==void 0&&ve.length>0&&(t.tool_call_chunks=ve)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const ve={...(((s=(r=this.usage_metadata)==null?void 0:r.input_token_details)==null?void 0:s.audio)!==void 0||((a=(i=e.usage_metadata)==null?void 0:i.input_token_details)==null?void 0:a.audio)!==void 0)&&{audio:(((u=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:u.audio)??0)+(((d=(l=e.usage_metadata)==null?void 0:l.input_token_details)==null?void 0:d.audio)??0)},...(((f=(h=this.usage_metadata)==null?void 0:h.input_token_details)==null?void 0:f.cache_read)!==void 0||((m=(p=e.usage_metadata)==null?void 0:p.input_token_details)==null?void 0:m.cache_read)!==void 0)&&{cache_read:(((y=(g=this.usage_metadata)==null?void 0:g.input_token_details)==null?void 0:y.cache_read)??0)+(((S=(w=e.usage_metadata)==null?void 0:w.input_token_details)==null?void 0:S.cache_read)??0)},...(((v=(_=this.usage_metadata)==null?void 0:_.input_token_details)==null?void 0:v.cache_creation)!==void 0||((k=(A=e.usage_metadata)==null?void 0:A.input_token_details)==null?void 0:k.cache_creation)!==void 0)&&{cache_creation:(((E=(C=this.usage_metadata)==null?void 0:C.input_token_details)==null?void 0:E.cache_creation)??0)+(((I=(N=e.usage_metadata)==null?void 0:N.input_token_details)==null?void 0:I.cache_creation)??0)}},de={...(((O=($=this.usage_metadata)==null?void 0:$.output_token_details)==null?void 0:O.audio)!==void 0||((L=(T=e.usage_metadata)==null?void 0:T.output_token_details)==null?void 0:L.audio)!==void 0)&&{audio:(((J=(U=this.usage_metadata)==null?void 0:U.output_token_details)==null?void 0:J.audio)??0)+(((j=(F=e.usage_metadata)==null?void 0:F.output_token_details)==null?void 0:j.audio)??0)},...(((D=(B=this.usage_metadata)==null?void 0:B.output_token_details)==null?void 0:D.reasoning)!==void 0||((G=(z=e.usage_metadata)==null?void 0:z.output_token_details)==null?void 0:G.reasoning)!==void 0)&&{reasoning:(((V=(te=this.usage_metadata)==null?void 0:te.output_token_details)==null?void 0:V.reasoning)??0)+(((ae=(K=e.usage_metadata)==null?void 0:K.output_token_details)==null?void 0:ae.reasoning)??0)}},et=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},we=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},R={input_tokens:et.input_tokens+we.input_tokens,output_tokens:et.output_tokens+we.output_tokens,total_tokens:et.total_tokens+we.total_tokens,...Object.keys(ve).length>0&&{input_token_details:ve},...Object.keys(de).length>0&&{output_token_details:de}};t.usage_metadata=R}return new nr(t)}}class Ha extends _l{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Ha}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class Zf extends vl{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Zf({content:bl(this.content,e.content),additional_kwargs:Xr(this.additional_kwargs,e.additional_kwargs),response_metadata:Xr(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class Jf extends vl{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Jf({content:bl(this.content,e.content),additional_kwargs:Xr(this.additional_kwargs,e.additional_kwargs),response_metadata:Xr(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class Bt extends _l{static lc_name(){return"HumanMessage"}_getType(){return"human"}}class Xf extends vl{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new Xf({content:bl(this.content,e.content),additional_kwargs:Xr(this.additional_kwargs,e.additional_kwargs),response_metadata:Xr(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class Sl extends _l{static lc_name(){return"SystemMessage"}_getType(){return"system"}}class mc extends vl{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new mc({content:bl(this.content,e.content),additional_kwargs:Xr(this.additional_kwargs,e.additional_kwargs),response_metadata:Xr(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function Cx(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function tR(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}class c6 extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function u6(n){return tR(n)?n:typeof n.id=="string"&&n.type==="function"&&typeof n.function=="object"&&n.function!==null&&"arguments"in n.function&&typeof n.function.arguments=="string"&&"name"in n.function&&typeof n.function.name=="string"?{id:n.id,args:JSON.parse(n.function.arguments),name:n.function.name,type:"tool_call"}:n}function l6(n){return typeof n=="object"&&n!=null&&n.lc===1&&Array.isArray(n.id)&&n.kwargs!=null&&typeof n.kwargs=="object"}function Px(n){let e,t;if(l6(n)){const r=n.id.at(-1);r==="HumanMessage"||r==="HumanMessageChunk"?e="user":r==="AIMessage"||r==="AIMessageChunk"?e="assistant":r==="SystemMessage"||r==="SystemMessageChunk"?e="system":e="unknown",t=n.kwargs}else{const{type:r,...s}=n;e=r,t=s}if(e==="human"||e==="user")return new Bt(t);if(e==="ai"||e==="assistant"){const{tool_calls:r,...s}=t;if(!Array.isArray(r))return new Dr(t);const i=r.map(u6);return new Dr({...s,tool_calls:i})}else{if(e==="system")return new Sl(t);if(e==="developer")return new Sl({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new e_({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw Cx(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(n,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function Yf(n){if(typeof n=="string")return new Bt(n);if(Gf(n))return n;if(Array.isArray(n)){const[e,t]=n;return Px({type:e,content:t})}else if(i6(n)){const{role:e,...t}=n;return Px({...t,type:e})}else return Px(n)}function rR(n,e="Human",t="AI"){const r=[];for(const s of n){let i;if(s._getType()==="human")i=e;else if(s._getType()==="ai")i=t;else if(s._getType()==="system")i="System";else if(s._getType()==="function")i="Function";else if(s._getType()==="tool")i="Tool";else if(s._getType()==="generic")i=s.role;else throw new Error(`Got unsupported message type: ${s._getType()}`);const a=s.name?`${s.name}, `:"",o=typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2);r.push(`${i}: ${a}${o}`)}return r.join(`
`)}function d6(n){var t;const e=n._getType();if(e==="human")return new Xf({...n});if(e==="ai"){let r={...n};return"tool_calls"in r&&(r={...r,tool_call_chunks:(t=r.tool_calls)==null?void 0:t.map(s=>({...s,type:"tool_call_chunk",index:void 0,args:JSON.stringify(s.args)}))}),new nr({...r})}else{if(e==="system")return new mc({...n});if(e==="function")return new Jf({...n});if(Ha.isInstance(n))return new Zf({...n});throw new Error("Unknown message type.")}}var Qf={exports:{}},Ax={},Tx,nR;function h6(){if(nR)return Tx;nR=1;function n(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return Tx=n,n.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},n.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},n.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var s=this;return this._timer=setTimeout(function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout(function(){s._operationTimeoutCb(s._attempts)},s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)},r),this._options.unref&&this._timer.unref(),!0},n.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},n.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},n.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},n.prototype.start=n.prototype.try,n.prototype.errors=function(){return this._errors},n.prototype.attempts=function(){return this._attempts},n.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,r=0,s=0;s<this._errors.length;s++){var i=this._errors[s],a=i.message,o=(e[a]||0)+1;e[a]=o,o>=r&&(t=i,r=o)}return t},Tx}var sR;function f6(){return sR||(sR=1,function(n){var e=h6();n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)r[s]=t[s];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],a=0;a<r.retries;a++)i.push(this.createTimeout(a,r));return t&&t.forever&&!i.length&&i.push(this.createTimeout(a,r)),i.sort(function(o,u){return o-u}),i},n.createTimeout=function(t,r){var s=r.randomize?Math.random()+1:1,i=Math.round(s*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return i=Math.min(i,r.maxTimeout),i},n.wrap=function(t,r,s){if(r instanceof Array&&(s=r,r=null),!s){s=[];for(var i in t)typeof t[i]=="function"&&s.push(i)}for(var a=0;a<s.length;a++){var o=s[a],u=t[o];t[o]=(function(d){var h=n.operation(r),f=Array.prototype.slice.call(arguments,1),p=f.pop();f.push(function(m){h.retry(m)||(m&&(arguments[0]=h.mainError()),p.apply(this,arguments))}),h.attempt(function(){d.apply(t,f)})}).bind(t,u),t[o].options=r}}}(Ax)),Ax}var Ix,iR;function p6(){return iR||(iR=1,Ix=f6()),Ix}var aR;function m6(){if(aR)return Qf.exports;aR=1;const n=p6(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(o){super(),o instanceof Error?(this.originalError=o,{message:o}=o):(this.originalError=new Error(o),this.originalError.stack=this.stack),this.name="AbortError",this.message=o}}const r=(a,o,u)=>{const l=u.retries-(o-1);return a.attemptNumber=o,a.retriesLeft=l,a},s=a=>e.includes(a),i=(a,o)=>new Promise((u,l)=>{o={onFailedAttempt:()=>{},retries:10,...o};const d=n.operation(o);d.attempt(async h=>{try{u(await a(h))}catch(f){if(!(f instanceof Error)){l(new TypeError(`Non-error was thrown: "${f}". You should only throw errors.`));return}if(f instanceof t)d.stop(),l(f.originalError);else if(f instanceof TypeError&&!s(f.message))d.stop(),l(f);else{r(f,h,o);try{await o.onFailedAttempt(f)}catch(p){l(p);return}d.retry(f)||l(d.mainError())}}})});return Qf.exports=i,Qf.exports.default=i,Qf.exports.AbortError=t,Qf.exports}var g6=m6();const r_=Ve(g6),y6=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function ep(n){return typeof n=="string"&&y6.test(n)}for(var Mr=[],Ox=0;Ox<256;++Ox)Mr.push((Ox+256).toString(16).slice(1));function w6(n,e=0){return(Mr[n[e+0]]+Mr[n[e+1]]+Mr[n[e+2]]+Mr[n[e+3]]+"-"+Mr[n[e+4]]+Mr[n[e+5]]+"-"+Mr[n[e+6]]+Mr[n[e+7]]+"-"+Mr[n[e+8]]+Mr[n[e+9]]+"-"+Mr[n[e+10]]+Mr[n[e+11]]+Mr[n[e+12]]+Mr[n[e+13]]+Mr[n[e+14]]+Mr[n[e+15]]).toLowerCase()}var n_,b6=new Uint8Array(16);function _6(){if(!n_&&(n_=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!n_))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n_(b6)}var v6=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const oR={randomUUID:v6};function Yr(n,e,t){if(oR.randomUUID&&!e&&!n)return oR.randomUUID();n=n||{};var r=n.random||(n.rng||_6)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,w6(r)}var s_={},Rx={exports:{}},cR;function S6(){return cR||(cR=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(u,l,d){this.fn=u,this.context=l,this.once=d||!1}function i(u,l,d,h,f){if(typeof d!="function")throw new TypeError("The listener must be a function");var p=new s(d,h||u,f),m=t?t+l:l;return u._events[m]?u._events[m].fn?u._events[m]=[u._events[m],p]:u._events[m].push(p):(u._events[m]=p,u._eventsCount++),u}function a(u,l){--u._eventsCount===0?u._events=new r:delete u._events[l]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],d,h;if(this._eventsCount===0)return l;for(h in d=this._events)e.call(d,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},o.prototype.listeners=function(l){var d=t?t+l:l,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,p=h.length,m=new Array(p);f<p;f++)m[f]=h[f].fn;return m},o.prototype.listenerCount=function(l){var d=t?t+l:l,h=this._events[d];return h?h.fn?1:h.length:0},o.prototype.emit=function(l,d,h,f,p,m){var g=t?t+l:l;if(!this._events[g])return!1;var y=this._events[g],w=arguments.length,S,_;if(y.fn){switch(y.once&&this.removeListener(l,y.fn,void 0,!0),w){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,d),!0;case 3:return y.fn.call(y.context,d,h),!0;case 4:return y.fn.call(y.context,d,h,f),!0;case 5:return y.fn.call(y.context,d,h,f,p),!0;case 6:return y.fn.call(y.context,d,h,f,p,m),!0}for(_=1,S=new Array(w-1);_<w;_++)S[_-1]=arguments[_];y.fn.apply(y.context,S)}else{var v=y.length,A;for(_=0;_<v;_++)switch(y[_].once&&this.removeListener(l,y[_].fn,void 0,!0),w){case 1:y[_].fn.call(y[_].context);break;case 2:y[_].fn.call(y[_].context,d);break;case 3:y[_].fn.call(y[_].context,d,h);break;case 4:y[_].fn.call(y[_].context,d,h,f);break;default:if(!S)for(A=1,S=new Array(w-1);A<w;A++)S[A-1]=arguments[A];y[_].fn.apply(y[_].context,S)}}return!0},o.prototype.on=function(l,d,h){return i(this,l,d,h,!1)},o.prototype.once=function(l,d,h){return i(this,l,d,h,!0)},o.prototype.removeListener=function(l,d,h,f){var p=t?t+l:l;if(!this._events[p])return this;if(!d)return a(this,p),this;var m=this._events[p];if(m.fn)m.fn===d&&(!f||m.once)&&(!h||m.context===h)&&a(this,p);else{for(var g=0,y=[],w=m.length;g<w;g++)(m[g].fn!==d||f&&!m[g].once||h&&m[g].context!==h)&&y.push(m[g]);y.length?this._events[p]=y.length===1?y[0]:y:a(this,p)}return this},o.prototype.removeAllListeners=function(l){var d;return l?(d=t?t+l:l,this._events[d]&&a(this,d)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o}(Rx)),Rx.exports}var tp={exports:{}},Mx,uR;function x6(){return uR||(uR=1,Mx=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})))),Mx}var lR;function E6(){if(lR)return tp.exports;lR=1;const n=x6();class e extends Error{constructor(s){super(s),this.name="TimeoutError"}}const t=(r,s,i)=>new Promise((a,o)=>{if(typeof s!="number"||s<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(s===1/0){a(r);return}const u=setTimeout(()=>{if(typeof i=="function"){try{a(i())}catch(h){o(h)}return}const l=typeof i=="string"?i:`Promise timed out after ${s} milliseconds`,d=i instanceof Error?i:new e(l);typeof r.cancel=="function"&&r.cancel(),o(d)},s);n(r.then(a,o),()=>{clearTimeout(u)})});return tp.exports=t,tp.exports.default=t,tp.exports.TimeoutError=e,tp.exports}var i_={},a_={},dR;function k6(){if(dR)return a_;dR=1,Object.defineProperty(a_,"__esModule",{value:!0});function n(e,t,r){let s=0,i=e.length;for(;i>0;){const a=i/2|0;let o=s+a;r(e[o],t)<=0?(s=++o,i-=a+1):i=a}return s}return a_.default=n,a_}var hR;function C6(){if(hR)return i_;hR=1,Object.defineProperty(i_,"__esModule",{value:!0});const n=k6();class e{constructor(){this._queue=[]}enqueue(r,s){s=Object.assign({priority:0},s);const i={priority:s.priority,run:r};if(this.size&&this._queue[this.size-1].priority>=s.priority){this._queue.push(i);return}const a=n.default(this._queue,i,(o,u)=>u.priority-o.priority);this._queue.splice(a,0,i)}dequeue(){const r=this._queue.shift();return r==null?void 0:r.run}filter(r){return this._queue.filter(s=>s.priority===r.priority).map(s=>s.run)}get size(){return this._queue.length}}return i_.default=e,i_}var fR;function P6(){if(fR)return s_;fR=1,Object.defineProperty(s_,"__esModule",{value:!0});const n=S6(),e=E6(),t=C6(),r=()=>{},s=new e.TimeoutError;class i extends n{constructor(o){var u,l,d,h;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=r,this._resolveIdle=r,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(l=(u=o.intervalCap)===null||u===void 0?void 0:u.toString())!==null&&l!==void 0?l:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(h=(d=o.interval)===null||d===void 0?void 0:d.toString())!==null&&h!==void 0?h:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=r,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=r,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const u=this._intervalEnd-o;if(u<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},u)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const u=this._queue.dequeue();return u?(this.emit("active"),u(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,u={}){return new Promise((l,d)=>{const h=async()=>{this._pendingCount++,this._intervalCount++;try{const f=this._timeout===void 0&&u.timeout===void 0?o():e.default(Promise.resolve(o()),u.timeout===void 0?this._timeout:u.timeout,()=>{(u.throwOnTimeout===void 0?this._throwOnTimeout:u.throwOnTimeout)&&d(s)});l(await f)}catch(f){d(f)}this._next()};this._queue.enqueue(h,u),this._tryToStartAnother(),this.emit("add")})}async addAll(o,u){return Promise.all(o.map(async l=>this.add(l,u)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const u=this._resolveEmpty;this._resolveEmpty=()=>{u(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const u=this._resolveIdle;this._resolveIdle=()=>{u(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return s_.default=i,s_}var A6=P6();const Vi=Ve(A6),T6=(...n)=>fetch(...n),I6=Symbol.for("ls:fetch_implementation"),Pe=()=>globalThis[I6]??T6,O6=[400,401,403,404,405,406,407,408],R6=[409];let pR=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Vi?this.queue=new Vi.default({concurrency:this.maxConcurrency}):this.queue=new Vi({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const r=this.onFailedResponseHook;return this.queue.add(()=>r_(()=>e(...t).catch(s=>{throw s instanceof Error?s:new Error(s)}),{async onFailedAttempt(s){if(s.message.startsWith("Cancel")||s.message.startsWith("TimeoutError")||s.message.startsWith("AbortError")||(s==null?void 0:s.code)==="ECONNABORTED")throw s;const i=s==null?void 0:s.response,a=i==null?void 0:i.status;if(a){if(O6.includes(+a))throw s;if(R6.includes(+a))return;r&&await r(i)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>Pe()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function mR(n){return typeof(n==null?void 0:n._getType)=="function"}function gR(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}function qe(n,e){if(!ep(n)){const t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}const yR={};function wR(n){yR[n]||(console.warn(n),yR[n]=!0)}var o_={exports:{}},Nx,bR;function c_(){if(bR)return Nx;bR=1;const n="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,r=16,s=e-6;return Nx={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:s,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:n,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Nx}var $x,_R;function u_(){return _R||(_R=1,$x=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{}),$x}var vR;function rp(){return vR||(vR=1,function(n,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:s}=c_(),i=u_();e=n.exports={};const a=e.re=[],o=e.safeRe=[],u=e.src=[],l=e.t={};let d=0;const h="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",s],[h,r]],p=g=>{for(const[y,w]of f)g=g.split(`${y}*`).join(`${y}{0,${w}}`).split(`${y}+`).join(`${y}{1,${w}}`);return g},m=(g,y,w)=>{const S=p(y),_=d++;i(g,_,y),l[g]=_,u[_]=y,a[_]=new RegExp(y,w?"g":void 0),o[_]=new RegExp(S,w?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${h}*`),m("MAINVERSION",`(${u[l.NUMERICIDENTIFIER]})\\.(${u[l.NUMERICIDENTIFIER]})\\.(${u[l.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${u[l.NUMERICIDENTIFIERLOOSE]})\\.(${u[l.NUMERICIDENTIFIERLOOSE]})\\.(${u[l.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${u[l.NUMERICIDENTIFIER]}|${u[l.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${u[l.NUMERICIDENTIFIERLOOSE]}|${u[l.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${u[l.PRERELEASEIDENTIFIER]}(?:\\.${u[l.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${u[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[l.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${h}+`),m("BUILD",`(?:\\+(${u[l.BUILDIDENTIFIER]}(?:\\.${u[l.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${u[l.MAINVERSION]}${u[l.PRERELEASE]}?${u[l.BUILD]}?`),m("FULL",`^${u[l.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${u[l.MAINVERSIONLOOSE]}${u[l.PRERELEASELOOSE]}?${u[l.BUILD]}?`),m("LOOSE",`^${u[l.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${u[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${u[l.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${u[l.XRANGEIDENTIFIER]})(?:\\.(${u[l.XRANGEIDENTIFIER]})(?:\\.(${u[l.XRANGEIDENTIFIER]})(?:${u[l.PRERELEASE]})?${u[l.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${u[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[l.XRANGEIDENTIFIERLOOSE]})(?:${u[l.PRERELEASELOOSE]})?${u[l.BUILD]}?)?)?`),m("XRANGE",`^${u[l.GTLT]}\\s*${u[l.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${u[l.GTLT]}\\s*${u[l.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${u[l.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",u[l.COERCEPLAIN]+`(?:${u[l.PRERELEASE]})?(?:${u[l.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",u[l.COERCE],!0),m("COERCERTLFULL",u[l.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${u[l.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${u[l.LONETILDE]}${u[l.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${u[l.LONETILDE]}${u[l.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${u[l.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${u[l.LONECARET]}${u[l.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${u[l.LONECARET]}${u[l.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${u[l.GTLT]}\\s*(${u[l.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${u[l.GTLT]}\\s*(${u[l.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${u[l.GTLT]}\\s*(${u[l.LOOSEPLAIN]}|${u[l.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${u[l.XRANGEPLAIN]})\\s+-\\s+(${u[l.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${u[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[l.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(o_,o_.exports)),o_.exports}var jx,SR;function Lx(){if(SR)return jx;SR=1;const n=Object.freeze({loose:!0}),e=Object.freeze({});return jx=r=>r?typeof r!="object"?n:r:e,jx}var Fx,xR;function ER(){if(xR)return Fx;xR=1;const n=/^[0-9]+$/,e=(r,s)=>{const i=n.test(r),a=n.test(s);return i&&a&&(r=+r,s=+s),r===s?0:i&&!a?-1:a&&!i?1:r<s?-1:1};return Fx={compareIdentifiers:e,rcompareIdentifiers:(r,s)=>e(s,r)},Fx}var Dx,kR;function Qr(){if(kR)return Dx;kR=1;const n=u_(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=c_(),{safeRe:r,t:s}=rp(),i=Lx(),{compareIdentifiers:a}=ER();class o{constructor(l,d){if(d=i(d),l instanceof o){if(l.loose===!!d.loose&&l.includePrerelease===!!d.includePrerelease)return l;l=l.version}else if(typeof l!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof l}".`);if(l.length>e)throw new TypeError(`version is longer than ${e} characters`);n("SemVer",l,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const h=l.trim().match(d.loose?r[s.LOOSE]:r[s.FULL]);if(!h)throw new TypeError(`Invalid Version: ${l}`);if(this.raw=l,this.major=+h[1],this.minor=+h[2],this.patch=+h[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");h[4]?this.prerelease=h[4].split(".").map(f=>{if(/^[0-9]+$/.test(f)){const p=+f;if(p>=0&&p<t)return p}return f}):this.prerelease=[],this.build=h[5]?h[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(l){if(n("SemVer.compare",this.version,this.options,l),!(l instanceof o)){if(typeof l=="string"&&l===this.version)return 0;l=new o(l,this.options)}return l.version===this.version?0:this.compareMain(l)||this.comparePre(l)}compareMain(l){return l instanceof o||(l=new o(l,this.options)),a(this.major,l.major)||a(this.minor,l.minor)||a(this.patch,l.patch)}comparePre(l){if(l instanceof o||(l=new o(l,this.options)),this.prerelease.length&&!l.prerelease.length)return-1;if(!this.prerelease.length&&l.prerelease.length)return 1;if(!this.prerelease.length&&!l.prerelease.length)return 0;let d=0;do{const h=this.prerelease[d],f=l.prerelease[d];if(n("prerelease compare",d,h,f),h===void 0&&f===void 0)return 0;if(f===void 0)return 1;if(h===void 0)return-1;if(h===f)continue;return a(h,f)}while(++d)}compareBuild(l){l instanceof o||(l=new o(l,this.options));let d=0;do{const h=this.build[d],f=l.build[d];if(n("build compare",d,h,f),h===void 0&&f===void 0)return 0;if(f===void 0)return 1;if(h===void 0)return-1;if(h===f)continue;return a(h,f)}while(++d)}inc(l,d,h){switch(l){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",d,h);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",d,h);break;case"prepatch":this.prerelease.length=0,this.inc("patch",d,h),this.inc("pre",d,h);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",d,h),this.inc("pre",d,h);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const f=Number(h)?1:0;if(!d&&h===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[f];else{let p=this.prerelease.length;for(;--p>=0;)typeof this.prerelease[p]=="number"&&(this.prerelease[p]++,p=-2);if(p===-1){if(d===this.prerelease.join(".")&&h===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(f)}}if(d){let p=[d,f];h===!1&&(p=[d]),a(this.prerelease[0],d)===0?isNaN(this.prerelease[1])&&(this.prerelease=p):this.prerelease=p}break}default:throw new Error(`invalid increment argument: ${l}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return Dx=o,Dx}var Bx,CR;function xl(){if(CR)return Bx;CR=1;const n=Qr();return Bx=(t,r,s=!1)=>{if(t instanceof n)return t;try{return new n(t,r)}catch(i){if(!s)return null;throw i}},Bx}var Ux,PR;function M6(){if(PR)return Ux;PR=1;const n=xl();return Ux=(t,r)=>{const s=n(t,r);return s?s.version:null},Ux}var qx,AR;function N6(){if(AR)return qx;AR=1;const n=xl();return qx=(t,r)=>{const s=n(t.trim().replace(/^[=v]+/,""),r);return s?s.version:null},qx}var Kx,TR;function $6(){if(TR)return Kx;TR=1;const n=Qr();return Kx=(t,r,s,i,a)=>{typeof s=="string"&&(a=i,i=s,s=void 0);try{return new n(t instanceof n?t.version:t,s).inc(r,i,a).version}catch{return null}},Kx}var Hx,IR;function j6(){if(IR)return Hx;IR=1;const n=xl();return Hx=(t,r)=>{const s=n(t,null,!0),i=n(r,null,!0),a=s.compare(i);if(a===0)return null;const o=a>0,u=o?s:i,l=o?i:s,d=!!u.prerelease.length;if(!!l.prerelease.length&&!d)return!l.patch&&!l.minor?"major":u.patch?"patch":u.minor?"minor":"major";const f=d?"pre":"";return s.major!==i.major?f+"major":s.minor!==i.minor?f+"minor":s.patch!==i.patch?f+"patch":"prerelease"},Hx}var Wx,OR;function L6(){if(OR)return Wx;OR=1;const n=Qr();return Wx=(t,r)=>new n(t,r).major,Wx}var zx,RR;function F6(){if(RR)return zx;RR=1;const n=Qr();return zx=(t,r)=>new n(t,r).minor,zx}var Vx,MR;function D6(){if(MR)return Vx;MR=1;const n=Qr();return Vx=(t,r)=>new n(t,r).patch,Vx}var Gx,NR;function B6(){if(NR)return Gx;NR=1;const n=xl();return Gx=(t,r)=>{const s=n(t,r);return s&&s.prerelease.length?s.prerelease:null},Gx}var Zx,$R;function xs(){if($R)return Zx;$R=1;const n=Qr();return Zx=(t,r,s)=>new n(t,s).compare(new n(r,s)),Zx}var Jx,jR;function U6(){if(jR)return Jx;jR=1;const n=xs();return Jx=(t,r,s)=>n(r,t,s),Jx}var Xx,LR;function q6(){if(LR)return Xx;LR=1;const n=xs();return Xx=(t,r)=>n(t,r,!0),Xx}var Yx,FR;function Qx(){if(FR)return Yx;FR=1;const n=Qr();return Yx=(t,r,s)=>{const i=new n(t,s),a=new n(r,s);return i.compare(a)||i.compareBuild(a)},Yx}var eE,DR;function K6(){if(DR)return eE;DR=1;const n=Qx();return eE=(t,r)=>t.sort((s,i)=>n(s,i,r)),eE}var tE,BR;function H6(){if(BR)return tE;BR=1;const n=Qx();return tE=(t,r)=>t.sort((s,i)=>n(i,s,r)),tE}var rE,UR;function l_(){if(UR)return rE;UR=1;const n=xs();return rE=(t,r,s)=>n(t,r,s)>0,rE}var nE,qR;function sE(){if(qR)return nE;qR=1;const n=xs();return nE=(t,r,s)=>n(t,r,s)<0,nE}var iE,KR;function HR(){if(KR)return iE;KR=1;const n=xs();return iE=(t,r,s)=>n(t,r,s)===0,iE}var aE,WR;function zR(){if(WR)return aE;WR=1;const n=xs();return aE=(t,r,s)=>n(t,r,s)!==0,aE}var oE,VR;function cE(){if(VR)return oE;VR=1;const n=xs();return oE=(t,r,s)=>n(t,r,s)>=0,oE}var uE,GR;function lE(){if(GR)return uE;GR=1;const n=xs();return uE=(t,r,s)=>n(t,r,s)<=0,uE}var dE,ZR;function JR(){if(ZR)return dE;ZR=1;const n=HR(),e=zR(),t=l_(),r=cE(),s=sE(),i=lE();return dE=(o,u,l,d)=>{switch(u){case"===":return typeof o=="object"&&(o=o.version),typeof l=="object"&&(l=l.version),o===l;case"!==":return typeof o=="object"&&(o=o.version),typeof l=="object"&&(l=l.version),o!==l;case"":case"=":case"==":return n(o,l,d);case"!=":return e(o,l,d);case">":return t(o,l,d);case">=":return r(o,l,d);case"<":return s(o,l,d);case"<=":return i(o,l,d);default:throw new TypeError(`Invalid operator: ${u}`)}},dE}var hE,XR;function W6(){if(XR)return hE;XR=1;const n=Qr(),e=xl(),{safeRe:t,t:r}=rp();return hE=(i,a)=>{if(i instanceof n)return i;if(typeof i=="number"&&(i=String(i)),typeof i!="string")return null;a=a||{};let o=null;if(!a.rtl)o=i.match(a.includePrerelease?t[r.COERCEFULL]:t[r.COERCE]);else{const p=a.includePrerelease?t[r.COERCERTLFULL]:t[r.COERCERTL];let m;for(;(m=p.exec(i))&&(!o||o.index+o[0].length!==i.length);)(!o||m.index+m[0].length!==o.index+o[0].length)&&(o=m),p.lastIndex=m.index+m[1].length+m[2].length;p.lastIndex=-1}if(o===null)return null;const u=o[2],l=o[3]||"0",d=o[4]||"0",h=a.includePrerelease&&o[5]?`-${o[5]}`:"",f=a.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${u}.${l}.${d}${h}${f}`,a)},hE}var fE,YR;function z6(){if(YR)return fE;YR=1;class n{constructor(){this.max=1e3,this.map=new Map}get(t){const r=this.map.get(t);if(r!==void 0)return this.map.delete(t),this.map.set(t,r),r}delete(t){return this.map.delete(t)}set(t,r){if(!this.delete(t)&&r!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(t,r)}return this}}return fE=n,fE}var pE,QR;function Es(){if(QR)return pE;QR=1;const n=/\s+/g;class e{constructor(U,J){if(J=s(J),U instanceof e)return U.loose===!!J.loose&&U.includePrerelease===!!J.includePrerelease?U:new e(U.raw,J);if(U instanceof i)return this.raw=U.value,this.set=[[U]],this.formatted=void 0,this;if(this.options=J,this.loose=!!J.loose,this.includePrerelease=!!J.includePrerelease,this.raw=U.trim().replace(n," "),this.set=this.raw.split("||").map(F=>this.parseRange(F.trim())).filter(F=>F.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const F=this.set[0];if(this.set=this.set.filter(j=>!g(j[0])),this.set.length===0)this.set=[F];else if(this.set.length>1){for(const j of this.set)if(j.length===1&&y(j[0])){this.set=[j];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let U=0;U<this.set.length;U++){U>0&&(this.formatted+="||");const J=this.set[U];for(let F=0;F<J.length;F++)F>0&&(this.formatted+=" "),this.formatted+=J[F].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(U){const F=((this.options.includePrerelease&&p)|(this.options.loose&&m))+":"+U,j=r.get(F);if(j)return j;const B=this.options.loose,D=B?u[l.HYPHENRANGELOOSE]:u[l.HYPHENRANGE];U=U.replace(D,O(this.options.includePrerelease)),a("hyphen replace",U),U=U.replace(u[l.COMPARATORTRIM],d),a("comparator trim",U),U=U.replace(u[l.TILDETRIM],h),a("tilde trim",U),U=U.replace(u[l.CARETTRIM],f),a("caret trim",U);let z=U.split(" ").map(K=>S(K,this.options)).join(" ").split(/\s+/).map(K=>$(K,this.options));B&&(z=z.filter(K=>(a("loose invalid filter",K,this.options),!!K.match(u[l.COMPARATORLOOSE])))),a("range list",z);const G=new Map,te=z.map(K=>new i(K,this.options));for(const K of te){if(g(K))return[K];G.set(K.value,K)}G.size>1&&G.has("")&&G.delete("");const V=[...G.values()];return r.set(F,V),V}intersects(U,J){if(!(U instanceof e))throw new TypeError("a Range is required");return this.set.some(F=>w(F,J)&&U.set.some(j=>w(j,J)&&F.every(B=>j.every(D=>B.intersects(D,J)))))}test(U){if(!U)return!1;if(typeof U=="string")try{U=new o(U,this.options)}catch{return!1}for(let J=0;J<this.set.length;J++)if(T(this.set[J],U,this.options))return!0;return!1}}pE=e;const t=z6(),r=new t,s=Lx(),i=d_(),a=u_(),o=Qr(),{safeRe:u,t:l,comparatorTrimReplace:d,tildeTrimReplace:h,caretTrimReplace:f}=rp(),{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:m}=c_(),g=L=>L.value==="<0.0.0-0",y=L=>L.value==="",w=(L,U)=>{let J=!0;const F=L.slice();let j=F.pop();for(;J&&F.length;)J=F.every(B=>j.intersects(B,U)),j=F.pop();return J},S=(L,U)=>(a("comp",L,U),L=k(L,U),a("caret",L),L=v(L,U),a("tildes",L),L=E(L,U),a("xrange",L),L=I(L,U),a("stars",L),L),_=L=>!L||L.toLowerCase()==="x"||L==="*",v=(L,U)=>L.trim().split(/\s+/).map(J=>A(J,U)).join(" "),A=(L,U)=>{const J=U.loose?u[l.TILDELOOSE]:u[l.TILDE];return L.replace(J,(F,j,B,D,z)=>{a("tilde",L,F,j,B,D,z);let G;return _(j)?G="":_(B)?G=`>=${j}.0.0 <${+j+1}.0.0-0`:_(D)?G=`>=${j}.${B}.0 <${j}.${+B+1}.0-0`:z?(a("replaceTilde pr",z),G=`>=${j}.${B}.${D}-${z} <${j}.${+B+1}.0-0`):G=`>=${j}.${B}.${D} <${j}.${+B+1}.0-0`,a("tilde return",G),G})},k=(L,U)=>L.trim().split(/\s+/).map(J=>C(J,U)).join(" "),C=(L,U)=>{a("caret",L,U);const J=U.loose?u[l.CARETLOOSE]:u[l.CARET],F=U.includePrerelease?"-0":"";return L.replace(J,(j,B,D,z,G)=>{a("caret",L,j,B,D,z,G);let te;return _(B)?te="":_(D)?te=`>=${B}.0.0${F} <${+B+1}.0.0-0`:_(z)?B==="0"?te=`>=${B}.${D}.0${F} <${B}.${+D+1}.0-0`:te=`>=${B}.${D}.0${F} <${+B+1}.0.0-0`:G?(a("replaceCaret pr",G),B==="0"?D==="0"?te=`>=${B}.${D}.${z}-${G} <${B}.${D}.${+z+1}-0`:te=`>=${B}.${D}.${z}-${G} <${B}.${+D+1}.0-0`:te=`>=${B}.${D}.${z}-${G} <${+B+1}.0.0-0`):(a("no pr"),B==="0"?D==="0"?te=`>=${B}.${D}.${z}${F} <${B}.${D}.${+z+1}-0`:te=`>=${B}.${D}.${z}${F} <${B}.${+D+1}.0-0`:te=`>=${B}.${D}.${z} <${+B+1}.0.0-0`),a("caret return",te),te})},E=(L,U)=>(a("replaceXRanges",L,U),L.split(/\s+/).map(J=>N(J,U)).join(" ")),N=(L,U)=>{L=L.trim();const J=U.loose?u[l.XRANGELOOSE]:u[l.XRANGE];return L.replace(J,(F,j,B,D,z,G)=>{a("xRange",L,F,j,B,D,z,G);const te=_(B),V=te||_(D),K=V||_(z),ae=K;return j==="="&&ae&&(j=""),G=U.includePrerelease?"-0":"",te?j===">"||j==="<"?F="<0.0.0-0":F="*":j&&ae?(V&&(D=0),z=0,j===">"?(j=">=",V?(B=+B+1,D=0,z=0):(D=+D+1,z=0)):j==="<="&&(j="<",V?B=+B+1:D=+D+1),j==="<"&&(G="-0"),F=`${j+B}.${D}.${z}${G}`):V?F=`>=${B}.0.0${G} <${+B+1}.0.0-0`:K&&(F=`>=${B}.${D}.0${G} <${B}.${+D+1}.0-0`),a("xRange return",F),F})},I=(L,U)=>(a("replaceStars",L,U),L.trim().replace(u[l.STAR],"")),$=(L,U)=>(a("replaceGTE0",L,U),L.trim().replace(u[U.includePrerelease?l.GTE0PRE:l.GTE0],"")),O=L=>(U,J,F,j,B,D,z,G,te,V,K,ae)=>(_(F)?J="":_(j)?J=`>=${F}.0.0${L?"-0":""}`:_(B)?J=`>=${F}.${j}.0${L?"-0":""}`:D?J=`>=${J}`:J=`>=${J}${L?"-0":""}`,_(te)?G="":_(V)?G=`<${+te+1}.0.0-0`:_(K)?G=`<${te}.${+V+1}.0-0`:ae?G=`<=${te}.${V}.${K}-${ae}`:L?G=`<${te}.${V}.${+K+1}-0`:G=`<=${G}`,`${J} ${G}`.trim()),T=(L,U,J)=>{for(let F=0;F<L.length;F++)if(!L[F].test(U))return!1;if(U.prerelease.length&&!J.includePrerelease){for(let F=0;F<L.length;F++)if(a(L[F].semver),L[F].semver!==i.ANY&&L[F].semver.prerelease.length>0){const j=L[F].semver;if(j.major===U.major&&j.minor===U.minor&&j.patch===U.patch)return!0}return!1}return!0};return pE}var mE,eM;function d_(){if(eM)return mE;eM=1;const n=Symbol("SemVer ANY");class e{static get ANY(){return n}constructor(d,h){if(h=t(h),d instanceof e){if(d.loose===!!h.loose)return d;d=d.value}d=d.trim().split(/\s+/).join(" "),a("comparator",d,h),this.options=h,this.loose=!!h.loose,this.parse(d),this.semver===n?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(d){const h=this.options.loose?r[s.COMPARATORLOOSE]:r[s.COMPARATOR],f=d.match(h);if(!f)throw new TypeError(`Invalid comparator: ${d}`);this.operator=f[1]!==void 0?f[1]:"",this.operator==="="&&(this.operator=""),f[2]?this.semver=new o(f[2],this.options.loose):this.semver=n}toString(){return this.value}test(d){if(a("Comparator.test",d,this.options.loose),this.semver===n||d===n)return!0;if(typeof d=="string")try{d=new o(d,this.options)}catch{return!1}return i(d,this.operator,this.semver,this.options)}intersects(d,h){if(!(d instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(d.value,h).test(this.value):d.operator===""?d.value===""?!0:new u(this.value,h).test(d.semver):(h=t(h),h.includePrerelease&&(this.value==="<0.0.0-0"||d.value==="<0.0.0-0")||!h.includePrerelease&&(this.value.startsWith("<0.0.0")||d.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&d.operator.startsWith(">")||this.operator.startsWith("<")&&d.operator.startsWith("<")||this.semver.version===d.semver.version&&this.operator.includes("=")&&d.operator.includes("=")||i(this.semver,"<",d.semver,h)&&this.operator.startsWith(">")&&d.operator.startsWith("<")||i(this.semver,">",d.semver,h)&&this.operator.startsWith("<")&&d.operator.startsWith(">")))}}mE=e;const t=Lx(),{safeRe:r,t:s}=rp(),i=JR(),a=u_(),o=Qr(),u=Es();return mE}var gE,tM;function h_(){if(tM)return gE;tM=1;const n=Es();return gE=(t,r,s)=>{try{r=new n(r,s)}catch{return!1}return r.test(t)},gE}var yE,rM;function V6(){if(rM)return yE;rM=1;const n=Es();return yE=(t,r)=>new n(t,r).set.map(s=>s.map(i=>i.value).join(" ").trim().split(" ")),yE}var wE,nM;function G6(){if(nM)return wE;nM=1;const n=Qr(),e=Es();return wE=(r,s,i)=>{let a=null,o=null,u=null;try{u=new e(s,i)}catch{return null}return r.forEach(l=>{u.test(l)&&(!a||o.compare(l)===-1)&&(a=l,o=new n(a,i))}),a},wE}var bE,sM;function Z6(){if(sM)return bE;sM=1;const n=Qr(),e=Es();return bE=(r,s,i)=>{let a=null,o=null,u=null;try{u=new e(s,i)}catch{return null}return r.forEach(l=>{u.test(l)&&(!a||o.compare(l)===1)&&(a=l,o=new n(a,i))}),a},bE}var _E,iM;function J6(){if(iM)return _E;iM=1;const n=Qr(),e=Es(),t=l_();return _E=(s,i)=>{s=new e(s,i);let a=new n("0.0.0");if(s.test(a)||(a=new n("0.0.0-0"),s.test(a)))return a;a=null;for(let o=0;o<s.set.length;++o){const u=s.set[o];let l=null;u.forEach(d=>{const h=new n(d.semver.version);switch(d.operator){case">":h.prerelease.length===0?h.patch++:h.prerelease.push(0),h.raw=h.format();case"":case">=":(!l||t(h,l))&&(l=h);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${d.operator}`)}}),l&&(!a||t(a,l))&&(a=l)}return a&&s.test(a)?a:null},_E}var vE,aM;function X6(){if(aM)return vE;aM=1;const n=Es();return vE=(t,r)=>{try{return new n(t,r).range||"*"}catch{return null}},vE}var SE,oM;function xE(){if(oM)return SE;oM=1;const n=Qr(),e=d_(),{ANY:t}=e,r=Es(),s=h_(),i=l_(),a=sE(),o=lE(),u=cE();return SE=(d,h,f,p)=>{d=new n(d,p),h=new r(h,p);let m,g,y,w,S;switch(f){case">":m=i,g=o,y=a,w=">",S=">=";break;case"<":m=a,g=u,y=i,w="<",S="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(s(d,h,p))return!1;for(let _=0;_<h.set.length;++_){const v=h.set[_];let A=null,k=null;if(v.forEach(C=>{C.semver===t&&(C=new e(">=0.0.0")),A=A||C,k=k||C,m(C.semver,A.semver,p)?A=C:y(C.semver,k.semver,p)&&(k=C)}),A.operator===w||A.operator===S||(!k.operator||k.operator===w)&&g(d,k.semver))return!1;if(k.operator===S&&y(d,k.semver))return!1}return!0},SE}var EE,cM;function Y6(){if(cM)return EE;cM=1;const n=xE();return EE=(t,r,s)=>n(t,r,">",s),EE}var kE,uM;function Q6(){if(uM)return kE;uM=1;const n=xE();return kE=(t,r,s)=>n(t,r,"<",s),kE}var CE,lM;function eW(){if(lM)return CE;lM=1;const n=Es();return CE=(t,r,s)=>(t=new n(t,s),r=new n(r,s),t.intersects(r,s)),CE}var PE,dM;function tW(){if(dM)return PE;dM=1;const n=h_(),e=xs();return PE=(t,r,s)=>{const i=[];let a=null,o=null;const u=t.sort((f,p)=>e(f,p,s));for(const f of u)n(f,r,s)?(o=f,a||(a=f)):(o&&i.push([a,o]),o=null,a=null);a&&i.push([a,null]);const l=[];for(const[f,p]of i)f===p?l.push(f):!p&&f===u[0]?l.push("*"):p?f===u[0]?l.push(`<=${p}`):l.push(`${f} - ${p}`):l.push(`>=${f}`);const d=l.join(" || "),h=typeof r.raw=="string"?r.raw:String(r);return d.length<h.length?d:r},PE}var AE,hM;function rW(){if(hM)return AE;hM=1;const n=Es(),e=d_(),{ANY:t}=e,r=h_(),s=xs(),i=(h,f,p={})=>{if(h===f)return!0;h=new n(h,p),f=new n(f,p);let m=!1;e:for(const g of h.set){for(const y of f.set){const w=u(g,y,p);if(m=m||w!==null,w)continue e}if(m)return!1}return!0},a=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],u=(h,f,p)=>{if(h===f)return!0;if(h.length===1&&h[0].semver===t){if(f.length===1&&f[0].semver===t)return!0;p.includePrerelease?h=a:h=o}if(f.length===1&&f[0].semver===t){if(p.includePrerelease)return!0;f=o}const m=new Set;let g,y;for(const E of h)E.operator===">"||E.operator===">="?g=l(g,E,p):E.operator==="<"||E.operator==="<="?y=d(y,E,p):m.add(E.semver);if(m.size>1)return null;let w;if(g&&y){if(w=s(g.semver,y.semver,p),w>0)return null;if(w===0&&(g.operator!==">="||y.operator!=="<="))return null}for(const E of m){if(g&&!r(E,String(g),p)||y&&!r(E,String(y),p))return null;for(const N of f)if(!r(E,String(N),p))return!1;return!0}let S,_,v,A,k=y&&!p.includePrerelease&&y.semver.prerelease.length?y.semver:!1,C=g&&!p.includePrerelease&&g.semver.prerelease.length?g.semver:!1;k&&k.prerelease.length===1&&y.operator==="<"&&k.prerelease[0]===0&&(k=!1);for(const E of f){if(A=A||E.operator===">"||E.operator===">=",v=v||E.operator==="<"||E.operator==="<=",g){if(C&&E.semver.prerelease&&E.semver.prerelease.length&&E.semver.major===C.major&&E.semver.minor===C.minor&&E.semver.patch===C.patch&&(C=!1),E.operator===">"||E.operator===">="){if(S=l(g,E,p),S===E&&S!==g)return!1}else if(g.operator===">="&&!r(g.semver,String(E),p))return!1}if(y){if(k&&E.semver.prerelease&&E.semver.prerelease.length&&E.semver.major===k.major&&E.semver.minor===k.minor&&E.semver.patch===k.patch&&(k=!1),E.operator==="<"||E.operator==="<="){if(_=d(y,E,p),_===E&&_!==y)return!1}else if(y.operator==="<="&&!r(y.semver,String(E),p))return!1}if(!E.operator&&(y||g)&&w!==0)return!1}return!(g&&v&&!y&&w!==0||y&&A&&!g&&w!==0||C||k)},l=(h,f,p)=>{if(!h)return f;const m=s(h.semver,f.semver,p);return m>0?h:m<0||f.operator===">"&&h.operator===">="?f:h},d=(h,f,p)=>{if(!h)return f;const m=s(h.semver,f.semver,p);return m<0?h:m>0||f.operator==="<"&&h.operator==="<="?f:h};return AE=i,AE}var TE,fM;function nW(){if(fM)return TE;fM=1;const n=rp(),e=c_(),t=Qr(),r=ER(),s=xl(),i=M6(),a=N6(),o=$6(),u=j6(),l=L6(),d=F6(),h=D6(),f=B6(),p=xs(),m=U6(),g=q6(),y=Qx(),w=K6(),S=H6(),_=l_(),v=sE(),A=HR(),k=zR(),C=cE(),E=lE(),N=JR(),I=W6(),$=d_(),O=Es(),T=h_(),L=V6(),U=G6(),J=Z6(),F=J6(),j=X6(),B=xE(),D=Y6(),z=Q6(),G=eW(),te=tW(),V=rW();return TE={parse:s,valid:i,clean:a,inc:o,diff:u,major:l,minor:d,patch:h,prerelease:f,compare:p,rcompare:m,compareLoose:g,compareBuild:y,sort:w,rsort:S,gt:_,lt:v,eq:A,neq:k,gte:C,lte:E,cmp:N,coerce:I,Comparator:$,Range:O,satisfies:T,toComparators:L,maxSatisfying:U,minSatisfying:J,minVersion:F,validRange:j,outside:B,gtr:D,ltr:z,intersects:G,simplifyRange:te,subset:V,SemVer:t,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:r.compareIdentifiers,rcompareIdentifiers:r.rcompareIdentifiers},TE}nW();function Wa(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);const[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){const[s,i]=e.split("/",2);if(!s||!i)throw new Error(`Invalid identifier format: ${n}`);return[s,i,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}class sW extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function Be(n,e,t){let r;if(n.ok){t&&(r=await n.text());return}r=await n.text();const s=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;throw n.status===409?new sW(s):new Error(s)}var pM="[...]",iW={result:"[Circular]"},f_=[],El=[];function aW(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Nn(n,e,t,r){var a;try{return JSON.stringify(n,e,t)}catch(o){if(!((a=o.message)!=null&&a.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof r>"u"&&(r=aW()),OE(n,"",0,[],void 0,0,r);var s;try{El.length===0?s=JSON.stringify(n,e,t):s=JSON.stringify(n,oW(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;f_.length!==0;){var i=f_.pop();i.length===4?Object.defineProperty(i[0],i[1],i[3]):i[0][i[1]]=i[2]}}return s}}function IE(n,e,t,r){var s=Object.getOwnPropertyDescriptor(r,t);s.get!==void 0?s.configurable?(Object.defineProperty(r,t,{value:n}),f_.push([r,t,e,s])):El.push([e,t,n]):(r[t]=n,f_.push([r,t,e]))}function OE(n,e,t,r,s,i,a){i+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){IE(iW,n,e,s);return}if(typeof a.depthLimit<"u"&&i>a.depthLimit){IE(pM,n,e,s);return}if(typeof a.edgesLimit<"u"&&t+1>a.edgesLimit){IE(pM,n,e,s);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)OE(n[o],o,o,r,n,i,a);else{var u=Object.keys(n);for(o=0;o<u.length;o++){var l=u[o];OE(n[l],l,o,r,n,i,a)}}r.pop()}}function oW(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(El.length>0)for(var r=0;r<El.length;r++){var s=El[r];if(s[1]===e&&s[0]===t){t=s[2],El.splice(r,1);break}}return n.call(this,e,t)}}function mM(n){const e=wM(),t=_W(),r=n.extra??{},s=r.metadata;return n.extra={...r,runtime:{...e,...r==null?void 0:r.runtime},metadata:{...t,...t.revision_id||n.revision_id?{revision_id:n.revision_id??t.revision_id}:{},...s}},n}const cW=()=>{const n=za("TRACING_SAMPLING_RATE");if(n===void 0)return;const e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},uW=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function lW(n){const e=[];for await(const t of n)e.push(t);return e}function RE(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const dW=async n=>{if((n==null?void 0:n.status)===429){const e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};class hW{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const r=new Promise(i=>{t=i}),s=Nn(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:s}),this.sizeBytes+=s,r}pop(e){var s;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let r=0;for(;r+(((s=this.peek())==null?void 0:s.size)??0)<e&&this.items.length>0;){const i=this.items.shift();i&&(t.push(i),r+=i.size,this.sizeBytes-=i.size)}if(t.length===0&&this.items.length>0){const i=this.items.shift();t.push(i),r+=i.size,this.sizeBytes-=i.size}return[t.map(i=>({action:i.action,item:i.payload})),()=>t.forEach(i=>i.itemPromiseResolve())]}}const fW=20971520,pW=2500;class np{constructor(e={}){var r;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new hW}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:gc("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1});const t=np.getDefaultClientConfig();if(this.tracingSampleRate=cW(),this.apiUrl=RE(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=RE(e.apiKey??t.apiKey),this.webUrl=RE(e.webUrl??t.webUrl),(r=this.webUrl)!=null&&r.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new pR(e.callerOptions??{}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.batchIngestCaller=new pR({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:dW}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=za("API_KEY"),t=za("ENDPOINT")??"https://api.smith.langchain.com",r=za("HIDE_INPUTS")==="true",s=za("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:s}}getHostUrl(){return this.webUrl?this.webUrl:uW(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${gM}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=(t==null?void 0:t.toString())??"",s=`${this.apiUrl}${e}?${r}`,i=await this.caller.call(Pe(),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(i,`Failed to fetch ${e}`),i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let s=Number(t.get("offset"))||0;const i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(s)),t.set("limit",String(i));const a=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(Pe(),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(o,`Failed to fetch ${e}`);const u=r?r(await o.json()):await o.json();if(u.length===0||(yield u,u.length<i))break;s+=u.length}}async*_getCursorPaginatedList(e,t=null,r="POST",s="runs"){const i=t?{...t}:{};for(;;){const o=await(await this.caller.call(Pe(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)})).json();if(!o||!o[s])break;yield o[s];const u=o.cursors;if(!u||!u.next)break;i.cursor=u.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const r=[];for(const s of e)this.filteredPostUuids.has(s.id)?this.filteredPostUuids.delete(s.id):r.push(s);return r}else{const r=[];for(const s of e)s.id!==s.trace_id&&!this.filteredPostUuids.has(s.trace_id)||Math.random()<this.tracingSampleRate?r.push(s):this.filteredPostUuids.add(s.id);return r}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??fW}async _getMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[r,s]=this.autoBatchQueue.pop(e);if(!r.length){s();break}const i=this._processBatch(r,s).catch(console.error);t.push(i)}return Promise.all(t)}async _processBatch(e,t){var r;if(!e.length){t();return}try{const s={runCreates:e.filter(a=>a.action==="create").map(a=>a.item),runUpdates:e.filter(a=>a.action==="update").map(a=>a.item)},i=await this._ensureServerInfo();(r=i==null?void 0:i.batch_ingest_config)!=null&&r.use_multipart_endpoint?await this.multipartIngestRuns(s):await this.batchIngestRuns(s)}finally{t()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=mM(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await Pe()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(pW),...this.fetchOptions});return await Be(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to batch operations and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const s=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){this.processRunOperation({action:"create",item:s}).catch(console.error);return}const i=mM(s),a=await this.caller.call(Pe(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:Nn(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(a,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r=(e==null?void 0:e.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[],s=(t==null?void 0:t.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[];if(r.length>0&&s.length>0){const o=r.reduce((l,d)=>(d.id&&(l[d.id]=d),l),{}),u=[];for(const l of s)l.id!==void 0&&o[l.id]?o[l.id]={...o[l.id],...l}:u.push(l);r=Object.values(o),s=u}const i={post:this._filterForSampling(r),patch:this._filterForSampling(s,!0)};if(!i.post.length&&!i.patch.length)return;const a={post:[],patch:[]};for(const o of["post","patch"]){const u=o,l=i[u].reverse();let d=l.pop();for(;d!==void 0;)a[u].push(d),d=l.pop()}(a.post.length>0||a.patch.length>0)&&await this._postBatchIngestRuns(Nn(a))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(Pe(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const r={};let s=[];for(const d of e??[]){const h=this.prepareRunCreateOrUpdateInputs(d);h.id!==void 0&&h.attachments!==void 0&&(r[h.id]=h.attachments),delete h.attachments,s.push(h)}let i=[];for(const d of t??[])i.push(this.prepareRunCreateOrUpdateInputs(d));if(s.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(i.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&i.length>0){const d=s.reduce((f,p)=>(p.id&&(f[p.id]=p),f),{}),h=[];for(const f of i)f.id!==void 0&&d[f.id]?d[f.id]={...d[f.id],...f}:h.push(f);s=Object.values(d),i=h}if(s.length===0&&i.length===0)return;const u=[],l=[];for(const[d,h]of[["post",s],["patch",i]])for(const f of h){const{inputs:p,outputs:m,events:g,attachments:y,...w}=f,S={inputs:p,outputs:m,events:g},_=Nn(w);l.push({name:`${d}.${w.id}`,payload:new Blob([_],{type:`application/json; length=${_.length}`})});for(const[v,A]of Object.entries(S)){if(A===void 0)continue;const k=Nn(A);l.push({name:`${d}.${w.id}.${v}`,payload:new Blob([k],{type:`application/json; length=${k.length}`})})}if(w.id!==void 0){const v=r[w.id];if(v){delete r[w.id];for(const[A,k]of Object.entries(v)){let C,E;if(Array.isArray(k)?[C,E]=k:(C=k.mimeType,E=k.data),A.includes(".")){console.warn(`Skipping attachment '${A}' for run ${w.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}l.push({name:`attachment.${w.id}.${A}`,payload:new Blob([E],{type:`${C}; length=${E.byteLength}`})})}}}u.push(`trace=${w.trace_id},id=${w.id}`)}await this._sendMultipartRequest(l,u.join("; "))}async _sendMultipartRequest(e,t){try{const r="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=[];for(const u of e)s.push(new Blob([`--${r}\r
`])),s.push(new Blob([`Content-Disposition: form-data; name="${u.name}"\r
`,`Content-Type: ${u.payload.type}\r
\r
`])),s.push(u.payload),s.push(new Blob([`\r
`]));s.push(new Blob([`--${r}--\r
`]));const a=await new Blob(s).arrayBuffer(),o=await this.batchIngestCaller.call(Pe(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${r}`},body:a,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(o,"ingest multipart runs",!0)}catch(r){console.warn(`${r.message.trim()}

Context: ${t}`)}}async updateRun(e,t){qe(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:r}).catch(console.error);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(Pe(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,body:Nn(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(i,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){qe(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let s;t.session_id?s=t.session_id:r!=null&&r.projectName?s=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?s=r==null?void 0:r.projectId:s=(await this.readProject({projectName:za("PROJECT")||"default"})).id;const i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${s}/r/${t.id}?poll=true`}else if(e!==void 0){const s=await this.readRun(e);if(!s.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${s.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await lW(this.listRuns({id:e.child_run_ids})),r={},s={};t.sort((i,a)=>((i==null?void 0:i.dotted_order)??"").localeCompare((a==null?void 0:a.dotted_order)??""));for(const i of t){if(i.parent_run_id===null||i.parent_run_id===void 0)throw new Error(`Child run ${i.id} has no parent`);i.parent_run_id in r||(r[i.parent_run_id]=[]),r[i.parent_run_id].push(i),s[i.id]=i}e.child_runs=r[e.id]||[];for(const i in r)i!==e.id&&(s[i].child_runs=r[i]);return e}async*listRuns(e){const{projectId:t,projectName:r,parentRunId:s,traceId:i,referenceExampleId:a,startTime:o,executionOrder:u,isRoot:l,runType:d,error:h,id:f,query:p,filter:m,traceFilter:g,treeFilter:y,limit:w,select:S}=e;let _=[];if(t&&(_=Array.isArray(t)?t:[t]),r){const C=Array.isArray(r)?r:[r],E=await Promise.all(C.map(N=>this.readProject({projectName:N}).then(I=>I.id)));_.push(...E)}const v=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],A={session:_.length?_:null,run_type:d,reference_example:a,query:p,filter:m,trace_filter:g,tree_filter:y,execution_order:u,parent_run:s,start_time:o?o.toISOString():null,error:h,id:f,limit:w,trace:i,select:S||v,is_root:l};let k=0;for await(const C of this._getCursorPaginatedList("/runs/query",A))if(w){if(k>=w)break;if(C.length+k>w){yield*C.slice(0,w-k);break}k+=C.length,yield*C}else yield*C}async getRunStats({id:e,trace:t,parentRun:r,runType:s,projectNames:i,projectIds:a,referenceExampleIds:o,startTime:u,endTime:l,error:d,query:h,filter:f,traceFilter:p,treeFilter:m,isRoot:g,dataSourceType:y}){let w=a||[];i&&(w=[...a||[],...await Promise.all(i.map(k=>this.readProject({projectName:k}).then(C=>C.id)))]);const _=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:s,session:w,reference_example:o,start_time:u,end_time:l,error:d,query:h,filter:f,trace_filter:p,tree_filter:m,is_root:g,data_source_type:y}).filter(([k,C])=>C!==void 0));return await(await this.caller.call(Pe(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(_),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||Yr()};qe(e);const i=await(await this.caller.call(Pe(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){qe(e);const t=await this.caller.call(Pe(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(t,"unshare run",!0)}async readRunSharedLink(e){qe(e);const r=await(await this.caller.call(Pe(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const a of t)r.append("id",a);return qe(e),await(await this.caller.call(Pe(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),qe(e);const s=await(await this.caller.call(Pe(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};qe(e);const i=await(await this.caller.call(Pe(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){qe(e);const t=await this.caller.call(Pe(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(t,"unshare dataset",!0)}async readSharedDataset(e){return qe(e),await(await this.caller.call(Pe(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const r={};t!=null&&t.exampleIds&&(r.id=t.exampleIds);const s=new URLSearchParams;Object.entries(r).forEach(([o,u])=>{Array.isArray(u)?u.forEach(l=>s.append(o,l)):s.append(o,u)});const i=await this.caller.call(Pe(),`${this.apiUrl}/public/${e}/examples?${s.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await i.json();if(!i.ok)throw"detail"in a?new Error(`Failed to list shared examples.
Status: ${i.status}
Message: ${a.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${i.status} ${i.statusText}`);return a.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:s=!1,projectExtra:i=null,referenceDatasetId:a=null}){const o=s?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,l=i||{};r&&(l.metadata=r);const d={name:e,extra:l,description:t};a!==null&&(d.reference_dataset_id=a);const h=await this.caller.call(Pe(),u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(h,"create project"),await h.json()}async updateProject(e,{name:t=null,description:r=null,metadata:s=null,projectExtra:i=null,endTime:a=null}){const o=`${this.apiUrl}/sessions/${e}`;let u=i;s&&(u={...u||{},metadata:s});const l={name:t,extra:u,description:r,end_time:a?new Date(a).toISOString():null},d=await this.caller.call(Pe(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(d,"update project"),await d.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)qe(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");const i=await this.caller.call(Pe(),`${this.apiUrl}${r}?${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const a=await i.json();return i.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let s="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)qe(e),s+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&i.append("include_stats",r.toString());const a=await this._get(s,i);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:t}),s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:s,referenceDatasetName:i,referenceFree:a,metadata:o}={}){const u=new URLSearchParams;if(e!==void 0)for(const l of e)u.append("id",l);if(t!==void 0&&u.append("name",t),r!==void 0&&u.append("name_contains",r),s!==void 0)u.append("reference_dataset",s);else if(i!==void 0){const l=await this.readDataset({datasetName:i});u.append("reference_dataset",l.id)}a!==void 0&&u.append("reference_free",a.toString()),o!==void 0&&u.append("metadata",JSON.stringify(o));for await(const l of this._getPaginated("/sessions",u))yield*l}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,qe(r);const s=await this.caller.call(Pe(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(s,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:s,description:i,dataType:a,name:o}){const u=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach(f=>{l.append("input_keys",f)}),s.forEach(f=>{l.append("output_keys",f)}),i&&l.append("description",i),a&&l.append("data_type",a),o&&l.append("name",o);const d=await this.caller.call(Pe(),u,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(d,"upload CSV"),await d.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:s,outputsSchema:i,metadata:a}={}){const o={name:e,description:t,extra:a?{metadata:a}:void 0};r&&(o.data_type=r),s&&(o.inputs_schema_definition=s),i&&(o.outputs_schema_definition=i);const u=await this.caller.call(Pe(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(u,"create dataset"),await u.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const s=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)qe(e),r+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(r,s);let a;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=i[0]}else a=i;return a}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:s}){let i=e;if(i===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:t})).id);const a=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof s=="string"?s:s.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:s,datasetNameContains:i,metadata:a}={}){const o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const l of r)u.append("id",l);s!==void 0&&u.append("name",s),i!==void 0&&u.append("name_contains",i),a!==void 0&&u.append("metadata",JSON.stringify(a));for await(const l of this._getPaginated(o,u))yield*l}async updateDataset(e){const{datasetId:t,datasetName:r,...s}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:r})).id;qe(i);const a=await this.caller.call(Pe(),`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(a,"update dataset"),await a.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:r,asOf:s,tag:i}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:r})).id;qe(a);const o=await this.caller.call(Pe(),`${this.apiUrl}/datasets/${a}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof s=="string"?s:s.toISOString(),tag:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",s=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(s=(await this.readDataset({datasetName:t})).id),s!==void 0)qe(s),r+=`/${s}`;else throw new Error("Must provide datasetName or datasetId");const i=await this.caller.call(Pe(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(i,`delete ${r}`),await i.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let s=e;if(!s&&!t)throw new Error("Must provide either datasetName or datasetId");if(s&&t)throw new Error("Must provide either datasetName or datasetId, not both");s||(s=(await this.readDataset({datasetName:t})).id),qe(s);const i={tag:r},a=await this.caller.call(Pe(),`${this.apiUrl}/datasets/${s}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(a,"index dataset"),await a.json()}async similarExamples(e,t,r,{filter:s}={}){const i={limit:r,inputs:e};s!==void 0&&(i.filter=s),qe(t);const a=await this.caller.call(Pe(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(a,"fetch similar examples"),(await a.json()).examples}async createExample(e,t,{datasetId:r,datasetName:s,createdAt:i,exampleId:a,metadata:o,split:u,sourceRunId:l}){let d=r;if(d===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(d!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");d===void 0&&(d=(await this.readDataset({datasetName:s})).id);const h=i||new Date,f={dataset_id:d,inputs:e,outputs:t,created_at:h==null?void 0:h.toISOString(),id:a,metadata:o,split:u,source_run_id:l},p=await this.caller.call(Pe(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(p,"create example"),await p.json()}async createExamples(e){const{inputs:t,outputs:r,metadata:s,sourceRunIds:i,exampleIds:a,datasetId:o,datasetName:u}=e;let l=o;if(l===void 0&&u===void 0)throw new Error("Must provide either datasetName or datasetId");if(l!==void 0&&u!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");l===void 0&&(l=(await this.readDataset({datasetName:u})).id);const d=t.map((p,m)=>({dataset_id:l,inputs:p,outputs:r?r[m]:void 0,metadata:s?s[m]:void 0,split:e.splits?e.splits[m]:void 0,id:a?a[m]:void 0,source_run_id:i?i[m]:void 0})),h=await this.caller.call(Pe(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(h,"create examples"),await h.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const s=e.map(a=>mR(a)?gR(a):a),i=mR(t)?gR(t):t;return this.createExample({input:s},{output:i},r)}async readExample(e){qe(e);const t=`/examples/${e}`,r=await this._get(t),{attachment_urls:s,...i}=r,a=i;return s&&(a.attachments=Object.entries(s).reduce((o,[u,l])=>(o[u.slice(11)]={presigned_url:l.presigned_url,mime_type:l.mime_type},o),{})),a}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:s,splits:i,inlineS3Urls:a,metadata:o,limit:u,offset:l,filter:d,includeAttachments:h}={}){let f;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)f=e;else if(t!==void 0)f=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const p=new URLSearchParams({dataset:f}),m=s?typeof s=="string"?s:s==null?void 0:s.toISOString():void 0;m&&p.append("as_of",m);const g=a??!0;if(p.append("inline_s3_urls",g.toString()),r!==void 0)for(const w of r)p.append("id",w);if(i!==void 0)for(const w of i)p.append("splits",w);if(o!==void 0){const w=JSON.stringify(o);p.append("metadata",w)}u!==void 0&&p.append("limit",u.toString()),l!==void 0&&p.append("offset",l.toString()),d!==void 0&&p.append("filter",d),h===!0&&["attachment_urls","outputs","metadata"].forEach(w=>p.append("select",w));let y=0;for await(const w of this._getPaginated("/examples",p)){for(const S of w){const{attachment_urls:_,...v}=S,A=v;_&&(A.attachments=Object.entries(_).reduce((k,[C,E])=>(k[C.slice(11)]={presigned_url:E.presigned_url,mime_type:E.mime_type||void 0},k),{})),yield A,y++}if(u!==void 0&&y>=u)break}}async deleteExample(e){qe(e);const t=`/examples/${e}`,r=await this.caller.call(Pe(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(r,`delete ${t}`),await r.json()}async updateExample(e,t){qe(e);const r=await this.caller.call(Pe(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(r,"update example"),await r.json()}async updateExamples(e){const t=await this.caller.call(Pe(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(t,"update examples"),await t.json()}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:s}){let i;if(e?i=e:i=(await this.readDataset({datasetName:t})).id,qe(i),r&&s||!r&&!s)throw new Error("Exactly one of asOf and tag must be specified.");const a=new URLSearchParams;r!==void 0&&a.append("as_of",typeof r=="string"?r:r.toISOString()),s!==void 0&&a.append("tag",s);const o=await this.caller.call(Pe(),`${this.apiUrl}/datasets/${i}/version?${a.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,qe(s);const i=new URLSearchParams,a=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return a&&i.append("as_of",a),await this._get(`/datasets/${s}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:s,remove:i=!1}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,qe(a);const o={split_name:r,examples:s.map(l=>(qe(l),l)),remove:i},u=await this.caller.call(Pe(),`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(u,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:s,referenceExample:i}={loadChildRuns:!1}){wR("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:s});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(i=await this.readExample(a.reference_example_id));const o=await t.evaluateRun(a,i),[u,l]=await this._logEvaluationFeedback(o,a,r);return l[0]}async createFeedback(e,t,{score:r,value:s,correction:i,comment:a,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:l,feedbackId:d,feedbackConfig:h,projectId:f,comparativeExperimentId:p}){var S;if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");const m={type:u??"api",metadata:o??{}};l!==void 0&&(m==null?void 0:m.metadata)!==void 0&&!m.metadata.__run&&(m.metadata.__run={run_id:l}),(m==null?void 0:m.metadata)!==void 0&&((S=m.metadata.__run)==null?void 0:S.run_id)!==void 0&&qe(m.metadata.__run.run_id);const g={id:d??Yr(),run_id:e,key:t,score:r,value:s,correction:i,comment:a,feedback_source:m,comparative_experiment_id:p,feedbackConfig:h,session_id:f},y=`${this.apiUrl}/feedback`,w=await this.caller.call(Pe(),y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(g),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(w,"create feedback",!0),g}async updateFeedback(e,{score:t,value:r,correction:s,comment:i}){const a={};t!=null&&(a.score=t),r!=null&&(a.value=r),s!=null&&(a.correction=s),i!=null&&(a.comment=i),qe(e);const o=await this.caller.call(Pe(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(o,"update feedback",!0)}async readFeedback(e){qe(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){qe(e);const t=`/feedback/${e}`,r=await this.caller.call(Pe(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const s=new URLSearchParams;if(e&&s.append("run",e.join(",")),t)for(const i of t)s.append("key",i);if(r)for(const i of r)s.append("source",i);for await(const i of this._getPaginated("/feedback",s))yield*i}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:s}={}){const i={run_id:e,feedback_key:t,feedback_config:s};return r?typeof r=="string"?i.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(i.expires_in=r):i.expires_in={hours:3},await(await this.caller.call(Pe(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:s,description:i,metadata:a,id:o}){var d;if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const u={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:i,created_at:(d=s??new Date)==null?void 0:d.toISOString(),extra:{}};return a&&(u.extra.metadata=a),await(await this.caller.call(Pe(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){qe(e);const t=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}async _logEvaluationFeedback(e,t,r){const s=this._selectEvalResults(e),i=[];for(const a of s){let o=r||{};a.evaluatorInfo&&(o={...a.evaluatorInfo,...o});let u=null;a.targetRunId?u=a.targetRunId:t&&(u=t.id),i.push(await this.createFeedback(u,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[s,i]}async logEvaluationFeedback(e,t,r){const[s]=await this._logEvaluationFeedback(e,t,r);return s}async*listAnnotationQueues(e={}){const{queueIds:t,name:r,nameContains:s,limit:i}=e,a=new URLSearchParams;t&&t.forEach((u,l)=>{qe(u,`queueIds[${l}]`),a.append("ids",u)}),r&&a.append("name",r),s&&a.append("name_contains",s),a.append("limit",(i!==void 0?Math.min(i,100):100).toString());let o=0;for await(const u of this._getPaginated("/annotation-queues",a))if(yield*u,o++,i!==void 0&&o>=i)break}async createAnnotationQueue(e){const{name:t,description:r,queueId:s}=e,i={name:t,description:r,id:s||Yr()},a=await this.caller.call(Pe(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(i).filter(([u,l])=>l!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(a,"create annotation queue"),await a.json()}async readAnnotationQueue(e){const t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){const{name:r,description:s}=t,i=await this.caller.call(Pe(),`${this.apiUrl}/annotation-queues/${qe(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:s}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(i,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(Pe(),`${this.apiUrl}/annotation-queues/${qe(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const r=await this.caller.call(Pe(),`${this.apiUrl}/annotation-queues/${qe(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((s,i)=>qe(s,`runIds[${i}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const r=`/annotation-queues/${qe(e,"queueId")}/run`,s=await this.caller.call(Pe(),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(s,"get run from annotation queue"),await s.json()}async deleteRunFromAnnotationQueue(e,t){const r=await this.caller.call(Pe(),`${this.apiUrl}/annotation-queues/${qe(e,"queueId")}/runs/${qe(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(r,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(Pe(),`${this.apiUrl}/annotation-queues/${qe(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(Pe(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){const s=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),i=new Error(`Error ${t.status}: ${t.statusText}
${s}`);throw i.statusCode=t.status,i}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[r,s,i]=Wa(e),a=await this.caller.call(Pe(),`${this.apiUrl}/likes/${r}/${s}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(a,`${t?"like":"unlike"} prompt`),await a.json()}async _getPromptUrl(e){const[t,r,s]=Wa(e);if(await this._currentTenantIsOwner(t)){const i=await this._getSettings();return s!=="latest"?`${this.getHostUrl()}/prompts/${r}/${s.substring(0,8)}?organizationId=${i.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${i.id}`}else return s!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${s.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const r of this._getPaginated("/repos",t,s=>s.repos))yield*r}async getPrompt(e){const[t,r,s]=Wa(e),i=await this.caller.call(Pe(),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(i.status===404)return null;await Be(i,"get prompt");const a=await i.json();return a.repo?a.repo:null}async createPrompt(e,t){const r=await this._getSettings();if(t!=null&&t.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[s,i,a]=Wa(e);if(!await this._currentTenantIsOwner(s))throw await this._ownerConflictError("create a prompt",s);const o={repo_handle:i,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},u=await this.caller.call(Pe(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(u,"create prompt");const{repo:l}=await u.json();return l}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[s,i,a]=Wa(e),o=(r==null?void 0:r.parentCommitHash)==="latest"||!(r!=null&&r.parentCommitHash)?await this._getLatestCommitHash(`${s}/${i}`):r==null?void 0:r.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},l=await this.caller.call(Pe(),`${this.apiUrl}/commits/${s}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(l,"create commit");const d=await l.json();return this._getPromptUrl(`${s}/${i}${d.commit_hash?`:${d.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const r=new FormData;for(const a of t){const o=a.id,u={...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split}},l=Nn(u),d=new Blob([l],{type:"application/json"});if(r.append(o,d),a.inputs){const h=Nn(a.inputs),f=new Blob([h],{type:"application/json"});r.append(`${o}.inputs`,f)}if(a.outputs){const h=Nn(a.outputs),f=new Blob([h],{type:"application/json"});r.append(`${o}.outputs`,f)}if(a.attachments)for(const[h,f]of Object.entries(a.attachments)){let p,m;Array.isArray(f)?[p,m]=f:(p=f.mimeType,m=f.data);const g=new Blob([m],{type:`${p}; length=${m.byteLength}`});r.append(`${o}.attachment.${h}`,g)}if(a.attachments_operations){const h=Nn(a.attachments_operations),f=new Blob([h],{type:"application/json"});r.append(`${o}.attachments_operations`,f)}}return await(await this.caller.call(Pe(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"PATCH",headers:this.headers,body:r})).json()}async uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith version does not allow using the multipart examples endpoint, please update to the latest version.");const r=new FormData;for(const a of t){const o=(a.id??Yr()).toString(),u={created_at:a.created_at,...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split}},l=Nn(u),d=new Blob([l],{type:"application/json"});r.append(o,d);const h=Nn(a.inputs),f=new Blob([h],{type:"application/json"});if(r.append(`${o}.inputs`,f),a.outputs){const p=Nn(a.outputs),m=new Blob([p],{type:"application/json"});r.append(`${o}.outputs`,m)}if(a.attachments)for(const[p,m]of Object.entries(a.attachments)){let g,y;Array.isArray(m)?[g,y]=m:(g=m.mimeType,y=m.data);const w=new Blob([y],{type:`${g}; length=${y.byteLength}`});r.append(`${o}.attachment.${p}`,w)}}return await(await this.caller.call(Pe(),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:r})).json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,s]=Wa(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const i={};if((t==null?void 0:t.description)!==void 0&&(i.description=t.description),(t==null?void 0:t.readme)!==void 0&&(i.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(i.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(i.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(i.is_archived=t.isArchived),Object.keys(i).length===0)throw new Error("No valid update options provided");const a=await this.caller.call(Pe(),`${this.apiUrl}/repos/${r}/${s}`,{method:"PATCH",body:JSON.stringify(i),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Be(a,"update prompt"),a.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,r,s]=Wa(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(Pe(),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[r,s,i]=Wa(e),a=await this.caller.call(Pe(),`${this.apiUrl}/commits/${r}/${s}/${i}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Be(a,"pull prompt commit");const o=await a.json();return{owner:r,repo:s,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const r=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(s=>s!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:r=this.apiUrl,datasetName:s}=t,[i,a]=this.parseTokenOrUrl(e,r),o=new np({apiUrl:i,apiKey:"placeholder"}),u=await o.readSharedDataset(a),l=s||u.name;try{if(await this.hasDataset({datasetId:l})){console.log(`Dataset ${l} already exists in your tenant. Skipping.`);return}}catch{}const d=await o.listSharedExamples(a),h=await this.createDataset(l,{description:u.description,dataType:u.data_type||"kv",inputsSchema:u.inputs_schema_definition??void 0,outputsSchema:u.outputs_schema_definition??void 0});try{await this.createExamples({inputs:d.map(f=>f.inputs),outputs:d.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:h.id})}catch(f){throw console.error(`An error occurred while creating dataset ${l}. You should delete it manually.`),f}}parseTokenOrUrl(e,t,r=2,s="dataset"){try{return qe(e),[t,e]}catch{}try{const a=new URL(e).pathname.split("/").filter(o=>o!=="");if(a.length>=r){const o=a[a.length-r];return[t,o]}else throw new Error(`Invalid public ${s} URL: ${e}`)}catch{throw new Error(`Invalid public ${s} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}const gM="0.3.4";let Gi;const mW=()=>typeof window<"u"&&typeof window.document<"u",gW=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",yW=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),yM=()=>typeof Deno<"u",wW=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!yM(),bW=()=>Gi||(mW()?Gi="browser":wW()?Gi="node":gW()?Gi="webworker":yW()?Gi="jsdom":yM()?Gi="deno":Gi="other",Gi);let ME;function wM(){if(ME===void 0){const n=bW(),e=SW();ME={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:gM,...e}}return ME}function _W(){const n=vW()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,s]of Object.entries(n))(r.startsWith("LANGCHAIN_")||r.startsWith("LANGSMITH_"))&&typeof s=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=s:e[r]=s);return e}function vW(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function gc(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:void 0}catch{return}}function za(n){return gc(`LANGSMITH_${n}`)||gc(`LANGCHAIN_${n}`)}let NE;function SW(){if(NE!==void 0)return NE;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=gc(t);r!==void 0&&(e[t]=r)}return NE=e,e}const xW=n=>!!["TRACING_V2","TRACING"].find(t=>za(t)==="true"),$E=Symbol.for("lc:context_variables");function EW(n){return n.replace(/[-:.]/g,"")}function kW(n,e,t=1){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return EW(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}class p_{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){const t=e.split(",");let r={},s=[];for(const i of t){const[a,o]=i.split("="),u=decodeURIComponent(o);a==="langsmith-metadata"?r=JSON.parse(u):a==="langsmith-tags"&&(s=u.split(","))}return new p_(r,s)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class $n{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),bM(e)){Object.assign(this,{...e});return}const t=$n.getDefaultConfig(),{metadata:r,...s}=e,i=s.client??$n.getSharedClient(),a={...r,...(o=s==null?void 0:s.extra)==null?void 0:o.metadata};if(s.extra={...s.extra,metadata:a},Object.assign(this,{...t,...s,client:i}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const u=kW(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+u:this.dotted_order=u}}static getDefaultConfig(){return{id:Yr(),run_type:"chain",project_name:za("PROJECT")??gc("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:gc("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:gc("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return $n.sharedClient||($n.sharedClient=new np),$n.sharedClient}createChild(e){var u,l,d,h,f,p;const t=this.child_execution_order+1,r=new $n({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});$E in this&&(r[$E]=this[$E]);const s=Symbol.for("lc:child_config"),i=((u=e.extra)==null?void 0:u[s])??this.extra[s];if(PW(i)){const m={...i},g=CW(m.callbacks)?(d=(l=m.callbacks).copy)==null?void 0:d.call(l):void 0;g&&(Object.assign(g,{_parentRunId:r.id}),(p=(f=(h=g.handlers)==null?void 0:h.find(_M))==null?void 0:f.updateFromRunTree)==null||p.call(f,r),m.callbacks=g),r.extra[s]=m}const a=new Set;let o=this;for(;o!=null&&!a.has(o.id);)a.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now(),s){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,s&&Object.keys(s).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...s}}:{metadata:s})}_convertToCreate(e,t,r=!0){var u;const s=e.extra??{};if(s.runtime||(s.runtime={}),t)for(const[l,d]of Object.entries(t))s.runtime[l]||(s.runtime[l]=d);let i,a;return r?(a=(u=e.parent_run)==null?void 0:u.id,i=[]):(i=e.child_runs.map(l=>this._convertToCreate(l,t,r)),a=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:s,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments}}async postRun(e=!0){try{const t=wM(),r=await this._convertToCreate(this,t,!0);if(await this.client.createRun(r),!e){wR("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const s of this.child_runs)await s.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){var l,d,h,f;const r=e==null?void 0:e.callbacks;let s,i,a,o=xW();if(r){const p=((l=r==null?void 0:r.getParentRunId)==null?void 0:l.call(r))??"",m=(d=r==null?void 0:r.handlers)==null?void 0:d.find(g=>(g==null?void 0:g.name)=="langchain_tracer");s=(h=m==null?void 0:m.getRun)==null?void 0:h.call(m,p),i=m==null?void 0:m.projectName,a=m==null?void 0:m.client,o=o||!!m}return s?new $n({name:s.name,id:s.id,trace_id:s.trace_id,dotted_order:s.dotted_order,client:a,tracingEnabled:o,project_name:i,tags:[...new Set(((s==null?void 0:s.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(f=s==null?void 0:s.extra)==null?void 0:f.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new $n({...t,client:a,tracingEnabled:o,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var l;const r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,s=r["langsmith-trace"];if(!s||typeof s!="string")return;const i=s.trim(),a=i.split(".").map(d=>{const[h,f]=d.split("Z");return{strTime:h,time:Date.parse(h+"Z"),uuid:f}}),o=a[0].uuid,u={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(l=a.at(-1))==null?void 0:l.uuid,trace_id:o,dotted_order:i};if(r.baggage&&typeof r.baggage=="string"){const d=p_.fromHeader(r.baggage);u.metadata=d.metadata,u.tags=d.tags}return new $n(u)}toHeaders(e){var r;const t={"langsmith-trace":this.dotted_order,baggage:new p_((r=this.extra)==null?void 0:r.metadata,this.tags).toHeader()};if(e)for(const[s,i]of Object.entries(t))e.set(s,i);return t}}Object.defineProperty($n,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function bM(n){return n!==void 0&&typeof n.createChild=="function"&&typeof n.postRun=="function"}function _M(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function vM(n){return Array.isArray(n)&&n.some(e=>_M(e))}function CW(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function PW(n){var e;return n!==void 0&&typeof n.callbacks=="object"&&(vM((e=n.callbacks)==null?void 0:e.handlers)||vM(n.callbacks))}let AW=class{getStore(){}run(e,t){return t()}};const jE=Symbol.for("ls:tracing_async_local_storage"),TW=new AW;let IW=class{getInstance(){return globalThis[jE]??TW}initializeGlobalInstance(e){globalThis[jE]===void 0&&(globalThis[jE]=e)}};const OW=new IW,RW=()=>{const n=OW.getInstance().getStore();if(!bM(n))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function and that tracing is enabled."].join(`
`));return n};function LE(n){return typeof n=="function"&&"langsmith:traceable"in n}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const MW=Object.prototype.hasOwnProperty;function FE(n,e){return MW.call(n,e)}function DE(n){if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)FE(n,t)&&e.push(t);return e}function di(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function BE(n){let e=0;const t=n.length;let r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function kl(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function NW(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function UE(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(UE(n[t]))return!0}else if(typeof n=="object"){const t=DE(n),r=t.length;for(var e=0;e<r;e++)if(UE(n[t[e]]))return!0}}return!1}function SM(n,e){const t=[n];for(const r in e){const s=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof s<"u"&&t.push(`${r}: ${s}`)}return t.join(`
`)}class $W extends Error{constructor(e,t,r,s,i){super(SM(e,{name:t,index:r,operation:s,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=SM(e,{name:t,index:r,operation:s,tree:i})}}const Qt=$W,Cl={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=qE(t,this.path);r&&(r=di(r));const s=sp(t,{op:"remove",path:this.from}).removed;return sp(t,{op:"add",path:this.path,value:s}),{newDocument:t,removed:r}},copy:function(n,e,t){const r=qE(t,this.from);return sp(t,{op:"add",path:this.path,value:di(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:g_(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}};var jW={add:function(n,e,t){return BE(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:Cl.move,copy:Cl.copy,test:Cl.test,_get:Cl._get};function qE(n,e){if(e=="")return n;var t={op:"_get",path:e};return sp(n,t),t.value}function sp(n,e,t=!1,r=!0,s=!0,i=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):KE(e,0)),e.path===""){let a={newDocument:n};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=n,a;if(e.op==="move"||e.op==="copy")return a.newDocument=qE(n,e.from),e.op==="move"&&(a.removed=n),a;if(e.op==="test"){if(a.test=g_(n,e.value),a.test===!1)throw new Qt("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return a.newDocument=n,a}else{if(e.op==="remove")return a.removed=n,a.newDocument=null,a;if(e.op==="_get")return e.value=n,a;if(t)throw new Qt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,n);return a}}else{r||(n=di(n));const o=(e.path||"").split("/");let u=n,l=1,d=o.length,h,f,p;for(typeof t=="function"?p=t:p=KE;;){if(f=o[l],f&&f.indexOf("~")!=-1&&(f=NW(f)),s&&(f=="__proto__"||f=="prototype"&&l>0&&o[l-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&h===void 0&&(u[f]===void 0?h=o.slice(0,l).join("/"):l==d-1&&(h=e.path),h!==void 0&&p(e,0,n,h)),l++,Array.isArray(u)){if(f==="-")f=u.length;else{if(t&&!BE(f))throw new Qt("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,n);BE(f)&&(f=~~f)}if(l>=d){if(t&&e.op==="add"&&f>u.length)throw new Qt("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,n);const m=jW[e.op].call(e,u,f,n);if(m.test===!1)throw new Qt("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return m}}else if(l>=d){const m=Cl[e.op].call(e,u,f,n);if(m.test===!1)throw new Qt("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return m}if(u=u[f],t&&l<d&&(!u||typeof u!="object"))throw new Qt("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,n)}}}function m_(n,e,t,r=!0,s=!0){if(t&&!Array.isArray(e))throw new Qt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=di(n));const i=new Array(e.length);for(let a=0,o=e.length;a<o;a++)i[a]=sp(n,e[a],t,!0,s,a),n=i[a].newDocument;return i.newDocument=n,i}function KE(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new Qt("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(Cl[n.op]){if(typeof n.path!="string")throw new Qt("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new Qt('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new Qt("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new Qt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&UE(n.value))throw new Qt("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var s=n.path.split("/").length,i=r.split("/").length;if(s!==i+1&&s!==i)throw new Qt("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new Qt("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var a={op:"_get",path:n.from,value:void 0},o=LW([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new Qt("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new Qt("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function LW(n,e,t){try{if(!Array.isArray(n))throw new Qt("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)m_(di(e),di(n),t||!0);else{t=t||KE;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(s){if(s instanceof Qt)return s;throw s}}function g_(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),s,i,a;if(t&&r){if(i=n.length,i!=e.length)return!1;for(s=i;s--!==0;)if(!g_(n[s],e[s]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(i=o.length,i!==Object.keys(e).length)return!1;for(s=i;s--!==0;)if(!e.hasOwnProperty(o[s]))return!1;for(s=i;s--!==0;)if(a=o[s],!g_(n[a],e[a]))return!1;return!0}return n!==n&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function xM(n,e,t,r,s){if(e!==n){typeof e.toJSON=="function"&&(e=e.toJSON());for(var i=DE(e),a=DE(n),o=!1,u=a.length-1;u>=0;u--){var l=a[u],d=n[l];if(FE(e,l)&&!(e[l]===void 0&&d!==void 0&&Array.isArray(e)===!1)){var h=e[l];typeof d=="object"&&d!=null&&typeof h=="object"&&h!=null&&Array.isArray(d)===Array.isArray(h)?xM(d,h,t,r+"/"+kl(l),s):d!==h&&(s&&t.push({op:"test",path:r+"/"+kl(l),value:di(d)}),t.push({op:"replace",path:r+"/"+kl(l),value:di(h)}))}else Array.isArray(n)===Array.isArray(e)?(s&&t.push({op:"test",path:r+"/"+kl(l),value:di(d)}),t.push({op:"remove",path:r+"/"+kl(l)}),o=!0):(s&&t.push({op:"test",path:r,value:n}),t.push({op:"replace",path:r,value:e}))}if(!(!o&&i.length==a.length))for(var u=0;u<i.length;u++){var l=i[u];!FE(n,l)&&e[l]!==void 0&&t.push({op:"add",path:r+"/"+kl(l),value:di(e[l])})}}}function FW(n,e,t=!1){var r=[];return xM(n,e,r,"",t),r}const DW=()=>typeof window<"u"&&typeof window.document<"u",BW=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",UW=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),HE=()=>typeof Deno<"u",qW=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!HE(),KW=()=>{let n;return DW()?n="browser":qW()?n="node":BW()?n="webworker":UW()?n="jsdom":HE()?n="deno":n="other",n};let WE;async function HW(){return WE===void 0&&(WE={library:"langchain-js",runtime:KW()}),WE}function Br(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:HE()?Deno==null?void 0:Deno.env.get(n):void 0}catch{return}}class WW{}function zW(n){return"lc_prefer_streaming"in n&&n.lc_prefer_streaming}class ip extends WW{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,QO(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:Br("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return fc.prototype.toJSON.call(this)}toJSONNotImplemented(){return fc.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends ip{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Yr()}),Object.assign(this,e)}}return new t}}const VW=n=>{const e=n;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"};function zE(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function GW(n){return n.replace(/[-:.]/g,"")}function ZW(n,e,t){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return GW(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function ap(n){return typeof n._addRunToRunMap=="function"}class op extends ip{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=ZW(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){const s=this.runMap.get(r.parent_run_id);s&&(this._addChildRun(s,r),s.child_execution_order=Math.max(s.child_execution_order,r.child_execution_order),r.trace_id=s.trace_id,s.dotted_order!==void 0&&(r.dotted_order=[s.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;return this.runMap.set(r.id,r),r}async _endTrace(e){var r;const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((r=this.onRunUpdate)==null?void 0:r.call(this,e))}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,s,i,a,o,u){const l=this._getExecutionOrder(s),d=Date.now(),h=o?{...i,metadata:o}:i,f={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:h??{},tags:a||[]};return this._addRunToRunMap(f)}async handleLLMStart(e,t,r,s,i,a,o,u){var d,h;const l=this.runMap.get(r)??this._createRunForLLMStart(e,t,r,s,i,a,o,u);return await((d=this.onRunCreate)==null?void 0:d.call(this,l)),await((h=this.onLLMStart)==null?void 0:h.call(this,l)),l}_createRunForChatModelStart(e,t,r,s,i,a,o,u){const l=this._getExecutionOrder(s),d=Date.now(),h=o?{...i,metadata:o}:i,f={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:h??{},tags:a||[]};return this._addRunToRunMap(f)}async handleChatModelStart(e,t,r,s,i,a,o,u){var d,h;const l=this.runMap.get(r)??this._createRunForChatModelStart(e,t,r,s,i,a,o,u);return await((d=this.onRunCreate)==null?void 0:d.call(this,l)),await((h=this.onLLMStart)==null?void 0:h.call(this,l)),l}async handleLLMEnd(e,t,r,s,i){var o;const a=this.runMap.get(t);if(!a||(a==null?void 0:a.run_type)!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await((o=this.onLLMEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleLLMError(e,t,r,s,i){var o;const a=this.runMap.get(t);if(!a||(a==null?void 0:a.run_type)!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...i},await((o=this.onLLMError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForChainStart(e,t,r,s,i,a,o,u){const l=this._getExecutionOrder(s),d=Date.now(),h={id:r,name:u??e.id[e.id.length-1],parent_run_id:s,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(h)}async handleChainStart(e,t,r,s,i,a,o,u){var d,h;const l=this.runMap.get(r)??this._createRunForChainStart(e,t,r,s,i,a,o,u);return await((d=this.onRunCreate)==null?void 0:d.call(this,l)),await((h=this.onChainStart)==null?void 0:h.call(this,l)),l}async handleChainEnd(e,t,r,s,i){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=zE(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=zE(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleChainError(e,t,r,s,i){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(a.inputs=zE(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForToolStart(e,t,r,s,i,a,o){const u=this._getExecutionOrder(s),l=Date.now(),d={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(d)}async handleToolStart(e,t,r,s,i,a,o){var l,d;const u=this.runMap.get(r)??this._createRunForToolStart(e,t,r,s,i,a,o);return await((l=this.onRunCreate)==null?void 0:l.call(this,u)),await((d=this.onToolStart)==null?void 0:d.call(this,u)),u}async handleToolEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onToolEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleToolError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onToolError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const s=r;s.actions=s.actions||[],s.actions.push(e),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,r))}async handleAgentEnd(e,t){var s;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentEnd)==null?void 0:s.call(this,r)))}_createRunForRetrieverStart(e,t,r,s,i,a,o){const u=this._getExecutionOrder(s),l=Date.now(),d={id:r,name:o??e.id[e.id.length-1],parent_run_id:s,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:i||[]};return this._addRunToRunMap(d)}async handleRetrieverStart(e,t,r,s,i,a,o){var l,d;const u=this.runMap.get(r)??this._createRunForRetrieverStart(e,t,r,s,i,a,o);return await((l=this.onRunCreate)==null?void 0:l.call(this,u)),await((d=this.onRetrieverStart)==null?void 0:d.call(this,u)),u}async handleRetrieverEnd(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverEnd)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((s=this.onRetrieverError)==null?void 0:s.call(this,r)),await this._endTrace(r),r}async handleText(e,t){var s;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((s=this.onText)==null?void 0:s.call(this,r)))}async handleLLMNewToken(e,t,r,s,i,a){var u;const o=this.runMap.get(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a==null?void 0:a.chunk}}),await((u=this.onLLMNewToken)==null?void 0:u.call(this,o,e,{chunk:a==null?void 0:a.chunk})),o}}var y_={exports:{}};y_.exports;var EM;function JW(){return EM||(EM=1,function(n){const t=(i=0)=>a=>`\x1B[${38+i};5;${a}m`,r=(i=0)=>(a,o,u)=>`\x1B[${38+i};2;${a};${o};${u}m`;function s(){const i=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,u]of Object.entries(a)){for(const[l,d]of Object.entries(u))a[l]={open:`\x1B[${d[0]}m`,close:`\x1B[${d[1]}m`},u[l]=a[l],i.set(d[0],d[1]);Object.defineProperty(a,o,{value:u,enumerable:!1})}return Object.defineProperty(a,"codes",{value:i,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=t(),a.color.ansi16m=r(),a.bgColor.ansi256=t(10),a.bgColor.ansi16m=r(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,u,l)=>o===u&&u===l?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(u/255*5)+Math.round(l/255*5),enumerable:!1},hexToRgb:{value:o=>{const u=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!u)return[0,0,0];let{colorString:l}=u.groups;l.length===3&&(l=l.split("").map(h=>h+h).join(""));const d=Number.parseInt(l,16);return[d>>16&255,d>>8&255,d&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(n,"exports",{enumerable:!0,get:s})}(y_)),y_.exports}var XW=JW();const kM=Ve(XW);function en(n,e){return`${n.open}${e}${n.close}`}function ns(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function CM(n){return typeof n=="string"?n.trim():n==null?n:ns(n,n.toString())}function Va(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:pn}=kM;class PM extends op{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const s=this.runMap.get(r.parent_run_id);if(s)t.push(s),r=s;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((s,i,a)=>{const o=`${s.execution_order}:${s.run_type}:${s.name}`;return i===a.length-1?en(kM.bold,o):o}).join(" > ");return en(pn.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${en(pn.green,"[chain/start]")} [${t}] Entering Chain run with input: ${ns(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${en(pn.cyan,"[chain/end]")} [${t}] [${Va(e)}] Exiting Chain run with output: ${ns(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${en(pn.red,"[chain/error]")} [${t}] [${Va(e)}] Chain run errored with error: ${ns(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(s=>s.trim())}:e.inputs;console.log(`${en(pn.green,"[llm/start]")} [${t}] Entering LLM run with input: ${ns(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${en(pn.cyan,"[llm/end]")} [${t}] [${Va(e)}] Exiting LLM run with output: ${ns(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${en(pn.red,"[llm/error]")} [${t}] [${Va(e)}] LLM run errored with error: ${ns(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${en(pn.green,"[tool/start]")} [${t}] Entering Tool run with input: "${CM(e.inputs.input)}"`)}onToolEnd(e){var r;const t=this.getBreadcrumbs(e);console.log(`${en(pn.cyan,"[tool/end]")} [${t}] [${Va(e)}] Exiting Tool run with output: "${CM((r=e.outputs)==null?void 0:r.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${en(pn.red,"[tool/error]")} [${t}] [${Va(e)}] Tool run errored with error: ${ns(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${en(pn.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${ns(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${en(pn.cyan,"[retriever/end]")} [${t}] [${Va(e)}] Exiting Retriever run with output: ${ns(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${en(pn.red,"[retriever/error]")} [${t}] [${Va(e)}] Retriever run errored with error: ${ns(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${en(pn.blue,"[agent/action]")} [${r}] Agent selected action: ${ns(t.actions[t.actions.length-1],"[action]")}`)}}let VE;const YW=()=>{if(VE===void 0){const n=Br("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};VE=new np(n)}return VE};class cp extends op{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:s}=e;this.projectName=r??Br("LANGCHAIN_PROJECT")??Br("LANGCHAIN_SESSION"),this.exampleId=t,this.client=s??YW();const i=cp.getTraceableRunTree();i&&this.updateFromRunTree(i)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await HW()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id,extra:e.extra};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();const s=[t];for(;s.length>0;){const i=s.shift();!i||r.has(i.id)||(r.add(i.id),this.runMap.set(i.id,i),i.child_runs&&s.push(...i.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},r=[];for(const[s,i]of this.runMap){const a=new $n({...i,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[s]=a,r.push([s,i.dotted_order])}r.sort((s,i)=>!s[1]||!i[1]?0:s[1].localeCompare(i[1]));for(const[s]of r){const i=this.runMap.get(s),a=t[s];if(!(!i||!a)&&i.parent_run_id){const o=t[i.parent_run_id];o&&(o.child_runs.push(a),a.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return RW()}catch{return}}}const AM=Symbol.for("ls:tracing_async_local_storage"),w_=Symbol.for("lc:context_variables"),QW=n=>{globalThis[AM]=n},up=()=>globalThis[AM];let lp;function ez(){const n="default"in Vi?Vi.default:Vi;return new n({autoStart:!0,concurrency:1})}function tz(){return typeof lp>"u"&&(lp=ez()),lp}async function sr(n,e){if(e===!0){const t=up();t!==void 0?await t.run(void 0,async()=>n()):await n()}else lp=tz(),lp.add(async()=>{const t=up();t!==void 0?await t.run(void 0,async()=>n()):await n()})}const rz=n=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>Br(t)==="true");function TM(n){var r;const e=up();if(e===void 0)return;const t=e.getStore();return(r=t==null?void 0:t[w_])==null?void 0:r[n]}const nz=Symbol("lc:configure_hooks"),sz=()=>TM(nz)||[];class iz{setHandler(e){return this.setHandlers([e])}}class b_{constructor(e,t,r,s,i,a,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>sr(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,s,i){await Promise.all(this.handlers.map(a=>sr(async()=>{var o;try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,this.runId,this.tags,this.metadata))}catch(u){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}}class az extends b_{getChild(e){const t=new mn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>sr(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw s}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>sr(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${s}`),t.raiseError)throw e}},t.awaitHandlers)))}}class IM extends b_{async handleLLMNewToken(e,t,r,s,i,a){await Promise.all(this.handlers.map(o=>sr(async()=>{var u;if(!o.ignoreLLM)try{await((u=o.handleLLMNewToken)==null?void 0:u.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(l){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${l}`),o.raiseError)throw l}},o.awaitHandlers)))}async handleLLMError(e,t,r,s,i){await Promise.all(this.handlers.map(a=>sr(async()=>{var o;if(!a.ignoreLLM)try{await((o=a.handleLLMError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMError: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}async handleLLMEnd(e,t,r,s,i){await Promise.all(this.handlers.map(a=>sr(async()=>{var o;if(!a.ignoreLLM)try{await((o=a.handleLLMEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMEnd: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}}class oz extends b_{getChild(e){const t=new mn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,s,i){await Promise.all(this.handlers.map(a=>sr(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}async handleChainEnd(e,t,r,s,i){await Promise.all(this.handlers.map(a=>sr(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>sr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>sr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class cz extends b_{getChild(e){const t=new mn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>sr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>sr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(s){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${s}`),t.raiseError)throw s}},t.awaitHandlers)))}}class mn extends iz{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,s=void 0,i=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(l,d)=>{const h=d===0&&r?r:Yr();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return ap(f)&&f._createRunForLLMStart(e,[l],h,this._parentRunId,i,this.tags,this.metadata,u),sr(async()=>{var p;try{await((p=f.handleLLMStart)==null?void 0:p.call(f,e,[l],h,this._parentRunId,i,this.tags,this.metadata,u))}catch(m){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${m}`),f.raiseError)throw m}},f.awaitHandlers)})),new IM(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,s=void 0,i=void 0,a=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(l,d)=>{const h=d===0&&r?r:Yr();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return ap(f)&&f._createRunForChatModelStart(e,[l],h,this._parentRunId,i,this.tags,this.metadata,u),sr(async()=>{var p,m;try{if(f.handleChatModelStart)await((p=f.handleChatModelStart)==null?void 0:p.call(f,e,[l],h,this._parentRunId,i,this.tags,this.metadata,u));else if(f.handleLLMStart){const g=rR(l);await((m=f.handleLLMStart)==null?void 0:m.call(f,e,[g],h,this._parentRunId,i,this.tags,this.metadata,u))}}catch(g){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${g}`),f.raiseError)throw g}},f.awaitHandlers)})),new IM(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=Yr(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreChain)return ap(u)&&u._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,s,o),sr(async()=>{var l;try{await((l=u.handleChainStart)==null?void 0:l.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,s,o))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new oz(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=Yr(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return ap(u)&&u._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),sr(async()=>{var l;try{await((l=u.handleToolStart)==null?void 0:l.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new cz(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=Yr(),s=void 0,i=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return ap(u)&&u._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),sr(async()=>{var l;try{await((l=u.handleRetrieverStart)==null?void 0:l.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new az(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,s,i){await Promise.all(this.handlers.map(a=>sr(async()=>{var o;if(!a.ignoreCustomEvent)try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,r,this.tags,this.metadata))}catch(u){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${u}`),a.raiseError)throw u}},a.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new mn(this._parentRunId);for(const s of this.handlers){const i=this.inheritableHandlers.includes(s);r.addHandler(s,i)}for(const s of this.tags){const i=this.inheritableTags.includes(s);r.addTags([s],i)}for(const s of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(s);r.addMetadata({[s]:this.metadata[s]},i)}for(const s of e)r.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===s.name)||r.addHandler(s,t);return r}static fromHandlers(e){class t extends ip{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Yr()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static configure(e,t,r,s,i,a,o){return this._configureSync(e,t,r,s,i,a,o)}static _configureSync(e,t,r,s,i,a,o){var f,p;let u;(e||t)&&(Array.isArray(e)||!e?(u=new mn,u.setHandlers((e==null?void 0:e.map(__))??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(__):t==null?void 0:t.handlers,!1));const l=Br("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),d=((f=cp.getTraceableRunTree())==null?void 0:f.tracingEnabled)||rz(),h=d||(Br("LANGCHAIN_TRACING")??!1);if(l||h){if(u||(u=new mn),l&&!u.handlers.some(m=>m.name===PM.prototype.name)){const m=new PM;u.addHandler(m,!0)}if(h&&!u.handlers.some(m=>m.name==="langchain_tracer")&&d){const m=new cp;u.addHandler(m,!0),u._parentRunId=((p=cp.getTraceableRunTree())==null?void 0:p.id)??u._parentRunId}}for(const{contextVar:m,inheritable:g=!0,handlerClass:y,envVar:w}of sz()){const S=w&&Br(w)==="true"&&y;let _;const v=m!==void 0?TM(m):void 0;v&&VW(v)?_=v:S&&(_=new y({})),_!==void 0&&(u||(u=new mn),u.handlers.some(A=>A.name===_.name)||u.addHandler(_,g))}return(r||s)&&u&&(u.addTags(r??[]),u.addTags(s??[],!1)),(i||a)&&u&&(u.addMetadata(i??{}),u.addMetadata(a??{},!1)),u}}function __(n){return"name"in n?n:ip.fromMethods(n)}class uz{getStore(){}run(e,t){return t()}enterWith(e){}}const lz=new uz,OM=Symbol.for("lc:child_config");class dz{getInstance(){return up()??lz}getRunnableConfig(){var t,r;return(r=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:r[OM]}runWithConfig(e,t,r){var d;const s=mn._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),i=this.getInstance(),a=i.getStore(),o=s==null?void 0:s.getParentRunId(),u=(d=s==null?void 0:s.handlers)==null?void 0:d.find(h=>(h==null?void 0:h.name)==="langchain_tracer");let l;return u&&o?l=u.convertToRunTree(o):r||(l=new $n({name:"<runnable_lambda>",tracingEnabled:!1})),l&&(l.extra={...l.extra,[OM]:e}),a!==void 0&&a[w_]!==void 0&&(l[w_]=a[w_]),i.run(l,t)}initializeGlobalInstance(e){up()===void 0&&QW(e)}}const Ga=new dz,GE=25;async function ks(n){return mn._configureSync(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function RM(...n){const e={};for(const t of n.filter(r=>!!r))for(const r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){const s=e[r]??[];e[r]=[...new Set(s.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(r==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(r==="callbacks"){const s=e.callbacks,i=t.callbacks;if(Array.isArray(i))if(!s)e.callbacks=i;else if(Array.isArray(s))e.callbacks=s.concat(i);else{const a=s.copy();for(const o of i)a.addHandler(__(o),!0);e.callbacks=a}else if(i)if(!s)e.callbacks=i;else if(Array.isArray(s)){const a=i.copy();for(const o of s)a.addHandler(__(o),!0);e.callbacks=a}else e.callbacks=new mn(i._parentRunId,{handlers:s.handlers.concat(i.handlers),inheritableHandlers:s.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(s.tags.concat(i.tags))),inheritableTags:Array.from(new Set(s.inheritableTags.concat(i.inheritableTags))),metadata:{...s.metadata,...i.metadata}})}else{const s=r;e[s]=t[s]??e[s]}return e}const hz=new Set(["string","number","boolean"]);function bt(n){var r;const e=Ga.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:s,runName:i,...a}=e;t=Object.entries(a).reduce((o,[u,l])=>(l!==void 0&&(o[u]=l),o),t)}if(n&&(t=Object.entries(n).reduce((s,[i,a])=>(a!==void 0&&(s[i]=a),s),t)),t!=null&&t.configurable)for(const s of Object.keys(t.configurable))hz.has(typeof t.configurable[s])&&!((r=t.metadata)!=null&&r[s])&&(t.metadata||(t.metadata={}),t.metadata[s]=t.configurable[s]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const s=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,s])):t.signal=s,delete t.timeout}return t}function Ur(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:s,configurable:i,runId:a}={}){const o=bt(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),s!==void 0&&(o.runName=s),i!==void 0&&(o.configurable={...o.configurable,...i}),a!==void 0&&delete o.runId,o}function Pl(n){return n?{configurable:n.configurable,recursionLimit:n.recursionLimit,callbacks:n.callbacks,tags:n.tags,metadata:n.metadata,maxConcurrency:n.maxConcurrency,timeout:n.timeout,signal:n.signal}:void 0}async function Za(n,e){if(e===void 0)return n;let t;return Promise.race([n.catch(r=>{if(!(e!=null&&e.aborted))throw r}),new Promise((r,s)=>{t=()=>{s(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&s(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class jn extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new jn({start(r){return s();function s(){return t.read().then(({done:i,value:a})=>{if(i){r.close();return}return r.enqueue(a),s()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new jn({async pull(t){const{value:r,done:s}=await e.next();s&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function MM(n,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(s){for(;;)if(s.length===0){const i=await n.next();for(const a of t)a.push(i)}else{if(s[0].done)return;yield s.shift().value}})}function ss(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){const t={...n};for(const[r,s]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=ss(t[r],s):t[r]=s;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}class Al{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((r,s)=>{Ga.runWithConfig(Pl(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(r,s):this.firstResult.then(i=>r(void 0),s)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?Ga.runWithConfig(Pl(this.config),this.signal?async()=>Za(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function fz(n,e,t,r,...s){const i=new Al({generator:e,startSetup:t,signal:r}),a=await i.setup;return{output:n(i,a,...s),setup:a}}class Ja{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),r=m_({},t);return new dp({ops:t,state:r[r.length-1].newDocument})}}class dp extends Ja{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=m_(this.state,e.ops);return new dp({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const t=m_({},e.ops);return new dp({ops:e.ops,state:t[t.length-1].newDocument})}}const pz=n=>n.name==="log_stream_tracer";async function NM(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function $M(n,e){const{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function mz(n){return n!==void 0&&n.message!==void 0}class jM extends op{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=jn.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),r}async*tapOutputIterable(e,t){for await(const r of t){if(e!==this.rootId){const s=this.keyMapByRunId[e];s&&await this.writer.write(new Ja({ops:[{op:"add",path:`/logs/${s}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var s;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Ja({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await NM(e,this._schemaFormat)),await this.writer.write(new Ja({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await NM(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await $M(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const s=new Ja({ops:r});await this.writer.write(s)}finally{if(e.id===this.rootId){const t=new Ja({ops:[{op:"replace",path:"/final_output",value:await $M(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){const s=this.keyMapByRunId[e.id];if(s===void 0)return;const i=e.inputs.messages!==void 0;let a;i?mz(r==null?void 0:r.chunk)?a=r==null?void 0:r.chunk:a=new nr({id:`run-${e.id}`,content:t}):a=t;const o=new Ja({ops:[{op:"add",path:`/logs/${s}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${s}/streamed_output/-`,value:a}]});await this.writer.write(o)}}const LM="__run";class Tl{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Tl({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class Ln extends Tl{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new Ln({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function v_({name:n,serialized:e}){return n!==void 0?n:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const gz=n=>n.name==="event_stream_tracer";class yz extends op{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=jn.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(s=>{var i;return(i=this.includeTags)==null?void 0:i.includes(s)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(s=>{var i;return!((i=this.excludeTags)!=null&&i.includes(s))})),r}async*tapOutputIterable(e,t){const r=await t.next();if(r.done)return;const s=this.runInfoMap.get(e);if(s===void 0){yield r.value;return}function i(o,u){return o==="llm"&&typeof u=="string"?new Tl({text:u}):u}let a=this.tappedPromises.get(e);if(a===void 0){let o;a=new Promise(u=>{o=u}),this.tappedPromises.set(e,a);try{const u={event:`on_${s.runType}_stream`,run_id:e,name:s.name,tags:s.tags,metadata:s.metadata,data:{}};await this.send({...u,data:{chunk:i(s.runType,r.value)}},s),yield r.value;for await(const l of t)s.runType!=="tool"&&s.runType!=="retriever"&&await this.send({...u,data:{chunk:i(s.runType,l)}},s),yield l}finally{o()}}else{yield r.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var a,o;const t=v_(e),r=e.inputs.messages!==void 0?"chat_model":"llm",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,s);const i=`on_${r}_start`;await this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onLLMNewToken(e,t,r){const s=this.runInfoMap.get(e.id);let i,a;if(s===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(s.runType==="chat_model")a="on_chat_model_stream",(r==null?void 0:r.chunk)===void 0?i=new nr({content:t,id:`run-${e.id}`}):i=r.chunk.message;else if(s.runType==="llm")a="on_llm_stream",(r==null?void 0:r.chunk)===void 0?i=new Tl({text:t}):i=r.chunk;else throw new Error(`Unexpected run type ${s.runType}`);await this.send({event:a,data:{chunk:i},run_id:e.id,name:s.name,tags:s.tags,metadata:s.metadata},s)}}async onLLMEnd(e){var a,o,u;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const s=(a=e.outputs)==null?void 0:a.generations;let i;if(t.runType==="chat_model"){for(const l of s??[]){if(i!==void 0)break;i=(o=l[0])==null?void 0:o.message}r="on_chat_model_end"}else if(t.runType==="llm")i={generations:s==null?void 0:s.map(l=>l.map(d=>({text:d.text,generationInfo:d.generationInfo}))),llmOutput:((u=e.outputs)==null?void 0:u.llmOutput)??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:r,data:{output:i,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var a,o;const t=v_(e),r=e.run_type??"chain",s={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:e.run_type};let i={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(i={},s.inputs={}):e.inputs.input!==void 0?(i.input=e.inputs.input,s.inputs=e.inputs.input):(i.input=e.inputs,s.inputs=e.inputs),this.runInfoMap.set(e.id,s),await this.send({event:`on_${r}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},s)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,s=e.inputs??t.inputs??{},a={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:s};s.input&&Object.keys(s).length===1&&(a.input=s.input,t.inputs=s.input),await this.sendEndEvent({event:r,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var s,i;const t=v_(e),r={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{}},r)}async onToolEnd(e){var s;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=((s=e.outputs)==null?void 0:s.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var i,a;const t=v_(e),s={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,s),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((a=e.extra)==null?void 0:a.metadata)??{}},s)}async onRetrieverEnd(e){var r;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((r=e.outputs)==null?void 0:r.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){const s=this.runInfoMap.get(r);if(s===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:s.tags,metadata:s.metadata,data:t},s)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const wz=[400,401,402,403,404,405,406,407,409],bz=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&wz.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const s=new Error(n==null?void 0:n.message);throw s.name="InsufficientQuotaError",s}};class ZE{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??bz;const t="default"in Vi?Vi.default:Vi;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>r_(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((s,i)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class FM extends op{constructor({config:e,onStart:t,onEnd:r,onError:s}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=s}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function JE(n){return n?n.lc_runnable:!1}class _z{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const s=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||s.some(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&s.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),r}}const vz=Symbol("Let zodToJsonSchema decide on which parser to use"),Sz={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},xz=n=>({...Sz,...n}),Ez=n=>{const e=xz(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function DM(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function xt(n,e,t,r,s){n[e]=t,DM(n,e,r,s)}function kz(){return{}}function Cz(n,e){var r,s,i;const t={type:"array"};return(r=n.type)!=null&&r._def&&((i=(s=n.type)==null?void 0:s._def)==null?void 0:i.typeName)!==Y.ZodAny&&(t.items=_t(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&xt(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&xt(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(xt(t,"minItems",n.exactLength.value,n.exactLength.message,e),xt(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Pz(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?xt(t,"minimum",r.value,r.message,e):xt(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),xt(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?xt(t,"maximum",r.value,r.message,e):xt(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),xt(t,"maximum",r.value,r.message,e));break;case"multipleOf":xt(t,"multipleOf",r.value,r.message,e);break}return t}function Az(){return{type:"boolean"}}function BM(n,e){return _t(n.type._def,e)}const Tz=(n,e)=>_t(n.innerType._def,e);function UM(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,i)=>UM(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Iz(n,e)}}const Iz=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":xt(t,"minimum",r.value,r.message,e);break;case"max":xt(t,"maximum",r.value,r.message,e);break}return t};function Oz(n,e){return{..._t(n.innerType._def,e),default:n.defaultValue()}}function Rz(n,e){return e.effectStrategy==="input"?_t(n.schema._def,e):{}}function Mz(n){return{type:"string",enum:Array.from(n.values)}}const Nz=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function $z(n,e){const t=[_t(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),_t(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(Nz(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...u}=i;a=u}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function jz(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let XE;const Cs={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(XE===void 0&&(XE=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),XE),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function qM(n,e){const t={type:"string"};if(n.checks)for(const r of n.checks)switch(r.kind){case"min":xt(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":xt(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Ps(t,"email",r.message,e);break;case"format:idn-email":Ps(t,"idn-email",r.message,e);break;case"pattern:zod":tn(t,Cs.email,r.message,e);break}break;case"url":Ps(t,"uri",r.message,e);break;case"uuid":Ps(t,"uuid",r.message,e);break;case"regex":tn(t,r.regex,r.message,e);break;case"cuid":tn(t,Cs.cuid,r.message,e);break;case"cuid2":tn(t,Cs.cuid2,r.message,e);break;case"startsWith":tn(t,RegExp(`^${YE(r.value,e)}`),r.message,e);break;case"endsWith":tn(t,RegExp(`${YE(r.value,e)}$`),r.message,e);break;case"datetime":Ps(t,"date-time",r.message,e);break;case"date":Ps(t,"date",r.message,e);break;case"time":Ps(t,"time",r.message,e);break;case"duration":Ps(t,"duration",r.message,e);break;case"length":xt(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),xt(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{tn(t,RegExp(YE(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&Ps(t,"ipv4",r.message,e),r.version!=="v4"&&Ps(t,"ipv6",r.message,e);break}case"base64url":tn(t,Cs.base64url,r.message,e);break;case"jwt":tn(t,Cs.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&tn(t,Cs.ipv4Cidr,r.message,e),r.version!=="v4"&&tn(t,Cs.ipv6Cidr,r.message,e);break}case"emoji":tn(t,Cs.emoji(),r.message,e);break;case"ulid":{tn(t,Cs.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Ps(t,"binary",r.message,e);break}case"contentEncoding:base64":{xt(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{tn(t,Cs.base64,r.message,e);break}}break}case"nanoid":tn(t,Cs.nanoid,r.message,e)}return t}function YE(n,e){return e.patternStrategy==="escape"?Fz(n):n}const Lz=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Fz(n){let e="";for(let t=0;t<n.length;t++)Lz.has(n[t])||(e+="\\"),e+=n[t];return e}function Ps(n,e,t,r){var s;n.format||(s=n.anyOf)!=null&&s.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):xt(n,"format",e,t,r)}function tn(n,e,t,r){var s;n.pattern||(s=n.allOf)!=null&&s.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:KM(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):xt(n,"pattern",KM(e,r),t,r)}function KM(n,e){var u;if(!e.applyRegexFlags||!n.flags)return n.source;const t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source;let s="",i=!1,a=!1,o=!1;for(let l=0;l<r.length;l++){if(i){s+=r[l],i=!1;continue}if(t.i){if(a){if(r[l].match(/[a-z]/)){o?(s+=r[l],s+=`${r[l-2]}-${r[l]}`.toUpperCase(),o=!1):r[l+1]==="-"&&((u=r[l+2])!=null&&u.match(/[a-z]/))?(s+=r[l],o=!0):s+=`${r[l]}${r[l].toUpperCase()}`;continue}}else if(r[l].match(/[a-z]/)){s+=`[${r[l]}${r[l].toUpperCase()}]`;continue}}if(t.m){if(r[l]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[l]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&r[l]==="."){s+=a?`${r[l]}\r
`:`[${r[l]}\r
]`;continue}s+=r[l],r[l]==="\\"?i=!0:a&&r[l]==="]"?a=!1:!a&&r[l]==="["&&(a=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return s}function HM(n,e){var r,s,i,a,o,u;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===Y.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((l,d)=>({...l,[d]:_t(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",d]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:_t(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((s=n.keyType)==null?void 0:s._def.typeName)===Y.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const{type:l,...d}=qM(n.keyType._def,e);return{...t,propertyNames:d}}else{if(((a=n.keyType)==null?void 0:a._def.typeName)===Y.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(((o=n.keyType)==null?void 0:o._def.typeName)===Y.ZodBranded&&n.keyType._def.type._def.typeName===Y.ZodString&&((u=n.keyType._def.type._def.checks)!=null&&u.length)){const{type:l,...d}=BM(n.keyType._def,e);return{...t,propertyNames:d}}}return t}function Dz(n,e){if(e.mapStrategy==="record")return HM(n,e);const t=_t(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=_t(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function Bz(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function Uz(){return{not:{}}}function qz(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const S_={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Kz(n,e){if(e.target==="openApi3")return WM(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in S_&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((s,i)=>{const a=S_[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return WM(n,e)}const WM=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>_t(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function Hz(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:S_[n.innerType._def.typeName],nullable:!0}:{type:[S_[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=_t(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=_t(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function Wz(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",DM(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?xt(t,"minimum",r.value,r.message,e):xt(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),xt(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?xt(t,"maximum",r.value,r.message,e):xt(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),xt(t,"maximum",r.value,r.message,e));break;case"multipleOf":xt(t,"multipleOf",r.value,r.message,e);break}return t}function zz(n,e){const t=e.target==="openAi",r={type:"object",properties:{}},s=[],i=n.shape();for(const o in i){let u=i[o];if(u===void 0||u._def===void 0)continue;let l=Gz(u);l&&t&&(u instanceof Ss&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),l=!1);const d=_t(u._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});d!==void 0&&(r.properties[o]=d,l||s.push(o))}s.length&&(r.required=s);const a=Vz(n,e);return a!==void 0&&(r.additionalProperties=a),r}function Vz(n,e){if(n.catchall._def.typeName!=="ZodNever")return _t(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function Gz(n){try{return n.isOptional()}catch{return!0}}const Zz=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return _t(n.innerType._def,e);const t=_t(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},Jz=(n,e)=>{if(e.pipeStrategy==="input")return _t(n.in._def,e);if(e.pipeStrategy==="output")return _t(n.out._def,e);const t=_t(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=_t(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}};function Xz(n,e){return _t(n.type._def,e)}function Yz(n,e){const r={type:"array",uniqueItems:!0,items:_t(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&xt(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&xt(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function Qz(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>_t(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:_t(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>_t(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function eV(){return{not:{}}}function tV(){return{}}const rV=(n,e)=>_t(n.innerType._def,e),nV=(n,e,t)=>{switch(e){case Y.ZodString:return qM(n,t);case Y.ZodNumber:return Wz(n,t);case Y.ZodObject:return zz(n,t);case Y.ZodBigInt:return Pz(n,t);case Y.ZodBoolean:return Az();case Y.ZodDate:return UM(n,t);case Y.ZodUndefined:return eV();case Y.ZodNull:return qz(t);case Y.ZodArray:return Cz(n,t);case Y.ZodUnion:case Y.ZodDiscriminatedUnion:return Kz(n,t);case Y.ZodIntersection:return $z(n,t);case Y.ZodTuple:return Qz(n,t);case Y.ZodRecord:return HM(n,t);case Y.ZodLiteral:return jz(n,t);case Y.ZodEnum:return Mz(n);case Y.ZodNativeEnum:return Bz(n);case Y.ZodNullable:return Hz(n,t);case Y.ZodOptional:return Zz(n,t);case Y.ZodMap:return Dz(n,t);case Y.ZodSet:return Yz(n,t);case Y.ZodLazy:return()=>n.getter()._def;case Y.ZodPromise:return Xz(n,t);case Y.ZodNaN:case Y.ZodNever:return Uz();case Y.ZodEffects:return Rz(n,t);case Y.ZodAny:return kz();case Y.ZodUnknown:return tV();case Y.ZodDefault:return Oz(n,t);case Y.ZodBranded:return BM(n,t);case Y.ZodReadonly:return rV(n,t);case Y.ZodCatch:return Tz(n,t);case Y.ZodPipeline:return Jz(n,t);case Y.ZodFunction:case Y.ZodVoid:case Y.ZodSymbol:return;default:return(r=>{})()}};function _t(n,e,t=!1){var o;const r=e.seen.get(n);if(e.override){const u=(o=e.override)==null?void 0:o.call(e,n,e,r,t);if(u!==vz)return u}if(r&&!t){const u=sV(r,e);if(u!==void 0)return u}const s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);const i=nV(n,n.typeName,e),a=typeof i=="function"?_t(i(),e):i;if(a&&aV(n,e,a),e.postProcess){const u=e.postProcess(a,n,e);return s.jsonSchema=a,u}return s.jsonSchema=a,a}const sV=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:iV(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},iV=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},aV=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),Zi=(n,e)=>{const t=Ez(e),r=void 0,s=e==null?void 0:e.name,i=_t(n._def,t,!1)??{},a=s===void 0?r?{...i,[t.definitionPath]:r}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...r,[s]:i}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function QE(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}const oV=["*","_","`"];function cV(n){let e="";for(const[t,r]of Object.entries(n))e+=`	classDef ${t} ${r};
`;return e}function uV(n,e,t){const{firstNode:r,lastNode:s,nodeColors:i,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=t??{};let l=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){const p="default",m={[p]:"{0}({1})"};r!==void 0&&(m[r]="{0}([{1}]):::first"),s!==void 0&&(m[s]="{0}([{1}]):::last");for(const[g,y]of Object.entries(n)){const w=y.name.split(":").pop()??"";let _=oV.some(A=>w.startsWith(A)&&w.endsWith(A))?`<p>${w}</p>`:w;Object.keys(y.metadata??{}).length&&(_+=`<hr/><small><em>${Object.entries(y.metadata??{}).map(([A,k])=>`${A} = ${k}`).join(`
`)}</em></small>`);const v=(m[g]??m[p]).replace("{0}",QE(g)).replace("{1}",_);l+=`	${v}
`}}const d={};for(const p of e){const m=p.source.split(":"),g=p.target.split(":"),y=m.filter((w,S)=>w===g[S]).join(":");d[y]||(d[y]=[]),d[y].push(p)}const h=new Set;function f(p,m){const g=p.length===1&&p[0].source===p[0].target;if(m&&!g){const y=m.split(":").pop();if(h.has(y))throw new Error(`Found duplicate subgraph '${y}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);h.add(y),l+=`	subgraph ${y}
`}for(const y of p){const{source:w,target:S,data:_,conditional:v}=y;let A="";if(_!==void 0){let k=_;const C=k.split(" ");C.length>u&&(k=Array.from({length:Math.ceil(C.length/u)},(E,N)=>C.slice(N*u,(N+1)*u).join(" ")).join("&nbsp;<br>&nbsp;")),A=v?` -. &nbsp;${k}&nbsp; .-> `:` -- &nbsp;${k}&nbsp; --> `}else A=v?" -.-> ":" --> ";l+=`	${QE(w)}${A}${QE(S)};
`}for(const y in d)y.startsWith(`${m}:`)&&y!==m&&f(d[y],y);m&&!g&&(l+=`	end
`)}f(d[""]??[],"");for(const p in d)!p.includes(":")&&p!==""&&f(d[p],p);return a&&(l+=cV(i??{})),l}async function lV(n,e){let{backgroundColor:t="white"}=e??{};const r=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const s=`https://mermaid.ink/img/${r}?bgColor=${t}`,i=await fetch(s);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join(`
`));return await i.blob()}function dV(n,e){if(n!==void 0&&!ep(n))return n;if(JE(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function hV(n){return JE(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...Zi(n.data.schema),title:n.data.name}}}class x_{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=ep(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...hV(t)})),edges:this.edges.map(t=>{const r={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(r.data=t.data),typeof t.conditional<"u"&&(r.conditional=t.conditional),r})}}addNode(e,t,r){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const s=t??Yr(),i={id:s,data:e,name:dV(t,e),metadata:r};return this.nodes[s]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,s){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const i={source:e.id,target:t.id,data:r,conditional:s};return this.edges.push(i),i}firstNode(){return zM(this)}lastNode(){return VM(this)}extend(e,t=""){let r=t;Object.values(e.nodes).map(l=>l.id).every(ep)&&(r="");const i=l=>r?`${r}:${l}`:l;Object.entries(e.nodes).forEach(([l,d])=>{this.nodes[i(l)]={...d,id:i(l)}});const a=e.edges.map(l=>({...l,source:i(l.source),target:i(l.target)}));this.edges=[...this.edges,...a];const o=e.firstNode(),u=e.lastNode();return[o?{id:i(o.id),data:o.data}:void 0,u?{id:i(u.id),data:u.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&zM(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&VM(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(s=>[s.id,s.name])),t=new Map;Object.values(e).forEach(s=>{t.set(s,(t.get(s)||0)+1)});const r=s=>{const i=e[s];return ep(s)&&t.get(i)===1?i:s};return new x_({nodes:Object.fromEntries(Object.entries(this.nodes).map(([s,i])=>[r(s),{...i,id:r(s)}])),edges:this.edges.map(s=>({...s,source:r(s.source),target:r(s.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:r,nodeColors:s={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:i}=e??{},a=this.reid(),o=a.firstNode(),u=a.lastNode();return uV(a.nodes,a.edges,{firstNode:o==null?void 0:o.id,lastNode:u==null?void 0:u.id,withStyles:t,curveStyle:r,nodeColors:s,wrapLabelNWords:i})}async drawMermaidPng(e){const t=this.drawMermaid(e);return lV(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function zM(n,e=[]){const t=new Set(n.edges.filter(s=>!e.includes(s.source)).map(s=>s.target)),r=[];for(const s of Object.values(n.nodes))!e.includes(s.id)&&!t.has(s.id)&&r.push(s);return r.length===1?r[0]:void 0}function VM(n,e=[]){const t=new Set(n.edges.filter(s=>!e.includes(s.target)).map(s=>s.source)),r=[];for(const s of Object.values(n.nodes))!e.includes(s.id)&&!t.has(s.id)&&r.push(s);return r.length===1?r[0]:void 0}function fV(n){const e=new TextEncoder,t=new ReadableStream({async start(r){for await(const s of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(s)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return jn.fromReadableStream(t)}function GM(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}const pV=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function";function ek(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*ZM(n,e){for(;;){const{value:t,done:r}=Ga.runWithConfig(Pl(n),e.next.bind(e),!0);if(r)break;yield t}}async function*tk(n,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:r,done:s}=await Ga.runWithConfig(Pl(n),t.next.bind(e),!0);if(s)break;yield r}}function br(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}class ir extends fc{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new yc({bound:this,kwargs:e,config:{}})}map(){return new E_({bound:this})}withRetry(e){return new mV({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new yc({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new yV({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(bt);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([s])=>s!=="runId"));return Array.from({length:t},(s,i)=>bt(i===0?e:r))}return Array.from({length:t},()=>bt(e))}async batch(e,t,r){var u;const s=this._getOptionsList(t??{},e.length),i=((u=s[0])==null?void 0:u.maxConcurrency)??(r==null?void 0:r.maxConcurrency),a=new ZE({maxConcurrency:i,onFailedAttempt:l=>{throw l}}),o=e.map((l,d)=>a.call(async()=>{try{return await this.invoke(l,s[d])}catch(h){if(r!=null&&r.returnExceptions)return h;throw h}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const r=bt(t),s=new Al({generator:this._streamIterator(e,r),config:r});return await s.setup,jn.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=bt(e):t=bt({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){const s=bt(r),i=await ks(s),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),br(t,"input"),s.runId,s==null?void 0:s.runType,void 0,void 0,(s==null?void 0:s.runName)??this.getName()));delete s.runId;let o;try{const u=e.call(this,t,s,a);o=await Za(u,r==null?void 0:r.signal)}catch(u){throw await(a==null?void 0:a.handleChainError(u)),u}return await(a==null?void 0:a.handleChainEnd(br(o,"output"))),o}async _batchWithConfig(e,t,r,s){var l;const i=this._getOptionsList(r??{},t.length),a=await Promise.all(i.map(ks)),o=await Promise.all(a.map(async(d,h)=>{const f=await(d==null?void 0:d.handleChainStart(this.toJSON(),br(t[h],"input"),i[h].runId,i[h].runType,void 0,void 0,i[h].runName??this.getName()));return delete i[h].runId,f}));let u;try{const d=e.call(this,t,i,o,s);u=await Za(d,(l=i==null?void 0:i[0])==null?void 0:l.signal)}catch(d){throw await Promise.all(o.map(h=>h==null?void 0:h.handleChainError(d))),d}return await Promise.all(o.map(d=>d==null?void 0:d.handleChainEnd(br(u,"output")))),u}async*_transformStreamWithConfig(e,t,r){let s,i=!0,a,o=!0;const u=bt(r),l=await ks(u);async function*d(){for await(const f of e){if(i)if(s===void 0)s=f;else try{s=ss(s,f)}catch{s=void 0,i=!1}yield f}}let h;try{const f=await fz(t.bind(this),d(),async()=>l==null?void 0:l.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),r==null?void 0:r.signal,u);delete u.runId,h=f.setup;const p=h==null?void 0:h.handlers.find(gz);let m=f.output;p!==void 0&&h!==void 0&&(m=p.tapOutputIterable(h.runId,m));const g=h==null?void 0:h.handlers.find(pz);g!==void 0&&h!==void 0&&(m=g.tapOutputIterable(h.runId,m));for await(const y of m)if(yield y,o)if(a===void 0)a=y;else try{a=ss(a,y)}catch{a=void 0,o=!1}}catch(f){throw await(h==null?void 0:h.handleChainError(f,void 0,void 0,void 0,{inputs:br(s,"input")})),f}await(h==null?void 0:h.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:br(s,"input")}))}getGraph(e){const t=new x_,r=t.addNode({name:`${this.getName()}Input`,schema:pe.any()}),s=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:pe.any()});return t.addEdge(r,s),t.addEdge(s,i),t}pipe(e){return new Fn({first:this,last:wc(e)})}pick(e){return this.pipe(new wV(e))}assign(e){return this.pipe(new JM(new Il({steps:e})))}async*transform(e,t){let r;for await(const s of e)r===void 0?r=s:r=ss(r,s);yield*this._streamIterator(r,bt(t))}async*streamLog(e,t,r){const s=new jM({...r,autoClose:!1,_schemaFormat:"original"}),i=bt(t);yield*this._streamLog(e,s,i)}async*_streamLog(e,t,r){const{callbacks:s}=r;if(s===void 0)r.callbacks=[t];else if(Array.isArray(s))r.callbacks=s.concat([t]);else{const u=s.copy();u.addHandler(t,!0),r.callbacks=u}const i=this.stream(e,r);async function a(){try{const u=await i;for await(const l of u){const d=new Ja({ops:[{op:"add",path:"/streamed_output/-",value:l}]});await t.writer.write(d)}}finally{await t.writer.close()}}const o=a();try{for await(const u of t)yield u}finally{await o}}streamEvents(e,t,r){let s;if(t.version==="v1")s=this._streamEventsV1(e,t,r);else if(t.version==="v2")s=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?fV(s):jn.fromAsyncGenerator(s)}async*_streamEventsV2(e,t,r){var m;const s=new yz({...r,autoClose:!1}),i=bt(t),a=i.runId??Yr();i.runId=a;const o=i.callbacks;if(o===void 0)i.callbacks=[s];else if(Array.isArray(o))i.callbacks=o.concat(s);else{const g=o.copy();g.addHandler(s,!0),i.callbacks=g}const u=new AbortController,l=this;async function d(){try{let g;t!=null&&t.signal?"any"in AbortSignal?g=AbortSignal.any([u.signal,t.signal]):(g=t.signal,t.signal.addEventListener("abort",()=>{u.abort()},{once:!0})):g=u.signal;const y=await l.stream(e,{...i,signal:g}),w=s.tapOutputIterable(a,y);for await(const S of w)if(u.signal.aborted)break}finally{await s.finish()}}const h=d();let f=!1,p;try{for await(const g of s){if(!f){g.data.input=e,f=!0,p=g.run_id,yield g;continue}g.run_id===p&&g.event.endsWith("_end")&&(m=g.data)!=null&&m.input&&delete g.data.input,yield g}}finally{u.abort(),await h}}async*_streamEventsV1(e,t,r){let s,i=!1;const a=bt(t),o=a.tags??[],u=a.metadata??{},l=a.runName??this.getName(),d=new jM({...r,autoClose:!1,_schemaFormat:"streaming_events"}),h=new _z({...r}),f=this._streamLog(e,d,a);for await(const m of f){if(s?s=s.concat(m):s=dp.fromRunLogPatch(m),s.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;const S={...s.state},_={run_id:S.id,event:`on_${S.type}_start`,name:l,tags:o,metadata:u,data:{input:e}};h.includeEvent(_,S.type)&&(yield _)}const g=m.ops.filter(S=>S.path.startsWith("/logs/")).map(S=>S.path.split("/")[2]),y=[...new Set(g)];for(const S of y){let _,v={};const A=s.state.logs[S];if(A.end_time===void 0?A.streamed_output.length>0?_="stream":_="start":_="end",_==="start")A.inputs!==void 0&&(v.input=A.inputs);else if(_==="end")A.inputs!==void 0&&(v.input=A.inputs),v.output=A.final_output;else if(_==="stream"){const k=A.streamed_output.length;if(k!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${k} instead. Encountered in: "${A.name}"`);v={chunk:A.streamed_output[0]},A.streamed_output=[]}yield{event:`on_${A.type}_${_}`,name:A.name,run_id:A.id,tags:A.tags,metadata:A.metadata,data:v}}const{state:w}=s;if(w.streamed_output.length>0){const S=w.streamed_output.length;if(S!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${S} instead. Encountered in: "${w.name}"`);const _={chunk:w.streamed_output[0]};w.streamed_output=[];const v={event:`on_${w.type}_stream`,run_id:w.id,tags:o,metadata:u,name:l,data:_};h.includeEvent(v,w.type)&&(yield v)}}const p=s==null?void 0:s.state;if(p!==void 0){const m={event:`on_${p.type}_end`,name:l,run_id:p.id,tags:o,metadata:u,data:{output:p.final_output}};h.includeEvent(m,p.type)&&(yield m)}}static isRunnable(e){return JE(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new yc({bound:this,config:{},configFactories:[s=>({callbacks:[new FM({config:s,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return bV(this,e)}}class yc extends ir{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=RM(this.config,...e);return RM(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(bt(t),this.kwargs))}async batch(e,t,r){const s=Array.isArray(t)?await Promise.all(t.map(async i=>this._mergeConfig(bt(i),this.kwargs))):await this._mergeConfig(bt(t),this.kwargs);return this.bound.batch(e,s,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(bt(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(bt(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(bt(t),this.kwargs))}streamEvents(e,t,r){const s=this,i=async function*(){yield*s.bound.streamEvents(e,{...await s._mergeConfig(bt(t),s.kwargs),version:t.version},r)};return jn.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&ir.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new yc({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[s=>({callbacks:[new FM({config:s,onStart:e,onEnd:t,onError:r})]})]})}}class E_ extends ir{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new E_({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,Ur(t,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new E_({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class mV extends yc{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const s=e>1?`retry:attempt:${e}`:void 0;return Ur(t,{callbacks:r==null?void 0:r.getChild(s)})}async _invoke(e,t,r){return r_(s=>super.invoke(e,this._patchConfigForRetry(s,t,r)),{onFailedAttempt:s=>this.onFailedAttempt(s,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,s){const i={};try{await r_(async a=>{const o=e.map((f,p)=>p).filter(f=>i[f.toString()]===void 0||i[f.toString()]instanceof Error),u=o.map(f=>e[f]),l=o.map(f=>this._patchConfigForRetry(a,t==null?void 0:t[f],r==null?void 0:r[f])),d=await super.batch(u,l,{...s,returnExceptions:!0});let h;for(let f=0;f<d.length;f+=1){const p=d[f],m=o[f];p instanceof Error&&h===void 0&&(h=p,h.input=u[f]),i[m.toString()]=p}if(h)throw h;return d},{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((s==null?void 0:s.returnExceptions)!==!0)throw a}return Object.keys(i).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>i[parseInt(a,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class Fn extends ir{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var u;const r=bt(t),s=await ks(r),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),br(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let a=e,o;try{const l=[this.first,...this.middle];for(let d=0;d<l.length;d+=1){const f=l[d].invoke(a,Ur(r,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${d+1}`)}));a=await Za(f,t==null?void 0:t.signal)}if((u=t==null?void 0:t.signal)!=null&&u.aborted)throw new Error("Aborted");o=await this.last.invoke(a,Ur(r,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(l){throw await(i==null?void 0:i.handleChainError(l)),l}return await(i==null?void 0:i.handleChainEnd(br(o,"output"))),o}async batch(e,t,r){var u;const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(ks)),a=await Promise.all(i.map(async(l,d)=>{const h=await(l==null?void 0:l.handleChainStart(this.toJSON(),br(e[d],"input"),s[d].runId,void 0,void 0,void 0,s[d].runName));return delete s[d].runId,h}));let o=e;try{for(let l=0;l<this.steps.length;l+=1){const h=this.steps[l].batch(o,a.map((f,p)=>{const m=f==null?void 0:f.getChild(this.omitSequenceTags?void 0:`seq:step:${l+1}`);return Ur(s[p],{callbacks:m})}),r);o=await Za(h,(u=s[0])==null?void 0:u.signal)}}catch(l){throw await Promise.all(a.map(d=>d==null?void 0:d.handleChainError(l))),l}return await Promise.all(a.map(l=>l==null?void 0:l.handleChainEnd(br(o,"output")))),o}async*_streamIterator(e,t){var h;const r=await ks(t),{runId:s,...i}=t??{},a=await(r==null?void 0:r.handleChainStart(this.toJSON(),br(e,"input"),s,void 0,void 0,void 0,i==null?void 0:i.runName)),o=[this.first,...this.middle,this.last];let u=!0,l;async function*d(){yield e}try{let f=o[0].transform(d(),Ur(i,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let p=1;p<o.length;p+=1)f=await o[p].transform(f,Ur(i,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${p+1}`)}));for await(const p of f)if((h=t==null?void 0:t.signal)==null||h.throwIfAborted(),yield p,u)if(l===void 0)l=p;else try{l=ss(l,p)}catch{l=void 0,u=!1}}catch(f){throw await(a==null?void 0:a.handleChainError(f)),f}await(a==null?void 0:a.handleChainEnd(br(l,"output")))}getGraph(e){const t=new x_;let r=null;return this.steps.forEach((s,i)=>{const a=s.getGraph(e);i!==0&&a.trimFirstNode(),i!==this.steps.length-1&&a.trimLastNode(),t.extend(a);const o=a.firstNode();if(!o)throw new Error(`Runnable ${s} has no first node`);r&&t.addEdge(r,o),r=a.lastNode()}),t}pipe(e){return Fn.isRunnableSequence(e)?new Fn({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new Fn({first:this.first,middle:[...this.middle,this.last],last:wc(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&ir.isRunnable(e)}static from([e,...t],r){let s={};return typeof r=="string"?s.name=r:r!==void 0&&(s=r),new Fn({...s,first:wc(e),middle:t.slice(0,-1).map(wc),last:wc(t[t.length-1])})}}class Il extends ir{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=wc(r)}static from(e){return new Il({steps:e})}async invoke(e,t){const r=bt(t),s=await ks(r),i=await(s==null?void 0:s.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const a={};try{const o=Object.entries(this.steps).map(async([u,l])=>{a[u]=await l.invoke(e,Ur(r,{callbacks:i==null?void 0:i.getChild(`map:key:${u}`)}))});await Za(Promise.all(o),t==null?void 0:t.signal)}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(a)),a}async*_transform(e,t,r){const s={...this.steps},i=MM(e,Object.keys(s).length),a=new Map(Object.entries(s).map(([o,u],l)=>{const d=u.transform(i[l],Ur(r,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,d.next().then(h=>({key:o,gen:d,result:h}))]}));for(;a.size;){const o=Promise.race(a.values()),{key:u,result:l,gen:d}=await Za(o,r==null?void 0:r.signal);a.delete(u),l.done||(yield{[u]:l.value},a.set(u,d.next().then(h=>({key:u,gen:d,result:h}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=bt(t),i=new Al({generator:this.transform(r(),s),config:s});return await i.setup,jn.fromAsyncGenerator(i)}}class rk extends ir{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!LE(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[r]=this._getOptionsList(t??{},1),s=await ks(r),i=this.func(Ur(r,{callbacks:s}),e);return Za(i,r==null?void 0:r.signal)}async*_streamIterator(e,t){var i,a;const[r]=this._getOptionsList(t??{},1),s=await this.invoke(e,t);if(ek(s)){for await(const o of s)(i=r==null?void 0:r.signal)==null||i.throwIfAborted(),yield o;return}if(pV(s)){for(;;){(a=r==null?void 0:r.signal)==null||a.throwIfAborted();const o=s.next();if(o.done)break;yield o.value}return}yield s}static from(e){return new rk({func:e})}}function gV(n){if(LE(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class hp extends ir{static lc_name(){return"RunnableLambda"}constructor(e){if(LE(e.func))return rk.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),gV(e.func),this.func=e.func}static from(e){return new hp({func:e})}async _invoke(e,t,r){return new Promise((s,i)=>{const a=Ur(t,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??GE)-1});Ga.runWithConfig(Pl(a),async()=>{var o,u;try{let l=await this.func(e,{...a});if(l&&ir.isRunnable(l)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");l=await l.invoke(e,{...a,recursionLimit:(a.recursionLimit??GE)-1})}else if(ek(l)){let d;for await(const h of tk(a,l))if((o=t==null?void 0:t.signal)==null||o.throwIfAborted(),d===void 0)d=h;else try{d=ss(d,h)}catch{d=h}l=d}else if(GM(l)){let d;for(const h of ZM(a,l))if((u=t==null?void 0:t.signal)==null||u.throwIfAborted(),d===void 0)d=h;else try{d=ss(d,h)}catch{d=h}l=d}s(l)}catch(l){i(l)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,r){var o,u;let s;for await(const l of e)if(s===void 0)s=l;else try{s=ss(s,l)}catch{s=l}const i=Ur(r,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??GE)-1}),a=await new Promise((l,d)=>{Ga.runWithConfig(Pl(i),async()=>{try{const h=await this.func(s,{...i,config:i});l(h)}catch(h){d(h)}})});if(a&&ir.isRunnable(a)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const l=await a.stream(s,i);for await(const d of l)yield d}else if(ek(a))for await(const l of tk(i,a))(o=r==null?void 0:r.signal)==null||o.throwIfAborted(),yield l;else if(GM(a))for(const l of ZM(i,a))(u=r==null?void 0:r.signal)==null||u.throwIfAborted(),yield l;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=bt(t),i=new Al({generator:this.transform(r(),s),config:s});return await i.setup,jn.fromAsyncGenerator(i)}}class yV extends ir{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=bt(t),s=await ks(r),{runId:i,...a}=r,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),br(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName)),u=Ur(a,{callbacks:o==null?void 0:o.getChild()});return await Ga.runWithConfig(u,async()=>{var h;let d;for(const f of this.runnables()){(h=r==null?void 0:r.signal)==null||h.throwIfAborted();try{const p=await f.invoke(e,u);return await(o==null?void 0:o.handleChainEnd(br(p,"output"))),p}catch(p){d===void 0&&(d=p)}}throw d===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(d)),d)})}async*_streamIterator(e,t){var h;const r=bt(t),s=await ks(r),{runId:i,...a}=r,o=await(s==null?void 0:s.handleChainStart(this.toJSON(),br(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName));let u,l;for(const f of this.runnables()){(h=r==null?void 0:r.signal)==null||h.throwIfAborted();const p=Ur(a,{callbacks:o==null?void 0:o.getChild()});try{const m=await f.stream(e,p);l=tk(p,m);break}catch(m){u===void 0&&(u=m)}}if(l===void 0){const f=u??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(f)),f}let d;try{for await(const f of l){yield f;try{d=d===void 0?d:ss(d,f)}catch{d=void 0}}}catch(f){throw await(o==null?void 0:o.handleChainError(f)),f}await(o==null?void 0:o.handleChainEnd(br(d,"output")))}async batch(e,t,r){var u;if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const s=this._getOptionsList(t??{},e.length),i=await Promise.all(s.map(l=>ks(l))),a=await Promise.all(i.map(async(l,d)=>{const h=await(l==null?void 0:l.handleChainStart(this.toJSON(),br(e[d],"input"),s[d].runId,void 0,void 0,void 0,s[d].runName));return delete s[d].runId,h}));let o;for(const l of this.runnables()){(u=s[0].signal)==null||u.throwIfAborted();try{const d=await l.batch(e,a.map((h,f)=>Ur(s[f],{callbacks:h==null?void 0:h.getChild()})),r);return await Promise.all(a.map((h,f)=>h==null?void 0:h.handleChainEnd(br(d[f],"output")))),d}catch(d){o===void 0&&(o=d)}}throw o?(await Promise.all(a.map(l=>l==null?void 0:l.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function wc(n){if(typeof n=="function")return new hp({func:n});if(ir.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=wc(r);return new Il({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class JM extends ir{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Il&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const s=this.mapper.getStepsKeys(),[i,a]=MM(e),o=this.mapper.transform(a,Ur(r,{callbacks:t==null?void 0:t.getChild()})),u=o.next();for await(const l of i){if(typeof l!="object"||Array.isArray(l))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof l}`);const d=Object.fromEntries(Object.entries(l).filter(([h])=>!s.includes(h)));Object.keys(d).length>0&&(yield d)}yield(await u).value;for await(const l of o)yield l}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=bt(t),i=new Al({generator:this.transform(r(),s),config:s});return await i.setup,jn.fromAsyncGenerator(i)}}class wV extends ir{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const s=bt(t),i=new Al({generator:this.transform(r(),s),config:s});return await i.setup,jn.fromAsyncGenerator(i)}}class XM extends yc{constructor(e){const t=Fn.from([hp.from(async r=>{let s;if(tR(r))try{s=await this.schema.parseAsync(r.args)}catch{throw new c6("Received tool input did not match expected schema",JSON.stringify(r.args))}else s=r;return s}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function bV(n,e){var s;const t=e.name??n.getName(),r=e.description??((s=e.schema)==null?void 0:s.description);return e.schema.constructor===pe.ZodString?new XM({name:t,description:r,schema:pe.object({input:pe.string()}).transform(i=>i.input),bound:n}):new XM({name:t,description:r,schema:e.schema,bound:n})}class _V{constructor(){this.messages=[],this.totalTokens=0}addMessage(e,t={inputTokens:0},r){const s={message:e,metadata:t};r===void 0?this.messages.push(s):this.messages.splice(r,0,s),this.totalTokens+=t.inputTokens}removeMessage(e=-1){if(this.messages.length>0){const t=this.messages.splice(e,1)[0];this.totalTokens-=t.metadata.inputTokens}}removeLastHumanMessage(){if(this.messages.length>2&&this.messages[this.messages.length-1].message instanceof Bt){const e=this.messages.pop();e&&(this.totalTokens-=e.metadata.inputTokens)}}}const fp=ws("MessageManager");class nk{constructor({maxInputTokens:e=128e3,estimatedCharactersPerToken:t=3,imageTokens:r=800,sensitiveData:s}={}){this.maxInputTokens=e,this.history=new _V,this.estimatedCharactersPerToken=t,this.IMG_TOKENS=r,this.sensitiveData=s,this.toolId=1}initTaskMessages(e,t,r){if(this.addMessageWithTokens(e),r&&r.length>0){const h=new Bt({content:`Context for the task: ${r}`});this.addMessageWithTokens(h)}const s=nk.taskInstructions(t);if(this.addMessageWithTokens(s),this.sensitiveData){const h=`Here are placeholders for sensitive data: ${Object.keys(this.sensitiveData)}`,f=new Bt({content:`${h}
To use them, write <secret>the placeholder name</secret>`});this.addMessageWithTokens(f)}const i=new Bt({content:"Example output:"});this.addMessageWithTokens(i);const a=this.nextToolId(),o=[{name:"navigator_output",args:{current_state:{page_summary:"On the page are company a,b,c wtih their revenue 1,2,3.",evaluation_previous_goal:"Success - I opend the first page",memory:"Starting with the new task. I have completed 1/10 steps",next_goal:"Click on company a"},action:[{click_element:{index:0}}]},id:String(a),type:"tool_call"}],u=new Dr({content:"example tool call",tool_calls:o});this.addMessageWithTokens(u);const l=new e_({content:"Browser started",tool_call_id:String(a)});this.addMessageWithTokens(l);const d=new Bt({content:"[Your task history memory starts here]"});this.addMessageWithTokens(d)}nextToolId(){const e=this.toolId;return this.toolId+=1,e}static taskInstructions(e){const t=`Your ultimate task is: """${e}""". If you achieved your ultimate task, stop everything and use the done action in the next step to complete the task. If not, continue as usual.`;return new Bt({content:t})}length(){return this.history.messages.length}addNewTask(e){const t=`Your new ultimate task is: """${e}""". Take the previous context into account and finish your new ultimate task. `,r=new Bt({content:t});this.addMessageWithTokens(r)}addPlan(e,t){if(e){const r=new Dr({content:e});this.addMessageWithTokens(r,t)}}addStateMessage(e){this.addMessageWithTokens(e)}removeLastStateMessage(){this.history.removeLastHumanMessage()}getMessages(){const e=this.history.messages.map(r=>r.message);let t=0;fp.debug(`Messages in history: ${this.history.messages.length}:`);for(const r of this.history.messages)t+=r.metadata.inputTokens,fp.debug(`${r.message.constructor.name} - Token count: ${r.metadata.inputTokens}`);return e}getMessagesWithTokens(){return this.history.messages}addMessageWithTokens(e,t){let r=e;this.sensitiveData&&(r=this._filterSensitiveData(e));const i={inputTokens:this._countTokens(r)};this.history.addMessage(r,i,t)}_filterSensitiveData(e){const t=r=>{let s=r;if(!this.sensitiveData)return s;for(const[i,a]of Object.entries(this.sensitiveData))s=s.replace(a,`<secret>${i}</secret>`);return s};return typeof e.content=="string"?e.content=t(e.content):Array.isArray(e.content)&&(e.content=e.content.map(r=>typeof r=="object"&&"text"in r?{...r,text:t(r.text)}:r)),e}_countTokens(e){let t=0;if(Array.isArray(e.content))for(const r of e.content)"image_url"in r?t+=this.IMG_TOKENS:typeof r=="object"&&"text"in r&&(t+=this._countTextTokens(r.text));else{let r=e.content;"tool_calls"in e&&(r+=JSON.stringify(e.tool_calls)),t+=this._countTextTokens(r)}return t}_countTextTokens(e){return Math.floor(e.length/this.estimatedCharactersPerToken)}cutMessages(){let e=this.history.totalTokens-this.maxInputTokens;if(e<=0)return;const t=this.history.messages[this.history.messages.length-1];if(Array.isArray(t.message.content)){let l="";t.message.content=t.message.content.filter(d=>"image_url"in d?(e-=this.IMG_TOKENS,t.metadata.inputTokens-=this.IMG_TOKENS,this.history.totalTokens-=this.IMG_TOKENS,fp.debug(`Removed image with ${this.IMG_TOKENS} tokens - total tokens now: ${this.history.totalTokens}/${this.maxInputTokens}`),!1):("text"in d&&(l+=d.text),!0)),t.message.content=l,this.history.messages[this.history.messages.length-1]=t}if(e<=0)return;const r=e/t.metadata.inputTokens;if(r>.99)throw new Error(`Max token limit reached - history is too long - reduce the system prompt or task. proportion_to_remove: ${r}`);fp.debug(`Removing ${(r*100).toFixed(2)}% of the last message (${(r*t.metadata.inputTokens).toFixed(2)} / ${t.metadata.inputTokens.toFixed(2)} tokens)`);const s=t.message.content,i=Math.floor(s.length*r),a=s.slice(0,-i);this.history.removeMessage(-1);const o=new Bt({content:a});this.addMessageWithTokens(o);const u=this.history.messages[this.history.messages.length-1];fp.debug(`Added message with ${u.metadata.inputTokens} tokens - total tokens now: ${this.history.totalTokens}/${this.maxInputTokens} - total messages: ${this.history.messages.length}`)}}function vV(n){return n.map(e=>{if(e instanceof Bt||e instanceof Sl)return e;if(e instanceof e_)return new Bt({content:`Tool Response: ${e.content}`});if(e instanceof Dr){if("tool_calls"in e&&e.tool_calls){const t=e.tool_calls.map(r=>"function"in r&&typeof r.function=="object"&&r.function&&"name"in r.function&&"arguments"in r.function?`Function: ${r.function.name}
Arguments: ${JSON.stringify(r.function.arguments)}`:`Tool Call: ${JSON.stringify(r)}`).join(`
`);return new Dr({content:t})}return e}throw new Error(`Unknown message type: ${e.constructor.name}`)})}function YM(n,e){const t=[];let r=0;for(const s of n)if(s instanceof e)if(r+=1,r>1){const i=t[t.length-1];if(Array.isArray(s.content)){const a=s.content[0];"text"in a&&(i.content+=a.text)}else i.content+=s.content}else t.push(s);else t.push(s),r=0;return t}const k_=ws("agent"),SV=/<think>[\s\S]*?<\/think>/;class sk{constructor(e,t,r){this.actions={},this.modelOutputSchema=e,this.chatLLM=t.chatLLM,this.prompt=t.prompt,this.context=t.context,this.chatModelLibrary=this.chatLLM.constructor.name,this.modelName=this.getModelName(),this.withStructuredOutput=this.setWithStructuredOutput(),this.id=(r==null?void 0:r.id)||"agent",this.toolCallingMethod=this.setToolCallingMethod(r==null?void 0:r.toolCallingMethod),this.callOptions=r==null?void 0:r.callOptions,this.modelOutputToolName=`${this.id}_output`}getModelName(){return"modelName"in this.chatLLM?this.chatLLM.modelName:"model_name"in this.chatLLM?this.chatLLM.model_name:"model"in this.chatLLM?this.chatLLM.model:"Unknown"}setToolCallingMethod(e){if(e==="auto")switch(this.chatModelLibrary){case"ChatGoogleGenerativeAI":return null;case"ChatOpenAI":case"AzureChatOpenAI":case"ChatGroq":case"ChatXAI":return"function_calling";default:return null}return e||null}setWithStructuredOutput(){return!(this.modelName==="deepseek-reasoner"||this.modelName==="deepseek-r1")}removeThinkTags(e){return e.replace(SV,"")}convertInputMessages(e,t){if(!t)return e;if(t==="deepseek-reasoner"||t.startsWith("deepseek-r1")){const r=vV(e);let s=YM(r,Bt);return s=YM(s,Dr),s}return e}async invoke(e){if(this.withStructuredOutput){const i=this.chatLLM.withStructuredOutput(this.modelOutputSchema,{includeRaw:!0,name:this.modelOutputToolName});try{const a=await i.invoke(e,{...this.callOptions});if(a.parsed)return a.parsed;throw k_.error("Failed to parse response",a),new Error("Could not parse response with structured output")}catch(a){const o=`Failed to invoke ${this.modelName} with structured output: ${a}`;throw new Error(o)}}const t=this.convertInputMessages(e,this.modelName),r=await this.chatLLM.invoke(t,{...this.callOptions});if(typeof r.content=="string"){r.content=this.removeThinkTags(r.content);try{const i=this.extractJsonFromModelOutput(r.content),a=this.validateModelOutput(i);if(a)return a}catch(i){const a=`Failed to extract JSON from response: ${i}`;throw new Error(a)}}const s=`Failed to parse response: ${r}`;throw k_.error(s),new Error("Could not parse response")}validateModelOutput(e){if(!(!this.modelOutputSchema||!e))try{return this.modelOutputSchema.parse(e)}catch(t){throw k_.error("validateModelOutput",t),new Error("Could not validate model output")}}addModelOutputToMemory(e){const t=this.context.messageManager,r=String(t.nextToolId()),s=[{name:this.modelOutputToolName,args:e,id:r,type:"tool_call"}],i=new Dr({content:"tool call",tool_calls:s});t.addMessageWithTokens(i);const a=new e_({content:"tool call response placeholder",tool_call_id:r});t.addMessageWithTokens(a)}extractJsonFromModelOutput(e){try{let t=e;return e.includes("```")&&(t=t.split("```")[1],t.includes(`json
`)&&(t=t.replace(/^json\s*/,""))),JSON.parse(t)}catch(t){throw k_.warning(`Failed to parse model output: ${e} ${t}`),new Error("Failed to extract JSON from model output.")}}}const QM={name:"done",description:"Complete task",schema:pe.object({text:pe.string()})},xV={name:"search_google",description:"Search Google in the current tab",schema:pe.object({query:pe.string()})},EV={name:"go_to_url",description:"Navigate to URL in the current tab",schema:pe.object({url:pe.string()})},kV={name:"go_back",description:"Go back to the previous page",schema:pe.object({})},CV={name:"click_element",description:"Click element",schema:pe.object({desc:pe.string().optional(),index:pe.number(),xpath:pe.string().nullable().optional()})},PV={name:"input_text",description:"Input text into an interactive input element",schema:pe.object({desc:pe.string().optional(),index:pe.number(),text:pe.string(),xpath:pe.string().nullable().optional()})},AV={name:"switch_tab",description:"Switch to tab by id",schema:pe.object({tab_id:pe.number()})},TV={name:"open_tab",description:"Open URL in new tab",schema:pe.object({url:pe.string()})},IV={name:"extract_content",description:"Extract page content to retrieve specific information from the page, e.g. all company names, a specific description, all information about, links with companies in structured format or simply links",schema:pe.object({goal:pe.string()})},eN={name:"cache_content",description:"Cache the extracted content of the page",schema:pe.object({content:pe.string()})},OV={name:"scroll_down",description:"Scroll down the page by pixel amount - if no amount is specified, scroll down one page",schema:pe.object({desc:pe.string().optional(),amount:pe.number().nullable().optional()})},RV={name:"scroll_up",description:"Scroll up the page by pixel amount - if no amount is specified, scroll up one page",schema:pe.object({desc:pe.string().optional(),amount:pe.number().nullable().optional()})},MV={name:"send_keys",description:"Send strings of special keys like Backspace, Insert, PageDown, Delete, Enter. Shortcuts such as `Control+o`, `Control+Shift+T` are supported as well. This gets used in keyboard press. Be aware of different operating systems and their shortcuts",schema:pe.object({desc:pe.string().optional(),keys:pe.string()})},NV={name:"scroll_to_text",description:"If you dont find something which you want to interact with, scroll to it",schema:pe.object({desc:pe.string().optional(),text:pe.string()})},$V={name:"get_dropdown_options",description:"Get all options from a native dropdown",schema:pe.object({index:pe.number()})},jV={name:"select_dropdown_option",description:"Select dropdown option for interactive element index by the text of the option you want to select",schema:pe.object({index:pe.number(),text:pe.string()})};class LV extends ir{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[i,a]of Object.entries(t))typeof a=="string"?r[i]=a:r[i]=await a();return{...r,...e}}async invoke(e,t){const r={...this.metadata,...t==null?void 0:t.metadata},s=[...this.tags??[],...(t==null?void 0:t.tags)??[]];return this._callWithConfig(i=>this.formatPromptValue(i),e,{...t,tags:s,metadata:r,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await Promise.resolve().then(()=>uN);return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await Promise.resolve().then(()=>uN);return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await Promise.resolve().then(()=>iG);return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class tN extends fc{}class rN extends tN{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new Bt(this.value)]}}class FV extends tN{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return rR(this.messages)}toChatMessages(){return this.messages}}class nN extends LV{async formatPromptValue(e){const t=await this.format(e);return new rN(t)}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var DV=Object.prototype.toString,Ol=Array.isArray||function(e){return DV.call(e)==="[object Array]"};function ik(n){return typeof n=="function"}function BV(n){return Ol(n)?"array":typeof n}function ak(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function sN(n,e){return n!=null&&typeof n=="object"&&e in n}function UV(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var qV=RegExp.prototype.test;function KV(n,e){return qV.call(n,e)}var HV=/\S/;function WV(n){return!KV(HV,n)}var zV={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function VV(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return zV[t]})}var GV=/\s*/,ZV=/\s+/,iN=/\s*=/,JV=/\s*\}/,XV=/#|\^|\/|>|\{|&|=|!/;function YV(n,e){if(!n)return[];var t=!1,r=[],s=[],i=[],a=!1,o=!1,u="",l=0;function d(){if(a&&!o)for(;i.length;)delete s[i.pop()];else i=[];a=!1,o=!1}var h,f,p;function m(E){if(typeof E=="string"&&(E=E.split(ZV,2)),!Ol(E)||E.length!==2)throw new Error("Invalid tags: "+E);h=new RegExp(ak(E[0])+"\\s*"),f=new RegExp("\\s*"+ak(E[1])),p=new RegExp("\\s*"+ak("}"+E[1]))}m(e||gn.tags);for(var g=new pp(n),y,w,S,_,v,A;!g.eos();){if(y=g.pos,S=g.scanUntil(h),S)for(var k=0,C=S.length;k<C;++k)_=S.charAt(k),WV(_)?(i.push(s.length),u+=_):(o=!0,t=!0,u+=" "),s.push(["text",_,y,y+1]),y+=1,_===`
`&&(d(),u="",l=0,t=!1);if(!g.scan(h))break;if(a=!0,w=g.scan(XV)||"name",g.scan(GV),w==="="?(S=g.scanUntil(iN),g.scan(iN),g.scanUntil(f)):w==="{"?(S=g.scanUntil(p),g.scan(JV),g.scanUntil(f),w="&"):S=g.scanUntil(f),!g.scan(f))throw new Error("Unclosed tag at "+g.pos);if(w==">"?v=[w,S,y,g.pos,u,l,t]:v=[w,S,y,g.pos],l++,s.push(v),w==="#"||w==="^")r.push(v);else if(w==="/"){if(A=r.pop(),!A)throw new Error('Unopened section "'+S+'" at '+y);if(A[1]!==S)throw new Error('Unclosed section "'+A[1]+'" at '+y)}else w==="name"||w==="{"||w==="&"?o=!0:w==="="&&m(S)}if(d(),A=r.pop(),A)throw new Error('Unclosed section "'+A[1]+'" at '+g.pos);return eG(QV(s))}function QV(n){for(var e=[],t,r,s=0,i=n.length;s<i;++s)t=n[s],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function eG(n){for(var e=[],t=e,r=[],s,i,a=0,o=n.length;a<o;++a)switch(s=n[a],s[0]){case"#":case"^":t.push(s),r.push(s),t=s[4]=[];break;case"/":i=r.pop(),i[5]=s[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(s)}return e}function pp(n){this.string=n,this.tail=n,this.pos=0}pp.prototype.eos=function(){return this.tail===""},pp.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r},pp.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function Rl(n,e){this.view=n,this.cache={".":this.view},this.parent=e}Rl.prototype.push=function(e){return new Rl(e,this)},Rl.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var s=this,i,a,o,u=!1;s;){if(e.indexOf(".")>0)for(i=s.view,a=e.split("."),o=0;i!=null&&o<a.length;)o===a.length-1&&(u=sN(i,a[o])||UV(i,a[o])),i=i[a[o++]];else i=s.view[e],u=sN(s.view,e);if(u){r=i;break}s=s.parent}t[e]=r}return ik(r)&&(r=r.call(this.view)),r};function rn(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}rn.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()},rn.prototype.parse=function(e,t){var r=this.templateCache,s=e+":"+(t||gn.tags).join(":"),i=typeof r<"u",a=i?r.get(s):void 0;return a==null&&(a=YV(e,t),i&&r.set(s,a)),a},rn.prototype.render=function(e,t,r,s){var i=this.getConfigTags(s),a=this.parse(e,i),o=t instanceof Rl?t:new Rl(t,void 0);return this.renderTokens(a,o,r,e,s)},rn.prototype.renderTokens=function(e,t,r,s,i){for(var a="",o,u,l,d=0,h=e.length;d<h;++d)l=void 0,o=e[d],u=o[0],u==="#"?l=this.renderSection(o,t,r,s,i):u==="^"?l=this.renderInverted(o,t,r,s,i):u===">"?l=this.renderPartial(o,t,r,i):u==="&"?l=this.unescapedValue(o,t):u==="name"?l=this.escapedValue(o,t,i):u==="text"&&(l=this.rawValue(o)),l!==void 0&&(a+=l);return a},rn.prototype.renderSection=function(e,t,r,s,i){var a=this,o="",u=t.lookup(e[1]);function l(f){return a.render(f,t,r,i)}if(u){if(Ol(u))for(var d=0,h=u.length;d<h;++d)o+=this.renderTokens(e[4],t.push(u[d]),r,s,i);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")o+=this.renderTokens(e[4],t.push(u),r,s,i);else if(ik(u)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,s.slice(e[3],e[5]),l),u!=null&&(o+=u)}else o+=this.renderTokens(e[4],t,r,s,i);return o}},rn.prototype.renderInverted=function(e,t,r,s,i){var a=t.lookup(e[1]);if(!a||Ol(a)&&a.length===0)return this.renderTokens(e[4],t,r,s,i)},rn.prototype.indentPartial=function(e,t,r){for(var s=t.replace(/[^ \t]/g,""),i=e.split(`
`),a=0;a<i.length;a++)i[a].length&&(a>0||!r)&&(i[a]=s+i[a]);return i.join(`
`)},rn.prototype.renderPartial=function(e,t,r,s){if(r){var i=this.getConfigTags(s),a=ik(r)?r(e[1]):r[e[1]];if(a!=null){var o=e[6],u=e[5],l=e[4],d=a;u==0&&l&&(d=this.indentPartial(a,l,o));var h=this.parse(d,i);return this.renderTokens(h,t,r,d,s)}}},rn.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r},rn.prototype.escapedValue=function(e,t,r){var s=this.getConfigEscape(r)||gn.escape,i=t.lookup(e[1]);if(i!=null)return typeof i=="number"&&s===gn.escape?String(i):s(i)},rn.prototype.rawValue=function(e){return e[1]},rn.prototype.getConfigTags=function(e){return Ol(e)?e:e&&typeof e=="object"?e.tags:void 0},rn.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Ol(e))return e.escape};var gn={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){mp.templateCache=n},get templateCache(){return mp.templateCache}},mp=new rn;gn.clearCache=function(){return mp.clearCache()},gn.parse=function(e,t){return mp.parse(e,t)},gn.render=function(e,t,r,s){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+BV(e)+'" was given as the first argument for mustache#render(template, view, partials)');return mp.render(e,t,r,s)},gn.escape=VV,gn.Scanner=pp,gn.Context=Rl,gn.Writer=rn;function aN(){gn.escape=n=>n}const oN=n=>{const e=n.split(""),t=[],r=(i,a)=>{for(let o=a;o<e.length;o+=1)if(i.includes(e[o]))return o;return-1};let s=0;for(;s<e.length;)if(e[s]==="{"&&s+1<e.length&&e[s+1]==="{")t.push({type:"literal",text:"{"}),s+=2;else if(e[s]==="}"&&s+1<e.length&&e[s+1]==="}")t.push({type:"literal",text:"}"}),s+=2;else if(e[s]==="{"){const i=r("}",s);if(i<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(s+1,i).join("")}),s=i+1}else{if(e[s]==="}")throw new Error("Single '}' in template.");{const i=r("{}",s),a=(i<0?e.slice(s):e.slice(s,i)).join("");t.push({type:"literal",text:a}),s=i<0?e.length:i}}return t},tG=n=>n.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),rG=n=>{aN();const e=gn.parse(n);return tG(e)},ok={"f-string":(n,e)=>oN(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e){const s=typeof e[r.name]=="string"?e[r.name]:JSON.stringify(e[r.name]);return t+s}throw new Error(`(f-string) Missing value for input ${r.name}`)}return t+r.text},""),mustache:(n,e)=>(aN(),gn.render(n,e))},nG={"f-string":oN,mustache:rG},Ml=(n,e,t)=>{try{return ok[e](n,t)}catch(r){throw Cx(r,"INVALID_PROMPT_INPUT")}},sG=(n,e)=>nG[e](n),cN=(n,e,t)=>{if(!(e in ok)){const r=Object.keys(ok);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{const r=t.reduce((s,i)=>(s[i]="foo",s),{});Array.isArray(n)?n.forEach(s=>{if(s.type==="text")Ml(s.text,e,r);else if(s.type==="image_url")if(typeof s.image_url=="string")Ml(s.image_url,e,r);else{const i=s.image_url.url;Ml(i,e,r)}else throw new Error(`Invalid message template received. ${JSON.stringify(s,null,2)}`)}):Ml(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};class Xa extends nN{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),cN(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return Ml(this.template,this.templateFormat,t)}static fromExamples(e,t,r,s=`

`,i=""){const a=[i,...e,t].join(s);return new Xa({inputVariables:r,template:a})}static fromTemplate(e,t){const{templateFormat:r="f-string",...s}=t??{},i=new Set;return sG(e,r).forEach(a=>{a.type==="variable"&&i.add(a.name)}),new Xa({inputVariables:[...i],templateFormat:r,template:e,...s})}async partial(e){const t=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new Xa(s)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new Xa({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const uN=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:Xa},Symbol.toStringTag,{value:"Module"}));class C_ extends nN{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),cN(this.prefix+this.suffix,this.templateFormat,t)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t=this.inputVariables.filter(i=>!(i in e)),r={...this.partialVariables??{},...e},s={...this,inputVariables:t,partialVariables:r};return new C_(s)}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),s=await Promise.all(r.map(a=>this.examplePrompt.format(a))),i=[this.prefix,...s,this.suffix].join(this.exampleSeparator);return Ml(i,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const r=await Xa.deserialize(t);let s;if(Array.isArray(e.examples))s=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new C_({inputVariables:e.input_variables,examplePrompt:r,examples:s,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}const iG=Object.freeze(Object.defineProperty({__proto__:null,FewShotPromptTemplate:C_},Symbol.toStringTag,{value:"Module"})),yn=ws("Action");class aG extends Error{constructor(e){super(e),this.name="InvalidInputError"}}class qr{constructor(e,t,r=!1){this.handler=e,this.schema=t,this.hasIndex=r}async call(e){const t=this.schema.schema;if(t instanceof pe.ZodObject&&Object.keys(t.shape||{}).length===0)return await this.handler({});const s=this.schema.schema.safeParse(e);if(!s.success){const i=s.error.message;throw new aG(i)}return await this.handler(s.data)}name(){return this.schema.name}prompt(){const e=this.schema.schema.shape||{},t=Object.entries(e).map(([s,i])=>{const a=i;return`'${s}': {'type': '${a.description}', ${a.isOptional()?"'optional': true":"'required': true"}}`}),r=t.length>0?`{${this.name()}: {${t.join(", ")}}}`:`{${this.name()}: {}}`;return`${this.schema.description}:
${r}`}getIndexArg(e){return this.hasIndex&&e&&typeof e=="object"&&"index"in e?e.index:null}}function oG(n){let e=pe.object({});for(const t of n){const r=t.schema.schema.nullable().describe(t.schema.description);e=e.extend({[t.name()]:r})}return e.partial()}class cG{constructor(e,t){this.context=e,this.extractorLLM=t}buildDefaultActions(){const e=[],t=new qr(async S=>(this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_START,QM.name),this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,S.text),new wt({isDone:!0,extractedContent:S.text})),QM);e.push(t);const r=new qr(async S=>{const _=this.context,v=`Searching for "${S.query}" in Google`;_.emitEvent(Ae.NAVIGATOR,ke.ACT_START,v),await _.browserContext.navigateTo(`https://www.google.com/search?q=${S.query}`);const A=`Searched for "${S.query}" in Google`;return _.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,A),new wt({extractedContent:A,includeInMemory:!0})},xV);e.push(r);const s=new qr(async S=>{const _=`Navigating to ${S.url}`;this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_START,_),await this.context.browserContext.navigateTo(S.url);const v=`Navigated to ${S.url}`;return this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,v),new wt({extractedContent:v,includeInMemory:!0})},EV);e.push(s);const i=new qr(async(S={})=>{this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_START,"Navigating back"),await(await this.context.browserContext.getCurrentPage()).goBack();const A="Navigated back";return this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,A),new wt({extractedContent:A,includeInMemory:!0})},kV);e.push(i);const a=new qr(async S=>{const _=S.desc||`Click element with index ${S.index}`;this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_START,_);const v=await this.context.browserContext.getCurrentPage(),A=await v.getState(),k=A==null?void 0:A.selectorMap.get(S.index);if(!k)throw new Error(`Element with index ${S.index} does not exist - retry or use alternative actions`);if(await v.isFileUploader(k)){const C=`Index ${S.index} - has an element which opens file upload dialog. To upload files please use a specific function to upload files`;return yn.info(C),new wt({extractedContent:C,includeInMemory:!0})}try{const C=await this.context.browserContext.getAllTabIds();await v.clickElementNode(this.context.options.useVision,k);let E=`Clicked button with index ${S.index}: ${k.getAllTextTillNextClickableElement(2)}`;yn.info(E);const N=await this.context.browserContext.getAllTabIds();if(N.size>C.size){const I="New tab opened - switching to it";E+=` - ${I}`,yn.info(I);const $=Array.from(N).find(O=>!C.has(O));$&&await this.context.browserContext.switchTab($)}return this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,E),new wt({extractedContent:E,includeInMemory:!0})}catch(C){const E=`Element no longer available with index ${S.index} - most likely the page changed`;return this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_FAIL,E),new wt({error:C instanceof Error?C.message:String(C)})}},CV,!0);e.push(a);const o=new qr(async S=>{const _=S.desc||`Input text into index ${S.index}`;this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_START,_);const v=await this.context.browserContext.getCurrentPage(),A=await v.getState(),k=A==null?void 0:A.selectorMap.get(S.index);if(!k)throw new Error(`Element with index ${S.index} does not exist - retry or use alternative actions`);await v.inputTextElementNode(this.context.options.useVision,k,S.text);const C=`Input ${S.text} into index ${S.index}`;return this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,C),new wt({extractedContent:C,includeInMemory:!0})},PV,!0);e.push(o);const u=new qr(async S=>{this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_START,`Switching to tab ${S.tab_id}`),await this.context.browserContext.switchTab(S.tab_id);const _=`Switched to tab ${S.tab_id}`;return this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,_),new wt({extractedContent:_,includeInMemory:!0})},AV);e.push(u);const l=new qr(async S=>{this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_START,`Opening ${S.url} in new tab`),await this.context.browserContext.openTab(S.url);const _=`Opened ${S.url} in new tab`;return this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,_),new wt({extractedContent:_,includeInMemory:!0})},TV);e.push(l);const d=new qr(async S=>{const _=S.goal,A=await(await this.context.browserContext.getCurrentPage()).getReadabilityContent(),C=await Xa.fromTemplate("Your task is to extract the content of the page. You will be given a page and a goal and you should extract all relevant information around this goal from the page. If the goal is vague, summarize the page. Respond in json format. Extraction goal: {goal}, Page: {page}").invoke({goal:_,page:A.content});try{const N=`  Extracted from page
: ${(await this.extractorLLM.invoke(C)).content}
`;return new wt({extractedContent:N,includeInMemory:!0})}catch(E){yn.error(`Error extracting content: ${E instanceof Error?E.message:String(E)}`);const N="Failed to extract content from page, you need to extract content from the current state of the page and store it in the memory. Then scroll down if you still need more information.";return new wt({extractedContent:N,includeInMemory:!0})}},IV);e.push(d);const h=new qr(async S=>{this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_START,eN.name);const _=`Cached findings: ${S.content}`;return this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,_),new wt({extractedContent:_,includeInMemory:!0})},eN);e.push(h);const f=new qr(async S=>{const _=S.desc||"Scroll down the page";this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_START,_),await(await this.context.browserContext.getCurrentPage()).scrollDown(S.amount);const k=`Scrolled down the page by ${S.amount!==void 0?`${S.amount} pixels`:"one page"}`;return this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,k),new wt({extractedContent:k,includeInMemory:!0})},OV);e.push(f);const p=new qr(async S=>{const _=S.desc||"Scroll up the page";this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_START,_),await(await this.context.browserContext.getCurrentPage()).scrollUp(S.amount);const k=`Scrolled up the page by ${S.amount!==void 0?`${S.amount} pixels`:"one page"}`;return this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,k),new wt({extractedContent:k,includeInMemory:!0})},RV);e.push(p);const m=new qr(async S=>{const _=S.desc||`Send keys: ${S.keys}`;this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_START,_),await(await this.context.browserContext.getCurrentPage()).sendKeys(S.keys);const A=`Sent keys: ${S.keys}`;return this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,A),new wt({extractedContent:A,includeInMemory:!0})},MV);e.push(m);const g=new qr(async S=>{const _=S.desc||`Scroll to text: ${S.text}`;this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_START,_);const v=await this.context.browserContext.getCurrentPage();try{const k=await v.scrollToText(S.text)?`Scrolled to text: ${S.text}`:`Text '${S.text}' not found or not visible on page`;return this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,k),new wt({extractedContent:k,includeInMemory:!0})}catch(A){const k=`Failed to scroll to text: ${A instanceof Error?A.message:String(A)}`;return this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_FAIL,k),new wt({error:k,includeInMemory:!0})}},NV);e.push(g);const y=new qr(async S=>{const _=`Getting options from dropdown with index ${S.index}`;this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_START,_);const v=await this.context.browserContext.getCurrentPage(),A=await v.getState();if(!(A==null?void 0:A.selectorMap.get(S.index))){const C=`Element with index ${S.index} does not exist - retry or use alternative actions`;return yn.error(C),this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_FAIL,C),new wt({error:C,includeInMemory:!0})}try{const C=await v.getDropdownOptions(S.index);if(C&&C.length>0){let I=C.map($=>{const O=JSON.stringify($.text);return`${$.index}: text=${O}`}).join(`
`);return I+=`
Use the exact text string in select_dropdown_option`,yn.info(I),this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,`Got ${C.length} options from dropdown`),new wt({extractedContent:I,includeInMemory:!0})}const E="No options found in dropdown";return yn.info(E),this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,E),new wt({extractedContent:E,includeInMemory:!0})}catch(C){const E=`Failed to get dropdown options: ${C instanceof Error?C.message:String(C)}`;return yn.error(E),this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_FAIL,E),new wt({error:E,includeInMemory:!0})}},$V,!0);e.push(y);const w=new qr(async S=>{const _=`Select option "${S.text}" from dropdown with index ${S.index}`;this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_START,_);const v=await this.context.browserContext.getCurrentPage(),A=await v.getState(),k=A==null?void 0:A.selectorMap.get(S.index);if(!k){const C=`Element with index ${S.index} does not exist - retry or use alternative actions`;return this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_FAIL,C),new wt({error:C,includeInMemory:!0})}if(!k.tagName||k.tagName.toLowerCase()!=="select"){const C=`Cannot select option: Element with index ${S.index} is a ${k.tagName||"unknown"}, not a SELECT`;return yn.error(C),this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_FAIL,C),new wt({error:C,includeInMemory:!0})}yn.debug(`Attempting to select '${S.text}' using xpath: ${k.xpath}`),yn.debug(`Element attributes: ${JSON.stringify(k.attributes)}`),yn.debug(`Element tag: ${k.tagName}`);try{const C=await v.selectDropdownOption(S.index,S.text),E=`Selected option "${S.text}" from dropdown with index ${S.index}`;return yn.info(E),this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_OK,E),new wt({extractedContent:C,includeInMemory:!0})}catch(C){const E=`Failed to select option: ${C instanceof Error?C.message:String(C)}`;return yn.error(E),this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_FAIL,E),new wt({error:E,includeInMemory:!0})}},jV,!0);return e.push(w),e}}class Nl extends Error{constructor(e,t){super(e),this.cause=t,this.name="ChatModelAuthError",Error.captureStackTrace&&Error.captureStackTrace(this,Nl)}toString(){return`${this.name}: ${this.message}${this.cause?` (Caused by: ${this.cause})`:""}`}}class $l extends Error{constructor(e,t){super(e),this.cause=t,this.name="ChatModelForbiddenError",Error.captureStackTrace&&Error.captureStackTrace(this,$l)}toString(){return`${this.name}: ${this.message}${this.cause?` (Caused by: ${this.cause})`:""}`}}const ck=`Access denied (403 Forbidden). Please check:

1. Your API key has the required permissions

2. For Ollama: Set OLLAMA_ORIGINS=chrome-extension://* 
see https://github.com/ollama/ollama/blob/main/docs/faq.md`;function uk(n){var s;if(!(n instanceof Error))return!1;const e=n.message||"";let t=n.name||"";const r=(s=n.constructor)==null?void 0:s.name;return r&&r!=="Error"&&(t=r),t==="AuthenticationError"?!0:e.toLowerCase().includes("authentication")||e.includes(" 401")||e.toLowerCase().includes("api key")}function lk(n){return n instanceof Error?n.message.includes(" 403")&&n.message.includes("Forbidden"):!1}const uG={properties:{current_state:{description:"Current state of the agent",properties:{page_summary:{title:"Page Summary",type:"string"},evaluation_previous_goal:{title:"Evaluation Previous Goal",type:"string"},memory:{title:"Memory",type:"string"},next_goal:{title:"Next Goal",type:"string"}},required:["page_summary","evaluation_previous_goal","memory","next_goal"],title:"AgentBrain",type:"object"},action:{items:{properties:{done:{properties:{text:{title:"Text",type:"string"}},required:["text"],title:"DoneAction",type:"object",nullable:!0},search_google:{properties:{query:{title:"Query",type:"string"}},required:["query"],title:"SearchGoogleAction",type:"object",nullable:!0},go_to_url:{properties:{url:{title:"Url",type:"string"}},required:["url"],title:"GoToUrlAction",type:"object",nullable:!0},go_back:{additionalProperties:!0,description:`Accepts absolutely anything in the incoming data
and discards it, so the final parsed model is empty.`,properties:{},title:"NoParamsAction",type:"object",nullable:!0},click_element:{properties:{desc:{title:"Intent",type:"string",description:"Very short explanation of the intent or purpose for calling this action"},index:{title:"Index",type:"integer"},xpath:{title:"XPath",type:"string",nullable:!0}},required:["desc","index"],title:"ClickElementAction",type:"object",nullable:!0},input_text:{properties:{desc:{title:"Intent",type:"string",description:"Very short explanation of the intent or purpose for calling this action"},index:{title:"Index",type:"integer"},text:{title:"Text",type:"string"},xpath:{title:"XPath",type:"string",nullable:!0}},required:["desc","index","text"],title:"InputTextAction",type:"object",nullable:!0},switch_tab:{properties:{tab_id:{title:"Page Id",type:"integer"}},required:["tab_id"],title:"SwitchTabAction",type:"object",nullable:!0},open_tab:{properties:{url:{title:"Url",type:"string"}},required:["url"],title:"OpenTabAction",type:"object",nullable:!0},cache_content:{properties:{content:{title:"Content",type:"string"}},required:["content"],title:"cache_content_parameters",type:"object",nullable:!0},scroll_down:{properties:{desc:{title:"Intent",type:"string",description:"Very short explanation of the intent or purpose for calling this action"},amount:{title:"Amount",type:"integer",nullable:!0}},required:["desc"],title:"ScrollAction",type:"object",nullable:!0},scroll_up:{properties:{desc:{title:"Intent",type:"string",description:"Very short explanation of the intent or purpose for calling this action"},amount:{title:"Amount",type:"integer",nullable:!0}},required:["desc"],title:"ScrollAction",type:"object",nullable:!0},send_keys:{properties:{desc:{title:"Intent",type:"string",description:"Very short explanation of the intent or purpose for calling this action"},keys:{title:"Keys",type:"string"}},required:["desc","keys"],title:"SendKeysAction",type:"object",nullable:!0},scroll_to_text:{properties:{desc:{title:"Intent",type:"string",description:"Very short explanation of the intent or purpose for calling this action"},text:{title:"Text",type:"string"}},required:["desc","text"],title:"scroll_to_text_parameters",type:"object",nullable:!0},get_dropdown_options:{properties:{index:{title:"Index",type:"integer"}},required:["index"],title:"get_dropdown_options_parameters",type:"object",nullable:!0},select_dropdown_option:{properties:{index:{title:"Index",type:"integer"},text:{title:"Text",type:"string"}},required:["index","text"],title:"select_dropdown_option_parameters",type:"object",nullable:!0}},title:"ActionModel",type:"object"},title:"Action",type:"array"}},required:["current_state","action"],title:"AgentOutput",type:"object"},lG={type:"object",properties:{current_state:{type:"object",description:"Current state of the agent",properties:{page_summary:{type:"string"},evaluation_previous_goal:{type:"string"},memory:{type:"string"},next_goal:{type:"string"}},required:["page_summary","evaluation_previous_goal","memory","next_goal"]},action:{type:"array",items:{type:"object",properties:{done:{type:"object",properties:{text:{type:"string"}},required:["text"],nullable:!0},search_google:{type:"object",properties:{query:{type:"string"}},required:["query"],nullable:!0},go_to_url:{type:"object",properties:{url:{type:"string"}},required:["url"],nullable:!0},go_back:{type:"string",nullable:!0,description:`Accepts absolutely anything in the incoming data
and discards it, so the final parsed model is empty.`},click_element:{type:"object",properties:{desc:{type:"string",description:"Very short explanation of the intent or purpose for calling this action"},index:{type:"integer"},xpath:{type:"string",nullable:!0}},required:["desc","index"],nullable:!0},input_text:{type:"object",properties:{desc:{type:"string",description:"Very short explanation of the intent or purpose for calling this action"},index:{type:"integer"},text:{type:"string"},xpath:{type:"string",nullable:!0}},required:["desc","index","text"],nullable:!0},switch_tab:{type:"object",properties:{tab_id:{type:"integer"}},required:["tab_id"],nullable:!0},open_tab:{type:"object",properties:{url:{type:"string"}},required:["url"],nullable:!0},cache_content:{type:"object",properties:{content:{type:"string"}},required:["content"],nullable:!0},scroll_down:{type:"object",properties:{desc:{type:"string",description:"Very short explanation of the intent or purpose for calling this action"},amount:{type:"integer",nullable:!0}},required:["desc"],nullable:!0},scroll_up:{type:"object",properties:{desc:{type:"string",description:"Very short explanation of the intent or purpose for calling this action"},amount:{type:"integer",nullable:!0}},required:["desc"],nullable:!0},send_keys:{type:"object",properties:{desc:{type:"string",description:"Very short explanation of the intent or purpose for calling this action"},keys:{type:"string"}},required:["desc","keys"],nullable:!0},scroll_to_text:{type:"object",properties:{desc:{type:"string",description:"Very short explanation of the intent or purpose for calling this action"},text:{type:"string"}},required:["desc","text"],nullable:!0},get_dropdown_options:{type:"object",properties:{index:{type:"integer"}},required:["index"],nullable:!0},select_dropdown_option:{type:"object",properties:{index:{type:"integer"},text:{type:"string"}},required:["index","text"],nullable:!0}},required:[]}}},required:["current_state","action"]},Ji=ws("NavigatorAgent");class dG{constructor(e){this.actions={};for(const t of e)this.registerAction(t)}registerAction(e){this.actions[e.name()]=e}unregisterAction(e){delete this.actions[e]}getAction(e){return this.actions[e]}setupModelOutputSchema(){const e=oG(Object.values(this.actions));return pe.object({current_state:G9,action:pe.array(e)})}}class hG extends sk{constructor(e,t,r){super(e.setupModelOutputSchema(),t,{...r,id:"navigator"}),this.actionRegistry=e,this.jsonSchema=this.modelName.startsWith("gemini")?lG:uG}async invoke(e){if(this.withStructuredOutput){const t=this.chatLLM.withStructuredOutput(this.jsonSchema,{includeRaw:!0,name:this.modelOutputToolName});let r;try{if(r=await t.invoke(e,{...this.callOptions}),r.parsed)return r.parsed}catch(i){const a=`Failed to invoke ${this.modelName} with structured output: ${i}`;throw new Error(a)}const s=r.raw;if(s.tool_calls&&s.tool_calls.length>0){Ji.info("Navigator structuredLlm tool call with empty content",s.tool_calls);const i=s.tool_calls[0];return{current_state:i.args.currentState,action:[...i.args.action]}}throw new Error("Could not parse response")}throw new Error("Navigator needs to work with LLM that supports tool calling")}async execute(){const e={id:this.id};let t=!1;try{this.context.emitEvent(Ae.NAVIGATOR,ke.STEP_START,"Navigating...");const r=this.context.messageManager;if(await this.addStateMessageToMemory(),this.context.paused||this.context.stopped)return t=!0,e;const s=r.getMessages(),i=await this.invoke(s);if(this.context.paused||this.context.stopped)return t=!0,e;this.removeLastStateMessageFromMemory(),this.addModelOutputToMemory(i);const a=await this.doMultiAction(i);if(this.context.actionResults=a,this.context.paused||this.context.stopped)return t=!0,e;this.context.emitEvent(Ae.NAVIGATOR,ke.STEP_OK,"Navigation done");let o=!1;return a.length>0&&a[a.length-1].isDone&&(o=!0),e.result={done:o},e}catch(r){if(this.removeLastStateMessageFromMemory(),uk(r))throw new Nl("Navigator API Authentication failed. Please verify your API key",r);if(lk(r))throw new $l(ck,r);const s=r instanceof Error?r.message:String(r),i=`Navigation failed: ${s}`;return Ji.error(i),this.context.emitEvent(Ae.NAVIGATOR,ke.STEP_FAIL,i),e.error=s,e}finally{t&&(this.removeLastStateMessageFromMemory(),this.context.emitEvent(Ae.NAVIGATOR,ke.STEP_CANCEL,"Navigation cancelled"))}}async addStateMessageToMemory(){if(this.context.stateMessageAdded)return;const e=this.context.messageManager,t=this.context.options;if(this.context.actionResults.length>0){let s=0;for(const i of this.context.actionResults){if(i.includeInMemory){if(i.extractedContent){const a=new Bt(`Action result: ${i.extractedContent}`);e.addMessageWithTokens(a)}if(i.error){const a=new Bt(`Action error: ${i.error.toString().slice(-t.maxErrorLength)}`);Ji.info("Adding action error to memory",a.content),e.addMessageWithTokens(a)}this.context.actionResults[s]=new wt}s++}}const r=await this.prompt.getUserMessage(this.context);e.addStateMessage(r),this.context.stateMessageAdded=!0}async removeLastStateMessageFromMemory(){if(!this.context.stateMessageAdded)return;this.context.messageManager.removeLastStateMessage(),this.context.stateMessageAdded=!1}async doMultiAction(e){const t=[];let r=0;Ji.info("Actions",e.action);let s=[];if(Array.isArray(e.action))s=e.action.filter(u=>u!==null),s.length===0&&Ji.warning("No valid actions found",e.action);else if(typeof e.action=="string")try{Ji.warning("Unexpected action format",e.action),s=JSON.parse(e.action)}catch{throw Ji.error("Invalid action format",e.action),new Error("Invalid action output format")}else s=[e.action];const i=this.context.browserContext,a=await i.getState(),o=await OO(a);await i.removeHighlight();for(const[u,l]of s.entries()){const d=Object.keys(l)[0],h=l[d];try{if(this.context.paused||this.context.stopped)return t;const f=this.actionRegistry.getAction(d);if(f===void 0)throw new Error(`Action ${d} not exists`);const p=f.getIndexArg(h);if(u>0&&p!==null){const g=await i.getState();if(!(await OO(g)).isSubsetOf(o)){const w=`Something new appeared after action ${u} / ${s.length}`;Ji.info(w),t.push(new wt({extractedContent:w,includeInMemory:!0}));break}}const m=await f.call(h);if(m===void 0)throw new Error(`Action ${d} returned undefined`);if(t.push(m),this.context.paused||this.context.stopped)return t;await new Promise(g=>setTimeout(g,1e3))}catch(f){const p=f instanceof Error?f.message:String(f);if(Ji.error("doAction error",d,h,p),this.context.emitEvent(Ae.NAVIGATOR,ke.ACT_FAIL,p),r++,r>3)throw new Error("Too many errors in actions");t.push(new wt({error:p,isDone:!1,includeInMemory:!0}))}}return t}}const fG=pe.object({observation:pe.string(),challenges:pe.string(),done:pe.union([pe.boolean(),pe.string().transform(n=>{if(n.toLowerCase()==="true")return!0;if(n.toLowerCase()==="false")return!1;throw new Error("Invalid boolean string")})]),next_steps:pe.string(),reasoning:pe.string(),web_task:pe.union([pe.boolean(),pe.string().transform(n=>{if(n.toLowerCase()==="true")return!0;if(n.toLowerCase()==="false")return!1;throw new Error("Invalid boolean string")})])});class pG extends sk{constructor(e,t){super(fG,e,{...t,id:"planner"})}async execute(){try{this.context.emitEvent(Ae.PLANNER,ke.STEP_START,"Planning...");const e=this.context.messageManager.getMessages(),t=[this.prompt.getSystemMessage(),...e.slice(1)];if(!this.context.options.useVisionForPlanner&&this.context.options.useVision){const s=t[t.length-1];let i="";if(Array.isArray(s.content))for(const a of s.content)a.type==="text"&&(i+=a.text);else i=s.content;t[t.length-1]=new Bt(i)}const r=await this.invoke(t);if(!r)throw new Error("Failed to validate planner output");return this.context.emitEvent(Ae.PLANNER,ke.STEP_OK,r.next_steps),{id:this.id,result:r}}catch(e){if(uk(e))throw new Nl("Planner API Authentication failed. Please verify your API key",e);if(lk(e))throw new $l(ck,e);const t=e instanceof Error?e.message:String(e);return this.context.emitEvent(Ae.PLANNER,ke.STEP_FAIL,`Planning failed: ${t}`),{id:this.id,error:t}}}}const lN=ws("ValidatorAgent"),mG=pe.object({is_valid:pe.union([pe.boolean(),pe.string().transform(n=>{if(n.toLowerCase()==="true")return!0;if(n.toLowerCase()==="false")return!1;throw new Error("Invalid boolean string")})]),reason:pe.string(),answer:pe.string()});class gG extends sk{constructor(e,t){super(mG,e,{...t,id:"validator"}),this.plan=null}setPlan(e){this.plan=e}async execute(){try{this.context.emitEvent(Ae.VALIDATOR,ke.STEP_START,"Validating...");let e=await this.prompt.getUserMessage(this.context);this.plan&&(e=new Bt(`${e.content}

The current plan is: 
${this.plan}`));const r=[this.prompt.getSystemMessage(),e],s=await this.invoke(r);if(!s)throw new Error("Failed to validate task result");if(lN.info("validator output",JSON.stringify(s,null,2)),s.is_valid)this.context.emitEvent(Ae.VALIDATOR,ke.STEP_OK,s.answer);else{const i=`The answer is not yet correct. ${s.reason}.`;this.context.emitEvent(Ae.VALIDATOR,ke.STEP_FAIL,i),this.context.actionResults=[new wt({extractedContent:i,includeInMemory:!0})]}return{id:this.id,result:s}}catch(e){if(uk(e))throw new Nl("Validator API Authentication failed. Please verify your API key",e);if(lk(e))throw new $l(ck,e);const t=e instanceof Error?e.message:String(e);return lN.error(`Validation failed: ${t}`),this.context.emitEvent(Ae.VALIDATOR,ke.STEP_FAIL,`Validation failed: ${t}`),{id:this.id,error:`Validation failed: ${t}`}}}}class dk{async buildBrowserStateUserMessage(e){const t=await e.browserContext.getState(),r=t.elementTree.clickableElementsToString(e.options.includeAttributes),s=(t.pixelsAbove||0)>0,i=(t.pixelsBelow||0)>0;let a="";r!==""?(s?a=`... ${t.pixelsAbove} pixels above - scroll up to see more ...
${r}`:a=`[Start of page]
${r}`,i?a=`${a}
... ${t.pixelsBelow} pixels below - scroll down to see more ...`:a=`${a}
[End of page]`):a="empty page";let o="";e.stepInfo&&(o=`Current step: ${e.stepInfo.stepNumber+1}/${e.stepInfo.maxSteps}`);const u=new Date().toISOString().slice(0,16).replace("T"," ");o+=`Current date and time: ${u}`;let l="";if(e.actionResults.length>0)for(let h=0;h<e.actionResults.length;h++){const f=e.actionResults[h];if(f.extractedContent&&(l+=`
Action result ${h+1}/${e.actionResults.length}: ${f.extractedContent}`),f.error){const p=f.error.slice(-300);l+=`
Action error ${h+1}/${e.actionResults.length}: ...${p}`}}const d=`
    [Task history memory ends here]
    [Current state starts here]
    You will see the following only once - if you need to remember it and you dont know it yet, write it down in the memory:
    Current tab: {id: ${t.tabId}, url: ${t.url}, title: ${t.title}}
    Other available tabs:
    ${t.tabs.filter(h=>h.id!==t.tabId).map(h=>` - {id: ${h.id}, url: ${h.url}, title: ${h.title}}`).join(`
`)}
    Interactive elements from current page:
    ${a}
    ${o}
    ${l}`;return t.screenshot&&e.options.useVision?new Bt({content:[{type:"text",text:d},{type:"image_url",image_url:{url:`data:image/jpeg;base64,${t.screenshot}`}}]}):new Bt(d)}}class yG extends dk{constructor(e=10){super(),this.maxActionsPerStep=e,this.default_action_description="A placeholder action description"}importantRules(){return`
1. RESPONSE FORMAT: You must ALWAYS respond with valid JSON in this exact format:
   {
     "current_state": {
		"page_summary": "Quick detailed summary of new information from the current page which is not yet in the task history memory. Be specific with details which are important for the task. This is not on the meta level, but should be facts. If all the information is already in the task history memory, leave this empty.",
		"evaluation_previous_goal": "Success|Failed|Unknown - Analyze the current elements and the image to check if the previous goals/actions are successful like intended by the task. Ignore the action result. The website is the ground truth. Also mention if something unexpected happened like new suggestions in an input field. Shortly state why/why not",
       "memory": "Description of what has been done and what you need to remember. Be very specific. Count here ALWAYS how many times you have done something and how many remain. E.g. 0 out of 10 websites analyzed. Continue with abc and xyz",
       "next_goal": "What needs to be done with the next actions"
     },
     "action": [
       {
         "one_action_name": {
           // action-specific parameter
         }
       },
       // ... more actions in sequence
     ]
   }

2. ACTIONS: You can specify multiple actions in the list to be executed in sequence. But always specify only one action name per item.

   Common action sequences:
   - Form filling: [
       {"input_text": {"desc": "Fill title", "index": 1, "text": "example title"}},
       {"input_text": {"desc": "Fill comment", "index": 2, "text": "example comment"}},
       {"click_element": {"desc": "Click submit button", "index": 3}}
     ]
   - Navigation: [
       {"open_tab": {"url": "https://example.com"}},
       {"go_to_url": {"url": "https://example.com"}},
     ]


3. ELEMENT INTERACTION:
   - Only use indexes that exist in the provided element list
   - Each element has a unique index number (e.g., "[33]<button>")
   - Elements marked with "[]Non-interactive text" are non-interactive (for context only)

4. NAVIGATION & ERROR HANDLING:
   - If you need to search in Google, use the search_google action. Don't need to input the search query manually, just use the action.
   - If no suitable elements exist, use other functions to complete the task
   - If stuck, try alternative approaches - like going back to a previous page, new search, new tab etc.
   - Handle popups/cookies by accepting or closing them
   - Use scroll to find elements you are looking for
   - If you want to research something, open a new tab instead of using the current tab
   - If captcha pops up, and you cant solve it, either ask for human help or try to continue the task on a different page.

5. TASK COMPLETION:
   - Use the done action as the last action as soon as the ultimate task is complete
   - Dont use "done" before you are done with everything the user asked you. 
   - If you have to do something repeatedly for example the task says for "each", or "for all", or "x times", count always inside "memory" how many times you have done it and how many remain. Don't stop until you have completed like the task asked you. Only call done after the last step.
   - Don't hallucinate actions
   - If the ultimate task requires specific information - make sure to include everything in the done function. This is what the user will see. Do not just say you are done, but include the requested information of the task.
   - Include exact relevant urls if available, but do NOT make up any urls

6. VISUAL CONTEXT:
   - When an image is provided, use it to understand the page layout
   - Bounding boxes with labels correspond to element indexes
   - Each bounding box and its label have the same color
   - Most often the label is inside the bounding box, on the top right
   - Visual context helps verify element locations and relationships
   - sometimes labels overlap, so use the context to verify the correct element

7. Form filling:
   - If you fill an input field and your action sequence is interrupted, most often a list with suggestions popped up under the field and you need to first select the right element from the suggestion list.

8. ACTION SEQUENCING:
   - Actions are executed in the order they appear in the list
   - Each action should logically follow from the previous one
   - If the page changes after an action, the sequence is interrupted and you get the new state.
   - If content only disappears the sequence continues.
   - Only provide the action sequence until you think the page will change.
   - Try to be efficient, e.g. fill forms at once, or chain actions where nothing changes on the page like saving, extracting, checkboxes...
   - only use multiple actions if it makes sense.

9. Long tasks:
- If the task is long keep track of the status in the memory. If the ultimate task requires multiple subinformation, keep track of the status in the memory.
- If you get stuck, 

10. Extraction:
- When searching for information or conducting research:
  1. First analyze and extract relevant content from the current visible state
  2. If the needed information is incomplete:
     - Use cache_content action to cache the current findings
     - Scroll down EXACTLY ONE PAGE at a time using scroll_page action
     - NEVER scroll more than one page at once as this will cause loss of information
     - Repeat the analyze-cache-scroll cycle until either:
       * All required information is found, or
       * Maximum 5 page scrolls have been performed
  3. Before completing the task:
     - Combine all cached content with the current state
     - Verify all required information is collected
     - Present the complete findings in the done action
- Important extraction guidelines:
  - Be thorough and specific when extracting information
  - Always cache findings before scrolling to avoid losing information
  - Always verify source information before caching
  - Scroll down EXACTLY ONE PAGE at a time
  - Stop after maximum 5 page scrolls
   - use maximum ${this.maxActionsPerStep} actions per sequence`}inputFormat(){return`
INPUT STRUCTURE:
1. Current URL: The webpage you're currently on
2. Available Tabs: List of open browser tabs
3. Interactive Elements: List in the format:
   index[:]<element_type>element_text</element_type>
   - index: Numeric identifier for interaction
   - element_type: HTML element type (button, input, etc.)
   - element_text: Visible text or element description

Example:
[33]<button>Submit Form</button>
[] Non-interactive text


Notes:
- Only elements with numeric indexes inside [] are interactive
- [] elements provide context but cannot be interacted with
`}getSystemMessage(){const e=`You are a precise browser automation agent that interacts with websites through structured commands. Your role is to:
1. Analyze the provided webpage elements and structure
2. Use the given information to accomplish the ultimate task
3. Respond with valid JSON containing your next action sequence and state assessment
4. If the webpage is asking for login credentials, never try to fill it by yourself. Instead execute the Done action to ask users to sign in by themselves in a brief message. Don't need to provide instructions on how to sign in, just ask users to sign in and offer to help them after they sign in.

${this.inputFormat()}

${this.importantRules()}

Functions:
${this.default_action_description}

Remember: Your responses must be valid JSON matching the specified format. Each action in the sequence must be valid.`;return new Sl(e)}async getUserMessage(e){return await this.buildBrowserStateUserMessage(e)}}class wG extends dk{getSystemMessage(){return new Sl(`You are a helpful assistant.

RESPONSIBILITIES:
1. Judge whether the ultimate task is related to web browsing or not and set the "web_task" field.
2. If web_task is false, then just answer the task directly as a helpful assistant
  - Output the answer into "next_steps" field in the JSON object. 
  - Set "done" field to true
  - Set these fields in the JSON object to empty string: "observation", "challenges", "reasoning"
  - Be kind and helpful when answering the task
  - Do NOT offer anything that users don't explicitly ask for.
  - Do NOT make up anything, if you don't know the answer, just say "I don't know"

3. If web_task is true, then helps break down tasks into smaller steps and reason about the current state
  - Analyze the current state and history
  - Evaluate progress towards the ultimate goal
  - Identify potential challenges or roadblocks
  - Suggest the next high-level steps to take
  - If you know the direct URL, use it directly instead of searching for it (e.g. github.com, www.espn.com). Search it if you don't know the direct URL.
  - Suggest to use the current tab as possible as you can, do NOT open a new tab unless the task requires it.
  - IMPORTANT: 
    - Always prioritize working with content visible in the current viewport first:
    - Focus on elements that are immediately visible without scrolling
    - Only suggest scrolling if the required content is confirmed to not be in the current view
    - Scrolling is your LAST resort unless you are explicitly required to do so by the task
    - NEVER suggest scrolling through the entire page, only scroll ONE PAGE at a time.
4. Once web_task is set to either true or false, its value The value must never change from its first set state in the conversation.

RESPONSE FORMAT: Your must always respond with a valid JSON object with the following fields:
{
    "observation": "[string type], brief analysis of the current state and what has been done so far",
    "done": "[boolean type], whether further steps are needed to complete the ultimate task",
    "challenges": "[string type], list any potential challenges or roadblocks",
    "next_steps": "[string type], list 2-3 high-level next steps to take, each step should start with a new line",
    "reasoning": "[string type], explain your reasoning for the suggested next steps",
    "web_task": "[boolean type], whether the ultimate task is related to browsing the web"
}

NOTE:
  - Inside the messages you receive, there will be other AI messages from other agents with different formats.
  - Ignore the output structures of other AI messages.

REMEMBER:
  - Keep your responses concise and focused on actionable insights.`)}async getUserMessage(e){return new Bt("")}}class bG extends dk{constructor(e){super(),this.tasks=[],this.tasks.push(e)}tasksToValidate(){if(this.tasks.length===1)return this.tasks[0];const e=this.tasks[this.tasks.length-1],t=this.tasks.slice(0,-1).map((s,i)=>`${i+1}. ${s}`).join(`
`);return`
${e}

The above task is a follow up task of the following tasks, please take the previous context into account when validating the task.

Previous tasks:
${t}
`}getSystemMessage(){return new Sl(`You are a validator of an agent who interacts with a browser.
YOUR ROLE:
1. Validate if the agent's last action matches the user's request and if the task is completed.
2. Determine if the task is fully completed
3. Answer the task based on the provided context if the task is completed

RULES of ANSWERING THE TASK:
  - Read the task description carefully, neither miss any detailed requirements nor make up any requirements
  - Compile the final answer from provided context, do NOT make up any information not provided in the context
  - Make answers concise and easy to read
  - Include relevant numerical data when available, but do NOT make up any numbers
  - Include exact urls when available, but do NOT make up any urls
  - Format the final answer in a user-friendly way

SPECIAL CASES:
1. If the task is unclear defined, you can let it pass. But if something is missing or the image does not show what was requested, do NOT let it pass
2. Try to understand the page and help the model with suggestions like scroll, do x, ... to get the solution right
3. If the webpage is asking for username or password, you should respond with:
  - is_valid: true
  - reason: describe the reason why it is valid although the task is not completed yet
  - answer: ask the user to sign in by themselves
4. If the output is correct and the task is completed, you should respond with 
  - is_valid: true
  - reason: "Task completed"
  - answer: The final answer to the task

RESPONSE FORMAT: You must ALWAYS respond with valid JSON in this exact format:
{
  "is_valid": true or false,  // Boolean value (not a string) indicating if task is completed correctly
  "reason": string,           // clear explanation of validation result
  "answer": string            // empty string if is_valid is false; human-readable final answer and should not be empty if is_valid is true
}

ANSWER FORMATTING GUIDELINES:
- Start with an emoji "" if is_valid is true
- Use markdown formatting if required by the task description
- By default use plain text
- Use bullet points for multiple items if needed
- Use line breaks for better readability
- Use indentations for nested lists

<example_output>
{
  "is_valid": false, 
  "reason": "The user wanted to search for \\"cat photos\\", but the agent searched for \\"dog photos\\" instead.",
  "answer": ""
}
</example_output>

<example_output>
{
  "is_valid": true, 
  "reason": "The task is completed",
  "answer": " Successfully followed @agent_ai on X."
}
</example_output>

TASK TO VALIDATE: 
${this.tasksToValidate()}`)}async getUserMessage(e){return await this.buildBrowserStateUserMessage(e)}addFollowUpTask(e){this.tasks.push(e)}}const _G=ws("event-manager");let vG=class{constructor(){this._subscribers=new Map}subscribe(e,t){this._subscribers.has(e)||this._subscribers.set(e,[]);const r=this._subscribers.get(e);r&&!r.includes(t)&&r.push(t)}unsubscribe(e,t){if(this._subscribers.has(e)){const r=this._subscribers.get(e);r&&this._subscribers.set(e,r.filter(s=>s!==t))}}clearSubscribers(e){this._subscribers.has(e)&&this._subscribers.set(e,[])}async emit(e){const t=this._subscribers.get(e.type);if(t)try{await Promise.all(t.map(async r=>await r(e)))}catch(r){_G.error("Error executing event callbacks:",r)}}};const hi=ws("Executor");class SG{constructor(e,t,r,s,i){this.tasks=[];const a=new nk({}),o=(i==null?void 0:i.plannerLLM)??s,u=(i==null?void 0:i.validatorLLM)??s,l=(i==null?void 0:i.extractorLLM)??s,d=new vG,h=new V9(t,r,a,d,(i==null?void 0:i.agentOptions)??{});this.tasks.push(e),this.navigatorPrompt=new yG(h.options.maxActionsPerStep),this.plannerPrompt=new wG,this.validatorPrompt=new bG(e);const f=new cG(h,l),p=new dG(f.buildDefaultActions());this.navigator=new hG(p,{chatLLM:s,context:h,prompt:this.navigatorPrompt}),this.planner=new pG({chatLLM:o,context:h,prompt:this.plannerPrompt}),this.validator=new gG({chatLLM:u,context:h,prompt:this.validatorPrompt}),this.context=h,this.context.messageManager.initTaskMessages(this.navigatorPrompt.getSystemMessage(),e)}subscribeExecutionEvents(e){this.context.eventManager.subscribe(xx.EXECUTION,e)}clearExecutionEvents(){this.context.eventManager.clearSubscribers(xx.EXECUTION)}addFollowUpTask(e){this.tasks.push(e),this.context.messageManager.addNewTask(e),this.validatorPrompt.addFollowUpTask(e),this.context.actionResults=this.context.actionResults.filter(t=>t.includeInMemory)}async execute(){var r;hi.info(` Executing task: ${this.tasks[this.tasks.length-1]}`);const e=this.context;e.nSteps=0;const t=this.context.options.maxSteps;try{this.context.emitEvent(Ae.SYSTEM,ke.TASK_START,this.context.taskId);let s=!1,i=0,a=!1;for(i=0;i<t&&(e.stepInfo={stepNumber:e.nSteps,maxSteps:e.options.maxSteps},hi.info(` Step ${i+1} / ${t}`),!await this.shouldStop());i++){if(this.planner&&(e.nSteps%e.options.planningInterval===0||a)){a=!1,(this.tasks.length>1||i>0)&&await this.navigator.addStateMessageToMemory();const o=await this.planner.execute();if(o.result&&(hi.info(` Planner output: ${JSON.stringify(o.result,null,2)}`),this.context.messageManager.addPlan(JSON.stringify(o.result),this.context.messageManager.length()-1),o.result.done?(s=!0,this.validator.setPlan(o.result.next_steps)):(this.validator.setPlan(null),s=!1),!o.result.web_task&&o.result.done))break}if(s||(s=await this.navigate()),s&&this.context.options.validateOutput&&!this.context.stopped&&!this.context.paused){if((r=(await this.validator.execute()).result)!=null&&r.is_valid){hi.info(" Task completed successfully");break}if(a=!0,e.consecutiveValidatorFailures++,e.consecutiveValidatorFailures>=e.options.maxValidatorFailures)throw hi.error(`Stopping due to ${e.options.maxValidatorFailures} consecutive validator failures`),new Error("Too many failures of validation")}}s?this.context.emitEvent(Ae.SYSTEM,ke.TASK_OK,this.context.taskId):i>=t?(hi.info(" Task failed: Max steps reached"),this.context.emitEvent(Ae.SYSTEM,ke.TASK_FAIL,"Task failed: Max steps reached")):this.context.stopped?this.context.emitEvent(Ae.SYSTEM,ke.TASK_CANCEL,"Task cancelled"):this.context.emitEvent(Ae.SYSTEM,ke.TASK_PAUSE,"Task paused")}catch(s){const i=s instanceof Error?s.message:String(s);this.context.emitEvent(Ae.SYSTEM,ke.TASK_FAIL,`Task failed: ${i}`)}}async navigate(){var t;const e=this.context;try{if(e.paused||e.stopped)return!1;const r=await this.navigator.execute();if(e.paused||e.stopped)return!1;if(e.nSteps++,r.error)throw new Error(r.error);if(e.consecutiveFailures=0,(t=r.result)!=null&&t.done)return!0}catch(r){if(r instanceof Nl||r instanceof $l)throw r;if(e.consecutiveFailures++,hi.error(`Failed to execute step: ${r}`),e.consecutiveFailures>=e.options.maxFailures)throw new Error("Max failures reached")}return!1}async shouldStop(){if(this.context.stopped)return hi.info("Agent stopped"),!0;for(;this.context.paused;)if(await new Promise(e=>setTimeout(e,200)),this.context.stopped)return!0;return this.context.consecutiveFailures>=this.context.options.maxFailures?(hi.error(`Stopping due to ${this.context.options.maxFailures} consecutive failures`),!0):!1}async cancel(){this.context.stop()}async resume(){this.context.resume()}async pause(){this.context.pause()}async cleanup(){try{await this.context.browserContext.cleanup()}catch(e){hi.error(`Failed to cleanup browser context: ${e}`)}}async getCurrentTaskId(){return this.context.taskId}}const hk="RFC3986",fk={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},xG="RFC1738",EG=Array.isArray,fi=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),pk=1024,kG=(n,e,t,r,s)=>{if(n.length===0)return n;let i=n;if(typeof n=="symbol"?i=Symbol.prototype.toString.call(n):typeof n!="string"&&(i=String(n)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=pk){const u=i.length>=pk?i.slice(o,o+pk):i,l=[];for(let d=0;d<u.length;++d){let h=u.charCodeAt(d);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||s===xG&&(h===40||h===41)){l[l.length]=u.charAt(d);continue}if(h<128){l[l.length]=fi[h];continue}if(h<2048){l[l.length]=fi[192|h>>6]+fi[128|h&63];continue}if(h<55296||h>=57344){l[l.length]=fi[224|h>>12]+fi[128|h>>6&63]+fi[128|h&63];continue}d+=1,h=65536+((h&1023)<<10|u.charCodeAt(d)&1023),l[l.length]=fi[240|h>>18]+fi[128|h>>12&63]+fi[128|h>>6&63]+fi[128|h&63]}a+=l.join("")}return a};function CG(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function dN(n,e){if(EG(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const PG=Object.prototype.hasOwnProperty,hN={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},pi=Array.isArray,AG=Array.prototype.push,fN=function(n,e){AG.apply(n,pi(e)?e:[e])},TG=Date.prototype.toISOString,ar={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:kG,encodeValuesOnly:!1,format:hk,formatter:fk[hk],indices:!1,serializeDate(n){return TG.call(n)},skipNulls:!1,strictNullHandling:!1};function IG(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const mk={};function pN(n,e,t,r,s,i,a,o,u,l,d,h,f,p,m,g,y,w){let S=n,_=w,v=0,A=!1;for(;(_=_.get(mk))!==void 0&&!A;){const I=_.get(n);if(v+=1,typeof I<"u"){if(I===v)throw new RangeError("Cyclic object value");A=!0}typeof _.get(mk)>"u"&&(v=0)}if(typeof l=="function"?S=l(e,S):S instanceof Date?S=f==null?void 0:f(S):t==="comma"&&pi(S)&&(S=dN(S,function(I){return I instanceof Date?f==null?void 0:f(I):I})),S===null){if(i)return u&&!g?u(e,ar.encoder,y,"key",p):e;S=""}if(IG(S)||CG(S)){if(u){const I=g?e:u(e,ar.encoder,y,"key",p);return[(m==null?void 0:m(I))+"="+(m==null?void 0:m(u(S,ar.encoder,y,"value",p)))]}return[(m==null?void 0:m(e))+"="+(m==null?void 0:m(String(S)))]}const k=[];if(typeof S>"u")return k;let C;if(t==="comma"&&pi(S))g&&u&&(S=dN(S,u)),C=[{value:S.length>0?S.join(",")||null:void 0}];else if(pi(l))C=l;else{const I=Object.keys(S);C=d?I.sort(d):I}const E=o?String(e).replace(/\./g,"%2E"):String(e),N=r&&pi(S)&&S.length===1?E+"[]":E;if(s&&pi(S)&&S.length===0)return N+"[]";for(let I=0;I<C.length;++I){const $=C[I],O=typeof $=="object"&&typeof $.value<"u"?$.value:S[$];if(a&&O===null)continue;const T=h&&o?$.replace(/\./g,"%2E"):$,L=pi(S)?typeof t=="function"?t(N,T):N:N+(h?"."+T:"["+T+"]");w.set(n,v);const U=new WeakMap;U.set(mk,w),fN(k,pN(O,L,t,r,s,i,a,o,t==="comma"&&g&&pi(S)?null:u,l,d,h,f,p,m,g,y,U))}return k}function OG(n=ar){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||ar.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=hk;if(typeof n.format<"u"){if(!PG.call(fk,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=fk[t];let s=ar.filter;(typeof n.filter=="function"||pi(n.filter))&&(s=n.filter);let i;if(n.arrayFormat&&n.arrayFormat in hN?i=n.arrayFormat:"indices"in n?i=n.indices?"indices":"repeat":i=ar.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:ar.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:ar.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:ar.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:ar.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?ar.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:ar.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:ar.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:ar.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:ar.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:ar.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:ar.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:ar.strictNullHandling}}function RG(n,e={}){let t=n;const r=OG(e);let s,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):pi(r.filter)&&(i=r.filter,s=i);const a=[];if(typeof t!="object"||t===null)return"";const o=hN[r.arrayFormat],u=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);const l=new WeakMap;for(let f=0;f<s.length;++f){const p=s[f];r.skipNulls&&t[p]===null||fN(a,pN(t[p],p,o,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}const d=a.join(r.delimiter);let h=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),d.length>0?h+d:""}const jl="4.82.0";let mN=!1,gp,gN,yN,gk,wN,bN,_N,vN,SN;function MG(n,e={auto:!1}){if(mN)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(gp)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${gp}'\``);mN=e.auto,gp=n.kind,gN=n.fetch,yN=n.FormData,gk=n.File,wN=n.ReadableStream,bN=n.getMultipartRequestOptions,_N=n.getDefaultAgent,vN=n.fileFromPath,SN=n.isFsReadStream}let NG=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function $G({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new NG(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}gp||MG($G(),{auto:!0});let Je=class extends Error{},wn=class DT extends Je{constructor(e,t,r,s){super(`${DT.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new P_({message:r,cause:_k(t)});const i=t==null?void 0:t.error;return e===400?new xN(e,i,r,s):e===401?new EN(e,i,r,s):e===403?new kN(e,i,r,s):e===404?new CN(e,i,r,s):e===409?new PN(e,i,r,s):e===422?new AN(e,i,r,s):e===429?new TN(e,i,r,s):e>=500?new IN(e,i,r,s):new DT(e,i,r,s)}},is=class extends wn{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},P_=class extends wn{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},A_=class extends P_{constructor({message:e}={}){super({message:e??"Request timed out."})}},xN=class extends wn{},EN=class extends wn{},kN=class extends wn{},CN=class extends wn{},PN=class extends wn{},AN=class extends wn{},TN=class extends wn{},IN=class extends wn{},ON=class extends Je{constructor(){super("Could not parse response content as the length limit was reached")}},RN=class extends Je{constructor(){super("Could not parse response content as the request was rejected by the content filter")}},T_=class BT{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=BT.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(BT.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Je(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Je(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Je("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};T_.NEWLINE_CHARS=new Set([`
`,"\r"]),T_.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function MN(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}let yp=class Vw{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of jG(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(o&&o.error)throw new wn(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(a.event=="error")throw new wn(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Vw(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new T_,o=MN(e);for await(const u of o)for(const l of a.decode(u))yield l;for(const u of a.flush())yield u}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Vw(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new Vw(()=>s(e),this.controller),new Vw(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new wN({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}};async function*jG(n,e){if(!n.body)throw e.abort(),new Je("Attempted to iterate over a response with no body");const t=new DG,r=new T_,s=MN(n.body);for await(const i of LG(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*LG(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=FG(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function FG(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}let DG=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=BG(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function BG(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}const NN=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",$N=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&I_(n),I_=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",UG=n=>$N(n)||NN(n)||SN(n);async function jN(n,e,t){var s;if(n=await n,$N(n))return n;if(NN(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=I_(i)?[await i.arrayBuffer()]:[i];return new gk(a,e,t)}const r=await qG(n);if(e||(e=HG(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new gk(r,e,t)}async function qG(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(I_(n))e.push(await n.arrayBuffer());else if(WG(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${KG(n)}`);return e}function KG(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function HG(n){var e;return yk(n.name)||yk(n.filename)||((e=yk(n.path))==null?void 0:e.split(/[\\/]/).pop())}const yk=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},WG=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",LN=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",Ll=async n=>{const e=await zG(n.body);return bN(e,n)},zG=async n=>{const e=new yN;return await Promise.all(Object.entries(n||{}).map(([t,r])=>wk(e,t,r))),e},wk=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(UG(t)){const r=await jN(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>wk(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>wk(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var VG=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},GG=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},O_;async function FN(n){const{response:e}=n;if(n.options.stream)return Fl("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):yp.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return Fl("response",e.status,e.url,e.headers,i),DN(i,e)}const s=await e.text();return Fl("response",e.status,e.url,e.headers,s),s}function DN(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}let BN=class g3 extends Promise{constructor(e,t=FN){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new g3(this.responsePromise,async t=>DN(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},ZG=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=bk("maxRetries",t),this.timeout=bk("timeout",r),this.httpAgent=s,this.fetch=i??gN}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...t8(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${i8()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&I_(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var g;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:LN(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,u=this.calculateContentLength(o),l=this.buildURL(s,i);"timeout"in e&&bk("timeout",e.timeout);const d=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??_N(l),f=d+1e3;typeof((g=h==null?void 0:h.options)==null?void 0:g.timeout)=="number"&&f>(h.options.timeout??0)&&(h.options.timeout=f),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const p=this.buildHeaders({options:e,headers:a,contentLength:u,retryCount:t});return{req:{method:r,...o&&{body:o},headers:p,...h&&{agent:h},signal:e.signal??null},url:l,timeout:d}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return VN(i,a),VN(i,t),LN(e.body)&&gp!=="node"&&delete i["content-type"],ZN(a,"x-stainless-retry-count")===void 0&&ZN(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return wn.generate(e,t,r,s)}request(e,t=null){return new BN(this.makeRequest(e,t))}async makeRequest(e,t){var h,f;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),Fl("request",a,r,i.headers),(h=r.signal)!=null&&h.aborted)throw new is;const u=new AbortController,l=await this.fetchWithTimeout(a,i,o,u).catch(_k);if(l instanceof Error){if((f=r.signal)!=null&&f.aborted)throw new is;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new A_:new P_({cause:l})}const d=XG(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){const S=`retrying, ${t} attempts remaining`;return Fl(`response (error; ${S})`,l.status,a,d),this.retryRequest(r,t,d)}const p=await l.text().catch(S=>_k(S).message),m=r8(p),g=m?void 0:p;throw Fl(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,d,g),this.makeStatusError(l.status,m,g,d)}return{response:l,options:r,controller:u}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new JG(this,r,e)}buildURL(e,t){const r=s8(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return WN(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new Je(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r),u={signal:s.signal,...a};return u.method&&(u.method=u.method.toUpperCase()),this.fetch.call(void 0,e,u).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await wp(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${jl}`}},UN=class{constructor(e,t,r,s){O_.set(this,void 0),VG(this,O_,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Je("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await GG(this,O_,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(O_=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},JG=class extends BN{constructor(e,t,r){super(t,async s=>new r(e,s.response,await FN(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const XG=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),YG={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},bn=n=>typeof n=="object"&&n!==null&&!WN(n)&&Object.keys(n).every(e=>zN(YG,e)),QG=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":jl,"X-Stainless-OS":KN(Deno.build.os),"X-Stainless-Arch":qN(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":jl,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":jl,"X-Stainless-OS":KN(process.platform),"X-Stainless-Arch":qN(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=e8();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":jl,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":jl,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function e8(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const qN=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",KN=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let HN;const t8=()=>HN??(HN=QG()),r8=n=>{try{return JSON.parse(n)}catch{return}},n8=/^[a-z][a-z0-9+.-]*:/i,s8=n=>n8.test(n),wp=n=>new Promise(e=>setTimeout(e,n)),bk=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Je(`${n} must be an integer`);if(e<0)throw new Je(`${n} must be a positive integer`);return e},_k=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},R_=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function WN(n){if(!n)return!0;for(const e in n)return!1;return!0}function zN(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function VN(n,e){for(const t in e){if(!zN(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}const GN=new Set(["authorization","api-key"]);function Fl(n,...e){var t;if(typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"){const r=e.map(s=>{if(!s)return s;if(s.headers){const a={...s,headers:{...s.headers}};for(const o in s.headers)GN.has(o.toLowerCase())&&(a.headers[o]="REDACTED");return a}let i=null;for(const a in s)GN.has(a.toLowerCase())&&(i??(i={...s}),i[a]="REDACTED");return i??s});console.log(`OpenAI:DEBUG:${n}`,...r)}}const i8=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),a8=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",o8=n=>typeof(n==null?void 0:n.get)=="function",ZN=(n,e)=>{var r;const t=e.toLowerCase();if(o8(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};function vk(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}let c8=class extends UN{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}},As=class extends UN{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}},gt=class{constructor(e){this._client=e}},JN=class extends gt{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},Sk=class extends gt{constructor(){super(...arguments),this.completions=new JN(this._client)}};Sk.Completions=JN;let XN=class extends gt{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}},YN=class extends gt{create(e,t){return this._client.post("/audio/transcriptions",Ll({body:e,...t}))}},QN=class extends gt{create(e,t){return this._client.post("/audio/translations",Ll({body:e,...t}))}},bp=class extends gt{constructor(){super(...arguments),this.transcriptions=new YN(this._client),this.translations=new QN(this._client),this.speech=new XN(this._client)}};bp.Transcriptions=YN,bp.Translations=QN,bp.Speech=XN;let xk=class extends gt{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return bn(e)?this.list({},e):this._client.getAPIList("/batches",Ek,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}},Ek=class extends As{};xk.BatchesPage=Ek;let kk=class extends gt{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return bn(e)?this.list({},e):this._client.getAPIList("/assistants",Ck,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}},Ck=class extends As{};kk.AssistantsPage=Ck;function e$(n){return typeof n.parse=="function"}const Dl=n=>(n==null?void 0:n.role)==="assistant",t$=n=>(n==null?void 0:n.role)==="function",r$=n=>(n==null?void 0:n.role)==="tool";var Ts=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Ht=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Pk,M_,N_,_p,vp,$_,Sp,Xi,xp,j_,L_,Bl,n$;let s$=class{constructor(){Pk.add(this),this.controller=new AbortController,M_.set(this,void 0),N_.set(this,()=>{}),_p.set(this,()=>{}),vp.set(this,void 0),$_.set(this,()=>{}),Sp.set(this,()=>{}),Xi.set(this,{}),xp.set(this,!1),j_.set(this,!1),L_.set(this,!1),Bl.set(this,!1),Ts(this,M_,new Promise((e,t)=>{Ts(this,N_,e,"f"),Ts(this,_p,t,"f")}),"f"),Ts(this,vp,new Promise((e,t)=>{Ts(this,$_,e,"f"),Ts(this,Sp,t,"f")}),"f"),Ht(this,M_,"f").catch(()=>{}),Ht(this,vp,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},Ht(this,Pk,"m",n$).bind(this))},0)}_connected(){this.ended||(Ht(this,N_,"f").call(this),this._emit("connect"))}get ended(){return Ht(this,xp,"f")}get errored(){return Ht(this,j_,"f")}get aborted(){return Ht(this,L_,"f")}abort(){this.controller.abort()}on(e,t){return(Ht(this,Xi,"f")[e]||(Ht(this,Xi,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=Ht(this,Xi,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(Ht(this,Xi,"f")[e]||(Ht(this,Xi,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Ts(this,Bl,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Ts(this,Bl,!0,"f"),await Ht(this,vp,"f")}_emit(e,...t){if(Ht(this,xp,"f"))return;e==="end"&&(Ts(this,xp,!0,"f"),Ht(this,$_,"f").call(this));const r=Ht(this,Xi,"f")[e];if(r&&(Ht(this,Xi,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!Ht(this,Bl,"f")&&!(r!=null&&r.length)&&Promise.reject(s),Ht(this,_p,"f").call(this,s),Ht(this,Sp,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!Ht(this,Bl,"f")&&!(r!=null&&r.length)&&Promise.reject(s),Ht(this,_p,"f").call(this,s),Ht(this,Sp,"f").call(this,s),this._emit("end")}}_emitFinal(){}};M_=new WeakMap,N_=new WeakMap,_p=new WeakMap,vp=new WeakMap,$_=new WeakMap,Sp=new WeakMap,Xi=new WeakMap,xp=new WeakMap,j_=new WeakMap,L_=new WeakMap,Bl=new WeakMap,Pk=new WeakSet,n$=function(e){if(Ts(this,j_,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new is),e instanceof is)return Ts(this,L_,!0,"f"),this._emit("abort",e);if(e instanceof Je)return this._emit("error",e);if(e instanceof Error){const t=new Je(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Je(String(e)))};function u8(n,e){const t={...n};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function i$(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function l8(n,{parser:e,callback:t}){const r={...n};return Object.defineProperties(r,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),r}function Ep(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function d8(n,e){return!e||!a$(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:Ak(n,e)}function Ak(n,e){const t=n.choices.map(r=>{var s;if(r.finish_reason==="length")throw new ON;if(r.finish_reason==="content_filter")throw new RN;return{...r,message:{...r.message,tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(i=>f8(e,i)))??[],parsed:r.message.content&&!r.message.refusal?h8(e,r.message.content):null}}});return{...n,choices:t}}function h8(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function f8(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Ep(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function p8(n,e){var r;if(!n)return!1;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return Ep(t)||(t==null?void 0:t.function.strict)||!1}function a$(n){var e;return i$(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>Ep(t)||t.type==="function"&&t.function.strict===!0))??!1}function m8(n){for(const e of n??[]){if(e.type!=="function")throw new Je(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new Je(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var _n=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Kr,Tk,F_,Ik,Ok,Rk,o$,Mk;const c$=10;let u$=class extends s${constructor(){super(...arguments),Kr.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(t$(e)||r$(e))&&e.content)this._emit("functionCallResult",e.content);else if(Dl(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Dl(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new Je("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),_n(this,Kr,"m",Tk).call(this)}async finalMessage(){return await this.done(),_n(this,Kr,"m",F_).call(this)}async finalFunctionCall(){return await this.done(),_n(this,Kr,"m",Ik).call(this)}async finalFunctionCallResult(){return await this.done(),_n(this,Kr,"m",Ok).call(this)}async totalUsage(){return await this.done(),_n(this,Kr,"m",Rk).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=_n(this,Kr,"m",F_).call(this);t&&this._emit("finalMessage",t);const r=_n(this,Kr,"m",Tk).call(this);r&&this._emit("finalContent",r);const s=_n(this,Kr,"m",Ik).call(this);s&&this._emit("finalFunctionCall",s);const i=_n(this,Kr,"m",Ok).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",_n(this,Kr,"m",Rk).call(this))}async _createChatCompletion(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),_n(this,Kr,"m",o$).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Ak(i,t))}async _runChatCompletion(e,t,r){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var f;const s="function",{function_call:i="auto",stream:a,...o}=t,u=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:l=c$}=r||{},d={};for(const p of t.functions)d[p.name||p.function.name]=p;const h=t.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(const p of t.messages)this._addMessage(p,!1);for(let p=0;p<l;++p){const g=(f=(await this._createChatCompletion(e,{...o,function_call:i,functions:h,messages:[...this.messages]},r)).choices[0])==null?void 0:f.message;if(!g)throw new Je("missing message in ChatCompletion response");if(!g.function_call)return;const{name:y,arguments:w}=g.function_call,S=d[y];if(S){if(u&&u!==y){const k=`Invalid function_call: ${JSON.stringify(y)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,name:y,content:k});continue}}else{const k=`Invalid function_call: ${JSON.stringify(y)}. Available options are: ${h.map(C=>JSON.stringify(C.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:y,content:k});continue}let _;try{_=e$(S)?await S.parse(w):w}catch(k){this._addMessage({role:s,name:y,content:k instanceof Error?k.message:String(k)});continue}const v=await S.function(_,this),A=_n(this,Kr,"m",Mk).call(this,v);if(this._addMessage({role:s,name:y,content:A}),u)return}}async _runTools(e,t,r){var p,m,g;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,u=typeof i!="string"&&((p=i==null?void 0:i.function)==null?void 0:p.name),{maxChatCompletions:l=c$}=r||{},d=t.tools.map(y=>{if(Ep(y)){if(!y.$callback)throw new Je("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:y.$callback,name:y.function.name,description:y.function.description||"",parameters:y.function.parameters,parse:y.$parseRaw,strict:!0}}}return y}),h={};for(const y of d)y.type==="function"&&(h[y.function.name||y.function.function.name]=y.function);const f="tools"in t?d.map(y=>y.type==="function"?{type:"function",function:{name:y.function.name||y.function.function.name,parameters:y.function.parameters,description:y.function.description,strict:y.function.strict}}:y):void 0;for(const y of t.messages)this._addMessage(y,!1);for(let y=0;y<l;++y){const S=(m=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:f,messages:[...this.messages]},r)).choices[0])==null?void 0:m.message;if(!S)throw new Je("missing message in ChatCompletion response");if(!((g=S.tool_calls)!=null&&g.length))return;for(const _ of S.tool_calls){if(_.type!=="function")continue;const v=_.id,{name:A,arguments:k}=_.function,C=h[A];if(C){if(u&&u!==A){const $=`Invalid tool_call: ${JSON.stringify(A)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,tool_call_id:v,content:$});continue}}else{const $=`Invalid tool_call: ${JSON.stringify(A)}. Available options are: ${Object.keys(h).map(O=>JSON.stringify(O)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:v,content:$});continue}let E;try{E=e$(C)?await C.parse(k):k}catch($){const O=$ instanceof Error?$.message:String($);this._addMessage({role:s,tool_call_id:v,content:O});continue}const N=await C.function(E,this),I=_n(this,Kr,"m",Mk).call(this,N);if(this._addMessage({role:s,tool_call_id:v,content:I}),u)return}}}};Kr=new WeakSet,Tk=function(){return _n(this,Kr,"m",F_).call(this).content??null},F_=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Dl(t)){const{function_call:r,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return r&&(i.function_call=r),i}}throw new Je("stream ended without producing a ChatCompletionMessage with role=assistant")},Ik=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(Dl(s)&&(s!=null&&s.function_call))return s.function_call;if(Dl(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},Ok=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(t$(t)&&t.content!=null||r$(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},Rk=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},o$=function(e){if(e.n!=null&&e.n>1)throw new Je("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Mk=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};let l$=class UT extends u${static runFunctions(e,t,r){const s=new UT,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new UT,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),Dl(e)&&e.content&&this._emit("content",e.content)}};const d$=1,h$=2,f$=4,p$=8,m$=16,g$=32,y$=64,w$=128,b$=256,_$=w$|b$,v$=m$|g$|_$|y$,S$=d$|h$|v$,x$=f$|p$,g8=S$|x$,_r={STR:d$,NUM:h$,ARR:f$,OBJ:p$,NULL:m$,BOOL:g$,NAN:y$,INFINITY:w$,MINUS_INFINITY:b$,INF:_$,SPECIAL:v$,ATOM:S$,COLLECTION:x$,ALL:g8};let y8=class extends Error{},w8=class extends Error{};function b8(n,e=_r.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return _8(n.trim(),e)}const _8=(n,e)=>{const t=n.length;let r=0;const s=f=>{throw new y8(`${f} at position ${r}`)},i=f=>{throw new w8(`${f} at position ${r}`)},a=()=>(h(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?u():n[r]==="["?l():n.substring(r,r+4)==="null"||_r.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||_r.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||_r.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||_r.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||_r.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||_r.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):d()),o=()=>{const f=r;let p=!1;for(r++;r<t&&(n[r]!=='"'||p&&n[r-1]==="\\");)p=n[r]==="\\"?!p:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(f,++r-Number(p)))}catch(m){i(String(m))}else if(_r.STR&e)try{return JSON.parse(n.substring(f,r-Number(p))+'"')}catch{return JSON.parse(n.substring(f,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},u=()=>{r++,h();const f={};try{for(;n[r]!=="}";){if(h(),r>=t&&_r.OBJ&e)return f;const p=o();h(),r++;try{const m=a();Object.defineProperty(f,p,{value:m,writable:!0,enumerable:!0,configurable:!0})}catch(m){if(_r.OBJ&e)return f;throw m}h(),n[r]===","&&r++}}catch{if(_r.OBJ&e)return f;s("Expected '}' at end of object")}return r++,f},l=()=>{r++;const f=[];try{for(;n[r]!=="]";)f.push(a()),h(),n[r]===","&&r++}catch{if(_r.ARR&e)return f;s("Expected ']' at end of array")}return r++,f},d=()=>{if(r===0){n==="-"&&_r.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(p){if(_r.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}i(String(p))}}const f=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(_r.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(f,r))}catch{n.substring(f,r)==="-"&&_r.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(f,n.lastIndexOf("e")))}catch(m){i(String(m))}}},h=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return a()},E$=n=>b8(n,_r.ALL^_r.NUM);var Ul=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},At=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},or,Yi,ql,Ya,Nk,D_,$k,jk,Lk,B_,Fk,k$;let C$=class qT extends u${constructor(e){super(),or.add(this),Yi.set(this,void 0),ql.set(this,void 0),Ya.set(this,void 0),Ul(this,Yi,e,"f"),Ul(this,ql,[],"f")}get currentChatCompletionSnapshot(){return At(this,Ya,"f")}static fromReadableStream(e){const t=new qT(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const s=new qT(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var a;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),At(this,or,"m",Nk).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)At(this,or,"m",$k).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new is;return this._addChatCompletion(At(this,or,"m",B_).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),At(this,or,"m",Nk).call(this),this._connected();const s=yp.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(At(this,or,"m",B_).call(this)),At(this,or,"m",$k).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new is;return this._addChatCompletion(At(this,or,"m",B_).call(this))}[(Yi=new WeakMap,ql=new WeakMap,Ya=new WeakMap,or=new WeakSet,Nk=function(){this.ended||Ul(this,Ya,void 0,"f")},D_=function(t){let r=At(this,ql,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},At(this,ql,"f")[t.index]=r,r)},$k=function(t){var s,i,a,o,u,l,d,h,f,p,m,g,y,w,S;if(this.ended)return;const r=At(this,or,"m",k$).call(this,t);this._emit("chunk",t,r);for(const _ of t.choices){const v=r.choices[_.index];_.delta.content!=null&&((s=v.message)==null?void 0:s.role)==="assistant"&&((i=v.message)!=null&&i.content)&&(this._emit("content",_.delta.content,v.message.content),this._emit("content.delta",{delta:_.delta.content,snapshot:v.message.content,parsed:v.message.parsed})),_.delta.refusal!=null&&((a=v.message)==null?void 0:a.role)==="assistant"&&((o=v.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:_.delta.refusal,snapshot:v.message.refusal}),((u=_.logprobs)==null?void 0:u.content)!=null&&((l=v.message)==null?void 0:l.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(d=_.logprobs)==null?void 0:d.content,snapshot:((h=v.logprobs)==null?void 0:h.content)??[]}),((f=_.logprobs)==null?void 0:f.refusal)!=null&&((p=v.message)==null?void 0:p.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(m=_.logprobs)==null?void 0:m.refusal,snapshot:((g=v.logprobs)==null?void 0:g.refusal)??[]});const A=At(this,or,"m",D_).call(this,v);v.finish_reason&&(At(this,or,"m",Lk).call(this,v),A.current_tool_call_index!=null&&At(this,or,"m",jk).call(this,v,A.current_tool_call_index));for(const k of _.delta.tool_calls??[])A.current_tool_call_index!==k.index&&(At(this,or,"m",Lk).call(this,v),A.current_tool_call_index!=null&&At(this,or,"m",jk).call(this,v,A.current_tool_call_index)),A.current_tool_call_index=k.index;for(const k of _.delta.tool_calls??[]){const C=(y=v.message.tool_calls)==null?void 0:y[k.index];C!=null&&C.type&&((C==null?void 0:C.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(w=C.function)==null?void 0:w.name,index:k.index,arguments:C.function.arguments,parsed_arguments:C.function.parsed_arguments,arguments_delta:((S=k.function)==null?void 0:S.arguments)??""}):(C==null||C.type,void 0))}}},jk=function(t,r){var a,o,u;if(At(this,or,"m",D_).call(this,t).done_tool_calls.has(r))return;const i=(a=t.message.tool_calls)==null?void 0:a[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const l=(u=(o=At(this,Yi,"f"))==null?void 0:o.tools)==null?void 0:u.find(d=>d.type==="function"&&d.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:Ep(l)?l.$parseRaw(i.function.arguments):l!=null&&l.function.strict?JSON.parse(i.function.arguments):null})}else i.type},Lk=function(t){var s,i;const r=At(this,or,"m",D_).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const a=At(this,or,"m",Fk).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},B_=function(){if(this.ended)throw new Je("stream has ended, this shouldn't happen");const t=At(this,Ya,"f");if(!t)throw new Je("request ended without sending any chunks");return Ul(this,Ya,void 0,"f"),Ul(this,ql,[],"f"),v8(t,At(this,Yi,"f"))},Fk=function(){var r;const t=(r=At(this,Yi,"f"))==null?void 0:r.response_format;return i$(t)?t:null},k$=function(t){var r,s,i,a;let o=At(this,Ya,"f");const{choices:u,...l}=t;o?Object.assign(o,l):o=Ul(this,Ya,{...l,choices:[]},"f");for(const{delta:d,finish_reason:h,index:f,logprobs:p=null,...m}of t.choices){let g=o.choices[f];if(g||(g=o.choices[f]={finish_reason:h,index:f,message:{},logprobs:p,...m}),p)if(!g.logprobs)g.logprobs=Object.assign({},p);else{const{content:k,refusal:C,...E}=p;Object.assign(g.logprobs,E),k&&((r=g.logprobs).content??(r.content=[]),g.logprobs.content.push(...k)),C&&((s=g.logprobs).refusal??(s.refusal=[]),g.logprobs.refusal.push(...C))}if(h&&(g.finish_reason=h,At(this,Yi,"f")&&a$(At(this,Yi,"f")))){if(h==="length")throw new ON;if(h==="content_filter")throw new RN}if(Object.assign(g,m),!d)continue;const{content:y,refusal:w,function_call:S,role:_,tool_calls:v,...A}=d;if(Object.assign(g.message,A),w&&(g.message.refusal=(g.message.refusal||"")+w),_&&(g.message.role=_),S&&(g.message.function_call?(S.name&&(g.message.function_call.name=S.name),S.arguments&&((i=g.message.function_call).arguments??(i.arguments=""),g.message.function_call.arguments+=S.arguments)):g.message.function_call=S),y&&(g.message.content=(g.message.content||"")+y,!g.message.refusal&&At(this,or,"m",Fk).call(this)&&(g.message.parsed=E$(g.message.content))),v){g.message.tool_calls||(g.message.tool_calls=[]);for(const{index:k,id:C,type:E,function:N,...I}of v){const $=(a=g.message.tool_calls)[k]??(a[k]={});Object.assign($,I),C&&($.id=C),E&&($.type=E),N&&($.function??($.function={name:N.name??"",arguments:""})),N!=null&&N.name&&($.function.name=N.name),N!=null&&N.arguments&&($.function.arguments+=N.arguments,p8(At(this,Yi,"f"),$)&&($.function.parsed_arguments=E$($.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new yp(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function v8(n,e){const{id:t,choices:r,created:s,model:i,system_fingerprint:a,...o}=n,u={...o,id:t,choices:r.map(({message:l,finish_reason:d,index:h,logprobs:f,...p})=>{if(!d)throw new Je(`missing finish_reason for choice ${h}`);const{content:m=null,function_call:g,tool_calls:y,...w}=l,S=l.role;if(!S)throw new Je(`missing role for choice ${h}`);if(g){const{arguments:_,name:v}=g;if(_==null)throw new Je(`missing function_call.arguments for choice ${h}`);if(!v)throw new Je(`missing function_call.name for choice ${h}`);return{...p,message:{content:m,function_call:{arguments:_,name:v},role:S,refusal:l.refusal??null},finish_reason:d,index:h,logprobs:f}}return y?{...p,index:h,finish_reason:d,logprobs:f,message:{...w,role:S,content:m,refusal:l.refusal??null,tool_calls:y.map((_,v)=>{const{function:A,type:k,id:C,...E}=_,{arguments:N,name:I,...$}=A||{};if(C==null)throw new Je(`missing choices[${h}].tool_calls[${v}].id
${U_(n)}`);if(k==null)throw new Je(`missing choices[${h}].tool_calls[${v}].type
${U_(n)}`);if(I==null)throw new Je(`missing choices[${h}].tool_calls[${v}].function.name
${U_(n)}`);if(N==null)throw new Je(`missing choices[${h}].tool_calls[${v}].function.arguments
${U_(n)}`);return{...E,id:C,type:k,function:{...$,name:I,arguments:N}}})}}:{...p,message:{...w,content:m,role:S,refusal:l.refusal??null},finish_reason:d,index:h,logprobs:f}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return d8(u,e)}function U_(n){return JSON.stringify(n)}function Are(n){}let P$=class Y0 extends C${static fromReadableStream(e){const t=new Y0(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const s=new Y0(null),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new Y0(t),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}},A$=class extends gt{parse(e,t){return m8(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>Ak(r,e))}runFunctions(e,t){return e.stream?P$.runFunctions(this._client,e,t):l$.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?P$.runTools(this._client,e,t):l$.runTools(this._client,e,t)}stream(e,t){return C$.createChatCompletion(this._client,e,t)}},Dk=class extends gt{constructor(){super(...arguments),this.completions=new A$(this._client)}};(function(n){n.Completions=A$})(Dk||(Dk={}));let T$=class extends gt{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}},Bk=class extends gt{constructor(){super(...arguments),this.sessions=new T$(this._client)}};Bk.Sessions=T$;var Ie=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Dn=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Nr,Uk,mi,q_,Is,bc,Kl,_c,K_,Bn,H_,W_,kp,Cp,Pp,I$,O$,R$,M$,N$,$$,j$;let Hl=class Gw extends s${constructor(){super(...arguments),Nr.add(this),Uk.set(this,[]),mi.set(this,{}),q_.set(this,{}),Is.set(this,void 0),bc.set(this,void 0),Kl.set(this,void 0),_c.set(this,void 0),K_.set(this,void 0),Bn.set(this,void 0),H_.set(this,void 0),W_.set(this,void 0),kp.set(this,void 0)}[(Uk=new WeakMap,mi=new WeakMap,q_=new WeakMap,Is=new WeakMap,bc=new WeakMap,Kl=new WeakMap,_c=new WeakMap,K_=new WeakMap,Bn=new WeakMap,H_=new WeakMap,W_=new WeakMap,kp=new WeakMap,Nr=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Gw;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=yp.fromReadableStream(e,this.controller);for await(const a of s)Ie(this,Nr,"m",Cp).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new is;return this._addRun(Ie(this,Nr,"m",Pp).call(this))}toReadableStream(){return new yp(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,i){const a=new Gw;return a._run(()=>a._runToolAssistantStream(e,t,r,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,s,i){var l;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},u=await e.submitToolOutputs(t,r,o,{...i,signal:this.controller.signal});this._connected();for await(const d of u)Ie(this,Nr,"m",Cp).call(this,d);if((l=u.controller.signal)!=null&&l.aborted)throw new is;return this._addRun(Ie(this,Nr,"m",Pp).call(this))}static createThreadAssistantStream(e,t,r){const s=new Gw;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){const i=new Gw;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return Ie(this,H_,"f")}currentRun(){return Ie(this,W_,"f")}currentMessageSnapshot(){return Ie(this,Is,"f")}currentRunStepSnapshot(){return Ie(this,kp,"f")}async finalRunSteps(){return await this.done(),Object.values(Ie(this,mi,"f"))}async finalMessages(){return await this.done(),Object.values(Ie(this,q_,"f"))}async finalRun(){if(await this.done(),!Ie(this,bc,"f"))throw Error("Final run was not received.");return Ie(this,bc,"f")}async _createThreadAssistantStream(e,t,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const u of a)Ie(this,Nr,"m",Cp).call(this,u);if((o=a.controller.signal)!=null&&o.aborted)throw new is;return this._addRun(Ie(this,Nr,"m",Pp).call(this))}async _createAssistantStream(e,t,r,s){var u;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const l of o)Ie(this,Nr,"m",Cp).call(this,l);if((u=o.controller.signal)!=null&&u.aborted)throw new is;return this._addRun(Ie(this,Nr,"m",Pp).call(this))}static accumulateDelta(e,t){for(const[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(vk(i)&&vk(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(const a of s){if(!vk(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const u=i[o];u==null?i.push(a):i[o]=this.accumulateDelta(u,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,i){return await this._createToolAssistantStream(r,e,t,s,i)}};Cp=function(e){if(!this.ended)switch(Dn(this,H_,e,"f"),Ie(this,Nr,"m",R$).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":Ie(this,Nr,"m",j$).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Ie(this,Nr,"m",O$).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":Ie(this,Nr,"m",I$).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Pp=function(){if(this.ended)throw new Je("stream has ended, this shouldn't happen");if(!Ie(this,bc,"f"))throw Error("Final run has not been received");return Ie(this,bc,"f")},I$=function(e){const[t,r]=Ie(this,Nr,"m",N$).call(this,e,Ie(this,Is,"f"));Dn(this,Is,t,"f"),Ie(this,q_,"f")[t.id]=t;for(const s of r){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=Ie(this,Kl,"f")){if(Ie(this,_c,"f"))switch(Ie(this,_c,"f").type){case"text":this._emit("textDone",Ie(this,_c,"f").text,Ie(this,Is,"f"));break;case"image_file":this._emit("imageFileDone",Ie(this,_c,"f").image_file,Ie(this,Is,"f"));break}Dn(this,Kl,s.index,"f")}Dn(this,_c,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(Ie(this,Kl,"f")!==void 0){const s=e.data.content[Ie(this,Kl,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,Ie(this,Is,"f"));break;case"text":this._emit("textDone",s.text,Ie(this,Is,"f"));break}}Ie(this,Is,"f")&&this._emit("messageDone",e.data),Dn(this,Is,void 0,"f")}},O$=function(e){const t=Ie(this,Nr,"m",M$).call(this,e);switch(Dn(this,kp,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==Ie(this,K_,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(Ie(this,Bn,"f")&&this._emit("toolCallDone",Ie(this,Bn,"f")),Dn(this,K_,i.index,"f"),Dn(this,Bn,t.step_details.tool_calls[i.index],"f"),Ie(this,Bn,"f")&&this._emit("toolCallCreated",Ie(this,Bn,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Dn(this,kp,void 0,"f"),e.data.step_details.type=="tool_calls"&&Ie(this,Bn,"f")&&(this._emit("toolCallDone",Ie(this,Bn,"f")),Dn(this,Bn,void 0,"f")),this._emit("runStepDone",e.data,t);break}},R$=function(e){Ie(this,Uk,"f").push(e),this._emit("event",e)},M$=function(e){switch(e.event){case"thread.run.step.created":return Ie(this,mi,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=Ie(this,mi,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=Hl.accumulateDelta(t,r.delta);Ie(this,mi,"f")[e.data.id]=s}return Ie(this,mi,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":Ie(this,mi,"f")[e.data.id]=e.data;break}if(Ie(this,mi,"f")[e.data.id])return Ie(this,mi,"f")[e.data.id];throw new Error("No snapshot available")},N$=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=Ie(this,Nr,"m",$$).call(this,i,a)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},$$=function(e,t){return Hl.accumulateDelta(t,e)},j$=function(e){switch(Dn(this,W_,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Dn(this,bc,e.data,"f"),Ie(this,Bn,"f")&&(this._emit("toolCallDone",Ie(this,Bn,"f")),Dn(this,Bn,void 0,"f"));break}};let qk=class extends gt{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return bn(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,Kk,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}},Kk=class extends As{};qk.MessagesPage=Kk;let Hk=class extends gt{retrieve(e,t,r,s={},i){return bn(s)?this.retrieve(e,t,r,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,r={},s){return bn(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Wk,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}},Wk=class extends As{};Hk.RunStepsPage=Wk;let Ap=class extends gt{constructor(){super(...arguments),this.steps=new Hk(this._client)}create(e,t,r){const{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return bn(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,zk,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return Hl.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=a.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await wp(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return Hl.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){const i=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,r,s){return Hl.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}},zk=class extends As{};Ap.RunsPage=zk,Ap.Steps=Hk,Ap.RunStepsPage=Wk;let Wl=class extends gt{constructor(){super(...arguments),this.runs=new Ap(this._client),this.messages=new qk(this._client)}create(e={},t){return bn(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return Hl.createThreadAssistantStream(e,this._client.beta.threads,t)}};Wl.Runs=Ap,Wl.RunsPage=zk,Wl.Messages=qk,Wl.MessagesPage=Kk;const S8=async n=>{const e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};let Vk=class extends gt{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return bn(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,z_,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...r,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=i.response.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await wp(o);break;case"failed":case"completed":return a}}}async upload(e,t,r){const s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){const s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}},z_=class extends As{};Vk.VectorStoreFilesPage=z_;let L$=class extends gt{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return bn(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,z_,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=a.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await wp(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,u=t.values(),l=[...r];async function d(f){for(let p of f){const m=await o.files.create({file:p,purpose:"assistants"},s);l.push(m.id)}}const h=Array(a).fill(u).map(d);return await S8(h),await this.createAndPoll(e,{file_ids:l})}},zl=class extends gt{constructor(){super(...arguments),this.files=new Vk(this._client),this.fileBatches=new L$(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return bn(e)?this.list({},e):this._client.getAPIList("/vector_stores",Gk,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}},Gk=class extends As{};zl.VectorStoresPage=Gk,zl.Files=Vk,zl.VectorStoreFilesPage=z_,zl.FileBatches=L$;let Qa=class extends gt{constructor(){super(...arguments),this.realtime=new Bk(this._client),this.vectorStores=new zl(this._client),this.chat=new Dk(this._client),this.assistants=new kk(this._client),this.threads=new Wl(this._client)}};Qa.Realtime=Bk,Qa.VectorStores=zl,Qa.VectorStoresPage=Gk,Qa.Assistants=kk,Qa.AssistantsPage=Ck,Qa.Threads=Wl;let F$=class extends gt{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}},D$=class extends gt{create(e,t){return this._client.post("/embeddings",{body:e,...t})}},Zk=class extends gt{create(e,t){return this._client.post("/files",Ll({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return bn(e)?this.list({},e):this._client.getAPIList("/files",Jk,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await wp(t),a=await this.retrieve(e),Date.now()-i>r)throw new A_({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}},Jk=class extends As{};Zk.FileObjectsPage=Jk;let Xk=class extends gt{list(e,t={},r){return bn(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Yk,{query:t,...r})}},Yk=class extends As{};Xk.FineTuningJobCheckpointsPage=Yk;let Vl=class extends gt{constructor(){super(...arguments),this.checkpoints=new Xk(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return bn(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",Qk,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return bn(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,eC,{query:t,...r})}},Qk=class extends As{},eC=class extends As{};Vl.FineTuningJobsPage=Qk,Vl.FineTuningJobEventsPage=eC,Vl.Checkpoints=Xk,Vl.FineTuningJobCheckpointsPage=Yk;let Tp=class extends gt{constructor(){super(...arguments),this.jobs=new Vl(this._client)}};Tp.Jobs=Vl,Tp.FineTuningJobsPage=Qk,Tp.FineTuningJobEventsPage=eC;let B$=class extends gt{createVariation(e,t){return this._client.post("/images/variations",Ll({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Ll({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}},tC=class extends gt{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",rC,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}},rC=class extends c8{};tC.ModelsPage=rC;let U$=class extends gt{create(e,t){return this._client.post("/moderations",{body:e,...t})}},q$=class extends gt{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,Ll({body:t,...r}))}},nC=class extends gt{constructor(){super(...arguments),this.parts=new q$(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}};nC.Parts=q$;var K$;let st=class extends ZG{constructor({baseURL:e=R_("OPENAI_BASE_URL"),apiKey:t=R_("OPENAI_API_KEY"),organization:r=R_("OPENAI_ORG_ID")??null,project:s=R_("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new Je("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:r,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&a8())throw new Je(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new F$(this),this.chat=new Sk(this),this.embeddings=new D$(this),this.files=new Zk(this),this.images=new B$(this),this.audio=new bp(this),this.moderations=new U$(this),this.models=new tC(this),this.fineTuning=new Tp(this),this.beta=new Qa(this),this.batches=new xk(this),this.uploads=new nC(this),this._options=a,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return RG(e,{arrayFormat:"brackets"})}};K$=st,st.OpenAI=K$,st.DEFAULT_TIMEOUT=6e5,st.OpenAIError=Je,st.APIError=wn,st.APIConnectionError=P_,st.APIConnectionTimeoutError=A_,st.APIUserAbortError=is,st.NotFoundError=CN,st.ConflictError=PN,st.RateLimitError=TN,st.BadRequestError=xN,st.AuthenticationError=EN,st.InternalServerError=IN,st.PermissionDeniedError=kN,st.UnprocessableEntityError=AN,st.toFile=jN,st.fileFromPath=vN,st.Completions=F$,st.Chat=Sk,st.Embeddings=D$,st.Files=Zk,st.FileObjectsPage=Jk,st.Images=B$,st.Audio=bp,st.Moderations=U$,st.Models=tC,st.ModelsPage=rC,st.FineTuning=Tp,st.Beta=Qa,st.Batches=xk,st.BatchesPage=Ek,st.Uploads=nC;/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var x8=typeof window=="object"?window:{},He="0123456789abcdef".split(""),E8=[-2147483648,8388608,32768,128],Os=[24,16,8,0],vr=[];function Rs(n){n?(vr[0]=vr[16]=vr[1]=vr[2]=vr[3]=vr[4]=vr[5]=vr[6]=vr[7]=vr[8]=vr[9]=vr[10]=vr[11]=vr[12]=vr[13]=vr[14]=vr[15]=0,this.blocks=vr):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Rs.prototype.update=function(n){if(!this.finalized){var e=typeof n!="string";e&&n.constructor===x8.ArrayBuffer&&(n=new Uint8Array(n));for(var t,r=0,s,i=n.length||0,a=this.blocks;r<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(s=this.start;r<i&&s<64;++r)a[s>>2]|=n[r]<<Os[s++&3];else for(s=this.start;r<i&&s<64;++r)t=n.charCodeAt(r),t<128?a[s>>2]|=t<<Os[s++&3]:t<2048?(a[s>>2]|=(192|t>>6)<<Os[s++&3],a[s>>2]|=(128|t&63)<<Os[s++&3]):t<55296||t>=57344?(a[s>>2]|=(224|t>>12)<<Os[s++&3],a[s>>2]|=(128|t>>6&63)<<Os[s++&3],a[s>>2]|=(128|t&63)<<Os[s++&3]):(t=65536+((t&1023)<<10|n.charCodeAt(++r)&1023),a[s>>2]|=(240|t>>18)<<Os[s++&3],a[s>>2]|=(128|t>>12&63)<<Os[s++&3],a[s>>2]|=(128|t>>6&63)<<Os[s++&3],a[s>>2]|=(128|t&63)<<Os[s++&3]);this.lastByteIndex=s,this.bytes+=s-this.start,s>=64?(this.block=a[16],this.start=s-64,this.hash(),this.hashed=!0):this.start=s}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Rs.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>2]|=E8[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}},Rs.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4,i,a,o,u=this.blocks;for(a=16;a<80;++a)o=u[a-3]^u[a-8]^u[a-14]^u[a-16],u[a]=o<<1|o>>>31;for(a=0;a<20;a+=5)i=e&t|~e&r,o=n<<5|n>>>27,s=o+i+s+1518500249+u[a]<<0,e=e<<30|e>>>2,i=n&e|~n&t,o=s<<5|s>>>27,r=o+i+r+1518500249+u[a+1]<<0,n=n<<30|n>>>2,i=s&n|~s&e,o=r<<5|r>>>27,t=o+i+t+1518500249+u[a+2]<<0,s=s<<30|s>>>2,i=r&s|~r&n,o=t<<5|t>>>27,e=o+i+e+1518500249+u[a+3]<<0,r=r<<30|r>>>2,i=t&r|~t&s,o=e<<5|e>>>27,n=o+i+n+1518500249+u[a+4]<<0,t=t<<30|t>>>2;for(;a<40;a+=5)i=e^t^r,o=n<<5|n>>>27,s=o+i+s+1859775393+u[a]<<0,e=e<<30|e>>>2,i=n^e^t,o=s<<5|s>>>27,r=o+i+r+1859775393+u[a+1]<<0,n=n<<30|n>>>2,i=s^n^e,o=r<<5|r>>>27,t=o+i+t+1859775393+u[a+2]<<0,s=s<<30|s>>>2,i=r^s^n,o=t<<5|t>>>27,e=o+i+e+1859775393+u[a+3]<<0,r=r<<30|r>>>2,i=t^r^s,o=e<<5|e>>>27,n=o+i+n+1859775393+u[a+4]<<0,t=t<<30|t>>>2;for(;a<60;a+=5)i=e&t|e&r|t&r,o=n<<5|n>>>27,s=o+i+s-1894007588+u[a]<<0,e=e<<30|e>>>2,i=n&e|n&t|e&t,o=s<<5|s>>>27,r=o+i+r-1894007588+u[a+1]<<0,n=n<<30|n>>>2,i=s&n|s&e|n&e,o=r<<5|r>>>27,t=o+i+t-1894007588+u[a+2]<<0,s=s<<30|s>>>2,i=r&s|r&n|s&n,o=t<<5|t>>>27,e=o+i+e-1894007588+u[a+3]<<0,r=r<<30|r>>>2,i=t&r|t&s|r&s,o=e<<5|e>>>27,n=o+i+n-1894007588+u[a+4]<<0,t=t<<30|t>>>2;for(;a<80;a+=5)i=e^t^r,o=n<<5|n>>>27,s=o+i+s-899497514+u[a]<<0,e=e<<30|e>>>2,i=n^e^t,o=s<<5|s>>>27,r=o+i+r-899497514+u[a+1]<<0,n=n<<30|n>>>2,i=s^n^e,o=r<<5|r>>>27,t=o+i+t-899497514+u[a+2]<<0,s=s<<30|s>>>2,i=r^s^n,o=t<<5|t>>>27,e=o+i+e-899497514+u[a+3]<<0,r=r<<30|r>>>2,i=t^r^s,o=e<<5|e>>>27,n=o+i+n-899497514+u[a+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+s<<0},Rs.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4;return He[n>>28&15]+He[n>>24&15]+He[n>>20&15]+He[n>>16&15]+He[n>>12&15]+He[n>>8&15]+He[n>>4&15]+He[n&15]+He[e>>28&15]+He[e>>24&15]+He[e>>20&15]+He[e>>16&15]+He[e>>12&15]+He[e>>8&15]+He[e>>4&15]+He[e&15]+He[t>>28&15]+He[t>>24&15]+He[t>>20&15]+He[t>>16&15]+He[t>>12&15]+He[t>>8&15]+He[t>>4&15]+He[t&15]+He[r>>28&15]+He[r>>24&15]+He[r>>20&15]+He[r>>16&15]+He[r>>12&15]+He[r>>8&15]+He[r>>4&15]+He[r&15]+He[s>>28&15]+He[s>>24&15]+He[s>>20&15]+He[s>>16&15]+He[s>>12&15]+He[s>>8&15]+He[s>>4&15]+He[s&15]},Rs.prototype.toString=Rs.prototype.hex,Rs.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,s=this.h4;return[n>>24&255,n>>16&255,n>>8&255,n&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,s>>24&255,s>>16&255,s>>8&255,s&255]},Rs.prototype.array=Rs.prototype.digest,Rs.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(20),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),n};const k8=n=>new Rs(!0).update(n).hex(),H$=(...n)=>k8(n.join("_"));class C8{}const P8=new Map;class sC extends C8{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(H$(e,t))??null)}async update(e,t,r){this.cache.set(H$(e,t),r)}static global(){return new sC(P8)}}var Ip={},W$;function A8(){if(W$)return Ip;W$=1,Ip.byteLength=o,Ip.toByteArray=l,Ip.fromByteArray=f;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,i=r.length;s<i;++s)n[s]=r[s],e[r.charCodeAt(s)]=s;e[45]=62,e[95]=63;function a(p){var m=p.length;if(m%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var g=p.indexOf("=");g===-1&&(g=m);var y=g===m?0:4-g%4;return[g,y]}function o(p){var m=a(p),g=m[0],y=m[1];return(g+y)*3/4-y}function u(p,m,g){return(m+g)*3/4-g}function l(p){var m,g=a(p),y=g[0],w=g[1],S=new t(u(p,y,w)),_=0,v=w>0?y-4:y,A;for(A=0;A<v;A+=4)m=e[p.charCodeAt(A)]<<18|e[p.charCodeAt(A+1)]<<12|e[p.charCodeAt(A+2)]<<6|e[p.charCodeAt(A+3)],S[_++]=m>>16&255,S[_++]=m>>8&255,S[_++]=m&255;return w===2&&(m=e[p.charCodeAt(A)]<<2|e[p.charCodeAt(A+1)]>>4,S[_++]=m&255),w===1&&(m=e[p.charCodeAt(A)]<<10|e[p.charCodeAt(A+1)]<<4|e[p.charCodeAt(A+2)]>>2,S[_++]=m>>8&255,S[_++]=m&255),S}function d(p){return n[p>>18&63]+n[p>>12&63]+n[p>>6&63]+n[p&63]}function h(p,m,g){for(var y,w=[],S=m;S<g;S+=3)y=(p[S]<<16&16711680)+(p[S+1]<<8&65280)+(p[S+2]&255),w.push(d(y));return w.join("")}function f(p){for(var m,g=p.length,y=g%3,w=[],S=16383,_=0,v=g-y;_<v;_+=S)w.push(h(p,_,_+S>v?v:_+S));return y===1?(m=p[g-1],w.push(n[m>>2]+n[m<<4&63]+"==")):y===2&&(m=(p[g-2]<<8)+p[g-1],w.push(n[m>>10]+n[m>>4&63]+n[m<<2&63]+"=")),w.join("")}return Ip}var T8=A8();const I8=Ve(T8);var O8=Object.defineProperty,R8=(n,e,t)=>e in n?O8(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,M8=(n,e,t)=>(R8(n,e+"",t),t);function N8(n,e){let t=Array.from({length:n.length},(r,s)=>({start:s,end:s+1}));for(;t.length>1;){let r=null;for(let s=0;s<t.length-1;s++){const i=n.slice(t[s].start,t[s+1].end),a=e.get(i.join(","));a!=null&&(r==null||a<r[0])&&(r=[a,s])}if(r!=null){const s=r[1];t[s]={start:t[s].start,end:t[s+1].end},t.splice(s+1,1)}else break}return t}function $8(n,e){return n.length===1?[e.get(n.join(","))]:N8(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function j8(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var iC=class{constructor(n,e){Z(this,"specialTokens");Z(this,"inverseSpecialTokens");Z(this,"patStr");Z(this,"textEncoder",new TextEncoder);Z(this,"textDecoder",new TextDecoder("utf-8"));Z(this,"rankMap",new Map);Z(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,s)=>{const[i,a,...o]=s.split(" "),u=Number.parseInt(a,10);return o.forEach((l,d)=>r[l]=u+d),r},{});for(const[r,s]of Object.entries(t)){const i=I8.toByteArray(r);this.rankMap.set(i.join(","),s),this.textMap.set(s,i)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[s,i])=>(r[i]=this.textEncoder.encode(s),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),s=iC.specialTokenRegex(Object.keys(this.specialTokens)),i=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(l=>!a.has(l)):t);if(o.size>0){const l=iC.specialTokenRegex([...o]),d=n.match(l);if(d!=null)throw new Error(`The text contains a special token that is not allowed: ${d[0]}`)}let u=0;for(;;){let l=null,d=u;for(;s.lastIndex=d,l=s.exec(n),!(l==null||a.has(l[0]));)d=l.index+1;const h=(l==null?void 0:l.index)??n.length;for(const p of n.substring(u,h).matchAll(r)){const m=this.textEncoder.encode(p[0]),g=this.rankMap.get(m.join(","));if(g!=null){i.push(g);continue}i.push(...$8(m,this.rankMap))}if(l==null)break;let f=this.specialTokens[l[0]];i.push(f),u=l.index+l[0].length}return i}decode(n){const e=[];let t=0;for(let i=0;i<n.length;++i){const a=n[i],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let s=0;for(const i of e)r.set(i,s),s+=i.length;return this.textDecoder.decode(r)}},z$=iC;M8(z$,"specialTokenRegex",n=>new RegExp(n.map(e=>j8(e)).join("|"),"g"));function L8(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-preview":case"o1-preview-2024-09-12":case"o1-mini-2024-09-12":case"o3-mini":case"o3-mini-2025-01-31":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":return"o200k_base";default:throw new Error("Unknown model")}}const V_={},F8=new ZE({});async function D8(n){return n in V_||(V_[n]=F8.fetch(`https://tiktoken.pages.dev/js/${n}.json`).then(e=>e.json()).then(e=>new z$(e)).catch(e=>{throw delete V_[n],e})),await V_[n]}async function B8(n){return D8(L8(n))}const U8=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n.startsWith("gpt-4o")?"gpt-4o":n;function Op(n){return typeof n!="object"||!n?!1:!!("type"in n&&n.type==="function"&&"function"in n&&typeof n.function=="object"&&n.function&&"name"in n.function&&"parameters"in n.function)}const q8=()=>!1;class K8 extends ir{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??q8(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class H8 extends K8{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){const{cache:s,...i}=r;super({callbacks:e??t,...i}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof s=="object"?this.cache=s:s?this.cache=sC.global():this.cache=void 0,this.caller=new ZE(r??{})}async getNumTokens(e){if(typeof e!="string")return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await B8("modelName"in this?U8(this.modelName):"gpt2")}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(r){console.warn("Failed to calculate number of tokens, falling back to approximate count",r)}return t}static _convertInputToPromptValue(e){return typeof e=="string"?new rN(e):Array.isArray(e)?new FV(e.map(Yf)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const r={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([a,o])=>o!==void 0).map(([a,o])=>`${a}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class as extends ir{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const r=bt(t);return this.func&&await this.func(e,r),this._callWithConfig(s=>Promise.resolve(s),e,r)}async*transform(e,t){const r=bt(t);let s,i=!0;for await(const a of this._transformStreamWithConfig(e,o=>o,r))if(yield a,i)if(s===void 0)s=a;else try{s=ss(s,a)}catch{s=void 0,i=!1}this.func&&s!==void 0&&await this.func(s,r)}static assign(e){return new JM(new Il({steps:e}))}}function Rp(n){return typeof(n==null?void 0:n.parse)=="function"}class os extends H8{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(e,t){const r=os._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){var r;if(this._streamResponseChunks===os.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{const i=os._convertInputToPromptValue(e).toChatMessages(),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(t),u={...a.metadata,...this.getLsParams(o)},l=await mn.configure(a.callbacks,this.callbacks,a.tags,this.tags,u,this.metadata,{verbose:this.verbose}),d={options:o,invocation_params:this==null?void 0:this.invocationParams(o),batch_size:1},h=await(l==null?void 0:l.handleChatModelStart(this.toJSON(),[i],a.runId,void 0,d,void 0,void 0,a.runName));let f,p;try{for await(const m of this._streamResponseChunks(i,o,h==null?void 0:h[0])){if(m.message.id==null){const g=(r=h==null?void 0:h.at(0))==null?void 0:r.runId;g!=null&&m.message._updateId(`run-${g}`)}m.message.response_metadata={...m.generationInfo,...m.message.response_metadata},yield m.message,f?f=f.concat(m):f=m,eR(m.message)&&m.message.usage_metadata!==void 0&&(p={tokenUsage:{promptTokens:m.message.usage_metadata.input_tokens,completionTokens:m.message.usage_metadata.output_tokens,totalTokens:m.message.usage_metadata.total_tokens}})}}catch(m){throw await Promise.all((h??[]).map(g=>g==null?void 0:g.handleLLMError(m))),m}await Promise.all((h??[]).map(m=>m==null?void 0:m.handleLLMEnd({generations:[[f]],llmOutput:p})))}}getLsParams(e){const t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,r,s){var h,f;const i=e.map(p=>p.map(Yf));let a;if(s!==void 0&&s.length===i.length)a=s;else{const p={...r.metadata,...this.getLsParams(t)},m=await mn.configure(r.callbacks,this.callbacks,r.tags,this.tags,p,this.metadata,{verbose:this.verbose}),g={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1};a=await(m==null?void 0:m.handleChatModelStart(this.toJSON(),i,r.runId,void 0,g,void 0,void 0,r.runName))}const o=[],u=[];if(!!(a!=null&&a[0].handlers.find(zW))&&!this.disableStreaming&&i.length===1&&this._streamResponseChunks!==os.prototype._streamResponseChunks)try{const p=await this._streamResponseChunks(i[0],t,a==null?void 0:a[0]);let m,g;for await(const y of p){if(y.message.id==null){const w=(h=a==null?void 0:a.at(0))==null?void 0:h.runId;w!=null&&y.message._updateId(`run-${w}`)}m===void 0?m=y:m=ss(m,y),eR(y.message)&&y.message.usage_metadata!==void 0&&(g={tokenUsage:{promptTokens:y.message.usage_metadata.input_tokens,completionTokens:y.message.usage_metadata.output_tokens,totalTokens:y.message.usage_metadata.total_tokens}})}if(m===void 0)throw new Error("Received empty response from chat model call.");o.push([m]),await(a==null?void 0:a[0].handleLLMEnd({generations:o,llmOutput:g}))}catch(p){throw await(a==null?void 0:a[0].handleLLMError(p)),p}else{const p=await Promise.allSettled(i.map((m,g)=>this._generate(m,{...t,promptIndex:g},a==null?void 0:a[g])));await Promise.all(p.map(async(m,g)=>{var y,w,S;if(m.status==="fulfilled"){const _=m.value;for(const v of _.generations){if(v.message.id==null){const A=(y=a==null?void 0:a.at(0))==null?void 0:y.runId;A!=null&&v.message._updateId(`run-${A}`)}v.message.response_metadata={...v.generationInfo,...v.message.response_metadata}}return _.generations.length===1&&(_.generations[0].message.response_metadata={..._.llmOutput,..._.generations[0].message.response_metadata}),o[g]=_.generations,u[g]=_.llmOutput,(w=a==null?void 0:a[g])==null?void 0:w.handleLLMEnd({generations:[_.generations],llmOutput:_.llmOutput})}else return await((S=a==null?void 0:a[g])==null?void 0:S.handleLLMError(m.reason)),Promise.reject(m.reason)}))}const d={generations:o,llmOutput:u.length?(f=this._combineLLMOutput)==null?void 0:f.call(this,...u):void 0};return Object.defineProperty(d,LM,{value:a?{runIds:a==null?void 0:a.map(p=>p.runId)}:void 0,configurable:!0}),d}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:s,handledOptions:i}){const a=e.map(y=>y.map(Yf)),o={...i.metadata,...this.getLsParams(s)},u=await mn.configure(i.callbacks,this.callbacks,i.tags,this.tags,o,this.metadata,{verbose:this.verbose}),l={options:s,invocation_params:this==null?void 0:this.invocationParams(s),batch_size:1},d=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),a,i.runId,void 0,l,void 0,void 0,i.runName)),h=[],p=(await Promise.allSettled(a.map(async(y,w)=>{const S=os._convertInputToPromptValue(y).toString(),_=await t.lookup(S,r);return _==null&&h.push(w),_}))).map((y,w)=>({result:y,runManager:d==null?void 0:d[w]})).filter(({result:y})=>y.status==="fulfilled"&&y.value!=null||y.status==="rejected"),m=[];await Promise.all(p.map(async({result:y,runManager:w},S)=>{if(y.status==="fulfilled"){const _=y.value;return m[S]=_.map(v=>("message"in v&&Gf(v.message)&&pc(v.message)&&(v.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),v.generationInfo={...v.generationInfo,tokenUsage:{}},v)),_.length&&await(w==null?void 0:w.handleLLMNewToken(_[0].text)),w==null?void 0:w.handleLLMEnd({generations:[_]},void 0,void 0,void 0,{cached:!0})}else return await(w==null?void 0:w.handleLLMError(y.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(y.reason)}));const g={generations:m,missingPromptIndices:h,startedRunManagers:d};return Object.defineProperty(g,LM,{value:d?{runIds:d==null?void 0:d.map(y=>y.runId)}:void 0,configurable:!0}),g}async generate(e,t,r){let s;Array.isArray(t)?s={stop:t}:s=t;const i=e.map(m=>m.map(Yf)),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(s);if(a.callbacks=a.callbacks??r,!this.cache)return this._generateUncached(i,o,a);const{cache:u}=this,l=this._getSerializedCacheKeyParametersForCall(o),{generations:d,missingPromptIndices:h,startedRunManagers:f}=await this._generateCached({messages:i,cache:u,llmStringKey:l,parsedOptions:o,handledOptions:a});let p={};if(h.length>0){const m=await this._generateUncached(h.map(g=>i[g]),o,a,f!==void 0?h.map(g=>f==null?void 0:f[g]):void 0);await Promise.all(m.generations.map(async(g,y)=>{const w=h[y];d[w]=g;const S=os._convertInputToPromptValue(i[w]).toString();return u.update(S,l,g)})),p=m.llmOutput??{}}return{generations:d,llmOutput:p}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){const s=e.map(i=>i.toChatMessages());return this.generate(s,t,r)}async call(e,t,r){return(await this.generate([e.map(Yf)],t,r)).generations[0][0].message}async callPrompt(e,t,r){const s=e.toChatMessages();return this.call(s,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const s=new Bt(e),i=await this.call([s],t,r);if(typeof i.content!="string")throw new Error("Cannot use predict when output is not a string.");return i.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t!=null&&t.strict)throw new Error('"strict" mode is not supported for this model by default.');const r=e,s=t==null?void 0:t.name,i=r.description??"A function available to call.",a=t==null?void 0:t.method,o=t==null?void 0:t.includeRaw;if(a==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=s??"extract",l;Rp(r)?l=[{type:"function",function:{name:u,description:i,parameters:Zi(r)}}]:("name"in r&&(u=r.name),l=[{type:"function",function:{name:u,description:i,parameters:r}}]);const d=this.bindTools(l),h=hp.from(g=>{if(!g.tool_calls||g.tool_calls.length===0)throw new Error("No tool calls found in the response.");const y=g.tool_calls.find(w=>w.name===u);if(!y)throw new Error(`No tool call found with name ${u}.`);return y.args});if(!o)return d.pipe(h).withConfig({runName:"StructuredOutput"});const f=as.assign({parsed:(g,y)=>h.invoke(g.raw,y)}),p=as.assign({parsed:()=>null}),m=f.withFallbacks({fallbacks:[p]});return Fn.from([{raw:d},m]).withConfig({runName:"StructuredOutputRunnable"})}}class aC extends ir{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(r,s)=>this.parseResult([{text:r}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(r,s)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],s==null?void 0:s.callbacks),e,{...t,runType:"parser"})}}class V$ extends aC{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class Gl extends Error{constructor(e,t,r,s=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=r,this.sendToLLM=s,s&&(r===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");Cx(this,"OUTPUT_PARSING_FAILURE")}}function oC(n,e){const t=typeof n;if(t!==typeof e)return!1;if(Array.isArray(n)){if(!Array.isArray(e))return!1;const r=n.length;if(r!==e.length)return!1;for(let s=0;s<r;s++)if(!oC(n[s],e[s]))return!1;return!0}if(t==="object"){if(!n||!e)return n===e;const r=Object.keys(n),s=Object.keys(e);if(r.length!==s.length)return!1;for(const a of r)if(!oC(n[a],e[a]))return!1;return!0}return n===e}class W8 extends V${async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class G$ extends W8{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,r;for await(const s of e){if(typeof s!="string"&&typeof s.content!="string")throw new Error("Cannot handle non-string output.");let i;if(a6(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new Ln({message:s,text:s.content})}else if(Gf(s)){if(typeof s.content!="string")throw new Error("Cannot handle non-string message output.");i=new Ln({message:d6(s),text:s.content})}else i=new Tl({text:s});r===void 0?r=i:r=r.concat(i);const a=await this.parsePartialResult([r]);a!=null&&!oC(a,t)&&(this.diff?yield this._diff(t,a):yield a,t=a)}}getFormatInstructions(){return""}}class Mp extends V${static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=pe.object(Object.fromEntries(Object.entries(e).map(([r,s])=>[r,pe.string().describe(s)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(Zi(this.schema))}
\`\`\`
`}async parse(e){try{const r=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(s,i)=>`"${i.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await this.schema.parseAsync(JSON.parse(r))}catch(t){throw new Gl(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class Np extends G${constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?FW(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return ZO(e[0].text)}async parse(e){return ZO(e,JSON.parse)}getFormatInstructions(){return""}}function cC(n,e){if(n.function===void 0)return;let t;if(e!=null&&e.partial)try{t=Ex(n.function.arguments??"{}")}catch{return}else try{t=JSON.parse(n.function.arguments)}catch(s){throw new Gl([`Function "${n.function.name}" arguments:`,"",n.function.arguments,"","are not valid JSON.",`Error: ${s.message}`].join(`
`))}const r={name:n.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(r.id=n.id),r}function Z$(n){if(n.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:n.id,type:"function",function:{name:n.name,arguments:JSON.stringify(n.args)}}}function J$(n,e){var t,r;return{name:(t=n.function)==null?void 0:t.name,args:(r=n.function)==null?void 0:r.arguments,id:n.id,error:e,type:"invalid_tool_call"}}class z8 extends G${static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var a;const r=e[0].message;let s;if(pc(r)&&((a=r.tool_calls)!=null&&a.length)?s=r.tool_calls.map(o=>{const{id:u,...l}=o;return this.returnId?{id:u,...l}:l}):r.additional_kwargs.tool_calls!==void 0&&(s=JSON.parse(JSON.stringify(r.additional_kwargs.tool_calls)).map(u=>cC(u,{returnId:this.returnId,partial:t}))),!s)return[];const i=[];for(const o of s)if(o!==void 0){const u={type:o.name,args:o.args,id:o.id};i.push(u)}return i}}class G_ extends z8{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new Gl(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const r=(await super.parsePartialResult(e)).filter(i=>i.type===this.keyName);let s=r;if(r.length)return this.returnId||(s=r.map(i=>i.args)),this.returnSingle?s[0]:s}async parseResult(e){const r=(await super.parsePartialResult(e,!1)).filter(a=>a.type===this.keyName);let s=r;return r.length?(this.returnId||(s=r.map(a=>a.args)),this.returnSingle?this._validateResult(s[0]):await Promise.all(s.map(a=>this._validateResult(a)))):void 0}}const V8=Symbol("Let zodToJsonSchema decide on which parser to use"),X$={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},G8=n=>typeof n=="string"?{...X$,basePath:["#"],definitions:{},name:n}:{...X$,basePath:["#"],definitions:{},...n},uC=n=>"_def"in n?n._def:n;function Z8(n){if(!n)return!0;for(const e in n)return!1;return!0}const J8=n=>{const e=G8(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[uC(s),{def:uC(s),path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function Y$(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function Et(n,e,t,r,s){n[e]=t,Y$(n,e,r,s)}function X8(){return{}}function Y8(n,e){var r,s;const t={type:"array"};return((s=(r=n.type)==null?void 0:r._def)==null?void 0:s.typeName)!==Y.ZodAny&&(t.items=ht(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&Et(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&Et(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(Et(t,"minItems",n.exactLength.value,n.exactLength.message,e),Et(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Q8(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Et(t,"minimum",r.value,r.message,e):Et(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Et(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Et(t,"maximum",r.value,r.message,e):Et(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Et(t,"maximum",r.value,r.message,e));break;case"multipleOf":Et(t,"multipleOf",r.value,r.message,e);break}return t}function eZ(){return{type:"boolean"}}function tZ(n,e){return ht(n.type._def,e)}const rZ=(n,e)=>ht(n.innerType._def,e);function Q$(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,i)=>Q$(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return nZ(n,e)}}const nZ=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":Et(t,"minimum",r.value,r.message,e);break;case"max":Et(t,"maximum",r.value,r.message,e);break}return t};function sZ(n,e){return{...ht(n.innerType._def,e),default:n.defaultValue()}}function iZ(n,e,t){return e.effectStrategy==="input"?ht(n.schema._def,e,t):{}}function aZ(n){return{type:"string",enum:[...n.values]}}const oZ=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function cZ(n,e){const t=[ht(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),ht(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(oZ(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...u}=i;a=u}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function uZ(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let lC;const vc={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(lC===void 0&&(lC=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),lC),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function ej(n,e){const t={type:"string"};function r(s){return e.patternStrategy==="escape"?lZ(s):s}if(n.checks)for(const s of n.checks)switch(s.kind){case"min":Et(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":Et(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Ms(t,"email",s.message,e);break;case"format:idn-email":Ms(t,"idn-email",s.message,e);break;case"pattern:zod":Ns(t,vc.email,s.message,e);break}break;case"url":Ms(t,"uri",s.message,e);break;case"uuid":Ms(t,"uuid",s.message,e);break;case"regex":Ns(t,s.regex,s.message,e);break;case"cuid":Ns(t,vc.cuid,s.message,e);break;case"cuid2":Ns(t,vc.cuid2,s.message,e);break;case"startsWith":Ns(t,RegExp(`^${r(s.value)}`),s.message,e);break;case"endsWith":Ns(t,RegExp(`${r(s.value)}$`),s.message,e);break;case"datetime":Ms(t,"date-time",s.message,e);break;case"date":Ms(t,"date",s.message,e);break;case"time":Ms(t,"time",s.message,e);break;case"duration":Ms(t,"duration",s.message,e);break;case"length":Et(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),Et(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{Ns(t,RegExp(r(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&Ms(t,"ipv4",s.message,e),s.version!=="v4"&&Ms(t,"ipv6",s.message,e);break}case"emoji":Ns(t,vc.emoji,s.message,e);break;case"ulid":{Ns(t,vc.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Ms(t,"binary",s.message,e);break}case"contentEncoding:base64":{Et(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{Ns(t,vc.base64,s.message,e);break}}break}case"nanoid":Ns(t,vc.nanoid,s.message,e)}return t}const lZ=n=>Array.from(n).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Ms=(n,e,t,r)=>{var s;n.format||(s=n.anyOf)!=null&&s.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):Et(n,"format",e,t,r)},Ns=(n,e,t,r)=>{var s;n.pattern||(s=n.allOf)!=null&&s.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:tj(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):Et(n,"pattern",tj(e,r),t,r)},tj=(n,e)=>{var l;const t=typeof n=="function"?n():n;if(!e.applyRegexFlags||!t.flags)return t.source;const r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=r.i?t.source.toLowerCase():t.source;let i="",a=!1,o=!1,u=!1;for(let d=0;d<s.length;d++){if(a){i+=s[d],a=!1;continue}if(r.i){if(o){if(s[d].match(/[a-z]/)){u?(i+=s[d],i+=`${s[d-2]}-${s[d]}`.toUpperCase(),u=!1):s[d+1]==="-"&&((l=s[d+2])!=null&&l.match(/[a-z]/))?(i+=s[d],u=!0):i+=`${s[d]}${s[d].toUpperCase()}`;continue}}else if(s[d].match(/[a-z]/)){i+=`[${s[d]}${s[d].toUpperCase()}]`;continue}}if(r.m){if(s[d]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(s[d]==="$"){i+=`($|(?=[\r
]))`;continue}}if(r.s&&s[d]==="."){i+=o?`${s[d]}\r
`:`[${s[d]}\r
]`;continue}i+=s[d],s[d]==="\\"?a=!0:o&&s[d]==="]"?o=!1:!o&&s[d]==="["&&(o=!0)}try{const d=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i};function rj(n,e){var r,s,i,a;if(e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===Y.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((o,u)=>({...o,[u]:ht(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",u]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:ht(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((s=n.keyType)==null?void 0:s._def.typeName)===Y.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const o=Object.entries(ej(n.keyType._def,e)).reduce((u,[l,d])=>l==="type"?u:{...u,[l]:d},{});return{...t,propertyNames:o}}else if(((a=n.keyType)==null?void 0:a._def.typeName)===Y.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};return t}function dZ(n,e){if(e.mapStrategy==="record")return rj(n,e);const t=ht(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=ht(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function hZ(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function fZ(){return{not:{}}}function pZ(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Z_={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function mZ(n,e){if(e.target==="openApi3")return nj(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in Z_&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((s,i)=>{const a=Z_[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return nj(n,e)}const nj=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>ht(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function gZ(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:Z_[n.innerType._def.typeName],nullable:!0}:{type:[Z_[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=ht(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=ht(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function yZ(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",Y$(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Et(t,"minimum",r.value,r.message,e):Et(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Et(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Et(t,"maximum",r.value,r.message,e):Et(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Et(t,"maximum",r.value,r.message,e));break;case"multipleOf":Et(t,"multipleOf",r.value,r.message,e);break}return t}function wZ(n,e){return e.removeAdditionalStrategy==="strict"?n.catchall._def.typeName==="ZodNever"?n.unknownKeys!=="strict":ht(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":ht(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function bZ(n,e){const t={type:"object",...Object.entries(n.shape()).reduce((r,[s,i])=>{if(i===void 0||i._def===void 0)return r;const a=ht(i._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return a===void 0?r:{properties:{...r.properties,[s]:a},required:i.isOptional()&&!e.openaiStrictMode?r.required:[...r.required,s]}},{properties:{},required:[]}),additionalProperties:wZ(n,e)};return t.required.length||delete t.required,t}const _Z=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return ht(n.innerType._def,e);const t=ht(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},vZ=(n,e)=>{if(e.pipeStrategy==="input")return ht(n.in._def,e);if(e.pipeStrategy==="output")return ht(n.out._def,e);const t=ht(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=ht(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}};function SZ(n,e){return ht(n.type._def,e)}function xZ(n,e){const r={type:"array",uniqueItems:!0,items:ht(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&Et(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&Et(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function EZ(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>ht(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:ht(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>ht(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function kZ(){return{not:{}}}function CZ(){return{}}const PZ=(n,e)=>ht(n.innerType._def,e);function ht(n,e,t=!1){var a;const r=e.seen.get(n);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,n,e,r,t);if(o!==V8)return o}if(r&&!t){const o=AZ(r,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);const i=IZ(n,n.typeName,e,t);return i&&OZ(n,e,i),s.jsonSchema=i,i}const AZ=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"extract-to-root":const t=n.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=n.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:TZ(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((r,s)=>e.currentPath[s]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},TZ=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},IZ=(n,e,t,r)=>{switch(e){case Y.ZodString:return ej(n,t);case Y.ZodNumber:return yZ(n,t);case Y.ZodObject:return bZ(n,t);case Y.ZodBigInt:return Q8(n,t);case Y.ZodBoolean:return eZ();case Y.ZodDate:return Q$(n,t);case Y.ZodUndefined:return kZ();case Y.ZodNull:return pZ(t);case Y.ZodArray:return Y8(n,t);case Y.ZodUnion:case Y.ZodDiscriminatedUnion:return mZ(n,t);case Y.ZodIntersection:return cZ(n,t);case Y.ZodTuple:return EZ(n,t);case Y.ZodRecord:return rj(n,t);case Y.ZodLiteral:return uZ(n,t);case Y.ZodEnum:return aZ(n);case Y.ZodNativeEnum:return hZ(n);case Y.ZodNullable:return gZ(n,t);case Y.ZodOptional:return _Z(n,t);case Y.ZodMap:return dZ(n,t);case Y.ZodSet:return xZ(n,t);case Y.ZodLazy:return ht(n.getter()._def,t);case Y.ZodPromise:return SZ(n,t);case Y.ZodNaN:case Y.ZodNever:return fZ();case Y.ZodEffects:return iZ(n,t,r);case Y.ZodAny:return X8();case Y.ZodUnknown:return CZ();case Y.ZodDefault:return sZ(n,t);case Y.ZodBranded:return tZ(n,t);case Y.ZodReadonly:return PZ(n,t);case Y.ZodCatch:return rZ(n,t);case Y.ZodPipeline:return vZ(n,t);case Y.ZodFunction:case Y.ZodVoid:case Y.ZodSymbol:return;default:return(s=>{})()}},OZ=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),RZ=(n,e)=>{const t=J8(e),r=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=ht(n._def,r===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,r]},!1)??{},i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i);const a=(()=>{if(Z8(t.definitions))return;const u={},l=new Set;for(let d=0;d<500;d++){const h=Object.entries(t.definitions).filter(([f])=>!l.has(f));if(h.length===0)break;for(const[f,p]of h)u[f]=ht(uC(p),{...t,currentPath:[...t.basePath,t.definitionPath,f]},!0)??{},l.add(f)}return u})(),o=r===void 0?a?{...s,[t.definitionPath]:a}:s:t.nameStrategy==="duplicate-ref"?{...s,...a||t.seenRefs.size?{[t.definitionPath]:{...a,...t.seenRefs.size?{[r]:s}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,r].join("/"),[t.definitionPath]:{...a,[r]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function sj(n,e){return RZ(n,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function MZ(n,e,t){return u8({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:sj(n,{name:e})}},r=>n.parse(JSON.parse(r)))}function NZ(n){return l8({type:"function",function:{name:n.name,parameters:sj(n.parameters,{name:n.name}),strict:!0,...n.description?{description:n.description}:void 0}},{callback:n.function,parser:e=>n.parameters.parse(JSON.parse(e))})}function $Z(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a,azureOpenAIEndpoint:o}=n;if((r||a)&&s&&e)return`${s}/${e}`;if((r||a)&&o&&e)return`${o}/openai/deployments/${e}`;if(r||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function dC(n,e){const t=typeof e=="number"?void 0:e;return{name:n.name,description:n.description,parameters:Zi(n.schema),...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}}function ij(n,e){let t;return Zl(n)?t={type:"function",function:dC(n)}:t=n,t}function jZ(n){return n!==void 0&&Array.isArray(n.lc_namespace)}function LZ(n){return n!==void 0&&ir.isRunnable(n)&&"lc_name"in n.constructor&&typeof n.constructor.lc_name=="function"&&n.constructor.lc_name()==="RunnableToolLike"}function FZ(n){return!!n&&typeof n=="object"&&"name"in n&&"schema"in n&&Rp(n.schema)}function Zl(n){return FZ(n)||LZ(n)||jZ(n)}function J_(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function aj(n){let e;return n.constructor.name===A_.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===is.name?(e=new Error(n.message),e.name="AbortError"):n.status===400&&n.message.includes("tool_calls")?e=J_(n,"INVALID_TOOL_RESULTS"):n.status===401?e=J_(n,"MODEL_AUTHENTICATION"):n.status===429?e=J_(n,"MODEL_RATE_LIMIT"):n.status===404?e=J_(n,"MODEL_NOT_FOUND"):e=n,e}function DZ(n){if(n)return n==="any"||n==="required"?"required":n==="auto"?"auto":n==="none"?"none":typeof n=="string"?{type:"function",function:{name:n}}:n}function BZ(n){return n.anyOf!==void 0&&Array.isArray(n.anyOf)}function UZ(n){const e=["namespace functions {",""];for(const t of n)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(oj(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function oj(n,e){var r;const t=[];for(const[s,i]of Object.entries(n.properties??{}))i.description&&e<2&&t.push(`// ${i.description}`),(r=n.required)!=null&&r.includes(s)?t.push(`${s}: ${X_(i,e)},`):t.push(`${s}?: ${X_(i,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function X_(n,e){if(BZ(n))return n.anyOf.map(t=>X_(t,e)).join(" | ");switch(n.type){case"string":return n.enum?n.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",oj(n,e+2),"}"].join(`
`);case"array":return n.items?`${X_(n.items,e)}[]`:"any[]";default:return""}}function qZ(n,e){let t;if(Zl(n)){const r=NZ({name:n.name,parameters:n.schema,description:n.description});r.function.parameters?t={type:r.type,function:{name:r.function.name,description:r.function.description,parameters:r.function.parameters,...(e==null?void 0:e.strict)!==void 0?{strict:e.strict}:{}}}:t={type:"function",function:dC(n,e)}}else t=n;return(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function KZ(n){return n.role!=="system"&&n.role!=="developer"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&n.role!=="tool"&&console.warn(`Unknown message role: ${n.role}`),n.role}function cj(n){const e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Ha.isInstance(n))throw new Error("Invalid generic chat message");return KZ(n)}default:throw new Error(`Unknown message type: ${e}`)}}function uj(n,e){return n.flatMap(t=>{var i;let r=cj(t);r==="system"&&(e!=null&&e.startsWith("o1"))&&(r="developer");const s={role:r,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=null),pc(t)&&((i=t.tool_calls)!=null&&i.length)?(s.tool_calls=t.tool_calls.map(Z$),s.content=null):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const a={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,a]}return s})}function lj(n,e){return Op(n)?(e==null?void 0:e.strict)!==void 0?{...n,function:{...n.function,strict:e.strict}}:n:qZ(n,e)}let HZ=class extends os{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}constructor(e){var t,r;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??Br("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??Br("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.maxTokens=e==null?void 0:e.maxTokens,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this==null?void 0:this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let r;return(t==null?void 0:t.strict)!==void 0?r=t.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>lj(s,{strict:r})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Y_(e.json_schema.schema)?MZ(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){var o;let r;(e==null?void 0:e.strict)!==void 0?r=e.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling);let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}});const i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:this.maxTokens===-1?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(u=>lj(u,{strict:r})):void 0,tool_choice:DZ(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(i.prediction=e.prediction);const a=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return a!==void 0&&(i.reasoning_effort=a),i}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const r=e.tool_calls;switch(e.role){case"assistant":{const s=[],i=[];for(const u of r??[])try{s.push(cC(u,{returnId:!0}))}catch(l){i.push(J$(u,l.message))}const a={function_call:e.function_call,tool_calls:r};this.__includeRawResponse!==void 0&&(a.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(a.audio=e.audio),new Dr({content:e.content||"",tool_calls:s,invalid_tool_calls:i,additional_kwargs:a,response_metadata:o,id:t.id})}default:return new Ha(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,r){var u,l;const s=e.role??r,i=e.content??"";let a;e.function_call?a={function_call:e.function_call}:e.tool_calls?a={tool_calls:e.tool_calls}:a={},this.__includeRawResponse&&(a.__raw_response=t),e.audio&&(a.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(s==="user")return new Xf({content:i,response_metadata:o});if(s==="assistant"){const d=[];if(Array.isArray(e.tool_calls))for(const h of e.tool_calls)d.push({name:(u=h.function)==null?void 0:u.name,args:(l=h.function)==null?void 0:l.arguments,id:h.id,index:h.index,type:"tool_call_chunk"});return new nr({content:i,tool_call_chunks:d,additional_kwargs:a,id:t.id,response_metadata:o})}else return s==="system"?new mc({content:i,response_metadata:o}):s==="developer"?new mc({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new Jf({content:i,additional_kwargs:a,name:e.name,response_metadata:o}):s==="tool"?new t_({content:i,additional_kwargs:a,tool_call_id:e.tool_call_id,response_metadata:o}):new Zf({content:i,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){var l,d,h,f,p,m,g,y,w,S;const s=uj(e,this.model),i={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let a;const o=await this.completionWithRetry(i,t);let u;for await(const _ of o){const v=(l=_==null?void 0:_.choices)==null?void 0:l[0];if(_.usage&&(u=_.usage),!v)continue;const{delta:A}=v;if(!A)continue;const k=this._convertOpenAIDeltaToBaseMessageChunk(A,_,a);a=A.role??a;const C={prompt:t.promptIndex??0,completion:v.index??0};if(typeof k.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const E={...C};v.finish_reason!=null&&(E.finish_reason=v.finish_reason,E.system_fingerprint=_.system_fingerprint,E.model_name=_.model),this.logprobs&&(E.logprobs=v.logprobs);const N=new Ln({message:k,text:k.content,generationInfo:E});yield N,await(r==null?void 0:r.handleLLMNewToken(N.text??"",C,void 0,void 0,void 0,{chunk:N}))}if(u){const _={...((d=u.prompt_tokens_details)==null?void 0:d.audio_tokens)!==null&&{audio:(h=u.prompt_tokens_details)==null?void 0:h.audio_tokens},...((f=u.prompt_tokens_details)==null?void 0:f.cached_tokens)!==null&&{cache_read:(p=u.prompt_tokens_details)==null?void 0:p.cached_tokens}},v={...((m=u.completion_tokens_details)==null?void 0:m.audio_tokens)!==null&&{audio:(g=u.completion_tokens_details)==null?void 0:g.audio_tokens},...((y=u.completion_tokens_details)==null?void 0:y.reasoning_tokens)!==null&&{reasoning:(w=u.completion_tokens_details)==null?void 0:w.reasoning_tokens}};yield new Ln({message:new nr({content:"",response_metadata:{usage:{...u}},usage_metadata:{input_tokens:u.prompt_tokens,output_tokens:u.completion_tokens,total_tokens:u.total_tokens,...Object.keys(_).length>0&&{input_token_details:_},...Object.keys(v).length>0&&{output_token_details:v}}}),text:""})}if((S=t.signal)!=null&&S.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){var o,u;const s={},i=this.invocationParams(t),a=uj(e,this.model);if(i.stream){const l=this._streamResponseChunks(e,t,r),d={};for await(const y of l){y.message.response_metadata={...y.generationInfo,...y.message.response_metadata};const w=((o=y.generationInfo)==null?void 0:o.completion)??0;d[w]===void 0?d[w]=y:d[w]=d[w].concat(y)}const h=Object.entries(d).sort(([y],[w])=>parseInt(y,10)-parseInt(w,10)).map(([y,w])=>w),{functions:f,function_call:p}=this.invocationParams(t),m=await this.getEstimatedTokenCountFromPrompt(e,f,p),g=await this.getNumTokensFromGenerations(h);return s.input_tokens=m,s.output_tokens=g,s.total_tokens=m+g,{generations:h,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let l;t.response_format&&t.response_format.type==="json_schema"?l=await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):l=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:d,prompt_tokens:h,total_tokens:f,prompt_tokens_details:p,completion_tokens_details:m}=(l==null?void 0:l.usage)??{};d&&(s.output_tokens=(s.output_tokens??0)+d),h&&(s.input_tokens=(s.input_tokens??0)+h),f&&(s.total_tokens=(s.total_tokens??0)+f),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.cached_tokens)!==null)&&(s.input_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.cached_tokens)!==null&&{cache_read:p==null?void 0:p.cached_tokens}}),((m==null?void 0:m.audio_tokens)!==null||(m==null?void 0:m.reasoning_tokens)!==null)&&(s.output_token_details={...(m==null?void 0:m.audio_tokens)!==null&&{audio:m==null?void 0:m.audio_tokens},...(m==null?void 0:m.reasoning_tokens)!==null&&{reasoning:m==null?void 0:m.reasoning_tokens}});const g=[];for(const y of(l==null?void 0:l.choices)??[]){const S={text:((u=y.message)==null?void 0:u.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(y.message??{role:"assistant"},l)};S.generationInfo={...y.finish_reason?{finish_reason:y.finish_reason}:{},...y.logprobs?{logprobs:y.logprobs}:{}},pc(S.message)&&(S.message.usage_metadata=s),S.message=new Dr(Object.fromEntries(Object.entries(S.message).filter(([_])=>!_.startsWith("lc_")))),g.push(S)}return{generations:g,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,r){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&r!=="auto"){const i=UZ(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),r==="none"?s+=1:typeof r=="object"&&(s+=await this.getNumTokens(r.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var s;return(s=r.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,s)=>r+s,0)}async getNumTokensFromMessages(e){let t=0,r=0,s=0;this.model==="gpt-3.5-turbo-0301"?(r=4,s=-1):(r=3,s=1);const i=await Promise.all(e.map(async a=>{var f,p,m,g,y,w;const o=await this.getNumTokens(a.content),u=await this.getNumTokens(cj(a)),l=a.name!==void 0?s+await this.getNumTokens(a.name):0;let d=o+r+u+l;const h=a;if(h._getType()==="function"&&(d-=2),(f=h.additional_kwargs)!=null&&f.function_call&&(d+=3),(p=h==null?void 0:h.additional_kwargs.function_call)!=null&&p.name&&(d+=await this.getNumTokens((m=h.additional_kwargs.function_call)==null?void 0:m.name)),(g=h.additional_kwargs.function_call)!=null&&g.arguments)try{d+=await this.getNumTokens(JSON.stringify(JSON.parse((y=h.additional_kwargs.function_call)==null?void 0:y.arguments)))}catch(S){console.error("Error parsing function arguments",S,JSON.stringify(h.additional_kwargs.function_call)),d+=await this.getNumTokens((w=h.additional_kwargs.function_call)==null?void 0:w.arguments)}return t+=d,d}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(s){throw aj(s)}})}async betaParsedCompletionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,r)}catch(s){throw aj(s)}})}_getClientOptions(e){if(!this.client){const r={baseURL:this.clientConfig.baseURL},s=$Z(r),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new st(i)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let r,s,i,a;WZ(e)?(r=e.schema,s=e.name,i=e.method,a=e.includeRaw):(r=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw);let o,u;if((t==null?void 0:t.strict)!==void 0&&i==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?i===void 0&&(i="jsonSchema"):i==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),Y_(r)?u=Mp.fromZodSchema(r):u=new Np;else if(i==="jsonSchema")o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:r.description,schema:r,strict:t==null?void 0:t.strict}}}),Y_(r)?u=Mp.fromZodSchema(r):u=new Np;else{let f=s??"extract";if(Y_(r)){const p=Zi(r);o=this.bind({tools:[{type:"function",function:{name:f,description:p.description,parameters:p}}],tool_choice:{type:"function",function:{name:f}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),u=new G_({returnSingle:!0,keyName:f,zodSchema:r})}else{let p;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(p=r,f=r.name):(f=r.title??f,p={name:f,description:r.description??"",parameters:r}),o=this.bind({tools:[{type:"function",function:p}],tool_choice:{type:"function",function:{name:f}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),u=new G_({returnSingle:!0,keyName:f})}}if(!a)return o.pipe(u);const l=as.assign({parsed:(f,p)=>u.invoke(f.raw,p)}),d=as.assign({parsed:()=>null}),h=l.withFallbacks({fallbacks:[d]});return Fn.from([{raw:o},h])}};function Y_(n){return typeof(n==null?void 0:n.parse)=="function"}function WZ(n){return n!==void 0&&typeof n.schema=="object"}const Jl="0.32.1";let dj=!1,$p,hj,hC,fj,pj,mj;function zZ(n,e={auto:!1}){if(dj)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${n.kind}'\` before importing anything else from @anthropic-ai/sdk`);if($p)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${n.kind}'\` after \`import '@anthropic-ai/sdk/shims/${$p}'\``);dj=e.auto,$p=n.kind,hj=n.fetch,hC=n.File,fj=n.ReadableStream,pj=n.getDefaultAgent,mj=n.fileFromPath}let VZ=class{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}};function GZ({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import  from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new VZ(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:a=>!1}}$p||zZ(GZ(),{auto:!0});class ut extends Error{}let Un=class KT extends ut{constructor(e,t,r,s){super(`${KT.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["request-id"],this.error=t}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e)return new Q_({message:r,cause:gC(t)});const i=t;return e===400?new yj(e,i,r,s):e===401?new wj(e,i,r,s):e===403?new bj(e,i,r,s):e===404?new _j(e,i,r,s):e===409?new vj(e,i,r,s):e===422?new Sj(e,i,r,s):e===429?new xj(e,i,r,s):e>=500?new Ej(e,i,r,s):new KT(e,i,r,s)}},$s=class extends Un{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}},Q_=class extends Un{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}},gj=class extends Q_{constructor({message:e}={}){super({message:e??"Request timed out."})}},yj=class extends Un{constructor(){super(...arguments),this.status=400}},wj=class extends Un{constructor(){super(...arguments),this.status=401}},bj=class extends Un{constructor(){super(...arguments),this.status=403}},_j=class extends Un{constructor(){super(...arguments),this.status=404}},vj=class extends Un{constructor(){super(...arguments),this.status=409}},Sj=class extends Un{constructor(){super(...arguments),this.status=422}},xj=class extends Un{constructor(){super(...arguments),this.status=429}},Ej=class extends Un{},jp=class HT{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=HT.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(HT.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new ut(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new ut(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new ut("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}};jp.NEWLINE_CHARS=new Set([`
`,"\r"]),jp.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let Lp=class Zw{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of ZZ(e,t)){if(a.event==="completion")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event==="message_start"||a.event==="message_delta"||a.event==="message_stop"||a.event==="content_block_start"||a.event==="content_block_delta"||a.event==="content_block_stop")try{yield JSON.parse(a.data)}catch(o){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),o}if(a.event!=="ping"&&a.event==="error")throw Un.generate(void 0,`SSE Error: ${a.data}`,a.data,Aj(e.headers))}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new Zw(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new jp,o=fC(e);for await(const u of o)for(const l of a.decode(u))yield l;for(const u of a.flush())yield u}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new Zw(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new Zw(()=>s(e),this.controller),new Zw(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new fj({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}};async function*ZZ(n,e){if(!n.body)throw e.abort(),new ut("Attempted to iterate over a response with no body");const t=new YZ,r=new jp,s=fC(n.body);for await(const i of JZ(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*JZ(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=XZ(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function XZ(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}let YZ=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=QZ(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}};function QZ(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}function fC(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}const e7=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",t7=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&ev(n),ev=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function";async function r7(n,e,t){var s;if(n=await n,t7(n))return n;if(e7(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=ev(i)?[await i.arrayBuffer()]:[i];return new hC(a,e,t)}const r=await n7(n);if(e||(e=i7(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new hC(r,e,t)}async function n7(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(ev(n))e.push(await n.arrayBuffer());else if(a7(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${s7(n)}`);return e}function s7(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function i7(n){var e;return pC(n.name)||pC(n.filename)||((e=pC(n.path))==null?void 0:e.split(/[\\/]/).pop())}const pC=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},a7=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",kj=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody";var o7=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},c7=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},tv;async function Cj(n){const{response:e}=n;if(n.options.stream)return Xl("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Lp.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return Xl("response",e.status,e.url,e.headers,i),i}const s=await e.text();return Xl("response",e.status,e.url,e.headers,s),s}let Pj=class y3 extends Promise{constructor(e,t=Cj){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new y3(this.responsePromise,async t=>e(await this.parseResponse(t),t))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}},u7=class{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=mC("maxRetries",t),this.timeout=mC("timeout",r),this.httpAgent=s,this.fetch=i??hj}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...m7(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${_7()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&ev(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var g;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:kj(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,u=this.calculateContentLength(o),l=this.buildURL(s,i);"timeout"in e&&mC("timeout",e.timeout);const d=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??pj(l),f=d+1e3;typeof((g=h==null?void 0:h.options)==null?void 0:g.timeout)=="number"&&f>(h.options.timeout??0)&&(h.options.timeout=f),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const p=this.buildHeaders({options:e,headers:a,contentLength:u,retryCount:t});return{req:{method:r,...o&&{body:o},headers:p,...h&&{agent:h},signal:e.signal??null},url:l,timeout:d}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return Mj(i,a),Mj(i,t),kj(e.body)&&$p!=="node"&&delete i["content-type"],Nj(a,"x-stainless-retry-count")===void 0&&Nj(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return Un.generate(e,t,r,s)}request(e,t=null){return new Pj(this.makeRequest(e,t))}async makeRequest(e,t){var h,f;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),Xl("request",a,r,i.headers),(h=r.signal)!=null&&h.aborted)throw new $s;const u=new AbortController,l=await this.fetchWithTimeout(a,i,o,u).catch(gC);if(l instanceof Error){if((f=r.signal)!=null&&f.aborted)throw new $s;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new gj:new Q_({cause:l})}const d=Aj(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){const S=`retrying, ${t} attempts remaining`;return Xl(`response (error; ${S})`,l.status,a,d),this.retryRequest(r,t,d)}const p=await l.text().catch(S=>gC(S).message),m=g7(p),g=m?void 0:p;throw Xl(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,d,g),this.makeStatusError(l.status,m,g,d)}return{response:l,options:r,controller:u}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new d7(this,r,e)}buildURL(e,t){const r=w7(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return nv(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new ut(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...a}).finally(()=>{clearTimeout(o)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await b7(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Jl}`}},l7=class{constructor(e,t,r,s){tv.set(this,void 0),o7(this,tv,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new ut("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await c7(this,tv,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(tv=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},d7=class extends Pj{constructor(e,t,r){super(t,async s=>new r(e,s.response,await Cj(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}};const Aj=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),h7={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},rv=n=>typeof n=="object"&&n!==null&&!nv(n)&&Object.keys(n).every(e=>Rj(h7,e)),f7=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Jl,"X-Stainless-OS":Ij(Deno.build.os),"X-Stainless-Arch":Tj(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Jl,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Jl,"X-Stainless-OS":Ij(process.platform),"X-Stainless-Arch":Tj(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=p7();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Jl,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Jl,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function p7(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const Tj=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Ij=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Oj;const m7=()=>Oj??(Oj=f7()),g7=n=>{try{return JSON.parse(n)}catch{return}},y7=new RegExp("^(?:[a-z]+:)?//","i"),w7=n=>y7.test(n),b7=n=>new Promise(e=>setTimeout(e,n)),mC=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ut(`${n} must be an integer`);if(e<0)throw new ut(`${n} must be a positive integer`);return e},gC=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(String(n))},yC=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function nv(n){if(!n)return!0;for(const e in n)return!1;return!0}function Rj(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Mj(n,e){for(const t in e){if(!Rj(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}function Xl(n,...e){var t;typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"&&console.log(`Anthropic:DEBUG:${n}`,...e)}const _7=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),v7=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",S7=n=>typeof(n==null?void 0:n.get)=="function",Nj=(n,e)=>{var r;const t=e.toLowerCase();if(S7(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};let x7=class extends l7{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var t;if((t=this.options.query)!=null&&t.before_id){const r=this.first_id;return r?{params:{before_id:r}}:null}const e=this.last_id;return e?{params:{after_id:e}}:null}},Sc=class{constructor(e){this._client=e}};class wC{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new jp;for await(const t of this.iterator)for(const r of e.decode(t))yield JSON.parse(r);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),new ut("Attempted to iterate over a response with no body");return new wC(fC(e.body),t)}}let bC=class extends Sc{create(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages/batches?beta=true",{body:s,...t,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}retrieve(e,t={},r){if(rv(t))return this.retrieve(e,{},t);const{betas:s}=t;return this._client.get(`/v1/messages/batches/${e}?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}list(e={},t){if(rv(e))return this.list({},e);const{betas:r,...s}=e;return this._client.getAPIList("/v1/messages/batches?beta=true",_C,{query:s,...t,headers:{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),...t==null?void 0:t.headers}})}cancel(e,t={},r){if(rv(t))return this.cancel(e,{},t);const{betas:s}=t;return this._client.post(`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers}})}async results(e,t={},r){if(rv(t))return this.results(e,{},t);const s=await this.retrieve(e);if(!s.results_url)throw new ut(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);const{betas:i}=t;return this._client.get(s.results_url,{...r,headers:{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString(),...r==null?void 0:r.headers},__binaryResponse:!0})._thenUnwrap((a,o)=>wC.fromResponse(o.response,o.controller))}};class _C extends x7{}bC.BetaMessageBatchesPage=_C;let sv=class extends Sc{constructor(){super(...arguments),this.batches=new bC(this._client)}create(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages?beta=true",{body:s,timeout:this._client._options.timeout??6e5,...t,headers:{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0,...t==null?void 0:t.headers},stream:e.stream??!1})}countTokens(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:s,...t,headers:{"anthropic-beta":[...r??[],"token-counting-2024-11-01"].toString(),...t==null?void 0:t.headers}})}};sv.Batches=bC,sv.BetaMessageBatchesPage=_C;const E7=n=>{let e=0,t=[];for(;e<n.length;){let r=n[e];if(r==="\\"){e++;continue}if(r==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(r==="["){t.push({type:"paren",value:"["}),e++;continue}if(r==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(r===":"){t.push({type:"separator",value:":"}),e++;continue}if(r===","){t.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let o="",u=!1;for(r=n[++e];r!=='"';){if(e===n.length){u=!0;break}if(r==="\\"){if(e++,e===n.length){u=!0;break}o+=r+n[e],r=n[++e]}else o+=r,r=n[++e]}r=n[++e],u||t.push({type:"string",value:o});continue}if(r&&/\s/.test(r)){e++;continue}let i=/[0-9]/;if(r&&i.test(r)||r==="-"||r==="."){let o="";for(r==="-"&&(o+=r,r=n[++e]);r&&i.test(r)||r===".";)o+=r,r=n[++e];t.push({type:"number",value:o});continue}let a=/[a-z]/i;if(r&&a.test(r)){let o="";for(;r&&a.test(r)&&e!==n.length;)o+=r,r=n[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},Yl=n=>{if(n.length===0)return n;let e=n[n.length-1];switch(e.type){case"separator":return n=n.slice(0,n.length-1),Yl(n);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return n=n.slice(0,n.length-1),Yl(n);case"string":let r=n[n.length-2];if((r==null?void 0:r.type)==="delimiter")return n=n.slice(0,n.length-1),Yl(n);if((r==null?void 0:r.type)==="brace"&&r.value==="{")return n=n.slice(0,n.length-1),Yl(n);break;case"delimiter":return n=n.slice(0,n.length-1),Yl(n)}return n},k7=n=>{let e=[];return n.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?n.push({type:"brace",value:"}"}):t==="]"&&n.push({type:"paren",value:"]"})}),n},C7=n=>{let e="";return n.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},$j=n=>JSON.parse(C7(k7(Yl(E7(n)))));var vn=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Xe=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},cs,eo,iv,av,Fp,Dp,ov,Bp,Qi,Up,cv,uv,Ql,vC,jj,SC,xC,EC,kC,Lj;const Fj="__json_buf";class lv{constructor(){cs.add(this),this.messages=[],this.receivedMessages=[],eo.set(this,void 0),this.controller=new AbortController,iv.set(this,void 0),av.set(this,()=>{}),Fp.set(this,()=>{}),Dp.set(this,void 0),ov.set(this,()=>{}),Bp.set(this,()=>{}),Qi.set(this,{}),Up.set(this,!1),cv.set(this,!1),uv.set(this,!1),Ql.set(this,!1),SC.set(this,e=>{if(vn(this,cv,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new $s),e instanceof $s)return vn(this,uv,!0,"f"),this._emit("abort",e);if(e instanceof ut)return this._emit("error",e);if(e instanceof Error){const t=new ut(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ut(String(e)))}),vn(this,iv,new Promise((e,t)=>{vn(this,av,e,"f"),vn(this,Fp,t,"f")}),"f"),vn(this,Dp,new Promise((e,t)=>{vn(this,ov,e,"f"),vn(this,Bp,t,"f")}),"f"),Xe(this,iv,"f").catch(()=>{}),Xe(this,Dp,"f").catch(()=>{})}static fromReadableStream(e){const t=new lv;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){const s=new lv;for(const i of t.messages)s._addPromptCachingBetaMessageParam(i);return s._run(()=>s._createPromptCachingBetaMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},Xe(this,SC,"f"))}_addPromptCachingBetaMessageParam(e){this.messages.push(e)}_addPromptCachingBetaMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createPromptCachingBetaMessage(e,t,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Xe(this,cs,"m",xC).call(this);const i=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)Xe(this,cs,"m",EC).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new $s;Xe(this,cs,"m",kC).call(this)}_connected(){this.ended||(Xe(this,av,"f").call(this),this._emit("connect"))}get ended(){return Xe(this,Up,"f")}get errored(){return Xe(this,cv,"f")}get aborted(){return Xe(this,uv,"f")}abort(){this.controller.abort()}on(e,t){return(Xe(this,Qi,"f")[e]||(Xe(this,Qi,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=Xe(this,Qi,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(Xe(this,Qi,"f")[e]||(Xe(this,Qi,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{vn(this,Ql,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){vn(this,Ql,!0,"f"),await Xe(this,Dp,"f")}get currentMessage(){return Xe(this,eo,"f")}async finalMessage(){return await this.done(),Xe(this,cs,"m",vC).call(this)}async finalText(){return await this.done(),Xe(this,cs,"m",jj).call(this)}_emit(e,...t){if(Xe(this,Up,"f"))return;e==="end"&&(vn(this,Up,!0,"f"),Xe(this,ov,"f").call(this));const r=Xe(this,Qi,"f")[e];if(r&&(Xe(this,Qi,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!Xe(this,Ql,"f")&&!(r!=null&&r.length)&&Promise.reject(s),Xe(this,Fp,"f").call(this,s),Xe(this,Bp,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!Xe(this,Ql,"f")&&!(r!=null&&r.length)&&Promise.reject(s),Xe(this,Fp,"f").call(this,s),Xe(this,Bp,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalPromptCachingBetaMessage",Xe(this,cs,"m",vC).call(this))}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Xe(this,cs,"m",xC).call(this),this._connected();const s=Lp.fromReadableStream(e,this.controller);for await(const a of s)Xe(this,cs,"m",EC).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new $s;Xe(this,cs,"m",kC).call(this)}[(eo=new WeakMap,iv=new WeakMap,av=new WeakMap,Fp=new WeakMap,Dp=new WeakMap,ov=new WeakMap,Bp=new WeakMap,Qi=new WeakMap,Up=new WeakMap,cv=new WeakMap,uv=new WeakMap,Ql=new WeakMap,SC=new WeakMap,cs=new WeakSet,vC=function(){if(this.receivedMessages.length===0)throw new ut("stream ended without producing a PromptCachingBetaMessage with role=assistant");return this.receivedMessages.at(-1)},jj=function(){if(this.receivedMessages.length===0)throw new ut("stream ended without producing a PromptCachingBetaMessage with role=assistant");const t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new ut("stream ended without producing a content block with type=text");return t.join(" ")},xC=function(){this.ended||vn(this,eo,void 0,"f")},EC=function(t){if(this.ended)return;const r=Xe(this,cs,"m",Lj).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{const s=r.content.at(-1);t.delta.type==="text_delta"&&s.type==="text"?this._emit("text",t.delta.text,s.text||""):t.delta.type==="input_json_delta"&&s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"message_stop":{this._addPromptCachingBetaMessageParam(r),this._addPromptCachingBetaMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{vn(this,eo,r,"f");break}}},kC=function(){if(this.ended)throw new ut("stream has ended, this shouldn't happen");const t=Xe(this,eo,"f");if(!t)throw new ut("request ended without sending any chunks");return vn(this,eo,void 0,"f"),t},Lj=function(t){let r=Xe(this,eo,"f");if(t.type==="message_start"){if(r)throw new ut(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new ut(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{const s=r.content.at(t.index);if((s==null?void 0:s.type)==="text"&&t.delta.type==="text_delta")s.text+=t.delta.text;else if((s==null?void 0:s.type)==="tool_use"&&t.delta.type==="input_json_delta"){let i=s[Fj]||"";i+=t.delta.partial_json,Object.defineProperty(s,Fj,{value:i,enumerable:!1,writable:!0}),i&&(s.input=$j(i))}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("streamEvent",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Lp(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let Dj=class extends Sc{create(e,t){const{betas:r,...s}=e;return this._client.post("/v1/messages?beta=prompt_caching",{body:s,timeout:this._client._options.timeout??6e5,...t,headers:{"anthropic-beta":[...r??[],"prompt-caching-2024-07-31"].toString(),...t==null?void 0:t.headers},stream:e.stream??!1})}stream(e,t){return lv.createMessage(this,e,t)}};class CC extends Sc{constructor(){super(...arguments),this.messages=new Dj(this._client)}}CC.Messages=Dj;let dv=class extends Sc{constructor(){super(...arguments),this.messages=new sv(this._client),this.promptCaching=new CC(this._client)}};dv.Messages=sv,dv.PromptCaching=CC;let Bj=class extends Sc{create(e,t){return this._client.post("/v1/complete",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}};var Sn=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Ye=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},us,to,hv,fv,qp,Kp,pv,Hp,ea,Wp,mv,gv,ed,PC,Uj,AC,TC,IC,OC,qj;const Kj="__json_buf";class yv{constructor(){us.add(this),this.messages=[],this.receivedMessages=[],to.set(this,void 0),this.controller=new AbortController,hv.set(this,void 0),fv.set(this,()=>{}),qp.set(this,()=>{}),Kp.set(this,void 0),pv.set(this,()=>{}),Hp.set(this,()=>{}),ea.set(this,{}),Wp.set(this,!1),mv.set(this,!1),gv.set(this,!1),ed.set(this,!1),AC.set(this,e=>{if(Sn(this,mv,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new $s),e instanceof $s)return Sn(this,gv,!0,"f"),this._emit("abort",e);if(e instanceof ut)return this._emit("error",e);if(e instanceof Error){const t=new ut(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new ut(String(e)))}),Sn(this,hv,new Promise((e,t)=>{Sn(this,fv,e,"f"),Sn(this,qp,t,"f")}),"f"),Sn(this,Kp,new Promise((e,t)=>{Sn(this,pv,e,"f"),Sn(this,Hp,t,"f")}),"f"),Ye(this,hv,"f").catch(()=>{}),Ye(this,Kp,"f").catch(()=>{})}static fromReadableStream(e){const t=new yv;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){const s=new yv;for(const i of t.messages)s._addMessageParam(i);return s._run(()=>s._createMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},Ye(this,AC,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){var a;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Ye(this,us,"m",TC).call(this);const i=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)Ye(this,us,"m",IC).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new $s;Ye(this,us,"m",OC).call(this)}_connected(){this.ended||(Ye(this,fv,"f").call(this),this._emit("connect"))}get ended(){return Ye(this,Wp,"f")}get errored(){return Ye(this,mv,"f")}get aborted(){return Ye(this,gv,"f")}abort(){this.controller.abort()}on(e,t){return(Ye(this,ea,"f")[e]||(Ye(this,ea,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=Ye(this,ea,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(Ye(this,ea,"f")[e]||(Ye(this,ea,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Sn(this,ed,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Sn(this,ed,!0,"f"),await Ye(this,Kp,"f")}get currentMessage(){return Ye(this,to,"f")}async finalMessage(){return await this.done(),Ye(this,us,"m",PC).call(this)}async finalText(){return await this.done(),Ye(this,us,"m",Uj).call(this)}_emit(e,...t){if(Ye(this,Wp,"f"))return;e==="end"&&(Sn(this,Wp,!0,"f"),Ye(this,pv,"f").call(this));const r=Ye(this,ea,"f")[e];if(r&&(Ye(this,ea,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!Ye(this,ed,"f")&&!(r!=null&&r.length)&&Promise.reject(s),Ye(this,qp,"f").call(this,s),Ye(this,Hp,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!Ye(this,ed,"f")&&!(r!=null&&r.length)&&Promise.reject(s),Ye(this,qp,"f").call(this,s),Ye(this,Hp,"f").call(this,s),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",Ye(this,us,"m",PC).call(this))}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Ye(this,us,"m",TC).call(this),this._connected();const s=Lp.fromReadableStream(e,this.controller);for await(const a of s)Ye(this,us,"m",IC).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new $s;Ye(this,us,"m",OC).call(this)}[(to=new WeakMap,hv=new WeakMap,fv=new WeakMap,qp=new WeakMap,Kp=new WeakMap,pv=new WeakMap,Hp=new WeakMap,ea=new WeakMap,Wp=new WeakMap,mv=new WeakMap,gv=new WeakMap,ed=new WeakMap,AC=new WeakMap,us=new WeakSet,PC=function(){if(this.receivedMessages.length===0)throw new ut("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Uj=function(){if(this.receivedMessages.length===0)throw new ut("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new ut("stream ended without producing a content block with type=text");return t.join(" ")},TC=function(){this.ended||Sn(this,to,void 0,"f")},IC=function(t){if(this.ended)return;const r=Ye(this,us,"m",qj).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{const s=r.content.at(-1);t.delta.type==="text_delta"&&s.type==="text"?this._emit("text",t.delta.text,s.text||""):t.delta.type==="input_json_delta"&&s.type==="tool_use"&&s.input&&this._emit("inputJson",t.delta.partial_json,s.input);break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{Sn(this,to,r,"f");break}}},OC=function(){if(this.ended)throw new ut("stream has ended, this shouldn't happen");const t=Ye(this,to,"f");if(!t)throw new ut("request ended without sending any chunks");return Sn(this,to,void 0,"f"),t},qj=function(t){let r=Ye(this,to,"f");if(t.type==="message_start"){if(r)throw new ut(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new ut(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{const s=r.content.at(t.index);if((s==null?void 0:s.type)==="text"&&t.delta.type==="text_delta")s.text+=t.delta.text;else if((s==null?void 0:s.type)==="tool_use"&&t.delta.type==="input_json_delta"){let i=s[Kj]||"";i+=t.delta.partial_json,Object.defineProperty(s,Kj,{value:i,enumerable:!1,writable:!0}),i&&(s.input=$j(i))}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("streamEvent",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Lp(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let Hj=class extends Sc{create(e,t){return e.model in Wj&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${Wj[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}stream(e,t){return yv.createMessage(this,e,t)}};const Wj={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024"};var zj;class Ut extends u7{constructor({baseURL:e=yC("ANTHROPIC_BASE_URL"),apiKey:t=yC("ANTHROPIC_API_KEY")??null,authToken:r=yC("ANTHROPIC_AUTH_TOKEN")??null,...s}={}){const i={apiKey:t,authToken:r,...s,baseURL:e||"https://api.anthropic.com"};if(!i.dangerouslyAllowBrowser&&v7())throw new ut(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });

TODO: link!
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new Bj(this),this.messages=new Hj(this),this.beta=new dv(this),this._options=i,this.apiKey=t,this.authToken=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,t){if(!(this.apiKey&&e["x-api-key"])&&t["x-api-key"]!==null&&!(this.authToken&&e.authorization)&&t.authorization!==null)throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){const t=this.apiKeyAuth(e),r=this.bearerAuth(e);return t!=null&&!nv(t)?t:r!=null&&!nv(r)?r:{}}apiKeyAuth(e){return this.apiKey==null?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return this.authToken==null?{}:{Authorization:`Bearer ${this.authToken}`}}}zj=Ut,Ut.Anthropic=zj,Ut.HUMAN_PROMPT=`

Human:`,Ut.AI_PROMPT=`

Assistant:`,Ut.DEFAULT_TIMEOUT=6e5,Ut.AnthropicError=ut,Ut.APIError=Un,Ut.APIConnectionError=Q_,Ut.APIConnectionTimeoutError=gj,Ut.APIUserAbortError=$s,Ut.NotFoundError=_j,Ut.ConflictError=vj,Ut.RateLimitError=xj,Ut.BadRequestError=yj,Ut.AuthenticationError=wj,Ut.InternalServerError=Ej,Ut.PermissionDeniedError=bj,Ut.UnprocessableEntityError=Sj,Ut.toFile=r7,Ut.fileFromPath=mj,Ut.Completions=Bj,Ut.Messages=Hj,Ut.Beta=dv;class Vj extends aC{static lc_name(){return"AnthropicToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","anthropic","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){let t=e;if(typeof e=="string")try{t=JSON.parse(e)}catch(s){throw new Gl(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(s.message)}`,e)}else t=e;if(this.zodSchema===void 0)return t;const r=await this.zodSchema.safeParseAsync(t);if(r.success)return r.data;throw new Gl(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(r.error.errors)}`,JSON.stringify(t,null,2))}async parseResult(e){const t=e.flatMap(i=>{const{message:a}=i;return Array.isArray(a.content)?Gj(a.content)[0]:[]});if(t[0]===void 0)throw new Error("No parseable tool calls provided to AnthropicToolsOutputParser.");const[r]=t;return await this._validateResult(r.args)}}function Gj(n){const e=[];for(const t of n)t.type==="tool_use"&&e.push({name:t.name,args:t.input,id:t.id,type:"tool_call"});return e}function P7(n){if(n)return n==="any"?{type:"any"}:n==="auto"?{type:"auto"}:typeof n=="string"?{type:"tool",name:n}:n}function Zj(n){const e=/^data:(image\/.+);base64,(.+)$/,t=n.match(e);if(t===null)throw new Error(["Anthropic only supports base64-encoded images currently.","Example: data:image/png;base64,/9j/4AAQSk..."].join(`

`));return{type:"base64",media_type:t[1]??"",data:t[2]??""}}function A7(n){const e=[];for(const t of n)if(t._getType()==="tool")if(typeof t.content=="string"){const r=e[e.length-1];(r==null?void 0:r._getType())==="human"&&Array.isArray(r.content)&&"type"in r.content[0]&&r.content[0].type==="tool_result"?r.content.push({type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}):e.push(new Bt({content:[{type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}]}))}else e.push(new Bt({content:[{type:"tool_result",content:RC(t.content),tool_use_id:t.tool_call_id}]}));else e.push(t);return e}function Jj(n){if(n.id===void 0)throw new Error('Anthropic requires all tool calls to have an "id".');return{type:"tool_use",id:n.id,name:n.name,input:n.args}}function RC(n){const e=["tool_use","tool_result","input_json_delta"],t=["text","text_delta"];return typeof n=="string"?n:n.map(s=>{const i="cache_control"in s?s.cache_control:void 0;if(s.type==="image_url"){let a;return typeof s.image_url=="string"?a=Zj(s.image_url):a=Zj(s.image_url.url),{type:"image",source:a,...i?{cache_control:i}:{}}}else{if(s.type==="document")return{type:"document",source:s.source,...i?{cache_control:i}:{}};if(t.find(a=>a===s.type)&&"text"in s)return{type:"text",text:s.text,...i?{cache_control:i}:{}};if(e.find(a=>a===s.type)){const a={...s};if("index"in a&&delete a.index,a.type==="input_json_delta"&&(a.type="tool_use"),"input"in a)try{a.input=JSON.parse(a.input)}catch{}return{...a,...i?{cache_control:i}:{}}}else throw new Error("Unsupported message content format")}})}function Xj(n){const e=A7(n);let t;e.length>0&&e[0]._getType()==="system"&&(t=n[0].content);const s=(t!==void 0?e.slice(1):e).map(i=>{var o;let a;if(i._getType()==="human")a="user";else if(i._getType()==="ai")a="assistant";else if(i._getType()==="tool")a="user";else throw i._getType()==="system"?new Error("System messages are only permitted as the first passed message."):new Error(`Message type "${i._getType()}" is not supported.`);if(pc(i)&&((o=i.tool_calls)!=null&&o.length)){if(typeof i.content=="string")return i.content===""?{role:a,content:i.tool_calls.map(Jj)}:{role:a,content:[{type:"text",text:i.content},...i.tool_calls.map(Jj)]};{const{content:u}=i;return!i.tool_calls.every(d=>u.find(h=>(h.type==="tool_use"||h.type==="input_json_delta")&&h.id===d.id))&&console.warn('The "tool_calls" field on a message is only respected if content is a string.'),{role:a,content:RC(i.content)}}}else return{role:a,content:RC(i.content)}});return{messages:T7(s),system:t}}function T7(n){if(!n||n.length<=1)return n;const e=[];let t=n[0];const r=i=>typeof i=="string"?[{type:"text",text:i}]:i,s=i=>i.role!=="user"||typeof i.content=="string"?!1:Array.isArray(i.content)&&i.content.every(a=>a.type==="tool_result");for(let i=1;i<n.length;i+=1){const a=n[i];s(t)&&s(a)?t={...t,content:[...r(t.content),...r(a.content)]}:(e.push(t),t=a)}return e.push(t),e}function I7(n,e){var t,r;if(n.type==="message_start"){const{content:s,usage:i,...a}=n.message,o={};for(const[f,p]of Object.entries(a))p!=null&&(o[f]=p);const{input_tokens:u,output_tokens:l,...d}=i??{},h={input_tokens:u,output_tokens:l,total_tokens:u+l,input_token_details:{cache_creation:d.cache_creation_input_tokens,cache_read:d.cache_read_input_tokens}};return{chunk:new nr({content:e.coerceContentToString?"":[],additional_kwargs:o,usage_metadata:e.streamUsage?h:void 0,response_metadata:{usage:{...d}},id:n.message.id})}}else if(n.type==="message_delta"){const s={input_tokens:0,output_tokens:n.usage.output_tokens,total_tokens:n.usage.output_tokens,input_token_details:{cache_creation:n.usage.cache_creation_input_tokens,cache_read:n.usage.cache_read_input_tokens}};return{chunk:new nr({content:e.coerceContentToString?"":[],additional_kwargs:{...n.delta},usage_metadata:e.streamUsage?s:void 0})}}else if(n.type==="content_block_start"&&n.content_block.type==="tool_use"){const s=n.content_block;return{chunk:new nr({content:e.coerceContentToString?"":[{index:n.index,...n.content_block,input:""}],additional_kwargs:{},tool_call_chunks:[{id:s.id,index:n.index,name:s.name,args:""}]})}}else if(n.type==="content_block_delta"&&n.delta.type==="text_delta"){const s=(t=n.delta)==null?void 0:t.text;if(s!==void 0)return{chunk:new nr({content:e.coerceContentToString?s:[{index:n.index,...n.delta}],additional_kwargs:{}})}}else{if(n.type==="content_block_delta"&&n.delta.type==="input_json_delta")return{chunk:new nr({content:e.coerceContentToString?"":[{index:n.index,input:n.delta.partial_json,type:n.delta.type}],additional_kwargs:{},tool_call_chunks:[{index:n.index,args:n.delta.partial_json}]})};if(n.type==="content_block_start"&&n.content_block.type==="text"){const s=(r=n.content_block)==null?void 0:r.text;if(s!==void 0)return{chunk:new nr({content:e.coerceContentToString?s:[{index:n.index,...n.content_block}],additional_kwargs:{}})}}}return null}function O7(n,e){const t=e.usage,r=t!=null?{input_tokens:t.input_tokens??0,output_tokens:t.output_tokens??0,total_tokens:(t.input_tokens??0)+(t.output_tokens??0),input_token_details:{cache_creation:t.cache_creation_input_tokens,cache_read:t.cache_read_input_tokens}}:void 0;if(n.length===1&&n[0].type==="text")return[{text:n[0].text,message:new Dr({content:n[0].text,additional_kwargs:e,usage_metadata:r,response_metadata:e,id:e.id})}];{const s=Gj(n);return[{text:"",message:new Dr({content:n,additional_kwargs:e,tool_calls:s,usage_metadata:r,response_metadata:e,id:e.id})}]}}function wv(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function Yj(n){let e;return n.status===400&&n.message.includes("tool")?e=wv(n,"INVALID_TOOL_RESULTS"):n.status===401?e=wv(n,"MODEL_AUTHENTICATION"):n.status===404?e=wv(n,"MODEL_NOT_FOUND"):n.status===429?e=wv(n,"MODEL_RATE_LIMIT"):e=n,e}function R7(n){return!!(n.tools&&n.tools.length>0)}function M7(n){return"input_schema"in n}function N7(n){if(typeof n.content=="string")return n.content;if(Array.isArray(n.content)&&n.content.length>=1&&"input"in n.content[0])return typeof n.content[0].input=="string"?n.content[0].input:JSON.stringify(n.content[0].input);if(Array.isArray(n.content)&&n.content.length>=1&&"text"in n.content[0])return n.content[0].text}class $7 extends os{static lc_name(){return"ChatAnthropic"}get lc_secrets(){return{anthropicApiKey:"ANTHROPIC_API_KEY",apiKey:"ANTHROPIC_API_KEY"}}get lc_aliases(){return{modelName:"model"}}constructor(e){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"anthropicApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"invocationKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"clientOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamingClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"createClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.anthropicApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.anthropicApiKey)??Br("ANTHROPIC_API_KEY"),!this.anthropicApiKey&&!(e!=null&&e.createClient))throw new Error("Anthropic API key not found");this.clientOptions=(e==null?void 0:e.clientOptions)??{},this.apiKey=this.anthropicApiKey,this.apiUrl=e==null?void 0:e.anthropicApiUrl,this.modelName=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.model=this.modelName,this.invocationKwargs=(e==null?void 0:e.invocationKwargs)??{},this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topK=(e==null?void 0:e.topK)??this.topK,this.topP=(e==null?void 0:e.topP)??this.topP,this.maxTokens=(e==null?void 0:e.maxTokensToSample)??(e==null?void 0:e.maxTokens)??this.maxTokens,this.stopSequences=(e==null?void 0:e.stopSequences)??this.stopSequences,this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.createClient=(e==null?void 0:e.createClient)??(t=>new Ut(t))}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"anthropic",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}formatStructuredToolToAnthropic(e){if(!(!e||!e.length))return e.map(t=>{if(M7(t))return t;if(Op(t))return{name:t.function.name,description:t.function.description,input_schema:t.function.parameters};if(Zl(t))return{name:t.name,description:t.description,input_schema:Zi(t.schema)};throw new Error(`Unknown tool type passed to ChatAnthropic: ${JSON.stringify(t,null,2)}`)})}bindTools(e,t){return this.bind({tools:this.formatStructuredToolToAnthropic(e),...t})}invocationParams(e){const t=P7(e==null?void 0:e.tool_choice);return{model:this.model,temperature:this.temperature,top_k:this.topK,top_p:this.topP,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:t,...this.invocationKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams()}}identifyingParams(){return{model_name:this.model,...this.invocationParams()}}async*_streamResponseChunks(e,t,r){var u;const s=this.invocationParams(t),i=Xj(e),a=!R7({...s,...i,stream:!1}),o=await this.createStreamWithRetry({...s,...i,stream:!0},{headers:t.headers});for await(const l of o){if((u=t.signal)!=null&&u.aborted)throw o.controller.abort(),new Error("AbortError: User aborted the request.");const d=this.streamUsage??t.streamUsage,h=I7(l,{streamUsage:d,coerceContentToString:a});if(!h)continue;const{chunk:f}=h,p=N7(f),m=new Ln({message:new nr({content:f.content,additional_kwargs:f.additional_kwargs,tool_call_chunks:f.tool_call_chunks,usage_metadata:d?f.usage_metadata:void 0,response_metadata:f.response_metadata,id:f.id}),text:p??""});yield m,await(r==null?void 0:r.handleLLMNewToken(p??"",void 0,void 0,void 0,void 0,{chunk:m}))}}async _generateNonStreaming(e,t,r){const s=await this.completionWithRetry({...t,stream:!1,...Xj(e)},r),{content:i,...a}=s,o=O7(i,a),{role:u,type:l,...d}=a;return{generations:o,llmOutput:d}}async _generate(e,t,r){if(this.stopSequences&&t.stop)throw new Error('"stopSequence" parameter found in input and default params');const s=this.invocationParams(t);if(s.stream){let i;const a=this._streamResponseChunks(e,t,r);for await(const o of a)i===void 0?i=o:i=i.concat(o);if(i===void 0)throw new Error("No chunks returned from Anthropic API.");return{generations:[{text:i.text,message:i.message}]}}else return this._generateNonStreaming(e,s,{signal:t.signal,headers:t.headers})}async createStreamWithRetry(e,t){if(!this.streamingClient){const s=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.streamingClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...s,apiKey:this.apiKey,maxRetries:0})}const r=async()=>{try{return await this.streamingClient.messages.create({...e,...this.invocationKwargs,stream:!0},t)}catch(s){throw Yj(s)}};return this.caller.call(r)}async completionWithRetry(e,t){if(!this.batchClient){const s=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.batchClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...s,apiKey:this.apiKey,maxRetries:0})}const r=async()=>{try{return await this.batchClient.messages.create({...e,...this.invocationKwargs},t)}catch(s){throw Yj(s)}};return this.caller.callWithOptions({signal:t.signal??void 0},r)}_llmType(){return"anthropic"}withStructuredOutput(e,t){const r=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw;if(i==="jsonMode")throw new Error('Anthropic only supports "functionCalling" as a method.');let o=s??"extract",u,l;if(Rp(r)){const m=Zi(r);l=[{name:o,description:m.description??"A function available to call.",input_schema:m}],u=new Vj({returnSingle:!0,keyName:o,zodSchema:r})}else{let m;typeof r.name=="string"&&typeof r.description=="string"&&typeof r.input_schema=="object"&&r.input_schema!=null?(m=r,o=r.name):m={name:o,description:r.description??"",input_schema:r},l=[m],u=new Vj({returnSingle:!0,keyName:o})}const d=this.bind({tools:l,tool_choice:{type:"tool",name:o}});if(!a)return d.pipe(u).withConfig({runName:"ChatAnthropicStructuredOutput"});const h=as.assign({parsed:(m,g)=>u.invoke(m.raw,g)}),f=as.assign({parsed:()=>null}),p=h.withFallbacks({fallbacks:[f]});return Fn.from([{raw:d},p]).withConfig({runName:"StructuredOutputRunnable"})}}class j7 extends $7{}var Qj;(function(n){n.STRING="string",n.NUMBER="number",n.INTEGER="integer",n.BOOLEAN="boolean",n.ARRAY="array",n.OBJECT="object"})(Qj||(Qj={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var eL;(function(n){n.LANGUAGE_UNSPECIFIED="language_unspecified",n.PYTHON="python"})(eL||(eL={}));var tL;(function(n){n.OUTCOME_UNSPECIFIED="outcome_unspecified",n.OUTCOME_OK="outcome_ok",n.OUTCOME_FAILED="outcome_failed",n.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(tL||(tL={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rL=["user","model","function","system"];var nL;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(nL||(nL={}));var sL;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(sL||(sL={}));var iL;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(iL||(iL={}));var aL;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER"})(aL||(aL={}));var zp;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER"})(zp||(zp={}));var oL;(function(n){n.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING"})(oL||(oL={}));var td;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(td||(td={}));var cL;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(cL||(cL={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class rd extends xn{constructor(e,t){super(e),this.response=t}}class uL extends xn{constructor(e,t,r,s){super(e),this.status=t,this.statusText=r,this.errorDetails=s}}class ro extends xn{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L7="https://generativelanguage.googleapis.com",F7="v1beta",D7="0.21.0",B7="genai-js";var xc;(function(n){n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents"})(xc||(xc={}));class U7{constructor(e,t,r,s,i){this.model=e,this.task=t,this.apiKey=r,this.stream=s,this.requestOptions=i}toString(){var e,t;const r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||F7;let i=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||L7}/${r}/${this.model}:${this.task}`;return this.stream&&(i+="?alt=sse"),i}}function q7(n){const e=[];return n!=null&&n.apiClient&&e.push(n.apiClient),e.push(`${B7}/${D7}`),e.join(" ")}async function K7(n){var e;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",q7(n.requestOptions)),t.append("x-goog-api-key",n.apiKey);let r=(e=n.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(s){throw new ro(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${s.message}`)}for(const[s,i]of r.entries()){if(s==="x-goog-api-key")throw new ro(`Cannot set reserved header name ${s}`);if(s==="x-goog-api-client")throw new ro(`Header name ${s} can only be set using the apiClient field`);t.append(s,i)}}return t}async function H7(n,e,t,r,s,i){const a=new U7(n,e,t,r,i);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},G7(i)),{method:"POST",headers:await K7(a),body:s})}}async function Vp(n,e,t,r,s,i={},a=fetch){const{url:o,fetchOptions:u}=await H7(n,e,t,r,s,i);return W7(o,u,a)}async function W7(n,e,t=fetch){let r;try{r=await t(n,e)}catch(s){z7(s,n)}return r.ok||await V7(r,n),r}function z7(n,e){let t=n;throw n instanceof uL||n instanceof ro||(t=new xn(`Error fetching from ${e.toString()}: ${n.message}`),t.stack=n.stack),t}async function V7(n,e){let t="",r;try{const s=await n.json();t=s.error.message,s.error.details&&(t+=` ${JSON.stringify(s.error.details)}`,r=s.error.details)}catch{}throw new uL(`Error fetching from ${e.toString()}: [${n.status} ${n.statusText}] ${t}`,n.status,n.statusText,r)}function G7(n){const e={};if((n==null?void 0:n.signal)!==void 0||(n==null?void 0:n.timeout)>=0){const t=new AbortController;(n==null?void 0:n.timeout)>=0&&setTimeout(()=>t.abort(),n.timeout),n!=null&&n.signal&&n.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MC(n){return n.text=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),bv(n.candidates[0]))throw new rd(`${no(n)}`,n);return Z7(n)}else if(n.promptFeedback)throw new rd(`Text not available. ${no(n)}`,n);return""},n.functionCall=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),bv(n.candidates[0]))throw new rd(`${no(n)}`,n);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),lL(n)[0]}else if(n.promptFeedback)throw new rd(`Function call not available. ${no(n)}`,n)},n.functionCalls=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),bv(n.candidates[0]))throw new rd(`${no(n)}`,n);return lL(n)}else if(n.promptFeedback)throw new rd(`Function call not available. ${no(n)}`,n)},n}function Z7(n){var e,t,r,s;const i=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const a of(s=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)a.text&&i.push(a.text),a.executableCode&&i.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&i.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return i.length>0?i.join(""):""}function lL(n){var e,t,r,s;const i=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const a of(s=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||s===void 0?void 0:s.parts)a.functionCall&&i.push(a.functionCall);if(i.length>0)return i}const J7=[zp.RECITATION,zp.SAFETY,zp.LANGUAGE];function bv(n){return!!n.finishReason&&J7.includes(n.finishReason)}function no(n){var e,t,r;let s="";if((!n.candidates||n.candidates.length===0)&&n.promptFeedback)s+="Response was blocked",!((e=n.promptFeedback)===null||e===void 0)&&e.blockReason&&(s+=` due to ${n.promptFeedback.blockReason}`),!((t=n.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(s+=`: ${n.promptFeedback.blockReasonMessage}`);else if(!((r=n.candidates)===null||r===void 0)&&r[0]){const i=n.candidates[0];bv(i)&&(s+=`Candidate was blocked due to ${i.finishReason}`,i.finishMessage&&(s+=`: ${i.finishMessage}`))}return s}function Gp(n){return this instanceof Gp?(this.v=n,this):new Gp(n)}function X7(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},a("next"),a("throw"),a("return"),s[Symbol.asyncIterator]=function(){return this},s;function a(f){r[f]&&(s[f]=function(p){return new Promise(function(m,g){i.push([f,p,m,g])>1||o(f,p)})})}function o(f,p){try{u(r[f](p))}catch(m){h(i[0][3],m)}}function u(f){f.value instanceof Gp?Promise.resolve(f.value.v).then(l,d):h(i[0][2],f)}function l(f){o("next",f)}function d(f){o("throw",f)}function h(f,p){f(p),i.shift(),i.length&&o(i[0][0],i[0][1])}}typeof SuppressedError=="function"&&SuppressedError;/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dL=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Y7(n){const e=n.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=tJ(e),[r,s]=t.tee();return{stream:eJ(r),response:Q7(s)}}async function Q7(n){const e=[],t=n.getReader();for(;;){const{done:r,value:s}=await t.read();if(r)return MC(rJ(e));e.push(s)}}function eJ(n){return X7(this,arguments,function*(){const t=n.getReader();for(;;){const{value:r,done:s}=yield Gp(t.read());if(s)break;yield yield Gp(MC(r))}})}function tJ(n){const e=n.getReader();return new ReadableStream({start(r){let s="";return i();function i(){return e.read().then(({value:a,done:o})=>{if(o){if(s.trim()){r.error(new xn("Failed to parse stream"));return}r.close();return}s+=a;let u=s.match(dL),l;for(;u;){try{l=JSON.parse(u[1])}catch{r.error(new xn(`Error parsing JSON response: "${u[1]}"`));return}r.enqueue(l),s=s.substring(u[0].length),u=s.match(dL)}return i()})}}})}function rJ(n){const e=n[n.length-1],t={promptFeedback:e==null?void 0:e.promptFeedback};for(const r of n){if(r.candidates)for(const s of r.candidates){const i=s.index;if(t.candidates||(t.candidates=[]),t.candidates[i]||(t.candidates[i]={index:s.index}),t.candidates[i].citationMetadata=s.citationMetadata,t.candidates[i].groundingMetadata=s.groundingMetadata,t.candidates[i].finishReason=s.finishReason,t.candidates[i].finishMessage=s.finishMessage,t.candidates[i].safetyRatings=s.safetyRatings,s.content&&s.content.parts){t.candidates[i].content||(t.candidates[i].content={role:s.content.role||"user",parts:[]});const a={};for(const o of s.content.parts)o.text&&(a.text=o.text),o.functionCall&&(a.functionCall=o.functionCall),o.executableCode&&(a.executableCode=o.executableCode),o.codeExecutionResult&&(a.codeExecutionResult=o.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),t.candidates[i].content.parts.push(a)}}r.usageMetadata&&(t.usageMetadata=r.usageMetadata)}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hL(n,e,t,r){const s=await Vp(e,xc.STREAM_GENERATE_CONTENT,n,!0,JSON.stringify(t),r);return Y7(s)}async function fL(n,e,t,r){const i=await(await Vp(e,xc.GENERATE_CONTENT,n,!1,JSON.stringify(t),r)).json();return{response:MC(i)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pL(n){if(n!=null){if(typeof n=="string")return{role:"system",parts:[{text:n}]};if(n.text)return{role:"system",parts:[n]};if(n.parts)return n.role?n:{role:"system",parts:n.parts}}}function Zp(n){let e=[];if(typeof n=="string")e=[{text:n}];else for(const t of n)typeof t=="string"?e.push({text:t}):e.push(t);return nJ(e)}function nJ(n){const e={role:"user",parts:[]},t={role:"function",parts:[]};let r=!1,s=!1;for(const i of n)"functionResponse"in i?(t.parts.push(i),s=!0):(e.parts.push(i),r=!0);if(r&&s)throw new xn("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!s)throw new xn("No content is provided for sending chat message.");return r?e:t}function sJ(n,e){var t;let r={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(t=e==null?void 0:e.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const s=n.generateContentRequest!=null;if(n.contents){if(s)throw new ro("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=n.contents}else if(s)r=Object.assign(Object.assign({},r),n.generateContentRequest);else{const i=Zp(n);r.contents=[i]}return{generateContentRequest:r}}function mL(n){let e;return n.contents?e=n:e={contents:[Zp(n)]},n.systemInstruction&&(e.systemInstruction=pL(n.systemInstruction)),e}function iJ(n){return typeof n=="string"||Array.isArray(n)?{content:Zp(n)}:n}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gL=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],aJ={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function oJ(n){let e=!1;for(const t of n){const{role:r,parts:s}=t;if(!e&&r!=="user")throw new xn(`First content should be with role 'user', got ${r}`);if(!rL.includes(r))throw new xn(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(rL)}`);if(!Array.isArray(s))throw new xn("Content should have 'parts' property with an array of Parts");if(s.length===0)throw new xn("Each Content should have at least one part");const i={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const o of s)for(const u of gL)u in o&&(i[u]+=1);const a=aJ[r];for(const o of gL)if(!a.includes(o)&&i[o]>0)throw new xn(`Content with role '${r}' can't contain '${o}' part`);e=!0}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yL="SILENT_ERROR";class cJ{constructor(e,t,r,s={}){this.model=t,this.params=r,this._requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r!=null&&r.history&&(oJ(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var r,s,i,a,o,u;await this._sendPromise;const l=Zp(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,l]},h=Object.assign(Object.assign({},this._requestOptions),t);let f;return this._sendPromise=this._sendPromise.then(()=>fL(this._apiKey,this.model,d,h)).then(p=>{var m;if(p.response.candidates&&p.response.candidates.length>0){this._history.push(l);const g=Object.assign({parts:[],role:"model"},(m=p.response.candidates)===null||m===void 0?void 0:m[0].content);this._history.push(g)}else{const g=no(p.response);g&&console.warn(`sendMessage() was unsuccessful. ${g}. Inspect response object for details.`)}f=p}),await this._sendPromise,f}async sendMessageStream(e,t={}){var r,s,i,a,o,u;await this._sendPromise;const l=Zp(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(s=this.params)===null||s===void 0?void 0:s.generationConfig,tools:(i=this.params)===null||i===void 0?void 0:i.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,l]},h=Object.assign(Object.assign({},this._requestOptions),t),f=hL(this._apiKey,this.model,d,h);return this._sendPromise=this._sendPromise.then(()=>f).catch(p=>{throw new Error(yL)}).then(p=>p.response).then(p=>{if(p.candidates&&p.candidates.length>0){this._history.push(l);const m=Object.assign({},p.candidates[0].content);m.role||(m.role="model"),this._history.push(m)}else{const m=no(p);m&&console.warn(`sendMessageStream() was unsuccessful. ${m}. Inspect response object for details.`)}}).catch(p=>{p.message!==yL&&console.error(p)}),f}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uJ(n,e,t,r){return(await Vp(e,xc.COUNT_TOKENS,n,!1,JSON.stringify(t),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lJ(n,e,t,r){return(await Vp(e,xc.EMBED_CONTENT,n,!1,JSON.stringify(t),r)).json()}async function dJ(n,e,t,r){const s=t.requests.map(a=>Object.assign(Object.assign({},a),{model:e}));return(await Vp(e,xc.BATCH_EMBED_CONTENTS,n,!1,JSON.stringify({requests:s}),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wL{constructor(e,t,r={}){this.apiKey=e,this._requestOptions=r,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=pL(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var r;const s=mL(e),i=Object.assign(Object.assign({},this._requestOptions),t);return fL(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}async generateContentStream(e,t={}){var r;const s=mL(e),i=Object.assign(Object.assign({},this._requestOptions),t);return hL(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},s),i)}startChat(e){var t;return new cJ(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const r=sJ(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),s=Object.assign(Object.assign({},this._requestOptions),t);return uJ(this.apiKey,this.model,r,s)}async embedContent(e,t={}){const r=iJ(e),s=Object.assign(Object.assign({},this._requestOptions),t);return lJ(this.apiKey,this.model,r,s)}async batchEmbedContents(e,t={}){const r=Object.assign(Object.assign({},this._requestOptions),t);return dJ(this.apiKey,this.model,e,r)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bL{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new xn("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new wL(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,r){if(!e.name)throw new ro("Cached content must contain a `name` field.");if(!e.model)throw new ro("Cached content must contain a `model` field.");const s=["model","systemInstruction"];for(const a of s)if(t!=null&&t[a]&&e[a]&&(t==null?void 0:t[a])!==e[a]){if(a==="model"){const o=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,u=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(o===u)continue}throw new ro(`Different value for "${a}" specified in modelParams (${t[a]}) and cachedContent (${e[a]})`)}const i=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new wL(this.apiKey,i,r)}}function Jp(n){if(typeof n=="object"&&n!==null){const e={...n};"additionalProperties"in e&&delete e.additionalProperties,"$schema"in e&&delete e.$schema;for(const t in e)t in e&&(Array.isArray(e[t])?e[t]=e[t].map(Jp):typeof e[t]=="object"&&e[t]!==null&&(e[t]=Jp(e[t])));return e}return n}function _L(n){const e=Jp(Zi(n)),{$schema:t,...r}=e;return r}function hJ(n){const e=Jp(n),{$schema:t,...r}=e;return r}function fJ(n){const e=n._getType();return Ha.isInstance(n)?n.role:e==="tool"?e:n.name??e}function pJ(n){switch(n){case"ai":case"model":return"model";case"system":return"system";case"human":return"user";case"tool":case"function":return"function";default:throw new Error(`Unknown / unsupported author: ${n}`)}}function mJ(n){if("mimeType"in n&&"data"in n)return{inlineData:{mimeType:n.mimeType,data:n.data}};if("mimeType"in n&&"fileUri"in n)return{fileData:{mimeType:n.mimeType,fileUri:n.fileUri}};throw new Error("Invalid media content")}function gJ(n,e){if(typeof n.content=="string"&&n.content!=="")return[{text:n.content}];let t=[],r=[],s=[];return"tool_calls"in n&&Array.isArray(n.tool_calls)&&n.tool_calls.length>0?t=n.tool_calls.map(i=>({functionCall:{name:i.name,args:i.args}})):n.getType()==="tool"&&n.name&&n.content?r=[{functionResponse:{name:n.name,response:n.content}}]:Array.isArray(n.content)&&(s=n.content.map(i=>{var a;if(i.type==="text")return{text:i.text};if(i.type==="executableCode")return{executableCode:i.executableCode};if(i.type==="codeExecutionResult")return{codeExecutionResult:i.codeExecutionResult};if(i.type==="image_url"){if(!e)throw new Error("This model does not support images");let o;if(typeof i.image_url=="string")o=i.image_url;else if(typeof i.image_url=="object"&&"url"in i.image_url)o=i.image_url.url;else throw new Error("Please provide image as base64 encoded data URL");const[u,l]=o.split(",");if(!u.startsWith("data:"))throw new Error("Please provide image as base64 encoded data URL");const[d,h]=u.replace(/^data:/,"").split(";");if(h!=="base64")throw new Error("Please provide image as base64 encoded data URL");return{inlineData:{data:l,mimeType:d}}}else{if(i.type==="media")return mJ(i);if(i.type==="tool_use")return{functionCall:{name:i.name,args:i.input}};if((a=i.type)!=null&&a.includes("/")&&i.type.split("/").length===2&&"data"in i&&typeof i.data=="string")return{inlineData:{mimeType:i.type,data:i.data}}}throw new Error(`Unknown content type ${i.type}`)})),[...s,...t,...r]}function vL(n,e,t=!1){return n.reduce((r,s,i)=>{if(!Gf(s))throw new Error("Unsupported message input");const a=fJ(s);if(a==="system"&&i!==0)throw new Error("System message should be the first one");const o=pJ(a),u=r.content[r.content.length];if(!r.mergeWithPreviousContent&&u&&u.role===o)throw new Error("Google Generative AI requires alternate messages between authors");const l=gJ(s,e);if(r.mergeWithPreviousContent){const f=r.content[r.content.length-1];if(!f)throw new Error("There was a problem parsing your system message. Please try a prompt without one.");return f.parts.push(...l),{mergeWithPreviousContent:!1,content:r.content}}let d=o;(d==="function"||d==="system"&&!t)&&(d="user");const h={role:d,parts:l};return{mergeWithPreviousContent:a==="system"&&!t,content:[...r.content,h]}},{content:[],mergeWithPreviousContent:!1}).content}function yJ(n,e){var l,d,h;if(!n.candidates||n.candidates.length===0||!n.candidates[0])return{generations:[],llmOutput:{filters:n.promptFeedback}};const t=n.functionCalls(),[r]=n.candidates,{content:s,...i}=r;let a;(s==null?void 0:s.parts.length)===1&&s.parts[0].text?a=s.parts[0].text:a=s.parts.map(f=>"text"in f?{type:"text",text:f.text}:"executableCode"in f?{type:"executableCode",executableCode:f.executableCode}:"codeExecutionResult"in f?{type:"codeExecutionResult",codeExecutionResult:f.codeExecutionResult}:f);let o="";return typeof a=="string"?o=a:"text"in a[0]&&(o=a[0].text),{generations:[{text:o,message:new Dr({content:a,tool_calls:t==null?void 0:t.map(f=>({...f,type:"tool_call"})),additional_kwargs:{...i},usage_metadata:e==null?void 0:e.usageMetadata}),generationInfo:i}],llmOutput:{tokenUsage:{promptTokens:(l=e==null?void 0:e.usageMetadata)==null?void 0:l.input_tokens,completionTokens:(d=e==null?void 0:e.usageMetadata)==null?void 0:d.output_tokens,totalTokens:(h=e==null?void 0:e.usageMetadata)==null?void 0:h.total_tokens}}}}function wJ(n,e){if(!n.candidates||n.candidates.length===0)return null;const t=n.functionCalls(),[r]=n.candidates,{content:s,...i}=r;let a;s!=null&&s.parts&&s.parts.every(l=>"text"in l)?a=s.parts.map(l=>l.text).join(""):s.parts&&(a=s.parts.map(l=>"text"in l?{type:"text",text:l.text}:"executableCode"in l?{type:"executableCode",executableCode:l.executableCode}:"codeExecutionResult"in l?{type:"codeExecutionResult",codeExecutionResult:l.codeExecutionResult}:l));let o="";a&&typeof a=="string"?o=a:a&&typeof a=="object"&&"text"in a[0]&&(o=a[0].text);const u=[];return t&&u.push(...t.map(l=>({...l,args:JSON.stringify(l.args),index:e.index,type:"tool_call_chunk"}))),new Ln({text:o,message:new nr({content:a||"",name:s?s.role:void 0,tool_call_chunks:u,additional_kwargs:{},usage_metadata:e.usageMetadata}),generationInfo:i})}function bJ(n){return n.every(e=>"functionDeclarations"in e&&Array.isArray(e.functionDeclarations))?n:[{functionDeclarations:n.map(e=>{if(Zl(e)){const t=_L(e.schema);return{name:e.name,description:e.description,parameters:t}}return Op(e)?{name:e.function.name,description:e.function.description??"A function available to call.",parameters:hJ(e.function.parameters)}:e})}]}class SL extends aC{static lc_name(){return"GoogleGenerativeAIToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","google_genai","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await this.zodSchema.safeParseAsync(e);if(t.success)return t.data;throw new Gl(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.errors)}`,JSON.stringify(e,null,2))}async parseResult(e){const t=e.flatMap(i=>{const{message:a}=i;return!("tool_calls"in a)||!Array.isArray(a.tool_calls)?[]:a.tool_calls});if(t[0]===void 0)throw new Error("No parseable tool calls provided to GoogleGenerativeAIToolsOutputParser.");const[r]=t;return await this._validateResult(r.args)}}function xL(n,e){const t=_J(n),r=SJ(t,e);return{tools:t,toolConfig:r}}function _J(n){let e=[];const t=[];return n.forEach(s=>{if(Zl(s)){const[i]=bJ([s]);i.functionDeclarations&&e.push(...i.functionDeclarations)}else if(Op(s)){const{functionDeclarations:i}=vJ(s);if(i)e.push(...i);else throw new Error("Failed to convert OpenAI structured tool to GenerativeAI tool")}else t.push(s)}),t.find(s=>"functionDeclarations"in s)?t.map(s=>{if((e==null?void 0:e.length)>0&&"functionDeclarations"in s){const i={functionDeclarations:[...s.functionDeclarations||[],...e]};return e=[],i}return s}):[...t,...e.length>0?[{functionDeclarations:e}]:[]]}function vJ(n){return{functionDeclarations:[{name:n.function.name,description:n.function.description,parameters:Jp(n.function.parameters)}]}}function SJ(n,e){if(!n.length||!e)return;const{toolChoice:t,allowedFunctionNames:r}=e,s={any:td.ANY,auto:td.AUTO,none:td.NONE};if(t&&["any","auto","none"].includes(t))return{functionCallingConfig:{mode:s[t]??"MODE_UNSPECIFIED",allowedFunctionNames:r}};if(typeof t=="string"||r)return{functionCallingConfig:{mode:td.ANY,allowedFunctionNames:[...r??[],...t&&typeof t=="string"?[t]:[]]}}}class xJ extends os{static lc_name(){return"ChatGoogleGenerativeAI"}get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}get lc_aliases(){return{apiKey:"google_api_key"}}get _isMultimodalModel(){return this.model.includes("vision")||this.model.startsWith("gemini-1.5")||this.model.startsWith("gemini-2")}constructor(e){var t,r;if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","google_genai"]}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gemini-pro"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gemini-pro"}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxOutputTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"safetySettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"convertSystemMessageToHumanContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.modelName=((t=e==null?void 0:e.model)==null?void 0:t.replace(/^models\//,""))??((r=e==null?void 0:e.modelName)==null?void 0:r.replace(/^models\//,""))??this.model,this.model=this.modelName,this.maxOutputTokens=(e==null?void 0:e.maxOutputTokens)??this.maxOutputTokens,this.maxOutputTokens&&this.maxOutputTokens<0)throw new Error("`maxOutputTokens` must be a positive integer");if(this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.temperature&&(this.temperature<0||this.temperature>2))throw new Error("`temperature` must be in the range of [0.0,2.0]");if(this.topP=(e==null?void 0:e.topP)??this.topP,this.topP&&this.topP<0)throw new Error("`topP` must be a positive integer");if(this.topP&&this.topP>1)throw new Error("`topP` must be below 1.");if(this.topK=(e==null?void 0:e.topK)??this.topK,this.topK&&this.topK<0)throw new Error("`topK` must be a positive integer");if(this.stopSequences=(e==null?void 0:e.stopSequences)??this.stopSequences,this.apiKey=(e==null?void 0:e.apiKey)??Br("GOOGLE_API_KEY"),!this.apiKey)throw new Error("Please set an API key for Google GenerativeAI in the environment variable GOOGLE_API_KEY or in the `apiKey` field of the ChatGoogleGenerativeAI constructor");if(this.safetySettings=(e==null?void 0:e.safetySettings)??this.safetySettings,this.safetySettings&&this.safetySettings.length>0&&new Set(this.safetySettings.map(i=>i.category)).size!==this.safetySettings.length)throw new Error("The categories in `safetySettings` array must be unique");this.streaming=(e==null?void 0:e.streaming)??this.streaming,this.client=new bL(this.apiKey).getGenerativeModel({model:this.model,safetySettings:this.safetySettings,generationConfig:{candidateCount:1,stopSequences:this.stopSequences,maxOutputTokens:this.maxOutputTokens,temperature:this.temperature,topP:this.topP,topK:this.topK,...e!=null&&e.json?{responseMimeType:"application/json"}:{}}},{apiVersion:e==null?void 0:e.apiVersion,baseUrl:e==null?void 0:e.baseUrl}),this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage}useCachedContent(e,t,r){this.apiKey&&(this.client=new bL(this.apiKey).getGenerativeModelFromCachedContent(e,t,r))}get useSystemInstruction(){return typeof this.convertSystemMessageToHumanContent=="boolean"?!this.convertSystemMessageToHumanContent:this.computeUseSystemInstruction}get computeUseSystemInstruction(){return this.modelName==="gemini-1.0-pro-001"||this.modelName.startsWith("gemini-pro-vision")||this.modelName.startsWith("gemini-1.0-pro-vision")?!1:this.modelName!=="gemini-pro"}getLsParams(e){return{ls_provider:"google_genai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:this.client.generationConfig.temperature,ls_max_tokens:this.client.generationConfig.maxOutputTokens,ls_stop:e.stop}}_combineLLMOutput(){return[]}_llmType(){return"googlegenerativeai"}bindTools(e,t){var r;return this.bind({tools:(r=xL(e))==null?void 0:r.tools,...t})}invocationParams(e){var r;const t=(r=e==null?void 0:e.tools)!=null&&r.length?xL(e.tools,{toolChoice:e.tool_choice,allowedFunctionNames:e.allowedFunctionNames}):void 0;return{...t!=null&&t.tools?{tools:t.tools}:{},...t!=null&&t.toolConfig?{toolConfig:t.toolConfig}:{}}}async _generate(e,t,r){var d;const s=vL(e,this._isMultimodalModel,this.useSystemInstruction);let i=s;if(s[0].role==="system"){const[h]=s;this.client.systemInstruction=h,i=s.slice(1)}const a=this.invocationParams(t);if(this.streaming){const h={},f=this._streamResponseChunks(e,t,r),p={};for await(const g of f){const y=((d=g.generationInfo)==null?void 0:d.completion)??0;p[y]===void 0?p[y]=g:p[y]=p[y].concat(g)}return{generations:Object.entries(p).sort(([g],[y])=>parseInt(g,10)-parseInt(y,10)).map(([g,y])=>y),llmOutput:{estimatedTokenUsage:h}}}const o=await this.completionWithRetry({...a,contents:i});let u;if("usageMetadata"in o.response){const h=o.response.usageMetadata;u={input_tokens:h.promptTokenCount??0,output_tokens:h.candidatesTokenCount??0,total_tokens:h.totalTokenCount??0}}const l=yJ(o.response,{usageMetadata:u});return await(r==null?void 0:r.handleLLMNewToken(l.generations[0].text??"")),l}async*_streamResponseChunks(e,t,r){const s=vL(e,this._isMultimodalModel,this.useSystemInstruction);let i=s;if(s[0].role==="system"){const[h]=s;this.client.systemInstruction=h,i=s.slice(1)}const o={...this.invocationParams(t),contents:i},u=await this.caller.callWithOptions({signal:t==null?void 0:t.signal},async()=>{const{stream:h}=await this.client.generateContentStream(o);return h});let l,d=0;for await(const h of u){if("usageMetadata"in h&&this.streamUsage!==!1&&t.streamUsage!==!1){const p=h.usageMetadata;if(!l)l={input_tokens:p.promptTokenCount??0,output_tokens:p.candidatesTokenCount??0,total_tokens:p.totalTokenCount??0};else{const m=(p.candidatesTokenCount??0)-l.output_tokens;l={input_tokens:0,output_tokens:m,total_tokens:m}}}const f=wJ(h,{usageMetadata:l,index:d});d+=1,f&&(yield f,await(r==null?void 0:r.handleLLMNewToken(f.text??"")))}}async completionWithRetry(e,t){return this.caller.callWithOptions({signal:t==null?void 0:t.signal},async()=>{var r;try{return await this.client.generateContent(e)}catch(s){throw(r=s.message)!=null&&r.includes("400 Bad Request")&&(s.status=400),s}})}withStructuredOutput(e,t){const r=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw;if(i==="jsonMode")throw new Error('ChatGoogleGenerativeAI only supports "functionCalling" as a method.');let o=s??"extract",u,l;if(Rp(r)){const m=_L(r);l=[{functionDeclarations:[{name:o,description:m.description??"A function available to call.",parameters:m}]}],u=new SL({returnSingle:!0,keyName:o,zodSchema:r})}else{let m;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(m=r,o=r.name):m={name:o,description:r.description??"",parameters:r},l=[{functionDeclarations:[m]}],u=new SL({returnSingle:!0,keyName:o})}const d=this.bind({tools:l,tool_choice:o});if(!a)return d.pipe(u).withConfig({runName:"ChatGoogleGenerativeAIStructuredOutput"});const h=as.assign({parsed:(m,g)=>u.invoke(m.raw,g)}),f=as.assign({parsed:()=>null}),p=h.withFallbacks({fallbacks:[f]});return Fn.from([{raw:d},p]).withConfig({runName:"StructuredOutputRunnable"})}}const NC="RFC3986",$C={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},EJ="RFC1738",kJ=Array.isArray,gi=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),jC=1024,CJ=(n,e,t,r,s)=>{if(n.length===0)return n;let i=n;if(typeof n=="symbol"?i=Symbol.prototype.toString.call(n):typeof n!="string"&&(i=String(n)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<i.length;o+=jC){const u=i.length>=jC?i.slice(o,o+jC):i,l=[];for(let d=0;d<u.length;++d){let h=u.charCodeAt(d);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||s===EJ&&(h===40||h===41)){l[l.length]=u.charAt(d);continue}if(h<128){l[l.length]=gi[h];continue}if(h<2048){l[l.length]=gi[192|h>>6]+gi[128|h&63];continue}if(h<55296||h>=57344){l[l.length]=gi[224|h>>12]+gi[128|h>>6&63]+gi[128|h&63];continue}d+=1,h=65536+((h&1023)<<10|u.charCodeAt(d)&1023),l[l.length]=gi[240|h>>18]+gi[128|h>>12&63]+gi[128|h>>6&63]+gi[128|h&63]}a+=l.join("")}return a};function PJ(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function EL(n,e){if(kJ(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const AJ=Object.prototype.hasOwnProperty,kL={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},yi=Array.isArray,TJ=Array.prototype.push,CL=function(n,e){TJ.apply(n,yi(e)?e:[e])},IJ=Date.prototype.toISOString,cr={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:CJ,encodeValuesOnly:!1,format:NC,formatter:$C[NC],indices:!1,serializeDate(n){return IJ.call(n)},skipNulls:!1,strictNullHandling:!1};function OJ(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const LC={};function PL(n,e,t,r,s,i,a,o,u,l,d,h,f,p,m,g,y,w){let S=n,_=w,v=0,A=!1;for(;(_=_.get(LC))!==void 0&&!A;){const I=_.get(n);if(v+=1,typeof I<"u"){if(I===v)throw new RangeError("Cyclic object value");A=!0}typeof _.get(LC)>"u"&&(v=0)}if(typeof l=="function"?S=l(e,S):S instanceof Date?S=f==null?void 0:f(S):t==="comma"&&yi(S)&&(S=EL(S,function(I){return I instanceof Date?f==null?void 0:f(I):I})),S===null){if(i)return u&&!g?u(e,cr.encoder,y,"key",p):e;S=""}if(OJ(S)||PJ(S)){if(u){const I=g?e:u(e,cr.encoder,y,"key",p);return[(m==null?void 0:m(I))+"="+(m==null?void 0:m(u(S,cr.encoder,y,"value",p)))]}return[(m==null?void 0:m(e))+"="+(m==null?void 0:m(String(S)))]}const k=[];if(typeof S>"u")return k;let C;if(t==="comma"&&yi(S))g&&u&&(S=EL(S,u)),C=[{value:S.length>0?S.join(",")||null:void 0}];else if(yi(l))C=l;else{const I=Object.keys(S);C=d?I.sort(d):I}const E=o?String(e).replace(/\./g,"%2E"):String(e),N=r&&yi(S)&&S.length===1?E+"[]":E;if(s&&yi(S)&&S.length===0)return N+"[]";for(let I=0;I<C.length;++I){const $=C[I],O=typeof $=="object"&&typeof $.value<"u"?$.value:S[$];if(a&&O===null)continue;const T=h&&o?$.replace(/\./g,"%2E"):$,L=yi(S)?typeof t=="function"?t(N,T):N:N+(h?"."+T:"["+T+"]");w.set(n,v);const U=new WeakMap;U.set(LC,w),CL(k,PL(O,L,t,r,s,i,a,o,t==="comma"&&g&&yi(S)?null:u,l,d,h,f,p,m,g,y,U))}return k}function RJ(n=cr){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||cr.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=NC;if(typeof n.format<"u"){if(!AJ.call($C,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=$C[t];let s=cr.filter;(typeof n.filter=="function"||yi(n.filter))&&(s=n.filter);let i;if(n.arrayFormat&&n.arrayFormat in kL?i=n.arrayFormat:"indices"in n?i=n.indices?"indices":"repeat":i=cr.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:cr.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:cr.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:cr.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:cr.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?cr.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:cr.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:cr.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:cr.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:cr.encodeValuesOnly,filter:s,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:cr.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:cr.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:cr.strictNullHandling}}function MJ(n,e={}){let t=n;const r=RJ(e);let s,i;typeof r.filter=="function"?(i=r.filter,t=i("",t)):yi(r.filter)&&(i=r.filter,s=i);const a=[];if(typeof t!="object"||t===null)return"";const o=kL[r.arrayFormat],u=o==="comma"&&r.commaRoundTrip;s||(s=Object.keys(t)),r.sort&&s.sort(r.sort);const l=new WeakMap;for(let f=0;f<s.length;++f){const p=s[f];r.skipNulls&&t[p]===null||CL(a,PL(t[p],p,o,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}const d=a.join(r.delimiter);let h=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),d.length>0?h+d:""}const nd="4.82.0";let AL=!1,Xp,TL,IL,FC,OL,RL,ML,NL,$L;function NJ(n,e={auto:!1}){if(AL)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(Xp)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${Xp}'\``);AL=e.auto,Xp=n.kind,TL=n.fetch,IL=n.FormData,FC=n.File,OL=n.ReadableStream,RL=n.getMultipartRequestOptions,ML=n.getDefaultAgent,NL=n.fileFromPath,$L=n.isFsReadStream}class $J{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function jJ({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import  from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,r,s,i;try{t=fetch,r=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:r,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new $J(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}Xp||NJ(jJ(),{auto:!0});class Qe extends Error{}class $r extends Qe{constructor(e,t,r,s){super(`${$r.makeMessage(e,t,r)}`),this.status=e,this.headers=s,this.request_id=s==null?void 0:s["x-request-id"],this.error=t;const i=t;this.code=i==null?void 0:i.code,this.param=i==null?void 0:i.param,this.type=i==null?void 0:i.type}static makeMessage(e,t,r){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,r,s){if(!e||!s)return new _v({message:r,cause:qC(t)});const i=t==null?void 0:t.error;return e===400?new jL(e,i,r,s):e===401?new LL(e,i,r,s):e===403?new FL(e,i,r,s):e===404?new DL(e,i,r,s):e===409?new BL(e,i,r,s):e===422?new UL(e,i,r,s):e===429?new qL(e,i,r,s):e>=500?new KL(e,i,r,s):new $r(e,i,r,s)}}class ls extends $r{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class _v extends $r{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class vv extends _v{constructor({message:e}={}){super({message:e??"Request timed out."})}}class jL extends $r{}class LL extends $r{}class FL extends $r{}class DL extends $r{}class BL extends $r{}class UL extends $r{}class qL extends $r{}class KL extends $r{}class HL extends Qe{constructor(){super("Could not parse response content as the length limit was reached")}}class WL extends Qe{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Ec{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const r=Ec.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(Ec.NEWLINE_REGEXP);return r&&s.pop(),s.length===1&&!r?(this.buffer.push(s[0]),[]):(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),r||(this.buffer=[s.pop()||""]),s)}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Qe(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Qe(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Qe("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}Ec.NEWLINE_CHARS=new Set([`
`,"\r"]),Ec.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function zL(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class wi{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let i=!1;try{for await(const a of LJ(e,t))if(!i){if(a.data.startsWith("[DONE]")){i=!0;continue}if(a.event===null){let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(o&&o.error)throw new $r(void 0,o.error,void 0,void 0);yield o}else{let o;try{o=JSON.parse(a.data)}catch(u){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),u}if(a.event=="error")throw new $r(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}i=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{i||t.abort()}}return new wi(s,t)}static fromReadableStream(e,t){let r=!1;async function*s(){const a=new Ec,o=zL(e);for await(const u of o)for(const l of a.decode(u))yield l;for(const u of a.flush())yield u}async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of s())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||t.abort()}}return new wi(i,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),s=i=>({next:()=>{if(i.length===0){const a=r.next();e.push(a),t.push(a)}return i.shift()}});return[new wi(()=>s(e),this.controller),new wi(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const r=new TextEncoder;return new OL({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:a}=await t.next();if(a)return s.close();const o=r.encode(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)==null?void 0:s.call(t))}})}}async function*LJ(n,e){if(!n.body)throw e.abort(),new Qe("Attempted to iterate over a response with no body");const t=new BJ,r=new Ec,s=zL(n.body);for await(const i of FJ(s))for(const a of r.decode(i)){const o=t.decode(a);o&&(yield o)}for(const i of r.flush()){const a=t.decode(i);a&&(yield a)}}async function*FJ(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let s=new Uint8Array(e.length+r.length);s.set(e),s.set(r,e.length),e=s;let i;for(;(i=DJ(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}function DJ(n){for(let r=0;r<n.length-2;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}class BJ{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,s]=UJ(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function UJ(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}const VL=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",GL=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Sv(n),Sv=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",qJ=n=>GL(n)||VL(n)||$L(n);async function ZL(n,e,t){var s;if(n=await n,GL(n))return n;if(VL(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=Sv(i)?[await i.arrayBuffer()]:[i];return new FC(a,e,t)}const r=await KJ(n);if(e||(e=WJ(n)??"unknown_file"),!(t!=null&&t.type)){const i=(s=r[0])==null?void 0:s.type;typeof i=="string"&&(t={...t,type:i})}return new FC(r,e,t)}async function KJ(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Sv(n))e.push(await n.arrayBuffer());else if(zJ(n))for await(const r of n)e.push(r);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${(t=n==null?void 0:n.constructor)==null?void 0:t.name}; props: ${HJ(n)}`);return e}function HJ(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function WJ(n){var e;return DC(n.name)||DC(n.filename)||((e=DC(n.path))==null?void 0:e.split(/[\\/]/).pop())}const DC=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},zJ=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",JL=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",sd=async n=>{const e=await VJ(n.body);return RL(e,n)},VJ=async n=>{const e=new IL;return await Promise.all(Object.entries(n||{}).map(([t,r])=>BC(e,t,r))),e},BC=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(qJ(t)){const r=await ZL(t);n.append(e,r)}else if(Array.isArray(t))await Promise.all(t.map(r=>BC(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,s])=>BC(n,`${e}[${r}]`,s)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var GJ=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},ZJ=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},xv;async function XL(n){const{response:e}=n;if(n.options.stream)return id("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):wi.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const t=e.headers.get("content-type");if((t==null?void 0:t.includes("application/json"))||(t==null?void 0:t.includes("application/vnd.api+json"))){const i=await e.json();return id("response",e.status,e.url,e.headers,i),YL(i,e)}const s=await e.text();return id("response",e.status,e.url,e.headers,s),s}function YL(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class Ev extends Promise{constructor(e,t=XL){super(r=>{r(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Ev(this.responsePromise,async t=>YL(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class JJ{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=UC("maxRetries",t),this.timeout=UC("timeout",r),this.httpAgent=s,this.fetch=i??TL}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...rX(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${aX()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async s=>{const i=s&&Sv(s==null?void 0:s.body)?new DataView(await s.body.arrayBuffer()):(s==null?void 0:s.body)instanceof DataView?s.body:(s==null?void 0:s.body)instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s==null?void 0:s.body)?new DataView(s.body.buffer):s==null?void 0:s.body;return{method:e,path:t,...s,body:i}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var g;const{method:r,path:s,query:i,headers:a={}}=e,o=ArrayBuffer.isView(e.body)||e.__binaryRequest&&typeof e.body=="string"?e.body:JL(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,u=this.calculateContentLength(o),l=this.buildURL(s,i);"timeout"in e&&UC("timeout",e.timeout);const d=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??ML(l),f=d+1e3;typeof((g=h==null?void 0:h.options)==null?void 0:g.timeout)=="number"&&f>(h.options.timeout??0)&&(h.options.timeout=f),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const p=this.buildHeaders({options:e,headers:a,contentLength:u,retryCount:t});return{req:{method:r,...o&&{body:o},headers:p,...h&&{agent:h},signal:e.signal??null},url:l,timeout:d}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:s}){const i={};r&&(i["content-length"]=r);const a=this.defaultHeaders(e);return iF(i,a),iF(i,t),JL(e.body)&&Xp!=="node"&&delete i["content-type"],oF(a,"x-stainless-retry-count")===void 0&&oF(t,"x-stainless-retry-count")===void 0&&(i["x-stainless-retry-count"]=String(s)),this.validateHeaders(i,t),i}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,r,s){return $r.generate(e,t,r,s)}request(e,t=null){return new Ev(this.makeRequest(e,t))}async makeRequest(e,t){var h,f;const r=await e,s=r.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(r);const{req:i,url:a,timeout:o}=this.buildRequest(r,{retryCount:s-t});if(await this.prepareRequest(i,{url:a,options:r}),id("request",a,r,i.headers),(h=r.signal)!=null&&h.aborted)throw new ls;const u=new AbortController,l=await this.fetchWithTimeout(a,i,o,u).catch(qC);if(l instanceof Error){if((f=r.signal)!=null&&f.aborted)throw new ls;if(t)return this.retryRequest(r,t);throw l.name==="AbortError"?new vv:new _v({cause:l})}const d=YJ(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){const S=`retrying, ${t} attempts remaining`;return id(`response (error; ${S})`,l.status,a,d),this.retryRequest(r,t,d)}const p=await l.text().catch(S=>qC(S).message),m=nX(p),g=m?void 0:p;throw id(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,l.status,a,d,g),this.makeStatusError(l.status,m,g,d)}return{response:l,options:r,controller:u}}requestAPIList(e,t){const r=this.makeRequest(t,null);return new XJ(this,r,e)}buildURL(e,t){const r=iX(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return nF(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new Qe(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,s){const{signal:i,...a}=t||{};i&&i.addEventListener("abort",()=>s.abort());const o=setTimeout(()=>s.abort(),r),u={signal:s.signal,...a};return u.method&&(u.method=u.method.toUpperCase()),this.fetch.call(void 0,e,u).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r){let s;const i=r==null?void 0:r["retry-after-ms"];if(i){const o=parseFloat(i);Number.isNaN(o)||(s=o)}const a=r==null?void 0:r["retry-after"];if(a&&!s){const o=parseFloat(a);Number.isNaN(o)?s=Date.parse(a)-Date.now():s=o*1e3}if(!(s&&0<=s&&s<60*1e3)){const o=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,o)}return await Yp(s),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const i=t-e,a=Math.min(.5*Math.pow(2,i),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${nd}`}}class QL{constructor(e,t,r,s){xv.set(this,void 0),GJ(this,xv,e,"f"),this.options=s,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Qe("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[s,i]of r)e.url.searchParams.set(s,i);t.query=void 0,t.path=e.url.toString()}return await ZJ(this,xv,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(xv=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class XJ extends Ev{constructor(e,t,r){super(t,async s=>new r(e,s.response,await XL(s),s.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const YJ=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const r=t.toString();return e[r.toLowerCase()]||e[r]}}),QJ={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},En=n=>typeof n=="object"&&n!==null&&!nF(n)&&Object.keys(n).every(e=>sF(QJ,e)),eX=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":nd,"X-Stainless-OS":tF(Deno.build.os),"X-Stainless-Arch":eF(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":nd,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":nd,"X-Stainless-OS":tF(process.platform),"X-Stainless-Arch":eF(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=tX();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":nd,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":nd,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function tX(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const s=r[1]||0,i=r[2]||0,a=r[3]||0;return{browser:e,version:`${s}.${i}.${a}`}}}return null}const eF=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",tF=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let rF;const rX=()=>rF??(rF=eX()),nX=n=>{try{return JSON.parse(n)}catch{return}},sX=/^[a-z][a-z0-9+.-]*:/i,iX=n=>sX.test(n),Yp=n=>new Promise(e=>setTimeout(e,n)),UC=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Qe(`${n} must be an integer`);if(e<0)throw new Qe(`${n} must be a positive integer`);return e},qC=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},kv=n=>{var e,t,r,s,i;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[n])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(s=(r=Deno.env)==null?void 0:r.get)==null?void 0:s.call(r,n))==null?void 0:i.trim()};function nF(n){if(!n)return!0;for(const e in n)return!1;return!0}function sF(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function iF(n,e){for(const t in e){if(!sF(e,t))continue;const r=t.toLowerCase();if(!r)continue;const s=e[t];s===null?delete n[r]:s!==void 0&&(n[r]=s)}}const aF=new Set(["authorization","api-key"]);function id(n,...e){var t;if(typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"){const r=e.map(s=>{if(!s)return s;if(s.headers){const a={...s,headers:{...s.headers}};for(const o in s.headers)aF.has(o.toLowerCase())&&(a.headers[o]="REDACTED");return a}let i=null;for(const a in s)aF.has(a.toLowerCase())&&(i??(i={...s}),i[a]="REDACTED");return i??s});console.log(`OpenAI:DEBUG:${n}`,...r)}}const aX=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),oX=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",cX=n=>typeof(n==null?void 0:n.get)=="function",oF=(n,e)=>{var r;const t=e.toLowerCase();if(cX(n)){const s=((r=e[0])==null?void 0:r.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(i,a,o)=>a+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const a=n.get(i);if(a)return a}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i};function KC(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}class uX extends QL{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class js extends QL{constructor(e,t,r,s){super(e,t,r,s),this.data=r.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var r;const e=this.getPaginatedItems();if(!e.length)return null;const t=(r=e[e.length-1])==null?void 0:r.id;return t?{params:{after:t}}:null}}class yt{constructor(e){this._client=e}}let cF=class extends yt{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}},HC=class extends yt{constructor(){super(...arguments),this.completions=new cF(this._client)}};HC.Completions=cF;class uF extends yt{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class lF extends yt{create(e,t){return this._client.post("/audio/transcriptions",sd({body:e,...t}))}}class dF extends yt{create(e,t){return this._client.post("/audio/translations",sd({body:e,...t}))}}class Qp extends yt{constructor(){super(...arguments),this.transcriptions=new lF(this._client),this.translations=new dF(this._client),this.speech=new uF(this._client)}}Qp.Transcriptions=lF,Qp.Translations=dF,Qp.Speech=uF;class WC extends yt{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return En(e)?this.list({},e):this._client.getAPIList("/batches",zC,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class zC extends js{}WC.BatchesPage=zC;class VC extends yt{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return En(e)?this.list({},e):this._client.getAPIList("/assistants",GC,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class GC extends js{}VC.AssistantsPage=GC;function hF(n){return typeof n.parse=="function"}const ad=n=>(n==null?void 0:n.role)==="assistant",fF=n=>(n==null?void 0:n.role)==="function",pF=n=>(n==null?void 0:n.role)==="tool";var Ls=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Wt=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ZC,Cv,Pv,em,tm,Av,rm,ta,nm,Tv,Iv,od,mF;class gF{constructor(){ZC.add(this),this.controller=new AbortController,Cv.set(this,void 0),Pv.set(this,()=>{}),em.set(this,()=>{}),tm.set(this,void 0),Av.set(this,()=>{}),rm.set(this,()=>{}),ta.set(this,{}),nm.set(this,!1),Tv.set(this,!1),Iv.set(this,!1),od.set(this,!1),Ls(this,Cv,new Promise((e,t)=>{Ls(this,Pv,e,"f"),Ls(this,em,t,"f")}),"f"),Ls(this,tm,new Promise((e,t)=>{Ls(this,Av,e,"f"),Ls(this,rm,t,"f")}),"f"),Wt(this,Cv,"f").catch(()=>{}),Wt(this,tm,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},Wt(this,ZC,"m",mF).bind(this))},0)}_connected(){this.ended||(Wt(this,Pv,"f").call(this),this._emit("connect"))}get ended(){return Wt(this,nm,"f")}get errored(){return Wt(this,Tv,"f")}get aborted(){return Wt(this,Iv,"f")}abort(){this.controller.abort()}on(e,t){return(Wt(this,ta,"f")[e]||(Wt(this,ta,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=Wt(this,ta,"f")[e];if(!r)return this;const s=r.findIndex(i=>i.listener===t);return s>=0&&r.splice(s,1),this}once(e,t){return(Wt(this,ta,"f")[e]||(Wt(this,ta,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Ls(this,od,!0,"f"),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Ls(this,od,!0,"f"),await Wt(this,tm,"f")}_emit(e,...t){if(Wt(this,nm,"f"))return;e==="end"&&(Ls(this,nm,!0,"f"),Wt(this,Av,"f").call(this));const r=Wt(this,ta,"f")[e];if(r&&(Wt(this,ta,"f")[e]=r.filter(s=>!s.once),r.forEach(({listener:s})=>s(...t))),e==="abort"){const s=t[0];!Wt(this,od,"f")&&!(r!=null&&r.length)&&Promise.reject(s),Wt(this,em,"f").call(this,s),Wt(this,rm,"f").call(this,s),this._emit("end");return}if(e==="error"){const s=t[0];!Wt(this,od,"f")&&!(r!=null&&r.length)&&Promise.reject(s),Wt(this,em,"f").call(this,s),Wt(this,rm,"f").call(this,s),this._emit("end")}}_emitFinal(){}}Cv=new WeakMap,Pv=new WeakMap,em=new WeakMap,tm=new WeakMap,Av=new WeakMap,rm=new WeakMap,ta=new WeakMap,nm=new WeakMap,Tv=new WeakMap,Iv=new WeakMap,od=new WeakMap,ZC=new WeakSet,mF=function(e){if(Ls(this,Tv,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new ls),e instanceof ls)return Ls(this,Iv,!0,"f"),this._emit("abort",e);if(e instanceof Qe)return this._emit("error",e);if(e instanceof Error){const t=new Qe(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Qe(String(e)))};function lX(n,e){const t={...n};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function yF(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function dX(n,{parser:e,callback:t}){const r={...n};return Object.defineProperties(r,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),r}function sm(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function hX(n,e){return!e||!wF(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,tool_calls:t.message.tool_calls??[]}}))}:JC(n,e)}function JC(n,e){const t=n.choices.map(r=>{var s;if(r.finish_reason==="length")throw new HL;if(r.finish_reason==="content_filter")throw new WL;return{...r,message:{...r.message,tool_calls:((s=r.message.tool_calls)==null?void 0:s.map(i=>pX(e,i)))??[],parsed:r.message.content&&!r.message.refusal?fX(e,r.message.content):null}}});return{...n,choices:t}}function fX(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function pX(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:sm(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function mX(n,e){var r;if(!n)return!1;const t=(r=n.tools)==null?void 0:r.find(s=>{var i;return((i=s.function)==null?void 0:i.name)===e.function.name});return sm(t)||(t==null?void 0:t.function.strict)||!1}function wF(n){var e;return yF(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>sm(t)||t.type==="function"&&t.function.strict===!0))??!1}function gX(n){for(const e of n??[]){if(e.type!=="function")throw new Qe(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new Qe(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var kn=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Hr,XC,Ov,YC,QC,eP,bF,tP;const _F=10;class vF extends gF{constructor(){super(...arguments),Hr.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(fF(e)||pF(e))&&e.content)this._emit("functionCallResult",e.content);else if(ad(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(ad(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new Qe("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),kn(this,Hr,"m",XC).call(this)}async finalMessage(){return await this.done(),kn(this,Hr,"m",Ov).call(this)}async finalFunctionCall(){return await this.done(),kn(this,Hr,"m",YC).call(this)}async finalFunctionCallResult(){return await this.done(),kn(this,Hr,"m",QC).call(this)}async totalUsage(){return await this.done(),kn(this,Hr,"m",eP).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=kn(this,Hr,"m",Ov).call(this);t&&this._emit("finalMessage",t);const r=kn(this,Hr,"m",XC).call(this);r&&this._emit("finalContent",r);const s=kn(this,Hr,"m",YC).call(this);s&&this._emit("finalFunctionCall",s);const i=kn(this,Hr,"m",QC).call(this);i!=null&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",kn(this,Hr,"m",eP).call(this))}async _createChatCompletion(e,t,r){const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),kn(this,Hr,"m",bF).call(this,t);const i=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(JC(i,t))}async _runChatCompletion(e,t,r){for(const s of t.messages)this._addMessage(s,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){var f;const s="function",{function_call:i="auto",stream:a,...o}=t,u=typeof i!="string"&&(i==null?void 0:i.name),{maxChatCompletions:l=_F}=r||{},d={};for(const p of t.functions)d[p.name||p.function.name]=p;const h=t.functions.map(p=>({name:p.name||p.function.name,parameters:p.parameters,description:p.description}));for(const p of t.messages)this._addMessage(p,!1);for(let p=0;p<l;++p){const g=(f=(await this._createChatCompletion(e,{...o,function_call:i,functions:h,messages:[...this.messages]},r)).choices[0])==null?void 0:f.message;if(!g)throw new Qe("missing message in ChatCompletion response");if(!g.function_call)return;const{name:y,arguments:w}=g.function_call,S=d[y];if(S){if(u&&u!==y){const k=`Invalid function_call: ${JSON.stringify(y)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,name:y,content:k});continue}}else{const k=`Invalid function_call: ${JSON.stringify(y)}. Available options are: ${h.map(C=>JSON.stringify(C.name)).join(", ")}. Please try again`;this._addMessage({role:s,name:y,content:k});continue}let _;try{_=hF(S)?await S.parse(w):w}catch(k){this._addMessage({role:s,name:y,content:k instanceof Error?k.message:String(k)});continue}const v=await S.function(_,this),A=kn(this,Hr,"m",tP).call(this,v);if(this._addMessage({role:s,name:y,content:A}),u)return}}async _runTools(e,t,r){var p,m,g;const s="tool",{tool_choice:i="auto",stream:a,...o}=t,u=typeof i!="string"&&((p=i==null?void 0:i.function)==null?void 0:p.name),{maxChatCompletions:l=_F}=r||{},d=t.tools.map(y=>{if(sm(y)){if(!y.$callback)throw new Qe("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:y.$callback,name:y.function.name,description:y.function.description||"",parameters:y.function.parameters,parse:y.$parseRaw,strict:!0}}}return y}),h={};for(const y of d)y.type==="function"&&(h[y.function.name||y.function.function.name]=y.function);const f="tools"in t?d.map(y=>y.type==="function"?{type:"function",function:{name:y.function.name||y.function.function.name,parameters:y.function.parameters,description:y.function.description,strict:y.function.strict}}:y):void 0;for(const y of t.messages)this._addMessage(y,!1);for(let y=0;y<l;++y){const S=(m=(await this._createChatCompletion(e,{...o,tool_choice:i,tools:f,messages:[...this.messages]},r)).choices[0])==null?void 0:m.message;if(!S)throw new Qe("missing message in ChatCompletion response");if(!((g=S.tool_calls)!=null&&g.length))return;for(const _ of S.tool_calls){if(_.type!=="function")continue;const v=_.id,{name:A,arguments:k}=_.function,C=h[A];if(C){if(u&&u!==A){const $=`Invalid tool_call: ${JSON.stringify(A)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:s,tool_call_id:v,content:$});continue}}else{const $=`Invalid tool_call: ${JSON.stringify(A)}. Available options are: ${Object.keys(h).map(O=>JSON.stringify(O)).join(", ")}. Please try again`;this._addMessage({role:s,tool_call_id:v,content:$});continue}let E;try{E=hF(C)?await C.parse(k):k}catch($){const O=$ instanceof Error?$.message:String($);this._addMessage({role:s,tool_call_id:v,content:O});continue}const N=await C.function(E,this),I=kn(this,Hr,"m",tP).call(this,N);if(this._addMessage({role:s,tool_call_id:v,content:I}),u)return}}}}Hr=new WeakSet,XC=function(){return kn(this,Hr,"m",Ov).call(this).content??null},Ov=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(ad(t)){const{function_call:r,...s}=t,i={...s,content:t.content??null,refusal:t.refusal??null};return r&&(i.function_call=r),i}}throw new Qe("stream ended without producing a ChatCompletionMessage with role=assistant")},YC=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const s=this.messages[r];if(ad(s)&&(s!=null&&s.function_call))return s.function_call;if(ad(s)&&((e=s==null?void 0:s.tool_calls)!=null&&e.length))return(t=s.tool_calls.at(-1))==null?void 0:t.function}},QC=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(fF(t)&&t.content!=null||pF(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var s;return r.role==="assistant"&&((s=r.tool_calls)==null?void 0:s.some(i=>i.type==="function"&&i.id===t.tool_call_id))}))return t.content}},eP=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},bF=function(e){if(e.n!=null&&e.n>1)throw new Qe("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},tP=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class im extends vF{static runFunctions(e,t,r){const s=new im,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new im,i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e,t=!0){super._addMessage(e,t),ad(e)&&e.content&&this._emit("content",e.content)}}const SF=1,xF=2,EF=4,kF=8,CF=16,PF=32,AF=64,TF=128,IF=256,OF=TF|IF,RF=CF|PF|OF|AF,MF=SF|xF|RF,NF=EF|kF,yX=MF|NF,Sr={STR:SF,NUM:xF,ARR:EF,OBJ:kF,NULL:CF,BOOL:PF,NAN:AF,INFINITY:TF,MINUS_INFINITY:IF,INF:OF,SPECIAL:RF,ATOM:MF,COLLECTION:NF,ALL:yX};class wX extends Error{}class bX extends Error{}function _X(n,e=Sr.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return vX(n.trim(),e)}const vX=(n,e)=>{const t=n.length;let r=0;const s=f=>{throw new wX(`${f} at position ${r}`)},i=f=>{throw new bX(`${f} at position ${r}`)},a=()=>(h(),r>=t&&s("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?u():n[r]==="["?l():n.substring(r,r+4)==="null"||Sr.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||Sr.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||Sr.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||Sr.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||Sr.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||Sr.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):d()),o=()=>{const f=r;let p=!1;for(r++;r<t&&(n[r]!=='"'||p&&n[r-1]==="\\");)p=n[r]==="\\"?!p:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(f,++r-Number(p)))}catch(m){i(String(m))}else if(Sr.STR&e)try{return JSON.parse(n.substring(f,r-Number(p))+'"')}catch{return JSON.parse(n.substring(f,n.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},u=()=>{r++,h();const f={};try{for(;n[r]!=="}";){if(h(),r>=t&&Sr.OBJ&e)return f;const p=o();h(),r++;try{const m=a();Object.defineProperty(f,p,{value:m,writable:!0,enumerable:!0,configurable:!0})}catch(m){if(Sr.OBJ&e)return f;throw m}h(),n[r]===","&&r++}}catch{if(Sr.OBJ&e)return f;s("Expected '}' at end of object")}return r++,f},l=()=>{r++;const f=[];try{for(;n[r]!=="]";)f.push(a()),h(),n[r]===","&&r++}catch{if(Sr.ARR&e)return f;s("Expected ']' at end of array")}return r++,f},d=()=>{if(r===0){n==="-"&&Sr.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n)}catch(p){if(Sr.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}i(String(p))}}const f=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(Sr.NUM&e)&&s("Unterminated number literal");try{return JSON.parse(n.substring(f,r))}catch{n.substring(f,r)==="-"&&Sr.NUM&e&&s("Not sure what '-' is");try{return JSON.parse(n.substring(f,n.lastIndexOf("e")))}catch(m){i(String(m))}}},h=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return a()},$F=n=>_X(n,Sr.ALL^Sr.NUM);var cd=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},Tt=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},ur,ra,ud,so,rP,Rv,nP,sP,iP,Mv,aP,jF;class am extends vF{constructor(e){super(),ur.add(this),ra.set(this,void 0),ud.set(this,void 0),so.set(this,void 0),cd(this,ra,e,"f"),cd(this,ud,[],"f")}get currentChatCompletionSnapshot(){return Tt(this,so,"f")}static fromReadableStream(e){const t=new am(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const s=new am(t);return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}async _createChatCompletion(e,t,r){var a;super._createChatCompletion;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),Tt(this,ur,"m",rP).call(this);const i=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of i)Tt(this,ur,"m",nP).call(this,o);if((a=i.controller.signal)!=null&&a.aborted)throw new ls;return this._addChatCompletion(Tt(this,ur,"m",Mv).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Tt(this,ur,"m",rP).call(this),this._connected();const s=wi.fromReadableStream(e,this.controller);let i;for await(const o of s)i&&i!==o.id&&this._addChatCompletion(Tt(this,ur,"m",Mv).call(this)),Tt(this,ur,"m",nP).call(this,o),i=o.id;if((a=s.controller.signal)!=null&&a.aborted)throw new ls;return this._addChatCompletion(Tt(this,ur,"m",Mv).call(this))}[(ra=new WeakMap,ud=new WeakMap,so=new WeakMap,ur=new WeakSet,rP=function(){this.ended||cd(this,so,void 0,"f")},Rv=function(t){let r=Tt(this,ud,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Tt(this,ud,"f")[t.index]=r,r)},nP=function(t){var s,i,a,o,u,l,d,h,f,p,m,g,y,w,S;if(this.ended)return;const r=Tt(this,ur,"m",jF).call(this,t);this._emit("chunk",t,r);for(const _ of t.choices){const v=r.choices[_.index];_.delta.content!=null&&((s=v.message)==null?void 0:s.role)==="assistant"&&((i=v.message)!=null&&i.content)&&(this._emit("content",_.delta.content,v.message.content),this._emit("content.delta",{delta:_.delta.content,snapshot:v.message.content,parsed:v.message.parsed})),_.delta.refusal!=null&&((a=v.message)==null?void 0:a.role)==="assistant"&&((o=v.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:_.delta.refusal,snapshot:v.message.refusal}),((u=_.logprobs)==null?void 0:u.content)!=null&&((l=v.message)==null?void 0:l.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(d=_.logprobs)==null?void 0:d.content,snapshot:((h=v.logprobs)==null?void 0:h.content)??[]}),((f=_.logprobs)==null?void 0:f.refusal)!=null&&((p=v.message)==null?void 0:p.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(m=_.logprobs)==null?void 0:m.refusal,snapshot:((g=v.logprobs)==null?void 0:g.refusal)??[]});const A=Tt(this,ur,"m",Rv).call(this,v);v.finish_reason&&(Tt(this,ur,"m",iP).call(this,v),A.current_tool_call_index!=null&&Tt(this,ur,"m",sP).call(this,v,A.current_tool_call_index));for(const k of _.delta.tool_calls??[])A.current_tool_call_index!==k.index&&(Tt(this,ur,"m",iP).call(this,v),A.current_tool_call_index!=null&&Tt(this,ur,"m",sP).call(this,v,A.current_tool_call_index)),A.current_tool_call_index=k.index;for(const k of _.delta.tool_calls??[]){const C=(y=v.message.tool_calls)==null?void 0:y[k.index];C!=null&&C.type&&((C==null?void 0:C.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(w=C.function)==null?void 0:w.name,index:k.index,arguments:C.function.arguments,parsed_arguments:C.function.parsed_arguments,arguments_delta:((S=k.function)==null?void 0:S.arguments)??""}):(C==null||C.type,void 0))}}},sP=function(t,r){var a,o,u;if(Tt(this,ur,"m",Rv).call(this,t).done_tool_calls.has(r))return;const i=(a=t.message.tool_calls)==null?void 0:a[r];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){const l=(u=(o=Tt(this,ra,"f"))==null?void 0:o.tools)==null?void 0:u.find(d=>d.type==="function"&&d.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:r,arguments:i.function.arguments,parsed_arguments:sm(l)?l.$parseRaw(i.function.arguments):l!=null&&l.function.strict?JSON.parse(i.function.arguments):null})}else i.type},iP=function(t){var s,i;const r=Tt(this,ur,"m",Rv).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const a=Tt(this,ur,"m",aP).call(this);this._emit("content.done",{content:t.message.content,parsed:a?a.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(s=t.logprobs)!=null&&s.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(i=t.logprobs)!=null&&i.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Mv=function(){if(this.ended)throw new Qe("stream has ended, this shouldn't happen");const t=Tt(this,so,"f");if(!t)throw new Qe("request ended without sending any chunks");return cd(this,so,void 0,"f"),cd(this,ud,[],"f"),SX(t,Tt(this,ra,"f"))},aP=function(){var r;const t=(r=Tt(this,ra,"f"))==null?void 0:r.response_format;return yF(t)?t:null},jF=function(t){var r,s,i,a;let o=Tt(this,so,"f");const{choices:u,...l}=t;o?Object.assign(o,l):o=cd(this,so,{...l,choices:[]},"f");for(const{delta:d,finish_reason:h,index:f,logprobs:p=null,...m}of t.choices){let g=o.choices[f];if(g||(g=o.choices[f]={finish_reason:h,index:f,message:{},logprobs:p,...m}),p)if(!g.logprobs)g.logprobs=Object.assign({},p);else{const{content:k,refusal:C,...E}=p;Object.assign(g.logprobs,E),k&&((r=g.logprobs).content??(r.content=[]),g.logprobs.content.push(...k)),C&&((s=g.logprobs).refusal??(s.refusal=[]),g.logprobs.refusal.push(...C))}if(h&&(g.finish_reason=h,Tt(this,ra,"f")&&wF(Tt(this,ra,"f")))){if(h==="length")throw new HL;if(h==="content_filter")throw new WL}if(Object.assign(g,m),!d)continue;const{content:y,refusal:w,function_call:S,role:_,tool_calls:v,...A}=d;if(Object.assign(g.message,A),w&&(g.message.refusal=(g.message.refusal||"")+w),_&&(g.message.role=_),S&&(g.message.function_call?(S.name&&(g.message.function_call.name=S.name),S.arguments&&((i=g.message.function_call).arguments??(i.arguments=""),g.message.function_call.arguments+=S.arguments)):g.message.function_call=S),y&&(g.message.content=(g.message.content||"")+y,!g.message.refusal&&Tt(this,ur,"m",aP).call(this)&&(g.message.parsed=$F(g.message.content))),v){g.message.tool_calls||(g.message.tool_calls=[]);for(const{index:k,id:C,type:E,function:N,...I}of v){const $=(a=g.message.tool_calls)[k]??(a[k]={});Object.assign($,I),C&&($.id=C),E&&($.type=E),N&&($.function??($.function={name:N.name??"",arguments:""})),N!=null&&N.name&&($.function.name=N.name),N!=null&&N.arguments&&($.function.arguments+=N.arguments,mX(Tt(this,ra,"f"),$)&&($.function.parsed_arguments=$F($.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new wi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function SX(n,e){const{id:t,choices:r,created:s,model:i,system_fingerprint:a,...o}=n,u={...o,id:t,choices:r.map(({message:l,finish_reason:d,index:h,logprobs:f,...p})=>{if(!d)throw new Qe(`missing finish_reason for choice ${h}`);const{content:m=null,function_call:g,tool_calls:y,...w}=l,S=l.role;if(!S)throw new Qe(`missing role for choice ${h}`);if(g){const{arguments:_,name:v}=g;if(_==null)throw new Qe(`missing function_call.arguments for choice ${h}`);if(!v)throw new Qe(`missing function_call.name for choice ${h}`);return{...p,message:{content:m,function_call:{arguments:_,name:v},role:S,refusal:l.refusal??null},finish_reason:d,index:h,logprobs:f}}return y?{...p,index:h,finish_reason:d,logprobs:f,message:{...w,role:S,content:m,refusal:l.refusal??null,tool_calls:y.map((_,v)=>{const{function:A,type:k,id:C,...E}=_,{arguments:N,name:I,...$}=A||{};if(C==null)throw new Qe(`missing choices[${h}].tool_calls[${v}].id
${Nv(n)}`);if(k==null)throw new Qe(`missing choices[${h}].tool_calls[${v}].type
${Nv(n)}`);if(I==null)throw new Qe(`missing choices[${h}].tool_calls[${v}].function.name
${Nv(n)}`);if(N==null)throw new Qe(`missing choices[${h}].tool_calls[${v}].function.arguments
${Nv(n)}`);return{...E,id:C,type:k,function:{...$,name:I,arguments:N}}})}}:{...p,message:{...w,content:m,role:S,refusal:l.refusal??null},finish_reason:d,index:h,logprobs:f}}),created:s,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return hX(u,e)}function Nv(n){return JSON.stringify(n)}function Tre(n){}class ld extends am{static fromReadableStream(e){const t=new ld(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){const s=new ld(null),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,r){const s=new ld(t),i={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}let LF=class extends yt{parse(e,t){return gX(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>JC(r,e))}runFunctions(e,t){return e.stream?ld.runFunctions(this._client,e,t):im.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?ld.runTools(this._client,e,t):im.runTools(this._client,e,t)}stream(e,t){return am.createChatCompletion(this._client,e,t)}};class oP extends yt{constructor(){super(...arguments),this.completions=new LF(this._client)}}(function(n){n.Completions=LF})(oP||(oP={}));class FF extends yt{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class cP extends yt{constructor(){super(...arguments),this.sessions=new FF(this._client)}}cP.Sessions=FF;var Oe=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},qn=function(n,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(n,t):s?s.value=t:e.set(n,t),t},jr,uP,bi,$v,Fs,kc,dd,Cc,jv,Kn,Lv,Fv,om,cm,um,DF,BF,UF,qF,KF,HF,WF;class Ds extends gF{constructor(){super(...arguments),jr.add(this),uP.set(this,[]),bi.set(this,{}),$v.set(this,{}),Fs.set(this,void 0),kc.set(this,void 0),dd.set(this,void 0),Cc.set(this,void 0),jv.set(this,void 0),Kn.set(this,void 0),Lv.set(this,void 0),Fv.set(this,void 0),om.set(this,void 0)}[(uP=new WeakMap,bi=new WeakMap,$v=new WeakMap,Fs=new WeakMap,kc=new WeakMap,dd=new WeakMap,Cc=new WeakMap,jv=new WeakMap,Kn=new WeakMap,Lv=new WeakMap,Fv=new WeakMap,om=new WeakMap,jr=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",s=>{const i=t.shift();i?i.resolve(s):e.push(s)}),this.on("end",()=>{r=!0;for(const s of t)s.resolve(void 0);t.length=0}),this.on("abort",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),this.on("error",s=>{r=!0;for(const i of t)i.reject(s);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Ds;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var i;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const s=wi.fromReadableStream(e,this.controller);for await(const a of s)Oe(this,jr,"m",cm).call(this,a);if((i=s.controller.signal)!=null&&i.aborted)throw new ls;return this._addRun(Oe(this,jr,"m",um).call(this))}toReadableStream(){return new wi(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,s,i){const a=new Ds;return a._run(()=>a._runToolAssistantStream(e,t,r,s,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,s,i){var l;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},u=await e.submitToolOutputs(t,r,o,{...i,signal:this.controller.signal});this._connected();for await(const d of u)Oe(this,jr,"m",cm).call(this,d);if((l=u.controller.signal)!=null&&l.aborted)throw new ls;return this._addRun(Oe(this,jr,"m",um).call(this))}static createThreadAssistantStream(e,t,r){const s=new Ds;return s._run(()=>s._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,r,s){const i=new Ds;return i._run(()=>i._runAssistantStream(e,t,r,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return Oe(this,Lv,"f")}currentRun(){return Oe(this,Fv,"f")}currentMessageSnapshot(){return Oe(this,Fs,"f")}currentRunStepSnapshot(){return Oe(this,om,"f")}async finalRunSteps(){return await this.done(),Object.values(Oe(this,bi,"f"))}async finalMessages(){return await this.done(),Object.values(Oe(this,$v,"f"))}async finalRun(){if(await this.done(),!Oe(this,kc,"f"))throw Error("Final run was not received.");return Oe(this,kc,"f")}async _createThreadAssistantStream(e,t,r){var o;const s=r==null?void 0:r.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const i={...t,stream:!0},a=await e.createAndRun(i,{...r,signal:this.controller.signal});this._connected();for await(const u of a)Oe(this,jr,"m",cm).call(this,u);if((o=a.controller.signal)!=null&&o.aborted)throw new ls;return this._addRun(Oe(this,jr,"m",um).call(this))}async _createAssistantStream(e,t,r,s){var u;const i=s==null?void 0:s.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await e.create(t,a,{...s,signal:this.controller.signal});this._connected();for await(const l of o)Oe(this,jr,"m",cm).call(this,l);if((u=o.controller.signal)!=null&&u.aborted)throw new ls;return this._addRun(Oe(this,jr,"m",um).call(this))}static accumulateDelta(e,t){for(const[r,s]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=s;continue}let i=e[r];if(i==null){e[r]=s;continue}if(r==="index"||r==="type"){e[r]=s;continue}if(typeof i=="string"&&typeof s=="string")i+=s;else if(typeof i=="number"&&typeof s=="number")i+=s;else if(KC(i)&&KC(s))i=this.accumulateDelta(i,s);else if(Array.isArray(i)&&Array.isArray(s)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...s);continue}for(const a of s){if(!KC(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const u=i[o];u==null?i.push(a):i[o]=this.accumulateDelta(u,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${s}, accValue: ${i}`);e[r]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,s){return await this._createAssistantStream(t,e,r,s)}async _runToolAssistantStream(e,t,r,s,i){return await this._createToolAssistantStream(r,e,t,s,i)}}cm=function(e){if(!this.ended)switch(qn(this,Lv,e,"f"),Oe(this,jr,"m",UF).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":Oe(this,jr,"m",WF).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Oe(this,jr,"m",BF).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":Oe(this,jr,"m",DF).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},um=function(){if(this.ended)throw new Qe("stream has ended, this shouldn't happen");if(!Oe(this,kc,"f"))throw Error("Final run has not been received");return Oe(this,kc,"f")},DF=function(e){const[t,r]=Oe(this,jr,"m",KF).call(this,e,Oe(this,Fs,"f"));qn(this,Fs,t,"f"),Oe(this,$v,"f")[t.id]=t;for(const s of r){const i=t.content[s.index];(i==null?void 0:i.type)=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if(s.type=="text"&&s.text){let i=s.text,a=t.content[s.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=Oe(this,dd,"f")){if(Oe(this,Cc,"f"))switch(Oe(this,Cc,"f").type){case"text":this._emit("textDone",Oe(this,Cc,"f").text,Oe(this,Fs,"f"));break;case"image_file":this._emit("imageFileDone",Oe(this,Cc,"f").image_file,Oe(this,Fs,"f"));break}qn(this,dd,s.index,"f")}qn(this,Cc,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(Oe(this,dd,"f")!==void 0){const s=e.data.content[Oe(this,dd,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,Oe(this,Fs,"f"));break;case"text":this._emit("textDone",s.text,Oe(this,Fs,"f"));break}}Oe(this,Fs,"f")&&this._emit("messageDone",e.data),qn(this,Fs,void 0,"f")}},BF=function(e){const t=Oe(this,jr,"m",qF).call(this,e);switch(qn(this,om,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const i of r.step_details.tool_calls)i.index==Oe(this,jv,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(Oe(this,Kn,"f")&&this._emit("toolCallDone",Oe(this,Kn,"f")),qn(this,jv,i.index,"f"),qn(this,Kn,t.step_details.tool_calls[i.index],"f"),Oe(this,Kn,"f")&&this._emit("toolCallCreated",Oe(this,Kn,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":qn(this,om,void 0,"f"),e.data.step_details.type=="tool_calls"&&Oe(this,Kn,"f")&&(this._emit("toolCallDone",Oe(this,Kn,"f")),qn(this,Kn,void 0,"f")),this._emit("runStepDone",e.data,t);break}},UF=function(e){Oe(this,uP,"f").push(e),this._emit("event",e)},qF=function(e){switch(e.event){case"thread.run.step.created":return Oe(this,bi,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=Oe(this,bi,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const s=Ds.accumulateDelta(t,r.delta);Oe(this,bi,"f")[e.data.id]=s}return Oe(this,bi,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":Oe(this,bi,"f")[e.data.id]=e.data;break}if(Oe(this,bi,"f")[e.data.id])return Oe(this,bi,"f")[e.data.id];throw new Error("No snapshot available")},KF=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=Oe(this,jr,"m",HF).call(this,i,a)}else t.content[i.index]=i,r.push(i);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},HF=function(e,t){return Ds.accumulateDelta(t,e)},WF=function(e){switch(qn(this,Fv,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":qn(this,kc,e.data,"f"),Oe(this,Kn,"f")&&(this._emit("toolCallDone",Oe(this,Kn,"f")),qn(this,Kn,void 0,"f"));break}};class lP extends yt{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return En(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,dP,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class dP extends js{}lP.MessagesPage=dP;class hP extends yt{retrieve(e,t,r,s={},i){return En(s)?this.retrieve(e,t,r,{},s):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(e,t,r={},s){return En(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,fP,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}}class fP extends js{}hP.RunStepsPage=fP;class lm extends yt{constructor(){super(...arguments),this.steps=new hP(this._client)}create(e,t,r){const{include:s,...i}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:s},body:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(e,t={},r){return En(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,pP,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}createAndStream(e,t,r){return Ds.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...s}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=a.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await Yp(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,r){return Ds.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,s){const i=await this.submitToolOutputs(e,t,r,s);return await this.poll(e,i.id,s)}submitToolOutputsStream(e,t,r,s){return Ds.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,s)}}class pP extends js{}lm.RunsPage=pP,lm.Steps=hP,lm.RunStepsPage=fP;class hd extends yt{constructor(){super(...arguments),this.runs=new lm(this._client),this.messages=new lP(this._client)}create(e={},t){return En(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return Ds.createThreadAssistantStream(e,this._client.beta.threads,t)}}hd.Runs=lm,hd.RunsPage=pP,hd.Messages=lP,hd.MessagesPage=dP;const xX=async n=>{const e=await Promise.allSettled(n),t=e.filter(s=>s.status==="rejected");if(t.length){for(const s of t)console.error(s.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const s of e)s.status==="fulfilled"&&r.push(s.value);return r};let mP=class extends yt{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},r){return En(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Dv,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t,r);return await this.poll(e,s.id,r)}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const i=await this.retrieve(e,t,{...r,headers:s}).withResponse(),a=i.data;switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=i.response.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await Yp(o);break;case"failed":case"completed":return a}}}async upload(e,t,r){const s=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:s.id},r)}async uploadAndPoll(e,t,r){const s=await this.upload(e,t,r);return await this.poll(e,s.id,r)}};class Dv extends js{}mP.VectorStoreFilesPage=Dv;class zF extends yt{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(e,t,r){const s=await this.create(e,t);return await this.poll(e,s.id,r)}listFiles(e,t,r={},s){return En(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Dv,{query:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}async poll(e,t,r){const s={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(s["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:i,response:a}=await this.retrieve(e,t,{...r,headers:s}).withResponse();switch(i.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const u=a.headers.get("openai-poll-after-ms");if(u){const l=parseInt(u);isNaN(l)||(o=l)}}await Yp(o);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},s){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const i=(s==null?void 0:s.maxConcurrency)??5,a=Math.min(i,t.length),o=this._client,u=t.values(),l=[...r];async function d(f){for(let p of f){const m=await o.files.create({file:p,purpose:"assistants"},s);l.push(m.id)}}const h=Array(a).fill(u).map(d);return await xX(h),await this.createAndPoll(e,{file_ids:l})}}class fd extends yt{constructor(){super(...arguments),this.files=new mP(this._client),this.fileBatches=new zF(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e={},t){return En(e)?this.list({},e):this._client.getAPIList("/vector_stores",gP,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class gP extends js{}fd.VectorStoresPage=gP,fd.Files=mP,fd.VectorStoreFilesPage=Dv,fd.FileBatches=zF;class io extends yt{constructor(){super(...arguments),this.realtime=new cP(this._client),this.vectorStores=new fd(this._client),this.chat=new oP(this._client),this.assistants=new VC(this._client),this.threads=new hd(this._client)}}io.Realtime=cP,io.VectorStores=fd,io.VectorStoresPage=gP,io.Assistants=VC,io.AssistantsPage=GC,io.Threads=hd;class VF extends yt{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class GF extends yt{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}class yP extends yt{create(e,t){return this._client.post("/files",sd({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return En(e)?this.list({},e):this._client.getAPIList("/files",wP,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const s=new Set(["processed","error","deleted"]),i=Date.now();let a=await this.retrieve(e);for(;!a.status||!s.has(a.status);)if(await Yp(t),a=await this.retrieve(e),Date.now()-i>r)throw new vv({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class wP extends js{}yP.FileObjectsPage=wP;class bP extends yt{list(e,t={},r){return En(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,_P,{query:t,...r})}}class _P extends js{}bP.FineTuningJobCheckpointsPage=_P;class pd extends yt{constructor(){super(...arguments),this.checkpoints=new bP(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return En(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",vP,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return En(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,SP,{query:t,...r})}}class vP extends js{}class SP extends js{}pd.FineTuningJobsPage=vP,pd.FineTuningJobEventsPage=SP,pd.Checkpoints=bP,pd.FineTuningJobCheckpointsPage=_P;class dm extends yt{constructor(){super(...arguments),this.jobs=new pd(this._client)}}dm.Jobs=pd,dm.FineTuningJobsPage=vP,dm.FineTuningJobEventsPage=SP;class ZF extends yt{createVariation(e,t){return this._client.post("/images/variations",sd({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",sd({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class xP extends yt{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",EP,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class EP extends uX{}xP.ModelsPage=EP;class JF extends yt{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class XF extends yt{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,sd({body:t,...r}))}}class kP extends yt{constructor(){super(...arguments),this.parts=new XF(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}kP.Parts=XF;var YF;let it=class extends JJ{constructor({baseURL:e=kv("OPENAI_BASE_URL"),apiKey:t=kv("OPENAI_API_KEY"),organization:r=kv("OPENAI_ORG_ID")??null,project:s=kv("OPENAI_PROJECT_ID")??null,...i}={}){if(t===void 0)throw new Qe("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:r,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&oX())throw new Qe(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new VF(this),this.chat=new HC(this),this.embeddings=new GF(this),this.files=new yP(this),this.images=new ZF(this),this.audio=new Qp(this),this.moderations=new JF(this),this.models=new xP(this),this.fineTuning=new dm(this),this.beta=new io(this),this.batches=new WC(this),this.uploads=new kP(this),this._options=a,this.apiKey=t,this.organization=r,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return MJ(e,{arrayFormat:"brackets"})}};YF=it,it.OpenAI=YF,it.DEFAULT_TIMEOUT=6e5,it.OpenAIError=Qe,it.APIError=$r,it.APIConnectionError=_v,it.APIConnectionTimeoutError=vv,it.APIUserAbortError=ls,it.NotFoundError=DL,it.ConflictError=BL,it.RateLimitError=qL,it.BadRequestError=jL,it.AuthenticationError=LL,it.InternalServerError=KL,it.PermissionDeniedError=FL,it.UnprocessableEntityError=UL,it.toFile=ZL,it.fileFromPath=NL,it.Completions=VF,it.Chat=HC,it.Embeddings=GF,it.Files=yP,it.FileObjectsPage=wP,it.Images=ZF,it.Audio=Qp,it.Moderations=JF,it.Models=xP,it.ModelsPage=EP,it.FineTuning=dm,it.Beta=io,it.Batches=WC,it.BatchesPage=zC,it.Uploads=kP;const EX=Symbol("Let zodToJsonSchema decide on which parser to use"),kX={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},CX=n=>({...kX,...n}),PX=n=>{const e=CX(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function QF(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function kt(n,e,t,r,s){n[e]=t,QF(n,e,r,s)}var lt;(function(n){n.assertEqual=s=>s;function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const i={};for(const a of s)i[a]=a;return i},n.getValidEnumValues=s=>{const i=n.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(const o of i)a[o]=s[o];return n.objectValues(a)},n.objectValues=s=>n.objectKeys(s).map(function(i){return s[i]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},n.find=(s,i)=>{for(const a of s)if(i(a))return a},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(lt||(lt={}));var eD;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(eD||(eD={}));const ye=lt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ao=n=>{switch(typeof n){case"undefined":return ye.undefined;case"string":return ye.string;case"number":return isNaN(n)?ye.nan:ye.number;case"boolean":return ye.boolean;case"function":return ye.function;case"bigint":return ye.bigint;case"symbol":return ye.symbol;case"object":return Array.isArray(n)?ye.array:n===null?ye.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?ye.promise:typeof Map<"u"&&n instanceof Map?ye.map:typeof Set<"u"&&n instanceof Set?ye.set:typeof Date<"u"&&n instanceof Date?ye.date:ye.object;default:return ye.unknown}},ie=lt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class ds extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)r._errors.push(t(a));else{let o=r,u=0;for(;u<a.path.length;){const l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return s(this),r}static assert(e){if(!(e instanceof ds))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,lt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}ds.create=n=>new ds(n);const hm=(n,e)=>{let t;switch(n.code){case ie.invalid_type:n.received===ye.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case ie.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,lt.jsonStringifyReplacer)}`;break;case ie.unrecognized_keys:t=`Unrecognized key(s) in object: ${lt.joinValues(n.keys,", ")}`;break;case ie.invalid_union:t="Invalid input";break;case ie.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${lt.joinValues(n.options)}`;break;case ie.invalid_enum_value:t=`Invalid enum value. Expected ${lt.joinValues(n.options)}, received '${n.received}'`;break;case ie.invalid_arguments:t="Invalid function arguments";break;case ie.invalid_return_type:t="Invalid function return type";break;case ie.invalid_date:t="Invalid date";break;case ie.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:lt.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case ie.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case ie.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case ie.custom:t="Invalid input";break;case ie.invalid_intersection_types:t="Intersection results could not be merged";break;case ie.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case ie.not_finite:t="Number must be finite";break;default:t=e.defaultError,lt.assertNever(n)}return{message:t}};let AX=hm;function CP(){return AX}const PP=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,i=[...t,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="";const u=r.filter(l=>!!l).slice().reverse();for(const l of u)o=l(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}};function me(n,e){const t=CP(),r=PP({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===hm?void 0:hm].filter(s=>!!s)});n.common.issues.push(r)}class nn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return Le;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t){const i=await s.key,a=await s.value;r.push({key:i,value:a})}return nn.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return Le;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(r[i.value]=a.value)}return{status:e.value,value:r}}}const Le=Object.freeze({status:"aborted"}),fm=n=>({status:"dirty",value:n}),Cn=n=>({status:"valid",value:n}),tD=n=>n.status==="aborted",rD=n=>n.status==="dirty",md=n=>n.status==="valid",Bv=n=>typeof Promise<"u"&&n instanceof Promise;function Uv(n,e,t,r){if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(n)}function nD(n,e,t,r,s){if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}typeof SuppressedError=="function"&&SuppressedError;var Ce;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(Ce||(Ce={}));var pm,mm;class _i{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const sD=(n,e)=>{if(md(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new ds(n.common.issues);return this._error=t,this._error}}};function Ue(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{var u,l;const{message:d}=n;return a.code==="invalid_enum_value"?{message:d??o.defaultError}:typeof o.data>"u"?{message:(u=d??r)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=d??t)!==null&&l!==void 0?l:o.defaultError}},description:s}}class Ze{get description(){return this._def.description}_getType(e){return ao(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ao(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new nn,ctx:{common:e.parent.common,data:e.data,parsedType:ao(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Bv(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ao(e)},i=this._parseSync({data:e,path:s.path,parent:s});return sD(s,i)}"~validate"(e){var t,r;const s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ao(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:s});return md(i)?{value:i.value}:{issues:s.common.issues}}catch(i){!((r=(t=i==null?void 0:i.message)===null||t===void 0?void 0:t.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(i=>md(i)?{value:i.value}:{issues:s.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ao(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(Bv(s)?s:Promise.resolve(s));return sD(r,i)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const a=e(s),o=()=>i.addIssue({code:ie.custom,...r(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new aa({schema:this,typeName:Q.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Si.create(this,this._def)}nullable(){return Ac.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return vi.create(this)}promise(){return wm.create(this,this._def)}or(e){return Hv.create([this,e],this._def)}and(e){return Wv.create(this,e,this._def)}transform(e){return new aa({...Ue(this._def),schema:this,typeName:Q.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Jv({...Ue(this._def),innerType:this,defaultValue:t,typeName:Q.ZodDefault})}brand(){return new cD({typeName:Q.ZodBranded,type:this,...Ue(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Xv({...Ue(this._def),innerType:this,catchValue:t,typeName:Q.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Yv.create(this,e)}readonly(){return Qv.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const TX=/^c[^\s-]{8,}$/i,IX=/^[0-9a-z]+$/,OX=/^[0-9A-HJKMNP-TV-Z]{26}$/i,RX=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,MX=/^[a-z0-9_-]{21}$/i,NX=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,$X=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,jX=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,LX="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let AP;const FX=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,DX=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,BX=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,UX=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,qX=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,KX=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,iD="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",HX=new RegExp(`^${iD}$`);function aD(n){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`),e}function WX(n){return new RegExp(`^${aD(n)}$`)}function zX(n){let e=`${iD}T${aD(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function VX(n,e){return!!((e==="v4"||!e)&&FX.test(n)||(e==="v6"||!e)&&BX.test(n))}function GX(n,e){if(!NX.test(n))return!1;try{const[t]=n.split("."),r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||s===null||!s.typ||!s.alg||e&&s.alg!==e)}catch{return!1}}function ZX(n,e){return!!((e==="v4"||!e)&&DX.test(n)||(e==="v6"||!e)&&UX.test(n))}class na extends Ze{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==ye.string){const i=this._getOrReturnCtx(e);return me(i,{code:ie.invalid_type,expected:ye.string,received:i.parsedType}),Le}const r=new nn;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),me(s,{code:ie.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),me(s,{code:ie.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?me(s,{code:ie.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&me(s,{code:ie.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")jX.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"email",code:ie.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")AP||(AP=new RegExp(LX,"u")),AP.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"emoji",code:ie.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")RX.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"uuid",code:ie.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")MX.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"nanoid",code:ie.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")TX.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"cuid",code:ie.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")IX.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"cuid2",code:ie.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")OX.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"ulid",code:ie.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),me(s,{validation:"url",code:ie.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"regex",code:ie.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),me(s,{code:ie.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),me(s,{code:ie.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),me(s,{code:ie.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?zX(i).test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{code:ie.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?HX.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{code:ie.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?WX(i).test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{code:ie.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?$X.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"duration",code:ie.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?VX(e.data,i.version)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"ip",code:ie.invalid_string,message:i.message}),r.dirty()):i.kind==="jwt"?GX(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"jwt",code:ie.invalid_string,message:i.message}),r.dirty()):i.kind==="cidr"?ZX(e.data,i.version)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"cidr",code:ie.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?qX.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"base64",code:ie.invalid_string,message:i.message}),r.dirty()):i.kind==="base64url"?KX.test(e.data)||(s=this._getOrReturnCtx(e,s),me(s,{validation:"base64url",code:ie.invalid_string,message:i.message}),r.dirty()):lt.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:ie.invalid_string,...Ce.errToObj(r)})}_addCheck(e){return new na({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Ce.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Ce.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Ce.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Ce.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Ce.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Ce.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Ce.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Ce.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Ce.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Ce.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Ce.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Ce.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Ce.errToObj(e)})}datetime(e){var t,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(r=e==null?void 0:e.local)!==null&&r!==void 0?r:!1,...Ce.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...Ce.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Ce.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Ce.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...Ce.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Ce.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Ce.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Ce.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Ce.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Ce.errToObj(t)})}nonempty(e){return this.min(1,Ce.errToObj(e))}trim(){return new na({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new na({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new na({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}na.create=n=>{var e;return new na({checks:[],typeName:Q.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Ue(n)})};function JX(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,i=parseInt(n.toFixed(s).replace(".","")),a=parseInt(e.toFixed(s).replace(".",""));return i%a/Math.pow(10,s)}class gd extends Ze{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==ye.number){const i=this._getOrReturnCtx(e);return me(i,{code:ie.invalid_type,expected:ye.number,received:i.parsedType}),Le}let r;const s=new nn;for(const i of this._def.checks)i.kind==="int"?lt.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),me(r,{code:ie.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),me(r,{code:ie.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),me(r,{code:ie.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?JX(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),me(r,{code:ie.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),me(r,{code:ie.not_finite,message:i.message}),s.dirty()):lt.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Ce.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Ce.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Ce.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Ce.toString(t))}setLimit(e,t,r,s){return new gd({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Ce.toString(s)}]})}_addCheck(e){return new gd({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Ce.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Ce.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Ce.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Ce.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Ce.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Ce.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Ce.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Ce.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Ce.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&lt.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}gd.create=n=>new gd({checks:[],typeName:Q.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...Ue(n)});class yd extends Ze{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==ye.bigint)return this._getInvalidInput(e);let r;const s=new nn;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),me(r,{code:ie.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),me(r,{code:ie.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),me(r,{code:ie.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):lt.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return me(t,{code:ie.invalid_type,expected:ye.bigint,received:t.parsedType}),Le}gte(e,t){return this.setLimit("min",e,!0,Ce.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Ce.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Ce.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Ce.toString(t))}setLimit(e,t,r,s){return new yd({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:Ce.toString(s)}]})}_addCheck(e){return new yd({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Ce.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Ce.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Ce.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Ce.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Ce.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}yd.create=n=>{var e;return new yd({checks:[],typeName:Q.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...Ue(n)})};class TP extends Ze{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==ye.boolean){const r=this._getOrReturnCtx(e);return me(r,{code:ie.invalid_type,expected:ye.boolean,received:r.parsedType}),Le}return Cn(e.data)}}TP.create=n=>new TP({typeName:Q.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...Ue(n)});class gm extends Ze{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==ye.date){const i=this._getOrReturnCtx(e);return me(i,{code:ie.invalid_type,expected:ye.date,received:i.parsedType}),Le}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return me(i,{code:ie.invalid_date}),Le}const r=new nn;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),me(s,{code:ie.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),me(s,{code:ie.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):lt.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new gm({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Ce.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Ce.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}gm.create=n=>new gm({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:Q.ZodDate,...Ue(n)});class IP extends Ze{_parse(e){if(this._getType(e)!==ye.symbol){const r=this._getOrReturnCtx(e);return me(r,{code:ie.invalid_type,expected:ye.symbol,received:r.parsedType}),Le}return Cn(e.data)}}IP.create=n=>new IP({typeName:Q.ZodSymbol,...Ue(n)});class qv extends Ze{_parse(e){if(this._getType(e)!==ye.undefined){const r=this._getOrReturnCtx(e);return me(r,{code:ie.invalid_type,expected:ye.undefined,received:r.parsedType}),Le}return Cn(e.data)}}qv.create=n=>new qv({typeName:Q.ZodUndefined,...Ue(n)});class Kv extends Ze{_parse(e){if(this._getType(e)!==ye.null){const r=this._getOrReturnCtx(e);return me(r,{code:ie.invalid_type,expected:ye.null,received:r.parsedType}),Le}return Cn(e.data)}}Kv.create=n=>new Kv({typeName:Q.ZodNull,...Ue(n)});class OP extends Ze{constructor(){super(...arguments),this._any=!0}_parse(e){return Cn(e.data)}}OP.create=n=>new OP({typeName:Q.ZodAny,...Ue(n)});class wd extends Ze{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Cn(e.data)}}wd.create=n=>new wd({typeName:Q.ZodUnknown,...Ue(n)});class oo extends Ze{_parse(e){const t=this._getOrReturnCtx(e);return me(t,{code:ie.invalid_type,expected:ye.never,received:t.parsedType}),Le}}oo.create=n=>new oo({typeName:Q.ZodNever,...Ue(n)});class RP extends Ze{_parse(e){if(this._getType(e)!==ye.undefined){const r=this._getOrReturnCtx(e);return me(r,{code:ie.invalid_type,expected:ye.void,received:r.parsedType}),Le}return Cn(e.data)}}RP.create=n=>new RP({typeName:Q.ZodVoid,...Ue(n)});class vi extends Ze{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==ye.array)return me(t,{code:ie.invalid_type,expected:ye.array,received:t.parsedType}),Le;if(s.exactLength!==null){const a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(me(t,{code:a?ie.too_big:ie.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(me(t,{code:ie.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(me(t,{code:ie.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new _i(t,a,t.path,o)))).then(a=>nn.mergeArray(r,a));const i=[...t.data].map((a,o)=>s.type._parseSync(new _i(t,a,t.path,o)));return nn.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new vi({...this._def,minLength:{value:e,message:Ce.toString(t)}})}max(e,t){return new vi({...this._def,maxLength:{value:e,message:Ce.toString(t)}})}length(e,t){return new vi({...this._def,exactLength:{value:e,message:Ce.toString(t)}})}nonempty(e){return this.min(1,e)}}vi.create=(n,e)=>new vi({type:n,minLength:null,maxLength:null,exactLength:null,typeName:Q.ZodArray,...Ue(e)});function bd(n){if(n instanceof zt){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=Si.create(bd(r))}return new zt({...n._def,shape:()=>e})}else return n instanceof vi?new vi({...n._def,type:bd(n.element)}):n instanceof Si?Si.create(bd(n.unwrap())):n instanceof Ac?Ac.create(bd(n.unwrap())):n instanceof ia?ia.create(n.items.map(e=>bd(e))):n}class zt extends Ze{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=lt.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==ye.object){const l=this._getOrReturnCtx(e);return me(l,{code:ie.invalid_type,expected:ye.object,received:l.parsedType}),Le}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof oo&&this._def.unknownKeys==="strip"))for(const l in s.data)a.includes(l)||o.push(l);const u=[];for(const l of a){const d=i[l],h=s.data[l];u.push({key:{status:"valid",value:l},value:d._parse(new _i(s,h,s.path,l)),alwaysSet:l in s.data})}if(this._def.catchall instanceof oo){const l=this._def.unknownKeys;if(l==="passthrough")for(const d of o)u.push({key:{status:"valid",value:d},value:{status:"valid",value:s.data[d]}});else if(l==="strict")o.length>0&&(me(s,{code:ie.unrecognized_keys,keys:o}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const d of o){const h=s.data[d];u.push({key:{status:"valid",value:d},value:l._parse(new _i(s,h,s.path,d)),alwaysSet:d in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const l=[];for(const d of u){const h=await d.key,f=await d.value;l.push({key:h,value:f,alwaysSet:d.alwaysSet})}return l}).then(l=>nn.mergeObjectSync(r,l)):nn.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return Ce.errToObj,new zt({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var s,i,a,o;const u=(a=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,r).message)!==null&&a!==void 0?a:r.defaultError;return t.code==="unrecognized_keys"?{message:(o=Ce.errToObj(e).message)!==null&&o!==void 0?o:u}:{message:u}}}:{}})}strip(){return new zt({...this._def,unknownKeys:"strip"})}passthrough(){return new zt({...this._def,unknownKeys:"passthrough"})}extend(e){return new zt({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new zt({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Q.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new zt({...this._def,catchall:e})}pick(e){const t={};return lt.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new zt({...this._def,shape:()=>t})}omit(e){const t={};return lt.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new zt({...this._def,shape:()=>t})}deepPartial(){return bd(this)}partial(e){const t={};return lt.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}),new zt({...this._def,shape:()=>t})}required(e){const t={};return lt.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof Si;)i=i._def.innerType;t[r]=i}}),new zt({...this._def,shape:()=>t})}keyof(){return oD(lt.objectKeys(this.shape))}}zt.create=(n,e)=>new zt({shape:()=>n,unknownKeys:"strip",catchall:oo.create(),typeName:Q.ZodObject,...Ue(e)}),zt.strictCreate=(n,e)=>new zt({shape:()=>n,unknownKeys:"strict",catchall:oo.create(),typeName:Q.ZodObject,...Ue(e)}),zt.lazycreate=(n,e)=>new zt({shape:n,unknownKeys:"strip",catchall:oo.create(),typeName:Q.ZodObject,...Ue(e)});class Hv extends Ze{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new ds(o.ctx.common.issues));return me(t,{code:ie.invalid_union,unionErrors:a}),Le}if(t.common.async)return Promise.all(r.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i;const a=[];for(const u of r){const l={...t,common:{...t.common,issues:[]},parent:null},d=u._parseSync({data:t.data,path:t.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!i&&(i={result:d,ctx:l}),l.common.issues.length&&a.push(l.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(u=>new ds(u));return me(t,{code:ie.invalid_union,unionErrors:o}),Le}}get options(){return this._def.options}}Hv.create=(n,e)=>new Hv({options:n,typeName:Q.ZodUnion,...Ue(e)});const sa=n=>n instanceof Vv?sa(n.schema):n instanceof aa?sa(n.innerType()):n instanceof Gv?[n.value]:n instanceof Pc?n.options:n instanceof Zv?lt.objectValues(n.enum):n instanceof Jv?sa(n._def.innerType):n instanceof qv?[void 0]:n instanceof Kv?[null]:n instanceof Si?[void 0,...sa(n.unwrap())]:n instanceof Ac?[null,...sa(n.unwrap())]:n instanceof cD||n instanceof Qv?sa(n.unwrap()):n instanceof Xv?sa(n._def.innerType):[];class MP extends Ze{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ye.object)return me(t,{code:ie.invalid_type,expected:ye.object,received:t.parsedType}),Le;const r=this.discriminator,s=t.data[r],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(me(t,{code:ie.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),Le)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const s=new Map;for(const i of t){const a=sa(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new MP({typeName:Q.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...Ue(r)})}}function NP(n,e){const t=ao(n),r=ao(e);if(n===e)return{valid:!0,data:n};if(t===ye.object&&r===ye.object){const s=lt.objectKeys(e),i=lt.objectKeys(n).filter(o=>s.indexOf(o)!==-1),a={...n,...e};for(const o of i){const u=NP(n[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===ye.array&&r===ye.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<n.length;i++){const a=n[i],o=e[i],u=NP(a,o);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return t===ye.date&&r===ye.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class Wv extends Ze{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(i,a)=>{if(tD(i)||tD(a))return Le;const o=NP(i.value,a.value);return o.valid?((rD(i)||rD(a))&&t.dirty(),{status:t.value,value:o.data}):(me(r,{code:ie.invalid_intersection_types}),Le)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Wv.create=(n,e,t)=>new Wv({left:n,right:e,typeName:Q.ZodIntersection,...Ue(t)});class ia extends Ze{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ye.array)return me(r,{code:ie.invalid_type,expected:ye.array,received:r.parsedType}),Le;if(r.data.length<this._def.items.length)return me(r,{code:ie.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Le;!this._def.rest&&r.data.length>this._def.items.length&&(me(r,{code:ie.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((a,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new _i(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(i).then(a=>nn.mergeArray(t,a)):nn.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new ia({...this._def,rest:e})}}ia.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ia({items:n,typeName:Q.ZodTuple,rest:null,...Ue(e)})};class zv extends Ze{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ye.object)return me(r,{code:ie.invalid_type,expected:ye.object,received:r.parsedType}),Le;const s=[],i=this._def.keyType,a=this._def.valueType;for(const o in r.data)s.push({key:i._parse(new _i(r,o,r.path,o)),value:a._parse(new _i(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?nn.mergeObjectAsync(t,s):nn.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof Ze?new zv({keyType:e,valueType:t,typeName:Q.ZodRecord,...Ue(r)}):new zv({keyType:na.create(),valueType:e,typeName:Q.ZodRecord,...Ue(t)})}}class $P extends Ze{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ye.map)return me(r,{code:ie.invalid_type,expected:ye.map,received:r.parsedType}),Le;const s=this._def.keyType,i=this._def.valueType,a=[...r.data.entries()].map(([o,u],l)=>({key:s._parse(new _i(r,o,r.path,[l,"key"])),value:i._parse(new _i(r,u,r.path,[l,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of a){const l=await u.key,d=await u.value;if(l.status==="aborted"||d.status==="aborted")return Le;(l.status==="dirty"||d.status==="dirty")&&t.dirty(),o.set(l.value,d.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const u of a){const l=u.key,d=u.value;if(l.status==="aborted"||d.status==="aborted")return Le;(l.status==="dirty"||d.status==="dirty")&&t.dirty(),o.set(l.value,d.value)}return{status:t.value,value:o}}}}$P.create=(n,e,t)=>new $P({valueType:e,keyType:n,typeName:Q.ZodMap,...Ue(t)});class _d extends Ze{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==ye.set)return me(r,{code:ie.invalid_type,expected:ye.set,received:r.parsedType}),Le;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(me(r,{code:ie.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(me(r,{code:ie.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function a(u){const l=new Set;for(const d of u){if(d.status==="aborted")return Le;d.status==="dirty"&&t.dirty(),l.add(d.value)}return{status:t.value,value:l}}const o=[...r.data.values()].map((u,l)=>i._parse(new _i(r,u,r.path,l)));return r.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new _d({...this._def,minSize:{value:e,message:Ce.toString(t)}})}max(e,t){return new _d({...this._def,maxSize:{value:e,message:Ce.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}_d.create=(n,e)=>new _d({valueType:n,minSize:null,maxSize:null,typeName:Q.ZodSet,...Ue(e)});class ym extends Ze{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ye.function)return me(t,{code:ie.invalid_type,expected:ye.function,received:t.parsedType}),Le;function r(o,u){return PP({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,CP(),hm].filter(l=>!!l),issueData:{code:ie.invalid_arguments,argumentsError:u}})}function s(o,u){return PP({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,CP(),hm].filter(l=>!!l),issueData:{code:ie.invalid_return_type,returnTypeError:u}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof wm){const o=this;return Cn(async function(...u){const l=new ds([]),d=await o._def.args.parseAsync(u,i).catch(p=>{throw l.addIssue(r(u,p)),l}),h=await Reflect.apply(a,this,d);return await o._def.returns._def.type.parseAsync(h,i).catch(p=>{throw l.addIssue(s(h,p)),l})})}else{const o=this;return Cn(function(...u){const l=o._def.args.safeParse(u,i);if(!l.success)throw new ds([r(u,l.error)]);const d=Reflect.apply(a,this,l.data),h=o._def.returns.safeParse(d,i);if(!h.success)throw new ds([s(d,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ym({...this._def,args:ia.create(e).rest(wd.create())})}returns(e){return new ym({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new ym({args:e||ia.create([]).rest(wd.create()),returns:t||wd.create(),typeName:Q.ZodFunction,...Ue(r)})}}class Vv extends Ze{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Vv.create=(n,e)=>new Vv({getter:n,typeName:Q.ZodLazy,...Ue(e)});class Gv extends Ze{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return me(t,{received:t.data,code:ie.invalid_literal,expected:this._def.value}),Le}return{status:"valid",value:e.data}}get value(){return this._def.value}}Gv.create=(n,e)=>new Gv({value:n,typeName:Q.ZodLiteral,...Ue(e)});function oD(n,e){return new Pc({values:n,typeName:Q.ZodEnum,...Ue(e)})}class Pc extends Ze{constructor(){super(...arguments),pm.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return me(t,{expected:lt.joinValues(r),received:t.parsedType,code:ie.invalid_type}),Le}if(Uv(this,pm)||nD(this,pm,new Set(this._def.values)),!Uv(this,pm).has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return me(t,{received:t.data,code:ie.invalid_enum_value,options:r}),Le}return Cn(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Pc.create(e,{...this._def,...t})}exclude(e,t=this._def){return Pc.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}pm=new WeakMap,Pc.create=oD;class Zv extends Ze{constructor(){super(...arguments),mm.set(this,void 0)}_parse(e){const t=lt.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==ye.string&&r.parsedType!==ye.number){const s=lt.objectValues(t);return me(r,{expected:lt.joinValues(s),received:r.parsedType,code:ie.invalid_type}),Le}if(Uv(this,mm)||nD(this,mm,new Set(lt.getValidEnumValues(this._def.values))),!Uv(this,mm).has(e.data)){const s=lt.objectValues(t);return me(r,{received:r.data,code:ie.invalid_enum_value,options:s}),Le}return Cn(e.data)}get enum(){return this._def.values}}mm=new WeakMap,Zv.create=(n,e)=>new Zv({values:n,typeName:Q.ZodNativeEnum,...Ue(e)});class wm extends Ze{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==ye.promise&&t.common.async===!1)return me(t,{code:ie.invalid_type,expected:ye.promise,received:t.parsedType}),Le;const r=t.parsedType===ye.promise?t.data:Promise.resolve(t.data);return Cn(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}wm.create=(n,e)=>new wm({type:n,typeName:Q.ZodPromise,...Ue(e)});class aa extends Ze{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Q.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{me(r,a),a.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const a=s.transform(r.data,i);if(r.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return Le;const u=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return u.status==="aborted"?Le:u.status==="dirty"||t.value==="dirty"?fm(u.value):u});{if(t.value==="aborted")return Le;const o=this._def.schema._parseSync({data:a,path:r.path,parent:r});return o.status==="aborted"?Le:o.status==="dirty"||t.value==="dirty"?fm(o.value):o}}if(s.type==="refinement"){const a=o=>{const u=s.refinement(o,i);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?Le:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?Le:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!md(a))return a;const o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>md(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);lt.assertNever(s)}}aa.create=(n,e,t)=>new aa({schema:n,typeName:Q.ZodEffects,effect:e,...Ue(t)}),aa.createWithPreprocess=(n,e,t)=>new aa({schema:e,effect:{type:"preprocess",transform:n},typeName:Q.ZodEffects,...Ue(t)});class Si extends Ze{_parse(e){return this._getType(e)===ye.undefined?Cn(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Si.create=(n,e)=>new Si({innerType:n,typeName:Q.ZodOptional,...Ue(e)});class Ac extends Ze{_parse(e){return this._getType(e)===ye.null?Cn(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ac.create=(n,e)=>new Ac({innerType:n,typeName:Q.ZodNullable,...Ue(e)});class Jv extends Ze{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===ye.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Jv.create=(n,e)=>new Jv({innerType:n,typeName:Q.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Ue(e)});class Xv extends Ze{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Bv(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ds(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ds(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Xv.create=(n,e)=>new Xv({innerType:n,typeName:Q.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Ue(e)});class jP extends Ze{_parse(e){if(this._getType(e)!==ye.nan){const r=this._getOrReturnCtx(e);return me(r,{code:ie.invalid_type,expected:ye.nan,received:r.parsedType}),Le}return{status:"valid",value:e.data}}}jP.create=n=>new jP({typeName:Q.ZodNaN,...Ue(n)});class cD extends Ze{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Yv extends Ze{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?Le:i.status==="dirty"?(t.dirty(),fm(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?Le:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new Yv({in:e,out:t,typeName:Q.ZodPipeline})}}class Qv extends Ze{_parse(e){const t=this._def.innerType._parse(e),r=s=>(md(s)&&(s.value=Object.freeze(s.value)),s);return Bv(t)?t.then(s=>r(s)):r(t)}unwrap(){return this._def.innerType}}Qv.create=(n,e)=>new Qv({innerType:n,typeName:Q.ZodReadonly,...Ue(e)}),zt.lazycreate;var Q;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(Q||(Q={})),na.create,gd.create,jP.create,yd.create,TP.create,gm.create,IP.create,qv.create,Kv.create,OP.create,wd.create,oo.create,RP.create,vi.create,zt.create,zt.strictCreate,Hv.create,MP.create,Wv.create,ia.create,zv.create,$P.create,_d.create,ym.create,Vv.create,Gv.create,Pc.create,Zv.create,wm.create,aa.create,Si.create,Ac.create,aa.createWithPreprocess,Yv.create;function XX(){return{}}function YX(n,e){var r,s,i;const t={type:"array"};return(r=n.type)!=null&&r._def&&((i=(s=n.type)==null?void 0:s._def)==null?void 0:i.typeName)!==Q.ZodAny&&(t.items=vt(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&kt(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&kt(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(kt(t,"minItems",n.exactLength.value,n.exactLength.message,e),kt(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function QX(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?kt(t,"minimum",r.value,r.message,e):kt(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),kt(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?kt(t,"maximum",r.value,r.message,e):kt(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),kt(t,"maximum",r.value,r.message,e));break;case"multipleOf":kt(t,"multipleOf",r.value,r.message,e);break}return t}function eY(){return{type:"boolean"}}function uD(n,e){return vt(n.type._def,e)}const tY=(n,e)=>vt(n.innerType._def,e);function lD(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,i)=>lD(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return rY(n,e)}}const rY=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":kt(t,"minimum",r.value,r.message,e);break;case"max":kt(t,"maximum",r.value,r.message,e);break}return t};function nY(n,e){return{...vt(n.innerType._def,e),default:n.defaultValue()}}function sY(n,e){return e.effectStrategy==="input"?vt(n.schema._def,e):{}}function iY(n){return{type:"string",enum:Array.from(n.values)}}const aY=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function oY(n,e){const t=[vt(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),vt(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(aY(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...u}=i;a=u}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function cY(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let LP;const Bs={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(LP===void 0&&(LP=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),LP),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function dD(n,e){const t={type:"string"};if(n.checks)for(const r of n.checks)switch(r.kind){case"min":kt(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":kt(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Us(t,"email",r.message,e);break;case"format:idn-email":Us(t,"idn-email",r.message,e);break;case"pattern:zod":sn(t,Bs.email,r.message,e);break}break;case"url":Us(t,"uri",r.message,e);break;case"uuid":Us(t,"uuid",r.message,e);break;case"regex":sn(t,r.regex,r.message,e);break;case"cuid":sn(t,Bs.cuid,r.message,e);break;case"cuid2":sn(t,Bs.cuid2,r.message,e);break;case"startsWith":sn(t,RegExp(`^${FP(r.value,e)}`),r.message,e);break;case"endsWith":sn(t,RegExp(`${FP(r.value,e)}$`),r.message,e);break;case"datetime":Us(t,"date-time",r.message,e);break;case"date":Us(t,"date",r.message,e);break;case"time":Us(t,"time",r.message,e);break;case"duration":Us(t,"duration",r.message,e);break;case"length":kt(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),kt(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{sn(t,RegExp(FP(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&Us(t,"ipv4",r.message,e),r.version!=="v4"&&Us(t,"ipv6",r.message,e);break}case"base64url":sn(t,Bs.base64url,r.message,e);break;case"jwt":sn(t,Bs.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&sn(t,Bs.ipv4Cidr,r.message,e),r.version!=="v4"&&sn(t,Bs.ipv6Cidr,r.message,e);break}case"emoji":sn(t,Bs.emoji(),r.message,e);break;case"ulid":{sn(t,Bs.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Us(t,"binary",r.message,e);break}case"contentEncoding:base64":{kt(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{sn(t,Bs.base64,r.message,e);break}}break}case"nanoid":sn(t,Bs.nanoid,r.message,e)}return t}function FP(n,e){return e.patternStrategy==="escape"?lY(n):n}const uY=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function lY(n){let e="";for(let t=0;t<n.length;t++)uY.has(n[t])||(e+="\\"),e+=n[t];return e}function Us(n,e,t,r){var s;n.format||(s=n.anyOf)!=null&&s.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):kt(n,"format",e,t,r)}function sn(n,e,t,r){var s;n.pattern||(s=n.allOf)!=null&&s.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:hD(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):kt(n,"pattern",hD(e,r),t,r)}function hD(n,e){var u;if(!e.applyRegexFlags||!n.flags)return n.source;const t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source;let s="",i=!1,a=!1,o=!1;for(let l=0;l<r.length;l++){if(i){s+=r[l],i=!1;continue}if(t.i){if(a){if(r[l].match(/[a-z]/)){o?(s+=r[l],s+=`${r[l-2]}-${r[l]}`.toUpperCase(),o=!1):r[l+1]==="-"&&((u=r[l+2])!=null&&u.match(/[a-z]/))?(s+=r[l],o=!0):s+=`${r[l]}${r[l].toUpperCase()}`;continue}}else if(r[l].match(/[a-z]/)){s+=`[${r[l]}${r[l].toUpperCase()}]`;continue}}if(t.m){if(r[l]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[l]==="$"){s+=`($|(?=[\r
]))`;continue}}if(t.s&&r[l]==="."){s+=a?`${r[l]}\r
`:`[${r[l]}\r
]`;continue}s+=r[l],r[l]==="\\"?i=!0:a&&r[l]==="]"?a=!1:!a&&r[l]==="["&&(a=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return s}function fD(n,e){var r,s,i,a,o,u;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===Q.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((l,d)=>({...l,[d]:vt(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",d]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:vt(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((s=n.keyType)==null?void 0:s._def.typeName)===Q.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const{type:l,...d}=dD(n.keyType._def,e);return{...t,propertyNames:d}}else{if(((a=n.keyType)==null?void 0:a._def.typeName)===Q.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(((o=n.keyType)==null?void 0:o._def.typeName)===Q.ZodBranded&&n.keyType._def.type._def.typeName===Q.ZodString&&((u=n.keyType._def.type._def.checks)!=null&&u.length)){const{type:l,...d}=uD(n.keyType._def,e);return{...t,propertyNames:d}}}return t}function dY(n,e){if(e.mapStrategy==="record")return fD(n,e);const t=vt(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=vt(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function hY(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function fY(){return{not:{}}}function pY(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const e0={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function mY(n,e){if(e.target==="openApi3")return pD(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in e0&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((s,i)=>{const a=e0[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return pD(n,e)}const pD=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>vt(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function gY(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:e0[n.innerType._def.typeName],nullable:!0}:{type:[e0[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=vt(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=vt(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function yY(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",QF(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?kt(t,"minimum",r.value,r.message,e):kt(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),kt(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?kt(t,"maximum",r.value,r.message,e):kt(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),kt(t,"maximum",r.value,r.message,e));break;case"multipleOf":kt(t,"multipleOf",r.value,r.message,e);break}return t}function wY(n,e){const t=e.target==="openAi",r={type:"object",properties:{}},s=[],i=n.shape();for(const o in i){let u=i[o];if(u===void 0||u._def===void 0)continue;let l=_Y(u);l&&t&&(u instanceof Si&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),l=!1);const d=vt(u._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});d!==void 0&&(r.properties[o]=d,l||s.push(o))}s.length&&(r.required=s);const a=bY(n,e);return a!==void 0&&(r.additionalProperties=a),r}function bY(n,e){if(n.catchall._def.typeName!=="ZodNever")return vt(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function _Y(n){try{return n.isOptional()}catch{return!0}}const vY=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return vt(n.innerType._def,e);const t=vt(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},SY=(n,e)=>{if(e.pipeStrategy==="input")return vt(n.in._def,e);if(e.pipeStrategy==="output")return vt(n.out._def,e);const t=vt(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=vt(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}};function xY(n,e){return vt(n.type._def,e)}function EY(n,e){const r={type:"array",uniqueItems:!0,items:vt(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&kt(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&kt(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function kY(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>vt(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:vt(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>vt(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function CY(){return{not:{}}}function PY(){return{}}const AY=(n,e)=>vt(n.innerType._def,e),TY=(n,e,t)=>{switch(e){case Q.ZodString:return dD(n,t);case Q.ZodNumber:return yY(n,t);case Q.ZodObject:return wY(n,t);case Q.ZodBigInt:return QX(n,t);case Q.ZodBoolean:return eY();case Q.ZodDate:return lD(n,t);case Q.ZodUndefined:return CY();case Q.ZodNull:return pY(t);case Q.ZodArray:return YX(n,t);case Q.ZodUnion:case Q.ZodDiscriminatedUnion:return mY(n,t);case Q.ZodIntersection:return oY(n,t);case Q.ZodTuple:return kY(n,t);case Q.ZodRecord:return fD(n,t);case Q.ZodLiteral:return cY(n,t);case Q.ZodEnum:return iY(n);case Q.ZodNativeEnum:return hY(n);case Q.ZodNullable:return gY(n,t);case Q.ZodOptional:return vY(n,t);case Q.ZodMap:return dY(n,t);case Q.ZodSet:return EY(n,t);case Q.ZodLazy:return()=>n.getter()._def;case Q.ZodPromise:return xY(n,t);case Q.ZodNaN:case Q.ZodNever:return fY();case Q.ZodEffects:return sY(n,t);case Q.ZodAny:return XX();case Q.ZodUnknown:return PY();case Q.ZodDefault:return nY(n,t);case Q.ZodBranded:return uD(n,t);case Q.ZodReadonly:return AY(n,t);case Q.ZodCatch:return tY(n,t);case Q.ZodPipeline:return SY(n,t);case Q.ZodFunction:case Q.ZodVoid:case Q.ZodSymbol:return;default:return(r=>{})()}};function vt(n,e,t=!1){var o;const r=e.seen.get(n);if(e.override){const u=(o=e.override)==null?void 0:o.call(e,n,e,r,t);if(u!==EX)return u}if(r&&!t){const u=IY(r,e);if(u!==void 0)return u}const s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);const i=TY(n,n.typeName,e),a=typeof i=="function"?vt(i(),e):i;if(a&&RY(n,e,a),e.postProcess){const u=e.postProcess(a,n,e);return s.jsonSchema=a,u}return s.jsonSchema=a,a}const IY=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:OY(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},OY=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},RY=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),MY=(n,e)=>{const t=PX(e),r=void 0,s=e==null?void 0:e.name,i=vt(n._def,t,!1)??{},a=s===void 0?r?{...i,[t.definitionPath]:r}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...r,[s]:i}};return t.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a},NY=Symbol("Let zodToJsonSchema decide on which parser to use"),mD={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},$Y=n=>typeof n=="string"?{...mD,basePath:["#"],definitions:{},name:n}:{...mD,basePath:["#"],definitions:{},...n},DP=n=>"_def"in n?n._def:n;function jY(n){if(!n)return!0;for(const e in n)return!1;return!0}const LY=n=>{const e=$Y(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[DP(s),{def:DP(s),path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function gD(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function Ct(n,e,t,r,s){n[e]=t,gD(n,e,r,s)}function FY(){return{}}function DY(n,e){var r,s;const t={type:"array"};return((s=(r=n.type)==null?void 0:r._def)==null?void 0:s.typeName)!==Q.ZodAny&&(t.items=ft(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&Ct(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&Ct(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(Ct(t,"minItems",n.exactLength.value,n.exactLength.message,e),Ct(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function BY(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?Ct(t,"minimum",r.value,r.message,e):Ct(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Ct(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ct(t,"maximum",r.value,r.message,e):Ct(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Ct(t,"maximum",r.value,r.message,e));break;case"multipleOf":Ct(t,"multipleOf",r.value,r.message,e);break}return t}function UY(){return{type:"boolean"}}function qY(n,e){return ft(n.type._def,e)}const KY=(n,e)=>ft(n.innerType._def,e);function yD(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,i)=>yD(n,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return HY(n,e)}}const HY=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":Ct(t,"minimum",r.value,r.message,e);break;case"max":Ct(t,"maximum",r.value,r.message,e);break}return t};function WY(n,e){return{...ft(n.innerType._def,e),default:n.defaultValue()}}function zY(n,e,t){return e.effectStrategy==="input"?ft(n.schema._def,e,t):{}}function VY(n){return{type:"string",enum:[...n.values]}}const GY=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function ZY(n,e){const t=[ft(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),ft(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const s=[];return t.forEach(i=>{if(GY(i))s.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let a=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...u}=i;a=u}else r=void 0;s.push(a)}}),s.length?{allOf:s,...r}:void 0}function JY(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let BP;const Tc={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(BP===void 0&&(BP=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),BP),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function wD(n,e){const t={type:"string"};function r(s){return e.patternStrategy==="escape"?XY(s):s}if(n.checks)for(const s of n.checks)switch(s.kind){case"min":Ct(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e);break;case"max":Ct(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"email":switch(e.emailStrategy){case"format:email":qs(t,"email",s.message,e);break;case"format:idn-email":qs(t,"idn-email",s.message,e);break;case"pattern:zod":Ks(t,Tc.email,s.message,e);break}break;case"url":qs(t,"uri",s.message,e);break;case"uuid":qs(t,"uuid",s.message,e);break;case"regex":Ks(t,s.regex,s.message,e);break;case"cuid":Ks(t,Tc.cuid,s.message,e);break;case"cuid2":Ks(t,Tc.cuid2,s.message,e);break;case"startsWith":Ks(t,RegExp(`^${r(s.value)}`),s.message,e);break;case"endsWith":Ks(t,RegExp(`${r(s.value)}$`),s.message,e);break;case"datetime":qs(t,"date-time",s.message,e);break;case"date":qs(t,"date",s.message,e);break;case"time":qs(t,"time",s.message,e);break;case"duration":qs(t,"duration",s.message,e);break;case"length":Ct(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,s.value):s.value,s.message,e),Ct(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,s.value):s.value,s.message,e);break;case"includes":{Ks(t,RegExp(r(s.value)),s.message,e);break}case"ip":{s.version!=="v6"&&qs(t,"ipv4",s.message,e),s.version!=="v4"&&qs(t,"ipv6",s.message,e);break}case"emoji":Ks(t,Tc.emoji,s.message,e);break;case"ulid":{Ks(t,Tc.ulid,s.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{qs(t,"binary",s.message,e);break}case"contentEncoding:base64":{Ct(t,"contentEncoding","base64",s.message,e);break}case"pattern:zod":{Ks(t,Tc.base64,s.message,e);break}}break}case"nanoid":Ks(t,Tc.nanoid,s.message,e)}return t}const XY=n=>Array.from(n).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),qs=(n,e,t,r)=>{var s;n.format||(s=n.anyOf)!=null&&s.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):Ct(n,"format",e,t,r)},Ks=(n,e,t,r)=>{var s;n.pattern||(s=n.allOf)!=null&&s.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:bD(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):Ct(n,"pattern",bD(e,r),t,r)},bD=(n,e)=>{var l;const t=typeof n=="function"?n():n;if(!e.applyRegexFlags||!t.flags)return t.source;const r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},s=r.i?t.source.toLowerCase():t.source;let i="",a=!1,o=!1,u=!1;for(let d=0;d<s.length;d++){if(a){i+=s[d],a=!1;continue}if(r.i){if(o){if(s[d].match(/[a-z]/)){u?(i+=s[d],i+=`${s[d-2]}-${s[d]}`.toUpperCase(),u=!1):s[d+1]==="-"&&((l=s[d+2])!=null&&l.match(/[a-z]/))?(i+=s[d],u=!0):i+=`${s[d]}${s[d].toUpperCase()}`;continue}}else if(s[d].match(/[a-z]/)){i+=`[${s[d]}${s[d].toUpperCase()}]`;continue}}if(r.m){if(s[d]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(s[d]==="$"){i+=`($|(?=[\r
]))`;continue}}if(r.s&&s[d]==="."){i+=o?`${s[d]}\r
`:`[${s[d]}\r
]`;continue}i+=s[d],s[d]==="\\"?a=!0:o&&s[d]==="]"?o=!1:!o&&s[d]==="["&&(o=!0)}try{const d=new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return i};function _D(n,e){var r,s,i,a;if(e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===Q.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((o,u)=>({...o,[u]:ft(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",u]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:ft(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((s=n.keyType)==null?void 0:s._def.typeName)===Q.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const o=Object.entries(wD(n.keyType._def,e)).reduce((u,[l,d])=>l==="type"?u:{...u,[l]:d},{});return{...t,propertyNames:o}}else if(((a=n.keyType)==null?void 0:a._def.typeName)===Q.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};return t}function YY(n,e){if(e.mapStrategy==="record")return _D(n,e);const t=ft(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=ft(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function QY(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),s=Array.from(new Set(r.map(i=>typeof i)));return{type:s.length===1?s[0]==="string"?"string":"number":["string","number"],enum:r}}function eQ(){return{not:{}}}function tQ(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const t0={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function rQ(n,e){if(e.target==="openApi3")return vD(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in t0&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((s,i)=>{const a=t0[i._def.typeName];return a&&!s.includes(a)?[...s,a]:s},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((s,i)=>{const a=typeof i._def.value;switch(a){case"string":case"number":case"boolean":return[...s,a];case"bigint":return[...s,"integer"];case"object":if(i._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===t.length){const s=r.filter((i,a,o)=>o.indexOf(i)===a);return{type:s.length>1?s:s[0],enum:t.reduce((i,a)=>i.includes(a._def.value)?i:[...i,a._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,s)=>[...r,...s._def.values.filter(i=>!r.includes(i))],[])};return vD(n,e)}const vD=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,s)=>ft(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function nQ(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:t0[n.innerType._def.typeName],nullable:!0}:{type:[t0[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=ft(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=ft(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function sQ(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",gD(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?Ct(t,"minimum",r.value,r.message,e):Ct(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),Ct(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?Ct(t,"maximum",r.value,r.message,e):Ct(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),Ct(t,"maximum",r.value,r.message,e));break;case"multipleOf":Ct(t,"multipleOf",r.value,r.message,e);break}return t}function iQ(n,e){return e.removeAdditionalStrategy==="strict"?n.catchall._def.typeName==="ZodNever"?n.unknownKeys!=="strict":ft(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":ft(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function aQ(n,e){const t={type:"object",...Object.entries(n.shape()).reduce((r,[s,i])=>{if(i===void 0||i._def===void 0)return r;const a=ft(i._def,{...e,currentPath:[...e.currentPath,"properties",s],propertyPath:[...e.currentPath,"properties",s]});return a===void 0?r:{properties:{...r.properties,[s]:a},required:i.isOptional()&&!e.openaiStrictMode?r.required:[...r.required,s]}},{properties:{},required:[]}),additionalProperties:iQ(n,e)};return t.required.length||delete t.required,t}const oQ=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return ft(n.innerType._def,e);const t=ft(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},cQ=(n,e)=>{if(e.pipeStrategy==="input")return ft(n.in._def,e);if(e.pipeStrategy==="output")return ft(n.out._def,e);const t=ft(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=ft(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(s=>s!==void 0)}};function uQ(n,e){return ft(n.type._def,e)}function lQ(n,e){const r={type:"array",uniqueItems:!0,items:ft(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&Ct(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&Ct(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function dQ(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>ft(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:ft(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>ft(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function hQ(){return{not:{}}}function fQ(){return{}}const pQ=(n,e)=>ft(n.innerType._def,e);function ft(n,e,t=!1){var a;const r=e.seen.get(n);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,n,e,r,t);if(o!==NY)return o}if(r&&!t){const o=mQ(r,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const s={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,s);const i=yQ(n,n.typeName,e,t);return i&&wQ(n,e,i),s.jsonSchema=i,i}const mQ=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"extract-to-root":const t=n.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=n.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:gQ(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((r,s)=>e.currentPath[s]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},gQ=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},yQ=(n,e,t,r)=>{switch(e){case Q.ZodString:return wD(n,t);case Q.ZodNumber:return sQ(n,t);case Q.ZodObject:return aQ(n,t);case Q.ZodBigInt:return BY(n,t);case Q.ZodBoolean:return UY();case Q.ZodDate:return yD(n,t);case Q.ZodUndefined:return hQ();case Q.ZodNull:return tQ(t);case Q.ZodArray:return DY(n,t);case Q.ZodUnion:case Q.ZodDiscriminatedUnion:return rQ(n,t);case Q.ZodIntersection:return ZY(n,t);case Q.ZodTuple:return dQ(n,t);case Q.ZodRecord:return _D(n,t);case Q.ZodLiteral:return JY(n,t);case Q.ZodEnum:return VY(n);case Q.ZodNativeEnum:return QY(n);case Q.ZodNullable:return nQ(n,t);case Q.ZodOptional:return oQ(n,t);case Q.ZodMap:return YY(n,t);case Q.ZodSet:return lQ(n,t);case Q.ZodLazy:return ft(n.getter()._def,t);case Q.ZodPromise:return uQ(n,t);case Q.ZodNaN:case Q.ZodNever:return eQ();case Q.ZodEffects:return zY(n,t,r);case Q.ZodAny:return FY();case Q.ZodUnknown:return fQ();case Q.ZodDefault:return WY(n,t);case Q.ZodBranded:return qY(n,t);case Q.ZodReadonly:return pQ(n,t);case Q.ZodCatch:return KY(n,t);case Q.ZodPipeline:return cQ(n,t);case Q.ZodFunction:case Q.ZodVoid:case Q.ZodSymbol:return;default:return(s=>{})()}},wQ=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),bQ=(n,e)=>{const t=LY(e),r=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=ft(n._def,r===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,r]},!1)??{},i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(s.title=i);const a=(()=>{if(jY(t.definitions))return;const u={},l=new Set;for(let d=0;d<500;d++){const h=Object.entries(t.definitions).filter(([f])=>!l.has(f));if(h.length===0)break;for(const[f,p]of h)u[f]=ft(DP(p),{...t,currentPath:[...t.basePath,t.definitionPath,f]},!0)??{},l.add(f)}return u})(),o=r===void 0?a?{...s,[t.definitionPath]:a}:s:t.nameStrategy==="duplicate-ref"?{...s,...a||t.seenRefs.size?{[t.definitionPath]:{...a,...t.seenRefs.size?{[r]:s}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,r].join("/"),[t.definitionPath]:{...a,[r]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function SD(n,e){return bQ(n,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function _Q(n,e,t){return lX({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:SD(n,{name:e})}},r=>n.parse(JSON.parse(r)))}function vQ(n){return dX({type:"function",function:{name:n.name,parameters:SD(n.parameters,{name:n.name}),strict:!0,...n.description?{description:n.description}:void 0}},{callback:n.function,parser:e=>n.parameters.parse(JSON.parse(e))})}function SQ(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:s,baseURL:i,azureADTokenProvider:a,azureOpenAIEndpoint:o}=n;if((r||a)&&s&&e)return`${s}/${e}`;if((r||a)&&o&&e)return`${o}/openai/deployments/${e}`;if(r||a){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return i}function r0(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function xD(n){let e;return n.constructor.name===vv.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===ls.name?(e=new Error(n.message),e.name="AbortError"):n.status===400&&n.message.includes("tool_calls")?e=r0(n,"INVALID_TOOL_RESULTS"):n.status===401?e=r0(n,"MODEL_AUTHENTICATION"):n.status===429?e=r0(n,"MODEL_RATE_LIMIT"):n.status===404?e=r0(n,"MODEL_NOT_FOUND"):e=n,e}function xQ(n){if(n)return n==="any"||n==="required"?"required":n==="auto"?"auto":n==="none"?"none":typeof n=="string"?{type:"function",function:{name:n}}:n}function EQ(n){return n.anyOf!==void 0&&Array.isArray(n.anyOf)}function kQ(n){const e=["namespace functions {",""];for(const t of n)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(ED(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function ED(n,e){var r;const t=[];for(const[s,i]of Object.entries(n.properties??{}))i.description&&e<2&&t.push(`// ${i.description}`),(r=n.required)!=null&&r.includes(s)?t.push(`${s}: ${n0(i,e)},`):t.push(`${s}?: ${n0(i,e)},`);return t.map(s=>" ".repeat(e)+s).join(`
`)}function n0(n,e){if(EQ(n))return n.anyOf.map(t=>n0(t,e)).join(" | ");switch(n.type){case"string":return n.enum?n.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",ED(n,e+2),"}"].join(`
`);case"array":return n.items?`${n0(n.items,e)}[]`:"any[]";default:return""}}function CQ(n,e){let t;if(Zl(n)){const r=vQ({name:n.name,parameters:n.schema,description:n.description});r.function.parameters?t={type:r.type,function:{name:r.function.name,description:r.function.description,parameters:r.function.parameters,...(e==null?void 0:e.strict)!==void 0?{strict:e.strict}:{}}}:t={type:"function",function:dC(n,e)}}else t=n;return(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function PQ(n){return n.role!=="system"&&n.role!=="developer"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&n.role!=="tool"&&console.warn(`Unknown message role: ${n.role}`),n.role}function kD(n){const e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Ha.isInstance(n))throw new Error("Invalid generic chat message");return PQ(n)}default:throw new Error(`Unknown message type: ${e}`)}}function CD(n,e){return n.flatMap(t=>{var i;let r=kD(t);r==="system"&&AD(e)&&(r="developer");const s={role:r,content:t.content};if(t.name!=null&&(s.name=t.name),t.additional_kwargs.function_call!=null&&(s.function_call=t.additional_kwargs.function_call,s.content=null),pc(t)&&((i=t.tool_calls)!=null&&i.length)?(s.tool_calls=t.tool_calls.map(Z$),s.content=null):(t.additional_kwargs.tool_calls!=null&&(s.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(s.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const a={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[s,a]}return s})}function PD(n,e){return Op(n)?(e==null?void 0:e.strict)!==void 0?{...n,function:{...n.function,strict:e.strict}}:n:CQ(n,e)}function AD(n){return(n==null?void 0:n.startsWith("o1"))||(n==null?void 0:n.startsWith("o3"))}class TD extends os{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming"]}constructor(e){var t,r;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??Br("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??Br("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this==null?void 0:this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=e==null?void 0:e.reasoningEffort,this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.model==="o1"&&(this.disableStreaming=!0),this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling)}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let r;return(t==null?void 0:t.strict)!==void 0?r=t.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this.bind({tools:e.map(s=>PD(s,{strict:r})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&s0(e.json_schema.schema)?_Q(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}invocationParams(e,t){var o;let r;(e==null?void 0:e.strict)!==void 0?r=e.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling);let s={};(e==null?void 0:e.stream_options)!==void 0?s={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(s={stream_options:{include_usage:!0}});const i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(o=e==null?void 0:e.tools)!=null&&o.length?e.tools.map(u=>PD(u,{strict:r})):void 0,tool_choice:xQ(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...s,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(i.prediction=e.prediction);const a=(e==null?void 0:e.reasoning_effort)??this.reasoningEffort;return a!==void 0&&(i.reasoning_effort=a),AD(i.model)?i.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:i.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,i}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const r=e.tool_calls;switch(e.role){case"assistant":{const s=[],i=[];for(const u of r??[])try{s.push(cC(u,{returnId:!0}))}catch(l){i.push(J$(u,l.message))}const a={function_call:e.function_call,tool_calls:r};this.__includeRawResponse!==void 0&&(a.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(a.audio=e.audio),new Dr({content:e.content||"",tool_calls:s,invalid_tool_calls:i,additional_kwargs:a,response_metadata:o,id:t.id})}default:return new Ha(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,r){var u,l;const s=e.role??r,i=e.content??"";let a;e.function_call?a={function_call:e.function_call}:e.tool_calls?a={tool_calls:e.tool_calls}:a={},this.__includeRawResponse&&(a.__raw_response=t),e.audio&&(a.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(s==="user")return new Xf({content:i,response_metadata:o});if(s==="assistant"){const d=[];if(Array.isArray(e.tool_calls))for(const h of e.tool_calls)d.push({name:(u=h.function)==null?void 0:u.name,args:(l=h.function)==null?void 0:l.arguments,id:h.id,index:h.index,type:"tool_call_chunk"});return new nr({content:i,tool_call_chunks:d,additional_kwargs:a,id:t.id,response_metadata:o})}else return s==="system"?new mc({content:i,response_metadata:o}):s==="developer"?new mc({content:i,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):s==="function"?new Jf({content:i,additional_kwargs:a,name:e.name,response_metadata:o}):s==="tool"?new t_({content:i,additional_kwargs:a,tool_call_id:e.tool_call_id,response_metadata:o}):new Zf({content:i,role:s,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){var l,d,h,f,p,m,g,y,w,S;const s=CD(e,this.model),i={...this.invocationParams(t,{streaming:!0}),messages:s,stream:!0};let a;const o=await this.completionWithRetry(i,t);let u;for await(const _ of o){const v=(l=_==null?void 0:_.choices)==null?void 0:l[0];if(_.usage&&(u=_.usage),!v)continue;const{delta:A}=v;if(!A)continue;const k=this._convertOpenAIDeltaToBaseMessageChunk(A,_,a);a=A.role??a;const C={prompt:t.promptIndex??0,completion:v.index??0};if(typeof k.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const E={...C};v.finish_reason!=null&&(E.finish_reason=v.finish_reason,E.system_fingerprint=_.system_fingerprint,E.model_name=_.model),this.logprobs&&(E.logprobs=v.logprobs);const N=new Ln({message:k,text:k.content,generationInfo:E});yield N,await(r==null?void 0:r.handleLLMNewToken(N.text??"",C,void 0,void 0,void 0,{chunk:N}))}if(u){const _={...((d=u.prompt_tokens_details)==null?void 0:d.audio_tokens)!==null&&{audio:(h=u.prompt_tokens_details)==null?void 0:h.audio_tokens},...((f=u.prompt_tokens_details)==null?void 0:f.cached_tokens)!==null&&{cache_read:(p=u.prompt_tokens_details)==null?void 0:p.cached_tokens}},v={...((m=u.completion_tokens_details)==null?void 0:m.audio_tokens)!==null&&{audio:(g=u.completion_tokens_details)==null?void 0:g.audio_tokens},...((y=u.completion_tokens_details)==null?void 0:y.reasoning_tokens)!==null&&{reasoning:(w=u.completion_tokens_details)==null?void 0:w.reasoning_tokens}};yield new Ln({message:new nr({content:"",response_metadata:{usage:{...u}},usage_metadata:{input_tokens:u.prompt_tokens,output_tokens:u.completion_tokens,total_tokens:u.total_tokens,...Object.keys(_).length>0&&{input_token_details:_},...Object.keys(v).length>0&&{output_token_details:v}}}),text:""})}if((S=t.signal)!=null&&S.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(e,t,r){var o,u;const s={},i=this.invocationParams(t),a=CD(e,this.model);if(i.stream){const l=this._streamResponseChunks(e,t,r),d={};for await(const y of l){y.message.response_metadata={...y.generationInfo,...y.message.response_metadata};const w=((o=y.generationInfo)==null?void 0:o.completion)??0;d[w]===void 0?d[w]=y:d[w]=d[w].concat(y)}const h=Object.entries(d).sort(([y],[w])=>parseInt(y,10)-parseInt(w,10)).map(([y,w])=>w),{functions:f,function_call:p}=this.invocationParams(t),m=await this.getEstimatedTokenCountFromPrompt(e,f,p),g=await this.getNumTokensFromGenerations(h);return s.input_tokens=m,s.output_tokens=g,s.total_tokens=m+g,{generations:h,llmOutput:{estimatedTokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}else{let l;t.response_format&&t.response_format.type==="json_schema"?l=await this.betaParsedCompletionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):l=await this.completionWithRetry({...i,stream:!1,messages:a},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:d,prompt_tokens:h,total_tokens:f,prompt_tokens_details:p,completion_tokens_details:m}=(l==null?void 0:l.usage)??{};d&&(s.output_tokens=(s.output_tokens??0)+d),h&&(s.input_tokens=(s.input_tokens??0)+h),f&&(s.total_tokens=(s.total_tokens??0)+f),((p==null?void 0:p.audio_tokens)!==null||(p==null?void 0:p.cached_tokens)!==null)&&(s.input_token_details={...(p==null?void 0:p.audio_tokens)!==null&&{audio:p==null?void 0:p.audio_tokens},...(p==null?void 0:p.cached_tokens)!==null&&{cache_read:p==null?void 0:p.cached_tokens}}),((m==null?void 0:m.audio_tokens)!==null||(m==null?void 0:m.reasoning_tokens)!==null)&&(s.output_token_details={...(m==null?void 0:m.audio_tokens)!==null&&{audio:m==null?void 0:m.audio_tokens},...(m==null?void 0:m.reasoning_tokens)!==null&&{reasoning:m==null?void 0:m.reasoning_tokens}});const g=[];for(const y of(l==null?void 0:l.choices)??[]){const S={text:((u=y.message)==null?void 0:u.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(y.message??{role:"assistant"},l)};S.generationInfo={...y.finish_reason?{finish_reason:y.finish_reason}:{},...y.logprobs?{logprobs:y.logprobs}:{}},pc(S.message)&&(S.message.usage_metadata=s),S.message=new Dr(Object.fromEntries(Object.entries(S.message).filter(([_])=>!_.startsWith("lc_")))),g.push(S)}return{generations:g,llmOutput:{tokenUsage:{promptTokens:s.input_tokens,completionTokens:s.output_tokens,totalTokens:s.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,r){let s=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&r!=="auto"){const i=kQ(t);s+=await this.getNumTokens(i),s+=9}return t&&e.find(i=>i._getType()==="system")&&(s-=4),r==="none"?s+=1:typeof r=="object"&&(s+=await this.getNumTokens(r.name)+4),s}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var s;return(s=r.message.additional_kwargs)!=null&&s.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,s)=>r+s,0)}async getNumTokensFromMessages(e){let t=0,r=0,s=0;this.model==="gpt-3.5-turbo-0301"?(r=4,s=-1):(r=3,s=1);const i=await Promise.all(e.map(async a=>{var f,p,m,g,y,w;const o=await this.getNumTokens(a.content),u=await this.getNumTokens(kD(a)),l=a.name!==void 0?s+await this.getNumTokens(a.name):0;let d=o+r+u+l;const h=a;if(h._getType()==="function"&&(d-=2),(f=h.additional_kwargs)!=null&&f.function_call&&(d+=3),(p=h==null?void 0:h.additional_kwargs.function_call)!=null&&p.name&&(d+=await this.getNumTokens((m=h.additional_kwargs.function_call)==null?void 0:m.name)),(g=h.additional_kwargs.function_call)!=null&&g.arguments)try{d+=await this.getNumTokens(JSON.stringify(JSON.parse((y=h.additional_kwargs.function_call)==null?void 0:y.arguments)))}catch(S){console.error("Error parsing function arguments",S,JSON.stringify(h.additional_kwargs.function_call)),d+=await this.getNumTokens((w=h.additional_kwargs.function_call)==null?void 0:w.arguments)}return t+=d,d}));return t+=3,{totalCount:t,countPerMessage:i}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(s){throw xD(s)}})}async betaParsedCompletionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.beta.chat.completions.parse(e,r)}catch(s){throw xD(s)}})}_getClientOptions(e){if(!this.client){const r={baseURL:this.clientConfig.baseURL},s=SQ(r),i={...this.clientConfig,baseURL:s,timeout:this.timeout,maxRetries:0};i.baseURL||delete i.baseURL,this.client=new it(i)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let r,s,i,a;AQ(e)?(r=e.schema,s=e.name,i=e.method,a=e.includeRaw):(r=e,s=t==null?void 0:t.name,i=t==null?void 0:t.method,a=t==null?void 0:t.includeRaw);let o,u;if((t==null?void 0:t.strict)!==void 0&&i==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?i===void 0&&(i="jsonSchema"):i==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),i==="jsonMode")o=this.bind({response_format:{type:"json_object"}}),s0(r)?u=Mp.fromZodSchema(r):u=new Np;else if(i==="jsonSchema")o=this.bind({response_format:{type:"json_schema",json_schema:{name:s??"extract",description:r.description,schema:r,strict:t==null?void 0:t.strict}}}),s0(r)?u=Mp.fromZodSchema(r):u=new Np;else{let f=s??"extract";if(s0(r)){const p=MY(r);o=this.bind({tools:[{type:"function",function:{name:f,description:p.description,parameters:p}}],tool_choice:{type:"function",function:{name:f}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),u=new G_({returnSingle:!0,keyName:f,zodSchema:r})}else{let p;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(p=r,f=r.name):(f=r.title??f,p={name:f,description:r.description??"",parameters:r}),o=this.bind({tools:[{type:"function",function:p}],tool_choice:{type:"function",function:{name:f}},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),u=new G_({returnSingle:!0,keyName:f})}}if(!a)return o.pipe(u);const l=as.assign({parsed:(f,p)=>u.invoke(f.raw,p)}),d=as.assign({parsed:()=>null}),h=l.withFallbacks({fallbacks:[d]});return Fn.from([{raw:o},h])}}function s0(n){return typeof(n==null?void 0:n.parse)=="function"}function AQ(n){return n!==void 0&&typeof n.schema=="object"}class TQ extends TD{static lc_name(){return"ChatXAI"}_llmType(){return"xai"}get lc_secrets(){return{apiKey:"XAI_API_KEY"}}constructor(e){const t=(e==null?void 0:e.apiKey)||Br("XAI_API_KEY");if(!t)throw new Error('xAI API key not found. Please set the XAI_API_KEY environment variable or provide the key into "apiKey" field.');super({...e,model:(e==null?void 0:e.model)||"grok-beta",apiKey:t,configuration:{baseURL:"https://api.x.ai/v1"}}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","xai"]})}toJSON(){const e=super.toJSON();return"kwargs"in e&&typeof e.kwargs=="object"&&e.kwargs!=null&&(delete e.kwargs.openai_api_key,delete e.kwargs.configuration),e}getLsParams(e){const t=super.getLsParams(e);return t.ls_provider="xai",t}async completionWithRetry(e,t){delete e.frequency_penalty,delete e.presence_penalty,delete e.logit_bias,delete e.functions;const r=e.messages.map(i=>i.content?i:{...i,content:""}),s={...e,messages:r};return s.stream===!0?super.completionWithRetry(s,t):super.completionWithRetry(s,t)}_convertOpenAIDeltaToBaseMessageChunk(e,t,r){var i;const s=super._convertOpenAIDeltaToBaseMessageChunk(e,t,r);return(i=t.choices[0])!=null&&i.finish_reason?s.usage_metadata=s.response_metadata.usage:(delete s.response_metadata.usage,delete s.usage_metadata),s}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const r=super._convertOpenAIChatCompletionMessageToBaseMessage(e,t);return r.additional_kwargs.reasoning_content=e.reasoning_content,r}withStructuredOutput(e,t){const r={...t};return(r==null?void 0:r.method)===void 0&&(r.method="functionCalling"),super.withStructuredOutput(e,r)}}var Lr=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},an={searchParams:"URLSearchParams"in Lr,iterable:"Symbol"in Lr&&"iterator"in Symbol,blob:"FileReader"in Lr&&"Blob"in Lr&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in Lr,arrayBuffer:"ArrayBuffer"in Lr};function IQ(n){return n&&DataView.prototype.isPrototypeOf(n)}if(an.arrayBuffer)var OQ=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],RQ=ArrayBuffer.isView||function(n){return n&&OQ.indexOf(Object.prototype.toString.call(n))>-1};function vd(n){if(typeof n!="string"&&(n=String(n)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(n)||n==="")throw new TypeError('Invalid character in header field name: "'+n+'"');return n.toLowerCase()}function UP(n){return typeof n!="string"&&(n=String(n)),n}function qP(n){var e={next:function(){var t=n.shift();return{done:t===void 0,value:t}}};return an.iterable&&(e[Symbol.iterator]=function(){return e}),e}function lr(n){this.map={},n instanceof lr?n.forEach(function(e,t){this.append(t,e)},this):Array.isArray(n)?n.forEach(function(e){if(e.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1])},this):n&&Object.getOwnPropertyNames(n).forEach(function(e){this.append(e,n[e])},this)}lr.prototype.append=function(n,e){n=vd(n),e=UP(e);var t=this.map[n];this.map[n]=t?t+", "+e:e},lr.prototype.delete=function(n){delete this.map[vd(n)]},lr.prototype.get=function(n){return n=vd(n),this.has(n)?this.map[n]:null},lr.prototype.has=function(n){return this.map.hasOwnProperty(vd(n))},lr.prototype.set=function(n,e){this.map[vd(n)]=UP(e)},lr.prototype.forEach=function(n,e){for(var t in this.map)this.map.hasOwnProperty(t)&&n.call(e,this.map[t],t,this)},lr.prototype.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),qP(n)},lr.prototype.values=function(){var n=[];return this.forEach(function(e){n.push(e)}),qP(n)},lr.prototype.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),qP(n)},an.iterable&&(lr.prototype[Symbol.iterator]=lr.prototype.entries);function KP(n){if(!n._noBody){if(n.bodyUsed)return Promise.reject(new TypeError("Already read"));n.bodyUsed=!0}}function ID(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function MQ(n){var e=new FileReader,t=ID(e);return e.readAsArrayBuffer(n),t}function NQ(n){var e=new FileReader,t=ID(e),r=/charset=([A-Za-z0-9_-]+)/.exec(n.type),s=r?r[1]:"utf-8";return e.readAsText(n,s),t}function $Q(n){for(var e=new Uint8Array(n),t=new Array(e.length),r=0;r<e.length;r++)t[r]=String.fromCharCode(e[r]);return t.join("")}function OD(n){if(n.slice)return n.slice(0);var e=new Uint8Array(n.byteLength);return e.set(new Uint8Array(n)),e.buffer}function RD(){return this.bodyUsed=!1,this._initBody=function(n){this.bodyUsed=this.bodyUsed,this._bodyInit=n,n?typeof n=="string"?this._bodyText=n:an.blob&&Blob.prototype.isPrototypeOf(n)?this._bodyBlob=n:an.formData&&FormData.prototype.isPrototypeOf(n)?this._bodyFormData=n:an.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)?this._bodyText=n.toString():an.arrayBuffer&&an.blob&&IQ(n)?(this._bodyArrayBuffer=OD(n.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):an.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(n)||RQ(n))?this._bodyArrayBuffer=OD(n):this._bodyText=n=Object.prototype.toString.call(n):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof n=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):an.searchParams&&URLSearchParams.prototype.isPrototypeOf(n)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},an.blob&&(this.blob=function(){var n=KP(this);if(n)return n;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var n=KP(this);return n||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(an.blob)return this.blob().then(MQ);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var n=KP(this);if(n)return n;if(this._bodyBlob)return NQ(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve($Q(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},an.formData&&(this.formData=function(){return this.text().then(FQ)}),this.json=function(){return this.text().then(JSON.parse)},this}var jQ=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function LQ(n){var e=n.toUpperCase();return jQ.indexOf(e)>-1?e:n}function Ic(n,e){if(!(this instanceof Ic))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var t=e.body;if(n instanceof Ic){if(n.bodyUsed)throw new TypeError("Already read");this.url=n.url,this.credentials=n.credentials,e.headers||(this.headers=new lr(n.headers)),this.method=n.method,this.mode=n.mode,this.signal=n.signal,!t&&n._bodyInit!=null&&(t=n._bodyInit,n.bodyUsed=!0)}else this.url=String(n);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new lr(e.headers)),this.method=LQ(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal||function(){if("AbortController"in Lr){var i=new AbortController;return i.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&t)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(t),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var r=/([?&])_=[^&]*/;if(r.test(this.url))this.url=this.url.replace(r,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Ic.prototype.clone=function(){return new Ic(this,{body:this._bodyInit})};function FQ(n){var e=new FormData;return n.trim().split("&").forEach(function(t){if(t){var r=t.split("="),s=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(s),decodeURIComponent(i))}}),e}function DQ(n){var e=new lr,t=n.replace(/\r?\n[\t ]+/g," ");return t.split("\r").map(function(r){return r.indexOf(`
`)===0?r.substr(1,r.length):r}).forEach(function(r){var s=r.split(":"),i=s.shift().trim();if(i){var a=s.join(":").trim();try{e.append(i,a)}catch(o){console.warn("Response "+o.message)}}}),e}RD.call(Ic.prototype);function xi(n,e){if(!(this instanceof xi))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new lr(e.headers),this.url=e.url||"",this._initBody(n)}RD.call(xi.prototype),xi.prototype.clone=function(){return new xi(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new lr(this.headers),url:this.url})},xi.error=function(){var n=new xi(null,{status:200,statusText:""});return n.ok=!1,n.status=0,n.type="error",n};var BQ=[301,302,303,307,308];xi.redirect=function(n,e){if(BQ.indexOf(e)===-1)throw new RangeError("Invalid status code");return new xi(null,{status:e,headers:{location:n}})};var Oc=Lr.DOMException;try{new Oc}catch{Oc=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},Oc.prototype=Object.create(Error.prototype),Oc.prototype.constructor=Oc}function MD(n,e){return new Promise(function(t,r){var s=new Ic(n,e);if(s.signal&&s.signal.aborted)return r(new Oc("Aborted","AbortError"));var i=new XMLHttpRequest;function a(){i.abort()}i.onload=function(){var l={statusText:i.statusText,headers:DQ(i.getAllResponseHeaders()||"")};s.url.indexOf("file://")===0&&(i.status<200||i.status>599)?l.status=200:l.status=i.status,l.url="responseURL"in i?i.responseURL:l.headers.get("X-Request-URL");var d="response"in i?i.response:i.responseText;setTimeout(function(){t(new xi(d,l))},0)},i.onerror=function(){setTimeout(function(){r(new TypeError("Network request failed"))},0)},i.ontimeout=function(){setTimeout(function(){r(new TypeError("Network request timed out"))},0)},i.onabort=function(){setTimeout(function(){r(new Oc("Aborted","AbortError"))},0)};function o(l){try{return l===""&&Lr.location.href?Lr.location.href:l}catch{return l}}if(i.open(s.method,o(s.url),!0),s.credentials==="include"?i.withCredentials=!0:s.credentials==="omit"&&(i.withCredentials=!1),"responseType"in i&&(an.blob?i.responseType="blob":an.arrayBuffer&&(i.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof lr||Lr.Headers&&e.headers instanceof Lr.Headers)){var u=[];Object.getOwnPropertyNames(e.headers).forEach(function(l){u.push(vd(l)),i.setRequestHeader(l,UP(e.headers[l]))}),s.headers.forEach(function(l,d){u.indexOf(d)===-1&&i.setRequestHeader(d,l)})}else s.headers.forEach(function(l,d){i.setRequestHeader(d,l)});s.signal&&(s.signal.addEventListener("abort",a),i.onreadystatechange=function(){i.readyState===4&&s.signal.removeEventListener("abort",a)}),i.send(typeof s._bodyInit>"u"?null:s._bodyInit)})}MD.polyfill=!0,Lr.fetch||(Lr.fetch=MD,Lr.Headers=lr,Lr.Request=Ic,Lr.Response=xi);const UQ="0.5.14",ND="11434",$D=`http://127.0.0.1:${ND}`;var qQ=Object.defineProperty,KQ=(n,e,t)=>e in n?qQ(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,HP=(n,e,t)=>(KQ(n,typeof e!="symbol"?e+"":e,t),t);class WP extends Error{constructor(e,t){super(e),this.error=e,this.status_code=t,this.name="ResponseError",Error.captureStackTrace&&Error.captureStackTrace(this,WP)}}class HQ{constructor(e,t,r){HP(this,"abortController"),HP(this,"itr"),HP(this,"doneCallback"),this.abortController=e,this.itr=t,this.doneCallback=r}abort(){this.abortController.abort()}async*[Symbol.asyncIterator](){for await(const e of this.itr){if("error"in e)throw new Error(e.error);if(yield e,e.done||e.status==="success"){this.doneCallback();return}}throw new Error("Did not receive done or success response in stream.")}}const zP=async n=>{var r;if(n.ok)return;let e=`Error ${n.status}: ${n.statusText}`,t=null;if((r=n.headers.get("content-type"))!=null&&r.includes("application/json"))try{t=await n.json(),e=t.error||e}catch{console.log("Failed to parse error response as JSON")}else try{console.log("Getting text from response"),e=await n.text()||e}catch{console.log("Failed to get text from error response")}throw new WP(e,n.status)};function WQ(){var n;if(typeof window<"u"&&window.navigator){const e=navigator;return"userAgentData"in e&&((n=e.userAgentData)!=null&&n.platform)?`${e.userAgentData.platform.toLowerCase()} Browser/${navigator.userAgent};`:navigator.platform?`${navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`:`unknown Browser/${navigator.userAgent};`}else if(typeof process<"u")return`${process.arch} ${process.platform} Node.js/${process.version}`;return""}function zQ(n){if(n instanceof Headers){const e={};return n.forEach((t,r)=>{e[r]=t}),e}else return Array.isArray(n)?Object.fromEntries(n):n||{}}const VP=async(n,e,t={})=>{const r={"Content-Type":"application/json",Accept:"application/json","User-Agent":`ollama-js/${UQ} (${WQ()})`};t.headers=zQ(t.headers);const s=Object.fromEntries(Object.entries(t.headers).filter(([i])=>!Object.keys(r).some(a=>a.toLowerCase()===i.toLowerCase())));return t.headers={...r,...s},n(e,t)},jD=async(n,e,t)=>{const r=await VP(n,e,{headers:t==null?void 0:t.headers});return await zP(r),r},Sd=async(n,e,t,r)=>{const i=(o=>o!==null&&typeof o=="object"&&!Array.isArray(o))(t)?JSON.stringify(t):t,a=await VP(n,e,{method:"POST",body:i,signal:r==null?void 0:r.signal,headers:r==null?void 0:r.headers});return await zP(a),a},VQ=async(n,e,t,r)=>{const s=await VP(n,e,{method:"DELETE",body:JSON.stringify(t),headers:r==null?void 0:r.headers});return await zP(s),s},GQ=async function*(n){const e=new TextDecoder("utf-8");let t="";const r=n.getReader();for(;;){const{done:s,value:i}=await r.read();if(s)break;t+=e.decode(i);const a=t.split(`
`);t=a.pop()??"";for(const o of a)try{yield JSON.parse(o)}catch{console.warn("invalid json: ",o)}}for(const s of t.split(`
`).filter(i=>i!==""))try{yield JSON.parse(s)}catch{console.warn("invalid json: ",s)}},ZQ=n=>{if(!n)return $D;let e=n.includes("://");n.startsWith(":")&&(n=`http://127.0.0.1${n}`,e=!0),e||(n=`http://${n}`);const t=new URL(n);let r=t.port;r||(e?r=t.protocol==="https:"?"443":"80":r=ND);let s=`${t.protocol}//${t.hostname}:${r}${t.pathname}`;return s.endsWith("/")&&(s=s.slice(0,-1)),s};var JQ=Object.defineProperty,XQ=(n,e,t)=>e in n?JQ(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,GP=(n,e,t)=>(XQ(n,typeof e!="symbol"?e+"":e,t),t);let LD=class{constructor(e){GP(this,"config"),GP(this,"fetch"),GP(this,"ongoingStreamedRequests",[]),this.config={host:"",headers:e==null?void 0:e.headers},e!=null&&e.proxy||(this.config.host=ZQ((e==null?void 0:e.host)??$D)),this.fetch=(e==null?void 0:e.fetch)??fetch}abort(){for(const e of this.ongoingStreamedRequests)e.abort();this.ongoingStreamedRequests.length=0}async processStreamableRequest(e,t){t.stream=t.stream??!1;const r=`${this.config.host}/api/${e}`;if(t.stream){const i=new AbortController,a=await Sd(this.fetch,r,t,{signal:i.signal,headers:this.config.headers});if(!a.body)throw new Error("Missing body");const o=GQ(a.body),u=new HQ(i,o,()=>{const l=this.ongoingStreamedRequests.indexOf(u);l>-1&&this.ongoingStreamedRequests.splice(l,1)});return this.ongoingStreamedRequests.push(u),u}return await(await Sd(this.fetch,r,t,{headers:this.config.headers})).json()}async encodeImage(e){if(typeof e!="string"){const t=new Uint8Array(e);let r="";const s=t.byteLength;for(let i=0;i<s;i++)r+=String.fromCharCode(t[i]);return btoa(r)}return e}async generate(e){return e.images&&(e.images=await Promise.all(e.images.map(this.encodeImage.bind(this)))),this.processStreamableRequest("generate",e)}async chat(e){if(e.messages)for(const t of e.messages)t.images&&(t.images=await Promise.all(t.images.map(this.encodeImage.bind(this))));return this.processStreamableRequest("chat",e)}async create(e){return this.processStreamableRequest("create",{...e})}async pull(e){return this.processStreamableRequest("pull",{name:e.model,stream:e.stream,insecure:e.insecure})}async push(e){return this.processStreamableRequest("push",{name:e.model,stream:e.stream,insecure:e.insecure})}async delete(e){return await VQ(this.fetch,`${this.config.host}/api/delete`,{name:e.model},{headers:this.config.headers}),{status:"success"}}async copy(e){return await Sd(this.fetch,`${this.config.host}/api/copy`,{...e},{headers:this.config.headers}),{status:"success"}}async list(){return await(await jD(this.fetch,`${this.config.host}/api/tags`,{headers:this.config.headers})).json()}async show(e){return await(await Sd(this.fetch,`${this.config.host}/api/show`,{...e},{headers:this.config.headers})).json()}async embed(e){return await(await Sd(this.fetch,`${this.config.host}/api/embed`,{...e},{headers:this.config.headers})).json()}async embeddings(e){return await(await Sd(this.fetch,`${this.config.host}/api/embeddings`,{...e},{headers:this.config.headers})).json()}async ps(){return await(await jD(this.fetch,`${this.config.host}/api/ps`,{headers:this.config.headers})).json()}};new LD;function FD(n,e){var t;return new nr({content:n.content??"",tool_call_chunks:(t=n.tool_calls)==null?void 0:t.map(r=>({name:r.function.name,args:JSON.stringify(r.function.arguments),type:"tool_call_chunk",index:0,id:Yr()})),response_metadata:e==null?void 0:e.responseMetadata,usage_metadata:e==null?void 0:e.usageMetadata})}function DD(n){const e=n.match(/^data:.*?;base64,(.*)$/);return e?e[1]:""}function YQ(n){var s,i,a;if(typeof n.content=="string")return[{role:"assistant",content:n.content}];const t=n.content.filter(o=>o.type==="text"&&typeof o.text=="string").map(o=>({role:"assistant",content:o.text}));let r;if(n.content.find(o=>o.type==="tool_use")&&((s=n.tool_calls)!=null&&s.length)){const o=(i=n.tool_calls)==null?void 0:i.map(u=>({id:u.id,type:"function",function:{name:u.name,arguments:u.args}}));o&&(r={role:"assistant",tool_calls:o,content:""})}else if(n.content.find(o=>o.type==="tool_use")&&!((a=n.tool_calls)!=null&&a.length))throw new Error("'tool_use' content type is not supported without tool calls.");return[...t,...r?[r]:[]]}function QQ(n){return typeof n.content=="string"?[{role:"user",content:n.content}]:n.content.map(e=>{if(e.type==="text")return{role:"user",content:e.text};if(e.type==="image_url"){if(typeof e.image_url=="string")return{role:"user",content:"",images:[DD(e.image_url)]};if(e.image_url.url&&typeof e.image_url.url=="string")return{role:"user",content:"",images:[DD(e.image_url.url)]}}throw new Error(`Unsupported content type: ${e.type}`)})}function eee(n){if(typeof n.content=="string")return[{role:"system",content:n.content}];if(n.content.every(e=>e.type==="text"&&typeof e.text=="string"))return n.content.map(e=>({role:"system",content:e.text}));throw new Error(`Unsupported content type(s): ${n.content.map(e=>e.type).join(", ")}`)}function tee(n){if(typeof n.content!="string")throw new Error("Non string tool message content is not supported");return[{role:"tool",content:n.content}]}function ree(n){return n.flatMap(e=>{if(["human","generic"].includes(e._getType()))return QQ(e);if(e._getType()==="ai")return YQ(e);if(e._getType()==="system")return eee(e);if(e._getType()==="tool")return tee(e);throw new Error(`Unsupported message type: ${e._getType()}`)})}class nee extends os{static lc_name(){return"ChatOllama"}constructor(e){super(e??{}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"llama3"}),Object.defineProperty(this,"numa",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numCtx",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numBatch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mainGpu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lowVram",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"f16Kv",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitsAll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"vocabOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMmap",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useMlock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"embeddingOnly",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numThread",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numKeep",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"seed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"numPredict",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tfsZ",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"typicalP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatLastN",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repeatPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatTau",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mirostatEta",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"penalizeNewline",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"format",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keepAlive",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkOrPullModel",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"baseUrl",{enumerable:!0,configurable:!0,writable:!0,value:"http://127.0.0.1:11434"}),this.client=new LD({host:e==null?void 0:e.baseUrl,headers:e==null?void 0:e.headers}),this.baseUrl=(e==null?void 0:e.baseUrl)??this.baseUrl,this.model=(e==null?void 0:e.model)??this.model,this.numa=e==null?void 0:e.numa,this.numCtx=e==null?void 0:e.numCtx,this.numBatch=e==null?void 0:e.numBatch,this.numGpu=e==null?void 0:e.numGpu,this.mainGpu=e==null?void 0:e.mainGpu,this.lowVram=e==null?void 0:e.lowVram,this.f16Kv=e==null?void 0:e.f16Kv,this.logitsAll=e==null?void 0:e.logitsAll,this.vocabOnly=e==null?void 0:e.vocabOnly,this.useMmap=e==null?void 0:e.useMmap,this.useMlock=e==null?void 0:e.useMlock,this.embeddingOnly=e==null?void 0:e.embeddingOnly,this.numThread=e==null?void 0:e.numThread,this.numKeep=e==null?void 0:e.numKeep,this.seed=e==null?void 0:e.seed,this.numPredict=e==null?void 0:e.numPredict,this.topK=e==null?void 0:e.topK,this.topP=e==null?void 0:e.topP,this.tfsZ=e==null?void 0:e.tfsZ,this.typicalP=e==null?void 0:e.typicalP,this.repeatLastN=e==null?void 0:e.repeatLastN,this.temperature=e==null?void 0:e.temperature,this.repeatPenalty=e==null?void 0:e.repeatPenalty,this.presencePenalty=e==null?void 0:e.presencePenalty,this.frequencyPenalty=e==null?void 0:e.frequencyPenalty,this.mirostat=e==null?void 0:e.mirostat,this.mirostatTau=e==null?void 0:e.mirostatTau,this.mirostatEta=e==null?void 0:e.mirostatEta,this.penalizeNewline=e==null?void 0:e.penalizeNewline,this.streaming=e==null?void 0:e.streaming,this.format=e==null?void 0:e.format,this.keepAlive=e==null?void 0:e.keepAlive,this.checkOrPullModel=(e==null?void 0:e.checkOrPullModel)??this.checkOrPullModel}_llmType(){return"ollama"}async pull(e,t){const{stream:r,insecure:s,logProgress:i}={stream:!0,...t};if(r)for await(const a of await this.client.pull({model:e,insecure:s,stream:r}))i&&console.log(a);else{const a=await this.client.pull({model:e,insecure:s});i&&console.log(a)}}bindTools(e,t){return this.bind({tools:e.map(r=>ij(r)),...t})}getLsParams(e){var r,s;const t=this.invocationParams(e);return{ls_provider:"ollama",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:((r=t.options)==null?void 0:r.temperature)??void 0,ls_max_tokens:((s=t.options)==null?void 0:s.num_predict)??void 0,ls_stop:e.stop}}invocationParams(e){var t;if(e!=null&&e.tool_choice)throw new Error("Tool choice is not supported for ChatOllama.");return{model:this.model,format:(e==null?void 0:e.format)??this.format,keep_alive:this.keepAlive,options:{numa:this.numa,num_ctx:this.numCtx,num_batch:this.numBatch,num_gpu:this.numGpu,main_gpu:this.mainGpu,low_vram:this.lowVram,f16_kv:this.f16Kv,logits_all:this.logitsAll,vocab_only:this.vocabOnly,use_mmap:this.useMmap,use_mlock:this.useMlock,embedding_only:this.embeddingOnly,num_thread:this.numThread,num_keep:this.numKeep,seed:this.seed,num_predict:this.numPredict,top_k:this.topK,top_p:this.topP,tfs_z:this.tfsZ,typical_p:this.typicalP,repeat_last_n:this.repeatLastN,temperature:this.temperature,repeat_penalty:this.repeatPenalty,presence_penalty:this.presencePenalty,frequency_penalty:this.frequencyPenalty,mirostat:this.mirostat,mirostat_tau:this.mirostatTau,mirostat_eta:this.mirostatEta,penalize_newline:this.penalizeNewline,stop:e==null?void 0:e.stop},tools:(t=e==null?void 0:e.tools)!=null&&t.length?e.tools.map(r=>ij(r)):void 0}}async checkModelExistsOnMachine(e){const{models:t}=await this.client.list();return!!t.find(r=>r.name===e||r.name===`${e}:latest`)}async _generate(e,t,r){this.checkOrPullModel&&(await this.checkModelExistsOnMachine(this.model)||await this.pull(this.model,{logProgress:!0}));let s;for await(const a of this._streamResponseChunks(e,t,r))s?s=ss(s,a.message):s=a.message;const i=new Dr({id:s==null?void 0:s.id,content:(s==null?void 0:s.content)??"",tool_calls:s==null?void 0:s.tool_calls,response_metadata:s==null?void 0:s.response_metadata,usage_metadata:s==null?void 0:s.usage_metadata});return{generations:[{text:typeof i.content=="string"?i.content:"",message:i}]}}async*_streamResponseChunks(e,t,r){var l;this.checkOrPullModel&&(await this.checkModelExistsOnMachine(this.model)||await this.pull(this.model,{logProgress:!0}));const s=this.invocationParams(t),i=ree(e),a={input_tokens:0,output_tokens:0,total_tokens:0};if(s.tools&&s.tools.length>0){const d=await this.client.chat({...s,messages:i,stream:!1}),{message:h,...f}=d;return a.input_tokens+=f.prompt_eval_count??0,a.output_tokens+=f.eval_count??0,a.total_tokens=a.input_tokens+a.output_tokens,yield new Ln({text:h.content,message:FD(h,{responseMetadata:f,usageMetadata:a})}),r==null?void 0:r.handleLLMNewToken(h.content)}const o=await this.client.chat({...s,messages:i,stream:!0});let u;for await(const d of o){(l=t.signal)!=null&&l.aborted&&this.client.abort();const{message:h,...f}=d;a.input_tokens+=f.prompt_eval_count??0,a.output_tokens+=f.eval_count??0,a.total_tokens=a.input_tokens+a.output_tokens,u=f,yield new Ln({text:h.content??"",message:FD(h)}),await(r==null?void 0:r.handleLLMNewToken(h.content??""))}yield new Ln({text:"",message:new nr({content:"",response_metadata:u,usage_metadata:a})})}withStructuredOutput(e,t){if((t==null?void 0:t.method)===void 0||(t==null?void 0:t.method)==="jsonSchema"){const r=Rp(e),s=r?Zi(e):e,i=this.bind({format:s}),a=r?Mp.fromZodSchema(e):new Np;if(!(t!=null&&t.includeRaw))return i.pipe(a);const o=as.assign({parsed:(d,h)=>a.invoke(d.raw,h)}),u=as.assign({parsed:()=>null}),l=o.withFallbacks({fallbacks:[u]});return Fn.from([{raw:i},l])}else return super.withStructuredOutput(e,t)}}class see extends TD{static lc_name(){return"ChatDeepSeek"}_llmType(){return"deepseek"}get lc_secrets(){return{apiKey:"DEEPSEEK_API_KEY"}}constructor(e){const t=(e==null?void 0:e.apiKey)||Br("DEEPSEEK_API_KEY");if(!t)throw new Error('Deepseek API key not found. Please set the DEEPSEEK_API_KEY environment variable or pass the key into "apiKey" field.');super({...e,apiKey:t,configuration:{baseURL:"https://api.deepseek.com",...e==null?void 0:e.configuration}}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","deepseek"]})}_convertOpenAIDeltaToBaseMessageChunk(e,t,r){const s=super._convertOpenAIDeltaToBaseMessageChunk(e,t,r);return s.additional_kwargs.reasoning_content=e.reasoning_content,s}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const r=super._convertOpenAIChatCompletionMessageToBaseMessage(e,t);return r.additional_kwargs.reasoning_content=e.reasoning_content,r}withStructuredOutput(e,t){const r={...t};return(r==null?void 0:r.method)===void 0&&(r.method="functionCalling"),super.withStructuredOutput(e,r)}}const bm=1024*4;function iee(n){return n.startsWith("openai/o")||n.startsWith("o")}function BD(n,e){var r,s;const t={model:e.modelName,apiKey:n.apiKey};return n.baseUrl&&(t.configuration={baseURL:n.baseUrl}),n.apiKey&&(t.apiKey=n.apiKey),iee(e.modelName)?t.modelKwargs={max_completion_tokens:bm}:(t.topP=((r=e.parameters)==null?void 0:r.topP)??.1,t.temperature=((s=e.parameters)==null?void 0:s.temperature)??.1,t.maxTokens=bm),new HZ(t)}function ZP(n,e){var s,i;const t=((s=e.parameters)==null?void 0:s.temperature)??.1,r=((i=e.parameters)==null?void 0:i.topP)??.1;switch(e.provider){case Jt.OpenAI:return BD(n,e);case Jt.Anthropic:{const a={model:e.modelName,apiKey:n.apiKey,maxTokens:bm,temperature:t,topP:r,clientOptions:{}};return new j7(a)}case Jt.DeepSeek:{const a={model:e.modelName,apiKey:n.apiKey,temperature:t,topP:r};return new see(a)}case Jt.Gemini:{const a={model:e.modelName,apiKey:n.apiKey,temperature:t,topP:r};return new xJ(a)}case Jt.Grok:{const a={model:e.modelName,apiKey:n.apiKey,temperature:t,topP:r,maxTokens:bm,configuration:{}};return new TQ(a)}case Jt.Ollama:{const a={model:e.modelName,apiKey:n.apiKey===""?"ollama":n.apiKey,baseUrl:n.baseUrl??"http://localhost:11434",topP:r,temperature:t,maxTokens:bm,numCtx:64e3};return new nee(a)}default:return BD(n,e)}}const dr={generalSettings:{maxSteps:100,maxActionsPerStep:5,maxFailures:3,useVision:!0,useVisionForPlanner:!0,planningInterval:3},llmProviders:{openai:{name:"OpenAI",apiKey:"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",models:["gpt-4o","gpt-4o-mini","o1","o3-mini"]}},modelSelections:{planner:{description:"Develops and refines strategies to complete tasks",provider:"openai",modelName:"gpt-4o",parameters:{temperature:.01,topP:.001}},navigator:{description:"Navigates websites and performs actions",provider:"openai",modelName:"gpt-4o",parameters:{temperature:0,topP:.001}},validator:{description:"Checks if tasks are completed successfully",provider:"openai",modelName:"gpt-4o",parameters:{temperature:0,topP:.001}}}},Hn=ws("background");chrome.runtime.onInstalled.addListener(async n=>{if(n.reason==="install"||n.reason==="update"){Hn.info("Extension installed or updated, initializing default settings");try{const e=await xS.getSettings();(!e||Object.keys(e).length===0)&&(await xS.updateSettings({maxSteps:dr.generalSettings.maxSteps,maxActionsPerStep:dr.generalSettings.maxActionsPerStep,maxFailures:dr.generalSettings.maxFailures,useVision:dr.generalSettings.useVision,useVisionForPlanner:dr.generalSettings.useVisionForPlanner,planningInterval:dr.generalSettings.planningInterval}),Hn.info("Default general settings initialized"));const t=await _S.getAllProviders();if(Object.keys(t).length===0){for(const[s,i]of Object.entries(dr.llmProviders))await _S.setProvider(s,{name:i.name,apiKey:i.apiKey,modelNames:i.models});Hn.info("Default LLM providers initialized")}const r=await Qo.getAllAgentModels();Object.keys(r).length===0&&(await Qo.setAgentModel(Di.Planner,{provider:dr.modelSelections.planner.provider,modelName:dr.modelSelections.planner.modelName,parameters:dr.modelSelections.planner.parameters}),await Qo.setAgentModel(Di.Navigator,{provider:dr.modelSelections.navigator.provider,modelName:dr.modelSelections.navigator.modelName,parameters:dr.modelSelections.navigator.parameters}),await Qo.setAgentModel(Di.Validator,{provider:dr.modelSelections.validator.provider,modelName:dr.modelSelections.validator.modelName,parameters:dr.modelSelections.validator.parameters}),Hn.info("Default agent models initialized"))}catch(e){Hn.error("Failed to initialize default settings:",e)}}});async function aee(){try{const n=await Qo.getAgentModel(Di.Navigator);console.log("Current navigator model:",n),(!n||!n.modelName)&&(console.log("Navigator model not set, setting default navigator model"),await Qo.setAgentModel(Di.Navigator,{provider:dr.modelSelections.navigator.provider,modelName:dr.modelSelections.navigator.modelName,parameters:dr.modelSelections.navigator.parameters}),console.log("Navigator model has been set"))}catch(n){console.error("Failed to ensure navigator model:",n)}}aee();const i0=new UH({});let Wr=null,a0=null;chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(n=>console.error(n));async function oee(n){var e;try{return((e=(await chrome.scripting.executeScript({target:{tabId:n},func:()=>Object.prototype.hasOwnProperty.call(window,"buildDomTree")}))[0])==null?void 0:e.result)||!1}catch(t){return console.error("Failed to check script injection status:",t),!1}}async function cee(n){try{if(await oee(n)){console.log("Scripts already injected, skipping...");return}await chrome.scripting.executeScript({target:{tabId:n},files:["buildDomTree.js"]}),console.log("Scripts successfully injected")}catch(e){console.error("Failed to inject scripts:",e)}}chrome.tabs.onUpdated.addListener(async(n,e,t)=>{var r;n&&e.status==="complete"&&((r=t.url)!=null&&r.startsWith("http"))&&await cee(n)}),chrome.debugger.onDetach.addListener(async(n,e)=>{console.log("Debugger detached:",n,e),e==="canceled_by_user"&&n.tabId&&await i0.cleanup()}),chrome.tabs.onRemoved.addListener(n=>{i0.removeAttachedPage(n)}),Hn.info("background loaded"),chrome.runtime.onConnect.addListener(n=>{n.name==="side-panel-connection"&&(a0=n,n.onMessage.addListener(async e=>{try{switch(e.type){case"heartbeat":n.postMessage({type:"heartbeat_ack"});break;case"new_task":{if(!e.task)return n.postMessage({type:"error",error:"No task provided"});if(!e.tabId)return n.postMessage({type:"error",error:"No tab ID provided"});Hn.info("new_task",e.tabId,e.task),Wr=await uee(e.taskId,e.task,i0),UD(Wr);const t=await Wr.execute();Hn.info("new_task execution result",e.tabId,t);break}case"follow_up_task":{if(!e.task)return n.postMessage({type:"error",error:"No follow up task provided"});if(!e.tabId)return n.postMessage({type:"error",error:"No tab ID provided"});if(Hn.info("follow_up_task",e.tabId,e.task),Wr){Wr.addFollowUpTask(e.task),UD(Wr);const t=await Wr.execute();Hn.info("follow_up_task execution result",e.tabId,t)}else return Hn.info("follow_up_task: executor was cleaned up, can not add follow-up task"),n.postMessage({type:"error",error:"Executor was cleaned up, can not add follow-up task"});break}case"cancel_task":{if(!Wr)return n.postMessage({type:"error",error:"No task to cancel"});await Wr.cancel();break}case"screenshot":{if(!e.tabId)return n.postMessage({type:"error",error:"No tab ID provided"});const r=await(await i0.switchTab(e.tabId)).takeScreenshot();return Hn.info("screenshot",e.tabId,r),n.postMessage({type:"success",screenshot:r})}case"resume_task":return Wr?(await Wr.resume(),n.postMessage({type:"success"})):n.postMessage({type:"error",error:"No task to resume"});case"pause_task":return Wr?(await Wr.pause(),n.postMessage({type:"success"})):n.postMessage({type:"error",error:"No task to pause"});default:return n.postMessage({type:"error",error:"Unknown message type"})}}catch(t){console.error("Error handling port message:",t),n.postMessage({type:"error",error:t instanceof Error?t.message:"Unknown error"})}}),n.onDisconnect.addListener(()=>{console.log("Side panel disconnected"),a0=null}))});async function uee(n,e,t){const r=await _S.getAllProviders();if(Object.keys(r).length===0)throw new Error("Please configure API keys in the settings first");const s=await Qo.getAllAgentModels();for(const p of Object.values(s))if(!r[p.provider])throw new Error(`Provider ${p.provider} not found in the settings`);const i=s[Di.Navigator];if(!i)throw new Error("Please choose a model for the navigator in the settings first");const a=ZP(r[i.provider],i);let o=null;const u=s[Di.Planner];u&&(o=ZP(r[u.provider],u));let l=null;const d=s[Di.Validator];d&&(l=ZP(r[d.provider],d));const h=await xS.getSettings();return new SG(e,n,t,a,{plannerLLM:o??a,validatorLLM:l??a,agentOptions:{maxSteps:h.maxSteps,maxFailures:h.maxFailures,maxActionsPerStep:h.maxActionsPerStep,useVision:h.useVision,useVisionForPlanner:h.useVisionForPlanner,planningInterval:h.planningInterval}})}async function UD(n){n.clearExecutionEvents(),n.subscribeExecutionEvents(async e=>{try{a0&&a0.postMessage(e)}catch(t){Hn.error("Failed to send message to side panel:",t)}(e.state===ke.TASK_OK||e.state===ke.TASK_FAIL||e.state===ke.TASK_CANCEL)&&await(Wr==null?void 0:Wr.cleanup())})}var o0={exports:{}},JP,qD;function lee(){if(qD)return JP;qD=1;var n=1e3,e=n*60,t=e*60,r=t*24,s=r*7,i=r*365.25;JP=function(d,h){h=h||{};var f=typeof d;if(f==="string"&&d.length>0)return a(d);if(f==="number"&&isFinite(d))return h.long?u(d):o(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))};function a(d){if(d=String(d),!(d.length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(h){var f=parseFloat(h[1]),p=(h[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return f*i;case"weeks":case"week":case"w":return f*s;case"days":case"day":case"d":return f*r;case"hours":case"hour":case"hrs":case"hr":case"h":return f*t;case"minutes":case"minute":case"mins":case"min":case"m":return f*e;case"seconds":case"second":case"secs":case"sec":case"s":return f*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function o(d){var h=Math.abs(d);return h>=r?Math.round(d/r)+"d":h>=t?Math.round(d/t)+"h":h>=e?Math.round(d/e)+"m":h>=n?Math.round(d/n)+"s":d+"ms"}function u(d){var h=Math.abs(d);return h>=r?l(d,h,r,"day"):h>=t?l(d,h,t,"hour"):h>=e?l(d,h,e,"minute"):h>=n?l(d,h,n,"second"):d+" ms"}function l(d,h,f,p){var m=h>=f*1.5;return Math.round(d/f)+" "+p+(m?"s":"")}return JP}var XP,KD;function dee(){if(KD)return XP;KD=1;function n(e){r.debug=r,r.default=r,r.coerce=l,r.disable=o,r.enable=i,r.enabled=u,r.humanize=lee(),r.destroy=d,Object.keys(e).forEach(h=>{r[h]=e[h]}),r.names=[],r.skips=[],r.formatters={};function t(h){let f=0;for(let p=0;p<h.length;p++)f=(f<<5)-f+h.charCodeAt(p),f|=0;return r.colors[Math.abs(f)%r.colors.length]}r.selectColor=t;function r(h){let f,p=null,m,g;function y(...w){if(!y.enabled)return;const S=y,_=Number(new Date),v=_-(f||_);S.diff=v,S.prev=f,S.curr=_,f=_,w[0]=r.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let A=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,(C,E)=>{if(C==="%%")return"%";A++;const N=r.formatters[E];if(typeof N=="function"){const I=w[A];C=N.call(S,I),w.splice(A,1),A--}return C}),r.formatArgs.call(S,w),(S.log||r.log).apply(S,w)}return y.namespace=h,y.useColors=r.useColors(),y.color=r.selectColor(h),y.extend=s,y.destroy=r.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(m!==r.namespaces&&(m=r.namespaces,g=r.enabled(h)),g),set:w=>{p=w}}),typeof r.init=="function"&&r.init(y),y}function s(h,f){const p=r(this.namespace+(typeof f>"u"?":":f)+h);return p.log=this.log,p}function i(h){r.save(h),r.namespaces=h,r.names=[],r.skips=[];const f=(typeof h=="string"?h:"").trim().replace(" ",",").split(",").filter(Boolean);for(const p of f)p[0]==="-"?r.skips.push(p.slice(1)):r.names.push(p)}function a(h,f){let p=0,m=0,g=-1,y=0;for(;p<h.length;)if(m<f.length&&(f[m]===h[p]||f[m]==="*"))f[m]==="*"?(g=m,y=p,m++):(p++,m++);else if(g!==-1)m=g+1,y++,p=y;else return!1;for(;m<f.length&&f[m]==="*";)m++;return m===f.length}function o(){const h=[...r.names,...r.skips.map(f=>"-"+f)].join(",");return r.enable(""),h}function u(h){for(const f of r.skips)if(a(h,f))return!1;for(const f of r.names)if(a(h,f))return!0;return!1}function l(h){return h instanceof Error?h.stack||h.message:h}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return XP=n,XP}var HD;function hee(){return HD||(HD=1,function(n,e){e.formatArgs=r,e.save=s,e.load=i,e.useColors=t,e.storage=a(),e.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let u;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(u=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(u[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const l="color: "+this.color;u.splice(1,0,l,"color: inherit");let d=0,h=0;u[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(d++,f==="%c"&&(h=d))}),u.splice(h,0,l)}e.log=console.debug||console.log||(()=>{});function s(u){try{u?e.storage.setItem("debug",u):e.storage.removeItem("debug")}catch{}}function i(){let u;try{u=e.storage.getItem("debug")}catch{}return!u&&typeof process<"u"&&"env"in process&&(u=process.env.DEBUG),u}function a(){try{return localStorage}catch{}}n.exports=dee()(e);const{formatters:o}=n.exports;o.j=function(u){try{return JSON.stringify(u)}catch(l){return"[UnexpectedJSONParseError]: "+l.message}}}(o0,o0.exports)),o0.exports}var fee=hee();const pee=Object.freeze(Object.defineProperty({__proto__:null,default:Ve(fee)},Symbol.toStringTag,{value:"Module"}));var YP={},_m={},Rc={};function mee(n){return{all:n=n||new Map,on:function(e,t){var r=n.get(e);r?r.push(t):n.set(e,[t])},off:function(e,t){var r=n.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):n.set(e,[]))},emit:function(e,t){var r=n.get(e);r&&r.slice().map(function(s){s(t)}),(r=n.get("*"))&&r.slice().map(function(s){s(e,t)})}}}const gee=tt(Object.freeze(Object.defineProperty({__proto__:null,default:mee},Symbol.toStringTag,{value:"Module"})));var WD;function xd(){var r,s;if(WD)return Rc;WD=1;var n=Rc&&Rc.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Rc,"__esModule",{value:!0}),Rc.EventEmitter=void 0;const e=n(gee);let t=(s=class{constructor(){b(this,r,(0,e.default)())}on(a,o){return c(this,r).on(a,o),this}once(a,o){const u=l=>{o(l),this.off(a,u)};return this.on(a,u)}off(a,o){return c(this,r).off(a,o),this}emit(a,o){c(this,r).emit(a,o)}removeAllListeners(a){return a?c(this,r).all.delete(a):c(this,r).all.clear(),this}},r=new WeakMap,s);return Rc.EventEmitter=t,Rc}var vm={},zD;function hs(){if(zD)return vm;zD=1,Object.defineProperty(vm,"__esModule",{value:!0}),vm.LogType=void 0;var n;return function(e){e.bidi="bidi",e.cdp="cdp",e.debug="debug",e.debugError="debug:error",e.debugInfo="debug:info"}(n||(vm.LogType=n={})),vm}var Sm={},VD;function yee(){var r,s,i,a,o,u,w3;if(VD)return Sm;VD=1;var n;Object.defineProperty(Sm,"__esModule",{value:!0}),Sm.ProcessingQueue=void 0;const e=hs();let t=(r=class{constructor(h,f){b(this,u);b(this,s);b(this,i);b(this,a,[]);b(this,o,!1);x(this,i,h),x(this,s,f)}add(h,f){c(this,a).push([h,f]),P(this,u,w3).call(this)}},s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakSet,w3=async function(){var h;if(!c(this,o)){for(x(this,o,!0);c(this,a).length>0;){const f=c(this,a).shift();if(!f)continue;const[p,m]=f;(h=c(this,s))==null||h.call(this,n.LOGGER_PREFIX,"Processing event:",m),await p.then(g=>{var y;if(g.kind==="error"){(y=c(this,s))==null||y.call(this,e.LogType.debugError,"Event threw before sending:",g.error.message,g.error.stack);return}return c(this,i).call(this,g.value)}).catch(g=>{var y;(y=c(this,s))==null||y.call(this,e.LogType.debugError,"Event was not processed:",g==null?void 0:g.message)})}x(this,o,!1)}},Z(r,"LOGGER_PREFIX",`${e.LogType.debug}:queue`),r);return Sm.ProcessingQueue=t,n=t,Sm}var xm={},Hs={},QP={},GD;function wee(){return GD||(GD=1,Object.defineProperty(QP,"__esModule",{value:!0})),QP}var Fr={},ZD;function JD(){if(ZD)return Fr;ZD=1,Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.EVENT_NAMES=Fr.Bluetooth=Fr.Network=Fr.BrowsingContext=Fr.Log=Fr.Script=Fr.BiDiModule=void 0;var n;(function(a){a.Bluetooth="bluetooth",a.Browser="browser",a.BrowsingContext="browsingContext",a.Cdp="goog:cdp",a.DeprecatedCdp="cdp",a.Input="input",a.Log="log",a.Network="network",a.Script="script",a.Session="session"})(n||(Fr.BiDiModule=n={}));var e;(function(a){(function(o){o.Message="script.message",o.RealmCreated="script.realmCreated",o.RealmDestroyed="script.realmDestroyed"})(a.EventNames||(a.EventNames={}))})(e||(Fr.Script=e={}));var t;(function(a){(function(o){o.LogEntryAdded="log.entryAdded"})(a.EventNames||(a.EventNames={}))})(t||(Fr.Log=t={}));var r;(function(a){(function(o){o.ContextCreated="browsingContext.contextCreated",o.ContextDestroyed="browsingContext.contextDestroyed",o.DomContentLoaded="browsingContext.domContentLoaded",o.DownloadWillBegin="browsingContext.downloadWillBegin",o.FragmentNavigated="browsingContext.fragmentNavigated",o.HistoryUpdated="browsingContext.historyUpdated",o.Load="browsingContext.load",o.NavigationAborted="browsingContext.navigationAborted",o.NavigationFailed="browsingContext.navigationFailed",o.NavigationStarted="browsingContext.navigationStarted",o.UserPromptClosed="browsingContext.userPromptClosed",o.UserPromptOpened="browsingContext.userPromptOpened"})(a.EventNames||(a.EventNames={}))})(r||(Fr.BrowsingContext=r={}));var s;(function(a){(function(o){o.AuthRequired="network.authRequired",o.BeforeRequestSent="network.beforeRequestSent",o.FetchError="network.fetchError",o.ResponseCompleted="network.responseCompleted",o.ResponseStarted="network.responseStarted"})(a.EventNames||(a.EventNames={}))})(s||(Fr.Network=s={}));var i;return function(a){(function(o){o.RequestDevicePromptUpdated="bluetooth.requestDevicePromptUpdated"})(a.EventNames||(a.EventNames={}))}(i||(Fr.Bluetooth=i={})),Fr.EVENT_NAMES=new Set([...Object.values(n),...Object.values(r.EventNames),...Object.values(t.EventNames),...Object.values(s.EventNames),...Object.values(e.EventNames)]),Fr}var eA={},XD;function bee(){return XD||(XD=1,Object.defineProperty(eA,"__esModule",{value:!0})),eA}var Te={},YD;function QD(){if(YD)return Te;YD=1,Object.defineProperty(Te,"__esModule",{value:!0}),Te.NoSuchWebExtensionException=Te.InvalidWebExtensionException=Te.UnderspecifiedStoragePartitionException=Te.UnableToSetFileInputException=Te.UnableToSetCookieException=Te.NoSuchStoragePartitionException=Te.UnsupportedOperationException=Te.UnableToCloseBrowserException=Te.UnableToCaptureScreenException=Te.UnknownErrorException=Te.UnknownCommandException=Te.SessionNotCreatedException=Te.NoSuchUserContextException=Te.NoSuchScriptException=Te.NoSuchRequestException=Te.NoSuchNodeException=Te.NoSuchInterceptException=Te.NoSuchHistoryEntryException=Te.NoSuchHandleException=Te.NoSuchFrameException=Te.NoSuchElementException=Te.NoSuchAlertException=Te.MoveTargetOutOfBoundsException=Te.InvalidSessionIdException=Te.InvalidSelectorException=Te.InvalidArgumentException=Te.Exception=void 0;class n extends Error{constructor(T,L,U){super();Z(this,"error");Z(this,"message");Z(this,"stacktrace");this.error=T,this.message=L,this.stacktrace=U}toErrorResponse(T){return{type:"error",id:T,error:this.error,message:this.message,stacktrace:this.stacktrace}}}Te.Exception=n;class e extends n{constructor(O,T){super("invalid argument",O,T)}}Te.InvalidArgumentException=e;class t extends n{constructor(O,T){super("invalid selector",O,T)}}Te.InvalidSelectorException=t;class r extends n{constructor(O,T){super("invalid session id",O,T)}}Te.InvalidSessionIdException=r;class s extends n{constructor(O,T){super("move target out of bounds",O,T)}}Te.MoveTargetOutOfBoundsException=s;class i extends n{constructor(O,T){super("no such alert",O,T)}}Te.NoSuchAlertException=i;class a extends n{constructor(O,T){super("no such element",O,T)}}Te.NoSuchElementException=a;class o extends n{constructor(O,T){super("no such frame",O,T)}}Te.NoSuchFrameException=o;class u extends n{constructor(O,T){super("no such handle",O,T)}}Te.NoSuchHandleException=u;class l extends n{constructor(O,T){super("no such history entry",O,T)}}Te.NoSuchHistoryEntryException=l;class d extends n{constructor(O,T){super("no such intercept",O,T)}}Te.NoSuchInterceptException=d;class h extends n{constructor(O,T){super("no such node",O,T)}}Te.NoSuchNodeException=h;class f extends n{constructor(O,T){super("no such request",O,T)}}Te.NoSuchRequestException=f;class p extends n{constructor(O,T){super("no such script",O,T)}}Te.NoSuchScriptException=p;class m extends n{constructor(O,T){super("no such user context",O,T)}}Te.NoSuchUserContextException=m;class g extends n{constructor(O,T){super("session not created",O,T)}}Te.SessionNotCreatedException=g;class y extends n{constructor(O,T){super("unknown command",O,T)}}Te.UnknownCommandException=y;class w extends n{constructor(O,T=new Error().stack){super("unknown error",O,T)}}Te.UnknownErrorException=w;class S extends n{constructor(O,T){super("unable to capture screen",O,T)}}Te.UnableToCaptureScreenException=S;class _ extends n{constructor(O,T){super("unable to close browser",O,T)}}Te.UnableToCloseBrowserException=_;class v extends n{constructor(O,T){super("unsupported operation",O,T)}}Te.UnsupportedOperationException=v;class A extends n{constructor(O,T){super("no such storage partition",O,T)}}Te.NoSuchStoragePartitionException=A;class k extends n{constructor(O,T){super("unable to set cookie",O,T)}}Te.UnableToSetCookieException=k;class C extends n{constructor(O,T){super("unable to set file input",O,T)}}Te.UnableToSetFileInputException=C;class E extends n{constructor(O,T){super("underspecified storage partition",O,T)}}Te.UnderspecifiedStoragePartitionException=E;class N extends n{constructor(O,T){super("invalid web extension",O,T)}}Te.InvalidWebExtensionException=N;class I extends n{constructor(O,T){super("no such web extension",O,T)}}return Te.NoSuchWebExtensionException=I,Te}var tA={},e2;function _ee(){return e2||(e2=1,Object.defineProperty(tA,"__esModule",{value:!0})),tA}var rA={},t2;function vee(){return t2||(t2=1,Object.defineProperty(rA,"__esModule",{value:!0})),rA}var r2;function Nt(){return r2||(r2=1,function(n){var e=Hs&&Hs.__createBinding||(Object.create?function(i,a,o,u){u===void 0&&(u=o);var l=Object.getOwnPropertyDescriptor(a,o);(!l||("get"in l?!a.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return a[o]}}),Object.defineProperty(i,u,l)}:function(i,a,o,u){u===void 0&&(u=o),i[u]=a[o]}),t=Hs&&Hs.__setModuleDefault||(Object.create?function(i,a){Object.defineProperty(i,"default",{enumerable:!0,value:a})}:function(i,a){i.default=a}),r=Hs&&Hs.__importStar||function(){var i=function(a){return i=Object.getOwnPropertyNames||function(o){var u=[];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(u[u.length]=l);return u},i(a)};return function(a){if(a&&a.__esModule)return a;var o={};if(a!=null)for(var u=i(a),l=0;l<u.length;l++)u[l]!=="default"&&e(o,a,u[l]);return t(o,a),o}}(),s=Hs&&Hs.__exportStar||function(i,a){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&e(a,i,o)};Object.defineProperty(n,"__esModule",{value:!0}),n.ChromiumBidi=n.Cdp=void 0,n.Cdp=r(wee()),n.ChromiumBidi=r(JD()),s(bee(),n),s(QD(),n),s(_ee(),n),s(vee(),n)}(Hs)),Hs}var Em={},n2;function See(){if(n2)return Em;n2=1,Object.defineProperty(Em,"__esModule",{value:!0}),Em.BidiNoOpParser=void 0;let n=class{parseHandleRequestDevicePromptParams(t){return t}parseSimulateAdapterParameters(t){return t}parseSimulateAdvertisementParameters(t){return t}parseSimulatePreconnectedPeripheralParameters(t){return t}parseRemoveUserContextParams(t){return t}parseActivateParams(t){return t}parseCaptureScreenshotParams(t){return t}parseCloseParams(t){return t}parseCreateParams(t){return t}parseGetTreeParams(t){return t}parseHandleUserPromptParams(t){return t}parseLocateNodesParams(t){return t}parseNavigateParams(t){return t}parsePrintParams(t){return t}parseReloadParams(t){return t}parseSetViewportParams(t){return t}parseTraverseHistoryParams(t){return t}parseGetSessionParams(t){return t}parseResolveRealmParams(t){return t}parseSendCommandParams(t){return t}parseAddPreloadScriptParams(t){return t}parseCallFunctionParams(t){return t}parseDisownParams(t){return t}parseEvaluateParams(t){return t}parseGetRealmsParams(t){return t}parseRemovePreloadScriptParams(t){return t}parsePerformActionsParams(t){return t}parseReleaseActionsParams(t){return t}parseSetFilesParams(t){return t}parseAddInterceptParams(t){return t}parseContinueRequestParams(t){return t}parseContinueResponseParams(t){return t}parseContinueWithAuthParams(t){return t}parseFailRequestParams(t){return t}parseProvideResponseParams(t){return t}parseRemoveInterceptParams(t){return t}parseSetCacheBehavior(t){return t}parseSetPermissionsParams(t){return t}parseSubscribeParams(t){return t}parseDeleteCookiesParams(t){return t}parseGetCookiesParams(t){return t}parseSetCookieParams(t){return t}};return Em.BidiNoOpParser=n,Em}var km={},s2;function xee(){var t,r,s,b3,a;if(s2)return km;s2=1,Object.defineProperty(km,"__esModule",{value:!0}),km.BrowserProcessor=void 0;const n=Nt();let e=(a=class{constructor(u,l){b(this,s);b(this,t);b(this,r);x(this,t,u),x(this,r,l)}close(){return setTimeout(()=>c(this,t).sendCommand("Browser.close"),0),{}}async createUserContext(u){const l={proxyServer:u["goog:proxyServer"]??void 0},d=u["goog:proxyBypassList"]??void 0;return d&&(l.proxyBypassList=d.join(",")),{userContext:(await c(this,t).sendCommand("Target.createBrowserContext",l)).browserContextId}}async removeUserContext(u){const l=u.userContext;if(l==="default")throw new n.InvalidArgumentException("`default` user context cannot be removed");try{await c(this,t).sendCommand("Target.disposeBrowserContext",{browserContextId:l})}catch(d){throw d.message.startsWith("Failed to find context with id")?new n.NoSuchUserContextException(d.message):d}return{}}async getUserContexts(){const u=await c(this,t).sendCommand("Target.getBrowserContexts");return{userContexts:[{userContext:"default"},...u.browserContextIds.map(l=>({userContext:l}))]}}async getClientWindows(){const u=c(this,r).getTopLevelContexts().map(f=>f.cdpTarget.id),l=await Promise.all(u.map(async f=>await P(this,s,b3).call(this,f))),d=new Set,h=new Array;for(const f of l)d.has(f.clientWindow)||(d.add(f.clientWindow),h.push(f));return{clientWindows:h}}},t=new WeakMap,r=new WeakMap,s=new WeakSet,b3=async function(u){const l=await c(this,t).sendCommand("Browser.getWindowForTarget",{targetId:u});return{active:!1,clientWindow:`${l.windowId}`,state:l.bounds.windowState??"normal",height:l.bounds.height??0,width:l.bounds.width??0,x:l.bounds.left??0,y:l.bounds.top??0}},a);return km.BrowserProcessor=e,km}var Cm={},i2;function Eee(){var t,r,s,i,a;if(i2)return Cm;i2=1,Object.defineProperty(Cm,"__esModule",{value:!0}),Cm.CdpProcessor=void 0;const n=Nt();let e=(a=class{constructor(u,l,d,h){b(this,t);b(this,r);b(this,s);b(this,i);x(this,t,u),x(this,r,l),x(this,s,d),x(this,i,h)}getSession(u){const l=u.context,d=c(this,t).getContext(l).cdpTarget.cdpSessionId;return d===void 0?{}:{session:d}}resolveRealm(u){const l=u.realm,d=c(this,r).getRealm({realmId:l});if(d===void 0)throw new n.UnknownErrorException(`Could not find realm ${u.realm}`);return{executionContextId:d.executionContextId}}async sendCommand(u){return{result:await(u.session?c(this,s).getCdpClient(u.session):c(this,i)).sendCommand(u.method,u.params),session:u.session}}},t=new WeakMap,r=new WeakMap,s=new WeakMap,i=new WeakMap,a);return Cm.CdpProcessor=e,Cm}var Pm={},a2;function kee(){var t,r,s,i,_3,o;if(a2)return Pm;a2=1,Object.defineProperty(Pm,"__esModule",{value:!0}),Pm.BrowsingContextProcessor=void 0;const n=Nt();let e=(o=class{constructor(l,d,h){b(this,i);b(this,t);b(this,r);b(this,s);x(this,t,l),x(this,r,d),x(this,s,h),c(this,s).addSubscribeHook(n.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,P(this,i,_3).bind(this))}getTree(l){return{contexts:(l.root===void 0?c(this,r).getTopLevelContexts():[c(this,r).getContext(l.root)]).map(h=>h.serializeToBidiValue(l.maxDepth??Number.MAX_VALUE))}}async create(l){let d,h="default";if(l.referenceContext!==void 0){if(d=c(this,r).getContext(l.referenceContext),!d.isTopLevelContext())throw new n.InvalidArgumentException("referenceContext should be a top-level context");h=d.userContext}l.userContext!==void 0&&(h=l.userContext);const f=c(this,r).getAllContexts().filter(y=>y.userContext===h);let p=!1;switch(l.type){case"tab":p=!1;break;case"window":p=!0;break}f.length||(p=!0);let m;try{m=await c(this,t).sendCommand("Target.createTarget",{url:"about:blank",newWindow:p,browserContextId:h==="default"?void 0:h,background:l.background===!0})}catch(y){throw y.message.startsWith("Failed to find browser context with id")||y.message==="browserContextId"?new n.NoSuchUserContextException(`The context ${h} was not found`):y}const g=await c(this,r).waitForContext(m.targetId);return await g.lifecycleLoaded(),{context:g.id}}navigate(l){return c(this,r).getContext(l.context).navigate(l.url,l.wait??"none")}reload(l){return c(this,r).getContext(l.context).reload(l.ignoreCache??!1,l.wait??"none")}async activate(l){const d=c(this,r).getContext(l.context);if(!d.isTopLevelContext())throw new n.InvalidArgumentException("Activation is only supported on the top-level context");return await d.activate(),{}}async captureScreenshot(l){return await c(this,r).getContext(l.context).captureScreenshot(l)}async print(l){return await c(this,r).getContext(l.context).print(l)}async setViewport(l){const d=c(this,r).getContext(l.context);if(!d.isTopLevelContext())throw new n.InvalidArgumentException("Emulating viewport is only supported on the top-level context");return await d.setViewport(l.viewport,l.devicePixelRatio),{}}async traverseHistory(l){const d=c(this,r).getContext(l.context);if(!d)throw new n.InvalidArgumentException(`No browsing context with id ${l.context}`);if(!d.isTopLevelContext())throw new n.InvalidArgumentException("Traversing history is only supported on the top-level context");return await d.traverseHistory(l.delta),{}}async handleUserPrompt(l){var h;const d=c(this,r).getContext(l.context);try{await d.handleUserPrompt(l.accept,l.userText)}catch(f){throw(h=f.message)!=null&&h.includes("No dialog is showing")?new n.NoSuchAlertException("No dialog is showing"):f}return{}}async close(l){const d=c(this,r).getContext(l.context);if(!d.isTopLevelContext())throw new n.InvalidArgumentException(`Non top-level browsing context ${d.id} cannot be closed.`);const h=d.cdpTarget.parentCdpClient;try{const f=new Promise(p=>{const m=g=>{g.targetId===l.context&&(h.off("Target.detachedFromTarget",m),p())};h.on("Target.detachedFromTarget",m)});try{l.promptUnload?await d.close():await h.sendCommand("Target.closeTarget",{targetId:l.context})}catch(p){if(!h.isCloseError(p))throw p}await f}catch(f){if(!(f.code===-32e3&&f.message==="Not attached to an active page"))throw f}return{}}async locateNodes(l){return await c(this,r).getContext(l.context).locateNodes(l)}},t=new WeakMap,r=new WeakMap,s=new WeakMap,i=new WeakSet,_3=function(l){return[c(this,r).getContext(l),...c(this,r).getContext(l).allChildren].forEach(f=>{c(this,s).registerEvent({type:"event",method:n.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,params:f.serializeToBidiValue()},f.id)}),Promise.resolve()},o);return Pm.BrowsingContextProcessor=e,Pm}var Am={},c0={},o2;function Mc(){if(o2)return c0;o2=1,Object.defineProperty(c0,"__esModule",{value:!0}),c0.assert=n;function n(e,t){if(!e)throw new Error(t??"Internal assertion failed.")}return c0}var Tm={},Im={},c2;function Cee(){if(c2)return Im;c2=1,Object.defineProperty(Im,"__esModule",{value:!0}),Im.isSingleComplexGrapheme=n,Im.isSingleGrapheme=e;function n(t){return e(t)&&t.length>1}function e(t){return[...new Intl.Segmenter("en",{granularity:"grapheme"}).segment(t)].length===1}return Im}var Ws={},u2;function l2(){var s,i,Jw,o,u,l,d,h,f,p;if(u2)return Ws;u2=1,Object.defineProperty(Ws,"__esModule",{value:!0}),Ws.WheelSource=Ws.PointerSource=Ws.KeySource=Ws.NoneSource=void 0;class n{constructor(){Z(this,"type","none")}}Ws.NoneSource=n;class e{constructor(){b(this,i);Z(this,"type","key");Z(this,"pressed",new Set);b(this,s,0)}get modifiers(){return c(this,s)}get alt(){return(c(this,s)&1)===1}set alt(g){P(this,i,Jw).call(this,g,1)}get ctrl(){return(c(this,s)&2)===2}set ctrl(g){P(this,i,Jw).call(this,g,2)}get meta(){return(c(this,s)&4)===4}set meta(g){P(this,i,Jw).call(this,g,4)}get shift(){return(c(this,s)&8)===8}set shift(g){P(this,i,Jw).call(this,g,8)}}s=new WeakMap,i=new WeakSet,Jw=function(g,y){g?x(this,s,c(this,s)|y):x(this,s,c(this,s)&~y)},Ws.KeySource=e;class t{constructor(g,y){Z(this,"type","pointer");Z(this,"subtype");Z(this,"pointerId");Z(this,"pressed",new Set);Z(this,"x",0);Z(this,"y",0);Z(this,"radiusX");Z(this,"radiusY");Z(this,"force");b(this,p,new Map);this.pointerId=g,this.subtype=y}get buttons(){let g=0;for(const y of this.pressed)switch(y){case 0:g|=1;break;case 1:g|=4;break;case 2:g|=2;break;case 3:g|=8;break;case 4:g|=16;break}return g}setClickCount(g,y){let w=c(this,p).get(g);return(!w||w.compare(y))&&(w=y),++w.count,c(this,p).set(g,w),w.count}getClickCount(g){var y;return((y=c(this,p).get(g))==null?void 0:y.count)??0}}p=new WeakMap,Z(t,"ClickContext",(o=class{constructor(y,w,S){Z(this,"count",0);b(this,d);b(this,h);b(this,f);x(this,d,y),x(this,h,w),x(this,f,S)}compare(y){return c(y,f)-c(this,f)>c(o,u)||Math.abs(c(y,d)-c(this,d))>c(o,l)||Math.abs(c(y,h)-c(this,h))>c(o,l)}},u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,b(o,u,500),b(o,l,2),o)),Ws.PointerSource=t;class r{constructor(){Z(this,"type","wheel")}}return Ws.WheelSource=r,Ws}var Ed={},d2;function Pee(){if(d2)return Ed;d2=1,Object.defineProperty(Ed,"__esModule",{value:!0}),Ed.getNormalizedKey=n,Ed.getKeyCode=e,Ed.getKeyLocation=t;function n(r){switch(r){case"":return"Unidentified";case"":return"Cancel";case"":return"Help";case"":return"Backspace";case"":return"Tab";case"":return"Clear";case"":case"":return"Enter";case"":return"Shift";case"":return"Control";case"":return"Alt";case"":return"Pause";case"":return"Escape";case"":return" ";case"":return"PageUp";case"":return"PageDown";case"":return"End";case"":return"Home";case"":return"ArrowLeft";case"":return"ArrowUp";case"":return"ArrowRight";case"":return"ArrowDown";case"":return"Insert";case"":return"Delete";case"":return";";case"":return"=";case"":return"0";case"":return"1";case"":return"2";case"":return"3";case"":return"4";case"":return"5";case"":return"6";case"":return"7";case"":return"8";case"":return"9";case"":return"*";case"":return"+";case"":return",";case"":return"-";case"":return".";case"":return"/";case"":return"F1";case"":return"F2";case"":return"F3";case"":return"F4";case"":return"F5";case"":return"F6";case"":return"F7";case"":return"F8";case"":return"F9";case"":return"F10";case"":return"F11";case"":return"F12";case"":return"Meta";case"":return"ZenkakuHankaku";case"":return"Shift";case"":return"Control";case"":return"Alt";case"":return"Meta";case"":return"PageUp";case"":return"PageDown";case"":return"End";case"":return"Home";case"":return"ArrowLeft";case"":return"ArrowUp";case"":return"ArrowRight";case"":return"ArrowDown";case"":return"Insert";case"":return"Delete";default:return r}}function e(r){switch(r){case"`":case"~":return"Backquote";case"\\":case"|":return"Backslash";case"":return"Backspace";case"[":case"{":return"BracketLeft";case"]":case"}":return"BracketRight";case",":case"<":return"Comma";case"0":case")":return"Digit0";case"1":case"!":return"Digit1";case"2":case"@":return"Digit2";case"3":case"#":return"Digit3";case"4":case"$":return"Digit4";case"5":case"%":return"Digit5";case"6":case"^":return"Digit6";case"7":case"&":return"Digit7";case"8":case"*":return"Digit8";case"9":case"(":return"Digit9";case"=":case"+":return"Equal";case">":return"IntlBackslash";case"a":case"A":return"KeyA";case"b":case"B":return"KeyB";case"c":case"C":return"KeyC";case"d":case"D":return"KeyD";case"e":case"E":return"KeyE";case"f":case"F":return"KeyF";case"g":case"G":return"KeyG";case"h":case"H":return"KeyH";case"i":case"I":return"KeyI";case"j":case"J":return"KeyJ";case"k":case"K":return"KeyK";case"l":case"L":return"KeyL";case"m":case"M":return"KeyM";case"n":case"N":return"KeyN";case"o":case"O":return"KeyO";case"p":case"P":return"KeyP";case"q":case"Q":return"KeyQ";case"r":case"R":return"KeyR";case"s":case"S":return"KeyS";case"t":case"T":return"KeyT";case"u":case"U":return"KeyU";case"v":case"V":return"KeyV";case"w":case"W":return"KeyW";case"x":case"X":return"KeyX";case"y":case"Y":return"KeyY";case"z":case"Z":return"KeyZ";case"-":case"_":return"Minus";case".":return"Period";case"'":case'"':return"Quote";case";":case":":return"Semicolon";case"/":case"?":return"Slash";case"":return"AltLeft";case"":return"AltRight";case"":return"ControlLeft";case"":return"ControlRight";case"":return"Enter";case"":return"Pause";case"":return"MetaLeft";case"":return"MetaRight";case"":return"ShiftLeft";case"":return"ShiftRight";case" ":case"":return"Space";case"":return"Tab";case"":return"Delete";case"":return"End";case"":return"Help";case"":return"Home";case"":return"Insert";case"":return"PageDown";case"":return"PageUp";case"":return"ArrowDown";case"":return"ArrowLeft";case"":return"ArrowRight";case"":return"ArrowUp";case"":return"Escape";case"":return"F1";case"":return"F2";case"":return"F3";case"":return"F4";case"":return"F5";case"":return"F6";case"":return"F7";case"":return"F8";case"":return"F9";case"":return"F10";case"":return"F11";case"":return"F12";case"":return"NumpadEqual";case"":case"":return"Numpad0";case"":case"":return"Numpad1";case"":case"":return"Numpad2";case"":case"":return"Numpad3";case"":case"":return"Numpad4";case"":return"Numpad5";case"":case"":return"Numpad6";case"":case"":return"Numpad7";case"":case"":return"Numpad8";case"":case"":return"Numpad9";case"":return"NumpadAdd";case"":return"NumpadComma";case"":case"":return"NumpadDecimal";case"":return"NumpadDivide";case"":return"NumpadEnter";case"":return"NumpadMultiply";case"":return"NumpadSubtract";default:return}}function t(r){switch(r){case"":case"":case"":case"":case"":return 1;case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":case"":return 3;case"":case"":case"":case"":return 2;default:return 0}}return Ed}var Om={},h2;function Aee(){return h2||(h2=1,Object.defineProperty(Om,"__esModule",{value:!0}),Om.KeyToKeyCode=void 0,Om.KeyToKeyCode={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,Abort:3,Help:6,Backspace:8,Tab:9,Numpad5:12,NumpadEnter:13,Enter:13,"\\r":13,"\\n":13,ShiftLeft:16,ShiftRight:16,ControlLeft:17,ControlRight:17,AltLeft:18,AltRight:18,Pause:19,CapsLock:20,Escape:27,Convert:28,NonConvert:29,Space:32,Numpad9:33,PageUp:33,Numpad3:34,PageDown:34,End:35,Numpad1:35,Home:36,Numpad7:36,ArrowLeft:37,Numpad4:37,Numpad8:38,ArrowUp:38,ArrowRight:39,Numpad6:39,Numpad2:40,ArrowDown:40,Select:41,Open:43,PrintScreen:44,Insert:45,Numpad0:45,Delete:46,NumpadDecimal:46,Digit0:48,Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,MetaLeft:91,MetaRight:92,ContextMenu:93,NumpadMultiply:106,NumpadAdd:107,NumpadSubtract:109,NumpadDivide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,NumLock:144,ScrollLock:145,AudioVolumeMute:173,AudioVolumeDown:174,AudioVolumeUp:175,MediaTrackNext:176,MediaTrackPrevious:177,MediaStop:178,MediaPlayPause:179,Semicolon:186,Equal:187,NumpadEqual:187,Comma:188,Minus:189,Period:190,Slash:191,Backquote:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222,AltGraph:225,Props:247,Cancel:3,Clear:12,Shift:16,Control:17,Alt:18,Accept:30,ModeChange:31," ":32,Print:42,Execute:43,"\\u0000":46,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,Meta:91,"*":106,"+":107,"-":109,"/":111,";":186,"=":187,",":188,".":190,"`":192,"[":219,"\\\\":220,"]":221,"'":222,Attn:246,CrSel:247,ExSel:248,EraseEof:249,Play:250,ZoomOut:251,")":48,"!":49,"@":50,"#":51,$:52,"%":53,"^":54,"&":55,"(":57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,":":186,"<":188,_:189,">":190,"?":191,"~":192,"{":219,"|":220,"}":221,'"':222,Camera:44,EndCall:95,VolumeDown:182,VolumeUp:183}),Om}var f2;function Tee(){var g,y,w,S,_,v,A,k,Ar,v3,S3,x3,E3,k3,WT,C3,P3,A3;if(f2)return Tm;f2=1,Object.defineProperty(Tm,"__esModule",{value:!0}),Tm.ActionDispatcher=void 0;const n=Nt(),e=Mc(),t=Cee(),r=l2(),s=Pee(),i=Aee(),a=(F=>{const j=F.getClientRects()[0],B=Math.max(0,Math.min(j.x,j.x+j.width)),D=Math.min(window.innerWidth,Math.max(j.x,j.x+j.width)),z=Math.max(0,Math.min(j.y,j.y+j.height)),G=Math.min(window.innerHeight,Math.max(j.y,j.y+j.height));return[B+(D-B>>1),z+(G-z>>1)]}).toString(),o=(()=>navigator.platform.toLowerCase().includes("mac")).toString();async function u(F,j){var te,V,K,ae;const D=await(await F.getOrCreateSandbox(void 0)).callFunction(a,!1,{type:"undefined"},[j]);if(D.type==="exception")throw new n.NoSuchElementException(`Origin element ${j.sharedId} was not found`);(0,e.assert)(D.result.type==="array"),(0,e.assert)(((V=(te=D.result.value)==null?void 0:te[0])==null?void 0:V.type)==="number"),(0,e.assert)(((ae=(K=D.result.value)==null?void 0:K[1])==null?void 0:ae.type)==="number");const{result:{value:[{value:z},{value:G}]}}=D;return{x:z,y:G}}let l=(g=class{constructor(j,B,D,z){b(this,k);b(this,y);b(this,w,0);b(this,S,0);b(this,_);b(this,v);b(this,A);x(this,y,B),x(this,_,j),x(this,v,D),x(this,A,z)}async dispatchActions(j){await c(this,_).queue.run(async()=>{for(const B of j)await this.dispatchTickActions(B)})}async dispatchTickActions(j){x(this,w,performance.now()),x(this,S,0);for(const{action:D}of j)"duration"in D&&D.duration!==void 0&&x(this,S,Math.max(c(this,S),D.duration));const B=[new Promise(D=>setTimeout(D,c(this,S)))];for(const D of j)B.push(P(this,k,v3).call(this,D));await Promise.all(B)}},y=new WeakMap,w=new WeakMap,S=new WeakMap,_=new WeakMap,v=new WeakMap,A=new WeakMap,k=new WeakSet,Ar=function(){return c(this,y).getContext(c(this,v))},v3=async function({id:j,action:B}){const D=c(this,_).get(j),z=c(this,_).getGlobalKeyState();switch(B.type){case"keyDown":{await P(this,k,P3).call(this,D,B),c(this,_).cancelList.push({id:j,action:{...B,type:"keyUp"}});break}case"keyUp":{await P(this,k,A3).call(this,D,B);break}case"pause":break;case"pointerDown":{await P(this,k,S3).call(this,D,z,B),c(this,_).cancelList.push({id:j,action:{...B,type:"pointerUp"}});break}case"pointerMove":{await P(this,k,E3).call(this,D,z,B);break}case"pointerUp":{await P(this,k,x3).call(this,D,z,B);break}case"scroll":{await P(this,k,C3).call(this,D,z,B);break}}},S3=async function(j,B,D){const{button:z}=D;if(j.pressed.has(z))return;j.pressed.add(z);const{x:G,y:te,subtype:V}=j,{width:K,height:ae,pressure:ve,twist:de,tangentialPressure:et}=D,{tiltX:we,tiltY:R}=p(D),{modifiers:M}=B,{radiusX:q,radiusY:W}=m(K??1,ae??1);switch(V){case"mouse":case"pen":await c(this,k,Ar).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mousePressed",x:G,y:te,modifiers:M,button:f(z),buttons:j.buttons,clickCount:j.setClickCount(z,new r.PointerSource.ClickContext(G,te,performance.now())),pointerType:V,tangentialPressure:et,tiltX:we,tiltY:R,twist:de,force:ve});break;case"touch":await c(this,k,Ar).cdpTarget.cdpClient.sendCommand("Input.dispatchTouchEvent",{type:"touchStart",touchPoints:[{x:G,y:te,radiusX:q,radiusY:W,tangentialPressure:et,tiltX:we,tiltY:R,twist:de,force:ve,id:j.pointerId}],modifiers:M});break}j.radiusX=q,j.radiusY=W,j.force=ve},x3=function(j,B,D){const{button:z}=D;if(!j.pressed.has(z))return;j.pressed.delete(z);const{x:G,y:te,force:V,radiusX:K,radiusY:ae,subtype:ve}=j,{modifiers:de}=B;switch(ve){case"mouse":case"pen":return c(this,k,Ar).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseReleased",x:G,y:te,modifiers:de,button:f(z),buttons:j.buttons,clickCount:j.getClickCount(z),pointerType:ve});case"touch":return c(this,k,Ar).cdpTarget.cdpClient.sendCommand("Input.dispatchTouchEvent",{type:"touchEnd",touchPoints:[{x:G,y:te,id:j.pointerId,force:V,radiusX:K,radiusY:ae}],modifiers:de})}},E3=async function(j,B,D){const{x:z,y:G,subtype:te}=j,{width:V,height:K,pressure:ae,twist:ve,tangentialPressure:de,x:et,y:we,origin:R="viewport",duration:M=c(this,S)}=D,{tiltX:q,tiltY:W}=p(D),{radiusX:X,radiusY:re}=m(V??1,K??1),{targetX:ce,targetY:Re}=await P(this,k,WT).call(this,R,et,we,z,G);if(ce<0||Re<0)throw new n.MoveTargetOutOfBoundsException(`Cannot move beyond viewport (x: ${ce}, y: ${Re})`);let le;do{const Ne=M>0?(performance.now()-c(this,w))/M:1;le=Ne>=1;let Se,H;if(le?(Se=ce,H=Re):(Se=Math.round(Ne*(ce-z)+z),H=Math.round(Ne*(Re-G)+G)),j.x!==Se||j.y!==H){const{modifiers:ee}=B;switch(te){case"mouse":await c(this,k,Ar).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseMoved",x:Se,y:H,modifiers:ee,clickCount:0,button:f(j.pressed.values().next().value??5),buttons:j.buttons,pointerType:te,tangentialPressure:de,tiltX:q,tiltY:W,twist:ve,force:ae});break;case"pen":j.pressed.size!==0&&await c(this,k,Ar).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseMoved",x:Se,y:H,modifiers:ee,clickCount:0,button:f(j.pressed.values().next().value??5),buttons:j.buttons,pointerType:te,tangentialPressure:de,tiltX:q,tiltY:W,twist:ve,force:ae??.5});break;case"touch":j.pressed.size!==0&&await c(this,k,Ar).cdpTarget.cdpClient.sendCommand("Input.dispatchTouchEvent",{type:"touchMove",touchPoints:[{x:Se,y:H,radiusX:X,radiusY:re,tangentialPressure:de,tiltX:q,tiltY:W,twist:ve,force:ae,id:j.pointerId}],modifiers:ee});break}j.x=Se,j.y=H,j.radiusX=X,j.radiusY=re,j.force=ae}}while(!le)},k3=async function(){if(c(this,k,Ar).id===c(this,k,Ar).cdpTarget.id)return{x:0,y:0};const{backendNodeId:j}=await c(this,k,Ar).cdpTarget.cdpClient.sendCommand("DOM.getFrameOwner",{frameId:c(this,k,Ar).id}),{model:B}=await c(this,k,Ar).cdpTarget.cdpClient.sendCommand("DOM.getBoxModel",{backendNodeId:j});return{x:B.content[0],y:B.content[1]}},WT=async function(j,B,D,z,G){let te,V;const K=await P(this,k,k3).call(this);switch(j){case"viewport":te=B+K.x,V=D+K.y;break;case"pointer":te=z+B+K.x,V=G+D+K.y;break;default:{const{x:ae,y:ve}=await u(c(this,k,Ar),j.element);te=ae+B+K.x,V=ve+D+K.y;break}}return{targetX:te,targetY:V}},C3=async function(j,B,D){const{deltaX:z,deltaY:G,x:te,y:V,origin:K="viewport",duration:ae=c(this,S)}=D;if(K==="pointer")throw new n.InvalidArgumentException('"pointer" origin is invalid for scrolling.');const{targetX:ve,targetY:de}=await P(this,k,WT).call(this,K,te,V,0,0);if(ve<0||de<0)throw new n.MoveTargetOutOfBoundsException(`Cannot move beyond viewport (x: ${ve}, y: ${de})`);let et=0,we=0,R;do{const M=ae>0?(performance.now()-c(this,w))/ae:1;R=M>=1;let q,W;if(R?(q=z-et,W=G-we):(q=Math.round(M*z-et),W=Math.round(M*G-we)),q!==0||W!==0){const{modifiers:X}=B;await c(this,k,Ar).cdpTarget.cdpClient.sendCommand("Input.dispatchMouseEvent",{type:"mouseWheel",deltaX:q,deltaY:W,x:ve,y:de,modifiers:X}),et+=q,we+=W}}while(!R)},P3=async function(j,B){const D=B.value;if(!(0,t.isSingleGrapheme)(D))throw new n.InvalidArgumentException(`Invalid key value: ${D}`);const z=(0,t.isSingleComplexGrapheme)(D),G=(0,s.getNormalizedKey)(D),te=j.pressed.has(G),V=(0,s.getKeyCode)(D),K=(0,s.getKeyLocation)(D);switch(G){case"Alt":j.alt=!0;break;case"Shift":j.shift=!0;break;case"Control":j.ctrl=!0;break;case"Meta":j.meta=!0;break}j.pressed.add(G);const{modifiers:ae}=j,ve=d(G,j,z),de=h(V??"",j)??ve;let et;if(c(this,A)&&j.meta)switch(V){case"KeyA":et="SelectAll";break;case"KeyC":et="Copy";break;case"KeyV":et=j.shift?"PasteAndMatchStyle":"Paste";break;case"KeyX":et="Cut";break;case"KeyZ":et=j.shift?"Redo":"Undo";break}const we=[c(this,k,Ar).cdpTarget.cdpClient.sendCommand("Input.dispatchKeyEvent",{type:de?"keyDown":"rawKeyDown",windowsVirtualKeyCode:i.KeyToKeyCode[G],key:G,code:V,text:de,unmodifiedText:ve,autoRepeat:te,isSystemKey:j.alt||void 0,location:K<3?K:void 0,isKeypad:K===3,modifiers:ae,commands:et?[et]:void 0})];G==="Escape"&&!j.alt&&(c(this,A)&&!j.ctrl&&!j.meta||!c(this,A))&&we.push(c(this,k,Ar).cdpTarget.cdpClient.sendCommand("Input.cancelDragging")),await Promise.all(we)},A3=function(j,B){const D=B.value;if(!(0,t.isSingleGrapheme)(D))throw new n.InvalidArgumentException(`Invalid key value: ${D}`);const z=(0,t.isSingleComplexGrapheme)(D),G=(0,s.getNormalizedKey)(D);if(!j.pressed.has(G))return;const te=(0,s.getKeyCode)(D),V=(0,s.getKeyLocation)(D);switch(G){case"Alt":j.alt=!1;break;case"Shift":j.shift=!1;break;case"Control":j.ctrl=!1;break;case"Meta":j.meta=!1;break}j.pressed.delete(G);const{modifiers:K}=j,ae=d(G,j,z),ve=h(te??"",j)??ae;return c(this,k,Ar).cdpTarget.cdpClient.sendCommand("Input.dispatchKeyEvent",{type:"keyUp",windowsVirtualKeyCode:i.KeyToKeyCode[G],key:G,code:te,text:ve,unmodifiedText:ae,location:V<3?V:void 0,isSystemKey:j.alt||void 0,isKeypad:V===3,modifiers:K})},Z(g,"isMacOS",async j=>{const B=await(await j.getOrCreateSandbox(void 0)).callFunction(o,!1);return(0,e.assert)(B.type!=="exception"),(0,e.assert)(B.result.type==="boolean"),B.result.value}),g);Tm.ActionDispatcher=l;const d=(F,j,B)=>B?F:F==="Enter"?"\r":[...F].length===1?j.shift?F.toLocaleUpperCase("en-US"):F:void 0,h=(F,j)=>{if(j.ctrl){switch(F){case"Digit2":if(j.shift)return"\0";break;case"KeyA":return"";case"KeyB":return"";case"KeyC":return"";case"KeyD":return"";case"KeyE":return"";case"KeyF":return"";case"KeyG":return"\x07";case"KeyH":return"\b";case"KeyI":return"	";case"KeyJ":return`
`;case"KeyK":return"\v";case"KeyL":return"\f";case"KeyM":return"\r";case"KeyN":return"";case"KeyO":return"";case"KeyP":return"";case"KeyQ":return"";case"KeyR":return"";case"KeyS":return"";case"KeyT":return"";case"KeyU":return"";case"KeyV":return"";case"KeyW":return"";case"KeyX":return"";case"KeyY":return"";case"KeyZ":return"";case"BracketLeft":return"\x1B";case"Backslash":return"";case"BracketRight":return"";case"Digit6":if(j.shift)return"";break;case"Minus":return""}return""}if(j.alt)return""};function f(F){switch(F){case 0:return"left";case 1:return"middle";case 2:return"right";case 3:return"back";case 4:return"forward";default:return"none"}}function p(F){const j=F.altitudeAngle??Math.PI/2,B=F.azimuthAngle??0;let D=0,z=0;if(j===0&&((B===0||B===2*Math.PI)&&(D=Math.PI/2),B===Math.PI/2&&(z=Math.PI/2),B===Math.PI&&(D=-Math.PI/2),B===3*Math.PI/2&&(z=-Math.PI/2),B>0&&B<Math.PI/2&&(D=Math.PI/2,z=Math.PI/2),B>Math.PI/2&&B<Math.PI&&(D=-Math.PI/2,z=Math.PI/2),B>Math.PI&&B<3*Math.PI/2&&(D=-Math.PI/2,z=-Math.PI/2),B>3*Math.PI/2&&B<2*Math.PI&&(D=Math.PI/2,z=-Math.PI/2)),j!==0){const te=Math.tan(j);D=Math.atan(Math.cos(B)/te),z=Math.atan(Math.sin(B)/te)}const G=180/Math.PI;return{tiltX:Math.round(D*G),tiltY:Math.round(z*G)}}function m(F,j){return{radiusX:F?F/2:.5,radiusY:j?j/2:.5}}return Tm}var Rm={},Mm={},Nm={},p2;function Iee(){var e,t,r,zT,i;if(p2)return Nm;p2=1,Object.defineProperty(Nm,"__esModule",{value:!0}),Nm.Mutex=void 0;let n=(i=class{constructor(){b(this,r);b(this,e,!1);b(this,t,[])}acquire(){const o={resolved:!1};return c(this,e)?new Promise(u=>{c(this,t).push(()=>u(P(this,r,zT).bind(this,o)))}):(x(this,e,!0),Promise.resolve(P(this,r,zT).bind(this,o)))}async run(o){const u=await this.acquire();try{return await o()}finally{u()}}},e=new WeakMap,t=new WeakMap,r=new WeakSet,zT=function(o){if(o.resolved)throw new Error("Cannot release more than once.");o.resolved=!0;const u=c(this,t).shift();if(!u){x(this,e,!1);return}u()},i);return Nm.Mutex=n,Nm}var m2;function Oee(){var s,i,a;if(m2)return Mm;m2=1,Object.defineProperty(Mm,"__esModule",{value:!0}),Mm.InputState=void 0;const n=Nt(),e=Iee(),t=l2();let r=(a=class{constructor(){Z(this,"cancelList",[]);b(this,s,new Map);b(this,i,new e.Mutex)}getOrCreate(u,l,d){let h=c(this,s).get(u);if(!h){switch(l){case"none":h=new t.NoneSource;break;case"key":h=new t.KeySource;break;case"pointer":{let f=d==="mouse"?0:2;const p=new Set;for(const[,m]of c(this,s))m.type==="pointer"&&p.add(m.pointerId);for(;p.has(f);)++f;h=new t.PointerSource(f,d);break}case"wheel":h=new t.WheelSource;break;default:throw new n.InvalidArgumentException(`Expected "none", "key", "pointer", or "wheel". Found unknown source type ${l}.`)}return c(this,s).set(u,h),h}if(h.type!==l)throw new n.InvalidArgumentException(`Input source type of ${u} is ${h.type}, but received ${l}.`);return h}get(u){const l=c(this,s).get(u);if(!l)throw new n.UnknownErrorException("Internal error.");return l}getGlobalKeyState(){const u=new t.KeySource;for(const[,l]of c(this,s))if(l.type==="key"){for(const d of l.pressed)u.pressed.add(d);u.alt||(u.alt=l.alt),u.ctrl||(u.ctrl=l.ctrl),u.meta||(u.meta=l.meta),u.shift||(u.shift=l.shift)}return u}get queue(){return c(this,i)}},s=new WeakMap,i=new WeakMap,a);return Mm.InputState=r,Mm}var g2;function Ree(){if(g2)return Rm;g2=1,Object.defineProperty(Rm,"__esModule",{value:!0}),Rm.InputStateManager=void 0;const n=Mc(),e=Oee();let t=class extends WeakMap{get(s){return(0,n.assert)(s.isTopLevelContext()),this.has(s)||this.set(s,new e.InputState),super.get(s)}};return Rm.InputStateManager=t,Rm}var y2;function Mee(){var i,a,o,T3,l;if(y2)return Am;y2=1,Object.defineProperty(Am,"__esModule",{value:!0}),Am.InputProcessor=void 0;const n=Nt(),e=Mc(),t=Tee(),r=Ree();let s=(l=class{constructor(h){b(this,o);b(this,i);b(this,a,new r.InputStateManager);x(this,i,h)}async performActions(h){const f=c(this,i).getContext(h.context),p=c(this,a).get(f.top),m=P(this,o,T3).call(this,h,p);return await new t.ActionDispatcher(p,c(this,i),h.context,await t.ActionDispatcher.isMacOS(f).catch(()=>!1)).dispatchActions(m),{}}async releaseActions(h){const f=c(this,i).getContext(h.context),p=f.top,m=c(this,a).get(p);return await new t.ActionDispatcher(m,c(this,i),h.context,await t.ActionDispatcher.isMacOS(f).catch(()=>!1)).dispatchTickActions(m.cancelList.reverse()),c(this,a).delete(p),{}}async setFiles(h){const p=await c(this,i).getContext(h.context).getOrCreateSandbox(void 0);let m;try{m=await p.callFunction(String(function(S){if(!(this instanceof HTMLInputElement))return this instanceof Element?1:0;if(this.type!=="file")return 2;if(this.disabled)return 3;if(S>1&&!this.multiple)return 4}),!1,h.element,[{type:"number",value:h.files.length}])}catch{throw new n.NoSuchNodeException(`Could not find element ${h.element.sharedId}`)}if((0,e.assert)(m.type==="success"),m.result.type==="number")switch(m.result.value){case 0:throw new n.NoSuchElementException(`Could not find element ${h.element.sharedId}`);case 1:throw new n.UnableToSetFileInputException(`Element ${h.element.sharedId} is not a input`);case 2:throw new n.UnableToSetFileInputException(`Input element ${h.element.sharedId} is not a file type`);case 3:throw new n.UnableToSetFileInputException(`Input element ${h.element.sharedId} is disabled`);case 4:throw new n.UnableToSetFileInputException("Cannot set multiple files on a non-multiple input element")}if(h.files.length===0)return await p.callFunction(String(function(){var S;if(((S=this.files)==null?void 0:S.length)===0){this.dispatchEvent(new Event("cancel",{bubbles:!0}));return}this.files=new DataTransfer().files,this.dispatchEvent(new Event("input",{bubbles:!0,composed:!0})),this.dispatchEvent(new Event("change",{bubbles:!0}))}),!1,h.element),{};const g=[];for(let w=0;w<h.files.length;++w){const S=await p.callFunction(String(function(k){var C;return(C=this.files)==null?void 0:C.item(k)}),!1,h.element,[{type:"number",value:0}],"root");if((0,e.assert)(S.type==="success"),S.result.type!=="object")break;const{handle:_}=S.result;(0,e.assert)(_!==void 0);const{path:v}=await p.cdpClient.sendCommand("DOM.getFileInfo",{objectId:_});g.push(v),p.disown(_).catch(void 0)}g.sort();const y=[...h.files].sort();if(g.length!==h.files.length||y.some((w,S)=>g[S]!==w)){const{objectId:w}=await p.deserializeForCdp(h.element);(0,e.assert)(w!==void 0),await p.cdpClient.sendCommand("DOM.setFileInputFiles",{files:h.files,objectId:w})}else await p.callFunction(String(function(){this.dispatchEvent(new Event("cancel",{bubbles:!0}))}),!1,h.element);return{}}},i=new WeakMap,a=new WeakMap,o=new WeakSet,T3=function(h,f){var m;const p=[];for(const g of h.actions){switch(g.type){case"pointer":{g.parameters??(g.parameters={pointerType:"mouse"}),(m=g.parameters).pointerType??(m.pointerType="mouse");const w=f.getOrCreate(g.id,"pointer",g.parameters.pointerType);if(w.subtype!==g.parameters.pointerType)throw new n.InvalidArgumentException(`Expected input source ${g.id} to be ${w.subtype}; got ${g.parameters.pointerType}.`);break}default:f.getOrCreate(g.id,g.type)}const y=g.actions.map(w=>({id:g.id,action:w}));for(let w=0;w<y.length;w++)p.length===w&&p.push([]),p[w].push(y[w])}return p},l);return Am.InputProcessor=s,Am}var $m={},hr={},u0={},w2;function Nee(){if(w2)return u0;w2=1,Object.defineProperty(u0,"__esModule",{value:!0}),u0.base64ToString=n;function n(e){return"atob"in globalThis?globalThis.atob(e):Buffer.from(e,"base64").toString("ascii")}return u0}var b2;function l0(){if(b2)return hr;b2=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.computeHeadersSize=t,hr.bidiNetworkHeadersFromCdpNetworkHeaders=r,hr.bidiNetworkHeadersFromCdpNetworkHeadersEntries=s,hr.cdpNetworkHeadersFromBidiNetworkHeaders=i,hr.bidiNetworkHeadersFromCdpFetchHeaders=a,hr.cdpFetchHeadersFromBidiNetworkHeaders=o,hr.networkHeaderFromCookieHeaders=u,hr.cdpAuthChallengeResponseFromBidiAuthContinueWithAuthAction=l,hr.cdpToBiDiCookie=d,hr.deserializeByteValue=h,hr.bidiToCdpCookie=f,hr.sameSiteBiDiToCdp=m,hr.isSpecialScheme=g,hr.matchUrlPattern=w,hr.bidiBodySizeFromCdpPostDataEntries=S,hr.getTiming=_;const n=QD(),e=Nee();function t(v){const A=v.reduce((k,C)=>`${k}${C.name}: ${C.value.value}\r
`,"");return new TextEncoder().encode(A).length}function r(v){return v?Object.entries(v).map(([A,k])=>({name:A,value:{type:"string",value:k}})):[]}function s(v){return v?v.map(({name:A,value:k})=>({name:A,value:{type:"string",value:k}})):[]}function i(v){if(v!==void 0)return v.reduce((A,k)=>(A[k.name]=k.value.value,A),{})}function a(v){return v?v.map(({name:A,value:k})=>({name:A,value:{type:"string",value:k}})):[]}function o(v){if(v!==void 0)return v.map(({name:A,value:k})=>({name:A,value:k.value}))}function u(v){return v===void 0?void 0:{name:"Cookie",value:{type:"string",value:v.reduce((k,C,E)=>{E>0&&(k+=";");const N=C.value.type==="base64"?btoa(C.value.value):C.value.value;return k+=`${C.name}=${N}`,k},"")}}}function l(v){switch(v){case"default":return"Default";case"cancel":return"CancelAuth";case"provideCredentials":return"ProvideCredentials"}}function d(v){const A={name:v.name,value:{type:"string",value:v.value},domain:v.domain,path:v.path,size:v.size,httpOnly:v.httpOnly,secure:v.secure,sameSite:v.sameSite===void 0?"none":p(v.sameSite),...v.expires>=0?{expiry:v.expires}:void 0};return A["goog:session"]=v.session,A["goog:priority"]=v.priority,A["goog:sameParty"]=v.sameParty,A["goog:sourceScheme"]=v.sourceScheme,A["goog:sourcePort"]=v.sourcePort,v.partitionKey!==void 0&&(A["goog:partitionKey"]=v.partitionKey),v.partitionKeyOpaque!==void 0&&(A["goog:partitionKeyOpaque"]=v.partitionKeyOpaque),A}function h(v){return v.type==="base64"?(0,e.base64ToString)(v.value):v.value}function f(v,A){const k=h(v.cookie.value),C={name:v.cookie.name,value:k,domain:v.cookie.domain,path:v.cookie.path??"/",secure:v.cookie.secure??!1,httpOnly:v.cookie.httpOnly??!1,...A.sourceOrigin!==void 0&&{partitionKey:{hasCrossSiteAncestor:!1,topLevelSite:A.sourceOrigin}},...v.cookie.expiry!==void 0&&{expires:v.cookie.expiry},...v.cookie.sameSite!==void 0&&{sameSite:m(v.cookie.sameSite)}};return v.cookie["goog:url"]!==void 0&&(C.url=v.cookie["goog:url"]),v.cookie["goog:priority"]!==void 0&&(C.priority=v.cookie["goog:priority"]),v.cookie["goog:sameParty"]!==void 0&&(C.sameParty=v.cookie["goog:sameParty"]),v.cookie["goog:sourceScheme"]!==void 0&&(C.sourceScheme=v.cookie["goog:sourceScheme"]),v.cookie["goog:sourcePort"]!==void 0&&(C.sourcePort=v.cookie["goog:sourcePort"]),C}function p(v){switch(v){case"Strict":return"strict";case"None":return"none";case"Lax":return"lax";default:return"lax"}}function m(v){switch(v){case"strict":return"Strict";case"lax":return"Lax";case"none":return"None"}throw new n.InvalidArgumentException(`Unknown 'sameSite' value ${v}`)}function g(v){return["ftp","file","http","https","ws","wss"].includes(v.replace(/:$/,""))}function y(v){return v.protocol.replace(/:$/,"")}function w(v,A){const k=new URL(A);return!(v.protocol!==void 0&&v.protocol!==y(k)||v.hostname!==void 0&&v.hostname!==k.hostname||v.port!==void 0&&v.port!==k.port||v.pathname!==void 0&&v.pathname!==k.pathname||v.search!==void 0&&v.search!==k.search)}function S(v){let A=0;for(const k of v)A+=atob(k.bytes??"").length;return A}function _(v,A=0){return!v||v<=0||v+A<=0?0:v+A}return hr}var _2;function v2(){var s,i,a,VT,Xw,l;if(_2)return $m;_2=1,Object.defineProperty($m,"__esModule",{value:!0}),$m.NetworkProcessor=void 0;const n=Nt(),e=l0();let t=(l=class{constructor(h,f){b(this,a);b(this,s);b(this,i);x(this,s,h),x(this,i,f)}async addIntercept(h){c(this,s).verifyTopLevelContextsList(h.contexts);const f=h.urlPatterns??[],p=l.parseUrlPatterns(f),m=c(this,i).addIntercept({urlPatterns:p,phases:h.phases,contexts:h.contexts});return await Promise.all(c(this,s).getAllContexts().map(g=>g.cdpTarget.toggleNetwork())),{intercept:m}}async continueRequest(h){if(h.url!==void 0&&l.parseUrlString(h.url),h.method!==void 0&&!l.isMethodValid(h.method))throw new n.InvalidArgumentException(`Method '${h.method}' is invalid.`);h.headers&&l.validateHeaders(h.headers);const f=P(this,a,Xw).call(this,h.request,["beforeRequestSent"]);try{await f.continueRequest(h)}catch(p){throw l.wrapInterceptionError(p)}return{}}async continueResponse(h){h.headers&&l.validateHeaders(h.headers);const f=P(this,a,Xw).call(this,h.request,["authRequired","responseStarted"]);try{await f.continueResponse(h)}catch(p){throw l.wrapInterceptionError(p)}return{}}async continueWithAuth(h){const f=h.request;return await P(this,a,Xw).call(this,f,["authRequired"]).continueWithAuth(h),{}}async failRequest({request:h}){const f=P(this,a,VT).call(this,h);if(f.interceptPhase==="authRequired")throw new n.InvalidArgumentException(`Request '${h}' in 'authRequired' phase cannot be failed`);if(!f.interceptPhase)throw new n.NoSuchRequestException(`No blocked request found for network id '${h}'`);return await f.failRequest("Failed"),{}}async provideResponse(h){h.headers&&l.validateHeaders(h.headers);const f=P(this,a,Xw).call(this,h.request,["beforeRequestSent","responseStarted","authRequired"]);try{await f.provideResponse(h)}catch(p){throw l.wrapInterceptionError(p)}return{}}async removeIntercept(h){return c(this,i).removeIntercept(h.intercept),await Promise.all(c(this,s).getAllContexts().map(f=>f.cdpTarget.toggleNetwork())),{}}async setCacheBehavior(h){const f=c(this,s).verifyTopLevelContextsList(h.contexts);if(f.size===0)return c(this,i).defaultCacheBehavior=h.cacheBehavior,await Promise.all(c(this,s).getAllContexts().map(m=>m.cdpTarget.toggleSetCacheDisabled())),{};const p=h.cacheBehavior==="bypass";return await Promise.all([...f.values()].map(m=>m.cdpTarget.toggleSetCacheDisabled(p))),{}}static validateHeaders(h){for(const f of h){let p;if(f.value.type==="string"?p=f.value.value:p=atob(f.value.value),p!==p.trim()||p.includes(`
`)||p.includes("\0"))throw new n.InvalidArgumentException(`Header value '${p}' is not acceptable value`)}}static isMethodValid(h){return/^[!#$%&'*+\-.^_`|~a-zA-Z\d]+$/.test(h)}static parseUrlString(h){try{return new URL(h)}catch(f){throw new n.InvalidArgumentException(`Invalid URL '${h}': ${f}`)}}static parseUrlPatterns(h){return h.map(f=>{let p="",m=!0,g=!0,y=!0,w=!0,S=!0;switch(f.type){case"string":{p=r(f.pattern);break}case"pattern":{if(f.protocol===void 0)m=!1,p+="http";else{if(f.protocol==="")throw new n.InvalidArgumentException("URL pattern must specify a protocol");if(f.protocol=r(f.protocol),!f.protocol.match(/^[a-zA-Z+-.]+$/))throw new n.InvalidArgumentException("Forbidden characters");p+=f.protocol}const v=p.toLocaleLowerCase();if(p+=":",(0,e.isSpecialScheme)(v)&&(p+="//"),f.hostname===void 0)v!=="file"&&(p+="placeholder"),g=!1;else{if(f.hostname==="")throw new n.InvalidArgumentException("URL pattern must specify a hostname");if(f.protocol==="file")throw new n.InvalidArgumentException("URL pattern protocol cannot be 'file'");f.hostname=r(f.hostname);let A=!1;for(const k of f.hostname){if(k==="/"||k==="?"||k==="#")throw new n.InvalidArgumentException("'/', '?', '#' are forbidden in hostname");if(!A&&k===":")throw new n.InvalidArgumentException("':' is only allowed inside brackets in hostname");k==="["&&(A=!0),k==="]"&&(A=!1)}p+=f.hostname}if(f.port===void 0)y=!1;else{if(f.port==="")throw new n.InvalidArgumentException("URL pattern must specify a port");if(f.port=r(f.port),p+=":",!f.port.match(/^\d+$/))throw new n.InvalidArgumentException("Forbidden characters");p+=f.port}if(f.pathname===void 0)w=!1;else{if(f.pathname=r(f.pathname),f.pathname[0]!=="/"&&(p+="/"),f.pathname.includes("#")||f.pathname.includes("?"))throw new n.InvalidArgumentException("Forbidden characters");p+=f.pathname}if(f.search===void 0)S=!1;else{if(f.search=r(f.search),f.search[0]!=="?"&&(p+="?"),f.search.includes("#"))throw new n.InvalidArgumentException("Forbidden characters");p+=f.search}break}}const _=v=>{const A={"ftp:":21,"file:":null,"http:":80,"https:":443,"ws:":80,"wss:":443};if((0,e.isSpecialScheme)(v.protocol)&&A[v.protocol]!==null&&(!v.port||String(A[v.protocol])===v.port))return"";if(v.port)return v.port};try{const v=new URL(p);return{protocol:m?v.protocol.replace(/:$/,""):void 0,hostname:g?v.hostname:void 0,port:y?_(v):void 0,pathname:w&&v.pathname?v.pathname:void 0,search:S?v.search:void 0}}catch(v){throw new n.InvalidArgumentException(`${v.message} '${p}'`)}})}static wrapInterceptionError(h){return h!=null&&h.message.includes("Invalid header")?new n.InvalidArgumentException("Invalid header"):h}},s=new WeakMap,i=new WeakMap,a=new WeakSet,VT=function(h){const f=c(this,i).getRequestById(h);if(!f)throw new n.NoSuchRequestException(`Network request with ID '${h}' doesn't exist`);return f},Xw=function(h,f){const p=P(this,a,VT).call(this,h);if(!p.interceptPhase)throw new n.NoSuchRequestException(`No blocked request found for network id '${h}'`);if(p.interceptPhase&&!f.includes(p.interceptPhase))throw new n.InvalidArgumentException(`Blocked request for network id '${h}' is in '${p.interceptPhase}' phase`);return p},l);$m.NetworkProcessor=t;function r(d){const h=new Set(["(",")","*","{","}"]);let f="",p=!1;for(const m of d){if(!p){if(h.has(m))throw new n.InvalidArgumentException("Forbidden characters");if(m==="\\"){p=!0;continue}}f+=m,p=!1}return f}return $m}var jm={},S2;function $ee(){var t,r;if(S2)return jm;S2=1,Object.defineProperty(jm,"__esModule",{value:!0}),jm.PermissionsProcessor=void 0;const n=Nt();let e=(r=class{constructor(i){b(this,t);x(this,t,i)}async setPermissions(i){try{const a=i["goog:userContext"]||i.userContext;await c(this,t).sendCommand("Browser.setPermission",{origin:i.origin,browserContextId:a&&a!=="default"?a:void 0,permission:{name:i.descriptor.name},setting:i.state})}catch(a){if(a.message==="Permission can't be granted to opaque origins.")return{};throw new n.InvalidArgumentException(a.message)}return{}}},t=new WeakMap,r);return jm.PermissionsProcessor=e,jm}var Lm={},Fm={},d0={};const jee=tt(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var x2;function kd(){if(x2)return d0;x2=1,Object.defineProperty(d0,"__esModule",{value:!0}),d0.uuidv4=e;function n(t){return t.reduce((r,s)=>r+s.toString(16).padStart(2,"0"),"")}function e(){if("crypto"in globalThis&&"randomUUID"in globalThis.crypto)return globalThis.crypto.randomUUID();const t=new Uint8Array(16);return"crypto"in globalThis&&"getRandomValues"in globalThis.crypto?globalThis.crypto.getRandomValues(t):jee.webcrypto.getRandomValues(t),t[6]=t[6]&15|64,t[8]=t[8]&63|128,[n(t.subarray(0,4)),n(t.subarray(4,6)),n(t.subarray(6,8)),n(t.subarray(8,10)),n(t.subarray(10,16))].join("-")}return d0}var Dm={},E2;function k2(){var s,i,a,o,u,GT,I3,O3,f,ZT,R3;if(E2)return Dm;E2=1,Object.defineProperty(Dm,"__esModule",{value:!0}),Dm.ChannelProxy=void 0;const n=Nt(),e=hs(),t=kd();let r=(u=class{constructor(y,w){b(this,f);b(this,s);b(this,i,(0,t.uuidv4)());b(this,a);x(this,s,y),x(this,a,w)}async init(y,w){var v,A;const S=await P(v=u,o,I3).call(v,y),_=await P(A=u,o,O3).call(A,y,S);return P(this,f,ZT).call(this,y,S,w),_}async startListenerFromWindow(y,w){var S;try{const _=await P(this,f,R3).call(this,y);P(this,f,ZT).call(this,y,_,w)}catch(_){(S=c(this,a))==null||S.call(this,e.LogType.debugError,_)}}getEvalInWindowStr(){var S;const y=String((_,v)=>{const A=window;return A[_]===void 0?A[_]=v:(A[_](v),delete A[_]),v.sendMessage}),w=P(S=u,o,GT).call(S);return`(${y})('${c(this,i)}',${w})`}},s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakSet,GT=function(){return`(${String(()=>{const w=[];let S=null;return{async getMessage(){return await(w.length>0?Promise.resolve():new Promise(v=>{S=v})),w.shift()},sendMessage(_){w.push(_),S!==null&&(S(),S=null)}}})})()`},I3=async function(y){const w=await y.cdpClient.sendCommand("Runtime.evaluate",{expression:P(this,o,GT).call(this),contextId:y.executionContextId,serializationOptions:{serialization:"idOnly"}});if(w.exceptionDetails||w.result.objectId===void 0)throw new Error("Cannot create channel");return w.result.objectId},O3=async function(y,w){return(await y.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(_=>_.sendMessage),arguments:[{objectId:w}],executionContextId:y.executionContextId,serializationOptions:{serialization:"idOnly"}})).result.objectId},f=new WeakSet,ZT=async function(y,w,S){var _,v;for(;;)try{const A=await y.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(async k=>await k.getMessage()),arguments:[{objectId:w}],awaitPromise:!0,executionContextId:y.executionContextId,serializationOptions:{serialization:"deep",maxDepth:((_=c(this,s).serializationOptions)==null?void 0:_.maxObjectDepth)??void 0}});if(A.exceptionDetails)throw new Error("Runtime.callFunctionOn in ChannelProxy",{cause:A.exceptionDetails});for(const k of y.associatedBrowsingContexts)S.registerEvent({type:"event",method:n.ChromiumBidi.Script.EventNames.Message,params:{channel:c(this,s).channel,data:y.cdpToBidiValue(A,c(this,s).ownership??"none"),source:y.source}},k.id)}catch(A){(v=c(this,a))==null||v.call(this,e.LogType.debugError,A);break}},R3=async function(y){const w=await y.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(S=>{const _=window;if(_[S]===void 0)return new Promise(A=>_[S]=A);const v=_[S];return delete _[S],v}),arguments:[{value:c(this,i)}],executionContextId:y.executionContextId,awaitPromise:!0,serializationOptions:{serialization:"idOnly"}});if(w.exceptionDetails!==void 0||w.result.objectId===void 0)throw new Error(`ChannelHandle not found in window["${c(this,i)}"]`);return w.result.objectId},b(u,o),u);return Dm.ChannelProxy=r,Dm}var C2;function Lee(){var r,s,i,a,o,u,l,d,M3,f;if(C2)return Fm;C2=1,Object.defineProperty(Fm,"__esModule",{value:!0}),Fm.PreloadScript=void 0;const n=kd(),e=k2();let t=(f=class{constructor(m,g){b(this,d);b(this,r,(0,n.uuidv4)());b(this,s,[]);b(this,i);b(this,a,new Set);b(this,o);b(this,u);b(this,l);var y;x(this,o,((y=m.arguments)==null?void 0:y.map(w=>new e.ChannelProxy(w.value,g)))??[]),x(this,i,m.functionDeclaration),x(this,u,m.sandbox),x(this,l,m.contexts)}get id(){return c(this,r)}get targetIds(){return c(this,a)}get channels(){return c(this,o)}get contexts(){return c(this,l)}async initInTargets(m,g){await Promise.all(Array.from(m).map(y=>this.initInTarget(y,g)))}async initInTarget(m,g){const y=await m.cdpClient.sendCommand("Page.addScriptToEvaluateOnNewDocument",{source:P(this,d,M3).call(this),worldName:c(this,u),runImmediately:g});c(this,s).push({target:m,preloadScriptId:y.identifier}),c(this,a).add(m.id)}async remove(){await Promise.all([c(this,s).map(async m=>{const g=m.target,y=m.preloadScriptId;return await g.cdpClient.sendCommand("Page.removeScriptToEvaluateOnNewDocument",{identifier:y})})])}dispose(m){x(this,s,c(this,s).filter(g=>{var y;return((y=g.target)==null?void 0:y.id)!==m})),c(this,a).delete(m)}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakSet,M3=function(){const m=`[${this.channels.map(g=>g.getEvalInWindowStr()).join(", ")}]`;return`(()=>{(${c(this,i)})(...${m})})()`},f);return Fm.PreloadScript=t,Fm}var P2;function Fee(){var r,s,i,a,o,u,N3,Q0,h;if(P2)return Lm;P2=1,Object.defineProperty(Lm,"__esModule",{value:!0}),Lm.ScriptProcessor=void 0;const n=Nt(),e=Lee();let t=(h=class{constructor(p,m,g,y,w){b(this,u);b(this,r);b(this,s);b(this,i);b(this,a);b(this,o);x(this,s,m),x(this,i,g),x(this,a,y),x(this,o,w),x(this,r,p),c(this,r).addSubscribeHook(n.ChromiumBidi.Script.EventNames.RealmCreated,P(this,u,N3).bind(this))}async addPreloadScript(p){const m=c(this,s).verifyTopLevelContextsList(p.contexts),g=new e.PreloadScript(p,c(this,o));c(this,a).add(g);const y=m.size===0?new Set(c(this,s).getTopLevelContexts().map(w=>w.cdpTarget)):new Set([...m.values()].map(w=>w.cdpTarget));return await g.initInTargets(y,!1),{script:g.id}}async removePreloadScript(p){const{script:m}=p,g=c(this,a).find({id:m});if(g.length===0)throw new n.NoSuchScriptException(`No preload script with id '${m}'`);return await Promise.all(g.map(y=>y.remove())),c(this,a).remove({id:m}),{}}async callFunction(p){return await(await P(this,u,Q0).call(this,p.target)).callFunction(p.functionDeclaration,p.awaitPromise,p.this,p.arguments,p.resultOwnership,p.serializationOptions,p.userActivation)}async evaluate(p){return await(await P(this,u,Q0).call(this,p.target)).evaluate(p.expression,p.awaitPromise,p.resultOwnership,p.serializationOptions,p.userActivation)}async disown(p){const m=await P(this,u,Q0).call(this,p.target);return await Promise.all(p.handles.map(async g=>await m.disown(g))),{}}getRealms(p){return p.context!==void 0&&c(this,s).getContext(p.context),{realms:c(this,i).findRealms({browsingContextId:p.context,type:p.type}).map(g=>g.realmInfo)}}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakSet,N3=function(p){const m=c(this,s).getContext(p),g=[m,...c(this,s).getContext(p).allChildren],y=new Set;for(const w of g){const S=c(this,i).findRealms({browsingContextId:w.id});for(const _ of S)y.add(_)}for(const w of y)c(this,r).registerEvent({type:"event",method:n.ChromiumBidi.Script.EventNames.RealmCreated,params:w.realmInfo},m.id);return Promise.resolve()},Q0=async function(p){return"context"in p?await c(this,s).getContext(p.context).getOrCreateSandbox(p.sandbox):c(this,i).getRealm({realmId:p.realm})},h);return Lm.ScriptProcessor=t,Lm}var Bm={},A2;function Dee(){var t,r,s,i,a,$3,j3,l;if(A2)return Bm;A2=1,Object.defineProperty(Bm,"__esModule",{value:!0}),Bm.SessionProcessor=void 0;const n=Nt();let e=(l=class{constructor(h,f,p){b(this,a);b(this,t);b(this,r);b(this,s);b(this,i,!1);x(this,t,h),x(this,r,f),x(this,s,p)}status(){return{ready:!1,message:"already connected"}}async new(h){if(c(this,i))throw new Error("Session has been already created.");x(this,i,!0);const f=P(this,a,$3).call(this,h.capabilities);await c(this,s).call(this,f);const p=await c(this,r).sendCommand("Browser.getVersion");return{sessionId:"unknown",capabilities:{...f,acceptInsecureCerts:f.acceptInsecureCerts??!1,browserName:p.product,browserVersion:p.revision,platformName:"",setWindowRect:!1,webSocketUrl:"",userAgent:p.userAgent}}}async subscribe(h,f={}){return{subscription:await c(this,t).subscribe(h.events,h.contexts??[],f)}}async unsubscribe(h,f={}){return await c(this,t).unsubscribe(h.events,h.contexts??[],f),{}}},t=new WeakMap,r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakSet,$3=function(h){const f=[];for(const m of h.firstMatch??[{}]){const g={...h.alwaysMatch};for(const y of Object.keys(m)){if(g[y]!==void 0)throw new n.InvalidArgumentException(`Capability ${y} in firstMatch is already defined in alwaysMatch`);g[y]=m[y]}f.push(g)}const p=f.find(m=>m.browserName==="chrome")??f[0]??{};return p.unhandledPromptBehavior=P(this,a,j3).call(this,p.unhandledPromptBehavior),p},j3=function(h){if(h!==void 0){if(typeof h=="object")return h;if(typeof h!="string")throw new n.InvalidArgumentException(`Unexpected 'unhandledPromptBehavior' type: ${typeof h}`);switch(h){case"accept":case"accept and notify":return{default:"accept"};case"dismiss":case"dismiss and notify":return{default:"dismiss"};case"ignore":return{default:"ignore"};default:throw new n.InvalidArgumentException(`Unexpected 'unhandledPromptBehavior' value: ${h}`)}}},l);return Bm.SessionProcessor=e,Bm}var Um={},T2;function Bee(){var a,o,u,l,eS,Yw,L3,F3,tS,JT,y;if(T2)return Um;T2=1,Object.defineProperty(Um,"__esModule",{value:!0}),Um.StorageProcessor=void 0;const n=Nt(),e=Mc(),t=hs(),r=v2(),s=l0();let i=(y=class{constructor(S,_,v){b(this,l);b(this,a);b(this,o);b(this,u);x(this,o,_),x(this,a,S),x(this,u,v)}async deleteCookies(S){const _=P(this,l,tS).call(this,S.partition);let v;try{v=await c(this,a).sendCommand("Storage.getCookies",{browserContextId:P(this,l,Yw).call(this,_)})}catch(k){throw P(this,l,eS).call(this,k)?new n.NoSuchUserContextException(k.message):k}const A=v.cookies.filter(k=>{var C;return _.sourceOrigin===void 0||((C=k.partitionKey)==null?void 0:C.topLevelSite)===_.sourceOrigin}).filter(k=>{const C=(0,s.cdpToBiDiCookie)(k);return P(this,l,JT).call(this,C,S.filter)}).map(k=>({...k,expires:1}));return await c(this,a).sendCommand("Storage.setCookies",{cookies:A,browserContextId:P(this,l,Yw).call(this,_)}),{partitionKey:_}}async getCookies(S){const _=P(this,l,tS).call(this,S.partition);let v;try{v=await c(this,a).sendCommand("Storage.getCookies",{browserContextId:P(this,l,Yw).call(this,_)})}catch(k){throw P(this,l,eS).call(this,k)?new n.NoSuchUserContextException(k.message):k}return{cookies:v.cookies.filter(k=>{var C;return _.sourceOrigin===void 0||((C=k.partitionKey)==null?void 0:C.topLevelSite)===_.sourceOrigin}).map(k=>(0,s.cdpToBiDiCookie)(k)).filter(k=>P(this,l,JT).call(this,k,S.filter)),partitionKey:_}}async setCookie(S){var A;const _=P(this,l,tS).call(this,S.partition),v=(0,s.bidiToCdpCookie)(S,_);try{await c(this,a).sendCommand("Storage.setCookies",{cookies:[v],browserContextId:P(this,l,Yw).call(this,_)})}catch(k){throw P(this,l,eS).call(this,k)?new n.NoSuchUserContextException(k.message):((A=c(this,u))==null||A.call(this,t.LogType.debugError,k),new n.UnableToSetCookieException(k.toString()))}return{partitionKey:_}}},a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakSet,eS=function(S){var _;return(_=S.message)==null?void 0:_.startsWith("Failed to find browser context for id")},Yw=function(S){return S.userContext==="default"?void 0:S.userContext},L3=function(S){const _=S.context;return{userContext:c(this,o).getContext(_).userContext}},F3=function(S){var k;const _=new Map;let v=S.sourceOrigin;if(v!==void 0){const C=r.NetworkProcessor.parseUrlString(v);C.origin==="null"?v=C.origin:v=`${C.protocol}//${C.hostname}`}for(const[C,E]of Object.entries(S))C!==void 0&&E!==void 0&&!["type","sourceOrigin","userContext"].includes(C)&&_.set(C,E);return _.size>0&&((k=c(this,u))==null||k.call(this,t.LogType.debugInfo,`Unsupported partition keys: ${JSON.stringify(Object.fromEntries(_))}`)),{userContext:S.userContext??"default",...v===void 0?{}:{sourceOrigin:v}}},tS=function(S){return S===void 0?{userContext:"default"}:S.type==="context"?P(this,l,L3).call(this,S):((0,e.assert)(S.type==="storageKey","Unknown partition type"),P(this,l,F3).call(this,S))},JT=function(S,_){return _===void 0?!0:(_.domain===void 0||_.domain===S.domain)&&(_.name===void 0||_.name===S.name)&&(_.value===void 0||(0,s.deserializeByteValue)(_.value)===(0,s.deserializeByteValue)(S.value))&&(_.path===void 0||_.path===S.path)&&(_.size===void 0||_.size===S.size)&&(_.httpOnly===void 0||_.httpOnly===S.httpOnly)&&(_.secure===void 0||_.secure===S.secure)&&(_.sameSite===void 0||_.sameSite===S.sameSite)&&(_.expiry===void 0||_.expiry===S.expiry)},y);return Um.StorageProcessor=i,Um}var qm={},I2;function nA(){var e,t,r;if(I2)return qm;I2=1,Object.defineProperty(qm,"__esModule",{value:!0}),qm.OutgoingMessage=void 0;let n=(r=class{constructor(i,a){b(this,e);b(this,t);x(this,e,i),x(this,t,a)}static createFromPromise(i,a){return i.then(o=>o.kind==="success"?{kind:"success",value:new r(o.value,a)}:o)}static createResolved(i,a){return Promise.resolve({kind:"success",value:new r(i,a)})}get message(){return c(this,e)}get channel(){return c(this,t)}},e=new WeakMap,t=new WeakMap,r);return qm.OutgoingMessage=n,qm}var O2;function Uee(){var g,y,w,S,_,v,A,k,C,E,N,I,$,D3,rS,L;if(O2)return xm;O2=1,Object.defineProperty(xm,"__esModule",{value:!0}),xm.CommandProcessor=void 0;const n=Nt(),e=xd(),t=hs(),r=See(),s=xee(),i=Eee(),a=kee(),o=Mee(),u=v2(),l=$ee(),d=Fee(),h=Dee(),f=Bee(),p=nA();let m=(L=class extends e.EventEmitter{constructor(F,j,B,D,z,G,te,V,K=new r.BidiNoOpParser,ae,ve){super();b(this,$);b(this,g);b(this,y);b(this,w);b(this,S);b(this,_);b(this,v);b(this,A);b(this,k);b(this,C);b(this,E);b(this,N);b(this,I);x(this,N,K),x(this,I,ve),x(this,g,V),x(this,y,new s.BrowserProcessor(j,D)),x(this,w,new a.BrowsingContextProcessor(j,D,B)),x(this,S,new i.CdpProcessor(D,z,F,j)),x(this,_,new o.InputProcessor(D)),x(this,v,new u.NetworkProcessor(D,te)),x(this,A,new l.PermissionsProcessor(j)),x(this,k,new d.ScriptProcessor(B,D,z,G,ve)),x(this,C,new h.SessionProcessor(B,j,ae)),x(this,E,new f.StorageProcessor(j,D,ve))}async processCommand(F){var j;try{const B=await P(this,$,D3).call(this,F),D={type:"success",id:F.id,result:B};this.emit("response",{message:p.OutgoingMessage.createResolved(D,F.channel),event:F.method})}catch(B){if(B instanceof n.Exception)this.emit("response",{message:p.OutgoingMessage.createResolved(B.toErrorResponse(F.id),F.channel),event:F.method});else{const D=B;(j=c(this,I))==null||j.call(this,t.LogType.bidi,D),this.emit("response",{message:p.OutgoingMessage.createResolved(new n.UnknownErrorException(D.message,D.stack).toErrorResponse(F.id),F.channel),event:F.method})}}}},g=new WeakMap,y=new WeakMap,w=new WeakMap,S=new WeakMap,_=new WeakMap,v=new WeakMap,A=new WeakMap,k=new WeakMap,C=new WeakMap,E=new WeakMap,N=new WeakMap,I=new WeakMap,$=new WeakSet,D3=async function(F){switch(F.method){case"bluetooth.handleRequestDevicePrompt":return await c(this,g).handleRequestDevicePrompt(c(this,N).parseHandleRequestDevicePromptParams(F.params));case"bluetooth.simulateAdapter":return await c(this,g).simulateAdapter(c(this,N).parseSimulateAdapterParameters(F.params));case"bluetooth.simulateAdvertisement":return await c(this,g).simulateAdvertisement(c(this,N).parseSimulateAdvertisementParameters(F.params));case"bluetooth.simulatePreconnectedPeripheral":return await c(this,g).simulatePreconnectedPeripheral(c(this,N).parseSimulatePreconnectedPeripheralParameters(F.params));case"browser.close":return c(this,y).close();case"browser.createUserContext":return await c(this,y).createUserContext(F.params);case"browser.getClientWindows":return await c(this,y).getClientWindows();case"browser.getUserContexts":return await c(this,y).getUserContexts();case"browser.removeUserContext":return await c(this,y).removeUserContext(c(this,N).parseRemoveUserContextParams(F.params));case"browser.setClientWindowState":throw new n.UnknownErrorException(`Method ${F.method} is not implemented.`);case"browsingContext.activate":return await c(this,w).activate(c(this,N).parseActivateParams(F.params));case"browsingContext.captureScreenshot":return await c(this,w).captureScreenshot(c(this,N).parseCaptureScreenshotParams(F.params));case"browsingContext.close":return await c(this,w).close(c(this,N).parseCloseParams(F.params));case"browsingContext.create":return await c(this,w).create(c(this,N).parseCreateParams(F.params));case"browsingContext.getTree":return c(this,w).getTree(c(this,N).parseGetTreeParams(F.params));case"browsingContext.handleUserPrompt":return await c(this,w).handleUserPrompt(c(this,N).parseHandleUserPromptParams(F.params));case"browsingContext.locateNodes":return await c(this,w).locateNodes(c(this,N).parseLocateNodesParams(F.params));case"browsingContext.navigate":return await c(this,w).navigate(c(this,N).parseNavigateParams(F.params));case"browsingContext.print":return await c(this,w).print(c(this,N).parsePrintParams(F.params));case"browsingContext.reload":return await c(this,w).reload(c(this,N).parseReloadParams(F.params));case"browsingContext.setViewport":return await c(this,w).setViewport(c(this,N).parseSetViewportParams(F.params));case"browsingContext.traverseHistory":return await c(this,w).traverseHistory(c(this,N).parseTraverseHistoryParams(F.params));case"goog:cdp.getSession":return c(this,S).getSession(c(this,N).parseGetSessionParams(F.params));case"goog:cdp.resolveRealm":return c(this,S).resolveRealm(c(this,N).parseResolveRealmParams(F.params));case"goog:cdp.sendCommand":return await c(this,S).sendCommand(c(this,N).parseSendCommandParams(F.params));case"cdp.getSession":return c(this,S).getSession(c(this,N).parseGetSessionParams(F.params));case"cdp.resolveRealm":return c(this,S).resolveRealm(c(this,N).parseResolveRealmParams(F.params));case"cdp.sendCommand":return await c(this,S).sendCommand(c(this,N).parseSendCommandParams(F.params));case"input.performActions":return await c(this,_).performActions(c(this,N).parsePerformActionsParams(F.params));case"input.releaseActions":return await c(this,_).releaseActions(c(this,N).parseReleaseActionsParams(F.params));case"input.setFiles":return await c(this,_).setFiles(c(this,N).parseSetFilesParams(F.params));case"network.addIntercept":return await c(this,v).addIntercept(c(this,N).parseAddInterceptParams(F.params));case"network.continueRequest":return await c(this,v).continueRequest(c(this,N).parseContinueRequestParams(F.params));case"network.continueResponse":return await c(this,v).continueResponse(c(this,N).parseContinueResponseParams(F.params));case"network.continueWithAuth":return await c(this,v).continueWithAuth(c(this,N).parseContinueWithAuthParams(F.params));case"network.failRequest":return await c(this,v).failRequest(c(this,N).parseFailRequestParams(F.params));case"network.provideResponse":return await c(this,v).provideResponse(c(this,N).parseProvideResponseParams(F.params));case"network.removeIntercept":return await c(this,v).removeIntercept(c(this,N).parseRemoveInterceptParams(F.params));case"network.setCacheBehavior":return await c(this,v).setCacheBehavior(c(this,N).parseSetCacheBehavior(F.params));case"permissions.setPermission":return await c(this,A).setPermissions(c(this,N).parseSetPermissionsParams(F.params));case"script.addPreloadScript":return await c(this,k).addPreloadScript(c(this,N).parseAddPreloadScriptParams(F.params));case"script.callFunction":return await c(this,k).callFunction(c(this,N).parseCallFunctionParams(P(this,$,rS).call(this,F.params)));case"script.disown":return await c(this,k).disown(c(this,N).parseDisownParams(P(this,$,rS).call(this,F.params)));case"script.evaluate":return await c(this,k).evaluate(c(this,N).parseEvaluateParams(P(this,$,rS).call(this,F.params)));case"script.getRealms":return c(this,k).getRealms(c(this,N).parseGetRealmsParams(F.params));case"script.removePreloadScript":return await c(this,k).removePreloadScript(c(this,N).parseRemovePreloadScriptParams(F.params));case"session.end":throw new n.UnknownErrorException(`Method ${F.method} is not implemented.`);case"session.new":return await c(this,C).new(F.params);case"session.status":return c(this,C).status();case"session.subscribe":return await c(this,C).subscribe(c(this,N).parseSubscribeParams(F.params),F.channel);case"session.unsubscribe":return await c(this,C).unsubscribe(c(this,N).parseSubscribeParams(F.params),F.channel);case"storage.deleteCookies":return await c(this,E).deleteCookies(c(this,N).parseDeleteCookiesParams(F.params));case"storage.getCookies":return await c(this,E).getCookies(c(this,N).parseGetCookiesParams(F.params));case"storage.setCookie":return await c(this,E).setCookie(c(this,N).parseSetCookieParams(F.params));case"webExtension.install":throw new n.UnknownErrorException(`Method ${F.method} is not implemented.`);case"webExtension.uninstall":throw new n.UnknownErrorException(`Method ${F.method} is not implemented.`)}throw new n.UnknownCommandException(`Unknown command '${F==null?void 0:F.method}'.`)},rS=function(F){return typeof F=="object"&&F&&"target"in F&&typeof F.target=="object"&&F.target&&"context"in F.target&&delete F.target.realm,F},L);return xm.CommandProcessor=m,xm}var Km={},R2;function qee(){var e,t,r;if(R2)return Km;R2=1,Object.defineProperty(Km,"__esModule",{value:!0}),Km.BluetoothProcessor=void 0;let n=(r=class{constructor(i,a){b(this,e);b(this,t);x(this,e,i),x(this,t,a)}async simulateAdapter(i){const a=c(this,t).getContext(i.context);return await a.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.disable"),await a.cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.enable",{state:i.state}),{}}async simulatePreconnectedPeripheral(i){return await c(this,t).getContext(i.context).cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.simulatePreconnectedPeripheral",{address:i.address,name:i.name,knownServiceUuids:i.knownServiceUuids,manufacturerData:i.manufacturerData}),{}}async simulateAdvertisement(i){return await c(this,t).getContext(i.context).cdpTarget.browserCdpClient.sendCommand("BluetoothEmulation.simulateAdvertisement",{entry:i.scanEntry}),{}}onCdpTargetCreated(i){i.cdpClient.on("DeviceAccess.deviceRequestPrompted",a=>{c(this,e).registerEvent({type:"event",method:"bluetooth.requestDevicePromptUpdated",params:{context:i.id,prompt:a.id,devices:a.devices}},i.id)})}async handleRequestDevicePrompt(i){const a=c(this,t).getContext(i.context);return i.accept?await a.cdpTarget.cdpClient.sendCommand("DeviceAccess.selectPrompt",{id:i.prompt,deviceId:i.device}):await a.cdpTarget.cdpClient.sendCommand("DeviceAccess.cancelPrompt",{id:i.prompt}),{}}},e=new WeakMap,t=new WeakMap,r);return Km.BluetoothProcessor=n,Km}var Hm={},Cd={},Wm={},M2;function h0(){var e,t,r,s,i,a,o;if(M2)return Wm;M2=1,Object.defineProperty(Wm,"__esModule",{value:!0}),Wm.Deferred=void 0;let n=(e=Symbol.toStringTag,o=class{constructor(){b(this,t,!1);b(this,r);b(this,s);b(this,i);b(this,a);Z(this,e,"Promise");x(this,r,new Promise((l,d)=>{x(this,i,l),x(this,a,d)})),c(this,r).catch(l=>{})}get isFinished(){return c(this,t)}get result(){if(!c(this,t))throw new Error("Deferred is not finished yet");return c(this,s)}then(l,d){return c(this,r).then(l,d)}catch(l){return c(this,r).catch(l)}resolve(l){x(this,s,l),c(this,t)||(x(this,t,!0),c(this,i).call(this,l))}reject(l){c(this,t)||(x(this,t,!0),c(this,a).call(this,l))}finally(l){return c(this,r).finally(l)}},t=new WeakMap,r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,o);return Wm.Deferred=n,Wm}var f0={},N2;function $2(){if(N2)return f0;N2=1,Object.defineProperty(f0,"__esModule",{value:!0}),f0.getTimestamp=n;function n(){return new Date().getTime()}return f0}var p0={},j2;function Kee(){if(j2)return p0;j2=1,Object.defineProperty(p0,"__esModule",{value:!0}),p0.inchesFromCm=n;function n(e){return e/2.54}return p0}var zm={},Vm={},L2;function F2(){var i,a,o,u,l,d,h,f,XT,m,B3,YT,QT,U3,e1,t1,q3,K3,r1;if(L2)return Vm;L2=1,Object.defineProperty(Vm,"__esModule",{value:!0}),Vm.Realm=void 0;const n=Nt(),e=hs(),t=kd(),r=k2(),E=class E{constructor(I,$,O,T,L,U,J){b(this,f);b(this,i);b(this,a);b(this,o);b(this,u);b(this,l);b(this,d);b(this,h);x(this,i,I),x(this,a,$),x(this,o,O),x(this,u,T),x(this,l,L),x(this,d,U),x(this,h,J),c(this,h).addRealm(this)}cdpToBidiValue(I,$){const O=this.serializeForBiDi(I.result.deepSerializedValue,new Map);if(I.result.objectId){const T=I.result.objectId;$==="root"?(O.handle=T,c(this,h).knownHandlesToRealmMap.set(T,this.realmId)):P(this,f,r1).call(this,T).catch(L=>{var U;return(U=c(this,u))==null?void 0:U.call(this,e.LogType.debugError,L)})}return O}serializeForBiDi(I,$){if(Object.hasOwn(I,"weakLocalObjectReference")){const T=I.weakLocalObjectReference;$.has(T)||$.set(T,(0,t.uuidv4)()),I.internalId=$.get(T),delete I.weakLocalObjectReference}if(I.type==="node"&&I.value&&Object.hasOwn(I.value,"frameId")&&delete I.value.frameId,I.type==="platformobject")return{type:"object"};const O=I.value;if(O===void 0)return I;if(["array","set","htmlcollection","nodelist"].includes(I.type))for(const T in O)O[T]=this.serializeForBiDi(O[T],$);if(["object","map"].includes(I.type))for(const T in O)O[T]=[this.serializeForBiDi(O[T][0],$),this.serializeForBiDi(O[T][1],$)];return I}get realmId(){return c(this,d)}get executionContextId(){return c(this,o)}get origin(){return c(this,l)}get source(){return{realm:this.realmId}}get cdpClient(){return c(this,i)}get baseInfo(){return{realm:this.realmId,origin:this.origin}}async evaluate(I,$,O="none",T={},L=!1,U=!1){var F;const J=await this.cdpClient.sendCommand("Runtime.evaluate",{contextId:this.executionContextId,expression:I,awaitPromise:$,serializationOptions:P(F=E,m,t1).call(F,"deep",T),userGesture:L,includeCommandLineAPI:U});return J.exceptionDetails?await P(this,f,e1).call(this,J.exceptionDetails,0,O):{realm:this.realmId,result:this.cdpToBidiValue(J,O),type:"success"}}initialize(){P(this,f,XT).call(this,{type:"event",method:n.ChromiumBidi.Script.EventNames.RealmCreated,params:this.realmInfo})}async serializeCdpObject(I,$){var L;const O=P(L=E,m,B3).call(L,I),T=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(U=>U),awaitPromise:!1,arguments:[O],serializationOptions:{serialization:"deep"},executionContextId:this.executionContextId});return this.cdpToBidiValue(T,$)}async stringifyObject(I){const{result:$}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String(O=>String(O)),awaitPromise:!1,arguments:[I],returnByValue:!0,executionContextId:this.executionContextId});return $.value}async callFunction(I,$,O={type:"undefined"},T=[],L="none",U={},J=!1){var D;const F=`(...args) => {
      function callFunction(f, args) {
        const deserializedThis = args.shift();
        const deserializedArgs = args;
        return f.apply(deserializedThis, deserializedArgs);
      }
      return callFunction((
        ${I}
      ), args);
    }`,j=[await this.deserializeForCdp(O),...await Promise.all(T.map(async z=>await this.deserializeForCdp(z)))];let B;try{B=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:F,awaitPromise:$,arguments:j,serializationOptions:P(D=E,m,t1).call(D,"deep",U),executionContextId:this.executionContextId,userGesture:J})}catch(z){throw z.code===-32e3&&["Could not find object with given id","Argument should belong to the same JavaScript world as target object","Invalid remote object id"].includes(z.message)?new n.NoSuchHandleException("Handle was not found."):z}return B.exceptionDetails?await P(this,f,e1).call(this,B.exceptionDetails,1,L):{type:"success",result:this.cdpToBidiValue(B,L),realm:this.realmId}}async deserializeForCdp(I){if("handle"in I&&I.handle)return{objectId:I.handle};if("handle"in I||"sharedId"in I)throw new n.NoSuchHandleException("Handle was not found.");switch(I.type){case"undefined":return{unserializableValue:"undefined"};case"null":return{unserializableValue:"null"};case"string":return{value:I.value};case"number":return I.value==="NaN"?{unserializableValue:"NaN"}:I.value==="-0"?{unserializableValue:"-0"}:I.value==="Infinity"?{unserializableValue:"Infinity"}:I.value==="-Infinity"?{unserializableValue:"-Infinity"}:{value:I.value};case"boolean":return{value:!!I.value};case"bigint":return{unserializableValue:`BigInt(${JSON.stringify(I.value)})`};case"date":return{unserializableValue:`new Date(Date.parse(${JSON.stringify(I.value)}))`};case"regexp":return{unserializableValue:`new RegExp(${JSON.stringify(I.value.pattern)}, ${JSON.stringify(I.value.flags)})`};case"map":{const $=await P(this,f,YT).call(this,I.value),{result:O}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...T)=>{const L=new Map;for(let U=0;U<T.length;U+=2)L.set(T[U],T[U+1]);return L}),awaitPromise:!1,arguments:$,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:O.objectId}}case"object":{const $=await P(this,f,YT).call(this,I.value),{result:O}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...T)=>{const L={};for(let U=0;U<T.length;U+=2){const J=T[U];L[J]=T[U+1]}return L}),awaitPromise:!1,arguments:$,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:O.objectId}}case"array":{const $=await P(this,f,QT).call(this,I.value),{result:O}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...T)=>T),awaitPromise:!1,arguments:$,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:O.objectId}}case"set":{const $=await P(this,f,QT).call(this,I.value),{result:O}=await this.cdpClient.sendCommand("Runtime.callFunctionOn",{functionDeclaration:String((...T)=>new Set(T)),awaitPromise:!1,arguments:$,returnByValue:!1,executionContextId:this.executionContextId});return{objectId:O.objectId}}case"channel":return{objectId:await new r.ChannelProxy(I.value,c(this,u)).init(this,c(this,a))}}throw new Error(`Value ${JSON.stringify(I)} is not deserializable.`)}async disown(I){c(this,h).knownHandlesToRealmMap.get(I)===this.realmId&&(await P(this,f,r1).call(this,I),c(this,h).knownHandlesToRealmMap.delete(I))}dispose(){P(this,f,XT).call(this,{type:"event",method:n.ChromiumBidi.Script.EventNames.RealmDestroyed,params:{realm:this.realmId}})}};i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakSet,XT=function(I){if(this.associatedBrowsingContexts.length===0)c(this,a).registerGlobalEvent(I);else for(const $ of this.associatedBrowsingContexts)c(this,a).registerEvent(I,$.id)},m=new WeakSet,B3=function(I){return I.objectId!==void 0?{objectId:I.objectId}:I.unserializableValue!==void 0?{unserializableValue:I.unserializableValue}:{value:I.value}},YT=async function(I){return(await Promise.all(I.map(async([O,T])=>{let L;typeof O=="string"?L={value:O}:L=await this.deserializeForCdp(O);const U=await this.deserializeForCdp(T);return[L,U]}))).flat()},QT=async function(I){return await Promise.all(I.map($=>this.deserializeForCdp($)))},U3=async function(I,$,O){var U;const T=((U=I.stackTrace)==null?void 0:U.callFrames.map(J=>({url:J.url,functionName:J.functionName,lineNumber:J.lineNumber-$,columnNumber:J.columnNumber})))??[],L=I.exception;return{exception:await this.serializeCdpObject(L,O),columnNumber:I.columnNumber,lineNumber:I.lineNumber-$,stackTrace:{callFrames:T},text:await this.stringifyObject(L)||I.text}},e1=async function(I,$,O){return{exceptionDetails:await P(this,f,U3).call(this,I,$,O),realm:this.realmId,type:"exception"}},t1=function(I,$){var O,T;return{serialization:I,additionalParameters:P(O=E,m,q3).call(O,$),...P(T=E,m,K3).call(T,$)}},q3=function(I){const $={};return I.maxDomDepth!==void 0&&($.maxNodeDepth=I.maxDomDepth===null?1e3:I.maxDomDepth),I.includeShadowTree!==void 0&&($.includeShadowTree=I.includeShadowTree),$},K3=function(I){return I.maxObjectDepth===void 0||I.maxObjectDepth===null?{}:{maxDepth:I.maxObjectDepth}},r1=async function(I){try{await this.cdpClient.sendCommand("Runtime.releaseObject",{objectId:I})}catch($){if(!($.code===-32e3&&$.message==="Invalid remote object id"))throw $}},b(E,m);let s=E;return Vm.Realm=s,Vm}var Gm={},D2;function Hee(){if(D2)return Gm;D2=1,Object.defineProperty(Gm,"__esModule",{value:!0}),Gm.getSharedId=e,Gm.parseSharedId=r;const n="_element_";function e(s,i,a){return`f.${s}.d.${i}.e.${a}`}function t(s){const i=s.match(new RegExp(`(.*)${n}(.*)`));if(!i)return null;const a=i[1],o=i[2];if(a===void 0||o===void 0)return null;const u=parseInt(o??"");return isNaN(u)?null:{documentId:a,backendNodeId:u}}function r(s){const i=t(s);if(i!==null)return{...i,frameId:void 0};const a=s.match(/f\.(.*)\.d\.(.*)\.e\.([0-9]*)/);if(!a)return null;const o=a[1],u=a[2],l=a[3];if(o===void 0||u===void 0||l===void 0)return null;const d=parseInt(l??"");return isNaN(d)?null:{frameId:o,documentId:u,backendNodeId:d}}return Gm}var B2;function U2(){var s,i,a,H3;if(B2)return zm;B2=1,Object.defineProperty(zm,"__esModule",{value:!0}),zm.WindowRealm=void 0;const n=Nt(),e=F2(),t=Hee();class r extends e.Realm{constructor(d,h,f,p,m,g,y,w,S,_){super(f,p,m,g,y,w,S);b(this,a);b(this,s);b(this,i);Z(this,"sandbox");x(this,s,d),x(this,i,h),this.sandbox=_,this.initialize()}get browsingContext(){return c(this,i).getContext(c(this,s))}get associatedBrowsingContexts(){return[this.browsingContext]}get realmType(){return"window"}get realmInfo(){return{...this.baseInfo,type:this.realmType,context:c(this,s),sandbox:this.sandbox}}get source(){return{realm:this.realmId,context:this.browsingContext.id}}serializeForBiDi(d,h){const f=d.value;if(d.type==="node"&&f!==void 0){if(Object.hasOwn(f,"backendNodeId")){let p=this.browsingContext.navigableId??"UNKNOWN";Object.hasOwn(f,"loaderId")&&(p=f.loaderId,delete f.loaderId),d.sharedId=(0,t.getSharedId)(P(this,a,H3).call(this,p),p,f.backendNodeId),delete f.backendNodeId}if(Object.hasOwn(f,"children"))for(const p in f.children)f.children[p]=this.serializeForBiDi(f.children[p],h);Object.hasOwn(f,"shadowRoot")&&f.shadowRoot!==null&&(f.shadowRoot=this.serializeForBiDi(f.shadowRoot,h)),f.namespaceURI===""&&(f.namespaceURI=null)}return super.serializeForBiDi(d,h)}async deserializeForCdp(d){if("sharedId"in d&&d.sharedId){const h=(0,t.parseSharedId)(d.sharedId);if(h===null)throw new n.NoSuchNodeException(`SharedId "${d.sharedId}" was not found.`);const{documentId:f,backendNodeId:p}=h;if(this.browsingContext.navigableId!==f)throw new n.NoSuchNodeException(`SharedId "${d.sharedId}" belongs to different document. Current document is ${this.browsingContext.navigableId}.`);try{const{object:m}=await this.cdpClient.sendCommand("DOM.resolveNode",{backendNodeId:p,executionContextId:this.executionContextId});return{objectId:m.objectId}}catch(m){throw m.code===-32e3&&m.message==="No node with given id found"?new n.NoSuchNodeException(`SharedId "${d.sharedId}" was not found.`):new n.UnknownErrorException(m.message,m.stack)}}return await super.deserializeForCdp(d)}async evaluate(d,h,f,p,m,g){return await c(this,i).getContext(c(this,s)).targetUnblockedOrThrow(),await super.evaluate(d,h,f,p,m,g)}async callFunction(d,h,f,p,m,g,y){return await c(this,i).getContext(c(this,s)).targetUnblockedOrThrow(),await super.callFunction(d,h,f,p,m,g,y)}}return s=new WeakMap,i=new WeakMap,a=new WeakSet,H3=function(d){const h=c(this,i).getAllContexts().find(f=>f.navigableId===d);return(h==null?void 0:h.id)??"UNKNOWN"},zm.WindowRealm=r,zm}var oa={},m0={},q2;function Wee(){if(q2)return m0;q2=1,Object.defineProperty(m0,"__esModule",{value:!0}),m0.urlMatchesAboutBlank=n;function n(e){if(e==="")return!0;try{const t=new URL(e);return t.protocol.replace(/:$/,"").toLowerCase()==="about"&&t.pathname.toLowerCase()==="blank"&&t.username===""&&t.password===""&&t.host===""}catch(t){if(t instanceof TypeError)return!1;throw t}}return m0}var K2;function zee(){var l,d,h,f,p,m,g,nS,w,S,_,v,A,k,C,E,W3,I;if(K2)return oa;K2=1,Object.defineProperty(oa,"__esModule",{value:!0}),oa.NavigationTracker=oa.NavigationState=oa.NavigationResult=void 0;const n=Nt(),e=h0(),t=hs(),r=$2(),s=Wee(),i=kd();class a{constructor(O,T){Z(this,"eventName");Z(this,"message");this.eventName=O,this.message=T}}oa.NavigationResult=a;class o{constructor(O,T,L,U){b(this,g);Z(this,"navigationId",(0,i.uuidv4)());b(this,l);b(this,d,!1);b(this,h,new e.Deferred);Z(this,"url");Z(this,"loaderId");b(this,f);b(this,p);b(this,m,!1);Z(this,"isFragmentNavigation");x(this,l,T),this.url=O,x(this,f,L),x(this,p,U)}get finished(){return c(this,h)}navigationInfo(){return{context:c(this,l),navigation:this.navigationId,timestamp:(0,r.getTimestamp)(),url:this.url}}start(){!c(this,f)&&!c(this,d)&&c(this,p).registerEvent({type:"event",method:n.ChromiumBidi.BrowsingContext.EventNames.NavigationStarted,params:this.navigationInfo()},c(this,l)),x(this,d,!0)}frameNavigated(){x(this,m,!0)}fragmentNavigated(){x(this,m,!0),P(this,g,nS).call(this,new a("browsingContext.fragmentNavigated"))}load(){P(this,g,nS).call(this,new a("browsingContext.load"))}fail(O){P(this,g,nS).call(this,new a(c(this,m)?"browsingContext.navigationAborted":"browsingContext.navigationFailed",O))}}l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakSet,nS=function(O){x(this,d,!0),!c(this,f)&&!c(this,h).isFinished&&O.eventName!=="browsingContext.load"&&c(this,p).registerEvent({type:"event",method:O.eventName,params:this.navigationInfo()},c(this,l)),c(this,h).resolve(O)},oa.NavigationState=o;let u=(I=class{constructor(O,T,L,U){b(this,E);b(this,w);b(this,S);b(this,_,new Map);b(this,v);b(this,A);b(this,k);b(this,C,!0);x(this,v,T),x(this,w,L),x(this,S,U),x(this,C,!0),x(this,A,new o(O,T,(0,s.urlMatchesAboutBlank)(O),c(this,w)))}get currentNavigationId(){var O;return((O=c(this,k))==null?void 0:O.loaderId)!==void 0?c(this,k).navigationId:c(this,A).navigationId}get isInitialNavigation(){return c(this,C)}get url(){return c(this,A).url}createPendingNavigation(O,T=!1){var U,J;(U=c(this,S))==null||U.call(this,t.LogType.debug,"createCommandNavigation"),x(this,C,T&&c(this,C)&&(0,s.urlMatchesAboutBlank)(O)),(J=c(this,k))==null||J.fail("navigation canceled by concurrent navigation");const L=new o(O,c(this,v),c(this,C),c(this,w));return x(this,k,L),L}dispose(){var O;(O=c(this,k))==null||O.fail("navigation canceled by context disposal"),c(this,A).fail("navigation canceled by context disposal")}onTargetInfoChanged(O){var T;(T=c(this,S))==null||T.call(this,t.LogType.debug,`onTargetInfoChanged ${O}`),c(this,A).url=O}frameNavigated(O,T,L){var J;if((J=c(this,S))==null||J.call(this,t.LogType.debug,`frameNavigated ${O}`),L!==void 0&&!c(this,_).has(T)){const F=c(this,k)??this.createPendingNavigation(L,!0);F.url=L,F.start(),F.fail("the requested url is unreachable");return}const U=P(this,E,W3).call(this,O,T);U.frameNavigated(),U!==c(this,A)&&c(this,A).fail("navigation canceled by concurrent navigation"),U.url=O,U.loaderId=T,c(this,_).set(T,U),U.start(),x(this,A,U),c(this,k)===U&&x(this,k,void 0)}navigatedWithinDocument(O,T){var U;if((U=c(this,S))==null||U.call(this,t.LogType.debug,`navigatedWithinDocument ${O}, ${T}`),c(this,A).url=O,T!=="fragment")return;const L=c(this,k)!==void 0&&c(this,k).loaderId===void 0?c(this,k):new o(O,c(this,v),!1,c(this,w));L.fragmentNavigated(),L===c(this,k)&&x(this,k,void 0)}frameRequestedNavigation(O){var T;(T=c(this,S))==null||T.call(this,t.LogType.debug,`Page.frameRequestedNavigation ${O}`),this.createPendingNavigation(O,!0)}loadPageEvent(O){var T,L;(T=c(this,S))==null||T.call(this,t.LogType.debug,"loadPageEvent"),x(this,C,!1),(L=c(this,_).get(O))==null||L.load()}failNavigation(O,T){var L;(L=c(this,S))==null||L.call(this,t.LogType.debug,"failCommandNavigation"),O.fail(T)}navigationCommandFinished(O,T){var L;(L=c(this,S))==null||L.call(this,t.LogType.debug,`finishCommandNavigation ${O.navigationId}, ${T}`),T!==void 0&&(O.loaderId=T,c(this,_).set(T,O)),O.isFragmentNavigation=T===void 0,!(T===void 0||c(this,A)===O)&&(c(this,A).fail("navigation canceled by concurrent navigation"),O.start(),x(this,A,O),c(this,k)===O&&x(this,k,void 0))}frameStartedNavigating(O,T){var U;if((U=c(this,S))==null||U.call(this,t.LogType.debug,`frameStartedNavigating ${O}, ${T}`),c(this,_).has(T))return;const L=c(this,k)??this.createPendingNavigation(O,!0);L.url=O,L.start(),L.loaderId=T,c(this,_).set(T,L)}beforeunload(){var O,T;if((O=c(this,S))==null||O.call(this,t.LogType.debug,"beforeunload"),c(this,k)===void 0){(T=c(this,S))==null||T.call(this,t.LogType.debugError,"Unexpectedly no pending navigation on beforeunload");return}c(this,k).start()}networkLoadingFailed(O,T){var L;(L=c(this,_).get(O))==null||L.fail(T)}},w=new WeakMap,S=new WeakMap,_=new WeakMap,v=new WeakMap,A=new WeakMap,k=new WeakMap,C=new WeakMap,E=new WeakSet,W3=function(O,T){var L;return c(this,_).has(T)?c(this,_).get(T):c(this,k)!==void 0&&((L=c(this,k))==null?void 0:L.loaderId)===void 0?c(this,k):this.createPendingNavigation(O,!0)},I);return oa.NavigationTracker=u,oa}var H2;function W2(){var y,w,S,_,v,A,k,C,E,N,I,$,O,T,L,U,J,F,sS,n1,D,z3,V3,iS,s1,G3,i1,Z3,J3,X3;if(H2)return Cd;H2=1;var n;Object.defineProperty(Cd,"__esModule",{value:!0}),Cd.BrowsingContextImpl=void 0,Cd.serializeOrigin=d;const e=Nt(),t=Mc(),r=h0(),s=hs(),i=$2(),a=Kee(),o=U2(),u=zee();let l=(y=class{constructor(R,M,q,W,X,re,ce,Re,le,Ne,Se){b(this,F);b(this,w,new Set);b(this,S);Z(this,"userContext");b(this,_);b(this,v,null);b(this,A,{width:0,height:0});b(this,k);b(this,C,{DOMContentLoaded:new r.Deferred,load:new r.Deferred});b(this,E);b(this,N,new r.Deferred);b(this,I);b(this,$);b(this,O);b(this,T);b(this,L);b(this,U);b(this,J);x(this,E,W),x(this,S,R),x(this,v,M),this.userContext=q,x(this,$,X),x(this,I,re),x(this,L,ce),x(this,U,Ne),x(this,O,Se),x(this,k,le),x(this,T,new u.NavigationTracker(Re,R,X,Se))}static create(R,M,q,W,X,re,ce,Re,le,Ne,Se){var ee;const H=new n(R,M,q,W,X,re,ce,Re,le,Ne,Se);return P(ee=H,F,n1).call(ee),re.addContext(H),H.isTopLevelContext()||H.parent.addChild(H.id),X.registerPromiseEvent(H.targetUnblockedOrThrow().then(()=>({kind:"success",value:{type:"event",method:e.ChromiumBidi.BrowsingContext.EventNames.ContextCreated,params:{...H.serializeToBidiValue(),url:Re}}}),oe=>({kind:"error",error:oe})),H.id,e.ChromiumBidi.BrowsingContext.EventNames.ContextCreated),H}get navigableId(){return c(this,_)}get navigationId(){return c(this,T).currentNavigationId}dispose(R){c(this,T).dispose(),P(this,F,sS).call(this),c(this,L).deleteRealms({browsingContextId:this.id}),this.isTopLevelContext()||c(this.parent,w).delete(this.id),P(this,F,G3).call(this),R&&c(this,$).registerEvent({type:"event",method:e.ChromiumBidi.BrowsingContext.EventNames.ContextDestroyed,params:this.serializeToBidiValue()},this.id),c(this,$).clearBufferedEvents(this.id),c(this,I).deleteContextById(this.id)}get id(){return c(this,S)}get parentId(){return c(this,v)}set parentId(R){var M;if(c(this,v)!==null){(M=c(this,O))==null||M.call(this,s.LogType.debugError,"Parent context already set");return}x(this,v,R),this.isTopLevelContext()||this.parent.addChild(this.id)}get parent(){return this.parentId===null?null:c(this,I).getContext(this.parentId)}get directChildren(){return[...c(this,w)].map(R=>c(this,I).getContext(R))}get allChildren(){const R=this.directChildren;return R.concat(...R.map(M=>M.allChildren))}isTopLevelContext(){return c(this,v)===null}get top(){let R=this,M=R.parent;for(;M;)R=M,M=R.parent;return R}addChild(R){c(this,w).add(R)}get cdpTarget(){return c(this,E)}updateCdpTarget(R){x(this,E,R),P(this,F,n1).call(this)}get url(){return c(this,T).url}async lifecycleLoaded(){await c(this,C).load}async targetUnblockedOrThrow(){const R=await c(this,E).unblocked;if(R.kind==="error")throw R.error}async getOrCreateSandbox(R){if(R===void 0||R==="")return await c(this,N);let M=c(this,L).findRealms({browsingContextId:this.id,sandbox:R});return M.length===0&&(await c(this,E).cdpClient.sendCommand("Page.createIsolatedWorld",{frameId:this.id,worldName:R}),M=c(this,L).findRealms({browsingContextId:this.id,sandbox:R}),(0,t.assert)(M.length!==0)),M[0]}serializeToBidiValue(R=0,M=!0){return{context:c(this,S),url:this.url,userContext:this.userContext,originalOpener:c(this,k)??null,clientWindow:"",children:R>0?this.directChildren.map(q=>q.serializeToBidiValue(R-1,!1)):null,...M?{parent:c(this,v)}:{}}}onTargetInfoChanged(R){c(this,T).onTargetInfoChanged(R.targetInfo.url)}async navigate(R,M){try{new URL(R)}catch{throw new e.InvalidArgumentException(`Invalid URL: ${R}`)}const q=c(this,T).createPendingNavigation(R),W=(async()=>{const re=await c(this,E).cdpClient.sendCommand("Page.navigate",{url:R,frameId:this.id});if(re.errorText)throw c(this,T).failNavigation(q,re.errorText),new e.UnknownErrorException(re.errorText);c(this,T).navigationCommandFinished(q,re.loaderId),P(this,F,iS).call(this,re.loaderId)})(),X=await Promise.race([P(this,F,i1).call(this,M,W,q),q.finished]);if(X instanceof u.NavigationResult&&(X.eventName==="browsingContext.navigationAborted"||X.eventName==="browsingContext.navigationFailed"))throw new e.UnknownErrorException(X.message??"unknown exception");return{navigation:q.navigationId,url:q.url}}async reload(R,M){await this.targetUnblockedOrThrow(),P(this,F,s1).call(this);const q=c(this,T).createPendingNavigation(c(this,T).url),W=c(this,E).cdpClient.sendCommand("Page.reload",{ignoreCache:R}),X=await Promise.race([P(this,F,i1).call(this,M,W,q),q.finished]);if(X instanceof u.NavigationResult&&(X.eventName==="browsingContext.navigationAborted"||X.eventName==="browsingContext.navigationFailed"))throw new e.UnknownErrorException(X.message??"unknown exception");return{navigation:q.navigationId,url:q.url}}async setViewport(R,M){if(R===null&&M===null)await c(this,E).cdpClient.sendCommand("Emulation.clearDeviceMetricsOverride");else try{let q;R===void 0?q=c(this,A):R===null?q={width:0,height:0}:q=R,x(this,A,q),await c(this,E).cdpClient.sendCommand("Emulation.setDeviceMetricsOverride",{width:c(this,A).width,height:c(this,A).height,deviceScaleFactor:M||0,mobile:!1,dontSetVisibleSize:!0})}catch(q){throw q.message.startsWith("Width and height values must be positive")?new e.UnsupportedOperationException("Provided viewport dimensions are not supported"):q}}async handleUserPrompt(R,M){await c(this,E).cdpClient.sendCommand("Page.handleJavaScriptDialog",{accept:R??!0,promptText:M})}async activate(){await c(this,E).cdpClient.sendCommand("Page.bringToFront")}async captureScreenshot(R){if(!this.isTopLevelContext())throw new e.UnsupportedOperationException(`Non-top-level 'context' (${R.context}) is currently not supported`);const M=h(R);let q=!1,W;switch(R.origin??(R.origin="viewport"),R.origin){case"document":{W=String(()=>{const le=document.documentElement;return{x:0,y:0,width:le.scrollWidth,height:le.scrollHeight}}),q=!0;break}case"viewport":{W=String(()=>{const le=window.visualViewport;return{x:le.pageLeft,y:le.pageTop,width:le.width,height:le.height}});break}}const re=await(await this.getOrCreateSandbox(void 0)).callFunction(W,!1);(0,t.assert)(re.type==="success");const ce=f(re.result);(0,t.assert)(ce);let Re=ce;if(R.clip){const le=R.clip;R.origin==="viewport"&&le.type==="box"&&(le.x+=ce.x,le.y+=ce.y),Re=m(await P(this,F,Z3).call(this,le),ce)}if(Re.width===0||Re.height===0)throw new e.UnableToCaptureScreenException(`Unable to capture screenshot with zero dimensions: width=${Re.width}, height=${Re.height}`);return await c(this,E).cdpClient.sendCommand("Page.captureScreenshot",{clip:{...Re,scale:1},...M,captureBeyondViewport:q})}async print(R){var q,W,X,re,ce,Re;if(!this.isTopLevelContext())throw new e.UnsupportedOperationException("Printing of non-top level contexts is not supported");const M={};if(R.background!==void 0&&(M.printBackground=R.background),((q=R.margin)==null?void 0:q.bottom)!==void 0&&(M.marginBottom=(0,a.inchesFromCm)(R.margin.bottom)),((W=R.margin)==null?void 0:W.left)!==void 0&&(M.marginLeft=(0,a.inchesFromCm)(R.margin.left)),((X=R.margin)==null?void 0:X.right)!==void 0&&(M.marginRight=(0,a.inchesFromCm)(R.margin.right)),((re=R.margin)==null?void 0:re.top)!==void 0&&(M.marginTop=(0,a.inchesFromCm)(R.margin.top)),R.orientation!==void 0&&(M.landscape=R.orientation==="landscape"),((ce=R.page)==null?void 0:ce.height)!==void 0&&(M.paperHeight=(0,a.inchesFromCm)(R.page.height)),((Re=R.page)==null?void 0:Re.width)!==void 0&&(M.paperWidth=(0,a.inchesFromCm)(R.page.width)),R.pageRanges!==void 0){for(const le of R.pageRanges){if(typeof le=="number")continue;const Ne=le.split("-");if(Ne.length<1||Ne.length>2)throw new e.InvalidArgumentException(`Invalid page range: ${le} is not a valid integer range.`);if(Ne.length===1){g(Ne[0]??"");continue}let Se,H;const[ee="",oe=""]=Ne;if(ee===""?Se=1:Se=g(ee),oe===""?H=Number.MAX_SAFE_INTEGER:H=g(oe),Se>H)throw new e.InvalidArgumentException(`Invalid page range: ${ee} > ${oe}`)}M.pageRanges=R.pageRanges.join(",")}R.scale!==void 0&&(M.scale=R.scale),R.shrinkToFit!==void 0&&(M.preferCSSPageSize=!R.shrinkToFit);try{return{data:(await c(this,E).cdpClient.sendCommand("Page.printToPDF",M)).data}}catch(le){throw le.message==="invalid print parameters: content area is empty"?new e.UnsupportedOperationException(le.message):le}}async close(){await c(this,E).cdpClient.sendCommand("Page.close")}async traverseHistory(R){if(R===0)return;const M=await c(this,E).cdpClient.sendCommand("Page.getNavigationHistory"),q=M.entries[M.currentIndex+R];if(!q)throw new e.NoSuchHistoryEntryException(`No history entry at delta ${R}`);await c(this,E).cdpClient.sendCommand("Page.navigateToHistoryEntry",{entryId:q.id})}async toggleModulesIfNeeded(){await Promise.all([c(this,E).toggleNetworkIfNeeded(),c(this,E).toggleDeviceAccessIfNeeded()])}async locateNodes(R){return await P(this,F,X3).call(this,await c(this,N),R.locator,R.startNodes??[],R.maxNodeCount,R.serializationOptions)}},w=new WeakMap,S=new WeakMap,_=new WeakMap,v=new WeakMap,A=new WeakMap,k=new WeakMap,C=new WeakMap,E=new WeakMap,N=new WeakMap,I=new WeakMap,$=new WeakMap,O=new WeakMap,T=new WeakMap,L=new WeakMap,U=new WeakMap,J=new WeakMap,F=new WeakSet,sS=function(R=!1){this.directChildren.map(M=>M.dispose(R))},n1=function(){c(this,E).cdpClient.on("Network.loadingFailed",R=>{c(this,T).networkLoadingFailed(R.requestId,R.errorText)}),c(this,E).cdpClient.on("Page.frameNavigated",R=>{this.id===R.frame.id&&(c(this,T).frameNavigated(R.frame.url+(R.frame.urlFragment??""),R.frame.loaderId,R.frame.unreachableUrl),P(this,F,sS).call(this),P(this,F,iS).call(this,R.frame.loaderId))}),c(this,E).on("frameStartedNavigating",R=>{var q;(q=c(this,O))==null||q.call(this,s.LogType.debugInfo,"Received frameStartedNavigating event",R),[this.id,...this.cdpTarget.id===this.id?[void 0]:[]].includes(R.frameId)&&c(this,T).frameStartedNavigating(R.url,R.loaderId)}),c(this,E).cdpClient.on("Page.navigatedWithinDocument",R=>{if(this.id===R.frameId&&(c(this,T).navigatedWithinDocument(R.url,R.navigationType),R.navigationType==="historyApi")){c(this,$).registerEvent({type:"event",method:"browsingContext.historyUpdated",params:{context:this.id,url:c(this,T).url}},this.id);return}}),c(this,E).cdpClient.on("Page.frameRequestedNavigation",R=>{this.id===R.frameId&&c(this,T).frameRequestedNavigation(R.url)}),c(this,E).cdpClient.on("Page.lifecycleEvent",R=>{if(this.id===R.frameId){if(R.name==="init"){P(this,F,iS).call(this,R.loaderId);return}if(R.name==="commit"){x(this,_,R.loaderId);return}if(c(this,_)||x(this,_,R.loaderId),R.loaderId===c(this,_))switch(R.name){case"DOMContentLoaded":c(this,T).isInitialNavigation||c(this,$).registerEvent({type:"event",method:e.ChromiumBidi.BrowsingContext.EventNames.DomContentLoaded,params:{context:this.id,navigation:c(this,T).currentNavigationId,timestamp:(0,i.getTimestamp)(),url:c(this,T).url}},this.id),c(this,C).DOMContentLoaded.resolve();break;case"load":c(this,T).isInitialNavigation||c(this,$).registerEvent({type:"event",method:e.ChromiumBidi.BrowsingContext.EventNames.Load,params:{context:this.id,navigation:c(this,T).currentNavigationId,timestamp:(0,i.getTimestamp)(),url:c(this,T).url}},this.id),c(this,T).loadPageEvent(R.loaderId),c(this,C).load.resolve();break}}}),c(this,E).cdpClient.on("Runtime.executionContextCreated",R=>{var le;const{auxData:M,name:q,uniqueId:W,id:X}=R.context;if(!M||M.frameId!==this.id)return;let re,ce;switch(M.type){case"isolated":ce=q,c(this,N).isFinished||(le=c(this,O))==null||le.call(this,s.LogType.debugError,"Unexpectedly, isolated realm created before the default one"),re=c(this,N).isFinished?c(this,N).result.origin:"";break;case"default":re=d(R.context.origin);break;default:return}const Re=new o.WindowRealm(this.id,c(this,I),c(this,E).cdpClient,c(this,$),X,c(this,O),re,W,c(this,L),ce);M.isDefault&&(c(this,N).resolve(Re),Promise.all(c(this,E).getChannels().map(Ne=>Ne.startListenerFromWindow(Re,c(this,$)))))}),c(this,E).cdpClient.on("Runtime.executionContextDestroyed",R=>{c(this,N).isFinished&&c(this,N).result.executionContextId===R.executionContextId&&x(this,N,new r.Deferred),c(this,L).deleteRealms({cdpSessionId:c(this,E).cdpSessionId,executionContextId:R.executionContextId})}),c(this,E).cdpClient.on("Runtime.executionContextsCleared",()=>{c(this,N).isFinished||c(this,N).reject(new e.UnknownErrorException("execution contexts cleared")),x(this,N,new r.Deferred),c(this,L).deleteRealms({cdpSessionId:c(this,E).cdpSessionId})}),c(this,E).cdpClient.on("Page.javascriptDialogClosed",R=>{var q;const M=R.result;c(this,J)===void 0&&((q=c(this,O))==null||q.call(this,s.LogType.debugError,"Unexpectedly no opening prompt event before closing one")),c(this,$).registerEvent({type:"event",method:e.ChromiumBidi.BrowsingContext.EventNames.UserPromptClosed,params:{context:this.id,accepted:M,type:c(this,J)??"UNKNOWN",userText:M&&R.userInput?R.userInput:void 0}},this.id),x(this,J,void 0)}),c(this,E).cdpClient.on("Page.javascriptDialogOpening",R=>{var W;const M=P(W=n,D,z3).call(W,R.type);R.type==="beforeunload"&&c(this,T).beforeunload(),x(this,J,M);const q=P(this,F,V3).call(this,M);switch(c(this,$).registerEvent({type:"event",method:e.ChromiumBidi.BrowsingContext.EventNames.UserPromptOpened,params:{context:this.id,handler:q,type:M,message:R.message,...R.type==="prompt"?{defaultValue:R.defaultPrompt}:{}}},this.id),q){case"accept":this.handleUserPrompt(!0);break;case"dismiss":this.handleUserPrompt(!1);break}})},D=new WeakSet,z3=function(R){switch(R){case"alert":return"alert";case"beforeunload":return"beforeunload";case"confirm":return"confirm";case"prompt":return"prompt"}},V3=function(R){var q,W,X,re,ce,Re,le,Ne;const M="dismiss";switch(R){case"alert":return((q=c(this,U))==null?void 0:q.alert)??((W=c(this,U))==null?void 0:W.default)??M;case"beforeunload":return((X=c(this,U))==null?void 0:X.beforeUnload)??((re=c(this,U))==null?void 0:re.default)??"accept";case"confirm":return((ce=c(this,U))==null?void 0:ce.confirm)??((Re=c(this,U))==null?void 0:Re.default)??M;case"prompt":return((le=c(this,U))==null?void 0:le.prompt)??((Ne=c(this,U))==null?void 0:Ne.default)??M}},iS=function(R){R===void 0||c(this,_)===R||(P(this,F,s1).call(this),x(this,_,R),P(this,F,sS).call(this,!0))},s1=function(){var R,M;c(this,C).DOMContentLoaded.isFinished?c(this,C).DOMContentLoaded=new r.Deferred:(R=c(this,O))==null||R.call(this,n.LOGGER_PREFIX,"Document changed (DOMContentLoaded)"),c(this,C).load.isFinished?c(this,C).load=new r.Deferred:(M=c(this,O))==null||M.call(this,n.LOGGER_PREFIX,"Document changed (load)")},G3=function(){c(this,C).DOMContentLoaded.isFinished||c(this,C).DOMContentLoaded.reject(new e.UnknownErrorException("navigation canceled")),c(this,C).load.isFinished||c(this,C).load.reject(new e.UnknownErrorException("navigation canceled"))},i1=async function(R,M,q){if(R!=="none"){if(await M,q.isFragmentNavigation===!0){await q.finished;return}if(R==="interactive"){await c(this,C).DOMContentLoaded;return}if(R==="complete"){await c(this,C).load;return}throw new e.InvalidArgumentException(`Wait condition ${R} is not supported`)}},Z3=async function(R){switch(R.type){case"box":return{x:R.x,y:R.y,width:R.width,height:R.height};case"element":{const M=await this.getOrCreateSandbox(void 0),q=await M.callFunction(String(W=>W instanceof Element),!1,{type:"undefined"},[R.element]);if(q.type==="exception")throw new e.NoSuchElementException(`Element '${R.element.sharedId}' was not found`);if((0,t.assert)(q.result.type==="boolean"),!q.result.value)throw new e.NoSuchElementException(`Node '${R.element.sharedId}' is not an Element`);{const W=await M.callFunction(String(re=>{const ce=re.getBoundingClientRect();return{x:ce.x,y:ce.y,height:ce.height,width:ce.width}}),!1,{type:"undefined"},[R.element]);(0,t.assert)(W.type==="success");const X=f(W.result);if(!X)throw new e.UnableToCaptureScreenException(`Could not get bounding box for Element '${R.element.sharedId}'`);return X}}}},J3=async function(R,M,q,W){switch(M.type){case"context":throw new Error("Unreachable");case"css":return{functionDeclaration:String((X,re,...ce)=>{const Re=Ne=>{if(!(Ne instanceof HTMLElement||Ne instanceof Document||Ne instanceof DocumentFragment))throw new Error("startNodes in css selector should be HTMLElement, Document or DocumentFragment");return[...Ne.querySelectorAll(X)]};ce=ce.length>0?ce:[document];const le=ce.map(Ne=>Re(Ne)).flat(1);return re===0?le:le.slice(0,re)}),argumentsLocalValues:[{type:"string",value:M.value},{type:"number",value:q??0},...W]};case"xpath":return{functionDeclaration:String((X,re,...ce)=>{const le=new XPathEvaluator().createExpression(X),Ne=H=>{const ee=le.evaluate(H,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE),oe=[];for(let be=0;be<ee.snapshotLength;be++)oe.push(ee.snapshotItem(be));return oe};ce=ce.length>0?ce:[document];const Se=ce.map(H=>Ne(H)).flat(1);return re===0?Se:Se.slice(0,re)}),argumentsLocalValues:[{type:"string",value:M.value},{type:"number",value:q??0},...W]};case"innerText":if(M.value==="")throw new e.InvalidSelectorException("innerText locator cannot be empty");return{functionDeclaration:String((X,re,ce,Re,le,...Ne)=>{const Se=ce?X.toUpperCase():X,H=(oe,be)=>{var On;const $e=[];if(oe instanceof DocumentFragment||oe instanceof Document)return[...oe.children].forEach(Na=>$e.push(...H(Na,be))),$e;if(!(oe instanceof HTMLElement))return[];const ze=oe,It=ce?(On=ze.innerText)==null?void 0:On.toUpperCase():ze.innerText;if(!It.includes(Se))return[];const Ot=[];for(const Pr of ze.children)Pr instanceof HTMLElement&&Ot.push(Pr);if(Ot.length===0)re&&It===Se?$e.push(ze):re||$e.push(ze);else{const Pr=be<=0?[]:Ot.map(Na=>H(Na,be-1)).flat(1);Pr.length===0?(!re||It===Se)&&$e.push(ze):$e.push(...Pr)}return $e};Ne=Ne.length>0?Ne:[document];const ee=Ne.map(oe=>H(oe,le)).flat(1);return Re===0?ee:ee.slice(0,Re)}),argumentsLocalValues:[{type:"string",value:M.value},{type:"boolean",value:M.matchType!=="partial"},{type:"boolean",value:M.ignoreCase===!0},{type:"number",value:q??0},{type:"number",value:M.maxDepth??1e3},...W]};case"accessibility":{if(!M.value.name&&!M.value.role)throw new e.InvalidSelectorException("Either name or role has to be specified");await Promise.all([c(this,E).cdpClient.sendCommand("Accessibility.enable"),c(this,E).cdpClient.sendCommand("Accessibility.getRootAXNode")]);const X=await R.evaluate("({getAccessibleName, getAccessibleRole})",!1,"root",void 0,!1,!0);if(X.type!=="success")throw new Error("Could not get bindings");if(X.result.type!=="object")throw new Error("Could not get bindings");return{functionDeclaration:String((re,ce,Re,le,...Ne)=>{const Se=[];let H=!1;function ee(oe,be){if(!H)for(const $e of oe){let ze=!0;if(be.role){const Ot=Re.getAccessibleRole($e);be.role!==Ot&&(ze=!1)}if(be.name){const Ot=Re.getAccessibleName($e);be.name!==Ot&&(ze=!1)}if(ze){if(le!==0&&Se.length===le){H=!0;break}Se.push($e)}const It=[];for(const Ot of $e.children)Ot instanceof HTMLElement&&It.push(Ot);ee(It,be)}}return Ne=Ne.length>0?Ne:Array.from(document.documentElement.children).filter(oe=>oe instanceof HTMLElement),ee(Ne,{role:ce,name:re}),Se}),argumentsLocalValues:[{type:"string",value:M.value.name||""},{type:"string",value:M.value.role||""},{handle:X.result.handle},{type:"number",value:q??0},...W]}}}},X3=async function(R,M,q,W,X){var le,Ne,Se;if(M.type==="context"){if(q.length!==0)throw new e.InvalidArgumentException("Start nodes are not supported");const H=M.value.context;if(!H)throw new e.InvalidSelectorException("Invalid context");const oe=c(this,I).getContext(H).parent;if(!oe)throw new e.InvalidArgumentException("This context has no container");try{const{backendNodeId:be}=await c(oe,E).cdpClient.sendCommand("DOM.getFrameOwner",{frameId:H}),{object:$e}=await c(oe,E).cdpClient.sendCommand("DOM.resolveNode",{backendNodeId:be}),ze=await R.callFunction("function () { return this; }",!1,{handle:$e.objectId},[],"none",X);if(ze.type==="exception")throw new Error("Unknown exception");return{nodes:[ze.result]}}catch{throw new e.InvalidArgumentException("Context does not exist")}}const re=await P(this,F,J3).call(this,R,M,W,q);X={...X,maxObjectDepth:1};const ce=await R.callFunction(re.functionDeclaration,!1,{type:"undefined"},re.argumentsLocalValues,"none",X);if(ce.type!=="success")throw(le=c(this,O))==null||le.call(this,n.LOGGER_PREFIX,"Failed locateNodesByLocator",ce),(Ne=ce.exceptionDetails.text)!=null&&Ne.endsWith("is not a valid selector.")||(Se=ce.exceptionDetails.text)!=null&&Se.endsWith("is not a valid XPath expression.")?new e.InvalidSelectorException(`Not valid selector ${typeof M.value=="string"?M.value:JSON.stringify(M.value)}`):ce.exceptionDetails.text==="Error: startNodes in css selector should be HTMLElement, Document or DocumentFragment"?new e.InvalidArgumentException("startNodes in css selector should be HTMLElement, Document or DocumentFragment"):new e.UnknownErrorException(`Unexpected error in selector script: ${ce.exceptionDetails.text}`);if(ce.result.type!=="array")throw new e.UnknownErrorException(`Unexpected selector script result type: ${ce.result.type}`);return{nodes:ce.result.value.map(H=>{if(H.type!=="node")throw new e.UnknownErrorException(`Unexpected selector script result element: ${H.type}`);return H})}},b(y,D),Z(y,"LOGGER_PREFIX",`${s.LogType.debug}:browsingContext`),y);Cd.BrowsingContextImpl=l,n=l;function d(we){return["://",""].includes(we)&&(we="null"),we}function h(we){const{quality:R,type:M}=we.format??{type:"image/png"};switch(M){case"image/png":return{format:"png"};case"image/jpeg":return{format:"jpeg",...R===void 0?{}:{quality:Math.round(R*100)}};case"image/webp":return{format:"webp",...R===void 0?{}:{quality:Math.round(R*100)}}}throw new e.InvalidArgumentException(`Image format '${M}' is not a supported format`)}function f(we){var X,re,ce,Re;if(we.type!=="object"||we.value===void 0)return;const R=(X=we.value.find(([le])=>le==="x"))==null?void 0:X[1],M=(re=we.value.find(([le])=>le==="y"))==null?void 0:re[1],q=(ce=we.value.find(([le])=>le==="height"))==null?void 0:ce[1],W=(Re=we.value.find(([le])=>le==="width"))==null?void 0:Re[1];if(!((R==null?void 0:R.type)!=="number"||(M==null?void 0:M.type)!=="number"||(q==null?void 0:q.type)!=="number"||(W==null?void 0:W.type)!=="number"))return{x:R.value,y:M.value,width:W.value,height:q.value}}function p(we){return{...we.width<0?{x:we.x+we.width,width:-we.width}:{x:we.x,width:we.width},...we.height<0?{y:we.y+we.height,height:-we.height}:{y:we.y,height:we.height}}}function m(we,R){we=p(we),R=p(R);const M=Math.max(we.x,R.x),q=Math.max(we.y,R.y);return{x:M,y:q,width:Math.max(Math.min(we.x+we.width,R.x+R.width)-M,0),height:Math.max(Math.min(we.y+we.height,R.y+R.height)-q,0)}}function g(we){if(we=we.trim(),!/^[0-9]+$/.test(we))throw new e.InvalidArgumentException(`Invalid integer: ${we}`);return parseInt(we)}return Cd}var Zm={},z2;function Vee(){var t,r,s;if(z2)return Zm;z2=1,Object.defineProperty(Zm,"__esModule",{value:!0}),Zm.WorkerRealm=void 0;const n=F2();let e=(s=class extends n.Realm{constructor(o,u,l,d,h,f,p,m,g){super(o,u,l,d,h,p,m);b(this,t);b(this,r);x(this,r,f),x(this,t,g),this.initialize()}get associatedBrowsingContexts(){return c(this,r).flatMap(o=>o.associatedBrowsingContexts)}get realmType(){return c(this,t)}get source(){var o;return{realm:this.realmId,context:(o=this.associatedBrowsingContexts[0])==null?void 0:o.id}}get realmInfo(){const o=c(this,r).map(l=>l.realmId),{realmType:u}=this;switch(u){case"dedicated-worker":{const l=o[0];if(l===void 0||o.length!==1)throw new Error("Dedicated worker must have exactly one owner");return{...this.baseInfo,type:u,owners:[l]}}case"service-worker":case"shared-worker":return{...this.baseInfo,type:u}}}},t=new WeakMap,r=new WeakMap,s);return Zm.WorkerRealm=e,Zm}var Jm={},Xm={},Ym={},V2;function Gee(){if(V2)return Ym;V2=1,Object.defineProperty(Ym,"__esModule",{value:!0}),Ym.logMessageFormatter=r,Ym.getRemoteValuesText=a;const n=Mc(),e=["%s","%d","%i","%f","%o","%O","%c"];function t(o){return e.some(u=>o.includes(u))}function r(o){let u="";const l=o[0].value.toString(),d=o.slice(1,void 0),h=l.split(new RegExp(e.map(f=>`(${f})`).join("|"),"g"));for(const f of h)if(!(f===void 0||f===""))if(t(f)){const p=d.shift();(0,n.assert)(p,`Less value is provided: "${a(o,!1)}"`),f==="%s"?u+=i(p):f==="%d"||f==="%i"?p.type==="bigint"||p.type==="number"||p.type==="string"?u+=parseInt(p.value.toString(),10):u+="NaN":f==="%f"?p.type==="bigint"||p.type==="number"||p.type==="string"?u+=parseFloat(p.value.toString()):u+="NaN":u+=s(p)}else u+=f;if(d.length>0)throw new Error(`More value is provided: "${a(o,!1)}"`);return u}function s(o){var u;if(o.type!=="array"&&o.type!=="bigint"&&o.type!=="date"&&o.type!=="number"&&o.type!=="object"&&o.type!=="string")return i(o);if(o.type==="bigint")return`${o.value.toString()}n`;if(o.type==="number")return o.value.toString();if(["date","string"].includes(o.type))return JSON.stringify(o.value);if(o.type==="object")return`{${o.value.map(l=>`${JSON.stringify(l[0])}:${s(l[1])}`).join(",")}}`;if(o.type==="array")return`[${((u=o.value)==null?void 0:u.map(l=>s(l)).join(","))??""}]`;throw Error(`Invalid value type: ${o}`)}function i(o){var u,l,d,h;if(!Object.hasOwn(o,"value"))return o.type;switch(o.type){case"string":case"number":case"boolean":case"bigint":return String(o.value);case"regexp":return`/${o.value.pattern}/${o.value.flags??""}`;case"date":return new Date(o.value).toString();case"object":return`Object(${((u=o.value)==null?void 0:u.length)??""})`;case"array":return`Array(${((l=o.value)==null?void 0:l.length)??""})`;case"map":return`Map(${(d=o.value)==null?void 0:d.length})`;case"set":return`Set(${(h=o.value)==null?void 0:h.length})`;default:return o.type}}function a(o,u){const l=o[0];return l?l.type==="string"&&t(l.value.toString())&&u?r(o):o.map(d=>i(d)).join(" "):""}return Ym}var G2;function Zee(){var u,l,d,h,f,Y3,Q3,g,y,e4;if(G2)return Xm;G2=1;var n;Object.defineProperty(Xm,"__esModule",{value:!0}),Xm.LogManager=void 0;const e=Nt(),t=hs(),r=Gee();function s(S){const _=S==null?void 0:S.callFrames.map(v=>({columnNumber:v.columnNumber,functionName:v.functionName,lineNumber:v.lineNumber,url:v.url}));return _?{callFrames:_}:void 0}function i(S){return["error","assert"].includes(S)?"error":["debug","trace"].includes(S)?"debug":["warn","warning"].includes(S)?"warn":"info"}function a(S){switch(S){case"warning":return"warn";case"startGroup":return"group";case"startGroupCollapsed":return"groupCollapsed";case"endGroup":return"groupEnd"}return S}let o=(y=class{constructor(_,v,A,k){b(this,f);b(this,u);b(this,l);b(this,d);b(this,h);x(this,d,_),x(this,l,v),x(this,u,A),x(this,h,k)}static create(_,v,A,k){var E;const C=new n(_,v,A,k);return P(E=C,f,Q3).call(E),C}},u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakSet,Y3=async function(_,v){switch(_.type){case"undefined":return{type:"undefined"};case"boolean":return{type:"boolean",value:_.value};case"string":return{type:"string",value:_.value};case"number":return{type:"number",value:_.unserializableValue??_.value};case"bigint":if(_.unserializableValue!==void 0&&_.unserializableValue[_.unserializableValue.length-1]==="n")return{type:_.type,value:_.unserializableValue.slice(0,-1)};break;case"object":if(_.subtype==="null")return{type:"null"};break}return await v.serializeCdpObject(_,"none")},Q3=function(){c(this,d).cdpClient.on("Runtime.consoleAPICalled",_=>{var k;const v=c(this,l).findRealm({cdpSessionId:c(this,d).cdpSessionId,executionContextId:_.executionContextId});if(v===void 0){(k=c(this,h))==null||k.call(this,t.LogType.cdp,_);return}const A=Promise.all(_.args.map(C=>P(this,f,Y3).call(this,C,v)));for(const C of v.associatedBrowsingContexts)c(this,u).registerPromiseEvent(A.then(E=>({kind:"success",value:{type:"event",method:e.ChromiumBidi.Log.EventNames.LogEntryAdded,params:{level:i(_.type),source:v.source,text:(0,r.getRemoteValuesText)(E,!0),timestamp:Math.round(_.timestamp),stackTrace:s(_.stackTrace),type:"console",method:a(_.type),args:E}}}),E=>({kind:"error",error:E})),C.id,e.ChromiumBidi.Log.EventNames.LogEntryAdded)}),c(this,d).cdpClient.on("Runtime.exceptionThrown",_=>{var A,k;const v=c(this,l).findRealm({cdpSessionId:c(this,d).cdpSessionId,executionContextId:_.exceptionDetails.executionContextId});if(v===void 0){(A=c(this,h))==null||A.call(this,t.LogType.cdp,_);return}for(const C of v.associatedBrowsingContexts)c(this,u).registerPromiseEvent(P(k=n,g,e4).call(k,_,v).then(E=>({kind:"success",value:{type:"event",method:e.ChromiumBidi.Log.EventNames.LogEntryAdded,params:{level:"error",source:v.source,text:E,timestamp:Math.round(_.timestamp),stackTrace:s(_.exceptionDetails.stackTrace),type:"javascript"}}}),E=>({kind:"error",error:E})),C.id,e.ChromiumBidi.Log.EventNames.LogEntryAdded)})},g=new WeakSet,e4=async function(_,v){return _.exceptionDetails.exception?v===void 0?JSON.stringify(_.exceptionDetails.exception):await v.stringifyObject(_.exceptionDetails.exception):_.exceptionDetails.text},b(y,g),y);return Xm.LogManager=o,n=o,Xm}var Z2;function Jee(){var o,u,l,d,h,f,p,m,g,y,w,S,_,v,A,k,C,t4,a1,aS,r4,n4,s4,i4,U;if(Z2)return Jm;Z2=1,Object.defineProperty(Jm,"__esModule",{value:!0}),Jm.CdpTarget=void 0;const n=JD(),e=h0(),t=xd(),r=hs(),s=W2(),i=Zee();let a=(U=class extends t.EventEmitter{constructor(j,B,D,z,G,te,V,K,ae,ve,de,et){super();b(this,C);b(this,o);b(this,u);b(this,l);b(this,d);b(this,h);b(this,f);b(this,p);b(this,m);b(this,g);b(this,y);b(this,w,new e.Deferred);b(this,S);b(this,_);b(this,v,!1);b(this,A,!1);b(this,k,{request:!1,response:!1,auth:!1});x(this,o,j),x(this,u,B),x(this,l,D),x(this,d,z),x(this,f,G),x(this,h,te),x(this,p,V),x(this,y,ae),x(this,m,K),x(this,g,ve),x(this,S,de),x(this,_,et)}static create(j,B,D,z,G,te,V,K,ae,ve,de,et){var R,M;const we=new U(j,B,D,z,te,G,V,K,ae,ve,de,et);return i.LogManager.create(we,G,te,et),P(R=we,C,r4).call(R),P(M=we,C,t4).call(M),we}get unblocked(){return c(this,w)}get id(){return c(this,o)}get cdpClient(){return c(this,u)}get parentCdpClient(){return c(this,d)}get browserCdpClient(){return c(this,l)}get cdpSessionId(){return c(this,u).sessionId}async toggleFetchIfNeeded(){const j=c(this,y).getInterceptionStages(this.topLevelId);if(c(this,k).request===j.request&&c(this,k).response===j.response&&c(this,k).auth===j.auth)return;const B=[];if(x(this,k,j),(j.request||j.auth)&&B.push({urlPattern:"*",requestStage:"Request"}),j.response&&B.push({urlPattern:"*",requestStage:"Response"}),B.length)await c(this,u).sendCommand("Fetch.enable",{patterns:B,handleAuthRequests:j.auth});else{const D=c(this,y).getRequestsByTarget(this).filter(z=>z.interceptPhase);Promise.allSettled(D.map(z=>z.waitNextPhase)).then(async()=>c(this,y).getRequestsByTarget(this).filter(G=>G.interceptPhase).length?await this.toggleFetchIfNeeded():await c(this,u).sendCommand("Fetch.disable")).catch(z=>{var G;(G=c(this,_))==null||G.call(this,r.LogType.bidi,"Disable failed",z)})}}async toggleNetworkIfNeeded(){var j;try{await Promise.all([this.toggleSetCacheDisabled(),this.toggleFetchIfNeeded()])}catch(B){if((j=c(this,_))==null||j.call(this,r.LogType.debugError,B),!P(this,C,aS).call(this,B))throw B}}async toggleSetCacheDisabled(j){var z;const B=c(this,y).defaultCacheBehavior==="bypass",D=j??B;if(c(this,A)!==D){x(this,A,D);try{await c(this,u).sendCommand("Network.setCacheDisabled",{cacheDisabled:D})}catch(G){if((z=c(this,_))==null||z.call(this,r.LogType.debugError,G),x(this,A,!D),!P(this,C,aS).call(this,G))throw G}}}async toggleDeviceAccessIfNeeded(){var B;const j=this.isSubscribedTo(n.Bluetooth.EventNames.RequestDevicePromptUpdated);if(c(this,v)!==j){x(this,v,j);try{await c(this,u).sendCommand(j?"DeviceAccess.enable":"DeviceAccess.disable")}catch(D){if((B=c(this,_))==null||B.call(this,r.LogType.debugError,D),x(this,v,!j),!P(this,C,aS).call(this,D))throw D}}}async toggleNetwork(){var z;const j=c(this,y).getInterceptionStages(this.topLevelId),B=Object.values(j).some(G=>G),D=c(this,k).request!==j.request||c(this,k).response!==j.response||c(this,k).auth!==j.auth;(z=c(this,_))==null||z.call(this,r.LogType.debugInfo,"Toggle Network",`Fetch (${B}) ${D}`),B&&D&&await P(this,C,n4).call(this,j),!B&&D&&await P(this,C,s4).call(this)}getChannels(){return c(this,p).find().flatMap(j=>j.channels)}get topLevelId(){return c(this,m).findTopLevelContextId(this.id)??this.id}isSubscribedTo(j){return c(this,f).subscriptionManager.isSubscribedTo(j,this.topLevelId)}},o=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,S=new WeakMap,_=new WeakMap,v=new WeakMap,A=new WeakMap,k=new WeakMap,C=new WeakSet,t4=async function(){var j;try{await Promise.all([c(this,u).sendCommand("Page.enable"),c(this,u).sendCommand("Page.getFrameTree").then(B=>P(this,C,a1).call(this,B.frameTree)),c(this,u).sendCommand("Runtime.enable"),c(this,u).sendCommand("Page.setLifecycleEventsEnabled",{enabled:!0}),c(this,u).sendCommand("Page.setPrerenderingAllowed",{isAllowed:!c(this,g)}).catch(()=>{}),c(this,u).sendCommand("Network.enable").then(()=>this.toggleNetworkIfNeeded()),c(this,u).sendCommand("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0}),P(this,C,i4).call(this),c(this,u).sendCommand("Runtime.runIfWaitingForDebugger"),c(this,d).sendCommand("Runtime.runIfWaitingForDebugger"),this.toggleDeviceAccessIfNeeded()])}catch(B){if((j=c(this,_))==null||j.call(this,r.LogType.debugError,"Failed to unblock target",B),!c(this,u).isCloseError(B)){c(this,w).resolve({kind:"error",error:B});return}}c(this,w).resolve({kind:"success",value:void 0})},a1=function(j){var z;const B=j.frame,D=c(this,m).findContext(B.id);if(D!==void 0&&D.parentId===null&&B.parentId!==null&&B.parentId!==void 0&&(D.parentId=B.parentId),D===void 0&&B.parentId!==void 0){const G=c(this,m).getContext(B.parentId);s.BrowsingContextImpl.create(B.id,B.parentId,G.userContext,G.cdpTarget,c(this,f),c(this,m),c(this,h),B.url,void 0,c(this,S),c(this,_))}(z=j.childFrames)==null||z.map(G=>P(this,C,a1).call(this,G))},aS=function(j){const B=j;return B.code===-32001&&B.message==="Session with given id not found."||c(this,u).isCloseError(j)},r4=function(){c(this,u).on("Network.requestWillBeSent",j=>{j.loaderId===j.requestId&&this.emit("frameStartedNavigating",{loaderId:j.loaderId,url:j.request.url,frameId:j.frameId})}),c(this,u).on("*",(j,B)=>{typeof j=="string"&&(c(this,f).registerEvent({type:"event",method:`goog:cdp.${j}`,params:{event:j,params:B,session:this.cdpSessionId}},this.id),c(this,f).registerEvent({type:"event",method:`cdp.${j}`,params:{event:j,params:B,session:this.cdpSessionId}},this.id))})},n4=async function(j){const B=[];if((j.request||j.auth)&&B.push({urlPattern:"*",requestStage:"Request"}),j.response&&B.push({urlPattern:"*",requestStage:"Response"}),B.length){const D=c(this,k);x(this,k,j);try{await c(this,u).sendCommand("Fetch.enable",{patterns:B,handleAuthRequests:j.auth})}catch{x(this,k,D)}}},s4=async function(){c(this,y).getRequestsByTarget(this).filter(B=>B.interceptPhase).length===0&&(x(this,k,{request:!1,response:!1,auth:!1}),await c(this,u).sendCommand("Fetch.disable"))},i4=async function(){await Promise.all(c(this,p).find({targetId:this.topLevelId,global:!0}).map(j=>j.initInTarget(this,!0)))},U);return Jm.CdpTarget=a,Jm}var J2;function Xee(){var a,o,u,l,d,h,f,p,m,g,y,w,S,_,v,oS,a4,o4,c4,u4,l4,cS,O,o1,d4,h4,f4,F;if(J2)return Hm;J2=1,Object.defineProperty(Hm,"__esModule",{value:!0}),Hm.CdpTargetManager=void 0;const n=hs(),e=W2(),t=Vee(),r=Jee(),s={service_worker:"service-worker",shared_worker:"shared-worker",worker:"dedicated-worker"};let i=(F=class{constructor(B,D,z,G,te,V,K,ae,ve,de,et,we,R){b(this,v);b(this,a);b(this,o);b(this,u,new Set);b(this,l);b(this,d);b(this,h);b(this,f);b(this,p);b(this,m);b(this,g);b(this,y);b(this,w);b(this,S);b(this,_);b(this,O,new Map);x(this,o,B),x(this,a,D),c(this,u).add(z),x(this,l,z),x(this,d,G),x(this,h,te),x(this,m,ve),x(this,f,K),x(this,p,ae),x(this,g,V),x(this,y,de),x(this,_,et),x(this,S,we),x(this,w,R),P(this,v,oS).call(this,D)}},a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,S=new WeakMap,_=new WeakMap,v=new WeakSet,oS=function(B){B.on("Target.attachedToTarget",D=>{P(this,v,u4).call(this,D,B)}),B.on("Target.detachedFromTarget",P(this,v,d4).bind(this)),B.on("Target.targetInfoChanged",P(this,v,h4).bind(this)),B.on("Inspector.targetCrashed",()=>{P(this,v,f4).call(this,B)}),B.on("Page.frameAttached",P(this,v,a4).bind(this)),B.on("Page.frameDetached",P(this,v,o4).bind(this)),B.on("Page.frameSubtreeWillBeDetached",P(this,v,c4).bind(this))},a4=function(B){const D=c(this,h).findContext(B.parentFrameId);D!==void 0&&e.BrowsingContextImpl.create(B.frameId,B.parentFrameId,D.userContext,D.cdpTarget,c(this,d),c(this,h),c(this,g),"about:blank",void 0,c(this,S),c(this,w))},o4=function(B){var D;B.reason!=="swap"&&((D=c(this,h).findContext(B.frameId))==null||D.dispose(!0))},c4=function(B){var D;(D=c(this,h).findContext(B.frameId))==null||D.dispose(!0)},u4=function(B,D){const{sessionId:z,targetInfo:G}=B,te=c(this,o).getCdpClient(z),V=async()=>{await te.sendCommand("Runtime.runIfWaitingForDebugger").then(()=>D.sendCommand("Target.detachFromTarget",B)).catch(ae=>{var ve;return(ve=c(this,w))==null?void 0:ve.call(this,n.LogType.debugError,ae)})};if(c(this,l)===G.targetId){V();return}const K=G.type==="service_worker"?`${D.sessionId}_${G.targetId}`:G.targetId;if(!c(this,u).has(K)){switch(c(this,u).add(K),G.type){case"tab":P(this,v,oS).call(this,te),(async()=>await te.sendCommand("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0}))();return;case"page":case"iframe":{const ae=P(this,v,cS).call(this,te,D,G),ve=c(this,h).findContext(G.targetId);if(ve&&G.type==="iframe")ve.updateCdpTarget(ae);else{const de=P(this,v,l4).call(this,G,D.sessionId),et=G.browserContextId&&G.browserContextId!==c(this,y)?G.browserContextId:"default";e.BrowsingContextImpl.create(G.targetId,de,et,ae,c(this,d),c(this,h),c(this,g),G.url===""?"about:blank":G.url,G.openerFrameId??G.openerId,c(this,S),c(this,w))}return}case"service_worker":case"worker":{const ae=c(this,g).findRealm({cdpSessionId:D.sessionId});if(!ae){V();return}const ve=P(this,v,cS).call(this,te,D,G);P(this,v,o1).call(this,s[G.type],ve,ae);return}case"shared_worker":{const ae=P(this,v,cS).call(this,te,D,G);P(this,v,o1).call(this,s[G.type],ae);return}}V()}},l4=function(B,D){var G;if(B.type!=="iframe")return null;const z=B.openerFrameId??B.openerId;return z!==void 0?z:D!==void 0?((G=c(this,h).findContextBySession(D))==null?void 0:G.id)??null:null},cS=function(B,D,z){P(this,v,oS).call(this,B);const G=r.CdpTarget.create(z.targetId,B,c(this,a),D,c(this,g),c(this,d),c(this,m),c(this,h),c(this,f),c(this,_),c(this,S),c(this,w));return c(this,f).onCdpTargetCreated(G),c(this,p).onCdpTargetCreated(G),G},O=new WeakMap,o1=function(B,D,z){D.cdpClient.on("Runtime.executionContextCreated",G=>{const{uniqueId:te,id:V,origin:K}=G.context,ae=new t.WorkerRealm(D.cdpClient,c(this,d),V,c(this,w),(0,e.serializeOrigin)(K),z?[z]:[],te,c(this,g),B);c(this,O).set(D.cdpSessionId,ae)})},d4=function({sessionId:B,targetId:D}){D&&c(this,m).find({targetId:D}).map(te=>{te.dispose(D)});const z=c(this,h).findContextBySession(B);if(z){z.dispose(!0);return}const G=c(this,O).get(B);G&&c(this,g).deleteRealms({cdpSessionId:G.cdpClient.sessionId})},h4=function(B){const D=c(this,h).findContext(B.targetInfo.targetId);D&&D.onTargetInfoChanged(B)},f4=function(B){const D=c(this,g).findRealms({cdpSessionId:B.sessionId});for(const z of D)z.dispose()},F);return Hm.CdpTargetManager=i,Hm}var Qm={},X2;function Yee(){var r,s,i;if(X2)return Qm;X2=1,Object.defineProperty(Qm,"__esModule",{value:!0}),Qm.BrowsingContextStorage=void 0;const n=Nt(),e=xd();let t=(i=class{constructor(){b(this,r,new Map);b(this,s,new e.EventEmitter)}getTopLevelContexts(){return this.getAllContexts().filter(o=>o.isTopLevelContext())}getAllContexts(){return Array.from(c(this,r).values())}deleteContextById(o){c(this,r).delete(o)}deleteContext(o){c(this,r).delete(o.id)}addContext(o){c(this,r).set(o.id,o),c(this,s).emit("added",{browsingContext:o})}waitForContext(o){return c(this,r).has(o)?Promise.resolve(this.getContext(o)):new Promise(u=>{const l=d=>{d.browsingContext.id===o&&(c(this,s).off("added",l),u(d.browsingContext))};c(this,s).on("added",l)})}hasContext(o){return c(this,r).has(o)}findContext(o){return c(this,r).get(o)}findTopLevelContextId(o){if(o===null)return null;const u=this.findContext(o);if(!u)return null;const l=u.parentId??null;return l===null?o:this.findTopLevelContextId(l)}findContextBySession(o){for(const u of c(this,r).values())if(u.cdpTarget.cdpSessionId===o)return u}getContext(o){const u=this.findContext(o);if(u===void 0)throw new n.NoSuchFrameException(`Context ${o} not found`);return u}verifyTopLevelContextsList(o){const u=new Set;if(!o)return u;for(const l of o){const d=this.getContext(l);if(d.isTopLevelContext())u.add(d);else throw new n.InvalidArgumentException(`Non top-level context '${l}' given.`)}return u}},r=new WeakMap,s=new WeakMap,i);return Qm.BrowsingContextStorage=t,Qm}var eg={},tg={},rg={},Y2;function Q2(){var e,t;if(Y2)return rg;Y2=1,Object.defineProperty(rg,"__esModule",{value:!0}),rg.DefaultMap=void 0;let n=(t=class extends Map{constructor(i,a){super(a);b(this,e);x(this,e,i)}get(i){return this.has(i)||this.set(i,c(this,e).call(this,i)),super.get(i)}},e=new WeakMap,t);return rg.DefaultMap=n,rg}var eB;function Qee(){var h,f,p,m,g,y,w,S,_,v,A,k,C,E,N,I,c1,p4,m4,g4,y4,Qw,df,u1,w4,b4,_4,l1,hf,$a,uS,d1,ff,pf,mf,lS,v4,S4,x4,E4,k4,C4,P4,dS,le,A4;if(eB)return tg;eB=1;var n;Object.defineProperty(tg,"__esModule",{value:!0}),tg.NetworkRequest=void 0;const e=Nt(),t=Mc(),r=Q2(),s=h0(),i=hs(),a=l0(),o=new RegExp('(?<=realm=").*(?=")');let u=(h=class{constructor(H,ee,oe,be,$e=0,ze){b(this,I);b(this,f);b(this,p);b(this,m);b(this,g,!1);b(this,y);b(this,w,{});b(this,S);b(this,_);b(this,v,{});b(this,A);b(this,k);b(this,C);b(this,E);b(this,N,{[e.ChromiumBidi.Network.EventNames.AuthRequired]:!1,[e.ChromiumBidi.Network.EventNames.BeforeRequestSent]:!1,[e.ChromiumBidi.Network.EventNames.FetchError]:!1,[e.ChromiumBidi.Network.EventNames.ResponseCompleted]:!1,[e.ChromiumBidi.Network.EventNames.ResponseStarted]:!1});Z(this,"waitNextPhase",new s.Deferred);x(this,f,H),x(this,A,ee),x(this,k,oe),x(this,C,be),x(this,y,$e),x(this,E,ze)}get id(){return c(this,f)}get fetchId(){return c(this,p)}get interceptPhase(){return c(this,m)}get url(){var oe,be,$e,ze,It,Ot,On,Pr;const H=((oe=c(this,w).info)==null?void 0:oe.request.urlFragment)??((be=c(this,w).paused)==null?void 0:be.request.urlFragment)??"";return`${(($e=c(this,v).paused)==null?void 0:$e.request.url)??((ze=c(this,S))==null?void 0:ze.url)??((It=c(this,v).info)==null?void 0:It.url)??((Ot=c(this,w).auth)==null?void 0:Ot.request.url)??((On=c(this,w).info)==null?void 0:On.request.url)??((Pr=c(this,w).paused)==null?void 0:Pr.request.url)??n.unknownParameter}${H}`}get redirectCount(){return c(this,y)}get cdpTarget(){return c(this,C)}get cdpClient(){return c(this,C).cdpClient}isRedirecting(){return!!c(this,w).info}handleRedirect(H){c(this,v).hasExtraInfo=!1,c(this,v).info=H.redirectResponse,P(this,I,$a).call(this,{wasRedirected:!0})}onRequestWillBeSentEvent(H){c(this,w).info=H,P(this,I,$a).call(this)}onRequestWillBeSentExtraInfoEvent(H){c(this,w).extraInfo=H,P(this,I,$a).call(this)}onResponseReceivedExtraInfoEvent(H){H.statusCode>=300&&H.statusCode<=399&&c(this,w).info&&H.headers.location===c(this,w).info.request.url||(c(this,v).extraInfo=H,P(this,I,$a).call(this))}onResponseReceivedEvent(H){c(this,v).hasExtraInfo=H.hasExtraInfo,c(this,v).info=H.response,P(this,I,$a).call(this)}onServedFromCache(){x(this,g,!0),P(this,I,$a).call(this)}onLoadingFailedEvent(H){P(this,I,$a).call(this,{hasFailed:!0}),P(this,I,pf).call(this,()=>({method:e.ChromiumBidi.Network.EventNames.FetchError,params:{...P(this,I,mf).call(this),errorText:H.errorText}}))}async failRequest(H){(0,t.assert)(c(this,p),"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.failRequest",{requestId:c(this,p),errorReason:H}),x(this,m,void 0)}onRequestPaused(H){x(this,p,H.requestId),H.responseStatusCode||H.responseErrorReason?(c(this,v).paused=H,P(this,I,hf).call(this,"responseStarted")&&!c(this,N)[e.ChromiumBidi.Network.EventNames.ResponseStarted]&&c(this,p)!==this.id?x(this,m,"responseStarted"):P(this,I,d1).call(this)):(c(this,w).paused=H,P(this,I,hf).call(this,"beforeRequestSent")&&!c(this,N)[e.ChromiumBidi.Network.EventNames.BeforeRequestSent]&&c(this,p)!==this.id?x(this,m,"beforeRequestSent"):P(this,I,uS).call(this)),P(this,I,$a).call(this)}onAuthRequired(H){x(this,p,H.requestId),c(this,w).auth=H,P(this,I,hf).call(this,"authRequired")&&c(this,p)!==this.id?x(this,m,"authRequired"):P(this,I,ff).call(this,{response:"Default"}),P(this,I,pf).call(this,()=>({method:e.ChromiumBidi.Network.EventNames.AuthRequired,params:{...P(this,I,mf).call(this,"authRequired"),response:P(this,I,lS).call(this)}}))}async continueRequest(H={}){const ee=P(this,I,dS).call(this,H.headers,H.cookies),oe=(0,a.cdpFetchHeadersFromBidiNetworkHeaders)(ee),be=l(H.body);await P(this,I,uS).call(this,{url:H.url,method:H.method,headers:oe,postData:be}),x(this,S,{url:H.url,method:H.method,headers:H.headers,cookies:H.cookies,bodySize:d(H.body)})}async continueResponse(H={}){var ee,oe,be;if(this.interceptPhase==="authRequired")if(H.credentials)await Promise.all([this.waitNextPhase,await P(this,I,ff).call(this,{response:"ProvideCredentials",username:H.credentials.username,password:H.credentials.password})]);else return await P(this,I,ff).call(this,{response:"ProvideCredentials"});if(c(this,m)==="responseStarted"){const $e=P(this,I,dS).call(this,H.headers,H.cookies),ze=(0,a.cdpFetchHeadersFromBidiNetworkHeaders)($e);await P(this,I,d1).call(this,{responseCode:H.statusCode??((ee=c(this,v).paused)==null?void 0:ee.responseStatusCode),responsePhrase:H.reasonPhrase??((oe=c(this,v).paused)==null?void 0:oe.responseStatusText),responseHeaders:ze??((be=c(this,v).paused)==null?void 0:be.responseHeaders)}),x(this,_,{statusCode:H.statusCode,headers:$e})}}async continueWithAuth(H){let ee,oe;if(H.action==="provideCredentials"){const{credentials:$e}=H;ee=$e.username,oe=$e.password}const be=(0,a.cdpAuthChallengeResponseFromBidiAuthContinueWithAuthAction)(H.action);await P(this,I,ff).call(this,{response:be,username:ee,password:oe})}async provideResponse(H){if((0,t.assert)(c(this,p),"Network Interception not set-up."),this.interceptPhase==="authRequired")return await P(this,I,ff).call(this,{response:"ProvideCredentials"});if(!H.body&&!H.headers)return await P(this,I,uS).call(this);const ee=P(this,I,dS).call(this,H.headers,H.cookies),oe=(0,a.cdpFetchHeadersFromBidiNetworkHeaders)(ee),be=H.statusCode??c(this,I,df)??200;await this.cdpClient.sendCommand("Fetch.fulfillRequest",{requestId:c(this,p),responseCode:be,responsePhrase:H.reasonPhrase,responseHeaders:oe,body:l(H.body)}),x(this,m,void 0)}dispose(){this.waitNextPhase.reject(new Error("waitNextPhase disposed"))}},f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,S=new WeakMap,_=new WeakMap,v=new WeakMap,A=new WeakMap,k=new WeakMap,C=new WeakMap,E=new WeakMap,N=new WeakMap,I=new WeakSet,c1=function(){return this.url.startsWith("data:")},p4=function(){var H,ee,oe,be,$e;return((H=c(this,S))==null?void 0:H.method)??((ee=c(this,w).info)==null?void 0:ee.request.method)??((oe=c(this,w).paused)==null?void 0:oe.request.method)??((be=c(this,w).auth)==null?void 0:be.request.method)??(($e=c(this,v).paused)==null?void 0:$e.request.method)},m4=function(){return!c(this,w).info||!c(this,w).info.loaderId||c(this,w).info.loaderId!==c(this,w).info.requestId?null:c(this,k).getNavigationId(c(this,I,Qw)??void 0)},g4=function(){let H=[];return c(this,w).extraInfo&&(H=c(this,w).extraInfo.associatedCookies.filter(({blockedReasons:ee})=>!Array.isArray(ee)||ee.length===0).map(({cookie:ee})=>(0,a.cdpToBiDiCookie)(ee))),H},y4=function(){var ee,oe;let H=0;return typeof((ee=c(this,S))==null?void 0:ee.bodySize)=="number"?H=c(this,S).bodySize:H=(0,a.bidiBodySizeFromCdpPostDataEntries)(((oe=c(this,w).info)==null?void 0:oe.request.postDataEntries)??[]),H},Qw=function(){var H,ee,oe,be;return((H=c(this,v).paused)==null?void 0:H.frameId)??((ee=c(this,w).info)==null?void 0:ee.frameId)??((oe=c(this,w).paused)==null?void 0:oe.frameId)??((be=c(this,w).auth)==null?void 0:be.frameId)??null},df=function(){var H,ee,oe,be;return((H=c(this,_))==null?void 0:H.statusCode)??((ee=c(this,v).paused)==null?void 0:ee.responseStatusCode)??((oe=c(this,v).extraInfo)==null?void 0:oe.statusCode)??((be=c(this,v).info)==null?void 0:be.status)},u1=function(){var ee,oe,be;let H=[];if((ee=c(this,S))!=null&&ee.headers){const $e=new r.DefaultMap(()=>[]);for(const ze of c(this,S).headers)$e.get(ze.name).push(ze.value.value);for(const[ze,It]of $e.entries())H.push({name:ze,value:{type:"string",value:It.join(`
`).trimEnd()}})}else H=[...(0,a.bidiNetworkHeadersFromCdpNetworkHeaders)((oe=c(this,w).info)==null?void 0:oe.request.headers),...(0,a.bidiNetworkHeadersFromCdpNetworkHeaders)((be=c(this,w).extraInfo)==null?void 0:be.headers)];return H},w4=function(){var oe;if(!c(this,v).info||!(c(this,I,df)===401||c(this,I,df)===407))return;const H=c(this,I,df)===401?"WWW-Authenticate":"Proxy-Authenticate",ee=[];for(const[be,$e]of Object.entries(c(this,v).info.headers))be.localeCompare(H,void 0,{sensitivity:"base"})===0&&ee.push({scheme:$e.split(" ").at(0)??"",realm:((oe=$e.match(o))==null?void 0:oe.at(0))??""});return ee},b4=function(){var ee,oe,be,$e,ze,It,Ot,On,Pr,Na,Bw,Uw,qw,Kw,HB,WB,zB,VB,GB,ZB,JB,XB;const H=(0,a.getTiming)((0,a.getTiming)((oe=(ee=c(this,v).info)==null?void 0:ee.timing)==null?void 0:oe.requestTime)-(0,a.getTiming)((be=c(this,w).info)==null?void 0:be.timestamp));return{timeOrigin:Math.round((0,a.getTiming)(($e=c(this,w).info)==null?void 0:$e.wallTime)*1e3),requestTime:0,redirectStart:0,redirectEnd:0,fetchStart:(0,a.getTiming)((It=(ze=c(this,v).info)==null?void 0:ze.timing)==null?void 0:It.workerFetchStart,H),dnsStart:(0,a.getTiming)((On=(Ot=c(this,v).info)==null?void 0:Ot.timing)==null?void 0:On.dnsStart,H),dnsEnd:(0,a.getTiming)((Na=(Pr=c(this,v).info)==null?void 0:Pr.timing)==null?void 0:Na.dnsEnd,H),connectStart:(0,a.getTiming)((Uw=(Bw=c(this,v).info)==null?void 0:Bw.timing)==null?void 0:Uw.connectStart,H),connectEnd:(0,a.getTiming)((Kw=(qw=c(this,v).info)==null?void 0:qw.timing)==null?void 0:Kw.connectEnd,H),tlsStart:(0,a.getTiming)((WB=(HB=c(this,v).info)==null?void 0:HB.timing)==null?void 0:WB.sslStart,H),requestStart:(0,a.getTiming)((VB=(zB=c(this,v).info)==null?void 0:zB.timing)==null?void 0:VB.sendStart,H),responseStart:(0,a.getTiming)((ZB=(GB=c(this,v).info)==null?void 0:GB.timing)==null?void 0:ZB.receiveHeadersStart,H),responseEnd:(0,a.getTiming)((XB=(JB=c(this,v).info)==null?void 0:JB.timing)==null?void 0:XB.receiveHeadersEnd,H)}},_4=function(){this.waitNextPhase.resolve(),this.waitNextPhase=new s.Deferred},l1=function(H){return c(this,C).isSubscribedTo(`network.${H}`)?c(this,k).getInterceptsForPhase(this,H):new Set},hf=function(H){return P(this,I,l1).call(this,H).size>0},$a=function(H={}){const ee=H.wasRedirected||H.hasFailed||P(this,I,c1).call(this)||!!c(this,w).extraInfo||c(this,g)||!!(c(this,v).info&&!c(this,v).hasExtraInfo),oe=P(this,I,c1).call(this)||c(this,g),be=!oe&&P(this,I,hf).call(this,"beforeRequestSent"),$e=!be||be&&!!c(this,w).paused;c(this,w).info&&(be?$e:ee)&&P(this,I,pf).call(this,P(this,I,E4).bind(this));const ze=!!c(this,v).extraInfo||c(this,g)||!!(c(this,v).info&&!c(this,v).hasExtraInfo),It=!oe&&P(this,I,hf).call(this,"responseStarted");(c(this,v).info||It&&c(this,v).paused)&&P(this,I,pf).call(this,P(this,I,k4).bind(this));const Ot=!It||It&&!!c(this,v).paused;c(this,v).info&&ze&&Ot&&(P(this,I,pf).call(this,P(this,I,C4).bind(this)),c(this,k).deleteRequest(this.id))},uS=async function(H={}){(0,t.assert)(c(this,p),"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.continueRequest",{requestId:c(this,p),url:H.url,method:H.method,headers:H.headers,postData:H.postData}),x(this,m,void 0)},d1=async function({responseCode:H,responsePhrase:ee,responseHeaders:oe}={}){(0,t.assert)(c(this,p),"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.continueResponse",{requestId:c(this,p),responseCode:H,responsePhrase:ee,responseHeaders:oe}),x(this,m,void 0)},ff=async function(H){(0,t.assert)(c(this,p),"Network Interception not set-up."),await this.cdpClient.sendCommand("Fetch.continueWithAuth",{requestId:c(this,p),authChallengeResponse:H}),x(this,m,void 0)},pf=function(H){var oe;let ee;try{ee=H()}catch(be){(oe=c(this,E))==null||oe.call(this,i.LogType.debugError,be);return}P(this,I,P4).call(this)||c(this,N)[ee.method]&&ee.method!==e.ChromiumBidi.Network.EventNames.AuthRequired||(P(this,I,_4).call(this),c(this,N)[ee.method]=!0,c(this,I,Qw)?c(this,A).registerEvent(Object.assign(ee,{type:"event"}),c(this,I,Qw)):c(this,A).registerGlobalEvent(Object.assign(ee,{type:"event"})))},mf=function(H){var oe;const ee={isBlocked:!1};if(H){const be=P(this,I,l1).call(this,H);ee.isBlocked=be.size>0,ee.isBlocked&&(ee.intercepts=[...be])}return{context:c(this,I,Qw),navigation:c(this,I,m4),redirectCount:c(this,y),request:P(this,I,v4).call(this),timestamp:Math.round((0,a.getTiming)((oe=c(this,w).info)==null?void 0:oe.wallTime)*1e3),...ee}},lS=function(){var be,$e,ze,It,Ot,On,Pr,Na,Bw,Uw,qw,Kw;(be=c(this,v).info)!=null&&be.fromDiskCache&&(c(this,v).extraInfo=void 0);const H=[...(0,a.bidiNetworkHeadersFromCdpNetworkHeaders)(($e=c(this,v).info)==null?void 0:$e.headers),...(0,a.bidiNetworkHeadersFromCdpNetworkHeaders)((ze=c(this,v).extraInfo)==null?void 0:ze.headers)],ee=c(this,I,w4);return{...{url:this.url,protocol:((It=c(this,v).info)==null?void 0:It.protocol)??"",status:c(this,I,df)??-1,statusText:((Ot=c(this,v).info)==null?void 0:Ot.statusText)||((On=c(this,v).paused)==null?void 0:On.responseStatusText)||"",fromCache:((Pr=c(this,v).info)==null?void 0:Pr.fromDiskCache)||((Na=c(this,v).info)==null?void 0:Na.fromPrefetchCache)||c(this,g),headers:((Bw=c(this,_))==null?void 0:Bw.headers)??H,mimeType:((Uw=c(this,v).info)==null?void 0:Uw.mimeType)||"",bytesReceived:((qw=c(this,v).info)==null?void 0:qw.encodedDataLength)||0,headersSize:(0,a.computeHeadersSize)(H),bodySize:0,content:{size:0},...ee?{authChallenges:ee}:{}},"goog:securityDetails":(Kw=c(this,v).info)==null?void 0:Kw.securityDetails}},v4=function(){var oe,be,$e,ze,It,Ot;const H=c(this,I,u1);return{...{request:c(this,f),url:this.url,method:c(this,I,p4)??n.unknownParameter,headers:H,cookies:c(this,I,g4),headersSize:(0,a.computeHeadersSize)(H),bodySize:c(this,I,y4),destination:P(this,I,S4).call(this),initiatorType:P(this,I,x4).call(this),timings:c(this,I,b4)},"goog:postData":(be=(oe=c(this,w).info)==null?void 0:oe.request)==null?void 0:be.postData,"goog:hasPostData":(ze=($e=c(this,w).info)==null?void 0:$e.request)==null?void 0:ze.hasPostData,"goog:resourceType":(It=c(this,w).info)==null?void 0:It.type,"goog:resourceInitiator":(Ot=c(this,w).info)==null?void 0:Ot.initiator}},S4=function(){var H,ee;switch((H=c(this,w).info)==null?void 0:H.type){case"Script":return"script";case"Stylesheet":return"style";case"Image":return"image";case"Document":return((ee=c(this,w).info)==null?void 0:ee.initiator.type)==="parser"?"iframe":"";default:return""}},x4=function(){var H,ee,oe,be,$e,ze,It,Ot,On,Pr;if(((H=c(this,w).info)==null?void 0:H.initiator.type)==="parser")switch((ee=c(this,w).info)==null?void 0:ee.type){case"Document":return"iframe";case"Font":return((be=(oe=c(this,w).info)==null?void 0:oe.initiator)==null?void 0:be.url)===(($e=c(this,w).info)==null?void 0:$e.documentURL)?"font":"css";case"Image":return((It=(ze=c(this,w).info)==null?void 0:ze.initiator)==null?void 0:It.url)===((Ot=c(this,w).info)==null?void 0:Ot.documentURL)?"img":"css";case"Script":return"script";case"Stylesheet":return"link";default:return null}return((Pr=(On=c(this,w))==null?void 0:On.info)==null?void 0:Pr.type)==="Fetch"?"fetch":null},E4=function(){var H;return(0,t.assert)(c(this,w).info,"RequestWillBeSentEvent is not set"),{method:e.ChromiumBidi.Network.EventNames.BeforeRequestSent,params:{...P(this,I,mf).call(this,"beforeRequestSent"),initiator:{type:P(H=n,le,A4).call(H,c(this,w).info.initiator.type),columnNumber:c(this,w).info.initiator.columnNumber,lineNumber:c(this,w).info.initiator.lineNumber,stackTrace:c(this,w).info.initiator.stack,request:c(this,w).info.initiator.requestId}}}},k4=function(){return{method:e.ChromiumBidi.Network.EventNames.ResponseStarted,params:{...P(this,I,mf).call(this,"responseStarted"),response:P(this,I,lS).call(this)}}},C4=function(){return{method:e.ChromiumBidi.Network.EventNames.ResponseCompleted,params:{...P(this,I,mf).call(this),response:P(this,I,lS).call(this)}}},P4=function(){var ee,oe;const H="/favicon.ico";return((ee=c(this,w).paused)==null?void 0:ee.request.url.endsWith(H))??((oe=c(this,w).info)==null?void 0:oe.request.url.endsWith(H))??!1},dS=function(H,ee){if(!H&&!ee)return;let oe=H;const be=(0,a.networkHeaderFromCookieHeaders)(ee);return be&&!oe&&(oe=c(this,I,u1)),be&&oe&&(oe.filter($e=>$e.name.localeCompare("cookie",void 0,{sensitivity:"base"})!==0),oe.push(be)),oe},le=new WeakSet,A4=function(H){switch(H){case"parser":case"script":case"preflight":return H;default:return"other"}},b(h,le),Z(h,"unknownParameter","UNKNOWN"),h);tg.NetworkRequest=u,n=u;function l(Se){let H;return(Se==null?void 0:Se.type)==="string"?H=btoa(Se.value):(Se==null?void 0:Se.type)==="base64"&&(H=Se.value),H}function d(Se){return(Se==null?void 0:Se.type)==="string"?Se.value.length:(Se==null?void 0:Se.type)==="base64"?atob(Se.value).length:0}return tg}var tB;function ete(){var i,a,o,u,l,d,h,Fi,p;if(tB)return eg;tB=1,Object.defineProperty(eg,"__esModule",{value:!0}),eg.NetworkStorage=void 0;const n=Nt(),e=kd(),t=Qee(),r=l0();let s=(p=class{constructor(g,y,w,S){b(this,h);b(this,i);b(this,a);b(this,o);b(this,u,new Map);b(this,l,new Map);b(this,d,"default");x(this,i,y),x(this,a,g),w.on("Target.detachedFromTarget",({sessionId:_})=>{this.disposeRequestMap(_)}),x(this,o,S)}onCdpTargetCreated(g){const y=g.cdpClient,w=[["Network.requestWillBeSent",S=>{const _=this.getRequestById(S.requestId);_&&_.isRedirecting()?(_.handleRedirect(S),this.deleteRequest(S.requestId),P(this,h,Fi).call(this,S.requestId,g,_.redirectCount+1).onRequestWillBeSentEvent(S)):P(this,h,Fi).call(this,S.requestId,g).onRequestWillBeSentEvent(S)}],["Network.requestWillBeSentExtraInfo",S=>{P(this,h,Fi).call(this,S.requestId,g).onRequestWillBeSentExtraInfoEvent(S)}],["Network.responseReceived",S=>{P(this,h,Fi).call(this,S.requestId,g).onResponseReceivedEvent(S)}],["Network.responseReceivedExtraInfo",S=>{P(this,h,Fi).call(this,S.requestId,g).onResponseReceivedExtraInfoEvent(S)}],["Network.requestServedFromCache",S=>{P(this,h,Fi).call(this,S.requestId,g).onServedFromCache()}],["Network.loadingFailed",S=>{P(this,h,Fi).call(this,S.requestId,g).onLoadingFailedEvent(S)}],["Fetch.requestPaused",S=>{P(this,h,Fi).call(this,S.networkId??S.requestId,g).onRequestPaused(S)}],["Fetch.authRequired",S=>{let _=this.getRequestByFetchId(S.requestId);_||(_=P(this,h,Fi).call(this,S.requestId,g)),_.onAuthRequired(S)}]];for(const[S,_]of w)y.on(S,_)}getInterceptionStages(g){const y={request:!1,response:!1,auth:!1};for(const w of c(this,l).values())w.contexts&&!w.contexts.includes(g)||(y.request||(y.request=w.phases.includes("beforeRequestSent")),y.response||(y.response=w.phases.includes("responseStarted")),y.auth||(y.auth=w.phases.includes("authRequired")));return y}getInterceptsForPhase(g,y){if(g.url===t.NetworkRequest.unknownParameter)return new Set;const w=new Set;for(const[S,_]of c(this,l).entries())if(!(!_.phases.includes(y)||_.contexts&&!_.contexts.includes(g.cdpTarget.topLevelId))){if(_.urlPatterns.length===0){w.add(S);continue}for(const v of _.urlPatterns)if((0,r.matchUrlPattern)(v,g.url)){w.add(S);break}}return w}disposeRequestMap(g){for(const y of c(this,u).values())y.cdpClient.sessionId===g&&(c(this,u).delete(y.id),y.dispose())}addIntercept(g){const y=(0,e.uuidv4)();return c(this,l).set(y,g),y}removeIntercept(g){if(!c(this,l).has(g))throw new n.NoSuchInterceptException(`Intercept '${g}' does not exist.`);c(this,l).delete(g)}getRequestsByTarget(g){const y=[];for(const w of c(this,u).values())w.cdpTarget===g&&y.push(w);return y}getRequestById(g){return c(this,u).get(g)}getRequestByFetchId(g){for(const y of c(this,u).values())if(y.fetchId===g)return y}addRequest(g){c(this,u).set(g.id,g)}deleteRequest(g){c(this,u).delete(g)}getNavigationId(g){var y;return g===void 0?null:((y=c(this,i).findContext(g))==null?void 0:y.navigationId)??null}set defaultCacheBehavior(g){x(this,d,g)}get defaultCacheBehavior(){return c(this,d)}},i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakSet,Fi=function(g,y,w){let S=this.getRequestById(g);return S||(S=new t.NetworkRequest(g,c(this,a),this,y,w,c(this,o)),this.addRequest(S),S)},p);return eg.NetworkStorage=s,eg}var ng={},rB;function tte(){var e,t;if(rB)return ng;rB=1,Object.defineProperty(ng,"__esModule",{value:!0}),ng.PreloadScriptStorage=void 0;let n=(t=class{constructor(){b(this,e,new Set)}find(s){return s?[...c(this,e)].filter(i=>!!(s.id!==void 0&&s.id===i.id||s.targetId!==void 0&&i.targetIds.has(s.targetId)||s.global!==void 0&&(s.global&&i.contexts===void 0||!s.global&&i.contexts!==void 0))):[...c(this,e)]}add(s){c(this,e).add(s)}remove(s){for(const i of this.find(s))c(this,e).delete(i)}},e=new WeakMap,t);return ng.PreloadScriptStorage=n,ng}var sg={},nB;function rte(){var r,s,i;if(nB)return sg;nB=1,Object.defineProperty(sg,"__esModule",{value:!0}),sg.RealmStorage=void 0;const n=Nt(),e=U2();let t=(i=class{constructor(){b(this,r,new Map);b(this,s,new Map)}get knownHandlesToRealmMap(){return c(this,r)}addRealm(o){c(this,s).set(o.realmId,o)}findRealms(o){return Array.from(c(this,s).values()).filter(u=>!(o.realmId!==void 0&&o.realmId!==u.realmId||o.browsingContextId!==void 0&&!u.associatedBrowsingContexts.map(l=>l.id).includes(o.browsingContextId)||o.sandbox!==void 0&&(!(u instanceof e.WindowRealm)||o.sandbox!==u.sandbox)||o.executionContextId!==void 0&&o.executionContextId!==u.executionContextId||o.origin!==void 0&&o.origin!==u.origin||o.type!==void 0&&o.type!==u.realmType||o.cdpSessionId!==void 0&&o.cdpSessionId!==u.cdpClient.sessionId))}findRealm(o){const u=this.findRealms(o);if(u.length===1)return u[0]}getRealm(o){const u=this.findRealm(o);if(u===void 0)throw new n.NoSuchFrameException(`Realm ${JSON.stringify(o)} not found`);return u}deleteRealms(o){this.findRealms(o).map(u=>{u.dispose(),c(this,s).delete(u.realmId),Array.from(this.knownHandlesToRealmMap.entries()).filter(([,l])=>l===u.realmId).map(([l])=>this.knownHandlesToRealmMap.delete(l))})}},r=new WeakMap,s=new WeakMap,i);return sg.RealmStorage=t,sg}var ig={},ag={},sB;function nte(){var e,t,r;if(sB)return ag;sB=1,Object.defineProperty(ag,"__esModule",{value:!0}),ag.Buffer=void 0;class n{constructor(i,a){b(this,e);b(this,t,[]);b(this,r);x(this,e,i),x(this,r,a)}get(){return c(this,t)}add(i){var a;for(c(this,t).push(i);c(this,t).length>c(this,e);){const o=c(this,t).shift();o!==void 0&&((a=c(this,r))==null||a.call(this,o))}}}return e=new WeakMap,t=new WeakMap,r=new WeakMap,ag.Buffer=n,ag}var og={},iB;function ste(){var e,t,r;if(iB)return og;iB=1,Object.defineProperty(og,"__esModule",{value:!0}),og.IdWrapper=void 0;let n=(e=class{constructor(){b(this,r);x(this,r,++of(e,t)._)}get id(){return c(this,r)}},t=new WeakMap,r=new WeakMap,b(e,t,0),e);return og.IdWrapper=n,og}var Pd={},aB;function ite(){if(aB)return Pd;aB=1,Object.defineProperty(Pd,"__esModule",{value:!0}),Pd.isCdpEvent=e,Pd.isDeprecatedCdpEvent=t,Pd.assertSupportedEvent=r;const n=Nt();function e(s){var i;return((i=s.split(".").at(0))==null?void 0:i.startsWith(n.ChromiumBidi.BiDiModule.Cdp))??!1}function t(s){var i;return((i=s.split(".").at(0))==null?void 0:i.startsWith(n.ChromiumBidi.BiDiModule.DeprecatedCdp))??!1}function r(s){if(!n.ChromiumBidi.EVENT_NAMES.has(s)&&!e(s)&&!t(s))throw new n.InvalidArgumentException(`Unknown event: ${s}`)}return Pd}var co={},oB;function ate(){var u,l,d,hS,f;if(oB)return co;oB=1,Object.defineProperty(co,"__esModule",{value:!0}),co.SubscriptionManager=void 0,co.cartesianProduct=t,co.unrollEvents=r,co.difference=a;const n=Nt(),e=kd();function t(...p){return p.reduce((m,g)=>m.flatMap(y=>g.map(w=>[y,w].flat())))}function r(p){const m=new Set;function g(y){for(const w of y)m.add(w)}for(const y of p)switch(y){case n.ChromiumBidi.BiDiModule.Bluetooth:g(Object.values(n.ChromiumBidi.Bluetooth.EventNames));break;case n.ChromiumBidi.BiDiModule.BrowsingContext:g(Object.values(n.ChromiumBidi.BrowsingContext.EventNames));break;case n.ChromiumBidi.BiDiModule.Log:g(Object.values(n.ChromiumBidi.Log.EventNames));break;case n.ChromiumBidi.BiDiModule.Network:g(Object.values(n.ChromiumBidi.Network.EventNames));break;case n.ChromiumBidi.BiDiModule.Script:g(Object.values(n.ChromiumBidi.Script.EventNames));break;default:m.add(y)}return[...m.values()]}let s=(f=class{constructor(m){b(this,d);b(this,u,[]);b(this,l);x(this,l,m)}getChannelsSubscribedToEvent(m,g){const y=new Map;for(const w of c(this,u))P(this,d,hS).call(this,w,m,g)&&y.set(JSON.stringify(w.channel),w.channel);return Array.from(y.values())}getChannelsSubscribedToEventGlobally(m){const g=new Map;for(const y of c(this,u))P(this,d,hS).call(this,y,m)&&g.set(JSON.stringify(y.channel),y.channel);return Array.from(g.values())}isSubscribedTo(m,g){for(const y of c(this,u))if(P(this,d,hS).call(this,y,m,g))return!0;return!1}subscribe(m,g,y){const w={id:(0,e.uuidv4)(),eventNames:new Set(r(m)),topLevelTraversableIds:new Set(g.map(S=>{const _=c(this,l).findTopLevelContextId(S);if(!_)throw new n.NoSuchFrameException(`Top-level navigable not found for context id ${S}`);return _})),channel:y};return c(this,u).push(w),w}unsubscribe(m,g,y){const w=new Set(r(m));for(const C of g)c(this,l).getContext(C);const S=new Set(g.map(C=>{const E=c(this,l).findTopLevelContextId(C);if(!E)throw new n.NoSuchFrameException(`Top-level navigable not found for context id ${C}`);return E})),_=S.size===0,v=[],A=new Set,k=new Set;for(const C of c(this,u)){if(JSON.stringify(C.channel)!==JSON.stringify(y)){v.push(C);continue}if(i(C.eventNames,w).size===0){v.push(C);continue}if(_){if(C.topLevelTraversableIds.size!==0){v.push(C);continue}const E=new Set(C.eventNames);for(const N of w)E.has(N)&&(A.add(N),E.delete(N));E.size!==0&&v.push({...C,eventNames:E})}else{if(C.topLevelTraversableIds.size===0){v.push(C);continue}const E=new Map;for(const N of C.eventNames)E.set(N,new Set(C.topLevelTraversableIds));for(const N of w){const I=E.get(N);if(I){for(const $ of S)I.has($)&&(k.add($),A.add(N),I.delete($));I.size===0&&E.delete(N)}}for(const[N,I]of E){const $={id:C.id,channel:C.channel,eventNames:new Set([N]),topLevelTraversableIds:I};v.push($)}}}if(!o(A,w))throw new n.InvalidArgumentException("No subscription found");if(!_&&!o(k,S))throw new n.InvalidArgumentException("No subscription found");x(this,u,v)}unsubscribeById(m){}},u=new WeakMap,l=new WeakMap,d=new WeakSet,hS=function(m,g,y){let w=!1;for(const _ of m.eventNames)if(_===g||_===g.split(".").at(0)||_.split(".").at(0)===g){w=!0;break}if(!w)return!1;if(m.topLevelTraversableIds.size===0)return!0;const S=y?c(this,l).findTopLevelContextId(y):null;return!!(S!==null&&m.topLevelTraversableIds.has(S))},f);co.SubscriptionManager=s;function i(p,m){const g=new Set;for(const y of p)m.has(y)&&g.add(y);return g}function a(p,m){const g=new Set;for(const y of p)m.has(y)||g.add(y);return g}function o(p,m){if(p.size!==m.size)return!1;for(const g of p)if(!m.has(g))return!1;return!0}return co}var cB;function ote(){var f,p,m,g,y,w,S,_,v,A,k,eb,E,h1,fS,f1;if(cB)return ig;cB=1;var n;Object.defineProperty(ig,"__esModule",{value:!0}),ig.EventManager=void 0;const e=Nt(),t=nte(),r=Q2(),s=xd(),i=ste(),a=nA(),o=ite(),u=ate();class l{constructor(T,L){b(this,f,new i.IdWrapper);b(this,p);b(this,m);x(this,m,T),x(this,p,L)}get id(){return c(this,f).id}get contextId(){return c(this,p)}get event(){return c(this,m)}}f=new WeakMap,p=new WeakMap,m=new WeakMap;const d=new Map([[e.ChromiumBidi.Log.EventNames.LogEntryAdded,100]]);let h=(k=class extends s.EventEmitter{constructor(L){super();b(this,E);b(this,g,new r.DefaultMap(()=>new Set));b(this,y,new Map);b(this,w,new Map);b(this,S);b(this,_);b(this,v);x(this,_,L),x(this,S,new u.SubscriptionManager(L)),x(this,v,new r.DefaultMap(()=>[]))}get subscriptionManager(){return c(this,S)}addSubscribeHook(L,U){c(this,v).get(L).push(U)}registerEvent(L,U){this.registerPromiseEvent(Promise.resolve({kind:"success",value:L}),U,L.method)}registerGlobalEvent(L){this.registerGlobalPromiseEvent(Promise.resolve({kind:"success",value:L}),L.method)}registerPromiseEvent(L,U,J){const F=new l(L,U),j=c(this,S).getChannelsSubscribedToEvent(J,U);P(this,E,h1).call(this,F,J);for(const B of j)this.emit("event",{message:a.OutgoingMessage.createFromPromise(L,B),event:J}),P(this,E,fS).call(this,F,B,J)}registerGlobalPromiseEvent(L,U){const J=new l(L,null),F=c(this,S).getChannelsSubscribedToEventGlobally(U);P(this,E,h1).call(this,J,U);for(const j of F)this.emit("event",{message:a.OutgoingMessage.createFromPromise(L,j),event:U}),P(this,E,fS).call(this,J,j,U)}async subscribe(L,U,J){for(const z of L)(0,o.assertSupportedEvent)(z);for(const z of U)z!==null&&c(this,_).getContext(z);const F=new Set((0,u.unrollEvents)(L)),j=new Map,B=new Set(U.length?U.map(z=>{const G=c(this,_).findTopLevelContextId(z);if(!G)throw new e.InvalidArgumentException("Invalid context id");return G}):c(this,_).getTopLevelContexts().map(z=>z.id));for(const z of F){const G=new Set(c(this,_).getTopLevelContexts().map(te=>te.id).filter(te=>c(this,S).isSubscribedTo(z,te)));j.set(z,(0,u.difference)(B,G))}const D=c(this,S).subscribe(L,U,J);for(const z of D.eventNames)for(const G of B)for(const te of P(this,E,f1).call(this,z,G,J))this.emit("event",{message:a.OutgoingMessage.createFromPromise(te.event,J),event:z}),P(this,E,fS).call(this,te,J,z);for(const[z,G]of j)for(const te of G)c(this,v).get(z).forEach(V=>V(te));return await this.toggleModulesIfNeeded(),D.id}async unsubscribe(L,U,J){for(const F of L)(0,o.assertSupportedEvent)(F);c(this,S).unsubscribe(L,U,J),await this.toggleModulesIfNeeded()}async toggleModulesIfNeeded(){await Promise.all(c(this,_).getAllContexts().map(async L=>await L.toggleModulesIfNeeded()))}clearBufferedEvents(L){var U;for(const J of d.keys()){const F=P(U=n,A,eb).call(U,J,L);c(this,y).delete(F)}}},g=new WeakMap,y=new WeakMap,w=new WeakMap,S=new WeakMap,_=new WeakMap,v=new WeakMap,A=new WeakSet,eb=function(L,U){return JSON.stringify({eventName:L,browsingContext:U})},E=new WeakSet,h1=function(L,U){var F;if(!d.has(U))return;const J=P(F=n,A,eb).call(F,U,L.contextId);c(this,y).has(J)||c(this,y).set(J,new t.Buffer(d.get(U))),c(this,y).get(J).add(L),c(this,g).get(U).add(L.contextId)},fS=function(L,U,J){var D,z;if(!d.has(J))return;const F=P(D=n,A,eb).call(D,J,L.contextId),j=Math.max(((z=c(this,w).get(F))==null?void 0:z.get(JSON.stringify(U)))??0,L.id),B=c(this,w).get(F);B?B.set(JSON.stringify(U),j):c(this,w).set(F,new Map([[JSON.stringify(U),j]]))},f1=function(L,U,J){var D,z,G;const F=P(D=n,A,eb).call(D,L,U),j=((z=c(this,w).get(F))==null?void 0:z.get(JSON.stringify(J)))??-1/0,B=((G=c(this,y).get(F))==null?void 0:G.get().filter(te=>te.id>j))??[];return U===null&&Array.from(c(this,g).get(L).keys()).filter(te=>te!==null&&c(this,_).hasContext(te)).map(te=>P(this,E,f1).call(this,L,te,J)).forEach(te=>B.push(...te)),B.sort((te,V)=>te.id-V.id)},b(k,A),k);return ig.EventManager=h,n=h,ig}var uB;function cte(){var f,p,m,g,y,w,S,_,v,A,k,C,T4,N;if(uB)return _m;uB=1,Object.defineProperty(_m,"__esModule",{value:!0}),_m.BidiServer=void 0;const n=xd(),e=hs(),t=yee(),r=Uee(),s=qee(),i=Xee(),a=Yee(),o=ete(),u=tte(),l=rte(),d=ote();let h=(N=class extends n.EventEmitter{constructor(O,T,L,U,J,F,j){super();b(this,C);b(this,f);b(this,p);b(this,m);b(this,g);b(this,y,new a.BrowsingContextStorage);b(this,w,new l.RealmStorage);b(this,S,new u.PreloadScriptStorage);b(this,_);b(this,v);b(this,A,O=>{c(this,m).processCommand(O).catch(T=>{var L;(L=c(this,v))==null||L.call(this,e.LogType.debugError,T)})});b(this,k,async O=>{const T={...O.message,...O.channel};await c(this,p).sendMessage(T)});x(this,v,j),x(this,f,new t.ProcessingQueue(c(this,k),c(this,v))),x(this,p,O),c(this,p).setOnMessage(c(this,A)),x(this,g,new d.EventManager(c(this,y)));const B=new o.NetworkStorage(c(this,g),c(this,y),L,j);x(this,_,new s.BluetoothProcessor(c(this,g),c(this,y))),x(this,m,new r.CommandProcessor(T,L,c(this,g),c(this,y),c(this,w),c(this,S),B,c(this,_),F,async D=>{await L.sendCommand("Security.setIgnoreCertificateErrors",{ignore:D.acceptInsecureCerts??!1}),new i.CdpTargetManager(T,L,U,c(this,g),c(this,y),c(this,w),B,c(this,_),c(this,S),J,(D==null?void 0:D["goog:prerenderingDisabled"])??!1,D==null?void 0:D.unhandledPromptBehavior,j),await L.sendCommand("Target.setDiscoverTargets",{discover:!0}),await L.sendCommand("Target.setAutoAttach",{autoAttach:!0,waitForDebuggerOnStart:!0,flatten:!0,filter:[{type:"page",exclude:!0},{}]}),await P(this,C,T4).call(this)},c(this,v))),c(this,g).on("event",({message:D,event:z})=>{this.emitOutgoingMessage(D,z)}),c(this,m).on("response",({message:D,event:z})=>{this.emitOutgoingMessage(D,z)})}static async createAndStart(O,T,L,U,J,F){const[{browserContextIds:j},{targetInfos:B}]=await Promise.all([L.sendCommand("Target.getBrowserContexts"),L.sendCommand("Target.getTargets")]);let D="default";for(const G of B)if(G.browserContextId&&!j.includes(G.browserContextId)){D=G.browserContextId;break}return new N(O,T,L,U,D,J,F)}emitOutgoingMessage(O,T){c(this,f).add(O,T)}close(){c(this,p).close()}},f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,S=new WeakMap,_=new WeakMap,v=new WeakMap,A=new WeakMap,k=new WeakMap,C=new WeakSet,T4=async function(){await Promise.all(c(this,y).getTopLevelContexts().map(O=>O.lifecycleLoaded()))},N);return _m.BidiServer=h,_m}var lB;function ute(){return lB||(lB=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.OutgoingMessage=n.EventEmitter=n.BidiServer=void 0;var e=cte();Object.defineProperty(n,"BidiServer",{enumerable:!0,get:function(){return e.BidiServer}});var t=xd();Object.defineProperty(n,"EventEmitter",{enumerable:!0,get:function(){return t.EventEmitter}});var r=nA();Object.defineProperty(n,"OutgoingMessage",{enumerable:!0,get:function(){return r.OutgoingMessage}})}(YP)),YP}var sA=ute();const Nu=class Nu extends xf{constructor(t,r){super();b(this,zh,!1);b(this,Zo);b(this,Aa,Mt.create());Z(this,"frame");Z(this,"onClose",()=>{Nu.sessions.delete(this.id()),x(this,zh,!0)});if(this.frame=t,!this.frame.page().browser().cdpSupported)return;const s=this.frame.page().browser().connection;x(this,Zo,s),r?(c(this,Aa).resolve(r),Nu.sessions.set(r,this)):(async()=>{try{const{result:i}=await s.send("goog:cdp.getSession",{context:t._id});c(this,Aa).resolve(i.session),Nu.sessions.set(i.session,this)}catch(i){c(this,Aa).reject(i)}})(),Nu.sessions.set(c(this,Aa).value(),this)}connection(){}async send(t,r,s){if(c(this,Zo)===void 0)throw new Fe("CDP support is required for this feature. The current browser does not support CDP.");if(c(this,zh))throw new gs(`Protocol error (${t}): Session closed. Most likely the page has been closed.`);const i=await c(this,Aa).valueOrThrow(),{result:a}=await c(this,Zo).send("goog:cdp.sendCommand",{method:t,params:r,session:i},s==null?void 0:s.timeout);return a.result}async detach(){if(!(c(this,Zo)===void 0||c(this,Zo).closed||c(this,zh)))try{await this.frame.client.send("Target.detachFromTarget",{sessionId:this.id()})}finally{this.onClose()}}id(){const t=c(this,Aa).value();return typeof t=="string"?t:""}};zh=new WeakMap,Zo=new WeakMap,Aa=new WeakMap,Z(Nu,"sessions",new Map);let cg=Nu;/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const lte=nl("puppeteer:webDriverBiDi:SEND "),dte=nl("puppeteer:webDriverBiDi:RECV ");class dB extends xe{constructor(t,r,s=0,i){super();b(this,gw);b(this,Ni);b(this,Vh);b(this,yw,0);b(this,$u,!1);b(this,Ta,new tx);b(this,ww,[]);x(this,gw,t),x(this,Vh,s),x(this,yw,i??18e4),x(this,Ni,r),c(this,Ni).onmessage=this.onMessage.bind(this),c(this,Ni).onclose=this.unbind.bind(this)}get closed(){return c(this,$u)}get url(){return c(this,gw)}pipeTo(t){c(this,ww).push(t)}emit(t,r){for(const s of c(this,ww))s.emit(t,r);return super.emit(t,r)}send(t,r,s){return se(!c(this,$u),"Protocol error: Connection closed."),c(this,Ta).create(t,s??c(this,yw),i=>{const a=JSON.stringify({id:i,method:t,params:r});lte(a),c(this,Ni).send(a)})}async onMessage(t){var s;c(this,Vh)&&await new Promise(i=>setTimeout(i,c(this,Vh))),dte(t);const r=JSON.parse(t);if("type"in r)switch(r.type){case"success":c(this,Ta).resolve(r.id,r);return;case"error":if(r.id===null)break;c(this,Ta).reject(r.id,hte(r),`${r.error}: ${r.message}`);return;case"event":if(fte(r)){(s=cg.sessions.get(r.params.session))==null||s.emit(r.params.event,r.params.params);return}this.emit(r.method,r.params);return}"id"in r&&c(this,Ta).reject(r.id,`Protocol Error. Message is not in BiDi protocol format: '${t}'`,r.message),_e(r)}unbind(){c(this,$u)||(x(this,$u,!0),c(this,Ni).onmessage=()=>{},c(this,Ni).onclose=()=>{},c(this,Ta).clear())}dispose(){this.unbind(),c(this,Ni).close()}getPendingProtocolErrors(){return c(this,Ta).getPendingProtocolErrors()}}gw=new WeakMap,Ni=new WeakMap,Vh=new WeakMap,yw=new WeakMap,$u=new WeakMap,Ta=new WeakMap,ww=new WeakMap;function hte(n){let e=`${n.error} ${n.message}`;return n.stacktrace&&(e+=` ${n.stacktrace}`),e}function fte(n){return n.method.startsWith("goog:cdp.")}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const pte=(n,...e)=>{nl(`bidi:${n}`)(e)};async function mte(n){const e=new yte,t=new gte(n),r={send(a){e.emitMessage(JSON.parse(a))},close(){i.close(),t.close(),n.dispose()},onmessage(a){}};e.on("bidiResponse",a=>{r.onmessage(JSON.stringify(a))});const s=new dB(n.url(),r,n.delay,n.timeout),i=await sA.BidiServer.createAndStart(e,t,t.browserClient(),"",void 0,pte);return s}class gte{constructor(e){b(this,bw);b(this,ju,new Map);b(this,Lu);x(this,bw,e),x(this,Lu,new hB(e))}browserClient(){return c(this,Lu)}getCdpClient(e){const t=c(this,bw).session(e);if(!t)throw new Error(`Unknown CDP session with id ${e}`);if(!c(this,ju).has(t)){const r=new hB(t,e,c(this,Lu));return c(this,ju).set(t,r),r}return c(this,ju).get(t)}close(){c(this,Lu).close();for(const e of c(this,ju).values())e.close()}}bw=new WeakMap,ju=new WeakMap,Lu=new WeakMap;class hB extends sA.EventEmitter{constructor(t,r,s){super();b(this,Gh,!1);b(this,Fu);Z(this,"sessionId");b(this,_w);b(this,vw,(t,r)=>{this.emit(t,r)});x(this,Fu,t),this.sessionId=r,x(this,_w,s),c(this,Fu).on("*",c(this,vw))}browserClient(){return c(this,_w)}async sendCommand(t,...r){if(!c(this,Gh))try{return await c(this,Fu).send(t,...r)}catch(s){if(c(this,Gh))return;throw s}}close(){c(this,Fu).off("*",c(this,vw)),x(this,Gh,!0)}isCloseError(t){return t instanceof gs}}Gh=new WeakMap,Fu=new WeakMap,_w=new WeakMap,vw=new WeakMap;class yte extends sA.EventEmitter{constructor(){super(...arguments);b(this,Zh,async t=>{})}emitMessage(t){c(this,Zh).call(this,t)}setOnMessage(t){x(this,Zh,t)}async sendMessage(t){this.emit("bidiResponse",t)}close(){x(this,Zh,async t=>{})}}Zh=new WeakMap;/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var wte=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},bte=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let _te=(()=>{var r,s,i,a,o,u,I4,pS,O4,f;let n=xe,e=[],t;return f=class extends n{constructor(g){super();b(this,u);b(this,r,wte(this,e));b(this,s);b(this,i);b(this,a,new Xt);b(this,o);x(this,i,g)}static from(g){var w;const y=new f(g);return P(w=y,u,I4).call(w),y}get disposed(){return c(this,a).disposed}get request(){return c(this,r)}get navigation(){return c(this,s)}dispose(){this[Me]()}[(t=[Da],Me)](){c(this,a).dispose(),super[Me]()}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakSet,I4=function(){const g=c(this,a).use(new xe(c(this,i)));g.once("closed",()=>{this.emit("failed",{url:c(this,i).url,timestamp:new Date}),this.dispose()}),g.on("request",({request:w})=>{if(w.navigation===void 0||!P(this,u,pS).call(this,w.navigation))return;x(this,r,w),this.emit("request",w),c(this,a).use(new xe(c(this,r))).on("redirect",_=>{x(this,r,_)})});const y=c(this,a).use(new xe(c(this,u,O4)));y.on("browsingContext.navigationStarted",w=>{w.context!==c(this,i).id||c(this,s)!==void 0||x(this,s,f.from(c(this,i)))});for(const w of["browsingContext.domContentLoaded","browsingContext.load"])y.on(w,S=>{S.context!==c(this,i).id||S.navigation===null||!P(this,u,pS).call(this,S.navigation)||this.dispose()});for(const[w,S]of[["browsingContext.fragmentNavigated","fragment"],["browsingContext.navigationFailed","failed"],["browsingContext.navigationAborted","aborted"]])y.on(w,_=>{_.context!==c(this,i).id||!P(this,u,pS).call(this,_.navigation)||(this.emit(S,{url:_.url,timestamp:new Date(_.timestamp)}),this.dispose())})},pS=function(g){return c(this,s)!==void 0&&!c(this,s).disposed?!1:c(this,o)===void 0?(x(this,o,g),!0):c(this,o)===g},O4=function(){return c(this,i).userContext.browser.session},(()=>{const g=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;bte(f,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:y=>"dispose"in y,get:y=>y.dispose},metadata:g},null,e),g&&Object.defineProperty(f,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:g})})(),f})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var vte=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},ug=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},iA;let aA=(()=>{var o,u;let n=xe,e=[],t,r,s,i,a;return u=class extends n{constructor(h,f){super();b(this,o,vte(this,e));Z(this,"disposables",new Xt);Z(this,"id");Z(this,"origin");Z(this,"executionContextId");this.id=h,this.origin=f}get disposed(){return c(this,o)!==void 0}get target(){return{realm:this.id}}dispose(h){x(this,o,h),this[Me]()}async disown(h){await this.session.send("script.disown",{target:this.target,handles:h})}async callFunction(h,f,p={}){const{result:m}=await this.session.send("script.callFunction",{functionDeclaration:h,awaitPromise:f,target:this.target,...p});return m}async evaluate(h,f,p={}){const{result:m}=await this.session.send("script.evaluate",{expression:h,awaitPromise:f,target:this.target,...p});return m}async resolveExecutionContextId(){if(!this.executionContextId){const{result:h}=await this.session.connection.send("goog:cdp.resolveRealm",{realm:this.id});this.executionContextId=h.executionContextId}return this.executionContextId}[(t=[Da],r=[ue(h=>c(h,o))],s=[ue(h=>c(h,o))],i=[ue(h=>c(h,o))],a=[ue(h=>c(h,o))],Me)](){c(this,o)??x(this,o,"Realm already destroyed, probably because all associated browsing contexts closed."),this.emit("destroyed",{reason:c(this,o)}),this.disposables.dispose(),super[Me]()}},o=new WeakMap,(()=>{const h=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;ug(u,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:f=>"dispose"in f,get:f=>f.dispose},metadata:h},null,e),ug(u,null,r,{kind:"method",name:"disown",static:!1,private:!1,access:{has:f=>"disown"in f,get:f=>f.disown},metadata:h},null,e),ug(u,null,s,{kind:"method",name:"callFunction",static:!1,private:!1,access:{has:f=>"callFunction"in f,get:f=>f.callFunction},metadata:h},null,e),ug(u,null,i,{kind:"method",name:"evaluate",static:!1,private:!1,access:{has:f=>"evaluate"in f,get:f=>f.evaluate},metadata:h},null,e),ug(u,null,a,{kind:"method",name:"resolveExecutionContextId",static:!1,private:!1,access:{has:f=>"resolveExecutionContextId"in f,get:f=>f.resolveExecutionContextId},metadata:h},null,e),h&&Object.defineProperty(u,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:h})})(),u})();const $A=class $A extends aA{constructor(t,r){super("","");b(this,$0);Z(this,"browsingContext");Z(this,"sandbox");b(this,Sw,new Map);this.browsingContext=t,this.sandbox=r}static from(t,r){var i;const s=new $A(t,r);return P(i=s,$0,R4).call(i),s}get session(){return this.browsingContext.userContext.browser.session}get target(){return{context:this.browsingContext.id,sandbox:this.sandbox}}};Sw=new WeakMap,$0=new WeakSet,R4=function(){this.disposables.use(new xe(this.browsingContext)).on("closed",({reason:s})=>{this.dispose(s)});const r=this.disposables.use(new xe(this.session));r.on("script.realmCreated",s=>{s.type!=="window"||s.context!==this.browsingContext.id||s.sandbox!==this.sandbox||(this.id=s.realm,this.origin=s.origin,this.executionContextId=void 0,this.emit("updated",this))}),r.on("script.realmCreated",s=>{if(s.type!=="dedicated-worker"||!s.owners.includes(this.id))return;const i=cA.from(this,s.realm,s.origin);c(this,Sw).set(i.id,i);const a=this.disposables.use(new xe(i));a.once("destroyed",()=>{a.removeAllListeners(),c(this,Sw).delete(i.id)}),this.emit("worker",i)})};let oA=$A;class cA extends aA{constructor(t,r,s){super(r,s);b(this,j0);b(this,xw,new Map);Z(this,"owners");this.owners=new Set([t])}static from(t,r,s){var a;const i=new iA(t,r,s);return P(a=i,j0,M4).call(a),i}get session(){return this.owners.values().next().value.session}}xw=new WeakMap,j0=new WeakSet,M4=function(){const t=this.disposables.use(new xe(this.session));t.on("script.realmDestroyed",r=>{r.realm===this.id&&this.dispose("Realm already destroyed.")}),t.on("script.realmCreated",r=>{if(r.type!=="dedicated-worker"||!r.owners.includes(this.id))return;const s=iA.from(this,r.realm,r.origin);c(this,xw).set(s.id,s),this.disposables.use(new xe(s)).once("destroyed",()=>{c(this,xw).delete(s.id)}),this.emit("worker",s)})},iA=cA;const jA=class jA extends aA{constructor(t,r,s){super(r,s);b(this,L0);b(this,Ew,new Map);Z(this,"browser");this.browser=t}static from(t,r,s){var a;const i=new jA(t,r,s);return P(a=i,L0,N4).call(a),i}get session(){return this.browser.session}};Ew=new WeakMap,L0=new WeakSet,N4=function(){const t=this.disposables.use(new xe(this.session));t.on("script.realmDestroyed",r=>{r.realm===this.id&&this.dispose("Realm already destroyed.")}),t.on("script.realmCreated",r=>{if(r.type!=="dedicated-worker"||!r.owners.includes(this.id))return;const s=cA.from(this,r.realm,r.origin);c(this,Ew).set(s.id,s),this.disposables.use(new xe(s)).once("destroyed",()=>{c(this,Ew).delete(s.id)}),this.emit("worker",s)})};let uA=jA;/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Ste=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},xte=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let Ete=(()=>{var r,s,i,a,o,u,l,$4,Wu,f;let n=xe,e=[],t;return f=class extends n{constructor(g,y){super();b(this,l);b(this,r,Ste(this,e));b(this,s);b(this,i);b(this,a);b(this,o,new Xt);b(this,u);x(this,a,g),x(this,u,y)}static from(g,y){var S;const w=new f(g,y);return P(S=w,l,$4).call(S),w}get disposed(){return c(this,o).disposed}get error(){return c(this,r)}get headers(){return c(this,u).request.headers}get id(){return c(this,u).request.request}get initiator(){return c(this,u).initiator}get method(){return c(this,u).request.method}get navigation(){return c(this,u).navigation??void 0}get redirect(){return c(this,s)}get lastRedirect(){let g=c(this,s);for(;g;){if(g&&!c(g,s))return g;g=c(g,s)}return g}get response(){return c(this,i)}get url(){return c(this,u).request.url}get isBlocked(){return c(this,u).isBlocked}get resourceType(){return c(this,u).request["goog:resourceType"]??void 0}get postData(){return c(this,u).request["goog:postData"]??void 0}get hasPostData(){return c(this,u).request["goog:hasPostData"]??!1}async continueRequest({url:g,method:y,headers:w,cookies:S,body:_}){await c(this,l,Wu).send("network.continueRequest",{request:this.id,url:g,method:y,headers:w,body:_,cookies:S})}async failRequest(){await c(this,l,Wu).send("network.failRequest",{request:this.id})}async provideResponse({statusCode:g,reasonPhrase:y,headers:w,body:S}){await c(this,l,Wu).send("network.provideResponse",{request:this.id,statusCode:g,reasonPhrase:y,headers:w,body:S})}async continueWithAuth(g){g.action==="provideCredentials"?await c(this,l,Wu).send("network.continueWithAuth",{request:this.id,action:g.action,credentials:g.credentials}):await c(this,l,Wu).send("network.continueWithAuth",{request:this.id,action:g.action})}dispose(){this[Me]()}[(t=[Da],Me)](){c(this,o).dispose(),super[Me]()}timing(){return c(this,u).request.timings}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakSet,$4=function(){c(this,o).use(new xe(c(this,a))).once("closed",({reason:w})=>{x(this,r,w),this.emit("error",c(this,r)),this.dispose()});const y=c(this,o).use(new xe(c(this,l,Wu)));y.on("network.beforeRequestSent",w=>{w.context!==c(this,a).id||w.request.request!==this.id||w.redirectCount!==c(this,u).redirectCount+1||(x(this,s,f.from(c(this,a),w)),this.emit("redirect",c(this,s)),this.dispose())}),y.on("network.authRequired",w=>{w.context!==c(this,a).id||w.request.request!==this.id||!w.isBlocked||this.emit("authenticate",void 0)}),y.on("network.fetchError",w=>{w.context!==c(this,a).id||w.request.request!==this.id||c(this,u).redirectCount!==w.redirectCount||(x(this,r,w.errorText),this.emit("error",c(this,r)),this.dispose())}),y.on("network.responseCompleted",w=>{w.context!==c(this,a).id||w.request.request!==this.id||c(this,u).redirectCount!==w.redirectCount||(x(this,i,w.response),c(this,u).request.timings=w.request.timings,this.emit("success",c(this,i)),!(c(this,i).status>=300&&c(this,i).status<400)&&this.dispose())})},Wu=function(){return c(this,a).userContext.browser.session},(()=>{const g=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;xte(f,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:y=>"dispose"in y,get:y=>y.dispose},metadata:g},null,e),g&&Object.defineProperty(f,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:g})})(),f})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var kte=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},fB=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let Cte=(()=>{var s,i,a,o,j4,p1,d;let n=xe,e=[],t,r;return d=class extends n{constructor(p,m){super();b(this,o);b(this,s,kte(this,e));b(this,i);b(this,a,new Xt);Z(this,"browsingContext");Z(this,"info");this.browsingContext=p,this.info=m}static from(p,m){var y;const g=new d(p,m);return P(y=g,o,j4).call(y),g}get closed(){return c(this,s)!==void 0}get disposed(){return this.closed}get handled(){return this.info.handler==="accept"||this.info.handler==="dismiss"?!0:c(this,i)!==void 0}get result(){return c(this,i)}dispose(p){x(this,s,p),this[Me]()}async handle(p={}){return await c(this,o,p1).send("browsingContext.handleUserPrompt",{...p,context:this.info.context}),c(this,i)}[(t=[Da],r=[ue(p=>c(p,s))],Me)](){c(this,s)??x(this,s,"User prompt already closed, probably because the associated browsing context was destroyed."),this.emit("closed",{reason:c(this,s)}),c(this,a).dispose(),super[Me]()}},s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakSet,j4=function(){c(this,a).use(new xe(this.browsingContext)).once("closed",({reason:g})=>{this.dispose(`User prompt already closed: ${g}`)}),c(this,a).use(new xe(c(this,o,p1))).on("browsingContext.userPromptClosed",g=>{g.context===this.browsingContext.id&&(x(this,i,g),this.emit("handled",g),this.dispose("User prompt already handled."))})},p1=function(){return this.browsingContext.userContext.browser.session},(()=>{const p=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;fB(d,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:m=>"dispose"in m,get:m=>m.dispose},metadata:p},null,e),fB(d,null,r,{kind:"method",name:"handle",static:!1,private:!1,access:{has:m=>"handle"in m,get:m=>m.handle},metadata:p},null,e),p&&Object.defineProperty(d,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:p})})(),d})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Pte=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},qt=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let Ate=(()=>{var I,$,O,T,L,U,J,F,L4,Zt,m1,z;let n=xe,e=[],t,r,s,i,a,o,u,l,d,h,f,p,m,g,y,w,S,_,v,A,k,C,E,N;return z=class extends n{constructor(V,K,ae,ve,de){super();b(this,F);b(this,I,Pte(this,e));b(this,$);b(this,O);b(this,T,new Map);b(this,L,new Xt);b(this,U,new Map);b(this,J,new Map);Z(this,"defaultRealm");Z(this,"id");Z(this,"parent");Z(this,"userContext");Z(this,"originalOpener");x(this,O,ve),this.id=ae,this.parent=K,this.userContext=V,this.originalOpener=de,this.defaultRealm=P(this,F,m1).call(this)}static from(V,K,ae,ve,de){var we;const et=new z(V,K,ae,ve,de);return P(we=et,F,L4).call(we),et}get children(){return c(this,T).values()}get closed(){return c(this,$)!==void 0}get disposed(){return this.closed}get realms(){const V=this;return function*(){yield V.defaultRealm,yield*c(V,U).values()}()}get top(){let V=this;for(let{parent:K}=V;K;{parent:K}=V)V=K;return V}get url(){return c(this,O)}dispose(V){x(this,$,V);for(const K of c(this,T).values())K.dispose("Parent browsing context was disposed");this[Me]()}async activate(){await c(this,F,Zt).send("browsingContext.activate",{context:this.id})}async captureScreenshot(V={}){const{result:{data:K}}=await c(this,F,Zt).send("browsingContext.captureScreenshot",{context:this.id,...V});return K}async close(V){await Promise.all([...c(this,T).values()].map(async K=>{await K.close(V)})),await c(this,F,Zt).send("browsingContext.close",{context:this.id,promptUnload:V})}async traverseHistory(V){await c(this,F,Zt).send("browsingContext.traverseHistory",{context:this.id,delta:V})}async navigate(V,K){await c(this,F,Zt).send("browsingContext.navigate",{context:this.id,url:V,wait:K})}async reload(V={}){await c(this,F,Zt).send("browsingContext.reload",{context:this.id,...V})}async setCacheBehavior(V){await c(this,F,Zt).send("network.setCacheBehavior",{contexts:[this.id],cacheBehavior:V})}async print(V={}){const{result:{data:K}}=await c(this,F,Zt).send("browsingContext.print",{context:this.id,...V});return K}async handleUserPrompt(V={}){await c(this,F,Zt).send("browsingContext.handleUserPrompt",{context:this.id,...V})}async setViewport(V={}){await c(this,F,Zt).send("browsingContext.setViewport",{context:this.id,...V})}async performActions(V){await c(this,F,Zt).send("input.performActions",{context:this.id,actions:V})}async releaseActions(){await c(this,F,Zt).send("input.releaseActions",{context:this.id})}createWindowRealm(V){return P(this,F,m1).call(this,V)}async addPreloadScript(V,K={}){return await this.userContext.browser.addPreloadScript(V,{...K,contexts:[this]})}async addIntercept(V){const{result:{intercept:K}}=await this.userContext.browser.session.send("network.addIntercept",{...V,contexts:[this.id]});return K}async removePreloadScript(V){await this.userContext.browser.removePreloadScript(V)}async getCookies(V={}){const{result:{cookies:K}}=await c(this,F,Zt).send("storage.getCookies",{...V,partition:{type:"context",context:this.id}});return K}async setCookie(V){await c(this,F,Zt).send("storage.setCookie",{cookie:V,partition:{type:"context",context:this.id}})}async setFiles(V,K){await c(this,F,Zt).send("input.setFiles",{context:this.id,element:V,files:K})}async subscribe(V){await c(this,F,Zt).subscribe(V,[this.id])}async addInterception(V){await c(this,F,Zt).subscribe(V,[this.id])}[(t=[Da],r=[ue(V=>c(V,$))],s=[ue(V=>c(V,$))],i=[ue(V=>c(V,$))],a=[ue(V=>c(V,$))],o=[ue(V=>c(V,$))],u=[ue(V=>c(V,$))],l=[ue(V=>c(V,$))],d=[ue(V=>c(V,$))],h=[ue(V=>c(V,$))],f=[ue(V=>c(V,$))],p=[ue(V=>c(V,$))],m=[ue(V=>c(V,$))],g=[ue(V=>c(V,$))],y=[ue(V=>c(V,$))],w=[ue(V=>c(V,$))],S=[ue(V=>c(V,$))],_=[ue(V=>c(V,$))],v=[ue(V=>c(V,$))],A=[ue(V=>c(V,$))],k=[ue(V=>c(V,$))],C=[ue(V=>c(V,$))],Me)](){c(this,$)??x(this,$,"Browsing context already closed, probably because the user context closed."),this.emit("closed",{reason:c(this,$)}),c(this,L).dispose(),super[Me]()}async deleteCookie(...V){await Promise.all(V.map(async K=>{await c(this,F,Zt).send("storage.deleteCookies",{filter:K,partition:{type:"context",context:this.id}})}))}async locateNodes(V,K){return(await c(this,F,Zt).send("browsingContext.locateNodes",{context:this.id,locator:V,startNodes:K.length?K:void 0})).result.nodes}},I=new WeakMap,$=new WeakMap,O=new WeakMap,T=new WeakMap,L=new WeakMap,U=new WeakMap,J=new WeakMap,F=new WeakSet,L4=function(){c(this,L).use(new xe(this.userContext)).once("closed",({reason:ae})=>{this.dispose(`Browsing context already closed: ${ae}`)});const K=c(this,L).use(new xe(c(this,F,Zt)));K.on("browsingContext.contextCreated",ae=>{if(ae.parent!==this.id)return;const ve=z.from(this.userContext,this,ae.context,ae.url,ae.originalOpener);c(this,T).set(ae.context,ve);const de=c(this,L).use(new xe(ve));de.once("closed",()=>{de.removeAllListeners(),c(this,T).delete(ve.id)}),this.emit("browsingcontext",{browsingContext:ve})}),K.on("browsingContext.contextDestroyed",ae=>{ae.context===this.id&&this.dispose("Browsing context already closed.")}),K.on("browsingContext.historyUpdated",ae=>{ae.context===this.id&&(x(this,O,ae.url),this.emit("historyUpdated",void 0))}),K.on("browsingContext.domContentLoaded",ae=>{ae.context===this.id&&(x(this,O,ae.url),this.emit("DOMContentLoaded",void 0))}),K.on("browsingContext.load",ae=>{ae.context===this.id&&(x(this,O,ae.url),this.emit("load",void 0))}),K.on("browsingContext.navigationStarted",ae=>{if(ae.context!==this.id)return;for(const[de,et]of c(this,J))et.disposed&&c(this,J).delete(de);if(c(this,I)!==void 0&&!c(this,I).disposed)return;x(this,I,_te.from(this));const ve=c(this,L).use(new xe(c(this,I)));for(const de of["fragment","failed","aborted"])ve.once(de,({url:et})=>{ve[Me](),x(this,O,et)});this.emit("navigation",{navigation:c(this,I)})}),K.on("network.beforeRequestSent",ae=>{if(ae.context!==this.id||c(this,J).has(ae.request.request))return;const ve=Ete.from(this,ae);c(this,J).set(ve.id,ve),this.emit("request",{request:ve})}),K.on("log.entryAdded",ae=>{ae.source.context===this.id&&this.emit("log",{entry:ae})}),K.on("browsingContext.userPromptOpened",ae=>{if(ae.context!==this.id)return;const ve=Cte.from(this,ae);this.emit("userprompt",{userPrompt:ve})})},Zt=function(){return this.userContext.browser.session},m1=function(V){const K=oA.from(this,V);return K.on("worker",ae=>{this.emit("worker",{realm:ae})}),K},(()=>{const V=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;E=[ue(K=>c(K,$))],N=[ue(K=>c(K,$))],qt(z,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:K=>"dispose"in K,get:K=>K.dispose},metadata:V},null,e),qt(z,null,r,{kind:"method",name:"activate",static:!1,private:!1,access:{has:K=>"activate"in K,get:K=>K.activate},metadata:V},null,e),qt(z,null,s,{kind:"method",name:"captureScreenshot",static:!1,private:!1,access:{has:K=>"captureScreenshot"in K,get:K=>K.captureScreenshot},metadata:V},null,e),qt(z,null,i,{kind:"method",name:"close",static:!1,private:!1,access:{has:K=>"close"in K,get:K=>K.close},metadata:V},null,e),qt(z,null,a,{kind:"method",name:"traverseHistory",static:!1,private:!1,access:{has:K=>"traverseHistory"in K,get:K=>K.traverseHistory},metadata:V},null,e),qt(z,null,o,{kind:"method",name:"navigate",static:!1,private:!1,access:{has:K=>"navigate"in K,get:K=>K.navigate},metadata:V},null,e),qt(z,null,u,{kind:"method",name:"reload",static:!1,private:!1,access:{has:K=>"reload"in K,get:K=>K.reload},metadata:V},null,e),qt(z,null,l,{kind:"method",name:"setCacheBehavior",static:!1,private:!1,access:{has:K=>"setCacheBehavior"in K,get:K=>K.setCacheBehavior},metadata:V},null,e),qt(z,null,d,{kind:"method",name:"print",static:!1,private:!1,access:{has:K=>"print"in K,get:K=>K.print},metadata:V},null,e),qt(z,null,h,{kind:"method",name:"handleUserPrompt",static:!1,private:!1,access:{has:K=>"handleUserPrompt"in K,get:K=>K.handleUserPrompt},metadata:V},null,e),qt(z,null,f,{kind:"method",name:"setViewport",static:!1,private:!1,access:{has:K=>"setViewport"in K,get:K=>K.setViewport},metadata:V},null,e),qt(z,null,p,{kind:"method",name:"performActions",static:!1,private:!1,access:{has:K=>"performActions"in K,get:K=>K.performActions},metadata:V},null,e),qt(z,null,m,{kind:"method",name:"releaseActions",static:!1,private:!1,access:{has:K=>"releaseActions"in K,get:K=>K.releaseActions},metadata:V},null,e),qt(z,null,g,{kind:"method",name:"createWindowRealm",static:!1,private:!1,access:{has:K=>"createWindowRealm"in K,get:K=>K.createWindowRealm},metadata:V},null,e),qt(z,null,y,{kind:"method",name:"addPreloadScript",static:!1,private:!1,access:{has:K=>"addPreloadScript"in K,get:K=>K.addPreloadScript},metadata:V},null,e),qt(z,null,w,{kind:"method",name:"addIntercept",static:!1,private:!1,access:{has:K=>"addIntercept"in K,get:K=>K.addIntercept},metadata:V},null,e),qt(z,null,S,{kind:"method",name:"removePreloadScript",static:!1,private:!1,access:{has:K=>"removePreloadScript"in K,get:K=>K.removePreloadScript},metadata:V},null,e),qt(z,null,_,{kind:"method",name:"getCookies",static:!1,private:!1,access:{has:K=>"getCookies"in K,get:K=>K.getCookies},metadata:V},null,e),qt(z,null,v,{kind:"method",name:"setCookie",static:!1,private:!1,access:{has:K=>"setCookie"in K,get:K=>K.setCookie},metadata:V},null,e),qt(z,null,A,{kind:"method",name:"setFiles",static:!1,private:!1,access:{has:K=>"setFiles"in K,get:K=>K.setFiles},metadata:V},null,e),qt(z,null,k,{kind:"method",name:"subscribe",static:!1,private:!1,access:{has:K=>"subscribe"in K,get:K=>K.subscribe},metadata:V},null,e),qt(z,null,C,{kind:"method",name:"addInterception",static:!1,private:!1,access:{has:K=>"addInterception"in K,get:K=>K.addInterception},metadata:V},null,e),qt(z,null,E,{kind:"method",name:"deleteCookie",static:!1,private:!1,access:{has:K=>"deleteCookie"in K,get:K=>K.deleteCookie},metadata:V},null,e),qt(z,null,N,{kind:"method",name:"locateNodes",static:!1,private:!1,access:{has:K=>"locateNodes"in K,get:K=>K.locateNodes},metadata:V},null,e),V&&Object.defineProperty(z,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:V})})(),z})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Tte=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Ad=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let g0=(()=>{var u,l,d,h,f,p,F4,zu;let n=xe,e=[],t,r,s,i,a,o;return u=class extends n{constructor(S,_){super();b(this,p);b(this,l,Tte(this,e));b(this,d,new Map);b(this,h,new Xt);b(this,f);Z(this,"browser");x(this,f,_),this.browser=S}static create(S,_){var A;const v=new u(S,_);return P(A=v,p,F4).call(A),v}get browsingContexts(){return c(this,d).values()}get closed(){return c(this,l)!==void 0}get disposed(){return this.closed}get id(){return c(this,f)}dispose(S){x(this,l,S),this[Me]()}async createBrowsingContext(S,_={}){var k;const{result:{context:v}}=await c(this,p,zu).send("browsingContext.create",{type:S,..._,referenceContext:(k=_.referenceContext)==null?void 0:k.id,userContext:c(this,f)}),A=c(this,d).get(v);return se(A,"The WebDriver BiDi implementation is failing to create a browsing context correctly."),A}async remove(){try{await c(this,p,zu).send("browser.removeUserContext",{userContext:c(this,f)})}finally{this.dispose("User context already closed.")}}async getCookies(S={},_=void 0){const{result:{cookies:v}}=await c(this,p,zu).send("storage.getCookies",{...S,partition:{type:"storageKey",userContext:c(this,f),sourceOrigin:_}});return v}async setCookie(S,_){await c(this,p,zu).send("storage.setCookie",{cookie:S,partition:{type:"storageKey",sourceOrigin:_,userContext:this.id}})}async setPermissions(S,_,v){await c(this,p,zu).send("permissions.setPermission",{origin:S,descriptor:_,state:v,userContext:c(this,f)})}[(t=[Da],r=[ue(S=>c(S,l))],s=[ue(S=>c(S,l))],i=[ue(S=>c(S,l))],a=[ue(S=>c(S,l))],o=[ue(S=>c(S,l))],Me)](){c(this,l)??x(this,l,"User context already closed, probably because the browser disconnected/closed."),this.emit("closed",{reason:c(this,l)}),c(this,h).dispose(),super[Me]()}},l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakSet,F4=function(){const S=c(this,h).use(new xe(this.browser));S.once("closed",({reason:v})=>{this.dispose(`User context was closed: ${v}`)}),S.once("disconnected",({reason:v})=>{this.dispose(`User context was closed: ${v}`)}),c(this,h).use(new xe(c(this,p,zu))).on("browsingContext.contextCreated",v=>{if(v.parent||v.userContext!==c(this,f))return;const A=Ate.from(this,void 0,v.context,v.url,v.originalOpener);c(this,d).set(A.id,A);const k=c(this,h).use(new xe(A));k.on("closed",()=>{k.removeAllListeners(),c(this,d).delete(A.id)}),this.emit("browsingcontext",{browsingContext:A})})},zu=function(){return this.browser.session},(()=>{const S=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;Ad(u,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:_=>"dispose"in _,get:_=>_.dispose},metadata:S},null,e),Ad(u,null,r,{kind:"method",name:"createBrowsingContext",static:!1,private:!1,access:{has:_=>"createBrowsingContext"in _,get:_=>_.createBrowsingContext},metadata:S},null,e),Ad(u,null,s,{kind:"method",name:"remove",static:!1,private:!1,access:{has:_=>"remove"in _,get:_=>_.remove},metadata:S},null,e),Ad(u,null,i,{kind:"method",name:"getCookies",static:!1,private:!1,access:{has:_=>"getCookies"in _,get:_=>_.getCookies},metadata:S},null,e),Ad(u,null,a,{kind:"method",name:"setCookie",static:!1,private:!1,access:{has:_=>"setCookie"in _,get:_=>_.setCookie},metadata:S},null,e),Ad(u,null,o,{kind:"method",name:"setPermissions",static:!1,private:!1,access:{has:_=>"setPermissions"in _,get:_=>_.setPermissions},metadata:S},null,e),S&&Object.defineProperty(u,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:S})})(),Z(u,"DEFAULT","default"),u})();/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class lg{static deserialize(e){var t,r,s,i;if(!e){_e("Service did not produce a result.");return}switch(e.type){case"array":return(t=e.value)==null?void 0:t.map(a=>this.deserialize(a));case"set":return(r=e.value)==null?void 0:r.reduce((a,o)=>a.add(this.deserialize(o)),new Set);case"object":return(s=e.value)==null?void 0:s.reduce((a,o)=>{const{key:u,value:l}=P(this,Du,g1).call(this,o);return a[u]=l,a},{});case"map":return(i=e.value)==null?void 0:i.reduce((a,o)=>{const{key:u,value:l}=P(this,Du,g1).call(this,o);return a.set(u,l)},new Map);case"promise":return{};case"regexp":return new RegExp(e.value.pattern,e.value.flags);case"date":return new Date(e.value);case"undefined":return;case"null":return null;case"number":return P(this,Du,D4).call(this,e.value);case"bigint":return BigInt(e.value);case"boolean":return!!e.value;case"string":return e.value}_e(`Deserialization of type ${e.type} not supported.`)}}Du=new WeakSet,D4=function(e){switch(e){case"-0":return-0;case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:return e}},g1=function([e,t]){const r=typeof e=="string"?e:this.deserialize(e),s=this.deserialize(t);return{key:r,value:s}},b(lg,Du);/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const LA=class LA extends NI{constructor(t){super(t.info.type,t.info.message,t.info.defaultValue);b(this,kw);x(this,kw,t),this.handled=t.handled}static from(t){return new LA(t)}async handle(t){await c(this,kw).handle({accept:t.accept,userText:t.text})}};kw=new WeakMap;let lA=LA;var Ite=Nt();/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const FA=class FA extends oc{constructor(t,r){super();b(this,$i);Z(this,"realm");b(this,Jh,!1);x(this,$i,t),this.realm=r}static from(t,r){return new FA(t,r)}get disposed(){return c(this,Jh)}async jsonValue(){return await this.evaluate(t=>t)}asElement(){return null}async dispose(){c(this,Jh)||(x(this,Jh,!0),await this.realm.destroyHandles([this]))}get isPrimitiveValue(){switch(c(this,$i).type){case"string":case"number":case"bigint":case"boolean":case"undefined":case"null":return!0;default:return!1}}toString(){return this.isPrimitiveValue?"JSHandle:"+lg.deserialize(c(this,$i)):"JSHandle@"+c(this,$i).type}get id(){return"handle"in c(this,$i)?c(this,$i).handle:void 0}remoteValue(){return c(this,$i)}remoteObject(){throw new Fe("Not available in WebDriver BiDi")}};$i=new WeakMap,Jh=new WeakMap;let uo=FA;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Ote=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},pB=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},Rte=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},Mte=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});let dg=(()=>{var s,i;let n=qI,e=[],t,r;return i=class extends n{constructor(u,l){super(uo.from(u,l));b(this,s,Ote(this,e))}static from(u,l){return new i(u,l)}get realm(){return this.handle.realm}get frame(){return this.realm.environment}remoteValue(){return this.handle.remoteValue()}async autofill(u){const l=this.frame.client,h=(await l.send("DOM.describeNode",{objectId:this.handle.id})).node.backendNodeId,f=this.frame._id;await l.send("Autofill.trigger",{fieldId:h,frameId:f,card:u.creditCard})}async contentFrame(){const u={stack:[],error:void 0,hasError:!1};try{const d=Rte(u,await this.evaluateHandle(h=>{if(h instanceof HTMLIFrameElement||h instanceof HTMLFrameElement)return h.contentWindow}),!1).remoteValue();return d.type==="window"?this.frame.page().frames().find(h=>h._id===d.value.context)??null:null}catch(l){u.error=l,u.hasError=!0}finally{Mte(u)}}async uploadFile(...u){const l=Fa.value.path;l&&(u=u.map(d=>l.win32.isAbsolute(d)||l.posix.isAbsolute(d)?d:l.resolve(d))),await this.frame.setFiles(this,u)}async*queryAXTree(u,l){const d=await this.frame.locateNodes(this,{type:"accessibility",value:{role:l,name:u}});return yield*al.map(d,h=>Promise.resolve(i.from(h,this.realm)))}async backendNodeId(){if(!this.frame.page().browser().cdpSupported)throw new Fe;if(c(this,s))return c(this,s);const{node:u}=await this.frame.client.send("DOM.describeNode",{objectId:this.handle.id});return x(this,s,u.backendNodeId),c(this,s)}},s=new WeakMap,(()=>{const u=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[ue()],r=[ue(),ct],pB(i,null,t,{kind:"method",name:"autofill",static:!1,private:!1,access:{has:l=>"autofill"in l,get:l=>l.autofill},metadata:u},null,e),pB(i,null,r,{kind:"method",name:"contentFrame",static:!1,private:!1,access:{has:l=>"contentFrame"in l,get:l=>l.contentFrame},metadata:u},null,e),u&&Object.defineProperty(i,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:u})})(),i})();/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var dA=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},Nte=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});const DA=class DA{constructor(e,t,r,s=!1){b(this,ji);b(this,Jo);Z(this,"name");b(this,Cw);b(this,Xh);b(this,Yh);b(this,Pw,[]);b(this,Aw,new Xt);b(this,F0,async e=>{const t={stack:[],error:void 0,hasError:!1};try{if(e.channel!==c(this,Yh))return;const r=P(this,ji,q4).call(this,e.source);if(!r)return;const s=dA(t,uo.from(e.data,r),!1),i=dA(t,await s.evaluateHandle(([,,l])=>l),!1),a=dA(t,new Xt,!1),o=[];for(const[l,d]of await i.getProperties()){if(a.use(d),d instanceof dg){o[+l]=d,a.use(d);continue}o[+l]=d.jsonValue()}let u;try{u=await c(this,Cw).call(this,...await Promise.all(o))}catch(l){try{l instanceof Error?await s.evaluate(([,d],h,f,p)=>{const m=new Error(f);m.name=h,p&&(m.stack=p),d(m)},l.name,l.message,l.stack):await s.evaluate(([,d],h)=>{d(h)},l)}catch(d){_e(d)}return}try{await s.evaluate(([l],d)=>{l(d)},u)}catch(l){_e(l)}}catch(r){t.error=r,t.hasError=!0}finally{Nte(t)}});x(this,Jo,e),this.name=t,x(this,Cw,r),x(this,Xh,s),x(this,Yh,`__puppeteer__${c(this,Jo)._id}_page_exposeFunction_${this.name}`)}static async from(e,t,r,s=!1){var a;const i=new DA(e,t,r,s);return await P(a=i,ji,B4).call(a),i}[Symbol.dispose](){this[Symbol.asyncDispose]().catch(_e)}async[Symbol.asyncDispose](){c(this,Aw).dispose(),await Promise.all(c(this,Pw).map(async([e,t])=>{const r=c(this,Xh)?e.isolatedRealm():e.mainRealm();try{await Promise.all([r.evaluate(s=>{delete globalThis[s]},this.name),...e.childFrames().map(s=>s.evaluate(i=>{delete globalThis[i]},this.name)),e.browsingContext.removePreloadScript(t)])}catch(s){_e(s)}}))}};Jo=new WeakMap,Cw=new WeakMap,Xh=new WeakMap,Yh=new WeakMap,Pw=new WeakMap,Aw=new WeakMap,ji=new WeakSet,B4=async function(){const e=c(this,ji,U4),t={type:"channel",value:{channel:c(this,Yh),ownership:"root"}};c(this,Aw).use(new xe(e)).on(Ite.ChromiumBidi.Script.EventNames.Message,c(this,F0));const s=ni(il(a=>{Object.assign(globalThis,{[PLACEHOLDER("name")]:function(...o){return new Promise((u,l)=>{a([u,l,o])})}})},{name:JSON.stringify(this.name)})),i=[c(this,Jo)];for(const a of i)i.push(...a.childFrames());await Promise.all(i.map(async a=>{const o=c(this,Xh)?a.isolatedRealm():a.mainRealm();try{const[u]=await Promise.all([a.browsingContext.addPreloadScript(s,{arguments:[t],sandbox:o.sandbox}),o.realm.callFunction(s,!1,{arguments:[t]})]);c(this,Pw).push([a,u])}catch(u){_e(u)}}))},U4=function(){return c(this,Jo).page().browser().connection},F0=new WeakMap,q4=function(e){const t=P(this,ji,K4).call(this,e.context);if(t)return t.realm(e.realm)},K4=function(e){const t=[c(this,Jo)];for(const r of t){if(r._id===e)return r;t.push(...r.childFrames())}};let hg=DA;var $te=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},jte=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let mB=(()=>{var r,s,i,a,o,H4,l;let n=VI,e=[],t;return l=class extends n{constructor(f,p,m){super();b(this,o);b(this,r,$te(this,e));b(this,s);b(this,i);b(this,a,!1);x(this,r,f),x(this,s,p),x(this,a,m);const g=f["goog:securityDetails"];m&&g&&x(this,i,new wO(g))}static from(f,p,m){var y;const g=new l(f,p,m);return P(y=g,o,H4).call(y),g}remoteAddress(){return{ip:"",port:-1}}url(){return c(this,r).url}status(){return c(this,r).status}statusText(){return c(this,r).statusText}headers(){const f={};for(const p of c(this,r).headers)p.value.type==="string"&&(f[p.name.toLowerCase()]=p.value.value);return f}request(){return c(this,s)}fromCache(){return c(this,r).fromCache}timing(){const f=c(this,s).timing();return{requestTime:f.requestTime,proxyStart:-1,proxyEnd:-1,dnsStart:f.dnsStart,dnsEnd:f.dnsEnd,connectStart:f.connectStart,connectEnd:f.connectEnd,sslStart:f.tlsStart,sslEnd:-1,workerStart:-1,workerReady:-1,workerFetchStart:-1,workerRespondWithSettled:-1,workerRouterEvaluationStart:-1,workerCacheLookupStart:-1,sendStart:f.requestStart,sendEnd:-1,pushStart:-1,pushEnd:-1,receiveHeadersStart:f.responseStart,receiveHeadersEnd:f.responseEnd}}frame(){return c(this,s).frame()}fromServiceWorker(){return!1}securityDetails(){if(!c(this,a))throw new Fe;return c(this,i)??null}content(){throw new Fe}},r=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakSet,H4=function(){var f,p;c(this,r).fromCache&&(c(this,s)._fromMemoryCache=!0,(f=c(this,s).frame())==null||f.page().trustedEmitter.emit("requestservedfromcache",c(this,s))),(p=c(this,s).frame())==null||p.page().trustedEmitter.emit("response",this)},(()=>{const f=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[ys],jte(l,null,t,{kind:"method",name:"remoteAddress",static:!1,private:!1,access:{has:p=>"remoteAddress"in p,get:p=>p.remoteAddress},metadata:f},null,e),f&&Object.defineProperty(l,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:f})})(),l})();var hA;const fA=new WeakMap;class pA extends $b{constructor(t,r,s){super();b(this,Xn);b(this,Bu);b(this,Tw,null);Z(this,"id");b(this,Cr);b(this,Kt);b(this,Iw,!1);b(this,D0,async()=>{if(!c(this,Cr))return;const t=c(this,Cr).page()._credentials;t&&!c(this,Iw)?(x(this,Iw,!0),c(this,Kt).continueWithAuth({action:"provideCredentials",credentials:{type:"password",username:t.username,password:t.password}})):c(this,Kt).continueWithAuth({action:"cancel"})});fA.set(t,this),this.interception.enabled=t.isBlocked,x(this,Kt,t),x(this,Cr,r),x(this,Bu,s?c(s,Bu):[]),this.id=t.id}static from(t,r,s){var a;const i=new hA(t,r,s);return P(a=i,Xn,W4).call(a),i}get client(){return c(this,Cr).client}url(){return c(this,Kt).url}resourceType(){if(!c(this,Cr).page().browser().cdpSupported)throw new Fe;return(c(this,Kt).resourceType||"other").toLowerCase()}method(){return c(this,Kt).method}postData(){if(!c(this,Cr).page().browser().cdpSupported)throw new Fe;return c(this,Kt).postData}hasPostData(){if(!c(this,Cr).page().browser().cdpSupported)throw new Fe;return c(this,Kt).hasPostData}async fetchPostData(){throw new Fe}headers(){const t={};for(const r of c(this,Kt).headers)t[r.name.toLowerCase()]=r.value.value;return{...t,...c(this,Xn,w1),...c(this,Xn,b1)}}response(){return c(this,Tw)}failure(){return c(this,Kt).error===void 0?null:{errorText:c(this,Kt).error}}isNavigationRequest(){return c(this,Kt).navigation!==void 0}initiator(){var t;return{...c(this,Kt).initiator,type:((t=c(this,Kt).initiator)==null?void 0:t.type)??"other"}}redirectChain(){return c(this,Bu).slice()}frame(){return c(this,Cr)}async continue(t,r){return await super.continue({headers:c(this,Xn,y1)?this.headers():void 0,...t},r)}async _continue(t={}){const r=gB(t.headers);return this.interception.handled=!0,await c(this,Kt).continueRequest({url:t.url,method:t.method,body:t.postData?{type:"base64",value:xI(t.postData)}:void 0,headers:r.length>0?r:void 0}).catch(s=>(this.interception.handled=!1,jb(s)))}async _abort(){return this.interception.handled=!0,await c(this,Kt).failRequest().catch(t=>{throw this.interception.handled=!1,t})}async _respond(t,r){this.interception.handled=!0;let s;t.body&&(s=$b.getResponse(t.body));const i=gB(t.headers),a=i.some(u=>u.name==="content-length");t.contentType&&i.push({name:"content-type",value:{type:"string",value:t.contentType}}),s!=null&&s.contentLength&&!a&&i.push({name:"content-length",value:{type:"string",value:String(s.contentLength)}});const o=t.status||200;return await c(this,Kt).provideResponse({statusCode:o,headers:i.length>0?i:void 0,reasonPhrase:zI[o],body:s!=null&&s.base64?{type:"base64",value:s==null?void 0:s.base64}:void 0}).catch(u=>{throw this.interception.handled=!1,u})}timing(){return c(this,Kt).timing()}}Bu=new WeakMap,Tw=new WeakMap,Cr=new WeakMap,Kt=new WeakMap,Xn=new WeakSet,W4=function(){c(this,Kt).on("redirect",t=>{const r=hA.from(t,c(this,Cr),this);c(this,Bu).push(this),t.once("success",()=>{c(this,Cr).page().trustedEmitter.emit("requestfinished",r)}),t.once("error",()=>{c(this,Cr).page().trustedEmitter.emit("requestfailed",r)}),r.finalizeInterceptions()}),c(this,Kt).once("success",t=>{x(this,Tw,mB.from(t,this,c(this,Cr).page().browser().cdpSupported))}),c(this,Kt).on("authenticate",c(this,D0)),c(this,Cr).page().trustedEmitter.emit("request",this),c(this,Xn,y1)&&this.interception.handlers.push(async()=>{await this.continue({headers:this.headers()},0)})},y1=function(){return!!(Object.keys(c(this,Xn,w1)).length||Object.keys(c(this,Xn,b1)).length)},w1=function(){var t;return((t=c(this,Cr))==null?void 0:t.page()._extraHTTPHeaders)??{}},b1=function(){var t;return((t=c(this,Cr))==null?void 0:t.page()._userAgentHeaders)??{}},Iw=new WeakMap,D0=new WeakMap,hA=pA;function gB(n){const e=[];for(const[t,r]of Object.entries(n??[]))if(!Object.is(r,void 0)){const s=Array.isArray(r)?r:[r];for(const i of s)e.push({name:t.toLowerCase(),value:{type:"string",value:String(i)}})}return e}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class yB extends Error{}class wB{static serialize(e){switch(typeof e){case"symbol":case"function":throw new yB(`Unable to serializable ${typeof e}`);case"object":return P(this,Qh,V4).call(this,e);case"undefined":return{type:"undefined"};case"number":return P(this,Qh,z4).call(this,e);case"bigint":return{type:"bigint",value:e.toString()};case"string":return{type:"string",value:e};case"boolean":return{type:"boolean",value:e}}}}Qh=new WeakSet,z4=function(e){let t;return Object.is(e,-0)?t="-0":Object.is(e,1/0)?t="Infinity":Object.is(e,-1/0)?t="-Infinity":Object.is(e,NaN)?t="NaN":t=e,{type:"number",value:t}},V4=function(e){if(e===null)return{type:"null"};if(Array.isArray(e))return{type:"array",value:e.map(r=>this.serialize(r))};if(D5(e)){try{JSON.stringify(e)}catch(r){throw r instanceof TypeError&&r.message.startsWith("Converting circular structure to JSON")&&(r.message+=" Recursive objects are not allowed."),r}const t=[];for(const r in e)t.push([this.serialize(r),this.serialize(e[r])]);return{type:"object",value:t}}else{if(B5(e))return{type:"regexp",value:{pattern:e.source,flags:e.flags}};if(U5(e))return{type:"date",value:e.toISOString()}}throw new yB("Custom object serialization not possible. Use plain objects instead.")},b(wB,Qh);/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */function Lte(n){if(n.exception.type!=="error")return lg.deserialize(n.exception);const[e="",...t]=n.text.split(": "),r=t.join(": "),s=new Error(r);s.name=e;const i=[];if(n.stackTrace&&i.length<Error.stackTraceLimit)for(const a of n.stackTrace.callFrames.reverse()){if(Rn.isPuppeteerURL(a.url)&&a.url!==Rn.INTERNAL_URL){const o=Rn.parse(a.url);i.unshift(`    at ${a.functionName||o.functionName} (${o.functionName} at ${o.siteString}, <anonymous>:${a.lineNumber}:${a.columnNumber})`)}else i.push(`    at ${a.functionName||"<anonymous>"} (${a.url}:${a.lineNumber}:${a.columnNumber})`);if(i.length>=Error.stackTraceLimit)break}return s.stack=[n.text,...i].join(`
`),s}function bB(n,e){return t=>{throw t instanceof sc?t.message+=` at ${n}`:t instanceof wb&&(t.message=`Navigation timeout of ${e} ms exceeded`),t}}var Fte=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},Dte=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});class mA extends nO{constructor(t,r){super(r);b(this,Ow);Z(this,"realm");Z(this,"internalPuppeteerUtil");this.realm=t}initialize(){this.realm.on("destroyed",({reason:t})=>{this.taskManager.terminateAll(new Error(t)),this.dispose()}),this.realm.on("updated",()=>{this.internalPuppeteerUtil=void 0,this.taskManager.rerunAll()})}get puppeteerUtil(){const t=Promise.resolve();return Ef.inject(r=>{this.internalPuppeteerUtil&&this.internalPuppeteerUtil.then(s=>{s.dispose()}),this.internalPuppeteerUtil=t.then(()=>this.evaluateHandle(r))},!this.internalPuppeteerUtil),this.internalPuppeteerUtil}async evaluateHandle(t,...r){return await P(this,Ow,_1).call(this,!1,t,...r)}async evaluate(t,...r){return await P(this,Ow,_1).call(this,!0,t,...r)}createHandle(t){return(t.type==="node"||t.type==="window")&&this instanceof lo?dg.from(t,this):uo.from(t,this)}async serializeAsync(t){return t instanceof Mn&&(t=await t.get(this)),this.serialize(t)}serialize(t){if(t instanceof uo||t instanceof dg){if(t.realm!==this){if(!(t.realm instanceof lo)||!(this instanceof lo))throw new Error("Trying to evaluate JSHandle from different global types. Usually this means you're using a handle from a worker in a page or vice versa.");if(t.realm.environment!==this.environment)throw new Error("Trying to evaluate JSHandle from different frames. Usually this means you're using a handle from a page on a different page.")}if(t.disposed)throw new Error("JSHandle is disposed!");return t.remoteValue()}return wB.serialize(t)}async destroyHandles(t){if(this.disposed)return;const r=t.map(({id:s})=>s).filter(s=>s!==void 0);r.length!==0&&await this.realm.disown(r).catch(s=>{_e(s)})}async adoptHandle(t){return await this.evaluateHandle(r=>r,t)}async transferHandle(t){if(t.realm===this)return t;const r=this.adoptHandle(t);return await t.dispose(),await r}}Ow=new WeakSet,_1=async function(t,r,...s){var d;const i=II(((d=CI(r))==null?void 0:d.toString())??Rn.INTERNAL_URL);let a;const o=t?"none":"root",u=t?{}:{maxObjectDepth:0,maxDomDepth:0};if(qi(r)){const h=vb.test(r)?r:`${r}
${i}
`;a=this.realm.evaluate(h,!0,{resultOwnership:o,userActivation:!0,serializationOptions:u})}else{let h=ni(r);h=vb.test(h)?h:`${h}
${i}
`,a=this.realm.callFunction(h,!0,{arguments:s.some(f=>f instanceof Mn)?await Promise.all(s.map(f=>this.serializeAsync(f))):s.map(f=>this.serialize(f)),resultOwnership:o,userActivation:!0,serializationOptions:u})}const l=await a;if("type"in l&&l.type==="exception")throw Lte(l.exceptionDetails);return t?lg.deserialize(l.result):this.createHandle(l.result)};const U0=class U0 extends mA{constructor(t,r){super(t,r.timeoutSettings);b(this,B0);b(this,ef);b(this,tf,!1);x(this,ef,r)}static from(t,r){var i;const s=new U0(t,r);return P(i=s,B0,G4).call(i),s}get puppeteerUtil(){let t=Promise.resolve();return c(this,tf)||(t=Promise.all([hg.from(this.environment,"__ariaQuerySelector",ac.queryOne,!!this.sandbox),hg.from(this.environment,"__ariaQuerySelectorAll",async(r,s)=>{const i=ac.queryAll(r,s);return await r.realm.evaluateHandle((...a)=>a,...await al.collect(i))},!!this.sandbox)]),x(this,tf,!0)),t.then(()=>super.puppeteerUtil)}get sandbox(){return this.realm.sandbox}get environment(){return c(this,ef)}async adoptBackendNode(t){const r={stack:[],error:void 0,hasError:!1};try{const{object:s}=await c(this,ef).client.send("DOM.resolveNode",{backendNodeId:t,executionContextId:await this.realm.resolveExecutionContextId()});return await Fte(r,dg.from({handle:s.objectId,type:"node"},this),!1).evaluateHandle(a=>a)}catch(s){r.error=s,r.hasError=!0}finally{Dte(r)}}};ef=new WeakMap,B0=new WeakSet,G4=function(){YB(U0.prototype,this,"initialize").call(this),this.realm.on("updated",()=>{this.environment.clearDocumentHandle(),x(this,tf,!1)})},tf=new WeakMap;let lo=U0;const BA=class BA extends mA{constructor(t,r){super(t,r.timeoutSettings);b(this,Rw);x(this,Rw,r)}static from(t,r){const s=new BA(t,r);return s.initialize(),s}get environment(){return c(this,Rw)}async adoptBackendNode(){throw new Error("Cannot adopt DOM nodes into a worker.")}};Rw=new WeakMap;let y0=BA;/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const UA=class UA extends sO{constructor(t,r){super(r.origin);b(this,Mw);b(this,Nw);x(this,Mw,t),x(this,Nw,y0.from(r,this))}static from(t,r){return new UA(t,r)}get frame(){return c(this,Mw)}mainRealm(){return c(this,Nw)}get client(){throw new Fe}};Mw=new WeakMap,Nw=new WeakMap;let gA=UA;/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Bte=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Nc=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},_B=function(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})};function Ute(n){switch(n){case"group":return"startGroup";case"groupCollapsed":return"startGroupCollapsed";case"groupEnd":return"endGroup";default:return n}}let vB=(()=>{var h,f,p,Z4,v1,mS,w,gS,yS,v;let n=HI,e=[],t,r,s,i,a,o,u,l,d;return v=class extends n{constructor(C,E){super();b(this,p);b(this,h,Bte(this,e));Z(this,"browsingContext");b(this,f,new WeakMap);Z(this,"realms");Z(this,"_id");Z(this,"client");Z(this,"accessibility");b(this,w,new Map);x(this,h,C),this.browsingContext=E,this._id=E.id,this.client=new cg(this),this.realms={default:lo.from(this.browsingContext.defaultRealm,this),internal:lo.from(this.browsingContext.createWindowRealm(`__puppeteer_internal_${Math.ceil(Math.random()*1e4)}`),this)},this.accessibility=new iO(this.realms.default,this._id)}static from(C,E){var I;const N=new v(C,E);return P(I=N,p,Z4).call(I),N}get timeoutSettings(){return this.page()._timeoutSettings}mainRealm(){return this.realms.default}isolatedRealm(){return this.realms.internal}realm(C){for(const E of Object.values(this.realms))if(E.realm.id===C)return E}page(){let C=c(this,h);for(;C instanceof v;)C=c(C,h);return C}url(){return this.browsingContext.url}parentFrame(){return c(this,h)instanceof v?c(this,h):null}childFrames(){return[...this.browsingContext.children].map(C=>c(this,f).get(C))}async goto(C,E={}){const[N]=await Promise.all([this.waitForNavigation(E),this.browsingContext.navigate(C,"interactive").catch(I=>{if(!(es(I)&&I.message.includes("net::ERR_HTTP_RESPONSE_CODE_FAILURE"))&&!I.message.includes("navigation canceled")&&!I.message.includes("Navigation was aborted by another navigation"))throw I})]).catch(bB(C,E.timeout??this.timeoutSettings.navigationTimeout()));return N}async setContent(C,E={}){await Promise.all([this.setFrameContent(C),pr(lb([c(this,p,gS).call(this,E),c(this,p,yS).call(this,E)]))])}async waitForNavigation(C={}){const{timeout:E=this.timeoutSettings.navigationTimeout(),signal:N}=C,I=this.childFrames().map($=>{var O;return P(O=$,p,mS).call(O)});return await pr(lb([wI(St(this.browsingContext,"navigation"),St(this.browsingContext,"historyUpdated").pipe(Vt(()=>({navigation:null})))).pipe(rl()).pipe(pb(({navigation:$})=>$===null?ri(null):c(this,p,gS).call(this,C).pipe(T5(()=>I.length===0?ri(void 0):lb(I)),Ir(St($,"fragment"),St($,"failed"),St($,"aborted").pipe(Vt(({url:O})=>{throw new Error(`Navigation aborted: ${O}`)}))),pb(()=>{if($.request){let O=function(T){return $===null?ri(null):T.response||T.error?ri($):T.redirect?O(T.redirect):St(T,"success").pipe(Ir(St(T,"error")),Ir(St(T,"redirect"))).pipe(pb(()=>O(T)))};return O($.request)}return ri($)})))),c(this,p,yS).call(this,C)]).pipe(Vt(([$])=>{if(!$)return null;const O=$.request;if(!O)return null;const T=O.lastRedirect??O;return fA.get(T).response()}),Ir(hn(E),ic(N),P(this,p,mS).call(this).pipe(Vt(()=>{throw new gs("Frame detached.")})))))}waitForDevicePrompt(){throw new Fe}get detached(){return this.browsingContext.closed}async exposeFunction(C,E){if(c(this,w).has(C))throw new Error(`Failed to add page binding with name ${C}: globalThis['${C}'] already exists!`);const N=await hg.from(this,C,E);c(this,w).set(C,N)}async removeExposedFunction(C){const E=c(this,w).get(C);if(!E)throw new Error(`Failed to remove page binding with name ${C}: window['${C}'] does not exists!`);c(this,w).delete(C),await E[Symbol.asyncDispose]()}async createCDPSession(){if(!this.page().browser().cdpSupported)throw new Fe;return await this.page().browser().cdpConnection._createSession({targetId:this._id})}async setFiles(C,E){await this.browsingContext.setFiles(C.remoteValue(),E)}async locateNodes(C,E){return await this.browsingContext.locateNodes(E,[C.remoteValue()])}},h=new WeakMap,f=new WeakMap,p=new WeakSet,Z4=function(){for(const C of this.browsingContext.children)P(this,p,v1).call(this,C);this.browsingContext.on("browsingcontext",({browsingContext:C})=>{P(this,p,v1).call(this,C)}),this.browsingContext.on("closed",()=>{for(const C of cg.sessions.values())C.frame===this&&C.onClose();this.page().trustedEmitter.emit("framedetached",this)}),this.browsingContext.on("request",({request:C})=>{const E=pA.from(C,this);C.once("success",()=>{this.page().trustedEmitter.emit("requestfinished",E)}),C.once("error",()=>{this.page().trustedEmitter.emit("requestfailed",E)}),E.finalizeInterceptions()}),this.browsingContext.on("navigation",({navigation:C})=>{C.once("fragment",()=>{this.page().trustedEmitter.emit("framenavigated",this)})}),this.browsingContext.on("load",()=>{this.page().trustedEmitter.emit("load",void 0)}),this.browsingContext.on("DOMContentLoaded",()=>{this._hasStartedLoading=!0,this.page().trustedEmitter.emit("domcontentloaded",void 0),this.page().trustedEmitter.emit("framenavigated",this)}),this.browsingContext.on("userprompt",({userPrompt:C})=>{this.page().trustedEmitter.emit("dialog",lA.from(C))}),this.browsingContext.on("log",({entry:C})=>{if(this._id===C.source.context)if(qte(C)){const E=C.args.map(I=>this.mainRealm().createHandle(I)),N=E.reduce((I,$)=>{const O=$ instanceof uo&&$.isPrimitiveValue?lg.deserialize($.remoteValue()):$.toString();return`${I} ${O}`},"").slice(1);this.page().trustedEmitter.emit("console",new ex(Ute(C.method),N,E,Hte(C.stackTrace),this))}else if(Kte(C)){const E=new Error(C.text??""),N=E.message.split(`
`).length,I=E.stack.split(`
`).splice(0,N),$=[];if(C.stackTrace){for(const O of C.stackTrace.callFrames)if($.push(`    at ${O.functionName||"<anonymous>"} (${O.url}:${O.lineNumber+1}:${O.columnNumber+1})`),$.length>=Error.stackTraceLimit)break}E.stack=[...I,...$].join(`
`),this.page().trustedEmitter.emit("pageerror",E)}else _e(`Unhandled LogEntry with type "${C.type}", text "${C.text}" and level "${C.level}"`)}),this.browsingContext.on("worker",({realm:C})=>{const E=gA.from(this,C);C.on("destroyed",()=>{this.page().trustedEmitter.emit("workerdestroyed",E)}),this.page().trustedEmitter.emit("workercreated",E)})},v1=function(C){const E=v.from(this,C);return c(this,f).set(C,E),this.page().trustedEmitter.emit("frameattached",E),C.on("closed",()=>{c(this,f).delete(C)}),E},mS=function(){return rc(()=>this.detached?ri(this):St(this.page().trustedEmitter,"framedetached").pipe(nc(C=>C===this)))},w=new WeakMap,gS=function(){return a.value},yS=function(){return u.value},(()=>{const C=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;t=[rt],r=[rt],s=[rt],i=[rt],o=[rt],l=[rt],d=[rt],Nc(v,null,t,{kind:"method",name:"goto",static:!1,private:!1,access:{has:E=>"goto"in E,get:E=>E.goto},metadata:C},null,e),Nc(v,null,r,{kind:"method",name:"setContent",static:!1,private:!1,access:{has:E=>"setContent"in E,get:E=>E.setContent},metadata:C},null,e),Nc(v,null,s,{kind:"method",name:"waitForNavigation",static:!1,private:!1,access:{has:E=>"waitForNavigation"in E,get:E=>E.waitForNavigation},metadata:C},null,e),Nc(v,a={value:_B(function(E={}){let{waitUntil:N="load"}=E;const{timeout:I=this.timeoutSettings.navigationTimeout()}=E;Array.isArray(N)||(N=[N]);const $=new Set;for(const O of N)switch(O){case"load":{$.add("load");break}case"domcontentloaded":{$.add("DOMContentLoaded");break}}return $.size===0?ri(void 0):lb([...$].map(O=>St(this.browsingContext,O))).pipe(Vt(()=>{}),rl(),Ir(hn(I),P(this,p,mS).call(this).pipe(Vt(()=>{throw new Error("Frame detached.")}))))},"#waitForLoad$")},i,{kind:"method",name:"#waitForLoad$",static:!1,private:!0,access:{has:E=>dn(p,E),get:E=>c(E,p,gS)},metadata:C},null,e),Nc(v,u={value:_B(function(E={}){let{waitUntil:N="load"}=E;Array.isArray(N)||(N=[N]);let I=1/0;for(const $ of N)switch($){case"networkidle0":{I=Math.min(0,I);break}case"networkidle2":{I=Math.min(2,I);break}}return I===1/0?ri(void 0):this.page().waitForNetworkIdle$({idleTime:500,timeout:E.timeout??this.timeoutSettings.timeout(),concurrency:I})},"#waitForNetworkIdle$")},o,{kind:"method",name:"#waitForNetworkIdle$",static:!1,private:!0,access:{has:E=>dn(p,E),get:E=>c(E,p,yS)},metadata:C},null,e),Nc(v,null,l,{kind:"method",name:"setFiles",static:!1,private:!1,access:{has:E=>"setFiles"in E,get:E=>E.setFiles},metadata:C},null,e),Nc(v,null,d,{kind:"method",name:"locateNodes",static:!1,private:!1,access:{has:E=>"locateNodes"in E,get:E=>E.locateNodes},metadata:C},null,e),C&&Object.defineProperty(v,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:C})})(),v})();function qte(n){return n.type==="console"}function Kte(n){return n.type==="javascript"}function Hte(n){const e=[];if(n)for(const t of n.callFrames)e.push({url:t.url,lineNumber:t.lineNumber,columnNumber:t.columnNumber});return e}/**
 * @license
 * Copyright 2017 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var Pn;(function(n){n.None="none",n.Key="key",n.Pointer="pointer",n.Wheel="wheel"})(Pn||(Pn={}));var Ft;(function(n){n.Pause="pause",n.KeyDown="keyDown",n.KeyUp="keyUp",n.PointerUp="pointerUp",n.PointerDown="pointerDown",n.PointerMove="pointerMove",n.Scroll="scroll"})(Ft||(Ft={}));const fg=n=>{switch(n){case"\r":case`
`:n="Enter";break}if([...n].length===1)return n;switch(n){case"Cancel":return"";case"Help":return"";case"Backspace":return"";case"Tab":return"";case"Clear":return"";case"Enter":return"";case"Shift":case"ShiftLeft":return"";case"Control":case"ControlLeft":return"";case"Alt":case"AltLeft":return"";case"Pause":return"";case"Escape":return"";case"PageUp":return"";case"PageDown":return"";case"End":return"";case"Home":return"";case"ArrowLeft":return"";case"ArrowUp":return"";case"ArrowRight":return"";case"ArrowDown":return"";case"Insert":return"";case"Delete":return"";case"NumpadEqual":return"";case"Numpad0":return"";case"Numpad1":return"";case"Numpad2":return"";case"Numpad3":return"";case"Numpad4":return"";case"Numpad5":return"";case"Numpad6":return"";case"Numpad7":return"";case"Numpad8":return"";case"Numpad9":return"";case"NumpadMultiply":return"";case"NumpadAdd":return"";case"NumpadSubtract":return"";case"NumpadDecimal":return"";case"NumpadDivide":return"";case"F1":return"";case"F2":return"";case"F3":return"";case"F4":return"";case"F5":return"";case"F6":return"";case"F7":return"";case"F8":return"";case"F9":return"";case"F10":return"";case"F11":return"";case"F12":return"";case"Meta":case"MetaLeft":return"";case"ShiftRight":return"";case"ControlRight":return"";case"AltRight":return"";case"MetaRight":return"";case"Digit0":return"0";case"Digit1":return"1";case"Digit2":return"2";case"Digit3":return"3";case"Digit4":return"4";case"Digit5":return"5";case"Digit6":return"6";case"Digit7":return"7";case"Digit8":return"8";case"Digit9":return"9";case"KeyA":return"a";case"KeyB":return"b";case"KeyC":return"c";case"KeyD":return"d";case"KeyE":return"e";case"KeyF":return"f";case"KeyG":return"g";case"KeyH":return"h";case"KeyI":return"i";case"KeyJ":return"j";case"KeyK":return"k";case"KeyL":return"l";case"KeyM":return"m";case"KeyN":return"n";case"KeyO":return"o";case"KeyP":return"p";case"KeyQ":return"q";case"KeyR":return"r";case"KeyS":return"s";case"KeyT":return"t";case"KeyU":return"u";case"KeyV":return"v";case"KeyW":return"w";case"KeyX":return"x";case"KeyY":return"y";case"KeyZ":return"z";case"Semicolon":return";";case"Equal":return"=";case"Comma":return",";case"Minus":return"-";case"Period":return".";case"Slash":return"/";case"Backquote":return"`";case"BracketLeft":return"[";case"Backslash":return"\\";case"BracketRight":return"]";case"Quote":return'"';default:throw new Error(`Unknown key: "${n}"`)}};class SB extends ZI{constructor(t){super();b(this,Ia);x(this,Ia,t)}async down(t,r){await c(this,Ia).mainFrame().browsingContext.performActions([{type:Pn.Key,id:"__puppeteer_keyboard",actions:[{type:Ft.KeyDown,value:fg(t)}]}])}async up(t){await c(this,Ia).mainFrame().browsingContext.performActions([{type:Pn.Key,id:"__puppeteer_keyboard",actions:[{type:Ft.KeyUp,value:fg(t)}]}])}async press(t,r={}){const{delay:s=0}=r,i=[{type:Ft.KeyDown,value:fg(t)}];s>0&&i.push({type:Ft.Pause,duration:s}),i.push({type:Ft.KeyUp,value:fg(t)}),await c(this,Ia).mainFrame().browsingContext.performActions([{type:Pn.Key,id:"__puppeteer_keyboard",actions:i}])}async type(t,r={}){const{delay:s=0}=r,i=[...t].map(fg),a=[];if(s<=0)for(const o of i)a.push({type:Ft.KeyDown,value:o},{type:Ft.KeyUp,value:o});else for(const o of i)a.push({type:Ft.KeyDown,value:o},{type:Ft.Pause,duration:s},{type:Ft.KeyUp,value:o});await c(this,Ia).mainFrame().browsingContext.performActions([{type:Pn.Key,id:"__puppeteer_keyboard",actions:a}])}async sendCharacter(t){if([...t].length>1)throw new Error("Cannot send more than 1 character.");await(await c(this,Ia).focusedFrame()).isolatedRealm().evaluate(async s=>{document.execCommand("insertText",!1,s)},t)}}Ia=new WeakMap;const yA=n=>{switch(n){case Lt.Left:return 0;case Lt.Middle:return 1;case Lt.Right:return 2;case Lt.Back:return 3;case Lt.Forward:return 4}};class xB extends JI{constructor(t){super();b(this,Li);b(this,Uu,{x:0,y:0});x(this,Li,t)}async reset(){x(this,Uu,{x:0,y:0}),await c(this,Li).mainFrame().browsingContext.releaseActions()}async move(t,r,s={}){const i=c(this,Uu),a={x:Math.round(t),y:Math.round(r)},o=[],u=s.steps??0;for(let l=0;l<u;++l)o.push({type:Ft.PointerMove,x:i.x+(a.x-i.x)*(l/u),y:i.y+(a.y-i.y)*(l/u),origin:s.origin});o.push({type:Ft.PointerMove,...a,origin:s.origin}),x(this,Uu,a),await c(this,Li).mainFrame().browsingContext.performActions([{type:Pn.Pointer,id:"__puppeteer_mouse",actions:o}])}async down(t={}){await c(this,Li).mainFrame().browsingContext.performActions([{type:Pn.Pointer,id:"__puppeteer_mouse",actions:[{type:Ft.PointerDown,button:yA(t.button??Lt.Left)}]}])}async up(t={}){await c(this,Li).mainFrame().browsingContext.performActions([{type:Pn.Pointer,id:"__puppeteer_mouse",actions:[{type:Ft.PointerUp,button:yA(t.button??Lt.Left)}]}])}async click(t,r,s={}){const i=[{type:Ft.PointerMove,x:Math.round(t),y:Math.round(r),origin:s.origin}],a={type:Ft.PointerDown,button:yA(s.button??Lt.Left)},o={type:Ft.PointerUp,button:a.button};for(let u=1;u<(s.count??1);++u)i.push(a,o);i.push(a),s.delay&&i.push({type:Ft.Pause,duration:s.delay}),i.push(o),await c(this,Li).mainFrame().browsingContext.performActions([{type:Pn.Pointer,id:"__puppeteer_mouse",actions:i}])}async wheel(t={}){await c(this,Li).mainFrame().browsingContext.performActions([{type:Pn.Wheel,id:"__puppeteer_wheel",actions:[{type:Ft.Scroll,...c(this,Uu)??{x:0,y:0},deltaX:t.deltaX??0,deltaY:t.deltaY??0}]}])}drag(){throw new Fe}dragOver(){throw new Fe}dragEnter(){throw new Fe}drop(){throw new Fe}dragAndDrop(){throw new Fe}}Li=new WeakMap,Uu=new WeakMap;class Wte{constructor(e,t,r,s,i,a){b(this,$w,!1);b(this,jw);b(this,Lw);b(this,qu);b(this,Ku);b(this,Fw);b(this,rf);x(this,Ku,e),x(this,Fw,t),x(this,jw,Math.round(s)),x(this,Lw,Math.round(i)),x(this,rf,a),x(this,qu,`__puppeteer_finger_${r}`)}async start(e={}){if(c(this,$w))throw new bb("Touch has already started");await c(this,Ku).mainFrame().browsingContext.performActions([{type:Pn.Pointer,id:c(this,qu),parameters:{pointerType:"touch"},actions:[{type:Ft.PointerMove,x:c(this,jw),y:c(this,Lw),origin:e.origin},{...c(this,rf),type:Ft.PointerDown,button:0}]}]),x(this,$w,!0)}move(e,t){const r=Math.round(e),s=Math.round(t);return c(this,Ku).mainFrame().browsingContext.performActions([{type:Pn.Pointer,id:c(this,qu),parameters:{pointerType:"touch"},actions:[{...c(this,rf),type:Ft.PointerMove,x:r,y:s}]}])}async end(){await c(this,Ku).mainFrame().browsingContext.performActions([{type:Pn.Pointer,id:c(this,qu),parameters:{pointerType:"touch"},actions:[{type:Ft.PointerUp,button:0}]}]),c(this,Fw).removeHandle(this)}}$w=new WeakMap,jw=new WeakMap,Lw=new WeakMap,qu=new WeakMap,Ku=new WeakMap,Fw=new WeakMap,rf=new WeakMap;class EB extends XI{constructor(t){super();b(this,Dw);x(this,Dw,t)}async touchStart(t,r,s={}){const i=this.idGenerator(),a={width:.5*2,height:.5*2,pressure:.5,altitudeAngle:Math.PI/2},o=new Wte(c(this,Dw),this,i,t,r,a);return await o.start(s),this.touches.push(o),o}}Dw=new WeakMap;/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var zte=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},kB=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},CB=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},PB=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});let pg=(()=>{var s,i,a,o,u,l,d,h,J4,p,m,g,y,w,tb,S1,x1,A;let n=eO,e,t=[],r=[];return A=class extends n{constructor(E,N){super();b(this,h);b(this,s,kB(this,t,new xe));b(this,i,kB(this,r));b(this,a);b(this,o,null);b(this,u,new Set);Z(this,"keyboard");Z(this,"mouse");Z(this,"touchscreen");Z(this,"tracing");Z(this,"coverage");b(this,l);b(this,d);Z(this,"_userAgentHeaders",{});b(this,p);b(this,m);b(this,g);Z(this,"_extraHTTPHeaders",{});b(this,y);Z(this,"_credentials",null);b(this,w);x(this,i,E),x(this,a,vB.from(this,N)),x(this,l,new uO(c(this,a).client)),this.tracing=new SO(c(this,a).client),this.coverage=new oO(c(this,a).client),this.keyboard=new SB(this),this.mouse=new xB(this),this.touchscreen=new EB(this)}static from(E,N){var $;const I=new A(E,N);return P($=I,h,J4).call($),I}get trustedEmitter(){return c(this,s)}set trustedEmitter(E){x(this,s,E)}_client(){return c(this,a).client}async setUserAgent(E,N){if(!c(this,i).browser().cdpSupported&&N)throw new Fe("Current Browser does not support `userAgentMetadata`");if(c(this,i).browser().cdpSupported&&N)return await this._client().send("Network.setUserAgentOverride",{userAgent:E,userAgentMetadata:N});const I=E!=="";E=E??await c(this,i).browser().userAgent(),this._userAgentHeaders=I?{"User-Agent":E}:{},x(this,p,await P(this,h,tb).call(this,["beforeRequestSent"],c(this,p),I));const $=L=>{Object.defineProperty(navigator,"userAgent",{value:L})},O=[c(this,a)];for(const L of O)O.push(...L.childFrames());c(this,m)&&await this.removeScriptToEvaluateOnNewDocument(c(this,m));const[T]=await Promise.all([I?this.evaluateOnNewDocument($,E):void 0,O.map(L=>L.evaluate($,E))]);x(this,m,T==null?void 0:T.identifier)}async setBypassCSP(E){await this._client().send("Page.setBypassCSP",{enabled:E})}async queryObjects(E){se(!E.disposed,"Prototype JSHandle is disposed!"),se(E.id,"Prototype JSHandle must not be referencing primitive value");const N=await c(this,a).client.send("Runtime.queryObjects",{prototypeObjectId:E.id});return c(this,a).mainRealm().createHandle({type:"array",handle:N.objects.objectId})}browser(){return this.browserContext().browser()}browserContext(){return c(this,i)}mainFrame(){return c(this,a)}async focusedFrame(){const E={stack:[],error:void 0,hasError:!1};try{const I=CB(E,await this.mainFrame().isolatedRealm().evaluateHandle(()=>{let O=window;for(;(O.document.activeElement instanceof O.HTMLIFrameElement||O.document.activeElement instanceof O.HTMLFrameElement)&&O.document.activeElement.contentWindow!==null;)O=O.document.activeElement.contentWindow;return O}),!1).remoteValue();se(I.type==="window");const $=this.frames().find(O=>O._id===I.value.context);return se($),$}catch(N){E.error=N,E.hasError=!0}finally{PB(E)}}frames(){const E=[c(this,a)];for(const N of E)E.push(...N.childFrames());return E}isClosed(){return c(this,a).detached}async close(E){const N={stack:[],error:void 0,hasError:!1};try{const I=CB(N,await c(this,i).waitForScreenshotOperations(),!1);try{await c(this,a).browsingContext.close(E==null?void 0:E.runBeforeUnload)}catch{return}}catch(I){N.error=I,N.hasError=!0}finally{PB(N)}}async reload(E={}){const[N]=await Promise.all([c(this,a).waitForNavigation(E),c(this,a).browsingContext.reload()]).catch(bB(this.url(),E.timeout??this._timeoutSettings.navigationTimeout()));return N}setDefaultNavigationTimeout(E){this._timeoutSettings.setDefaultNavigationTimeout(E)}setDefaultTimeout(E){this._timeoutSettings.setDefaultTimeout(E)}getDefaultTimeout(){return this._timeoutSettings.timeout()}getDefaultNavigationTimeout(){return this._timeoutSettings.navigationTimeout()}isJavaScriptEnabled(){return c(this,l).javascriptEnabled}async setGeolocation(E){return await c(this,l).setGeolocation(E)}async setJavaScriptEnabled(E){return await c(this,l).setJavaScriptEnabled(E)}async emulateMediaType(E){return await c(this,l).emulateMediaType(E)}async emulateCPUThrottling(E){return await c(this,l).emulateCPUThrottling(E)}async emulateMediaFeatures(E){return await c(this,l).emulateMediaFeatures(E)}async emulateTimezone(E){return await c(this,l).emulateTimezone(E)}async emulateIdleState(E){return await c(this,l).emulateIdleState(E)}async emulateVisionDeficiency(E){return await c(this,l).emulateVisionDeficiency(E)}async setViewport(E){if(!this.browser().cdpSupported){await c(this,a).browsingContext.setViewport({viewport:E!=null&&E.width&&(E!=null&&E.height)?{width:E.width,height:E.height}:null,devicePixelRatio:E!=null&&E.deviceScaleFactor?E.deviceScaleFactor:null}),x(this,o,E);return}const N=await c(this,l).emulateViewport(E);x(this,o,E),N&&await this.reload()}viewport(){return c(this,o)}async pdf(E={}){const{timeout:N=this._timeoutSettings.timeout(),path:I=void 0}=E,{printBackground:$,margin:O,landscape:T,width:L,height:U,pageRanges:J,scale:F,preferCSSPageSize:j}=OI(E,"cm"),B=J?J.split(", "):[];await pr(ot(this.mainFrame().isolatedRealm().evaluate(()=>document.fonts.ready)).pipe(Ir(hn(N))));const D=await pr(ot(c(this,a).browsingContext.print({background:$,margin:O,orientation:T?"landscape":"portrait",page:{width:L,height:U},pageRanges:B,scale:F,shrinkToFit:!j})).pipe(Ir(hn(N)))),z=FS(D,!0);return await this._maybeWriteTypedArrayToFile(I,z),z}async createPDFStream(E){const N=await this.pdf(E);return new ReadableStream({start(I){I.enqueue(N),I.close()}})}async _screenshot(E){const{clip:N,type:I,captureBeyondViewport:$,quality:O}=E;if(E.omitBackground!==void 0&&E.omitBackground)throw new Fe("BiDi does not support 'omitBackground'.");if(E.optimizeForSpeed!==void 0&&E.optimizeForSpeed)throw new Fe("BiDi does not support 'optimizeForSpeed'.");if(E.fromSurface!==void 0&&!E.fromSurface)throw new Fe("BiDi does not support 'fromSurface'.");if(N!==void 0&&N.scale!==void 0&&N.scale!==1)throw new Fe("BiDi does not support 'scale' in 'clip'.");let T;if(N)if($)T=N;else{const[U,J]=await this.evaluate(()=>{if(!window.visualViewport)throw new Error("window.visualViewport is not supported.");return[window.visualViewport.pageLeft,window.visualViewport.pageTop]});T={...N,x:N.x-U,y:N.y-J}}return await c(this,a).browsingContext.captureScreenshot({origin:$?"document":"viewport",format:{type:`image/${I}`,...O!==void 0?{quality:O/100}:{}},...T?{clip:{type:"box",...T}}:{}})}async createCDPSession(){return await c(this,a).createCDPSession()}async bringToFront(){await c(this,a).browsingContext.activate()}async evaluateOnNewDocument(E,...N){const I=Vte(E,...N);return{identifier:await c(this,a).browsingContext.addPreloadScript(I)}}async removeScriptToEvaluateOnNewDocument(E){await c(this,a).browsingContext.removePreloadScript(E)}async exposeFunction(E,N){return await this.mainFrame().exposeFunction(E,"default"in N?N.default:N)}isDragInterceptionEnabled(){return!1}async setCacheEnabled(E){if(!c(this,i).browser().cdpSupported){await c(this,a).browsingContext.setCacheBehavior(E?"default":"bypass");return}await this._client().send("Network.setCacheDisabled",{cacheDisabled:!E})}async cookies(...E){const N=(E.length?E:[this.url()]).map($=>new URL($));return(await c(this,a).browsingContext.getCookies()).map($=>wA($)).filter($=>N.some(O=>Jte($,O)))}isServiceWorkerBypassed(){throw new Fe}target(){throw new Fe}waitForFileChooser(){throw new Fe}workers(){return[...c(this,u)]}async setRequestInterception(E){x(this,g,await P(this,h,tb).call(this,["beforeRequestSent"],c(this,g),E))}async setExtraHTTPHeaders(E){const N={};for(const[I,$]of Object.entries(E))se(qi($),`Expected value of header "${I}" to be String, but "${typeof $}" is found.`),N[I.toLowerCase()]=$;this._extraHTTPHeaders=N,x(this,y,await P(this,h,tb).call(this,["beforeRequestSent"],c(this,y),!!Object.keys(this._extraHTTPHeaders).length))}async authenticate(E){x(this,w,await P(this,h,tb).call(this,["authRequired"],c(this,w),!!E)),this._credentials=E}setDragInterception(){throw new Fe}setBypassServiceWorker(){throw new Fe}async setOfflineMode(E){if(!c(this,i).browser().cdpSupported)throw new Fe;return c(this,d)||x(this,d,{offline:!1,upload:-1,download:-1,latency:0}),c(this,d).offline=E,await P(this,h,S1).call(this)}async emulateNetworkConditions(E){if(!c(this,i).browser().cdpSupported)throw new Fe;return c(this,d)||x(this,d,{offline:!1,upload:-1,download:-1,latency:0}),c(this,d).upload=E?E.upload:-1,c(this,d).download=E?E.download:-1,c(this,d).latency=E?E.latency:0,await P(this,h,S1).call(this)}async setCookie(...E){const N=this.url(),I=N.startsWith("http");for(const $ of E){let O=$.url||"";!O&&I&&(O=N),se(O!=="about:blank",`Blank page can not have cookie "${$.name}"`),se(!String.prototype.startsWith.call(O||"","data:"),`Data URL page can not have cookie "${$.name}"`),se($.partitionKey===void 0||typeof $.partitionKey=="string","BiDi only allows domain partition keys");const T=URL.canParse(O)?new URL(O):void 0,L=$.domain??(T==null?void 0:T.hostname);se(L!==void 0,"At least one of the url and domain needs to be specified");const U={domain:L,name:$.name,value:{type:"string",value:$.value},...$.path!==void 0?{path:$.path}:{},...$.httpOnly!==void 0?{httpOnly:$.httpOnly}:{},...$.secure!==void 0?{secure:$.secure}:{},...$.sameSite!==void 0?{sameSite:_A($.sameSite)}:{},expiry:vA($.expires),...bA($,"sameParty","sourceScheme","priority","url")};$.partitionKey!==void 0?await this.browserContext().userContext.setCookie(U,$.partitionKey):await c(this,a).browsingContext.setCookie(U)}}async deleteCookie(...E){await Promise.all(E.map(async N=>{const I=N.url??this.url(),$=URL.canParse(I)?new URL(I):void 0,O=N.domain??($==null?void 0:$.hostname);se(O!==void 0,"At least one of the url and domain needs to be specified");const T={domain:O,name:N.name,...N.path!==void 0?{path:N.path}:{}};await c(this,a).browsingContext.deleteCookie(T)}))}async removeExposedFunction(E){await c(this,a).removeExposedFunction(E)}metrics(){throw new Fe}async goBack(E={}){return await P(this,h,x1).call(this,-1,E)}async goForward(E={}){return await P(this,h,x1).call(this,1,E)}waitForDevicePrompt(){throw new Fe}},s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakSet,J4=function(){c(this,a).browsingContext.on("closed",()=>{this.trustedEmitter.emit("close",void 0),this.trustedEmitter.removeAllListeners()}),this.trustedEmitter.on("workercreated",E=>{c(this,u).add(E)}),this.trustedEmitter.on("workerdestroyed",E=>{c(this,u).delete(E)})},p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,tb=async function(E,N,I){if(I&&!N)return await c(this,a).browsingContext.addIntercept({phases:E});if(!I&&N){await c(this,a).browsingContext.userContext.browser.removeIntercept(N);return}return N},S1=async function(){c(this,d)&&await this._client().send("Network.emulateNetworkConditions",{offline:c(this,d).offline,latency:c(this,d).latency,uploadThroughput:c(this,d).upload,downloadThroughput:c(this,d).download})},x1=async function(E,N){const I=new AbortController;try{const[$]=await Promise.all([this.waitForNavigation({...N,signal:I.signal}),c(this,a).browsingContext.traverseHistory(E)]);return $}catch($){if(I.abort(),es($)&&$.message.includes("no such history entry"))return null;throw $}},(()=>{const E=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;e=[Tb()],zte(A,null,e,{kind:"accessor",name:"trustedEmitter",static:!1,private:!1,access:{has:N=>"trustedEmitter"in N,get:N=>N.trustedEmitter,set:(N,I)=>{N.trustedEmitter=I}},metadata:E},t,r),E&&Object.defineProperty(A,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:E})})(),A})();function Vte(n,...e){return`() => {${BS(n,...e)}}`}function Gte(n,e){const t=n.domain.toLowerCase(),r=e.hostname.toLowerCase();return t===r?!0:t.startsWith(".")&&r.endsWith(t)}function Zte(n,e){const t=e.pathname,r=n.path;return!!(t===r||t.startsWith(r)&&(r.endsWith("/")||t[r.length]==="/"))}function Jte(n,e){const t=new URL(e);return se(n!==void 0),Gte(n,t)?Zte(n,t):!1}function wA(n,e=!1){const t=n[w0+"partitionKey"];function r(){return typeof t=="string"?{partitionKey:t}:typeof t=="object"&&t!==null?e?{partitionKey:{sourceOrigin:t.topLevelSite,hasCrossSiteAncestor:t.hasCrossSiteAncestor??!1}}:{partitionKey:t.topLevelSite}:{}}return{name:n.name,value:n.value.value,domain:n.domain,path:n.path,size:n.size,httpOnly:n.httpOnly,secure:n.secure,sameSite:Yte(n.sameSite),expires:n.expiry??-1,session:n.expiry===void 0||n.expiry<=0,...Xte(n,"sameParty","sourceScheme","partitionKeyOpaque","priority"),...r()}}const w0="goog:";function Xte(n,...e){const t={};for(const r of e)n[w0+r]!==void 0&&(t[r]=n[w0+r]);return t}function bA(n,...e){const t={};for(const r of e)n[r]!==void 0&&(t[w0+r]=n[r]);return t}function Yte(n){return n==="strict"?"Strict":n==="lax"?"Lax":"None"}function _A(n){return n==="Strict"?"strict":n==="Lax"?"lax":"none"}function vA(n){return[void 0,-1].includes(n)?void 0:n}function AB(n){if(n===void 0||typeof n=="string")return n;if(n.hasCrossSiteAncestor)throw new Fe("WebDriver BiDi does not support `hasCrossSiteAncestor` yet.");return n.sourceOrigin}/**
 * @license
 * Copyright 2023 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */class Qte extends Af{constructor(t){super();b(this,nf);x(this,nf,t)}asPage(){throw new Fe}url(){return""}createCDPSession(){throw new Fe}type(){return Rr.BROWSER}browser(){return c(this,nf)}browserContext(){return c(this,nf).defaultBrowserContext()}opener(){throw new Fe}}nf=new WeakMap;class ere extends Af{constructor(t){super();b(this,Oa);x(this,Oa,t)}async page(){return c(this,Oa)}async asPage(){return pg.from(this.browserContext(),c(this,Oa).mainFrame().browsingContext)}url(){return c(this,Oa).url()}createCDPSession(){return c(this,Oa).createCDPSession()}type(){return Rr.PAGE}browser(){return this.browserContext().browser()}browserContext(){return c(this,Oa).browserContext()}opener(){throw new Fe}}Oa=new WeakMap;class tre extends Af{constructor(t){super();b(this,Ra);b(this,sf);x(this,Ra,t)}async page(){return c(this,sf)===void 0&&x(this,sf,pg.from(this.browserContext(),c(this,Ra).browsingContext)),c(this,sf)}async asPage(){return pg.from(this.browserContext(),c(this,Ra).browsingContext)}url(){return c(this,Ra).url()}createCDPSession(){return c(this,Ra).createCDPSession()}type(){return Rr.PAGE}browser(){return this.browserContext().browser()}browserContext(){return c(this,Ra).page().browserContext()}opener(){throw new Fe}}Ra=new WeakMap,sf=new WeakMap;class rre extends Af{constructor(t){super();b(this,af);x(this,af,t)}async page(){throw new Fe}async asPage(){throw new Fe}url(){return c(this,af).url()}createCDPSession(){throw new Fe}type(){return Rr.OTHER}browser(){return this.browserContext().browser()}browserContext(){return c(this,af).frame.page().browserContext()}opener(){throw new Fe}}af=new WeakMap;/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var nre=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},TB=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},sre=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},ire=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});let IB=(()=>{var s,i,a,o,u,l,d,X4,E1,p;let n=MI,e,t=[],r=[];return p=class extends n{constructor(y,w,S){super();b(this,d);b(this,s,TB(this,t,new xe));b(this,i,TB(this,r));b(this,a);Z(this,"userContext");b(this,o,new WeakMap);b(this,u,new Map);b(this,l,[]);x(this,i,y),this.userContext=w,x(this,a,S.defaultViewport)}static from(y,w,S){var v;const _=new p(y,w,S);return P(v=_,d,X4).call(v),_}get trustedEmitter(){return c(this,s)}set trustedEmitter(y){x(this,s,y)}targets(){return[...c(this,u).values()].flatMap(([y,w])=>[y,...w.values()])}async newPage(){const y={stack:[],error:void 0,hasError:!1};try{const w=sre(y,await this.waitForScreenshotOperations(),!1),S=await this.userContext.createBrowsingContext("tab"),_=c(this,o).get(S);if(!_)throw new Error("Page is not found");if(c(this,a))try{await _.setViewport(c(this,a))}catch{}return _}catch(w){y.error=w,y.hasError=!0}finally{ire(y)}}async close(){se(this.userContext.id!==g0.DEFAULT,"Default BrowserContext cannot be closed!");try{await this.userContext.remove()}catch(y){_e(y)}c(this,u).clear()}browser(){return c(this,i)}async pages(){return[...this.userContext.browsingContexts].map(y=>c(this,o).get(y))}async overridePermissions(y,w){const S=new Set(w.map(_=>{if(!qS.get(_))throw new Error("Unknown permission: "+_);return _}));await Promise.all(Array.from(qS.keys()).map(_=>{const v=this.userContext.setPermissions(y,{name:_},S.has(_)?"granted":"denied");return c(this,l).push({origin:y,permission:_}),S.has(_)?v:v.catch(_e)}))}async clearPermissionOverrides(){const y=c(this,l).map(({permission:w,origin:S})=>this.userContext.setPermissions(S,{name:w},"prompt").catch(_e));x(this,l,[]),await Promise.all(y)}get id(){if(this.userContext.id!==g0.DEFAULT)return this.userContext.id}async cookies(){return(await this.userContext.getCookies()).map(w=>wA(w,!0))}async setCookie(...y){await Promise.all(y.map(async w=>{const S={domain:w.domain,name:w.name,value:{type:"string",value:w.value},...w.path!==void 0?{path:w.path}:{},...w.httpOnly!==void 0?{httpOnly:w.httpOnly}:{},...w.secure!==void 0?{secure:w.secure}:{},...w.sameSite!==void 0?{sameSite:_A(w.sameSite)}:{},expiry:vA(w.expires),...bA(w,"sameParty","sourceScheme","priority","url")};return await this.userContext.setCookie(S,AB(w.partitionKey))}))}},s=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,u=new WeakMap,l=new WeakMap,d=new WeakSet,X4=function(){for(const y of this.userContext.browsingContexts)P(this,d,E1).call(this,y);this.userContext.on("browsingcontext",({browsingContext:y})=>{const w=P(this,d,E1).call(this,y);if(y.originalOpener)for(const S of this.userContext.browsingContexts)S.id===y.originalOpener&&c(this,o).get(S).trustedEmitter.emit("popup",w)}),this.userContext.on("closed",()=>{this.trustedEmitter.removeAllListeners()})},E1=function(y){const w=pg.from(this,y);c(this,o).set(y,w),w.trustedEmitter.on("close",()=>{c(this,o).delete(y)});const S=new ere(w),_=new Map;return c(this,u).set(w,[S,_]),w.trustedEmitter.on("frameattached",v=>{const A=v,k=new tre(A);_.set(A,k),this.trustedEmitter.emit("targetcreated",k)}),w.trustedEmitter.on("framenavigated",v=>{const A=v,k=_.get(A);k===void 0?this.trustedEmitter.emit("targetchanged",S):this.trustedEmitter.emit("targetchanged",k)}),w.trustedEmitter.on("framedetached",v=>{const A=v,k=_.get(A);k!==void 0&&(_.delete(A),this.trustedEmitter.emit("targetdestroyed",k))}),w.trustedEmitter.on("workercreated",v=>{const A=v,k=new rre(A);_.set(A,k),this.trustedEmitter.emit("targetcreated",k)}),w.trustedEmitter.on("workerdestroyed",v=>{const A=v,k=_.get(A);k!==void 0&&(_.delete(v),this.trustedEmitter.emit("targetdestroyed",k))}),w.trustedEmitter.on("close",()=>{c(this,u).delete(w),this.trustedEmitter.emit("targetdestroyed",S)}),this.trustedEmitter.emit("targetcreated",S),w},(()=>{const y=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;e=[Tb()],nre(p,null,e,{kind:"accessor",name:"trustedEmitter",static:!1,private:!1,access:{has:w=>"trustedEmitter"in w,get:w=>w.trustedEmitter,set:(w,S)=>{w.trustedEmitter=S}},metadata:y},t,r),y&&Object.defineProperty(p,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:y})})(),p})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var are=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Td=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},ore=function(n,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(t){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],t&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),n.stack.push({value:e,dispose:r,async:t})}else t&&n.stack.push({async:!0});return e},cre=function(n){return function(e){function t(a){e.error=e.hasError?new n(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,s=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&s===1)return s=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else s|=1}catch(o){t(o)}if(s===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}}(typeof SuppressedError=="function"?SuppressedError:function(n,e,t){var r=new Error(t);return r.name="SuppressedError",r.error=n,r.suppressed=e,r});let ure=(()=>{var u,l,d,h,f,p,Y4,Q4,eq,k1,S;let n=xe,e=[],t,r,s,i,a,o;return S=class extends n{constructor(A){super();b(this,p);b(this,u,(are(this,e),!1));b(this,l);b(this,d,new Xt);b(this,h,new Map);Z(this,"session");b(this,f,new Map);this.session=A}static async from(A){var C;const k=new S(A);return await P(C=k,p,Y4).call(C),k}get closed(){return c(this,u)}get defaultUserContext(){return c(this,h).get(g0.DEFAULT)}get disconnected(){return c(this,l)!==void 0}get disposed(){return this.disconnected}get userContexts(){return c(this,h).values()}dispose(A,k=!1){x(this,u,k),x(this,l,A),this[Me]()}async close(){try{await this.session.send("browser.close",{})}finally{this.dispose("Browser already closed.",!0)}}async addPreloadScript(A,k={}){var E;const{result:{script:C}}=await this.session.send("script.addPreloadScript",{functionDeclaration:A,...k,contexts:(E=k.contexts)==null?void 0:E.map(N=>N.id)});return C}async removeIntercept(A){await this.session.send("network.removeIntercept",{intercept:A})}async removePreloadScript(A){await this.session.send("script.removePreloadScript",{script:A})}async createUserContext(){const{result:{userContext:A}}=await this.session.send("browser.createUserContext",{});return P(this,p,k1).call(this,A)}[(t=[Da],r=[ue(A=>c(A,l))],s=[ue(A=>c(A,l))],i=[ue(A=>c(A,l))],a=[ue(A=>c(A,l))],o=[ue(A=>c(A,l))],Me)](){c(this,l)??x(this,l,"Browser was disconnected, probably because the session ended."),this.closed&&this.emit("closed",{reason:c(this,l)}),this.emit("disconnected",{reason:c(this,l)}),c(this,d).dispose(),super[Me]()}},u=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakSet,Y4=async function(){const A=c(this,d).use(new xe(this.session));A.once("ended",({reason:k})=>{this.dispose(k)}),A.on("script.realmCreated",k=>{k.type==="shared-worker"&&c(this,f).set(k.realm,uA.from(this,k.realm,k.origin))}),await P(this,p,Q4).call(this),await P(this,p,eq).call(this)},Q4=async function(){const{result:{userContexts:A}}=await this.session.send("browser.getUserContexts",{});for(const k of A)P(this,p,k1).call(this,k.userContext)},eq=async function(){const A=new Set;let k;{const C={stack:[],error:void 0,hasError:!1};try{ore(C,new xe(this.session),!1).on("browsingContext.contextCreated",I=>{A.add(I.context)});const{result:N}=await this.session.send("browsingContext.getTree",{});k=N.contexts}catch(E){C.error=E,C.hasError=!0}finally{cre(C)}}for(const C of k)A.has(C.context)||this.session.emit("browsingContext.contextCreated",C),C.children&&k.push(...C.children)},k1=function(A){const k=g0.create(this,A);c(this,h).set(k.id,k);const C=c(this,d).use(new xe(k));return C.once("closed",()=>{C.removeAllListeners(),c(this,h).delete(k.id)}),k},(()=>{const A=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;Td(S,null,t,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:k=>"dispose"in k,get:k=>k.dispose},metadata:A},null,e),Td(S,null,r,{kind:"method",name:"close",static:!1,private:!1,access:{has:k=>"close"in k,get:k=>k.close},metadata:A},null,e),Td(S,null,s,{kind:"method",name:"addPreloadScript",static:!1,private:!1,access:{has:k=>"addPreloadScript"in k,get:k=>k.addPreloadScript},metadata:A},null,e),Td(S,null,i,{kind:"method",name:"removeIntercept",static:!1,private:!1,access:{has:k=>"removeIntercept"in k,get:k=>k.removeIntercept},metadata:A},null,e),Td(S,null,a,{kind:"method",name:"removePreloadScript",static:!1,private:!1,access:{has:k=>"removePreloadScript"in k,get:k=>k.removePreloadScript},metadata:A},null,e),Td(S,null,o,{kind:"method",name:"createUserContext",static:!1,private:!1,access:{has:k=>"createUserContext"in k,get:k=>k.createUserContext},metadata:A},null,e),A&&Object.defineProperty(S,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:A})})(),S})();/**
 * @license
 * Copyright 2024 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var SA=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},Id=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0};let lre=(()=>{var d,h,f,p,m,tq,y;let n=xe,e=[],t,r=[],s=[],i,a,o,u,l;return y=class extends n{constructor(_,v){super();b(this,m);b(this,d,SA(this,e));b(this,h,new Xt);b(this,f);Z(this,"browser");b(this,p,SA(this,r,void 0));SA(this,s),x(this,f,v),this.connection=_}static async from(_,v){var C;const{result:A}=await _.send("session.new",{capabilities:v}),k=new y(_,A);return await P(C=k,m,tq).call(C),k}get connection(){return c(this,p)}set connection(_){x(this,p,_)}get capabilities(){return c(this,f).capabilities}get disposed(){return this.ended}get ended(){return c(this,d)!==void 0}get id(){return c(this,f).sessionId}dispose(_){x(this,d,_),this[Me]()}async send(_,v){return await this.connection.send(_,v)}async subscribe(_,v){await this.send("session.subscribe",{events:_,contexts:v})}async addIntercepts(_,v){await this.send("session.subscribe",{events:_,contexts:v})}async end(){try{await this.send("session.end",{})}finally{this.dispose("Session already ended.")}}[(t=[Tb()],i=[Da],a=[ue(_=>c(_,d))],o=[ue(_=>c(_,d))],u=[ue(_=>c(_,d))],l=[ue(_=>c(_,d))],Me)](){c(this,d)??x(this,d,"Session already destroyed, probably because the connection broke."),this.emit("ended",{reason:c(this,d)}),c(this,h).dispose(),super[Me]()}},d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakSet,tq=async function(){this.browser=await ure.from(this),c(this,h).use(this.browser).once("closed",({reason:A})=>{this.dispose(A)});const v=new WeakSet;this.on("browsingContext.fragmentNavigated",A=>{v.has(A)||(v.add(A),this.emit("browsingContext.navigationStarted",A),this.emit("browsingContext.fragmentNavigated",A))})},(()=>{const _=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;Id(y,null,t,{kind:"accessor",name:"connection",static:!1,private:!1,access:{has:v=>"connection"in v,get:v=>v.connection,set:(v,A)=>{v.connection=A}},metadata:_},r,s),Id(y,null,i,{kind:"method",name:"dispose",static:!1,private:!1,access:{has:v=>"dispose"in v,get:v=>v.dispose},metadata:_},null,e),Id(y,null,a,{kind:"method",name:"send",static:!1,private:!1,access:{has:v=>"send"in v,get:v=>v.send},metadata:_},null,e),Id(y,null,o,{kind:"method",name:"subscribe",static:!1,private:!1,access:{has:v=>"subscribe"in v,get:v=>v.subscribe},metadata:_},null,e),Id(y,null,u,{kind:"method",name:"addIntercepts",static:!1,private:!1,access:{has:v=>"addIntercepts"in v,get:v=>v.addIntercepts},metadata:_},null,e),Id(y,null,l,{kind:"method",name:"end",static:!1,private:!1,access:{has:v=>"end"in v,get:v=>v.end},metadata:_},null,e),_&&Object.defineProperty(y,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:_})})(),y})();/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */var dre=function(n,e,t,r,s,i){function a(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var o=r.kind,u=o==="getter"?"get":o==="setter"?"set":"value",l=!e&&n?r.static?n:n.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,f=!1,p=t.length-1;p>=0;p--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(w){if(f)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(w||null))};var y=(0,t[p])(o==="accessor"?{get:d.get,set:d.set}:d[u],m);if(o==="accessor"){if(y===void 0)continue;if(y===null||typeof y!="object")throw new TypeError("Object expected");(h=a(y.get))&&(d.get=h),(h=a(y.set))&&(d.set=h),(h=a(y.init))&&s.unshift(h)}else(h=a(y))&&(o==="field"?s.unshift(h):d[u]=h)}l&&Object.defineProperty(l,r.name,d),f=!0},OB=function(n,e,t){for(var r=arguments.length>2,s=0;s<e.length;s++)t=r?e[s].call(n,t):e[s].call(n);return r?t:void 0},RB=function(n,e,t){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(n,"name",{configurable:!0,value:t?"".concat(t," ",e):e})};let hre=(()=>{var i,a,o,Vu,rq,d,h,f,p,m,g,y,nq,sq,iq,C1;let n=RI,e,t=[],r=[],s;return i=class extends n{constructor(C,E){super();b(this,o);Z(this,"protocol","webDriverBiDi");b(this,a,OB(this,t,new xe));b(this,d,OB(this,r));b(this,h);b(this,f);b(this,p);b(this,m,new WeakMap);b(this,g,new Qte(this));b(this,y);x(this,d,E.process),x(this,h,E.closeCallback),x(this,f,C),x(this,p,E.defaultViewport),x(this,y,E.cdpConnection)}static async create(C){var I,$,O;const E=await lre.from(C.connection,{firstMatch:(I=C.capabilities)==null?void 0:I.firstMatch,alwaysMatch:{...($=C.capabilities)==null?void 0:$.alwaysMatch,acceptInsecureCerts:C.acceptInsecureCerts,unhandledPromptBehavior:{default:"ignore"},webSocketUrl:!0,"goog:prerenderingDisabled":!0}});await E.subscribe(E.capabilities.browserName.toLocaleLowerCase().includes("firefox")?i.subscribeModules:[...i.subscribeModules,...i.subscribeCdpEvents]);const N=new i(E.browser,C);return P(O=N,o,nq).call(O),N}get cdpSupported(){return c(this,y)!==void 0}get cdpConnection(){return c(this,y)}async userAgent(){return c(this,f).session.capabilities.userAgent}get connection(){return c(this,f).session.connection}wsEndpoint(){return this.connection.url}async close(){var C;if(!this.connection.closed)try{await c(this,f).close(),await((C=c(this,h))==null?void 0:C.call(null))}catch(E){_e(E)}finally{this.connection.dispose()}}get connected(){return!c(this,f).disconnected}process(){return c(this,d)??null}async createBrowserContext(C){const E=await c(this,f).createUserContext();return P(this,o,C1).call(this,E)}async version(){return`${c(this,o,sq)}/${c(this,o,iq)}`}browserContexts(){return[...c(this,f).userContexts].map(C=>c(this,m).get(C))}defaultBrowserContext(){return c(this,m).get(c(this,f).defaultUserContext)}newPage(){return this.defaultBrowserContext().newPage()}targets(){return[c(this,g),...this.browserContexts().flatMap(C=>C.targets())]}target(){return c(this,g)}async disconnect(){try{await c(this,f).session.end()}catch(C){_e(C)}finally{this.connection.dispose()}}get debugInfo(){return{pendingProtocolErrors:this.connection.getPendingProtocolErrors()}}},a=new WeakMap,o=new WeakSet,Vu=function(){return s.get.call(this)},rq=function(C){return s.set.call(this,C)},d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,nq=function(){var C;for(const E of c(this,f).userContexts)P(this,o,C1).call(this,E);c(this,f).once("disconnected",()=>{c(this,o,Vu).emit("disconnected",void 0),c(this,o,Vu).removeAllListeners()}),(C=c(this,d))==null||C.once("close",()=>{c(this,f).dispose("Browser process exited.",!0),this.connection.dispose()})},sq=function(){return c(this,f).session.capabilities.browserName},iq=function(){return c(this,f).session.capabilities.browserVersion},C1=function(C){const E=IB.from(this,C,{defaultViewport:c(this,p)});return c(this,m).set(C,E),E.trustedEmitter.on("targetcreated",N=>{c(this,o,Vu).emit("targetcreated",N)}),E.trustedEmitter.on("targetchanged",N=>{c(this,o,Vu).emit("targetchanged",N)}),E.trustedEmitter.on("targetdestroyed",N=>{c(this,o,Vu).emit("targetdestroyed",N)}),E},(()=>{const C=typeof Symbol=="function"&&Symbol.metadata?Object.create(n[Symbol.metadata]??null):void 0;e=[Tb()],dre(i,s={get:RB(function(){return c(this,a)},"#trustedEmitter","get"),set:RB(function(E){x(this,a,E)},"#trustedEmitter","set")},e,{kind:"accessor",name:"#trustedEmitter",static:!1,private:!0,access:{has:E=>dn(o,E),get:E=>c(E,o,Vu),set:(E,N)=>{x(E,o,N,rq)}},metadata:C},t,r),C&&Object.defineProperty(i,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:C})})(),Z(i,"subscribeModules",["browsingContext","network","log","script"]),Z(i,"subscribeCdpEvents",["goog:cdp.Debugger.scriptParsed","goog:cdp.CSS.styleSheetAdded","goog:cdp.Runtime.executionContextsCleared","goog:cdp.Tracing.tracingComplete","goog:cdp.Network.requestWillBeSent","goog:cdp.Debugger.scriptParsed","goog:cdp.Page.screencastFrame"]),i})();/**
 * @license
 * Copyright 2022 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const MB=Object.freeze(Object.defineProperty({__proto__:null,BidiBrowser:hre,BidiBrowserContext:IB,BidiConnection:dB,BidiElementHandle:dg,BidiFrame:vB,BidiFrameRealm:lo,BidiHTTPRequest:pA,BidiHTTPResponse:mB,BidiJSHandle:uo,BidiKeyboard:SB,BidiMouse:xB,BidiPage:pg,BidiRealm:mA,BidiTouchscreen:EB,BidiWorkerRealm:y0,bidiToPuppeteerCookie:wA,cdpSpecificCookiePropertiesFromPuppeteerToBidi:bA,connectBidiOverCdp:mte,convertCookiesExpiryCdpToBiDi:vA,convertCookiesPartitionKeyFromPuppeteerToBiDi:AB,convertCookiesSameSiteCdpToBiDi:_A,requests:fA},Symbol.toStringTag,{value:"Module"}));var xA,NB;function fre(){return NB||(NB=1,xA=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}),xA}var pre=fre();const mre=Ve(pre);/**
 * @license
 * Copyright 2018 Google Inc.
 * SPDX-License-Identifier: Apache-2.0
 */const qA=class qA{constructor(e){b(this,Ma);Z(this,"onmessage");Z(this,"onclose");x(this,Ma,e),c(this,Ma).addEventListener("message",t=>{this.onmessage&&this.onmessage.call(null,t.data)}),c(this,Ma).addEventListener("close",()=>{this.onclose&&this.onclose.call(null)}),c(this,Ma).addEventListener("error",()=>{})}static create(e,t){return new Promise((r,s)=>{const i=new mre(e,[],{followRedirects:!0,perMessageDeflate:!1,allowSynchronousEvents:!1,maxPayload:268435456,headers:{"User-Agent":`Puppeteer ${SI}`,...t}});i.addEventListener("open",()=>r(new qA(i))),i.addEventListener("error",s)})}send(e){c(this,Ma).send(e)}close(){c(this,Ma).close()}};Ma=new WeakMap;let EA=qA;const gre=Object.freeze(Object.defineProperty({__proto__:null,NodeWebSocketTransport:EA},Symbol.toStringTag,{value:"Module"}))})();
